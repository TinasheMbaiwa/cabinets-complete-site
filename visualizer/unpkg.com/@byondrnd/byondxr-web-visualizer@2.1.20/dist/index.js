!function webpackUniversalModuleDefinition(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("jszip"),require("omggif"),require("hls.js"),require("webxr-polyfill")):"function"==typeof define&&define.amd?define(["jszip","omggif","hls.js","webxr-polyfill"],n):"object"==typeof exports?exports.ByondVisualizer=n(require("jszip"),require("omggif"),require("hls.js"),require("webxr-polyfill")):t.ByondVisualizer=n(t.jszip,t.omggif,t["hls.js"],t["webxr-polyfill"])}(window,(function(t,n,i,o){return function(t){var n={};function __webpack_require__(i){if(n[i])return n[i].exports;var o=n[i]={i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}return __webpack_require__.m=t,__webpack_require__.c=n,__webpack_require__.d=function(t,n,i){__webpack_require__.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,n){if(1&n&&(t=__webpack_require__(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)__webpack_require__.d(i,o,function(n){return t[n]}.bind(null,o));return i},__webpack_require__.n=function(t){var n=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(n,"a",n),n},__webpack_require__.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=124)}([function(t,n,i){"use strict";i.d(n,"c",(function(){return __extends})),i.d(n,"a",(function(){return __assign})),i.d(n,"e",(function(){return __rest})),i.d(n,"b",(function(){return __awaiter})),i.d(n,"d",(function(){return __generator})),i.d(n,"f",(function(){return __spreadArray}));var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(t,n)};function __extends(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}var __assign=function(){return(__assign=Object.assign||function __assign(t){for(var n,i=1,o=arguments.length;i<o;i++)for(var a in n=arguments[i])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)};function __rest(t,n){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&n.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(t);a<o.length;a++)n.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(t,o[a])&&(i[o[a]]=t[o[a]])}return i}function __awaiter(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))}function __generator(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}}Object.create;function __spreadArray(t,n,i){if(i||2===arguments.length)for(var o,a=0,s=n.length;a<s;a++)!o&&a in n||(o||(o=Array.prototype.slice.call(n,0,a)),o[a]=n[a]);return t.concat(o||Array.prototype.slice.call(n))}Object.create},function(t,n,i){"use strict";i.d(n,"a",(function(){return s})),i.d(n,"b",(function(){return invariant})),i.d(n,"c",(function(){return setVerbosity}));var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(t,n)};Object.create;Object.create;var o=Object.setPrototypeOf,a=void 0===o?function(t,n){return t.__proto__=n,t}:o,s=function(t){function InvariantError(n){void 0===n&&(n="Invariant Violation");var i=t.call(this,"number"==typeof n?"Invariant Violation: "+n+" (see https://github.com/apollographql/invariant-packages)":n)||this;return i.framesToPop=1,i.name="Invariant Violation",a(i,InvariantError.prototype),i}return function __extends(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}(InvariantError,t),InvariantError}(Error);function invariant(t,n){if(!t)throw new s(n)}var m=["debug","log","warn","error","silent"],g=m.indexOf("log");function wrapConsoleMethod(t){return function(){if(m.indexOf(t)>=g){var n=console[t]||console.log;return n.apply(console,arguments)}}}function setVerbosity(t){var n=m[g];return g=Math.max(0,m.indexOf(t)),n}!function(t){t.debug=wrapConsoleMethod("debug"),t.log=wrapConsoleMethod("log"),t.warn=wrapConsoleMethod("warn"),t.error=wrapConsoleMethod("error")}(invariant||(invariant={}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",VARIABLE:"Variable",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",DIRECTIVE_DEFINITION:"DirectiveDefinition",SCHEMA_EXTENSION:"SchemaExtension",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension"})},function(t,n,i){"use strict";i.d(n,"a",(function(){return inspect}));var o=i(35);function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function inspect(t){return formatValue(t,[])}function formatValue(t,n){switch(_typeof(t)){case"string":return JSON.stringify(t);case"function":return t.name?"[function ".concat(t.name,"]"):"[function]";case"object":return null===t?"null":function formatObjectValue(t,n){if(-1!==n.indexOf(t))return"[Circular]";var i=[].concat(n,[t]),a=function getCustomFn(t){var n=t[String(o.a)];if("function"==typeof n)return n;if("function"==typeof t.inspect)return t.inspect}(t);if(void 0!==a){var s=a.call(t);if(s!==t)return"string"==typeof s?s:formatValue(s,i)}else if(Array.isArray(t))return function formatArray(t,n){if(0===t.length)return"[]";if(n.length>2)return"[Array]";for(var i=Math.min(10,t.length),o=t.length-i,a=[],s=0;s<i;++s)a.push(formatValue(t[s],n));1===o?a.push("... 1 more item"):o>1&&a.push("... ".concat(o," more items"));return"["+a.join(", ")+"]"}(t,i);return function formatObject(t,n){var i=Object.keys(t);if(0===i.length)return"{}";if(n.length>2)return"["+function getObjectTag(t){var n=Object.prototype.toString.call(t).replace(/^\[object /,"").replace(/]$/,"");if("Object"===n&&"function"==typeof t.constructor){var i=t.constructor.name;if("string"==typeof i&&""!==i)return i}return n}(t)+"]";return"{ "+i.map((function(i){return i+": "+formatValue(t[i],n)})).join(", ")+" }"}(t,i)}(t,n);default:return String(t)}}},function(t,n,i){"use strict";function devAssert(t,n){if(!Boolean(t))throw new Error(n)}i.d(n,"a",(function(){return devAssert}))},function(t,n,i){"use strict";i.r(n),i.d(n,"DEV",(function(){return a.a})),i.d(n,"shouldInclude",(function(){return s.e})),i.d(n,"hasDirectives",(function(){return s.d})),i.d(n,"hasClientExports",(function(){return s.c})),i.d(n,"getDirectiveNames",(function(){return s.a})),i.d(n,"getInclusionDirectives",(function(){return s.b})),i.d(n,"createFragmentMap",(function(){return m.a})),i.d(n,"getFragmentQueryDocument",(function(){return m.c})),i.d(n,"getFragmentFromSelection",(function(){return m.b})),i.d(n,"checkDocument",(function(){return g.a})),i.d(n,"getOperationDefinition",(function(){return g.f})),i.d(n,"getOperationName",(function(){return g.g})),i.d(n,"getFragmentDefinitions",(function(){return g.d})),i.d(n,"getQueryDefinition",(function(){return g.h})),i.d(n,"getFragmentDefinition",(function(){return g.c})),i.d(n,"getMainDefinition",(function(){return g.e})),i.d(n,"getDefaultValues",(function(){return g.b})),i.d(n,"makeReference",(function(){return _.h})),i.d(n,"isDocumentNode",(function(){return _.d})),i.d(n,"isReference",(function(){return _.g})),i.d(n,"isField",(function(){return _.e})),i.d(n,"isInlineFragment",(function(){return _.f})),i.d(n,"valueToObjectRepresentation",(function(){return _.k})),i.d(n,"storeKeyNameFromField",(function(){return _.j})),i.d(n,"argumentsObjectFromField",(function(){return _.a})),i.d(n,"resultKeyNameFromField",(function(){return _.i})),i.d(n,"getStoreKeyName",(function(){return _.b})),i.d(n,"getTypenameFromResult",(function(){return _.c})),i.d(n,"addTypenameToDocument",(function(){return S.a})),i.d(n,"buildQueryFromSelectionSet",(function(){return S.b})),i.d(n,"removeDirectivesFromDocument",(function(){return S.f})),i.d(n,"removeConnectionDirectiveFromDocument",(function(){return S.e})),i.d(n,"removeArgumentsFromDocument",(function(){return S.c})),i.d(n,"removeFragmentSpreadFromDocument",(function(){return S.g})),i.d(n,"removeClientSetsFromDocument",(function(){return S.d})),i.d(n,"concatPagination",(function(){return concatPagination})),i.d(n,"offsetLimitPagination",(function(){return offsetLimitPagination})),i.d(n,"relayStylePagination",(function(){return relayStylePagination})),i.d(n,"Observable",(function(){return A.a})),i.d(n,"mergeDeep",(function(){return T.b})),i.d(n,"mergeDeepArray",(function(){return T.c})),i.d(n,"DeepMerger",(function(){return T.a})),i.d(n,"cloneDeep",(function(){return P.a})),i.d(n,"maybeDeepFreeze",(function(){return L.a})),i.d(n,"maybe",(function(){return R.a})),i.d(n,"iterateObserversSafely",(function(){return N.a})),i.d(n,"asyncMap",(function(){return I.a})),i.d(n,"Concast",(function(){return j.a})),i.d(n,"fixObservableSubclass",(function(){return V.a})),i.d(n,"isNonEmptyArray",(function(){return U.a})),i.d(n,"isNonNullObject",(function(){return G.a})),i.d(n,"graphQLResultHasError",(function(){return z.a})),i.d(n,"canUseWeakMap",(function(){return H.a})),i.d(n,"canUseWeakSet",(function(){return H.b})),i.d(n,"compact",(function(){return q.a})),i.d(n,"makeUniqueId",(function(){return Z.a})),i.d(n,"stringifyForDisplay",(function(){return X.a}));var o=i(1),a=i(29),s=i(27),m=i(21),g=i(8),_=i(7),S=i(20),M=i(0),T=i(34);function concatPagination(t){return void 0===t&&(t=!1),{keyArgs:t,merge:function(t,n){return t?Object(M.f)(Object(M.f)([],t),n):n}}}function offsetLimitPagination(t){return void 0===t&&(t=!1),{keyArgs:t,merge:function(t,n,i){var o=i.args,a=t?t.slice(0):[];if(o)for(var s=o.offset,m=void 0===s?0:s,g=0;g<n.length;++g)a[m+g]=n[g];else a.push.apply(a,n);return a}}}function relayStylePagination(t){return void 0===t&&(t=!1),{keyArgs:t,read:function(t,n){var i=n.canRead,o=n.readField;if(t){var a=[],s="",m="";t.edges.forEach((function(t){i(o("node",t))&&(a.push(t),t.cursor&&(s=s||t.cursor||"",m=t.cursor||m))}));var g=t.pageInfo||{},_=g.startCursor,S=g.endCursor;return Object(M.a)(Object(M.a)({},getExtras(t)),{edges:a,pageInfo:Object(M.a)(Object(M.a)({},t.pageInfo),{startCursor:_||s,endCursor:S||m})})}},merge:function(t,n,i){void 0===t&&(t={edges:[],pageInfo:{hasPreviousPage:!1,hasNextPage:!0,startCursor:"",endCursor:""}});var o=i.args,a=i.isReference,s=i.readField,m=n.edges?n.edges.map((function(t){return a(t=Object(M.a)({},t))&&(t.cursor=s("cursor",t)),t})):[];if(n.pageInfo){var g=n.pageInfo,_=g.startCursor,S=g.endCursor,O=m[0],A=m[m.length-1];O&&_&&(O.cursor=_),A&&S&&(A.cursor=S);var P=O&&O.cursor;P&&!_&&(n=Object(T.b)(n,{pageInfo:{startCursor:P}}));var L=A&&A.cursor;L&&!S&&(n=Object(T.b)(n,{pageInfo:{endCursor:L}}))}var R=t.edges,N=[];if(o&&o.after)(I=R.findIndex((function(t){return t.cursor===o.after})))>=0&&(R=R.slice(0,I+1));else if(o&&o.before){var I;N=(I=R.findIndex((function(t){return t.cursor===o.before})))<0?R:R.slice(I),R=[]}else n.edges&&(R=[]);var j=Object(M.f)(Object(M.f)(Object(M.f)([],R),m),N),V=Object(M.a)(Object(M.a)({},n.pageInfo),t.pageInfo);if(n.pageInfo){var U=n.pageInfo,G=U.hasPreviousPage,z=U.hasNextPage,H=(_=U.startCursor,S=U.endCursor,Object(M.e)(U,["hasPreviousPage","hasNextPage","startCursor","endCursor"]));Object.assign(V,H),R.length||(void 0!==G&&(V.hasPreviousPage=G),void 0!==_&&(V.startCursor=_)),N.length||(void 0!==z&&(V.hasNextPage=z),void 0!==S&&(V.endCursor=S))}return Object(M.a)(Object(M.a)(Object(M.a)({},getExtras(t)),getExtras(n)),{edges:j,pageInfo:V})}}}var getExtras=function(t){return Object(M.e)(t,O)},O=["edges","pageInfo"];var A=i(30),P=i(107),L=i(111),R=i(16),N=i(28),I=i(104),j=i(108),V=i(44),U=i(106),G=i(10),z=i(105),H=i(103),q=i(102),Z=i(45),X=i(110);__DEV__?Object(o.b)("boolean"==typeof a.a,a.a):Object(o.b)("boolean"==typeof a.a,59)},function(t,n,i){"use strict";i.d(n,"a",(function(){return a})),i.d(n,"b",(function(){return s})),i.d(n,"c",(function(){return isNode}));var o=i(12),a=function(){function Location(t,n,i){this.start=t.start,this.end=n.end,this.startToken=t,this.endToken=n,this.source=i}return Location.prototype.toJSON=function toJSON(){return{start:this.start,end:this.end}},Location}();Object(o.a)(a);var s=function(){function Token(t,n,i,o,a,s,m){this.kind=t,this.start=n,this.end=i,this.line=o,this.column=a,this.value=m,this.prev=s,this.next=null}return Token.prototype.toJSON=function toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},Token}();function isNode(t){return null!=t&&"string"==typeof t.kind}Object(o.a)(s)},function(t,n,i){"use strict";i.d(n,"h",(function(){return makeReference})),i.d(n,"g",(function(){return isReference})),i.d(n,"d",(function(){return isDocumentNode})),i.d(n,"k",(function(){return valueToObjectRepresentation})),i.d(n,"j",(function(){return storeKeyNameFromField})),i.d(n,"b",(function(){return g})),i.d(n,"a",(function(){return argumentsObjectFromField})),i.d(n,"i",(function(){return resultKeyNameFromField})),i.d(n,"c",(function(){return getTypenameFromResult})),i.d(n,"e",(function(){return isField})),i.d(n,"f",(function(){return isInlineFragment}));var o=i(1),a=i(10),s=i(21);function makeReference(t){return{__ref:String(t)}}function isReference(t){return Boolean(t&&"object"==typeof t&&"string"==typeof t.__ref)}function isDocumentNode(t){return Object(a.a)(t)&&"Document"===t.kind&&Array.isArray(t.definitions)}function valueToObjectRepresentation(t,n,i,a){if(function isIntValue(t){return"IntValue"===t.kind}(i)||function isFloatValue(t){return"FloatValue"===t.kind}(i))t[n.value]=Number(i.value);else if(function isBooleanValue(t){return"BooleanValue"===t.kind}(i)||function isStringValue(t){return"StringValue"===t.kind}(i))t[n.value]=i.value;else if(function isObjectValue(t){return"ObjectValue"===t.kind}(i)){var s={};i.fields.map((function(t){return valueToObjectRepresentation(s,t.name,t.value,a)})),t[n.value]=s}else if(function isVariable(t){return"Variable"===t.kind}(i)){var m=(a||{})[i.name.value];t[n.value]=m}else if(function isListValue(t){return"ListValue"===t.kind}(i))t[n.value]=i.values.map((function(t){var i={};return valueToObjectRepresentation(i,n,t,a),i[n.value]}));else if(function isEnumValue(t){return"EnumValue"===t.kind}(i))t[n.value]=i.value;else{if(!function isNullValue(t){return"NullValue"===t.kind}(i))throw __DEV__?new o.a('The inline argument "'+n.value+'" of kind "'+i.kind+'"is not supported. Use variables instead of inline arguments to overcome this limitation.'):new o.a(58);t[n.value]=null}}function storeKeyNameFromField(t,n){var i=null;t.directives&&(i={},t.directives.forEach((function(t){i[t.name.value]={},t.arguments&&t.arguments.forEach((function(o){var a=o.name,s=o.value;return valueToObjectRepresentation(i[t.name.value],a,s,n)}))})));var o=null;return t.arguments&&t.arguments.length&&(o={},t.arguments.forEach((function(t){var i=t.name,a=t.value;return valueToObjectRepresentation(o,i,a,n)}))),g(t.name.value,o,i)}var m=["connection","include","skip","client","rest","export"],g=Object.assign((function(t,n,i){if(n&&i&&i.connection&&i.connection.key){if(i.connection.filter&&i.connection.filter.length>0){var o=i.connection.filter?i.connection.filter:[];o.sort();var a={};return o.forEach((function(t){a[t]=n[t]})),i.connection.key+"("+_(a)+")"}return i.connection.key}var s=t;if(n){var g=_(n);s+="("+g+")"}return i&&Object.keys(i).forEach((function(t){-1===m.indexOf(t)&&(i[t]&&Object.keys(i[t]).length?s+="@"+t+"("+_(i[t])+")":s+="@"+t)})),s}),{setStringify:function(t){var n=_;return _=t,n}}),_=function defaultStringify(t){return JSON.stringify(t,stringifyReplacer)};function stringifyReplacer(t,n){return Object(a.a)(n)&&!Array.isArray(n)&&(n=Object.keys(n).sort().reduce((function(t,i){return t[i]=n[i],t}),{})),n}function argumentsObjectFromField(t,n){if(t.arguments&&t.arguments.length){var i={};return t.arguments.forEach((function(t){var o=t.name,a=t.value;return valueToObjectRepresentation(i,o,a,n)})),i}return null}function resultKeyNameFromField(t){return t.alias?t.alias.value:t.name.value}function getTypenameFromResult(t,n,i){if("string"==typeof t.__typename)return t.__typename;for(var o=0,a=n.selections;o<a.length;o++){var m=a[o];if(isField(m)){if("__typename"===m.name.value)return t[resultKeyNameFromField(m)]}else{var g=getTypenameFromResult(t,Object(s.b)(m,i).selectionSet,i);if("string"==typeof g)return g}}}function isField(t){return"Field"===t.kind}function isInlineFragment(t){return"InlineFragment"===t.kind}},function(t,n,i){"use strict";i.d(n,"a",(function(){return checkDocument})),i.d(n,"f",(function(){return getOperationDefinition})),i.d(n,"g",(function(){return getOperationName})),i.d(n,"d",(function(){return getFragmentDefinitions})),i.d(n,"h",(function(){return getQueryDefinition})),i.d(n,"c",(function(){return getFragmentDefinition})),i.d(n,"e",(function(){return getMainDefinition})),i.d(n,"b",(function(){return getDefaultValues}));var o=i(1),a=i(7);function checkDocument(t){__DEV__?Object(o.b)(t&&"Document"===t.kind,'Expecting a parsed GraphQL document. Perhaps you need to wrap the query string in a "gql" tag? http://docs.apollostack.com/apollo-client/core.html#gql'):Object(o.b)(t&&"Document"===t.kind,50);var n=t.definitions.filter((function(t){return"FragmentDefinition"!==t.kind})).map((function(t){if("OperationDefinition"!==t.kind)throw __DEV__?new o.a('Schema type definitions not allowed in queries. Found: "'+t.kind+'"'):new o.a(51);return t}));return __DEV__?Object(o.b)(n.length<=1,"Ambiguous GraphQL document: contains "+n.length+" operations"):Object(o.b)(n.length<=1,52),t}function getOperationDefinition(t){return checkDocument(t),t.definitions.filter((function(t){return"OperationDefinition"===t.kind}))[0]}function getOperationName(t){return t.definitions.filter((function(t){return"OperationDefinition"===t.kind&&t.name})).map((function(t){return t.name.value}))[0]||null}function getFragmentDefinitions(t){return t.definitions.filter((function(t){return"FragmentDefinition"===t.kind}))}function getQueryDefinition(t){var n=getOperationDefinition(t);return __DEV__?Object(o.b)(n&&"query"===n.operation,"Must contain a query definition."):Object(o.b)(n&&"query"===n.operation,53),n}function getFragmentDefinition(t){__DEV__?Object(o.b)("Document"===t.kind,'Expecting a parsed GraphQL document. Perhaps you need to wrap the query string in a "gql" tag? http://docs.apollostack.com/apollo-client/core.html#gql'):Object(o.b)("Document"===t.kind,54),__DEV__?Object(o.b)(t.definitions.length<=1,"Fragment must have exactly one definition."):Object(o.b)(t.definitions.length<=1,55);var n=t.definitions[0];return __DEV__?Object(o.b)("FragmentDefinition"===n.kind,"Must be a fragment definition."):Object(o.b)("FragmentDefinition"===n.kind,56),n}function getMainDefinition(t){var n;checkDocument(t);for(var i=0,a=t.definitions;i<a.length;i++){var s=a[i];if("OperationDefinition"===s.kind){var m=s.operation;if("query"===m||"mutation"===m||"subscription"===m)return s}"FragmentDefinition"!==s.kind||n||(n=s)}if(n)return n;throw __DEV__?new o.a("Expected a parsed GraphQL query with a query, mutation, subscription, or a fragment."):new o.a(57)}function getDefaultValues(t){var n=Object.create(null),i=t&&t.variableDefinitions;return i&&i.length&&i.forEach((function(t){t.defaultValue&&Object(a.k)(n,t.variable.name,t.defaultValue)})),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return _}));var o=i(0),a=i(1),s=i(30);var m=i(8);function passthrough(t,n){return n?n(t):s.a.of()}function toLink(t){return"function"==typeof t?new _(t):t}function isTerminating(t){return t.request.length<=1}var g=function(t){function LinkError(n,i){var o=t.call(this,n)||this;return o.link=i,o}return Object(o.c)(LinkError,t),LinkError}(Error),_=function(){function ApolloLink(t){t&&(this.request=t)}return ApolloLink.empty=function(){return new ApolloLink((function(){return s.a.of()}))},ApolloLink.from=function(t){return 0===t.length?ApolloLink.empty():t.map(toLink).reduce((function(t,n){return t.concat(n)}))},ApolloLink.split=function(t,n,i){var o=toLink(n),a=toLink(i||new ApolloLink(passthrough));return isTerminating(o)&&isTerminating(a)?new ApolloLink((function(n){return t(n)?o.request(n)||s.a.of():a.request(n)||s.a.of()})):new ApolloLink((function(n,i){return t(n)?o.request(n,i)||s.a.of():a.request(n,i)||s.a.of()}))},ApolloLink.execute=function(t,n){return t.request(function createOperation(t,n){var i=Object(o.a)({},t);return Object.defineProperty(n,"setContext",{enumerable:!1,value:function(t){i="function"==typeof t?Object(o.a)(Object(o.a)({},i),t(i)):Object(o.a)(Object(o.a)({},i),t)}}),Object.defineProperty(n,"getContext",{enumerable:!1,value:function(){return Object(o.a)({},i)}}),n}(n.context,function transformOperation(t){var n={variables:t.variables||{},extensions:t.extensions||{},operationName:t.operationName,query:t.query};return n.operationName||(n.operationName="string"!=typeof n.query?Object(m.g)(n.query)||void 0:""),n}(function validateOperation(t){for(var n=["query","operationName","variables","extensions","context"],i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];if(n.indexOf(s)<0)throw __DEV__?new a.a("illegal argument: "+s):new a.a(29)}return t}(n))))||s.a.of()},ApolloLink.concat=function(t,n){var i=toLink(t);if(isTerminating(i))return __DEV__&&a.b.warn(new g("You are calling concat on a terminating link, which will have no effect",i)),i;var o=toLink(n);return isTerminating(o)?new ApolloLink((function(t){return i.request(t,(function(t){return o.request(t)||s.a.of()}))||s.a.of()})):new ApolloLink((function(t,n){return i.request(t,(function(t){return o.request(t,n)||s.a.of()}))||s.a.of()}))},ApolloLink.prototype.split=function(t,n,i){return this.concat(ApolloLink.split(t,n,i||new ApolloLink(passthrough)))},ApolloLink.prototype.concat=function(t){return ApolloLink.concat(this,t)},ApolloLink.prototype.request=function(t,n){throw __DEV__?new a.a("request is not implemented"):new a.a(23)},ApolloLink.prototype.onError=function(t,n){if(n&&n.error)return n.error(t),!1;throw t},ApolloLink.prototype.setOnError=function(t){return this.onError=t,this},ApolloLink}()},function(t,n,i){"use strict";function isNonNullObject(t){return null!==t&&"object"==typeof t}i.d(n,"a",(function(){return isNonNullObject}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));"function"==typeof Symbol&&null!=Symbol.iterator&&Symbol.iterator,"function"==typeof Symbol&&null!=Symbol.asyncIterator&&Symbol.asyncIterator;var o="function"==typeof Symbol&&null!=Symbol.toStringTag?Symbol.toStringTag:"@@toStringTag"},function(t,n,i){"use strict";i.d(n,"a",(function(){return defineInspect}));var o=i(46),a=i(35);function defineInspect(t){var n=t.prototype.toJSON;"function"==typeof n||Object(o.a)(0),t.prototype.inspect=n,a.a&&(t.prototype[a.a]=n)}},function(t,n,i){"use strict";n.a=function instanceOf(t,n){return t instanceof n}},function(t,n,i){var o=i(81),a="object"==typeof self&&self&&self.Object===Object&&self,s=o||a||Function("return this")();t.exports=s},function(t,n,i){"use strict";i.r(n),i.d(n,"gql",(function(){return gql})),i.d(n,"resetCaches",(function(){return resetCaches})),i.d(n,"disableFragmentWarnings",(function(){return disableFragmentWarnings})),i.d(n,"enableExperimentalFragmentVariables",(function(){return enableExperimentalFragmentVariables})),i.d(n,"disableExperimentalFragmentVariables",(function(){return disableExperimentalFragmentVariables}));var __assign=function(){return(__assign=Object.assign||function __assign(t){for(var n,i=1,o=arguments.length;i<o;i++)for(var a in n=arguments[i])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)};Object.create;Object.create;var o=i(22);function syntaxError(t,n,i){return new o.a("Syntax Error: ".concat(i),void 0,t,[n])}var a=i(2),s=i(6),m=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"}),g=i(11),_=i(3),S=i(4),M=i(13);function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var T=function(){function Source(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GraphQL request",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{line:1,column:1};"string"==typeof t||Object(S.a)(0,"Body must be a string. Received: ".concat(Object(_.a)(t),".")),this.body=t,this.name=n,this.locationOffset=i,this.locationOffset.line>0||Object(S.a)(0,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||Object(S.a)(0,"column in locationOffset is 1-indexed and must be positive.")}return function _createClass(t,n,i){return n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i),t}(Source,[{key:g.a,get:function get(){return"Source"}}]),Source}();var O=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",VARIABLE_DEFINITION:"VARIABLE_DEFINITION",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"}),A=i(48),P=function(){function Lexer(t){var n=new s.b(m.SOF,0,0,0,0,null);this.source=t,this.lastToken=n,this.token=n,this.line=1,this.lineStart=0}var t=Lexer.prototype;return t.advance=function advance(){return this.lastToken=this.token,this.token=this.lookahead()},t.lookahead=function lookahead(){var t=this.token;if(t.kind!==m.EOF)do{var n;t=null!==(n=t.next)&&void 0!==n?n:t.next=readToken(this,t)}while(t.kind===m.COMMENT);return t},Lexer}();function printCharCode(t){return isNaN(t)?m.EOF:t<127?JSON.stringify(String.fromCharCode(t)):'"\\u'.concat(("00"+t.toString(16).toUpperCase()).slice(-4),'"')}function readToken(t,n){for(var i=t.source,o=i.body,a=o.length,g=n.end;g<a;){var _=o.charCodeAt(g),S=t.line,M=1+g-t.lineStart;switch(_){case 65279:case 9:case 32:case 44:++g;continue;case 10:++g,++t.line,t.lineStart=g;continue;case 13:10===o.charCodeAt(g+1)?g+=2:++g,++t.line,t.lineStart=g;continue;case 33:return new s.b(m.BANG,g,g+1,S,M,n);case 35:return readComment(i,g,S,M,n);case 36:return new s.b(m.DOLLAR,g,g+1,S,M,n);case 38:return new s.b(m.AMP,g,g+1,S,M,n);case 40:return new s.b(m.PAREN_L,g,g+1,S,M,n);case 41:return new s.b(m.PAREN_R,g,g+1,S,M,n);case 46:if(46===o.charCodeAt(g+1)&&46===o.charCodeAt(g+2))return new s.b(m.SPREAD,g,g+3,S,M,n);break;case 58:return new s.b(m.COLON,g,g+1,S,M,n);case 61:return new s.b(m.EQUALS,g,g+1,S,M,n);case 64:return new s.b(m.AT,g,g+1,S,M,n);case 91:return new s.b(m.BRACKET_L,g,g+1,S,M,n);case 93:return new s.b(m.BRACKET_R,g,g+1,S,M,n);case 123:return new s.b(m.BRACE_L,g,g+1,S,M,n);case 124:return new s.b(m.PIPE,g,g+1,S,M,n);case 125:return new s.b(m.BRACE_R,g,g+1,S,M,n);case 34:return 34===o.charCodeAt(g+1)&&34===o.charCodeAt(g+2)?readBlockString(i,g,S,M,n,t):readString(i,g,S,M,n);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return readNumber(i,g,_,S,M,n);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return readName(i,g,S,M,n)}throw syntaxError(i,g,unexpectedCharacterMessage(_))}var T=t.line,O=1+g-t.lineStart;return new s.b(m.EOF,a,a,T,O,n)}function unexpectedCharacterMessage(t){return t<32&&9!==t&&10!==t&&13!==t?"Cannot contain the invalid character ".concat(printCharCode(t),"."):39===t?"Unexpected single quote character ('), did you mean to use a double quote (\")?":"Cannot parse the unexpected character ".concat(printCharCode(t),".")}function readComment(t,n,i,o,a){var g,_=t.body,S=n;do{g=_.charCodeAt(++S)}while(!isNaN(g)&&(g>31||9===g));return new s.b(m.COMMENT,n,S,i,o,a,_.slice(n+1,S))}function readNumber(t,n,i,o,a,g){var _=t.body,S=i,M=n,T=!1;if(45===S&&(S=_.charCodeAt(++M)),48===S){if((S=_.charCodeAt(++M))>=48&&S<=57)throw syntaxError(t,M,"Invalid number, unexpected digit after 0: ".concat(printCharCode(S),"."))}else M=readDigits(t,M,S),S=_.charCodeAt(M);if(46===S&&(T=!0,S=_.charCodeAt(++M),M=readDigits(t,M,S),S=_.charCodeAt(M)),69!==S&&101!==S||(T=!0,43!==(S=_.charCodeAt(++M))&&45!==S||(S=_.charCodeAt(++M)),M=readDigits(t,M,S),S=_.charCodeAt(M)),46===S||function isNameStart(t){return 95===t||t>=65&&t<=90||t>=97&&t<=122}(S))throw syntaxError(t,M,"Invalid number, expected digit but got: ".concat(printCharCode(S),"."));return new s.b(T?m.FLOAT:m.INT,n,M,o,a,g,_.slice(n,M))}function readDigits(t,n,i){var o=t.body,a=n,s=i;if(s>=48&&s<=57){do{s=o.charCodeAt(++a)}while(s>=48&&s<=57);return a}throw syntaxError(t,a,"Invalid number, expected digit but got: ".concat(printCharCode(s),"."))}function readString(t,n,i,o,a){for(var g,_,S,M,T=t.body,O=n+1,A=O,P=0,L="";O<T.length&&!isNaN(P=T.charCodeAt(O))&&10!==P&&13!==P;){if(34===P)return L+=T.slice(A,O),new s.b(m.STRING,n,O+1,i,o,a,L);if(P<32&&9!==P)throw syntaxError(t,O,"Invalid character within String: ".concat(printCharCode(P),"."));if(++O,92===P){switch(L+=T.slice(A,O-1),P=T.charCodeAt(O)){case 34:L+='"';break;case 47:L+="/";break;case 92:L+="\\";break;case 98:L+="\b";break;case 102:L+="\f";break;case 110:L+="\n";break;case 114:L+="\r";break;case 116:L+="\t";break;case 117:var R=(g=T.charCodeAt(O+1),_=T.charCodeAt(O+2),S=T.charCodeAt(O+3),M=T.charCodeAt(O+4),char2hex(g)<<12|char2hex(_)<<8|char2hex(S)<<4|char2hex(M));if(R<0){var N=T.slice(O+1,O+5);throw syntaxError(t,O,"Invalid character escape sequence: \\u".concat(N,"."))}L+=String.fromCharCode(R),O+=4;break;default:throw syntaxError(t,O,"Invalid character escape sequence: \\".concat(String.fromCharCode(P),"."))}A=++O}}throw syntaxError(t,O,"Unterminated string.")}function readBlockString(t,n,i,o,a,g){for(var _=t.body,S=n+3,M=S,T=0,O="";S<_.length&&!isNaN(T=_.charCodeAt(S));){if(34===T&&34===_.charCodeAt(S+1)&&34===_.charCodeAt(S+2))return O+=_.slice(M,S),new s.b(m.BLOCK_STRING,n,S+3,i,o,a,Object(A.a)(O));if(T<32&&9!==T&&10!==T&&13!==T)throw syntaxError(t,S,"Invalid character within String: ".concat(printCharCode(T),"."));10===T?(++S,++g.line,g.lineStart=S):13===T?(10===_.charCodeAt(S+1)?S+=2:++S,++g.line,g.lineStart=S):92===T&&34===_.charCodeAt(S+1)&&34===_.charCodeAt(S+2)&&34===_.charCodeAt(S+3)?(O+=_.slice(M,S)+'"""',M=S+=4):++S}throw syntaxError(t,S,"Unterminated string.")}function char2hex(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:-1}function readName(t,n,i,o,a){for(var g=t.body,_=g.length,S=n+1,M=0;S!==_&&!isNaN(M=g.charCodeAt(S))&&(95===M||M>=48&&M<=57||M>=65&&M<=90||M>=97&&M<=122);)++S;return new s.b(m.NAME,n,S,i,o,a,g.slice(n,S))}var L=function(){function Parser(t,n){var i=function isSource(t){return Object(M.a)(t,T)}(t)?t:new T(t);this._lexer=new P(i),this._options=n}var t=Parser.prototype;return t.parseName=function parseName(){var t=this.expectToken(m.NAME);return{kind:a.a.NAME,value:t.value,loc:this.loc(t)}},t.parseDocument=function parseDocument(){var t=this._lexer.token;return{kind:a.a.DOCUMENT,definitions:this.many(m.SOF,this.parseDefinition,m.EOF),loc:this.loc(t)}},t.parseDefinition=function parseDefinition(){if(this.peek(m.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else{if(this.peek(m.BRACE_L))return this.parseOperationDefinition();if(this.peekDescription())return this.parseTypeSystemDefinition()}throw this.unexpected()},t.parseOperationDefinition=function parseOperationDefinition(){var t=this._lexer.token;if(this.peek(m.BRACE_L))return{kind:a.a.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(t)};var n,i=this.parseOperationType();return this.peek(m.NAME)&&(n=this.parseName()),{kind:a.a.OPERATION_DEFINITION,operation:i,name:n,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}},t.parseOperationType=function parseOperationType(){var t=this.expectToken(m.NAME);switch(t.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(t)},t.parseVariableDefinitions=function parseVariableDefinitions(){return this.optionalMany(m.PAREN_L,this.parseVariableDefinition,m.PAREN_R)},t.parseVariableDefinition=function parseVariableDefinition(){var t=this._lexer.token;return{kind:a.a.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(m.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(m.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(t)}},t.parseVariable=function parseVariable(){var t=this._lexer.token;return this.expectToken(m.DOLLAR),{kind:a.a.VARIABLE,name:this.parseName(),loc:this.loc(t)}},t.parseSelectionSet=function parseSelectionSet(){var t=this._lexer.token;return{kind:a.a.SELECTION_SET,selections:this.many(m.BRACE_L,this.parseSelection,m.BRACE_R),loc:this.loc(t)}},t.parseSelection=function parseSelection(){return this.peek(m.SPREAD)?this.parseFragment():this.parseField()},t.parseField=function parseField(){var t,n,i=this._lexer.token,o=this.parseName();return this.expectOptionalToken(m.COLON)?(t=o,n=this.parseName()):n=o,{kind:a.a.FIELD,alias:t,name:n,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(m.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(i)}},t.parseArguments=function parseArguments(t){var n=t?this.parseConstArgument:this.parseArgument;return this.optionalMany(m.PAREN_L,n,m.PAREN_R)},t.parseArgument=function parseArgument(){var t=this._lexer.token,n=this.parseName();return this.expectToken(m.COLON),{kind:a.a.ARGUMENT,name:n,value:this.parseValueLiteral(!1),loc:this.loc(t)}},t.parseConstArgument=function parseConstArgument(){var t=this._lexer.token;return{kind:a.a.ARGUMENT,name:this.parseName(),value:(this.expectToken(m.COLON),this.parseValueLiteral(!0)),loc:this.loc(t)}},t.parseFragment=function parseFragment(){var t=this._lexer.token;this.expectToken(m.SPREAD);var n=this.expectOptionalKeyword("on");return!n&&this.peek(m.NAME)?{kind:a.a.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(t)}:{kind:a.a.INLINE_FRAGMENT,typeCondition:n?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}},t.parseFragmentDefinition=function parseFragmentDefinition(){var t,n=this._lexer.token;return this.expectKeyword("fragment"),!0===(null===(t=this._options)||void 0===t?void 0:t.experimentalFragmentVariables)?{kind:a.a.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(n)}:{kind:a.a.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(n)}},t.parseFragmentName=function parseFragmentName(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()},t.parseValueLiteral=function parseValueLiteral(t){var n=this._lexer.token;switch(n.kind){case m.BRACKET_L:return this.parseList(t);case m.BRACE_L:return this.parseObject(t);case m.INT:return this._lexer.advance(),{kind:a.a.INT,value:n.value,loc:this.loc(n)};case m.FLOAT:return this._lexer.advance(),{kind:a.a.FLOAT,value:n.value,loc:this.loc(n)};case m.STRING:case m.BLOCK_STRING:return this.parseStringLiteral();case m.NAME:switch(this._lexer.advance(),n.value){case"true":return{kind:a.a.BOOLEAN,value:!0,loc:this.loc(n)};case"false":return{kind:a.a.BOOLEAN,value:!1,loc:this.loc(n)};case"null":return{kind:a.a.NULL,loc:this.loc(n)};default:return{kind:a.a.ENUM,value:n.value,loc:this.loc(n)}}case m.DOLLAR:if(!t)return this.parseVariable()}throw this.unexpected()},t.parseStringLiteral=function parseStringLiteral(){var t=this._lexer.token;return this._lexer.advance(),{kind:a.a.STRING,value:t.value,block:t.kind===m.BLOCK_STRING,loc:this.loc(t)}},t.parseList=function parseList(t){var n=this,i=this._lexer.token;return{kind:a.a.LIST,values:this.any(m.BRACKET_L,(function item(){return n.parseValueLiteral(t)}),m.BRACKET_R),loc:this.loc(i)}},t.parseObject=function parseObject(t){var n=this,i=this._lexer.token;return{kind:a.a.OBJECT,fields:this.any(m.BRACE_L,(function item(){return n.parseObjectField(t)}),m.BRACE_R),loc:this.loc(i)}},t.parseObjectField=function parseObjectField(t){var n=this._lexer.token,i=this.parseName();return this.expectToken(m.COLON),{kind:a.a.OBJECT_FIELD,name:i,value:this.parseValueLiteral(t),loc:this.loc(n)}},t.parseDirectives=function parseDirectives(t){for(var n=[];this.peek(m.AT);)n.push(this.parseDirective(t));return n},t.parseDirective=function parseDirective(t){var n=this._lexer.token;return this.expectToken(m.AT),{kind:a.a.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(t),loc:this.loc(n)}},t.parseTypeReference=function parseTypeReference(){var t,n=this._lexer.token;return this.expectOptionalToken(m.BRACKET_L)?(t=this.parseTypeReference(),this.expectToken(m.BRACKET_R),t={kind:a.a.LIST_TYPE,type:t,loc:this.loc(n)}):t=this.parseNamedType(),this.expectOptionalToken(m.BANG)?{kind:a.a.NON_NULL_TYPE,type:t,loc:this.loc(n)}:t},t.parseNamedType=function parseNamedType(){var t=this._lexer.token;return{kind:a.a.NAMED_TYPE,name:this.parseName(),loc:this.loc(t)}},t.parseTypeSystemDefinition=function parseTypeSystemDefinition(){var t=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(t.kind===m.NAME)switch(t.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(t)},t.peekDescription=function peekDescription(){return this.peek(m.STRING)||this.peek(m.BLOCK_STRING)},t.parseDescription=function parseDescription(){if(this.peekDescription())return this.parseStringLiteral()},t.parseSchemaDefinition=function parseSchemaDefinition(){var t=this._lexer.token,n=this.parseDescription();this.expectKeyword("schema");var i=this.parseDirectives(!0),o=this.many(m.BRACE_L,this.parseOperationTypeDefinition,m.BRACE_R);return{kind:a.a.SCHEMA_DEFINITION,description:n,directives:i,operationTypes:o,loc:this.loc(t)}},t.parseOperationTypeDefinition=function parseOperationTypeDefinition(){var t=this._lexer.token,n=this.parseOperationType();this.expectToken(m.COLON);var i=this.parseNamedType();return{kind:a.a.OPERATION_TYPE_DEFINITION,operation:n,type:i,loc:this.loc(t)}},t.parseScalarTypeDefinition=function parseScalarTypeDefinition(){var t=this._lexer.token,n=this.parseDescription();this.expectKeyword("scalar");var i=this.parseName(),o=this.parseDirectives(!0);return{kind:a.a.SCALAR_TYPE_DEFINITION,description:n,name:i,directives:o,loc:this.loc(t)}},t.parseObjectTypeDefinition=function parseObjectTypeDefinition(){var t=this._lexer.token,n=this.parseDescription();this.expectKeyword("type");var i=this.parseName(),o=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),m=this.parseFieldsDefinition();return{kind:a.a.OBJECT_TYPE_DEFINITION,description:n,name:i,interfaces:o,directives:s,fields:m,loc:this.loc(t)}},t.parseImplementsInterfaces=function parseImplementsInterfaces(){var t;if(!this.expectOptionalKeyword("implements"))return[];if(!0===(null===(t=this._options)||void 0===t?void 0:t.allowLegacySDLImplementsInterfaces)){var n=[];this.expectOptionalToken(m.AMP);do{n.push(this.parseNamedType())}while(this.expectOptionalToken(m.AMP)||this.peek(m.NAME));return n}return this.delimitedMany(m.AMP,this.parseNamedType)},t.parseFieldsDefinition=function parseFieldsDefinition(){var t;return!0===(null===(t=this._options)||void 0===t?void 0:t.allowLegacySDLEmptyFields)&&this.peek(m.BRACE_L)&&this._lexer.lookahead().kind===m.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(m.BRACE_L,this.parseFieldDefinition,m.BRACE_R)},t.parseFieldDefinition=function parseFieldDefinition(){var t=this._lexer.token,n=this.parseDescription(),i=this.parseName(),o=this.parseArgumentDefs();this.expectToken(m.COLON);var s=this.parseTypeReference(),g=this.parseDirectives(!0);return{kind:a.a.FIELD_DEFINITION,description:n,name:i,arguments:o,type:s,directives:g,loc:this.loc(t)}},t.parseArgumentDefs=function parseArgumentDefs(){return this.optionalMany(m.PAREN_L,this.parseInputValueDef,m.PAREN_R)},t.parseInputValueDef=function parseInputValueDef(){var t=this._lexer.token,n=this.parseDescription(),i=this.parseName();this.expectToken(m.COLON);var o,s=this.parseTypeReference();this.expectOptionalToken(m.EQUALS)&&(o=this.parseValueLiteral(!0));var g=this.parseDirectives(!0);return{kind:a.a.INPUT_VALUE_DEFINITION,description:n,name:i,type:s,defaultValue:o,directives:g,loc:this.loc(t)}},t.parseInterfaceTypeDefinition=function parseInterfaceTypeDefinition(){var t=this._lexer.token,n=this.parseDescription();this.expectKeyword("interface");var i=this.parseName(),o=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),m=this.parseFieldsDefinition();return{kind:a.a.INTERFACE_TYPE_DEFINITION,description:n,name:i,interfaces:o,directives:s,fields:m,loc:this.loc(t)}},t.parseUnionTypeDefinition=function parseUnionTypeDefinition(){var t=this._lexer.token,n=this.parseDescription();this.expectKeyword("union");var i=this.parseName(),o=this.parseDirectives(!0),s=this.parseUnionMemberTypes();return{kind:a.a.UNION_TYPE_DEFINITION,description:n,name:i,directives:o,types:s,loc:this.loc(t)}},t.parseUnionMemberTypes=function parseUnionMemberTypes(){return this.expectOptionalToken(m.EQUALS)?this.delimitedMany(m.PIPE,this.parseNamedType):[]},t.parseEnumTypeDefinition=function parseEnumTypeDefinition(){var t=this._lexer.token,n=this.parseDescription();this.expectKeyword("enum");var i=this.parseName(),o=this.parseDirectives(!0),s=this.parseEnumValuesDefinition();return{kind:a.a.ENUM_TYPE_DEFINITION,description:n,name:i,directives:o,values:s,loc:this.loc(t)}},t.parseEnumValuesDefinition=function parseEnumValuesDefinition(){return this.optionalMany(m.BRACE_L,this.parseEnumValueDefinition,m.BRACE_R)},t.parseEnumValueDefinition=function parseEnumValueDefinition(){var t=this._lexer.token,n=this.parseDescription(),i=this.parseName(),o=this.parseDirectives(!0);return{kind:a.a.ENUM_VALUE_DEFINITION,description:n,name:i,directives:o,loc:this.loc(t)}},t.parseInputObjectTypeDefinition=function parseInputObjectTypeDefinition(){var t=this._lexer.token,n=this.parseDescription();this.expectKeyword("input");var i=this.parseName(),o=this.parseDirectives(!0),s=this.parseInputFieldsDefinition();return{kind:a.a.INPUT_OBJECT_TYPE_DEFINITION,description:n,name:i,directives:o,fields:s,loc:this.loc(t)}},t.parseInputFieldsDefinition=function parseInputFieldsDefinition(){return this.optionalMany(m.BRACE_L,this.parseInputValueDef,m.BRACE_R)},t.parseTypeSystemExtension=function parseTypeSystemExtension(){var t=this._lexer.lookahead();if(t.kind===m.NAME)switch(t.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(t)},t.parseSchemaExtension=function parseSchemaExtension(){var t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var n=this.parseDirectives(!0),i=this.optionalMany(m.BRACE_L,this.parseOperationTypeDefinition,m.BRACE_R);if(0===n.length&&0===i.length)throw this.unexpected();return{kind:a.a.SCHEMA_EXTENSION,directives:n,operationTypes:i,loc:this.loc(t)}},t.parseScalarTypeExtension=function parseScalarTypeExtension(){var t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var n=this.parseName(),i=this.parseDirectives(!0);if(0===i.length)throw this.unexpected();return{kind:a.a.SCALAR_TYPE_EXTENSION,name:n,directives:i,loc:this.loc(t)}},t.parseObjectTypeExtension=function parseObjectTypeExtension(){var t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var n=this.parseName(),i=this.parseImplementsInterfaces(),o=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===o.length&&0===s.length)throw this.unexpected();return{kind:a.a.OBJECT_TYPE_EXTENSION,name:n,interfaces:i,directives:o,fields:s,loc:this.loc(t)}},t.parseInterfaceTypeExtension=function parseInterfaceTypeExtension(){var t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var n=this.parseName(),i=this.parseImplementsInterfaces(),o=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===o.length&&0===s.length)throw this.unexpected();return{kind:a.a.INTERFACE_TYPE_EXTENSION,name:n,interfaces:i,directives:o,fields:s,loc:this.loc(t)}},t.parseUnionTypeExtension=function parseUnionTypeExtension(){var t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var n=this.parseName(),i=this.parseDirectives(!0),o=this.parseUnionMemberTypes();if(0===i.length&&0===o.length)throw this.unexpected();return{kind:a.a.UNION_TYPE_EXTENSION,name:n,directives:i,types:o,loc:this.loc(t)}},t.parseEnumTypeExtension=function parseEnumTypeExtension(){var t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var n=this.parseName(),i=this.parseDirectives(!0),o=this.parseEnumValuesDefinition();if(0===i.length&&0===o.length)throw this.unexpected();return{kind:a.a.ENUM_TYPE_EXTENSION,name:n,directives:i,values:o,loc:this.loc(t)}},t.parseInputObjectTypeExtension=function parseInputObjectTypeExtension(){var t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var n=this.parseName(),i=this.parseDirectives(!0),o=this.parseInputFieldsDefinition();if(0===i.length&&0===o.length)throw this.unexpected();return{kind:a.a.INPUT_OBJECT_TYPE_EXTENSION,name:n,directives:i,fields:o,loc:this.loc(t)}},t.parseDirectiveDefinition=function parseDirectiveDefinition(){var t=this._lexer.token,n=this.parseDescription();this.expectKeyword("directive"),this.expectToken(m.AT);var i=this.parseName(),o=this.parseArgumentDefs(),s=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var g=this.parseDirectiveLocations();return{kind:a.a.DIRECTIVE_DEFINITION,description:n,name:i,arguments:o,repeatable:s,locations:g,loc:this.loc(t)}},t.parseDirectiveLocations=function parseDirectiveLocations(){return this.delimitedMany(m.PIPE,this.parseDirectiveLocation)},t.parseDirectiveLocation=function parseDirectiveLocation(){var t=this._lexer.token,n=this.parseName();if(void 0!==O[n.value])return n;throw this.unexpected(t)},t.loc=function loc(t){var n;if(!0!==(null===(n=this._options)||void 0===n?void 0:n.noLocation))return new s.a(t,this._lexer.lastToken,this._lexer.source)},t.peek=function peek(t){return this._lexer.token.kind===t},t.expectToken=function expectToken(t){var n=this._lexer.token;if(n.kind===t)return this._lexer.advance(),n;throw syntaxError(this._lexer.source,n.start,"Expected ".concat(getTokenKindDesc(t),", found ").concat(getTokenDesc(n),"."))},t.expectOptionalToken=function expectOptionalToken(t){var n=this._lexer.token;if(n.kind===t)return this._lexer.advance(),n},t.expectKeyword=function expectKeyword(t){var n=this._lexer.token;if(n.kind!==m.NAME||n.value!==t)throw syntaxError(this._lexer.source,n.start,'Expected "'.concat(t,'", found ').concat(getTokenDesc(n),"."));this._lexer.advance()},t.expectOptionalKeyword=function expectOptionalKeyword(t){var n=this._lexer.token;return n.kind===m.NAME&&n.value===t&&(this._lexer.advance(),!0)},t.unexpected=function unexpected(t){var n=null!=t?t:this._lexer.token;return syntaxError(this._lexer.source,n.start,"Unexpected ".concat(getTokenDesc(n),"."))},t.any=function any(t,n,i){this.expectToken(t);for(var o=[];!this.expectOptionalToken(i);)o.push(n.call(this));return o},t.optionalMany=function optionalMany(t,n,i){if(this.expectOptionalToken(t)){var o=[];do{o.push(n.call(this))}while(!this.expectOptionalToken(i));return o}return[]},t.many=function many(t,n,i){this.expectToken(t);var o=[];do{o.push(n.call(this))}while(!this.expectOptionalToken(i));return o},t.delimitedMany=function delimitedMany(t,n){this.expectOptionalToken(t);var i=[];do{i.push(n.call(this))}while(this.expectOptionalToken(t));return i},Parser}();function getTokenDesc(t){var n=t.value;return getTokenKindDesc(t.kind)+(null!=n?' "'.concat(n,'"'):"")}function getTokenKindDesc(t){return function isPunctuatorTokenKind(t){return t===m.BANG||t===m.DOLLAR||t===m.AMP||t===m.PAREN_L||t===m.PAREN_R||t===m.SPREAD||t===m.COLON||t===m.EQUALS||t===m.AT||t===m.BRACKET_L||t===m.BRACKET_R||t===m.BRACE_L||t===m.PIPE||t===m.BRACE_R}(t)?'"'.concat(t,'"'):t}var R=new Map,N=new Map,I=!0,j=!1;function normalize(t){return t.replace(/[\s,]+/g," ").trim()}function processFragments(t){var n=new Set,i=[];return t.definitions.forEach((function(t){if("FragmentDefinition"===t.kind){var o=t.name.value,a=function cacheKeyFromLoc(t){return normalize(t.source.body.substring(t.start,t.end))}(t.loc),s=N.get(o);s&&!s.has(a)?I&&console.warn("Warning: fragment with name "+o+" already exists.\ngraphql-tag enforces all fragment names across your application to be unique; read more about\nthis in the docs: http://dev.apollodata.com/core/fragments.html#unique-names"):s||N.set(o,s=new Set),s.add(a),n.has(a)||(n.add(a),i.push(t))}else i.push(t)})),__assign(__assign({},t),{definitions:i})}function lib_parseDocument(t){var n=normalize(t);if(!R.has(n)){var i=function parse(t,n){return new L(t,n).parseDocument()}(t,{experimentalFragmentVariables:j});if(!i||"Document"!==i.kind)throw new Error("Not a valid GraphQL document.");R.set(n,function stripLoc(t){var n=new Set(t.definitions);n.forEach((function(t){t.loc&&delete t.loc,Object.keys(t).forEach((function(i){var o=t[i];o&&"object"==typeof o&&n.add(o)}))}));var i=t.loc;return i&&(delete i.startToken,delete i.endToken),t}(processFragments(i)))}return R.get(n)}function gql(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];"string"==typeof t&&(t=[t]);var o=t[0];return n.forEach((function(n,i){n&&"Document"===n.kind?o+=n.loc.source.body:o+=n,o+=t[i+1]})),lib_parseDocument(o)}function resetCaches(){R.clear(),N.clear()}function disableFragmentWarnings(){I=!1}function enableExperimentalFragmentVariables(){j=!0}function disableExperimentalFragmentVariables(){j=!1}var V,U={gql,resetCaches,disableFragmentWarnings,enableExperimentalFragmentVariables,disableExperimentalFragmentVariables};(V=gql||(gql={})).gql=U.gql,V.resetCaches=U.resetCaches,V.disableFragmentWarnings=U.disableFragmentWarnings,V.enableExperimentalFragmentVariables=U.enableExperimentalFragmentVariables,V.disableExperimentalFragmentVariables=U.disableExperimentalFragmentVariables,gql.default=gql;n.default=gql},function(t,n,i){"use strict";function maybe(t){try{return t()}catch(t){}}i.d(n,"a",(function(){return maybe}))},function(t,n,i){"use strict";i.d(n,"c",(function(){return m})),i.d(n,"e",(function(){return g})),i.d(n,"f",(function(){return _})),i.d(n,"b",(function(){return S})),i.d(n,"d",(function(){return M.a})),i.d(n,"a",(function(){return s.a}));var o=i(1),a=i(29),s=i(9),m=s.a.empty,g=s.a.from,_=s.a.split,S=s.a.concat,M=i(109);__DEV__?Object(o.b)("boolean"==typeof a.a,a.a):Object(o.b)("boolean"==typeof a.a,24)},function(t,n){t.exports=function isObject(t){var n=typeof t;return null!=t&&("object"==n||"function"==n)}},function(t,n){t.exports=function isObjectLike(t){return null!=t&&"object"==typeof t}},function(t,n,i){"use strict";i.d(n,"f",(function(){return removeDirectivesFromDocument})),i.d(n,"a",(function(){return M})),i.d(n,"e",(function(){return removeConnectionDirectiveFromDocument})),i.d(n,"c",(function(){return removeArgumentsFromDocument})),i.d(n,"g",(function(){return removeFragmentSpreadFromDocument})),i.d(n,"b",(function(){return buildQueryFromSelectionSet})),i.d(n,"d",(function(){return removeClientSetsFromDocument}));var o=i(0),a=i(75),s=i(1),m=i(8);function filterInPlace(t,n,i){var o=0;return t.forEach((function(i,a){n.call(this,i,a,t)&&(t[o++]=i)}),i),t.length=o,t}var g=i(7),_=i(21),S={kind:"Field",name:{kind:"Name",value:"__typename"}};function nullIfDocIsEmpty(t){return function isEmpty(t,n){return t.selectionSet.selections.every((function(t){return"FragmentSpread"===t.kind&&isEmpty(n[t.name.value],n)}))}(Object(m.f)(t)||Object(m.c)(t),Object(_.a)(Object(m.d)(t)))?null:t}function getDirectiveMatcher(t){return function directiveMatcher(n){return t.some((function(t){return t.name&&t.name===n.name.value||t.test&&t.test(n)}))}}function removeDirectivesFromDocument(t,n){var i=Object.create(null),o=[],s=Object.create(null),m=[],_=nullIfDocIsEmpty(Object(a.b)(n,{Variable:{enter:function(t,n,o){"VariableDefinition"!==o.kind&&(i[t.name.value]=!0)}},Field:{enter:function(n){if(t&&n.directives&&(t.some((function(t){return t.remove}))&&n.directives&&n.directives.some(getDirectiveMatcher(t))))return n.arguments&&n.arguments.forEach((function(t){"Variable"===t.value.kind&&o.push({name:t.value.name.value})})),n.selectionSet&&function getAllFragmentSpreadsFromSelectionSet(t){var n=[];return t.selections.forEach((function(t){(Object(g.e)(t)||Object(g.f)(t))&&t.selectionSet?getAllFragmentSpreadsFromSelectionSet(t.selectionSet).forEach((function(t){return n.push(t)})):"FragmentSpread"===t.kind&&n.push(t)})),n}(n.selectionSet).forEach((function(t){m.push({name:t.name.value})})),null}},FragmentSpread:{enter:function(t){s[t.name.value]=!0}},Directive:{enter:function(n){if(getDirectiveMatcher(t)(n))return null}}}));return _&&filterInPlace(o,(function(t){return!!t.name&&!i[t.name]})).length&&(_=removeArgumentsFromDocument(o,_)),_&&filterInPlace(m,(function(t){return!!t.name&&!s[t.name]})).length&&(_=removeFragmentSpreadFromDocument(m,_)),_}var M=Object.assign((function(t){return Object(a.b)(Object(m.a)(t),{SelectionSet:{enter:function(t,n,i){if(!i||"OperationDefinition"!==i.kind){var a=t.selections;if(a)if(!a.some((function(t){return Object(g.e)(t)&&("__typename"===t.name.value||0===t.name.value.lastIndexOf("__",0))}))){var s=i;if(!(Object(g.e)(s)&&s.directives&&s.directives.some((function(t){return"export"===t.name.value}))))return Object(o.a)(Object(o.a)({},t),{selections:Object(o.f)(Object(o.f)([],a),[S])})}}}}})}),{added:function(t){return t===S}}),T={test:function(t){var n="connection"===t.name.value;return n&&(t.arguments&&t.arguments.some((function(t){return"key"===t.name.value}))||__DEV__&&s.b.warn("Removing an @connection directive even though it does not have a key. You may want to use the key parameter to specify a store key.")),n}};function removeConnectionDirectiveFromDocument(t){return removeDirectivesFromDocument([T],Object(m.a)(t))}function removeArgumentsFromDocument(t,n){var i=function getArgumentMatcher(t){return function argumentMatcher(n){return t.some((function(t){return n.value&&"Variable"===n.value.kind&&n.value.name&&(t.name===n.value.name.value||t.test&&t.test(n))}))}}(t);return nullIfDocIsEmpty(Object(a.b)(n,{OperationDefinition:{enter:function(n){return Object(o.a)(Object(o.a)({},n),{variableDefinitions:n.variableDefinitions?n.variableDefinitions.filter((function(n){return!t.some((function(t){return t.name===n.variable.name.value}))})):[]})}},Field:{enter:function(n){if(t.some((function(t){return t.remove}))){var o=0;if(n.arguments&&n.arguments.forEach((function(t){i(t)&&(o+=1)})),1===o)return null}}},Argument:{enter:function(t){if(i(t))return null}}}))}function removeFragmentSpreadFromDocument(t,n){function enter(n){if(t.some((function(t){return t.name===n.name.value})))return null}return nullIfDocIsEmpty(Object(a.b)(n,{FragmentSpread:{enter},FragmentDefinition:{enter}}))}function buildQueryFromSelectionSet(t){return"query"===Object(m.e)(t).operation?t:Object(a.b)(t,{OperationDefinition:{enter:function(t){return Object(o.a)(Object(o.a)({},t),{operation:"query"})}}})}function removeClientSetsFromDocument(t){Object(m.a)(t);var n=removeDirectivesFromDocument([{test:function(t){return"client"===t.name.value},remove:!0}],t);return n&&(n=Object(a.b)(n,{FragmentDefinition:{enter:function(t){if(t.selectionSet&&t.selectionSet.selections.every((function(t){return Object(g.e)(t)&&"__typename"===t.name.value})))return null}}})),n}},function(t,n,i){"use strict";i.d(n,"c",(function(){return getFragmentQueryDocument})),i.d(n,"a",(function(){return createFragmentMap})),i.d(n,"b",(function(){return getFragmentFromSelection}));var o=i(0),a=i(1);function getFragmentQueryDocument(t,n){var i=n,s=[];return t.definitions.forEach((function(t){if("OperationDefinition"===t.kind)throw __DEV__?new a.a("Found a "+t.operation+" operation"+(t.name?" named '"+t.name.value+"'":"")+". No operations are allowed when using a fragment as a query. Only fragments are allowed."):new a.a(47);"FragmentDefinition"===t.kind&&s.push(t)})),void 0===i&&(__DEV__?Object(a.b)(1===s.length,"Found "+s.length+" fragments. `fragmentName` must be provided when there is not exactly 1 fragment."):Object(a.b)(1===s.length,48),i=s[0].name.value),Object(o.a)(Object(o.a)({},t),{definitions:Object(o.f)([{kind:"OperationDefinition",operation:"query",selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:i}}]}}],t.definitions)})}function createFragmentMap(t){void 0===t&&(t=[]);var n={};return t.forEach((function(t){n[t.name.value]=t})),n}function getFragmentFromSelection(t,n){switch(t.kind){case"InlineFragment":return t;case"FragmentSpread":var i=n&&n[t.name.value];return __DEV__?Object(a.b)(i,"No fragment named "+t.name.value+"."):Object(a.b)(i,49),i;default:return null}}},function(t,n,i){"use strict";i.d(n,"a",(function(){return s}));var o=i(47),a=i(11);function getLocation(t,n){for(var i,o=/\r\n|[\n\r]/g,a=1,s=n+1;(i=o.exec(t.body))&&i.index<n;)a+=1,s=n+1-(i.index+i[0].length);return{line:a,column:s}}function printLocation(t){return printSourceLocation(t.source,getLocation(t.source,t.start))}function printSourceLocation(t,n){var i=t.locationOffset.column-1,o=whitespace(i)+t.body,a=n.line-1,s=t.locationOffset.line-1,m=n.line+s,g=1===n.line?i:0,_=n.column+g,S="".concat(t.name,":").concat(m,":").concat(_,"\n"),M=o.split(/\r\n|[\n\r]/g),T=M[a];if(T.length>120){for(var O=Math.floor(_/80),A=_%80,P=[],L=0;L<T.length;L+=80)P.push(T.slice(L,L+80));return S+printPrefixedLines([["".concat(m),P[0]]].concat(P.slice(1,O+1).map((function(t){return["",t]})),[[" ",whitespace(A-1)+"^"],["",P[O+1]]]))}return S+printPrefixedLines([["".concat(m-1),M[a-1]],["".concat(m),T],["",whitespace(_-1)+"^"],["".concat(m+1),M[a+1]]])}function printPrefixedLines(t){var n=t.filter((function(t){t[0];return void 0!==t[1]})),i=Math.max.apply(Math,n.map((function(t){return t[0].length})));return n.map((function(t){var n=t[0],o=t[1];return function leftPad(t,n){return whitespace(t-n.length)+n}(i,n)+(o?" | "+o:" |")})).join("\n")}function whitespace(t){return Array(t+1).join(" ")}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?_assertThisInitialized(t):n}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,Wrapper)}function Wrapper(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,t)})(t)}function _construct(t,n,i){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function _construct(t,n,i){var o=[null];o.push.apply(o,n);var a=new(Function.bind.apply(t,o));return i&&_setPrototypeOf(a,i.prototype),a}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,n){return t.__proto__=n,t})(t,n)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var s=function(t){!function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_setPrototypeOf(t,n)}(GraphQLError,t);var n=function _createSuper(t){var n=_isNativeReflectConstruct();return function _createSuperInternal(){var i,o=_getPrototypeOf(t);if(n){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}(GraphQLError);function GraphQLError(t,i,a,s,m,g,_){var S,M,T,O,A;!function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,GraphQLError),A=n.call(this,t);var P,L=Array.isArray(i)?0!==i.length?i:void 0:i?[i]:void 0,R=a;!R&&L&&(R=null===(P=L[0].loc)||void 0===P?void 0:P.source);var N,I=s;!I&&L&&(I=L.reduce((function(t,n){return n.loc&&t.push(n.loc.start),t}),[])),I&&0===I.length&&(I=void 0),s&&a?N=s.map((function(t){return getLocation(a,t)})):L&&(N=L.reduce((function(t,n){return n.loc&&t.push(getLocation(n.loc.source,n.loc.start)),t}),[]));var j=_;if(null==j&&null!=g){var V=g.extensions;Object(o.a)(V)&&(j=V)}return Object.defineProperties(_assertThisInitialized(A),{name:{value:"GraphQLError"},message:{value:t,enumerable:!0,writable:!0},locations:{value:null!==(S=N)&&void 0!==S?S:void 0,enumerable:null!=N},path:{value:null!=m?m:void 0,enumerable:null!=m},nodes:{value:null!=L?L:void 0},source:{value:null!==(M=R)&&void 0!==M?M:void 0},positions:{value:null!==(T=I)&&void 0!==T?T:void 0},originalError:{value:g},extensions:{value:null!==(O=j)&&void 0!==O?O:void 0,enumerable:null!=j}}),null!=g&&g.stack?(Object.defineProperty(_assertThisInitialized(A),"stack",{value:g.stack,writable:!0,configurable:!0}),_possibleConstructorReturn(A)):(Error.captureStackTrace?Error.captureStackTrace(_assertThisInitialized(A),GraphQLError):Object.defineProperty(_assertThisInitialized(A),"stack",{value:Error().stack,writable:!0,configurable:!0}),A)}return function _createClass(t,n,i){return n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i),t}(GraphQLError,[{key:"toString",value:function toString(){return function printError(t){var n=t.message;if(t.nodes)for(var i=0,o=t.nodes;i<o.length;i++){var a=o[i];a.loc&&(n+="\n\n"+printLocation(a.loc))}else if(t.source&&t.locations)for(var s=0,m=t.locations;s<m.length;s++){var g=m[s];n+="\n\n"+printSourceLocation(t.source,g)}return n}(this)}},{key:a.a,get:function get(){return"Object"}}]),GraphQLError}(_wrapNativeSuper(Error))},function(t,n,i){var o=i(137),a=i(142);t.exports=function getNative(t,n){var i=a(t,n);return o(i)?i:void 0}},function(t,n){var i=Array.isArray;t.exports=i},,function(t,n,i){var o=i(31),a=i(138),s=i(139),m=o?o.toStringTag:void 0;t.exports=function baseGetTag(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":m&&m in Object(t)?a(t):s(t)}},function(t,n,i){"use strict";i.d(n,"e",(function(){return shouldInclude})),i.d(n,"a",(function(){return getDirectiveNames})),i.d(n,"d",(function(){return hasDirectives})),i.d(n,"c",(function(){return hasClientExports})),i.d(n,"b",(function(){return getInclusionDirectives}));var o=i(75),a=i(1);function shouldInclude(t,n){var i=t.directives;return!i||!i.length||getInclusionDirectives(i).every((function(t){var i=t.directive,o=t.ifArgument,s=!1;return"Variable"===o.value.kind?(s=n&&n[o.value.name.value],__DEV__?Object(a.b)(void 0!==s,"Invalid variable referenced in @"+i.name.value+" directive."):Object(a.b)(void 0!==s,43)):s=o.value.value,"skip"===i.name.value?!s:s}))}function getDirectiveNames(t){var n=[];return Object(o.b)(t,{Directive:function(t){n.push(t.name.value)}}),n}function hasDirectives(t,n){return getDirectiveNames(n).some((function(n){return t.indexOf(n)>-1}))}function hasClientExports(t){return t&&hasDirectives(["client"],t)&&hasDirectives(["export"],t)}function getInclusionDirectives(t){var n=[];return t&&t.length&&t.forEach((function(t){if(function isInclusionDirective(t){var n=t.name.value;return"skip"===n||"include"===n}(t)){var i=t.arguments,o=t.name.value;__DEV__?Object(a.b)(i&&1===i.length,"Incorrect number of arguments for the @"+o+" directive."):Object(a.b)(i&&1===i.length,44);var s=i[0];__DEV__?Object(a.b)(s.name&&"if"===s.name.value,"Invalid argument for the @"+o+" directive."):Object(a.b)(s.name&&"if"===s.name.value,45);var m=s.value;__DEV__?Object(a.b)(m&&("Variable"===m.kind||"BooleanValue"===m.kind),"Argument for the @"+o+" directive must be a variable or a boolean value."):Object(a.b)(m&&("Variable"===m.kind||"BooleanValue"===m.kind),46),n.push({directive:t,ifArgument:s})}})),n}},function(t,n,i){"use strict";function iterateObserversSafely(t,n,i){var o=[];t.forEach((function(t){return t[n]&&o.push(t)})),o.forEach((function(t){return t[n](i)}))}i.d(n,"a",(function(){return iterateObserversSafely}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return g}));var o=i(76),a=i(16),s="__",m=[s,s].join("DEV");var g=function getDEV(){try{return Boolean(__DEV__)}catch(t){return Object.defineProperty(o.a,m,{value:"production"!==Object(a.a)((function(){return"production"})),enumerable:!1,configurable:!0,writable:!0}),o.a[m]}}(),_=i(119),S=Object.entries||function(t){return Object.keys(t).map((function(n){return[n,t[n]]}))},M=i(11),T=i(3);function mapValue(t,n){for(var i=Object.create(null),o=0,a=S(t);o<a.length;o++){var s=a[o],m=s[0],g=s[1];i[m]=n(g,m)}return i}function toObjMap(t){if(null===Object.getPrototypeOf(t))return t;for(var n=Object.create(null),i=0,o=S(t);i<o.length;i++){var a=o[i],s=a[0],m=a[1];n[s]=m}return n}var O=i(4);function keyValMap(t,n,i){return t.reduce((function(t,o){return t[n(o)]=i(o),t}),Object.create(null))}var A=i(13);var P=i(47);function identityFunc(t){return t}var L=i(12);var R=48;function isDigit(t){return!isNaN(t)&&R<=t&&t<=57}function suggestionList(t,n){for(var i=Object.create(null),o=new N(t),a=Math.floor(.4*t.length)+1,s=0;s<n.length;s++){var m=n[s],g=o.measure(m,a);void 0!==g&&(i[m]=g)}return Object.keys(i).sort((function(t,n){var o=i[t]-i[n];return 0!==o?o:function naturalCompare(t,n){for(var i=0,o=0;i<t.length&&o<n.length;){var a=t.charCodeAt(i),s=n.charCodeAt(o);if(isDigit(a)&&isDigit(s)){var m=0;do{++i,m=10*m+a-R,a=t.charCodeAt(i)}while(isDigit(a)&&m>0);var g=0;do{++o,g=10*g+s-R,s=n.charCodeAt(o)}while(isDigit(s)&&g>0);if(m<g)return-1;if(m>g)return 1}else{if(a<s)return-1;if(a>s)return 1;++i,++o}}return t.length-n.length}(t,n)}))}var N=function(){function LexicalDistance(t){this._input=t,this._inputLowerCase=t.toLowerCase(),this._inputArray=stringToArray(this._inputLowerCase),this._rows=[new Array(t.length+1).fill(0),new Array(t.length+1).fill(0),new Array(t.length+1).fill(0)]}return LexicalDistance.prototype.measure=function measure(t,n){if(this._input===t)return 0;var i=t.toLowerCase();if(this._inputLowerCase===i)return 1;var o=stringToArray(i),a=this._inputArray;if(o.length<a.length){var s=o;o=a,a=s}var m=o.length,g=a.length;if(!(m-g>n)){for(var _=this._rows,S=0;S<=g;S++)_[0][S]=S;for(var M=1;M<=m;M++){for(var T=_[(M-1)%3],O=_[M%3],A=O[0]=M,P=1;P<=g;P++){var L=o[M-1]===a[P-1]?0:1,R=Math.min(T[P]+1,O[P-1]+1,T[P-1]+L);if(M>1&&P>1&&o[M-1]===a[P-2]&&o[M-2]===a[P-1]){var N=_[(M-2)%3][P-2];R=Math.min(R,N+1)}R<A&&(A=R),O[P]=R}if(A>n)return}var I=_[m%3][g];return I<=n?I:void 0}},LexicalDistance}();function stringToArray(t){for(var n=t.length,i=new Array(n),o=0;o<n;++o)i[o]=t.charCodeAt(o);return i}var I=i(22),j=i(2),V=i(74),U=i(46);function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,n,i){return n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i),t}function isType(t){return isScalarType(t)||isObjectType(t)||isInterfaceType(t)||isUnionType(t)||isEnumType(t)||isInputObjectType(t)||isListType(t)||isNonNullType(t)}function isScalarType(t){return Object(A.a)(t,G)}function isObjectType(t){return Object(A.a)(t,z)}function isInterfaceType(t){return Object(A.a)(t,H)}function isUnionType(t){return Object(A.a)(t,q)}function isEnumType(t){return Object(A.a)(t,Z)}function isInputObjectType(t){return Object(A.a)(t,X)}function isListType(t){return Object(A.a)(t,GraphQLList)}function isNonNullType(t){return Object(A.a)(t,GraphQLNonNull)}function GraphQLList(t){if(!(this instanceof GraphQLList))return new GraphQLList(t);this.ofType=function assertType(t){if(!isType(t))throw new Error("Expected ".concat(Object(T.a)(t)," to be a GraphQL type."));return t}(t)}function GraphQLNonNull(t){if(!(this instanceof GraphQLNonNull))return new GraphQLNonNull(t);this.ofType=function assertNullableType(t){if(!function isNullableType(t){return isType(t)&&!isNonNullType(t)}(t))throw new Error("Expected ".concat(Object(T.a)(t)," to be a GraphQL nullable type."));return t}(t)}function resolveThunk(t){return"function"==typeof t?t():t}function undefineIfEmpty(t){return t&&t.length>0?t:void 0}GraphQLList.prototype.toString=function toString(){return"["+String(this.ofType)+"]"},GraphQLList.prototype.toJSON=function toJSON(){return this.toString()},Object.defineProperty(GraphQLList.prototype,M.a,{get:function get(){return"GraphQLList"}}),Object(L.a)(GraphQLList),GraphQLNonNull.prototype.toString=function toString(){return String(this.ofType)+"!"},GraphQLNonNull.prototype.toJSON=function toJSON(){return this.toString()},Object.defineProperty(GraphQLNonNull.prototype,M.a,{get:function get(){return"GraphQLNonNull"}}),Object(L.a)(GraphQLNonNull);var G=function(){function GraphQLScalarType(t){var n,i,o,a=null!==(n=t.parseValue)&&void 0!==n?n:identityFunc;this.name=t.name,this.description=t.description,this.specifiedByUrl=t.specifiedByUrl,this.serialize=null!==(i=t.serialize)&&void 0!==i?i:identityFunc,this.parseValue=a,this.parseLiteral=null!==(o=t.parseLiteral)&&void 0!==o?o:function(t,n){return a(function valueFromASTUntyped(t,n){switch(t.kind){case j.a.NULL:return null;case j.a.INT:return parseInt(t.value,10);case j.a.FLOAT:return parseFloat(t.value);case j.a.STRING:case j.a.ENUM:case j.a.BOOLEAN:return t.value;case j.a.LIST:return t.values.map((function(t){return valueFromASTUntyped(t,n)}));case j.a.OBJECT:return keyValMap(t.fields,(function(t){return t.name.value}),(function(t){return valueFromASTUntyped(t.value,n)}));case j.a.VARIABLE:return null==n?void 0:n[t.name.value]}Object(U.a)(0,"Unexpected value node: "+Object(T.a)(t))}(t,n))},this.extensions=t.extensions&&toObjMap(t.extensions),this.astNode=t.astNode,this.extensionASTNodes=undefineIfEmpty(t.extensionASTNodes),"string"==typeof t.name||Object(O.a)(0,"Must provide name."),null==t.specifiedByUrl||"string"==typeof t.specifiedByUrl||Object(O.a)(0,"".concat(this.name,' must provide "specifiedByUrl" as a string, ')+"but got: ".concat(Object(T.a)(t.specifiedByUrl),".")),null==t.serialize||"function"==typeof t.serialize||Object(O.a)(0,"".concat(this.name,' must provide "serialize" function. If this custom Scalar is also used as an input type, ensure "parseValue" and "parseLiteral" functions are also provided.')),t.parseLiteral&&("function"==typeof t.parseValue&&"function"==typeof t.parseLiteral||Object(O.a)(0,"".concat(this.name,' must provide both "parseValue" and "parseLiteral" functions.')))}var t=GraphQLScalarType.prototype;return t.toConfig=function toConfig(){var t;return{name:this.name,description:this.description,specifiedByUrl:this.specifiedByUrl,serialize:this.serialize,parseValue:this.parseValue,parseLiteral:this.parseLiteral,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:null!==(t=this.extensionASTNodes)&&void 0!==t?t:[]}},t.toString=function toString(){return this.name},t.toJSON=function toJSON(){return this.toString()},_createClass(GraphQLScalarType,[{key:M.a,get:function get(){return"GraphQLScalarType"}}]),GraphQLScalarType}();Object(L.a)(G);var z=function(){function GraphQLObjectType(t){this.name=t.name,this.description=t.description,this.isTypeOf=t.isTypeOf,this.extensions=t.extensions&&toObjMap(t.extensions),this.astNode=t.astNode,this.extensionASTNodes=undefineIfEmpty(t.extensionASTNodes),this._fields=defineFieldMap.bind(void 0,t),this._interfaces=defineInterfaces.bind(void 0,t),"string"==typeof t.name||Object(O.a)(0,"Must provide name."),null==t.isTypeOf||"function"==typeof t.isTypeOf||Object(O.a)(0,"".concat(this.name,' must provide "isTypeOf" as a function, ')+"but got: ".concat(Object(T.a)(t.isTypeOf),"."))}var t=GraphQLObjectType.prototype;return t.getFields=function getFields(){return"function"==typeof this._fields&&(this._fields=this._fields()),this._fields},t.getInterfaces=function getInterfaces(){return"function"==typeof this._interfaces&&(this._interfaces=this._interfaces()),this._interfaces},t.toConfig=function toConfig(){return{name:this.name,description:this.description,interfaces:this.getInterfaces(),fields:fieldsToFieldsConfig(this.getFields()),isTypeOf:this.isTypeOf,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:this.extensionASTNodes||[]}},t.toString=function toString(){return this.name},t.toJSON=function toJSON(){return this.toString()},_createClass(GraphQLObjectType,[{key:M.a,get:function get(){return"GraphQLObjectType"}}]),GraphQLObjectType}();function defineInterfaces(t){var n,i=null!==(n=resolveThunk(t.interfaces))&&void 0!==n?n:[];return Array.isArray(i)||Object(O.a)(0,"".concat(t.name," interfaces must be an Array or a function which returns an Array.")),i}function defineFieldMap(t){var n=resolveThunk(t.fields);return isPlainObj(n)||Object(O.a)(0,"".concat(t.name," fields must be an object with field names as keys or a function which returns such an object.")),mapValue(n,(function(n,i){var o;isPlainObj(n)||Object(O.a)(0,"".concat(t.name,".").concat(i," field config must be an object.")),!("isDeprecated"in n)||Object(O.a)(0,"".concat(t.name,".").concat(i,' should provide "deprecationReason" instead of "isDeprecated".')),null==n.resolve||"function"==typeof n.resolve||Object(O.a)(0,"".concat(t.name,".").concat(i," field resolver must be a function if ")+"provided, but got: ".concat(Object(T.a)(n.resolve),"."));var a=null!==(o=n.args)&&void 0!==o?o:{};isPlainObj(a)||Object(O.a)(0,"".concat(t.name,".").concat(i," args must be an object with argument names as keys."));var s=S(a).map((function(t){var n=t[0],i=t[1];return{name:n,description:i.description,type:i.type,defaultValue:i.defaultValue,deprecationReason:i.deprecationReason,extensions:i.extensions&&toObjMap(i.extensions),astNode:i.astNode}}));return{name:i,description:n.description,type:n.type,args:s,resolve:n.resolve,subscribe:n.subscribe,isDeprecated:null!=n.deprecationReason,deprecationReason:n.deprecationReason,extensions:n.extensions&&toObjMap(n.extensions),astNode:n.astNode}}))}function isPlainObj(t){return Object(P.a)(t)&&!Array.isArray(t)}function fieldsToFieldsConfig(t){return mapValue(t,(function(t){return{description:t.description,type:t.type,args:(n=t.args,keyValMap(n,(function(t){return t.name}),(function(t){return{description:t.description,type:t.type,defaultValue:t.defaultValue,deprecationReason:t.deprecationReason,extensions:t.extensions,astNode:t.astNode}}))),resolve:t.resolve,subscribe:t.subscribe,deprecationReason:t.deprecationReason,extensions:t.extensions,astNode:t.astNode};var n}))}Object(L.a)(z);var H=function(){function GraphQLInterfaceType(t){this.name=t.name,this.description=t.description,this.resolveType=t.resolveType,this.extensions=t.extensions&&toObjMap(t.extensions),this.astNode=t.astNode,this.extensionASTNodes=undefineIfEmpty(t.extensionASTNodes),this._fields=defineFieldMap.bind(void 0,t),this._interfaces=defineInterfaces.bind(void 0,t),"string"==typeof t.name||Object(O.a)(0,"Must provide name."),null==t.resolveType||"function"==typeof t.resolveType||Object(O.a)(0,"".concat(this.name,' must provide "resolveType" as a function, ')+"but got: ".concat(Object(T.a)(t.resolveType),"."))}var t=GraphQLInterfaceType.prototype;return t.getFields=function getFields(){return"function"==typeof this._fields&&(this._fields=this._fields()),this._fields},t.getInterfaces=function getInterfaces(){return"function"==typeof this._interfaces&&(this._interfaces=this._interfaces()),this._interfaces},t.toConfig=function toConfig(){var t;return{name:this.name,description:this.description,interfaces:this.getInterfaces(),fields:fieldsToFieldsConfig(this.getFields()),resolveType:this.resolveType,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:null!==(t=this.extensionASTNodes)&&void 0!==t?t:[]}},t.toString=function toString(){return this.name},t.toJSON=function toJSON(){return this.toString()},_createClass(GraphQLInterfaceType,[{key:M.a,get:function get(){return"GraphQLInterfaceType"}}]),GraphQLInterfaceType}();Object(L.a)(H);var q=function(){function GraphQLUnionType(t){this.name=t.name,this.description=t.description,this.resolveType=t.resolveType,this.extensions=t.extensions&&toObjMap(t.extensions),this.astNode=t.astNode,this.extensionASTNodes=undefineIfEmpty(t.extensionASTNodes),this._types=defineTypes.bind(void 0,t),"string"==typeof t.name||Object(O.a)(0,"Must provide name."),null==t.resolveType||"function"==typeof t.resolveType||Object(O.a)(0,"".concat(this.name,' must provide "resolveType" as a function, ')+"but got: ".concat(Object(T.a)(t.resolveType),"."))}var t=GraphQLUnionType.prototype;return t.getTypes=function getTypes(){return"function"==typeof this._types&&(this._types=this._types()),this._types},t.toConfig=function toConfig(){var t;return{name:this.name,description:this.description,types:this.getTypes(),resolveType:this.resolveType,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:null!==(t=this.extensionASTNodes)&&void 0!==t?t:[]}},t.toString=function toString(){return this.name},t.toJSON=function toJSON(){return this.toString()},_createClass(GraphQLUnionType,[{key:M.a,get:function get(){return"GraphQLUnionType"}}]),GraphQLUnionType}();function defineTypes(t){var n=resolveThunk(t.types);return Array.isArray(n)||Object(O.a)(0,"Must provide Array of types or a function which returns such an array for Union ".concat(t.name,".")),n}Object(L.a)(q);var Z=function(){function GraphQLEnumType(t){this.name=t.name,this.description=t.description,this.extensions=t.extensions&&toObjMap(t.extensions),this.astNode=t.astNode,this.extensionASTNodes=undefineIfEmpty(t.extensionASTNodes),this._values=function defineEnumValues(t,n){return isPlainObj(n)||Object(O.a)(0,"".concat(t," values must be an object with value names as keys.")),S(n).map((function(n){var i=n[0],o=n[1];return isPlainObj(o)||Object(O.a)(0,"".concat(t,".").concat(i,' must refer to an object with a "value" key ')+"representing an internal value but got: ".concat(Object(T.a)(o),".")),!("isDeprecated"in o)||Object(O.a)(0,"".concat(t,".").concat(i,' should provide "deprecationReason" instead of "isDeprecated".')),{name:i,description:o.description,value:void 0!==o.value?o.value:i,isDeprecated:null!=o.deprecationReason,deprecationReason:o.deprecationReason,extensions:o.extensions&&toObjMap(o.extensions),astNode:o.astNode}}))}(this.name,t.values),this._valueLookup=new Map(this._values.map((function(t){return[t.value,t]}))),this._nameLookup=function keyMap(t,n){return t.reduce((function(t,i){return t[n(i)]=i,t}),Object.create(null))}(this._values,(function(t){return t.name})),"string"==typeof t.name||Object(O.a)(0,"Must provide name.")}var t=GraphQLEnumType.prototype;return t.getValues=function getValues(){return this._values},t.getValue=function getValue(t){return this._nameLookup[t]},t.serialize=function serialize(t){var n=this._valueLookup.get(t);if(void 0===n)throw new I.a('Enum "'.concat(this.name,'" cannot represent value: ').concat(Object(T.a)(t)));return n.name},t.parseValue=function parseValue(t){if("string"!=typeof t){var n=Object(T.a)(t);throw new I.a('Enum "'.concat(this.name,'" cannot represent non-string value: ').concat(n,".")+didYouMeanEnumValue(this,n))}var i=this.getValue(t);if(null==i)throw new I.a('Value "'.concat(t,'" does not exist in "').concat(this.name,'" enum.')+didYouMeanEnumValue(this,t));return i.value},t.parseLiteral=function parseLiteral(t,n){if(t.kind!==j.a.ENUM){var i=Object(V.a)(t);throw new I.a('Enum "'.concat(this.name,'" cannot represent non-enum value: ').concat(i,".")+didYouMeanEnumValue(this,i),t)}var o=this.getValue(t.value);if(null==o){var a=Object(V.a)(t);throw new I.a('Value "'.concat(a,'" does not exist in "').concat(this.name,'" enum.')+didYouMeanEnumValue(this,a),t)}return o.value},t.toConfig=function toConfig(){var t,n=keyValMap(this.getValues(),(function(t){return t.name}),(function(t){return{description:t.description,value:t.value,deprecationReason:t.deprecationReason,extensions:t.extensions,astNode:t.astNode}}));return{name:this.name,description:this.description,values:n,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:null!==(t=this.extensionASTNodes)&&void 0!==t?t:[]}},t.toString=function toString(){return this.name},t.toJSON=function toJSON(){return this.toString()},_createClass(GraphQLEnumType,[{key:M.a,get:function get(){return"GraphQLEnumType"}}]),GraphQLEnumType}();function didYouMeanEnumValue(t,n){return function didYouMean(t,n){var i="string"==typeof t?[t,n]:[void 0,t],o=i[0],a=" Did you mean ";o&&(a+=o+" ");var s=i[1].map((function(t){return'"'.concat(t,'"')}));switch(s.length){case 0:return"";case 1:return a+s[0]+"?";case 2:return a+s[0]+" or "+s[1]+"?"}var m=s.slice(0,5),g=m.pop();return a+m.join(", ")+", or "+g+"?"}("the enum value",suggestionList(n,t.getValues().map((function(t){return t.name}))))}Object(L.a)(Z);var X=function(){function GraphQLInputObjectType(t){this.name=t.name,this.description=t.description,this.extensions=t.extensions&&toObjMap(t.extensions),this.astNode=t.astNode,this.extensionASTNodes=undefineIfEmpty(t.extensionASTNodes),this._fields=defineInputFieldMap.bind(void 0,t),"string"==typeof t.name||Object(O.a)(0,"Must provide name.")}var t=GraphQLInputObjectType.prototype;return t.getFields=function getFields(){return"function"==typeof this._fields&&(this._fields=this._fields()),this._fields},t.toConfig=function toConfig(){var t,n=mapValue(this.getFields(),(function(t){return{description:t.description,type:t.type,defaultValue:t.defaultValue,extensions:t.extensions,astNode:t.astNode}}));return{name:this.name,description:this.description,fields:n,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:null!==(t=this.extensionASTNodes)&&void 0!==t?t:[]}},t.toString=function toString(){return this.name},t.toJSON=function toJSON(){return this.toString()},_createClass(GraphQLInputObjectType,[{key:M.a,get:function get(){return"GraphQLInputObjectType"}}]),GraphQLInputObjectType}();function defineInputFieldMap(t){var n=resolveThunk(t.fields);return isPlainObj(n)||Object(O.a)(0,"".concat(t.name," fields must be an object with field names as keys or a function which returns such an object.")),mapValue(n,(function(n,i){return!("resolve"in n)||Object(O.a)(0,"".concat(t.name,".").concat(i," field has a resolve property, but Input Types cannot define resolvers.")),{name:i,description:n.description,type:n.type,defaultValue:n.defaultValue,deprecationReason:n.deprecationReason,extensions:n.extensions&&toObjMap(n.extensions),astNode:n.astNode}}))}Object(L.a)(X),function removeTemporaryGlobals(){return isType(null),Object(_.a)()}()},function(t,n,i){"use strict";function _createForOfIteratorHelperLoose(t,n){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(i)return(i=i.call(t)).next.bind(i);if(Array.isArray(t)||(i=function _unsupportedIterableToArray(t,n){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _arrayLikeToArray(t,n)}(t))||n&&t&&"number"==typeof t.length){i&&(t=i);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,o=new Array(n);i<n;i++)o[i]=t[i];return o}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,n,i){return n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i),t}i.d(n,"a",(function(){return _}));var hasSymbols=function(){return"function"==typeof Symbol},hasSymbol=function(t){return hasSymbols()&&Boolean(Symbol[t])},getSymbol=function(t){return hasSymbol(t)?Symbol[t]:"@@"+t};hasSymbols()&&!hasSymbol("observable")&&(Symbol.observable=Symbol("observable"));var o=getSymbol("iterator"),a=getSymbol("observable"),s=getSymbol("species");function getMethod(t,n){var i=t[n];if(null!=i){if("function"!=typeof i)throw new TypeError(i+" is not a function");return i}}function getSpecies(t){var n=t.constructor;return void 0!==n&&null===(n=n[s])&&(n=void 0),void 0!==n?n:_}function isObservable(t){return t instanceof _}function hostReportError(t){hostReportError.log?hostReportError.log(t):setTimeout((function(){throw t}))}function enqueue(t){Promise.resolve().then((function(){try{t()}catch(t){hostReportError(t)}}))}function cleanupSubscription(t){var n=t._cleanup;if(void 0!==n&&(t._cleanup=void 0,n))try{if("function"==typeof n)n();else{var i=getMethod(n,"unsubscribe");i&&i.call(n)}}catch(t){hostReportError(t)}}function closeSubscription(t){t._observer=void 0,t._queue=void 0,t._state="closed"}function notifySubscription(t,n,i){t._state="running";var o=t._observer;try{var a=getMethod(o,n);switch(n){case"next":a&&a.call(o,i);break;case"error":if(closeSubscription(t),!a)throw i;a.call(o,i);break;case"complete":closeSubscription(t),a&&a.call(o)}}catch(t){hostReportError(t)}"closed"===t._state?cleanupSubscription(t):"running"===t._state&&(t._state="ready")}function onNotify(t,n,i){if("closed"!==t._state){if("buffering"!==t._state)return"ready"!==t._state?(t._state="buffering",t._queue=[{type:n,value:i}],void enqueue((function(){return function flushSubscription(t){var n=t._queue;if(n){t._queue=void 0,t._state="ready";for(var i=0;i<n.length&&(notifySubscription(t,n[i].type,n[i].value),"closed"!==t._state);++i);}}(t)}))):void notifySubscription(t,n,i);t._queue.push({type:n,value:i})}}var m=function(){function Subscription(t,n){this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";var i=new g(this);try{this._cleanup=n.call(void 0,i)}catch(t){i.error(t)}"initializing"===this._state&&(this._state="ready")}return Subscription.prototype.unsubscribe=function unsubscribe(){"closed"!==this._state&&(closeSubscription(this),cleanupSubscription(this))},_createClass(Subscription,[{key:"closed",get:function(){return"closed"===this._state}}]),Subscription}(),g=function(){function SubscriptionObserver(t){this._subscription=t}var t=SubscriptionObserver.prototype;return t.next=function next(t){onNotify(this._subscription,"next",t)},t.error=function error(t){onNotify(this._subscription,"error",t)},t.complete=function complete(){onNotify(this._subscription,"complete")},_createClass(SubscriptionObserver,[{key:"closed",get:function(){return"closed"===this._subscription._state}}]),SubscriptionObserver}(),_=function(){function Observable(t){if(!(this instanceof Observable))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}var t=Observable.prototype;return t.subscribe=function subscribe(t){return"object"==typeof t&&null!==t||(t={next:t,error:arguments[1],complete:arguments[2]}),new m(t,this._subscriber)},t.forEach=function forEach(t){var n=this;return new Promise((function(i,o){if("function"==typeof t)var a=n.subscribe({next:function(n){try{t(n,done)}catch(t){o(t),a.unsubscribe()}},error:o,complete:i});else o(new TypeError(t+" is not a function"));function done(){a.unsubscribe(),i()}}))},t.map=function map(t){var n=this;if("function"!=typeof t)throw new TypeError(t+" is not a function");return new(getSpecies(this))((function(i){return n.subscribe({next:function(n){try{n=t(n)}catch(t){return i.error(t)}i.next(n)},error:function(t){i.error(t)},complete:function(){i.complete()}})}))},t.filter=function filter(t){var n=this;if("function"!=typeof t)throw new TypeError(t+" is not a function");return new(getSpecies(this))((function(i){return n.subscribe({next:function(n){try{if(!t(n))return}catch(t){return i.error(t)}i.next(n)},error:function(t){i.error(t)},complete:function(){i.complete()}})}))},t.reduce=function reduce(t){var n=this;if("function"!=typeof t)throw new TypeError(t+" is not a function");var i=getSpecies(this),o=arguments.length>1,a=!1,s=arguments[1],m=s;return new i((function(i){return n.subscribe({next:function(n){var s=!a;if(a=!0,!s||o)try{m=t(m,n)}catch(t){return i.error(t)}else m=n},error:function(t){i.error(t)},complete:function(){if(!a&&!o)return i.error(new TypeError("Cannot reduce an empty sequence"));i.next(m),i.complete()}})}))},t.concat=function concat(){for(var t=this,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];var a=getSpecies(this);return new a((function(n){var o,s=0;return function startNext(t){o=t.subscribe({next:function(t){n.next(t)},error:function(t){n.error(t)},complete:function(){s===i.length?(o=void 0,n.complete()):startNext(a.from(i[s++]))}})}(t),function(){o&&(o.unsubscribe(),o=void 0)}}))},t.flatMap=function flatMap(t){var n=this;if("function"!=typeof t)throw new TypeError(t+" is not a function");var i=getSpecies(this);return new i((function(o){var a=[],s=n.subscribe({next:function(n){if(t)try{n=t(n)}catch(t){return o.error(t)}var s=i.from(n).subscribe({next:function(t){o.next(t)},error:function(t){o.error(t)},complete:function(){var t=a.indexOf(s);t>=0&&a.splice(t,1),completeIfDone()}});a.push(s)},error:function(t){o.error(t)},complete:function(){completeIfDone()}});function completeIfDone(){s.closed&&0===a.length&&o.complete()}return function(){a.forEach((function(t){return t.unsubscribe()})),s.unsubscribe()}}))},t[a]=function(){return this},Observable.from=function from(t){var n="function"==typeof this?this:Observable;if(null==t)throw new TypeError(t+" is not an object");var i=getMethod(t,a);if(i){var s=i.call(t);if(Object(s)!==s)throw new TypeError(s+" is not an object");return isObservable(s)&&s.constructor===n?s:new n((function(t){return s.subscribe(t)}))}if(hasSymbol("iterator")&&(i=getMethod(t,o)))return new n((function(n){enqueue((function(){if(!n.closed){for(var o,a=_createForOfIteratorHelperLoose(i.call(t));!(o=a()).done;){var s=o.value;if(n.next(s),n.closed)return}n.complete()}}))}));if(Array.isArray(t))return new n((function(n){enqueue((function(){if(!n.closed){for(var i=0;i<t.length;++i)if(n.next(t[i]),n.closed)return;n.complete()}}))}));throw new TypeError(t+" is not observable")},Observable.of=function of(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o="function"==typeof this?this:Observable;return new o((function(t){enqueue((function(){if(!t.closed){for(var i=0;i<n.length;++i)if(t.next(n[i]),t.closed)return;t.complete()}}))}))},_createClass(Observable,null,[{key:s,get:function(){return this}}]),Observable}();hasSymbols()&&Object.defineProperty(_,Symbol("extensions"),{value:{symbol:a,hostReportError},configurable:!0})},function(t,n,i){var o=i(14).Symbol;t.exports=o},function(t,n,i){var o=i(55),a=i(83);t.exports=function copyObject(t,n,i,s){var m=!i;i||(i={});for(var g=-1,_=n.length;++g<_;){var S=n[g],M=s?s(i[S],t[S],S,i,t):void 0;void 0===M&&(M=t[S]),m?a(i,S,M):o(i,S,M)}return i}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Constants=void 0,function(t){t.APPLICATION="$$applications",t.SCENE_CONFIGURATION="scene_configuration",t.APPLICATION_DEFAULT_IMAGE="https://showroom-media-dev.byondxr.com/5e429641907950e5ddf66e14/ec3def83-e4c4-4eef-9ace-5b03f66290d9/download_1__b37b58af-ec32-4b6f-b474-04deb0f8b7cc.png",t.ProductFilter="$$product_filter",t.HotspotType="$$hotspot_type",t.CustomFieldsTagsType="tags",t.CustomFieldsTextType="text",t.RenderOrder="$$render_order",t.DefaultRenderOrder=-99999}(n.Constants||(n.Constants={}))},function(t,n,i){"use strict";i.d(n,"b",(function(){return mergeDeep})),i.d(n,"c",(function(){return mergeDeepArray})),i.d(n,"a",(function(){return m}));var o=i(0),a=i(10),s=Object.prototype.hasOwnProperty;function mergeDeep(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return mergeDeepArray(t)}function mergeDeepArray(t){var n=t[0]||{},i=t.length;if(i>1)for(var o=new m,a=1;a<i;++a)n=o.merge(n,t[a]);return n}var defaultReconciler=function(t,n,i){return this.merge(t[i],n[i])},m=function(){function DeepMerger(t){void 0===t&&(t=defaultReconciler),this.reconciler=t,this.isObject=a.a,this.pastCopies=new Set}return DeepMerger.prototype.merge=function(t,n){for(var i=this,m=[],g=2;g<arguments.length;g++)m[g-2]=arguments[g];return Object(a.a)(n)&&Object(a.a)(t)?(Object.keys(n).forEach((function(a){if(s.call(t,a)){var g=t[a];if(n[a]!==g){var _=i.reconciler.apply(i,Object(o.f)([t,n,a],m));_!==g&&((t=i.shallowCopyForMerge(t))[a]=_)}}else(t=i.shallowCopyForMerge(t))[a]=n[a]})),t):n},DeepMerger.prototype.shallowCopyForMerge=function(t){return Object(a.a)(t)&&!this.pastCopies.has(t)&&(t=Array.isArray(t)?t.slice(0):Object(o.a)({__proto__:Object.getPrototypeOf(t)},t),this.pastCopies.add(t)),t},DeepMerger}()},function(t,n,i){"use strict";var o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0;n.a=o},function(t,n,i){var o=i(127),a=i(128),s=i(129),m=i(130),g=i(131);function ListCache(t){var n=-1,i=null==t?0:t.length;for(this.clear();++n<i;){var o=t[n];this.set(o[0],o[1])}}ListCache.prototype.clear=o,ListCache.prototype.delete=a,ListCache.prototype.get=s,ListCache.prototype.has=m,ListCache.prototype.set=g,t.exports=ListCache},function(t,n,i){var o=i(79);t.exports=function assocIndexOf(t,n){for(var i=t.length;i--;)if(o(t[i][0],n))return i;return-1}},function(t,n,i){var o=i(23)(Object,"create");t.exports=o},function(t,n,i){var o=i(151);t.exports=function getMapData(t,n){var i=t.__data__;return o(n)?i["string"==typeof n?"string":"hash"]:i.map}},function(t,n,i){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var n,i=1,o=arguments.length;i<o;i++)for(var a in n=arguments[i])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0}),n.formatProduct=n.getApplicationsFromCustomFields=n.getProductFormatField=n.getProductPrice=n.getProductFacets=n.getProductApplication=n.getCustomMediaField=n.getCustomField=n.GetFrontMediaUrl=n.GetMediaByType=n.isImageMedia=n.isImageMediaType=void 0;var a=i(69),s=i(33),m=i(199),g=["frontal_image","right_image","back_image","left_image","additional_images"];function GetMediaByType(t,n){var i,o=null===(i=null==t?void 0:t.medias)||void 0===i?void 0:i.find((function(t){return(null==t?void 0:t.type)===n}));return null==o?void 0:o.value}n.isImageMediaType=function isImageMediaType(t){return g.some((function(n){return n===t}))},n.isImageMedia=function isImageMedia(t){return g.some((function(n){return n===t.type}))},n.GetMediaByType=GetMediaByType;function getCustomField(t,n){var i;if(t.customFields){var o=null===(i=t.customFields)||void 0===i?void 0:i.find((function(t){return t.name===n}));return null==o?void 0:o.value}}function getProductApplication(t){return getCustomField(t,s.Constants.APPLICATION)}function getProductFacets(t){var n,i=[];return null===(n=t.customFields)||void 0===n||n.forEach((function(t){t.name&&t.type===s.Constants.CustomFieldsTagsType&&!t.name.startsWith("$$")&&i.push({name:t.name,options:t.value})})),i}function getProductPrice(t){var n,i;return""+(null!==(i=null===(n=null==t?void 0:t.wholesalePrice)||void 0===n?void 0:n.value)&&void 0!==i?i:"")}function getProductFormatField(t,n){var i,o;return n.startsWith("__")?""+(null!==(i=getCustomField(t,n.substring(2)))&&void 0!==i?i:""):""+(null!==(o=t[n])&&void 0!==o?o:"")}n.GetFrontMediaUrl=function(t){var n=GetMediaByType(t,"frontal_image");return n?a.MediaUtils.GetMediaUrl(n):""},n.getCustomField=getCustomField,n.getCustomMediaField=function getCustomMediaField(t,n){var i;if(t.customFields){var o=null===(i=t.customMediaFields)||void 0===i?void 0:i.find((function(t){return t.name===n}));return null==o?void 0:o.value}},n.getProductApplication=getProductApplication,n.getProductFacets=getProductFacets,n.getProductPrice=getProductPrice,n.getProductFormatField=getProductFormatField,n.getApplicationsFromCustomFields=function getApplicationsFromCustomFields(t){var n,i;return(null===(i=null===(n=null==t?void 0:t.customFields)||void 0===n?void 0:n.find((function(t){return t.name===s.Constants.APPLICATION})))||void 0===i?void 0:i.value)||[]},n.formatProduct=function formatProduct(t,i){var a,s=o(o({},m.GlobalConfig.defaultFieldsMap),i),g=getProductApplication(t),_=getProductFacets(t);return _.filter((function(t){return!s.facets||s.facets.includes(t.name)})),{_id:t._id,application:null!==(a=null==g?void 0:g[0])&&void 0!==a?a:"",description:getProductFormatField(t,s.description),facets:_,image:n.GetFrontMediaUrl(t),price:s.price?""+getCustomField(t,s.price):getProductPrice(t),sku:t.sku,title:getProductFormatField(t,s.title)||t.title}}},function(t,n,i){t.exports={...i(71),...i(227),...i(228)}},function(t,n,i){var o=i(24),a=i(236),s=i(237),m=i(240);t.exports=function castPath(t,n){return o(t)?t:a(t,n)?[t]:s(m(t))}},function(t,n,i){var o=i(26),a=i(19);t.exports=function isSymbol(t){return"symbol"==typeof t||a(t)&&"[object Symbol]"==o(t)}},function(t,n,i){"use strict";i.d(n,"a",(function(){return fixObservableSubclass}));var o=i(30);function fixObservableSubclass(t){function set(n){Object.defineProperty(t,n,{value:o.a})}return"function"==typeof Symbol&&Symbol.species&&set(Symbol.species),set("@@species"),t}},function(t,n,i){"use strict";i.d(n,"a",(function(){return makeUniqueId}));var o=new Map;function makeUniqueId(t){var n=o.get(t)||1;return o.set(t,n+1),t+":"+n+":"+Math.random().toString(36).slice(2)}},function(t,n,i){"use strict";function invariant(t,n){if(!Boolean(t))throw new Error(null!=n?n:"Unexpected invariant triggered.")}i.d(n,"a",(function(){return invariant}))},function(t,n,i){"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function isObjectLike(t){return"object"==_typeof(t)&&null!==t}i.d(n,"a",(function(){return isObjectLike}))},function(t,n,i){"use strict";function dedentBlockStringValue(t){var n=t.split(/\r\n|[\n\r]/g),i=function getBlockStringIndentation(t){for(var n,i=!0,o=!0,a=0,s=null,m=0;m<t.length;++m)switch(t.charCodeAt(m)){case 13:10===t.charCodeAt(m+1)&&++m;case 10:i=!1,o=!0,a=0;break;case 9:case 32:++a;break;default:o&&!i&&(null===s||a<s)&&(s=a),o=!1}return null!==(n=s)&&void 0!==n?n:0}(t);if(0!==i)for(var o=1;o<n.length;o++)n[o]=n[o].slice(i);for(var a=0;a<n.length&&isBlank(n[a]);)++a;for(var s=n.length;s>a&&isBlank(n[s-1]);)--s;return n.slice(a,s).join("\n")}function isBlank(t){for(var n=0;n<t.length;++n)if(" "!==t[n]&&"\t"!==t[n])return!1;return!0}function printBlockString(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=-1===t.indexOf("\n"),a=" "===t[0]||"\t"===t[0],s='"'===t[t.length-1],m="\\"===t[t.length-1],g=!o||s||m||i,_="";return!g||o&&a||(_+="\n"+n),_+=n?t.replace(/\n/g,"\n"+n):t,g&&(_+="\n"),'"""'+_.replace(/"""/g,'\\"""')+'"""'}i.d(n,"a",(function(){return dedentBlockStringValue})),i.d(n,"b",(function(){return printBlockString}))},,,function(t,n,i){var o=i(78);t.exports=function cloneDeep(t){return o(t,5)}},function(t,n,i){var o=i(23)(i(14),"Map");t.exports=o},function(t,n){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,n,i){var o=i(143),a=i(150),s=i(152),m=i(153),g=i(154);function MapCache(t){var n=-1,i=null==t?0:t.length;for(this.clear();++n<i;){var o=t[n];this.set(o[0],o[1])}}MapCache.prototype.clear=o,MapCache.prototype.delete=a,MapCache.prototype.get=s,MapCache.prototype.has=m,MapCache.prototype.set=g,t.exports=MapCache},function(t,n,i){var o=i(83),a=i(79),s=Object.prototype.hasOwnProperty;t.exports=function assignValue(t,n,i){var m=t[n];s.call(t,n)&&a(m,i)&&(void 0!==i||n in t)||o(t,n,i)}},function(t,n,i){var o=i(85),a=i(162),s=i(61);t.exports=function keys(t){return s(t)?o(t):a(t)}},function(t,n){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,n){t.exports=function baseUnary(t){return function(n){return t(n)}}},function(t,n,i){(function(t){var o=i(81),a=n&&!n.nodeType&&n,s=a&&"object"==typeof t&&t&&!t.nodeType&&t,m=s&&s.exports===a&&o.process,g=function(){try{var t=s&&s.require&&s.require("util").types;return t||m&&m.binding&&m.binding("util")}catch(t){}}();t.exports=g}).call(this,i(57)(t))},function(t,n){var i=Object.prototype;t.exports=function isPrototype(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||i)}},function(t,n,i){var o=i(80),a=i(89);t.exports=function isArrayLike(t){return null!=t&&a(t.length)&&!o(t)}},function(t,n,i){var o=i(85),a=i(165),s=i(61);t.exports=function keysIn(t){return s(t)?o(t,!0):a(t)}},function(t,n,i){var o=i(170),a=i(91),s=Object.prototype.propertyIsEnumerable,m=Object.getOwnPropertySymbols,g=m?function(t){return null==t?[]:(t=Object(t),o(m(t),(function(n){return s.call(t,n)})))}:a;t.exports=g},function(t,n){t.exports=function arrayPush(t,n){for(var i=-1,o=n.length,a=t.length;++i<o;)t[a+i]=n[i];return t}},function(t,n,i){var o=i(90)(Object.getPrototypeOf,Object);t.exports=o},function(t,n,i){var o=i(173),a=i(52),s=i(174),m=i(95),g=i(175),_=i(26),S=i(82),M=S(o),T=S(a),O=S(s),A=S(m),P=S(g),L=_;(o&&"[object DataView]"!=L(new o(new ArrayBuffer(1)))||a&&"[object Map]"!=L(new a)||s&&"[object Promise]"!=L(s.resolve())||m&&"[object Set]"!=L(new m)||g&&"[object WeakMap]"!=L(new g))&&(L=function(t){var n=_(t),i="[object Object]"==n?t.constructor:void 0,o=i?S(i):"";if(o)switch(o){case M:return"[object DataView]";case T:return"[object Map]";case O:return"[object Promise]";case A:return"[object Set]";case P:return"[object WeakMap]"}return n}),t.exports=L},function(t,n,i){var o=i(178);t.exports=function cloneArrayBuffer(t){var n=new t.constructor(t.byteLength);return new o(n).set(new o(t)),n}},function(t,n,i){!function webpackUniversalModuleDefinition(n,o){t.exports=o(i(191),i(192),i(193),i(194))}(window,(function(t,n,i,o){return function(t){var n={};function __webpack_require__(i){if(n[i])return n[i].exports;var o=n[i]={i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}return __webpack_require__.m=t,__webpack_require__.c=n,__webpack_require__.d=function(t,n,i){__webpack_require__.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,n){if(1&n&&(t=__webpack_require__(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)__webpack_require__.d(i,o,function(n){return t[n]}.bind(null,o));return i},__webpack_require__.n=function(t){var n=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(n,"a",n),n},__webpack_require__.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=56)}([function(t,n,i){"use strict";i.r(n),i.d(n,"ACESFilmicToneMapping",(function(){return Se})),i.d(n,"AddEquation",(function(){return q})),i.d(n,"AddOperation",(function(){return ve})),i.d(n,"AdditiveAnimationBlendMode",(function(){return mn})),i.d(n,"AdditiveBlending",(function(){return U})),i.d(n,"AlphaFormat",(function(){return rt})),i.d(n,"AlwaysDepth",(function(){return ue})),i.d(n,"AlwaysStencilFunc",(function(){return qn})),i.d(n,"AmbientLight",(function(){return AmbientLight})),i.d(n,"AmbientLightProbe",(function(){return AmbientLightProbe})),i.d(n,"AnimationClip",(function(){return AnimationClip})),i.d(n,"AnimationLoader",(function(){return AnimationLoader})),i.d(n,"AnimationMixer",(function(){return AnimationMixer})),i.d(n,"AnimationObjectGroup",(function(){return AnimationObjectGroup})),i.d(n,"AnimationUtils",(function(){return ua})),i.d(n,"ArcCurve",(function(){return ArcCurve})),i.d(n,"ArrayCamera",(function(){return ArrayCamera})),i.d(n,"ArrowHelper",(function(){return ArrowHelper})),i.d(n,"Audio",(function(){return Audio})),i.d(n,"AudioAnalyser",(function(){return AudioAnalyser})),i.d(n,"AudioContext",(function(){return Sa})),i.d(n,"AudioListener",(function(){return AudioListener})),i.d(n,"AudioLoader",(function(){return AudioLoader})),i.d(n,"AxesHelper",(function(){return AxesHelper})),i.d(n,"AxisHelper",(function(){return AxisHelper})),i.d(n,"BackSide",(function(){return L})),i.d(n,"BasicDepthPacking",(function(){return Cn})),i.d(n,"BasicShadowMap",(function(){return M})),i.d(n,"BinaryTextureLoader",(function(){return BinaryTextureLoader})),i.d(n,"Bone",(function(){return Bone})),i.d(n,"BooleanKeyframeTrack",(function(){return BooleanKeyframeTrack})),i.d(n,"BoundingBoxHelper",(function(){return BoundingBoxHelper})),i.d(n,"Box2",(function(){return Box2})),i.d(n,"Box3",(function(){return Box3})),i.d(n,"Box3Helper",(function(){return Box3Helper})),i.d(n,"BoxBufferGeometry",(function(){return BoxBufferGeometry})),i.d(n,"BoxGeometry",(function(){return BoxGeometry})),i.d(n,"BoxHelper",(function(){return BoxHelper})),i.d(n,"BufferAttribute",(function(){return BufferAttribute})),i.d(n,"BufferGeometry",(function(){return BufferGeometry})),i.d(n,"BufferGeometryLoader",(function(){return BufferGeometryLoader})),i.d(n,"ByteType",(function(){return qe})),i.d(n,"Cache",(function(){return la})),i.d(n,"Camera",(function(){return Camera})),i.d(n,"CameraHelper",(function(){return CameraHelper})),i.d(n,"CanvasRenderer",(function(){return CanvasRenderer})),i.d(n,"CanvasTexture",(function(){return CanvasTexture})),i.d(n,"CatmullRomCurve3",(function(){return CatmullRomCurve3})),i.d(n,"CineonToneMapping",(function(){return xe})),i.d(n,"CircleBufferGeometry",(function(){return CircleBufferGeometry})),i.d(n,"CircleGeometry",(function(){return CircleGeometry})),i.d(n,"ClampToEdgeWrapping",(function(){return Ne})),i.d(n,"Clock",(function(){return Clock})),i.d(n,"ClosedSplineCurve3",(function(){return ClosedSplineCurve3})),i.d(n,"Color",(function(){return Color})),i.d(n,"ColorKeyframeTrack",(function(){return ColorKeyframeTrack})),i.d(n,"CompressedTexture",(function(){return CompressedTexture})),i.d(n,"CompressedTextureLoader",(function(){return CompressedTextureLoader})),i.d(n,"ConeBufferGeometry",(function(){return ConeBufferGeometry})),i.d(n,"ConeGeometry",(function(){return ConeGeometry})),i.d(n,"CubeCamera",(function(){return CubeCamera})),i.d(n,"CubeGeometry",(function(){return BoxGeometry})),i.d(n,"CubeReflectionMapping",(function(){return Te})),i.d(n,"CubeRefractionMapping",(function(){return Ce})),i.d(n,"CubeTexture",(function(){return CubeTexture})),i.d(n,"CubeTextureLoader",(function(){return CubeTextureLoader})),i.d(n,"CubeUVReflectionMapping",(function(){return Pe})),i.d(n,"CubeUVRefractionMapping",(function(){return Le})),i.d(n,"CubicBezierCurve",(function(){return CubicBezierCurve})),i.d(n,"CubicBezierCurve3",(function(){return CubicBezierCurve3})),i.d(n,"CubicInterpolant",(function(){return CubicInterpolant})),i.d(n,"CullFaceBack",(function(){return g})),i.d(n,"CullFaceFront",(function(){return _})),i.d(n,"CullFaceFrontBack",(function(){return S})),i.d(n,"CullFaceNone",(function(){return m})),i.d(n,"Curve",(function(){return Curve})),i.d(n,"CurvePath",(function(){return CurvePath})),i.d(n,"CustomBlending",(function(){return H})),i.d(n,"CustomToneMapping",(function(){return Me})),i.d(n,"CylinderBufferGeometry",(function(){return CylinderBufferGeometry})),i.d(n,"CylinderGeometry",(function(){return CylinderGeometry})),i.d(n,"Cylindrical",(function(){return Cylindrical})),i.d(n,"DataTexture",(function(){return DataTexture})),i.d(n,"DataTexture2DArray",(function(){return DataTexture2DArray})),i.d(n,"DataTexture3D",(function(){return DataTexture3D})),i.d(n,"DataTextureLoader",(function(){return DataTextureLoader})),i.d(n,"DataUtils",(function(){return us})),i.d(n,"DecrementStencilOp",(function(){return kn})),i.d(n,"DecrementWrapStencilOp",(function(){return Fn})),i.d(n,"DefaultLoadingManager",(function(){return ha})),i.d(n,"DepthFormat",(function(){return ut})),i.d(n,"DepthStencilFormat",(function(){return lt})),i.d(n,"DepthTexture",(function(){return DepthTexture})),i.d(n,"DirectionalLight",(function(){return DirectionalLight})),i.d(n,"DirectionalLightHelper",(function(){return DirectionalLightHelper})),i.d(n,"DiscreteInterpolant",(function(){return DiscreteInterpolant})),i.d(n,"DodecahedronBufferGeometry",(function(){return DodecahedronBufferGeometry})),i.d(n,"DodecahedronGeometry",(function(){return DodecahedronGeometry})),i.d(n,"DoubleSide",(function(){return R})),i.d(n,"DstAlphaFactor",(function(){return re})),i.d(n,"DstColorFactor",(function(){return oe})),i.d(n,"DynamicBufferAttribute",(function(){return DynamicBufferAttribute})),i.d(n,"DynamicCopyUsage",(function(){return er})),i.d(n,"DynamicDrawUsage",(function(){return Xn})),i.d(n,"DynamicReadUsage",(function(){return Jn})),i.d(n,"EdgesGeometry",(function(){return EdgesGeometry})),i.d(n,"EdgesHelper",(function(){return EdgesHelper})),i.d(n,"EllipseCurve",(function(){return EllipseCurve})),i.d(n,"EqualDepth",(function(){return de})),i.d(n,"EqualStencilFunc",(function(){return Un})),i.d(n,"EquirectangularReflectionMapping",(function(){return Oe})),i.d(n,"EquirectangularRefractionMapping",(function(){return Ae})),i.d(n,"Euler",(function(){return Euler})),i.d(n,"EventDispatcher",(function(){return EventDispatcher})),i.d(n,"ExtrudeBufferGeometry",(function(){return ExtrudeBufferGeometry})),i.d(n,"ExtrudeGeometry",(function(){return ExtrudeGeometry})),i.d(n,"Face3",(function(){return Face3})),i.d(n,"Face4",(function(){return Face4})),i.d(n,"FaceColors",(function(){return Ts})),i.d(n,"FileLoader",(function(){return FileLoader})),i.d(n,"FlatShading",(function(){return N})),i.d(n,"Float16BufferAttribute",(function(){return Float16BufferAttribute})),i.d(n,"Float32Attribute",(function(){return Float32Attribute})),i.d(n,"Float32BufferAttribute",(function(){return Float32BufferAttribute})),i.d(n,"Float64Attribute",(function(){return Float64Attribute})),i.d(n,"Float64BufferAttribute",(function(){return Float64BufferAttribute})),i.d(n,"FloatType",(function(){return Je})),i.d(n,"Fog",(function(){return Fog})),i.d(n,"FogExp2",(function(){return FogExp2})),i.d(n,"Font",(function(){return Font})),i.d(n,"FontLoader",(function(){return FontLoader})),i.d(n,"FrontSide",(function(){return P})),i.d(n,"Frustum",(function(){return Frustum})),i.d(n,"GLBufferAttribute",(function(){return GLBufferAttribute})),i.d(n,"GLSL1",(function(){return nr})),i.d(n,"GLSL3",(function(){return rr})),i.d(n,"GammaEncoding",(function(){return wn})),i.d(n,"Geometry",(function(){return Geometry})),i.d(n,"GeometryUtils",(function(){return Os})),i.d(n,"GreaterDepth",(function(){return fe})),i.d(n,"GreaterEqualDepth",(function(){return pe})),i.d(n,"GreaterEqualStencilFunc",(function(){return Wn})),i.d(n,"GreaterStencilFunc",(function(){return zn})),i.d(n,"GridHelper",(function(){return GridHelper})),i.d(n,"Group",(function(){return Group})),i.d(n,"HalfFloatType",(function(){return Ke})),i.d(n,"HemisphereLight",(function(){return HemisphereLight})),i.d(n,"HemisphereLightHelper",(function(){return HemisphereLightHelper})),i.d(n,"HemisphereLightProbe",(function(){return HemisphereLightProbe})),i.d(n,"IcosahedronBufferGeometry",(function(){return IcosahedronBufferGeometry})),i.d(n,"IcosahedronGeometry",(function(){return IcosahedronGeometry})),i.d(n,"ImageBitmapLoader",(function(){return ImageBitmapLoader})),i.d(n,"ImageLoader",(function(){return ImageLoader})),i.d(n,"ImageUtils",(function(){return cr})),i.d(n,"ImmediateRenderObject",(function(){return ImmediateRenderObject})),i.d(n,"IncrementStencilOp",(function(){return In})),i.d(n,"IncrementWrapStencilOp",(function(){return jn})),i.d(n,"InstancedBufferAttribute",(function(){return InstancedBufferAttribute})),i.d(n,"InstancedBufferGeometry",(function(){return InstancedBufferGeometry})),i.d(n,"InstancedInterleavedBuffer",(function(){return InstancedInterleavedBuffer})),i.d(n,"InstancedMesh",(function(){return InstancedMesh})),i.d(n,"Int16Attribute",(function(){return Int16Attribute})),i.d(n,"Int16BufferAttribute",(function(){return Int16BufferAttribute})),i.d(n,"Int32Attribute",(function(){return Int32Attribute})),i.d(n,"Int32BufferAttribute",(function(){return Int32BufferAttribute})),i.d(n,"Int8Attribute",(function(){return Int8Attribute})),i.d(n,"Int8BufferAttribute",(function(){return Int8BufferAttribute})),i.d(n,"IntType",(function(){return Qe})),i.d(n,"InterleavedBuffer",(function(){return InterleavedBuffer})),i.d(n,"InterleavedBufferAttribute",(function(){return InterleavedBufferAttribute})),i.d(n,"Interpolant",(function(){return Interpolant})),i.d(n,"InterpolateDiscrete",(function(){return cn})),i.d(n,"InterpolateLinear",(function(){return un})),i.d(n,"InterpolateSmooth",(function(){return ln})),i.d(n,"InvertStencilOp",(function(){return Dn})),i.d(n,"JSONLoader",(function(){return JSONLoader})),i.d(n,"KeepStencilOp",(function(){return Rn})),i.d(n,"KeyframeTrack",(function(){return KeyframeTrack})),i.d(n,"LOD",(function(){return LOD})),i.d(n,"LatheBufferGeometry",(function(){return LatheBufferGeometry})),i.d(n,"LatheGeometry",(function(){return LatheGeometry})),i.d(n,"Layers",(function(){return Layers})),i.d(n,"LensFlare",(function(){return LensFlare})),i.d(n,"LessDepth",(function(){return le})),i.d(n,"LessEqualDepth",(function(){return he})),i.d(n,"LessEqualStencilFunc",(function(){return Gn})),i.d(n,"LessStencilFunc",(function(){return Vn})),i.d(n,"Light",(function(){return Light})),i.d(n,"LightProbe",(function(){return LightProbe})),i.d(n,"Line",(function(){return Line})),i.d(n,"Line3",(function(){return Line3})),i.d(n,"LineBasicMaterial",(function(){return LineBasicMaterial})),i.d(n,"LineCurve",(function(){return LineCurve})),i.d(n,"LineCurve3",(function(){return LineCurve3})),i.d(n,"LineDashedMaterial",(function(){return LineDashedMaterial})),i.d(n,"LineLoop",(function(){return LineLoop})),i.d(n,"LinePieces",(function(){return Ms})),i.d(n,"LineSegments",(function(){return LineSegments})),i.d(n,"LineStrip",(function(){return Ss})),i.d(n,"LinearEncoding",(function(){return bn})),i.d(n,"LinearFilter",(function(){return Ve})),i.d(n,"LinearInterpolant",(function(){return LinearInterpolant})),i.d(n,"LinearMipMapLinearFilter",(function(){return He})),i.d(n,"LinearMipMapNearestFilter",(function(){return Ge})),i.d(n,"LinearMipmapLinearFilter",(function(){return ze})),i.d(n,"LinearMipmapNearestFilter",(function(){return Ue})),i.d(n,"LinearToneMapping",(function(){return _e})),i.d(n,"Loader",(function(){return Loader})),i.d(n,"LoaderUtils",(function(){return va})),i.d(n,"LoadingManager",(function(){return LoadingManager})),i.d(n,"LogLuvEncoding",(function(){return Sn})),i.d(n,"LoopOnce",(function(){return rn})),i.d(n,"LoopPingPong",(function(){return sn})),i.d(n,"LoopRepeat",(function(){return an})),i.d(n,"LuminanceAlphaFormat",(function(){return st})),i.d(n,"LuminanceFormat",(function(){return at})),i.d(n,"MOUSE",(function(){return a})),i.d(n,"Material",(function(){return Material})),i.d(n,"MaterialLoader",(function(){return MaterialLoader})),i.d(n,"Math",(function(){return ar})),i.d(n,"MathUtils",(function(){return ar})),i.d(n,"Matrix3",(function(){return Matrix3})),i.d(n,"Matrix4",(function(){return Matrix4})),i.d(n,"MaxEquation",(function(){return Y})),i.d(n,"Mesh",(function(){return Mesh})),i.d(n,"MeshBasicMaterial",(function(){return MeshBasicMaterial})),i.d(n,"MeshDepthMaterial",(function(){return MeshDepthMaterial})),i.d(n,"MeshDistanceMaterial",(function(){return MeshDistanceMaterial})),i.d(n,"MeshFaceMaterial",(function(){return MeshFaceMaterial})),i.d(n,"MeshLambertMaterial",(function(){return MeshLambertMaterial})),i.d(n,"MeshMatcapMaterial",(function(){return MeshMatcapMaterial})),i.d(n,"MeshNormalMaterial",(function(){return MeshNormalMaterial})),i.d(n,"MeshPhongMaterial",(function(){return MeshPhongMaterial})),i.d(n,"MeshPhysicalMaterial",(function(){return MeshPhysicalMaterial})),i.d(n,"MeshStandardMaterial",(function(){return MeshStandardMaterial})),i.d(n,"MeshToonMaterial",(function(){return MeshToonMaterial})),i.d(n,"MinEquation",(function(){return Q})),i.d(n,"MirroredRepeatWrapping",(function(){return Ie})),i.d(n,"MixOperation",(function(){return ye})),i.d(n,"MultiMaterial",(function(){return MultiMaterial})),i.d(n,"MultiplyBlending",(function(){return z})),i.d(n,"MultiplyOperation",(function(){return ge})),i.d(n,"NearestFilter",(function(){return ke})),i.d(n,"NearestMipMapLinearFilter",(function(){return Be})),i.d(n,"NearestMipMapNearestFilter",(function(){return Fe})),i.d(n,"NearestMipmapLinearFilter",(function(){return De})),i.d(n,"NearestMipmapNearestFilter",(function(){return je})),i.d(n,"NeverDepth",(function(){return ce})),i.d(n,"NeverStencilFunc",(function(){return Bn})),i.d(n,"NoBlending",(function(){return j})),i.d(n,"NoColors",(function(){return Es})),i.d(n,"NoToneMapping",(function(){return be})),i.d(n,"NormalAnimationBlendMode",(function(){return fn})),i.d(n,"NormalBlending",(function(){return V})),i.d(n,"NotEqualDepth",(function(){return me})),i.d(n,"NotEqualStencilFunc",(function(){return Hn})),i.d(n,"NumberKeyframeTrack",(function(){return NumberKeyframeTrack})),i.d(n,"Object3D",(function(){return Object3D})),i.d(n,"ObjectLoader",(function(){return ObjectLoader})),i.d(n,"ObjectSpaceNormalMap",(function(){return Pn})),i.d(n,"OctahedronBufferGeometry",(function(){return OctahedronBufferGeometry})),i.d(n,"OctahedronGeometry",(function(){return OctahedronGeometry})),i.d(n,"OneFactor",(function(){return K})),i.d(n,"OneMinusDstAlphaFactor",(function(){return ie})),i.d(n,"OneMinusDstColorFactor",(function(){return ae})),i.d(n,"OneMinusSrcAlphaFactor",(function(){return ne})),i.d(n,"OneMinusSrcColorFactor",(function(){return ee})),i.d(n,"OrthographicCamera",(function(){return OrthographicCamera})),i.d(n,"PCFShadowMap",(function(){return T})),i.d(n,"PCFSoftShadowMap",(function(){return O})),i.d(n,"PMREMGenerator",(function(){return PMREMGenerator})),i.d(n,"ParametricBufferGeometry",(function(){return ParametricBufferGeometry})),i.d(n,"ParametricGeometry",(function(){return ParametricGeometry})),i.d(n,"Particle",(function(){return Particle})),i.d(n,"ParticleBasicMaterial",(function(){return ParticleBasicMaterial})),i.d(n,"ParticleSystem",(function(){return ParticleSystem})),i.d(n,"ParticleSystemMaterial",(function(){return ParticleSystemMaterial})),i.d(n,"Path",(function(){return Path})),i.d(n,"PerspectiveCamera",(function(){return PerspectiveCamera})),i.d(n,"Plane",(function(){return Plane})),i.d(n,"PlaneBufferGeometry",(function(){return PlaneBufferGeometry})),i.d(n,"PlaneGeometry",(function(){return PlaneGeometry})),i.d(n,"PlaneHelper",(function(){return PlaneHelper})),i.d(n,"PointCloud",(function(){return PointCloud})),i.d(n,"PointCloudMaterial",(function(){return PointCloudMaterial})),i.d(n,"PointLight",(function(){return PointLight})),i.d(n,"PointLightHelper",(function(){return PointLightHelper})),i.d(n,"Points",(function(){return Points})),i.d(n,"PointsMaterial",(function(){return PointsMaterial})),i.d(n,"PolarGridHelper",(function(){return PolarGridHelper})),i.d(n,"PolyhedronBufferGeometry",(function(){return PolyhedronBufferGeometry})),i.d(n,"PolyhedronGeometry",(function(){return PolyhedronGeometry})),i.d(n,"PositionalAudio",(function(){return PositionalAudio})),i.d(n,"PropertyBinding",(function(){return PropertyBinding})),i.d(n,"PropertyMixer",(function(){return PropertyMixer})),i.d(n,"QuadraticBezierCurve",(function(){return QuadraticBezierCurve})),i.d(n,"QuadraticBezierCurve3",(function(){return QuadraticBezierCurve3})),i.d(n,"Quaternion",(function(){return Quaternion})),i.d(n,"QuaternionKeyframeTrack",(function(){return QuaternionKeyframeTrack})),i.d(n,"QuaternionLinearInterpolant",(function(){return QuaternionLinearInterpolant})),i.d(n,"REVISION",(function(){return o})),i.d(n,"RGBADepthPacking",(function(){return On})),i.d(n,"RGBAFormat",(function(){return ot})),i.d(n,"RGBAIntegerFormat",(function(){return gt})),i.d(n,"RGBA_ASTC_10x10_Format",(function(){return Bt})),i.d(n,"RGBA_ASTC_10x5_Format",(function(){return jt})),i.d(n,"RGBA_ASTC_10x6_Format",(function(){return Ft})),i.d(n,"RGBA_ASTC_10x8_Format",(function(){return Dt})),i.d(n,"RGBA_ASTC_12x10_Format",(function(){return Vt})),i.d(n,"RGBA_ASTC_12x12_Format",(function(){return Ut})),i.d(n,"RGBA_ASTC_4x4_Format",(function(){return Ot})),i.d(n,"RGBA_ASTC_5x4_Format",(function(){return At})),i.d(n,"RGBA_ASTC_5x5_Format",(function(){return Pt})),i.d(n,"RGBA_ASTC_6x5_Format",(function(){return Lt})),i.d(n,"RGBA_ASTC_6x6_Format",(function(){return Rt})),i.d(n,"RGBA_ASTC_8x5_Format",(function(){return Nt})),i.d(n,"RGBA_ASTC_8x6_Format",(function(){return It})),i.d(n,"RGBA_ASTC_8x8_Format",(function(){return kt})),i.d(n,"RGBA_BPTC_Format",(function(){return Gt})),i.d(n,"RGBA_ETC2_EAC_Format",(function(){return Ct})),i.d(n,"RGBA_PVRTC_2BPPV1_Format",(function(){return Mt})),i.d(n,"RGBA_PVRTC_4BPPV1_Format",(function(){return St})),i.d(n,"RGBA_S3TC_DXT1_Format",(function(){return vt})),i.d(n,"RGBA_S3TC_DXT3_Format",(function(){return bt})),i.d(n,"RGBA_S3TC_DXT5_Format",(function(){return _t})),i.d(n,"RGBDEncoding",(function(){return Tn})),i.d(n,"RGBEEncoding",(function(){return xn})),i.d(n,"RGBEFormat",(function(){return ct})),i.d(n,"RGBFormat",(function(){return it})),i.d(n,"RGBIntegerFormat",(function(){return mt})),i.d(n,"RGBM16Encoding",(function(){return En})),i.d(n,"RGBM7Encoding",(function(){return Mn})),i.d(n,"RGB_ETC1_Format",(function(){return Et})),i.d(n,"RGB_ETC2_Format",(function(){return Tt})),i.d(n,"RGB_PVRTC_2BPPV1_Format",(function(){return xt})),i.d(n,"RGB_PVRTC_4BPPV1_Format",(function(){return wt})),i.d(n,"RGB_S3TC_DXT1_Format",(function(){return yt})),i.d(n,"RGFormat",(function(){return pt})),i.d(n,"RGIntegerFormat",(function(){return ft})),i.d(n,"RawShaderMaterial",(function(){return RawShaderMaterial})),i.d(n,"Ray",(function(){return Ray})),i.d(n,"Raycaster",(function(){return Raycaster})),i.d(n,"RectAreaLight",(function(){return RectAreaLight})),i.d(n,"RedFormat",(function(){return ht})),i.d(n,"RedIntegerFormat",(function(){return dt})),i.d(n,"ReinhardToneMapping",(function(){return we})),i.d(n,"RepeatWrapping",(function(){return Re})),i.d(n,"ReplaceStencilOp",(function(){return Nn})),i.d(n,"ReverseSubtractEquation",(function(){return X})),i.d(n,"RingBufferGeometry",(function(){return RingBufferGeometry})),i.d(n,"RingGeometry",(function(){return RingGeometry})),i.d(n,"SRGB8_ALPHA8_ASTC_10x10_Format",(function(){return en})),i.d(n,"SRGB8_ALPHA8_ASTC_10x5_Format",(function(){return Jt})),i.d(n,"SRGB8_ALPHA8_ASTC_10x6_Format",(function(){return Kt})),i.d(n,"SRGB8_ALPHA8_ASTC_10x8_Format",(function(){return $t})),i.d(n,"SRGB8_ALPHA8_ASTC_12x10_Format",(function(){return tn})),i.d(n,"SRGB8_ALPHA8_ASTC_12x12_Format",(function(){return nn})),i.d(n,"SRGB8_ALPHA8_ASTC_4x4_Format",(function(){return zt})),i.d(n,"SRGB8_ALPHA8_ASTC_5x4_Format",(function(){return Ht})),i.d(n,"SRGB8_ALPHA8_ASTC_5x5_Format",(function(){return Wt})),i.d(n,"SRGB8_ALPHA8_ASTC_6x5_Format",(function(){return qt})),i.d(n,"SRGB8_ALPHA8_ASTC_6x6_Format",(function(){return Zt})),i.d(n,"SRGB8_ALPHA8_ASTC_8x5_Format",(function(){return Xt})),i.d(n,"SRGB8_ALPHA8_ASTC_8x6_Format",(function(){return Qt})),i.d(n,"SRGB8_ALPHA8_ASTC_8x8_Format",(function(){return Yt})),i.d(n,"Scene",(function(){return Scene})),i.d(n,"SceneUtils",(function(){return As})),i.d(n,"ShaderChunk",(function(){return Xi})),i.d(n,"ShaderLib",(function(){return Yi})),i.d(n,"ShaderMaterial",(function(){return ShaderMaterial})),i.d(n,"ShadowMaterial",(function(){return ShadowMaterial})),i.d(n,"Shape",(function(){return Shape})),i.d(n,"ShapeBufferGeometry",(function(){return ShapeBufferGeometry})),i.d(n,"ShapeGeometry",(function(){return ShapeGeometry})),i.d(n,"ShapePath",(function(){return ShapePath})),i.d(n,"ShapeUtils",(function(){return oa})),i.d(n,"ShortType",(function(){return Ze})),i.d(n,"Skeleton",(function(){return Skeleton})),i.d(n,"SkeletonHelper",(function(){return SkeletonHelper})),i.d(n,"SkinnedMesh",(function(){return SkinnedMesh})),i.d(n,"SmoothShading",(function(){return I})),i.d(n,"Sphere",(function(){return Sphere})),i.d(n,"SphereBufferGeometry",(function(){return SphereBufferGeometry})),i.d(n,"SphereGeometry",(function(){return SphereGeometry})),i.d(n,"Spherical",(function(){return Spherical})),i.d(n,"SphericalHarmonics3",(function(){return SphericalHarmonics3})),i.d(n,"Spline",(function(){return Spline})),i.d(n,"SplineCurve",(function(){return SplineCurve})),i.d(n,"SplineCurve3",(function(){return SplineCurve3})),i.d(n,"SpotLight",(function(){return SpotLight})),i.d(n,"SpotLightHelper",(function(){return SpotLightHelper})),i.d(n,"Sprite",(function(){return Sprite})),i.d(n,"SpriteMaterial",(function(){return SpriteMaterial})),i.d(n,"SrcAlphaFactor",(function(){return te})),i.d(n,"SrcAlphaSaturateFactor",(function(){return se})),i.d(n,"SrcColorFactor",(function(){return $})),i.d(n,"StaticCopyUsage",(function(){return $n})),i.d(n,"StaticDrawUsage",(function(){return Zn})),i.d(n,"StaticReadUsage",(function(){return Yn})),i.d(n,"StereoCamera",(function(){return StereoCamera})),i.d(n,"StreamCopyUsage",(function(){return tr})),i.d(n,"StreamDrawUsage",(function(){return Qn})),i.d(n,"StreamReadUsage",(function(){return Kn})),i.d(n,"StringKeyframeTrack",(function(){return StringKeyframeTrack})),i.d(n,"SubtractEquation",(function(){return Z})),i.d(n,"SubtractiveBlending",(function(){return G})),i.d(n,"TOUCH",(function(){return s})),i.d(n,"TangentSpaceNormalMap",(function(){return An})),i.d(n,"TetrahedronBufferGeometry",(function(){return TetrahedronBufferGeometry})),i.d(n,"TetrahedronGeometry",(function(){return TetrahedronGeometry})),i.d(n,"TextBufferGeometry",(function(){return TextBufferGeometry})),i.d(n,"TextGeometry",(function(){return TextGeometry})),i.d(n,"Texture",(function(){return Texture})),i.d(n,"TextureLoader",(function(){return TextureLoader})),i.d(n,"TorusBufferGeometry",(function(){return TorusBufferGeometry})),i.d(n,"TorusGeometry",(function(){return TorusGeometry})),i.d(n,"TorusKnotBufferGeometry",(function(){return TorusKnotBufferGeometry})),i.d(n,"TorusKnotGeometry",(function(){return TorusKnotGeometry})),i.d(n,"Triangle",(function(){return Triangle})),i.d(n,"TriangleFanDrawMode",(function(){return vn})),i.d(n,"TriangleStripDrawMode",(function(){return yn})),i.d(n,"TrianglesDrawMode",(function(){return gn})),i.d(n,"TubeBufferGeometry",(function(){return TubeBufferGeometry})),i.d(n,"TubeGeometry",(function(){return TubeGeometry})),i.d(n,"UVMapping",(function(){return Ee})),i.d(n,"Uint16Attribute",(function(){return Uint16Attribute})),i.d(n,"Uint16BufferAttribute",(function(){return Uint16BufferAttribute})),i.d(n,"Uint32Attribute",(function(){return Uint32Attribute})),i.d(n,"Uint32BufferAttribute",(function(){return Uint32BufferAttribute})),i.d(n,"Uint8Attribute",(function(){return Uint8Attribute})),i.d(n,"Uint8BufferAttribute",(function(){return Uint8BufferAttribute})),i.d(n,"Uint8ClampedAttribute",(function(){return Uint8ClampedAttribute})),i.d(n,"Uint8ClampedBufferAttribute",(function(){return Uint8ClampedBufferAttribute})),i.d(n,"Uniform",(function(){return Uniform})),i.d(n,"UniformsLib",(function(){return Qi})),i.d(n,"UniformsUtils",(function(){return Wi})),i.d(n,"UnsignedByteType",(function(){return We})),i.d(n,"UnsignedInt248Type",(function(){return nt})),i.d(n,"UnsignedIntType",(function(){return Ye})),i.d(n,"UnsignedShort4444Type",(function(){return $e})),i.d(n,"UnsignedShort5551Type",(function(){return et})),i.d(n,"UnsignedShort565Type",(function(){return tt})),i.d(n,"UnsignedShortType",(function(){return Xe})),i.d(n,"VSMShadowMap",(function(){return A})),i.d(n,"Vector2",(function(){return Vector2})),i.d(n,"Vector3",(function(){return Vector3})),i.d(n,"Vector4",(function(){return Vector4})),i.d(n,"VectorKeyframeTrack",(function(){return VectorKeyframeTrack})),i.d(n,"Vertex",(function(){return Vertex})),i.d(n,"VertexColors",(function(){return Cs})),i.d(n,"VideoTexture",(function(){return VideoTexture})),i.d(n,"WebGL1Renderer",(function(){return WebGL1Renderer})),i.d(n,"WebGLCubeRenderTarget",(function(){return WebGLCubeRenderTarget})),i.d(n,"WebGLMultisampleRenderTarget",(function(){return WebGLMultisampleRenderTarget})),i.d(n,"WebGLRenderTarget",(function(){return WebGLRenderTarget})),i.d(n,"WebGLRenderTargetCube",(function(){return WebGLRenderTargetCube})),i.d(n,"WebGLRenderer",(function(){return WebGLRenderer})),i.d(n,"WebGLUtils",(function(){return WebGLUtils})),i.d(n,"WireframeGeometry",(function(){return WireframeGeometry})),i.d(n,"WireframeHelper",(function(){return WireframeHelper})),i.d(n,"WrapAroundEnding",(function(){return pn})),i.d(n,"XHRLoader",(function(){return XHRLoader})),i.d(n,"ZeroCurvatureEnding",(function(){return hn})),i.d(n,"ZeroFactor",(function(){return J})),i.d(n,"ZeroSlopeEnding",(function(){return dn})),i.d(n,"ZeroStencilOp",(function(){return Ln})),i.d(n,"sRGBEncoding",(function(){return _n}));const o="124",a={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},m=0,g=1,_=2,S=3,M=0,T=1,O=2,A=3,P=0,L=1,R=2,N=1,I=2,j=0,V=1,U=2,G=3,z=4,H=5,q=100,Z=101,X=102,Q=103,Y=104,J=200,K=201,$=202,ee=203,te=204,ne=205,re=206,ie=207,oe=208,ae=209,se=210,ce=0,ue=1,le=2,he=3,de=4,pe=5,fe=6,me=7,ge=0,ye=1,ve=2,be=0,_e=1,we=2,xe=3,Se=4,Me=5,Ee=300,Te=301,Ce=302,Oe=303,Ae=304,Pe=306,Le=307,Re=1e3,Ne=1001,Ie=1002,ke=1003,je=1004,Fe=1004,De=1005,Be=1005,Ve=1006,Ue=1007,Ge=1007,ze=1008,He=1008,We=1009,qe=1010,Ze=1011,Xe=1012,Qe=1013,Ye=1014,Je=1015,Ke=1016,$e=1017,et=1018,tt=1019,nt=1020,rt=1021,it=1022,ot=1023,at=1024,st=1025,ct=ot,ut=1026,lt=1027,ht=1028,dt=1029,pt=1030,ft=1031,mt=1032,gt=1033,yt=33776,vt=33777,bt=33778,_t=33779,wt=35840,xt=35841,St=35842,Mt=35843,Et=36196,Tt=37492,Ct=37496,Ot=37808,At=37809,Pt=37810,Lt=37811,Rt=37812,Nt=37813,It=37814,kt=37815,jt=37816,Ft=37817,Dt=37818,Bt=37819,Vt=37820,Ut=37821,Gt=36492,zt=37840,Ht=37841,Wt=37842,qt=37843,Zt=37844,Xt=37845,Qt=37846,Yt=37847,Jt=37848,Kt=37849,$t=37850,en=37851,tn=37852,nn=37853,rn=2200,an=2201,sn=2202,cn=2300,un=2301,ln=2302,hn=2400,dn=2401,pn=2402,fn=2500,mn=2501,gn=0,yn=1,vn=2,bn=3e3,_n=3001,wn=3007,xn=3002,Sn=3003,Mn=3004,En=3005,Tn=3006,Cn=3200,On=3201,An=0,Pn=1,Ln=0,Rn=7680,Nn=7681,In=7682,kn=7683,jn=34055,Fn=34056,Dn=5386,Bn=512,Vn=513,Un=514,Gn=515,zn=516,Hn=517,Wn=518,qn=519,Zn=35044,Xn=35048,Qn=35040,Yn=35045,Jn=35049,Kn=35041,$n=35046,er=35050,tr=35042,nr="100",rr="300 es";function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(t,n){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(n)&&i[t].push(n)},hasEventListener:function(t,n){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(n)},removeEventListener:function(t,n){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(n);-1!==t&&i.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const n=this._listeners[t.type];if(void 0!==n){t.target=this;const i=n.slice(0);for(let n=0,o=i.length;n<o;n++)i[n].call(this,t)}}});const ir=[];for(let t=0;t<256;t++)ir[t]=(t<16?"0":"")+t.toString(16);let or=1234567;const ar={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return(ir[255&t]+ir[t>>8&255]+ir[t>>16&255]+ir[t>>24&255]+"-"+ir[255&n]+ir[n>>8&255]+"-"+ir[n>>16&15|64]+ir[n>>24&255]+"-"+ir[63&i|128]+ir[i>>8&255]+"-"+ir[i>>16&255]+ir[i>>24&255]+ir[255&o]+ir[o>>8&255]+ir[o>>16&255]+ir[o>>24&255]).toUpperCase()},clamp:function(t,n,i){return Math.max(n,Math.min(i,t))},euclideanModulo:function(t,n){return(t%n+n)%n},mapLinear:function(t,n,i,o,a){return o+(t-n)*(a-o)/(i-n)},lerp:function(t,n,i){return(1-i)*t+i*n},smoothstep:function(t,n,i){return t<=n?0:t>=i?1:(t=(t-n)/(i-n))*t*(3-2*t)},smootherstep:function(t,n,i){return t<=n?0:t>=i?1:(t=(t-n)/(i-n))*t*t*(t*(6*t-15)+10)},randInt:function(t,n){return t+Math.floor(Math.random()*(n-t+1))},randFloat:function(t,n){return t+Math.random()*(n-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(or=t%2147483647),or=16807*or%2147483647,(or-1)/2147483646},degToRad:function(t){return t*ar.DEG2RAD},radToDeg:function(t){return t*ar.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,n,i,o,a){const s=Math.cos,m=Math.sin,g=s(i/2),_=m(i/2),S=s((n+o)/2),M=m((n+o)/2),T=s((n-o)/2),O=m((n-o)/2),A=s((o-n)/2),P=m((o-n)/2);switch(a){case"XYX":t.set(g*M,_*T,_*O,g*S);break;case"YZY":t.set(_*O,g*M,_*T,g*S);break;case"ZXZ":t.set(_*T,_*O,g*M,g*S);break;case"XZX":t.set(g*M,_*P,_*A,g*S);break;case"YXY":t.set(_*A,g*M,_*P,g*S);break;case"ZYZ":t.set(_*P,_*A,g*M,g*S);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}}};class Vector2{constructor(t=0,n=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,n){return void 0!==n?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t,n){return void 0!==n?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,i=this.y,o=t.elements;return this.x=o[0]*n+o[3]*i+o[6],this.y=o[1]*n+o[4]*i+o[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,i=this.y-t.y;return n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,i){return this.x=t.x+(n.x-t.x)*i,this.y=t.y+(n.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const i=Math.cos(n),o=Math.sin(n),a=this.x-t.x,s=this.y-t.y;return this.x=a*i-s*o+t.x,this.y=a*o+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class Matrix3{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,n,i,o,a,s,m,g,_){const S=this.elements;return S[0]=t,S[1]=o,S[2]=m,S[3]=n,S[4]=a,S[5]=g,S[6]=i,S[7]=s,S[8]=_,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const n=this.elements,i=t.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(t,n,i){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const i=t.elements,o=n.elements,a=this.elements,s=i[0],m=i[3],g=i[6],_=i[1],S=i[4],M=i[7],T=i[2],O=i[5],A=i[8],P=o[0],L=o[3],R=o[6],N=o[1],I=o[4],j=o[7],V=o[2],U=o[5],G=o[8];return a[0]=s*P+m*N+g*V,a[3]=s*L+m*I+g*U,a[6]=s*R+m*j+g*G,a[1]=_*P+S*N+M*V,a[4]=_*L+S*I+M*U,a[7]=_*R+S*j+M*G,a[2]=T*P+O*N+A*V,a[5]=T*L+O*I+A*U,a[8]=T*R+O*j+A*G,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],m=t[5],g=t[6],_=t[7],S=t[8];return n*s*S-n*m*_-i*a*S+i*m*g+o*a*_-o*s*g}invert(){const t=this.elements,n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],m=t[5],g=t[6],_=t[7],S=t[8],M=S*s-m*_,T=m*g-S*a,O=_*a-s*g,A=n*M+i*T+o*O;if(0===A)return this.set(0,0,0,0,0,0,0,0,0);const P=1/A;return t[0]=M*P,t[1]=(o*_-S*i)*P,t[2]=(m*i-o*s)*P,t[3]=T*P,t[4]=(S*n-o*g)*P,t[5]=(o*a-m*n)*P,t[6]=O*P,t[7]=(i*g-_*n)*P,t[8]=(s*n-i*a)*P,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,i,o,a,s,m){const g=Math.cos(a),_=Math.sin(a);return this.set(i*g,i*_,-i*(g*s+_*m)+s+t,-o*_,o*g,-o*(-_*s+g*m)+m+n,0,0,1),this}scale(t,n){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=n,i[4]*=n,i[7]*=n,this}rotate(t){const n=Math.cos(t),i=Math.sin(t),o=this.elements,a=o[0],s=o[3],m=o[6],g=o[1],_=o[4],S=o[7];return o[0]=n*a+i*g,o[3]=n*s+i*_,o[6]=n*m+i*S,o[1]=-i*a+n*g,o[4]=-i*s+n*_,o[7]=-i*m+n*S,this}translate(t,n){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=n*i[2],i[4]+=n*i[5],i[7]+=n*i[8],this}equals(t){const n=this.elements,i=t.elements;for(let t=0;t<9;t++)if(n[t]!==i[t])return!1;return!0}fromArray(t,n=0){for(let i=0;i<9;i++)this.elements[i]=t[i+n];return this}toArray(t=[],n=0){const i=this.elements;return t[n]=i[0],t[n+1]=i[1],t[n+2]=i[2],t[n+3]=i[3],t[n+4]=i[4],t[n+5]=i[5],t[n+6]=i[6],t[n+7]=i[7],t[n+8]=i[8],t}}let sr;const cr={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let n;if(t instanceof HTMLCanvasElement)n=t;else{void 0===sr&&(sr=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),sr.width=t.width,sr.height=t.height;const i=sr.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),n=sr}return n.width>2048||n.height>2048?n.toDataURL("image/jpeg",.6):n.toDataURL("image/png")}};let ur=0;function Texture(t=Texture.DEFAULT_IMAGE,n=Texture.DEFAULT_MAPPING,i=Ne,o=Ne,a=Ve,s=ze,m=ot,g=We,_=1,S=bn){Object.defineProperty(this,"id",{value:ur++}),this.uuid=ar.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=n,this.wrapS=i,this.wrapT=o,this.magFilter=a,this.minFilter=s,this.anisotropy=_,this.format=m,this.internalFormat=null,this.type=g,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=S,this.version=0,this.onUpdate=null}function serializeImage(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?cr.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=Ee,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const n=void 0===t||"string"==typeof t;if(!n&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const o=this.image;if(void 0===o.uuid&&(o.uuid=ar.generateUUID()),!n&&void 0===t.images[o.uuid]){let n;if(Array.isArray(o)){n=[];for(let t=0,i=o.length;t<i;t++)o[t].isDataTexture?n.push(serializeImage(o[t].image)):n.push(serializeImage(o[t]))}else n=serializeImage(o);t.images[o.uuid]={uuid:o.uuid,url:n}}i.image=o.uuid}return n||(t.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==Ee)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Re:t.x=t.x-Math.floor(t.x);break;case Ne:t.x=t.x<0?0:1;break;case Ie:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Re:t.y=t.y-Math.floor(t.y);break;case Ne:t.y=t.y<0?0:1;break;case Ie:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});class Vector4{constructor(t=0,n=0,i=0,o=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=n,this.z=i,this.w=o}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,n,i,o){return this.x=t,this.y=n,this.z=i,this.w=o,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,n){return void 0!==n?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this.w=t.w+n.w,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this.w+=t.w*n,this}sub(t,n){return void 0!==n?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this.w=t.w-n.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const n=this.x,i=this.y,o=this.z,a=this.w,s=t.elements;return this.x=s[0]*n+s[4]*i+s[8]*o+s[12]*a,this.y=s[1]*n+s[5]*i+s[9]*o+s[13]*a,this.z=s[2]*n+s[6]*i+s[10]*o+s[14]*a,this.w=s[3]*n+s[7]*i+s[11]*o+s[15]*a,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const n=Math.sqrt(1-t.w*t.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/n,this.y=t.y/n,this.z=t.z/n),this}setAxisAngleFromRotationMatrix(t){let n,i,o,a;const s=t.elements,m=s[0],g=s[4],_=s[8],S=s[1],M=s[5],T=s[9],O=s[2],A=s[6],P=s[10];if(Math.abs(g-S)<.01&&Math.abs(_-O)<.01&&Math.abs(T-A)<.01){if(Math.abs(g+S)<.1&&Math.abs(_+O)<.1&&Math.abs(T+A)<.1&&Math.abs(m+M+P-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const t=(m+1)/2,s=(M+1)/2,L=(P+1)/2,R=(g+S)/4,N=(_+O)/4,I=(T+A)/4;return t>s&&t>L?t<.01?(i=0,o=.707106781,a=.707106781):(i=Math.sqrt(t),o=R/i,a=N/i):s>L?s<.01?(i=.707106781,o=0,a=.707106781):(o=Math.sqrt(s),i=R/o,a=I/o):L<.01?(i=.707106781,o=.707106781,a=0):(a=Math.sqrt(L),i=N/a,o=I/a),this.set(i,o,a,n),this}let L=Math.sqrt((A-T)*(A-T)+(_-O)*(_-O)+(S-g)*(S-g));return Math.abs(L)<.001&&(L=1),this.x=(A-T)/L,this.y=(_-O)/L,this.z=(S-g)/L,this.w=Math.acos((m+M+P-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this.w=Math.max(t.w,Math.min(n.w,this.w)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this.w=Math.max(t,Math.min(n,this.w)),this}clampLength(t,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this.w+=(t.w-this.w)*n,this}lerpVectors(t,n,i){return this.x=t.x+(n.x-t.x)*i,this.y=t.y+(n.y-t.y)*i,this.z=t.z+(n.z-t.z)*i,this.w=t.w+(n.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this.z=t[n+2],this.w=t[n+3],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t[n+3]=this.w,t}fromBufferAttribute(t,n,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this.w=t.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function WebGLRenderTarget(t,n,i){this.width=t,this.height=n,this.scissor=new Vector4(0,0,t,n),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,n),i=i||{},this.texture=new Texture(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=n,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Ve,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function WebGLMultisampleRenderTarget(t,n,i){WebGLRenderTarget.call(this,t,n,i),this.samples=4}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(t,n){this.width===t&&this.height===n||(this.width=t,this.height=n,this.texture.image.width=t,this.texture.image.height=n,this.dispose()),this.viewport.set(0,0,t,n),this.scissor.set(0,0,t,n)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(t){return WebGLRenderTarget.prototype.copy.call(this,t),this.samples=t.samples,this}});class Quaternion{constructor(t=0,n=0,i=0,o=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=n,this._z=i,this._w=o}static slerp(t,n,i,o){return i.copy(t).slerp(n,o)}static slerpFlat(t,n,i,o,a,s,m){let g=i[o+0],_=i[o+1],S=i[o+2],M=i[o+3];const T=a[s+0],O=a[s+1],A=a[s+2],P=a[s+3];if(M!==P||g!==T||_!==O||S!==A){let t=1-m;const n=g*T+_*O+S*A+M*P,i=n>=0?1:-1,o=1-n*n;if(o>Number.EPSILON){const a=Math.sqrt(o),s=Math.atan2(a,n*i);t=Math.sin(t*s)/a,m=Math.sin(m*s)/a}const a=m*i;if(g=g*t+T*a,_=_*t+O*a,S=S*t+A*a,M=M*t+P*a,t===1-m){const t=1/Math.sqrt(g*g+_*_+S*S+M*M);g*=t,_*=t,S*=t,M*=t}}t[n]=g,t[n+1]=_,t[n+2]=S,t[n+3]=M}static multiplyQuaternionsFlat(t,n,i,o,a,s){const m=i[o],g=i[o+1],_=i[o+2],S=i[o+3],M=a[s],T=a[s+1],O=a[s+2],A=a[s+3];return t[n]=m*A+S*M+g*O-_*T,t[n+1]=g*A+S*T+_*M-m*O,t[n+2]=_*A+S*O+m*T-g*M,t[n+3]=S*A-m*M-g*T-_*O,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,n,i,o){return this._x=t,this._y=n,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,n){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,o=t._y,a=t._z,s=t._order,m=Math.cos,g=Math.sin,_=m(i/2),S=m(o/2),M=m(a/2),T=g(i/2),O=g(o/2),A=g(a/2);switch(s){case"XYZ":this._x=T*S*M+_*O*A,this._y=_*O*M-T*S*A,this._z=_*S*A+T*O*M,this._w=_*S*M-T*O*A;break;case"YXZ":this._x=T*S*M+_*O*A,this._y=_*O*M-T*S*A,this._z=_*S*A-T*O*M,this._w=_*S*M+T*O*A;break;case"ZXY":this._x=T*S*M-_*O*A,this._y=_*O*M+T*S*A,this._z=_*S*A+T*O*M,this._w=_*S*M-T*O*A;break;case"ZYX":this._x=T*S*M-_*O*A,this._y=_*O*M+T*S*A,this._z=_*S*A-T*O*M,this._w=_*S*M+T*O*A;break;case"YZX":this._x=T*S*M+_*O*A,this._y=_*O*M+T*S*A,this._z=_*S*A-T*O*M,this._w=_*S*M-T*O*A;break;case"XZY":this._x=T*S*M-_*O*A,this._y=_*O*M-T*S*A,this._z=_*S*A+T*O*M,this._w=_*S*M+T*O*A;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==n&&this._onChangeCallback(),this}setFromAxisAngle(t,n){const i=n/2,o=Math.sin(i);return this._x=t.x*o,this._y=t.y*o,this._z=t.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const n=t.elements,i=n[0],o=n[4],a=n[8],s=n[1],m=n[5],g=n[9],_=n[2],S=n[6],M=n[10],T=i+m+M;if(T>0){const t=.5/Math.sqrt(T+1);this._w=.25/t,this._x=(S-g)*t,this._y=(a-_)*t,this._z=(s-o)*t}else if(i>m&&i>M){const t=2*Math.sqrt(1+i-m-M);this._w=(S-g)/t,this._x=.25*t,this._y=(o+s)/t,this._z=(a+_)/t}else if(m>M){const t=2*Math.sqrt(1+m-i-M);this._w=(a-_)/t,this._x=(o+s)/t,this._y=.25*t,this._z=(g+S)/t}else{const t=2*Math.sqrt(1+M-i-m);this._w=(s-o)/t,this._x=(a+_)/t,this._y=(g+S)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,n){let i=t.dot(n)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*n.z-t.z*n.y,this._y=t.z*n.x-t.x*n.z,this._z=t.x*n.y-t.y*n.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ar.clamp(this.dot(t),-1,1)))}rotateTowards(t,n){const i=this.angleTo(t);if(0===i)return this;const o=Math.min(1,n/i);return this.slerp(t,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,n){return void 0!==n?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,n)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,n){const i=t._x,o=t._y,a=t._z,s=t._w,m=n._x,g=n._y,_=n._z,S=n._w;return this._x=i*S+s*m+o*_-a*g,this._y=o*S+s*g+a*m-i*_,this._z=a*S+s*_+i*g-o*m,this._w=s*S-i*m-o*g-a*_,this._onChangeCallback(),this}slerp(t,n){if(0===n)return this;if(1===n)return this.copy(t);const i=this._x,o=this._y,a=this._z,s=this._w;let m=s*t._w+i*t._x+o*t._y+a*t._z;if(m<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,m=-m):this.copy(t),m>=1)return this._w=s,this._x=i,this._y=o,this._z=a,this;const g=1-m*m;if(g<=Number.EPSILON){const t=1-n;return this._w=t*s+n*this._w,this._x=t*i+n*this._x,this._y=t*o+n*this._y,this._z=t*a+n*this._z,this.normalize(),this._onChangeCallback(),this}const _=Math.sqrt(g),S=Math.atan2(_,m),M=Math.sin((1-n)*S)/_,T=Math.sin(n*S)/_;return this._w=s*M+this._w*T,this._x=i*M+this._x*T,this._y=o*M+this._y*T,this._z=a*M+this._z*T,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,n=0){return this._x=t[n],this._y=t[n+1],this._z=t[n+2],this._w=t[n+3],this._onChangeCallback(),this}toArray(t=[],n=0){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t[n+3]=this._w,t}fromBufferAttribute(t,n){return this._x=t.getX(n),this._y=t.getY(n),this._z=t.getZ(n),this._w=t.getW(n),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class Vector3{constructor(t=0,n=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=n,this.z=i}set(t,n,i){return void 0===i&&(i=this.z),this.x=t,this.y=n,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,n){return void 0!==n?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this}sub(t,n){return void 0!==n?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this}multiply(t,n){return void 0!==n?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,n)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,n){return this.x=t.x*n.x,this.y=t.y*n.y,this.z=t.z*n.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(hr.setFromEuler(t))}applyAxisAngle(t,n){return this.applyQuaternion(hr.setFromAxisAngle(t,n))}applyMatrix3(t){const n=this.x,i=this.y,o=this.z,a=t.elements;return this.x=a[0]*n+a[3]*i+a[6]*o,this.y=a[1]*n+a[4]*i+a[7]*o,this.z=a[2]*n+a[5]*i+a[8]*o,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const n=this.x,i=this.y,o=this.z,a=t.elements,s=1/(a[3]*n+a[7]*i+a[11]*o+a[15]);return this.x=(a[0]*n+a[4]*i+a[8]*o+a[12])*s,this.y=(a[1]*n+a[5]*i+a[9]*o+a[13])*s,this.z=(a[2]*n+a[6]*i+a[10]*o+a[14])*s,this}applyQuaternion(t){const n=this.x,i=this.y,o=this.z,a=t.x,s=t.y,m=t.z,g=t.w,_=g*n+s*o-m*i,S=g*i+m*n-a*o,M=g*o+a*i-s*n,T=-a*n-s*i-m*o;return this.x=_*g+T*-a+S*-m-M*-s,this.y=S*g+T*-s+M*-a-_*-m,this.z=M*g+T*-m+_*-s-S*-a,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const n=this.x,i=this.y,o=this.z,a=t.elements;return this.x=a[0]*n+a[4]*i+a[8]*o,this.y=a[1]*n+a[5]*i+a[9]*o,this.z=a[2]*n+a[6]*i+a[10]*o,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this}clampLength(t,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this}lerpVectors(t,n,i){return this.x=t.x+(n.x-t.x)*i,this.y=t.y+(n.y-t.y)*i,this.z=t.z+(n.z-t.z)*i,this}cross(t,n){return void 0!==n?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,n)):this.crossVectors(this,t)}crossVectors(t,n){const i=t.x,o=t.y,a=t.z,s=n.x,m=n.y,g=n.z;return this.x=o*g-a*m,this.y=a*s-i*g,this.z=i*m-o*s,this}projectOnVector(t){const n=t.lengthSq();if(0===n)return this.set(0,0,0);const i=t.dot(this)/n;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return lr.copy(this).projectOnVector(t),this.sub(lr)}reflect(t){return this.sub(lr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===n)return Math.PI/2;const i=this.dot(t)/n;return Math.acos(ar.clamp(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,i=this.y-t.y,o=this.z-t.z;return n*n+i*i+o*o}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,n,i){const o=Math.sin(n)*t;return this.x=o*Math.sin(i),this.y=Math.cos(n)*t,this.z=o*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,n,i){return this.x=t*Math.sin(n),this.y=i,this.z=t*Math.cos(n),this}setFromMatrixPosition(t){const n=t.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(t){const n=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),o=this.setFromMatrixColumn(t,2).length();return this.x=n,this.y=i,this.z=o,this}setFromMatrixColumn(t,n){return this.fromArray(t.elements,4*n)}setFromMatrix3Column(t,n){return this.fromArray(t.elements,3*n)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this.z=t[n+2],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t}fromBufferAttribute(t,n,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const lr=new Vector3,hr=new Quaternion;class Box3{constructor(t,n){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new Vector3(1/0,1/0,1/0),this.max=void 0!==n?n:new Vector3(-1/0,-1/0,-1/0)}set(t,n){return this.min.copy(t),this.max.copy(n),this}setFromArray(t){let n=1/0,i=1/0,o=1/0,a=-1/0,s=-1/0,m=-1/0;for(let g=0,_=t.length;g<_;g+=3){const _=t[g],S=t[g+1],M=t[g+2];_<n&&(n=_),S<i&&(i=S),M<o&&(o=M),_>a&&(a=_),S>s&&(s=S),M>m&&(m=M)}return this.min.set(n,i,o),this.max.set(a,s,m),this}setFromBufferAttribute(t){let n=1/0,i=1/0,o=1/0,a=-1/0,s=-1/0,m=-1/0;for(let g=0,_=t.count;g<_;g++){const _=t.getX(g),S=t.getY(g),M=t.getZ(g);_<n&&(n=_),S<i&&(i=S),M<o&&(o=M),_>a&&(a=_),S>s&&(s=S),M>m&&(m=M)}return this.min.set(n,i,o),this.max.set(a,s,m),this}setFromPoints(t){this.makeEmpty();for(let n=0,i=t.length;n<i;n++)this.expandByPoint(t[n]);return this}setFromCenterAndSize(t,n){const i=pr.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Vector3),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Vector3),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const n=t.geometry;void 0!==n&&(null===n.boundingBox&&n.computeBoundingBox(),fr.copy(n.boundingBox),fr.applyMatrix4(t.matrixWorld),this.union(fr));const i=t.children;for(let t=0,n=i.length;t<n;t++)this.expandByObject(i[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,n){return void 0===n&&(console.warn("THREE.Box3: .getParameter() target is now required"),n=new Vector3),n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,pr),pr.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let n,i;return t.normal.x>0?(n=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(n=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(n+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(n+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(n+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(n+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),n<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(wr),xr.subVectors(this.max,wr),mr.subVectors(t.a,wr),gr.subVectors(t.b,wr),yr.subVectors(t.c,wr),vr.subVectors(gr,mr),br.subVectors(yr,gr),_r.subVectors(mr,yr);let n=[0,-vr.z,vr.y,0,-br.z,br.y,0,-_r.z,_r.y,vr.z,0,-vr.x,br.z,0,-br.x,_r.z,0,-_r.x,-vr.y,vr.x,0,-br.y,br.x,0,-_r.y,_r.x,0];return!!satForAxes(n,mr,gr,yr,xr)&&(n=[1,0,0,0,1,0,0,0,1],!!satForAxes(n,mr,gr,yr,xr)&&(Sr.crossVectors(vr,br),n=[Sr.x,Sr.y,Sr.z],satForAxes(n,mr,gr,yr,xr)))}clampPoint(t,n){return void 0===n&&(console.warn("THREE.Box3: .clampPoint() target is now required"),n=new Vector3),n.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return pr.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(pr).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(dr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),dr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),dr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),dr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),dr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),dr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),dr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),dr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(dr)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function satForAxes(t,n,i,o,a){for(let s=0,m=t.length-3;s<=m;s+=3){Mr.fromArray(t,s);const m=a.x*Math.abs(Mr.x)+a.y*Math.abs(Mr.y)+a.z*Math.abs(Mr.z),g=n.dot(Mr),_=i.dot(Mr),S=o.dot(Mr);if(Math.max(-Math.max(g,_,S),Math.min(g,_,S))>m)return!1}return!0}const dr=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],pr=new Vector3,fr=new Box3,mr=new Vector3,gr=new Vector3,yr=new Vector3,vr=new Vector3,br=new Vector3,_r=new Vector3,wr=new Vector3,xr=new Vector3,Sr=new Vector3,Mr=new Vector3,Er=new Box3;class Sphere{constructor(t,n){this.center=void 0!==t?t:new Vector3,this.radius=void 0!==n?n:-1}set(t,n){return this.center.copy(t),this.radius=n,this}setFromPoints(t,n){const i=this.center;void 0!==n?i.copy(n):Er.setFromPoints(t).getCenter(i);let o=0;for(let n=0,a=t.length;n<a;n++)o=Math.max(o,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(o),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const n=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=n*n}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,n){const i=this.center.distanceToSquared(t);return void 0===n&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),n=new Vector3),n.copy(t),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Box3),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const Tr=new Vector3,Cr=new Vector3,Or=new Vector3,Ar=new Vector3,Pr=new Vector3,Lr=new Vector3,Rr=new Vector3;class Ray{constructor(t,n){this.origin=void 0!==t?t:new Vector3,this.direction=void 0!==n?n:new Vector3(0,0,-1)}set(t,n){return this.origin.copy(t),this.direction.copy(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,n){return void 0===n&&(console.warn("THREE.Ray: .at() target is now required"),n=new Vector3),n.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Tr)),this}closestPointToPoint(t,n){void 0===n&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),n=new Vector3),n.subVectors(t,this.origin);const i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const n=Tr.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(t):(Tr.copy(this.direction).multiplyScalar(n).add(this.origin),Tr.distanceToSquared(t))}distanceSqToSegment(t,n,i,o){Cr.copy(t).add(n).multiplyScalar(.5),Or.copy(n).sub(t).normalize(),Ar.copy(this.origin).sub(Cr);const a=.5*t.distanceTo(n),s=-this.direction.dot(Or),m=Ar.dot(this.direction),g=-Ar.dot(Or),_=Ar.lengthSq(),S=Math.abs(1-s*s);let M,T,O,A;if(S>0)if(M=s*g-m,T=s*m-g,A=a*S,M>=0)if(T>=-A)if(T<=A){const t=1/S;M*=t,T*=t,O=M*(M+s*T+2*m)+T*(s*M+T+2*g)+_}else T=a,M=Math.max(0,-(s*T+m)),O=-M*M+T*(T+2*g)+_;else T=-a,M=Math.max(0,-(s*T+m)),O=-M*M+T*(T+2*g)+_;else T<=-A?(M=Math.max(0,-(-s*a+m)),T=M>0?-a:Math.min(Math.max(-a,-g),a),O=-M*M+T*(T+2*g)+_):T<=A?(M=0,T=Math.min(Math.max(-a,-g),a),O=T*(T+2*g)+_):(M=Math.max(0,-(s*a+m)),T=M>0?a:Math.min(Math.max(-a,-g),a),O=-M*M+T*(T+2*g)+_);else T=s>0?-a:a,M=Math.max(0,-(s*T+m)),O=-M*M+T*(T+2*g)+_;return i&&i.copy(this.direction).multiplyScalar(M).add(this.origin),o&&o.copy(Or).multiplyScalar(T).add(Cr),O}intersectSphere(t,n){Tr.subVectors(t.center,this.origin);const i=Tr.dot(this.direction),o=Tr.dot(Tr)-i*i,a=t.radius*t.radius;if(o>a)return null;const s=Math.sqrt(a-o),m=i-s,g=i+s;return m<0&&g<0?null:m<0?this.at(g,n):this.at(m,n)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const n=t.normal.dot(this.direction);if(0===n)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/n;return i>=0?i:null}intersectPlane(t,n){const i=this.distanceToPlane(t);return null===i?null:this.at(i,n)}intersectsPlane(t){const n=t.distanceToPoint(this.origin);return 0===n||t.normal.dot(this.direction)*n<0}intersectBox(t,n){let i,o,a,s,m,g;const _=1/this.direction.x,S=1/this.direction.y,M=1/this.direction.z,T=this.origin;return _>=0?(i=(t.min.x-T.x)*_,o=(t.max.x-T.x)*_):(i=(t.max.x-T.x)*_,o=(t.min.x-T.x)*_),S>=0?(a=(t.min.y-T.y)*S,s=(t.max.y-T.y)*S):(a=(t.max.y-T.y)*S,s=(t.min.y-T.y)*S),i>s||a>o?null:((a>i||i!=i)&&(i=a),(s<o||o!=o)&&(o=s),M>=0?(m=(t.min.z-T.z)*M,g=(t.max.z-T.z)*M):(m=(t.max.z-T.z)*M,g=(t.min.z-T.z)*M),i>g||m>o?null:((m>i||i!=i)&&(i=m),(g<o||o!=o)&&(o=g),o<0?null:this.at(i>=0?i:o,n)))}intersectsBox(t){return null!==this.intersectBox(t,Tr)}intersectTriangle(t,n,i,o,a){Pr.subVectors(n,t),Lr.subVectors(i,t),Rr.crossVectors(Pr,Lr);let s,m=this.direction.dot(Rr);if(m>0){if(o)return null;s=1}else{if(!(m<0))return null;s=-1,m=-m}Ar.subVectors(this.origin,t);const g=s*this.direction.dot(Lr.crossVectors(Ar,Lr));if(g<0)return null;const _=s*this.direction.dot(Pr.cross(Ar));if(_<0)return null;if(g+_>m)return null;const S=-s*Ar.dot(Rr);return S<0?null:this.at(S/m,a)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class Matrix4{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,n,i,o,a,s,m,g,_,S,M,T,O,A,P,L){const R=this.elements;return R[0]=t,R[4]=n,R[8]=i,R[12]=o,R[1]=a,R[5]=s,R[9]=m,R[13]=g,R[2]=_,R[6]=S,R[10]=M,R[14]=T,R[3]=O,R[7]=A,R[11]=P,R[15]=L,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(t){const n=this.elements,i=t.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(t){const n=this.elements,i=t.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}extractBasis(t,n,i){return t.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,n,i){return this.set(t.x,n.x,i.x,0,t.y,n.y,i.y,0,t.z,n.z,i.z,0,0,0,0,1),this}extractRotation(t){const n=this.elements,i=t.elements,o=1/Nr.setFromMatrixColumn(t,0).length(),a=1/Nr.setFromMatrixColumn(t,1).length(),s=1/Nr.setFromMatrixColumn(t,2).length();return n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o,n[3]=0,n[4]=i[4]*a,n[5]=i[5]*a,n[6]=i[6]*a,n[7]=0,n[8]=i[8]*s,n[9]=i[9]*s,n[10]=i[10]*s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const n=this.elements,i=t.x,o=t.y,a=t.z,s=Math.cos(i),m=Math.sin(i),g=Math.cos(o),_=Math.sin(o),S=Math.cos(a),M=Math.sin(a);if("XYZ"===t.order){const t=s*S,i=s*M,o=m*S,a=m*M;n[0]=g*S,n[4]=-g*M,n[8]=_,n[1]=i+o*_,n[5]=t-a*_,n[9]=-m*g,n[2]=a-t*_,n[6]=o+i*_,n[10]=s*g}else if("YXZ"===t.order){const t=g*S,i=g*M,o=_*S,a=_*M;n[0]=t+a*m,n[4]=o*m-i,n[8]=s*_,n[1]=s*M,n[5]=s*S,n[9]=-m,n[2]=i*m-o,n[6]=a+t*m,n[10]=s*g}else if("ZXY"===t.order){const t=g*S,i=g*M,o=_*S,a=_*M;n[0]=t-a*m,n[4]=-s*M,n[8]=o+i*m,n[1]=i+o*m,n[5]=s*S,n[9]=a-t*m,n[2]=-s*_,n[6]=m,n[10]=s*g}else if("ZYX"===t.order){const t=s*S,i=s*M,o=m*S,a=m*M;n[0]=g*S,n[4]=o*_-i,n[8]=t*_+a,n[1]=g*M,n[5]=a*_+t,n[9]=i*_-o,n[2]=-_,n[6]=m*g,n[10]=s*g}else if("YZX"===t.order){const t=s*g,i=s*_,o=m*g,a=m*_;n[0]=g*S,n[4]=a-t*M,n[8]=o*M+i,n[1]=M,n[5]=s*S,n[9]=-m*S,n[2]=-_*S,n[6]=i*M+o,n[10]=t-a*M}else if("XZY"===t.order){const t=s*g,i=s*_,o=m*g,a=m*_;n[0]=g*S,n[4]=-M,n[8]=_*S,n[1]=t*M+a,n[5]=s*S,n[9]=i*M-o,n[2]=o*M-i,n[6]=m*S,n[10]=a*M+t}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(t){return this.compose(kr,t,jr)}lookAt(t,n,i){const o=this.elements;return Br.subVectors(t,n),0===Br.lengthSq()&&(Br.z=1),Br.normalize(),Fr.crossVectors(i,Br),0===Fr.lengthSq()&&(1===Math.abs(i.z)?Br.x+=1e-4:Br.z+=1e-4,Br.normalize(),Fr.crossVectors(i,Br)),Fr.normalize(),Dr.crossVectors(Br,Fr),o[0]=Fr.x,o[4]=Dr.x,o[8]=Br.x,o[1]=Fr.y,o[5]=Dr.y,o[9]=Br.y,o[2]=Fr.z,o[6]=Dr.z,o[10]=Br.z,this}multiply(t,n){return void 0!==n?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,n)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const i=t.elements,o=n.elements,a=this.elements,s=i[0],m=i[4],g=i[8],_=i[12],S=i[1],M=i[5],T=i[9],O=i[13],A=i[2],P=i[6],L=i[10],R=i[14],N=i[3],I=i[7],j=i[11],V=i[15],U=o[0],G=o[4],z=o[8],H=o[12],q=o[1],Z=o[5],X=o[9],Q=o[13],Y=o[2],J=o[6],K=o[10],$=o[14],ee=o[3],te=o[7],ne=o[11],re=o[15];return a[0]=s*U+m*q+g*Y+_*ee,a[4]=s*G+m*Z+g*J+_*te,a[8]=s*z+m*X+g*K+_*ne,a[12]=s*H+m*Q+g*$+_*re,a[1]=S*U+M*q+T*Y+O*ee,a[5]=S*G+M*Z+T*J+O*te,a[9]=S*z+M*X+T*K+O*ne,a[13]=S*H+M*Q+T*$+O*re,a[2]=A*U+P*q+L*Y+R*ee,a[6]=A*G+P*Z+L*J+R*te,a[10]=A*z+P*X+L*K+R*ne,a[14]=A*H+P*Q+L*$+R*re,a[3]=N*U+I*q+j*Y+V*ee,a[7]=N*G+I*Z+j*J+V*te,a[11]=N*z+I*X+j*K+V*ne,a[15]=N*H+I*Q+j*$+V*re,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[4]*=t,n[8]*=t,n[12]*=t,n[1]*=t,n[5]*=t,n[9]*=t,n[13]*=t,n[2]*=t,n[6]*=t,n[10]*=t,n[14]*=t,n[3]*=t,n[7]*=t,n[11]*=t,n[15]*=t,this}determinant(){const t=this.elements,n=t[0],i=t[4],o=t[8],a=t[12],s=t[1],m=t[5],g=t[9],_=t[13],S=t[2],M=t[6],T=t[10],O=t[14];return t[3]*(+a*g*M-o*_*M-a*m*T+i*_*T+o*m*O-i*g*O)+t[7]*(+n*g*O-n*_*T+a*s*T-o*s*O+o*_*S-a*g*S)+t[11]*(+n*_*M-n*m*O-a*s*M+i*s*O+a*m*S-i*_*S)+t[15]*(-o*m*S-n*g*M+n*m*T+o*s*M-i*s*T+i*g*S)}transpose(){const t=this.elements;let n;return n=t[1],t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,this}setPosition(t,n,i){const o=this.elements;return t.isVector3?(o[12]=t.x,o[13]=t.y,o[14]=t.z):(o[12]=t,o[13]=n,o[14]=i),this}invert(){const t=this.elements,n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],m=t[5],g=t[6],_=t[7],S=t[8],M=t[9],T=t[10],O=t[11],A=t[12],P=t[13],L=t[14],R=t[15],N=M*L*_-P*T*_+P*g*O-m*L*O-M*g*R+m*T*R,I=A*T*_-S*L*_-A*g*O+s*L*O+S*g*R-s*T*R,j=S*P*_-A*M*_+A*m*O-s*P*O-S*m*R+s*M*R,V=A*M*g-S*P*g-A*m*T+s*P*T+S*m*L-s*M*L,U=n*N+i*I+o*j+a*V;if(0===U)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const G=1/U;return t[0]=N*G,t[1]=(P*T*a-M*L*a-P*o*O+i*L*O+M*o*R-i*T*R)*G,t[2]=(m*L*a-P*g*a+P*o*_-i*L*_-m*o*R+i*g*R)*G,t[3]=(M*g*a-m*T*a-M*o*_+i*T*_+m*o*O-i*g*O)*G,t[4]=I*G,t[5]=(S*L*a-A*T*a+A*o*O-n*L*O-S*o*R+n*T*R)*G,t[6]=(A*g*a-s*L*a-A*o*_+n*L*_+s*o*R-n*g*R)*G,t[7]=(s*T*a-S*g*a+S*o*_-n*T*_-s*o*O+n*g*O)*G,t[8]=j*G,t[9]=(A*M*a-S*P*a-A*i*O+n*P*O+S*i*R-n*M*R)*G,t[10]=(s*P*a-A*m*a+A*i*_-n*P*_-s*i*R+n*m*R)*G,t[11]=(S*m*a-s*M*a-S*i*_+n*M*_+s*i*O-n*m*O)*G,t[12]=V*G,t[13]=(S*P*o-A*M*o+A*i*T-n*P*T-S*i*L+n*M*L)*G,t[14]=(A*m*o-s*P*o-A*i*g+n*P*g+s*i*L-n*m*L)*G,t[15]=(s*M*o-S*m*o+S*i*g-n*M*g-s*i*T+n*m*T)*G,this}scale(t){const n=this.elements,i=t.x,o=t.y,a=t.z;return n[0]*=i,n[4]*=o,n[8]*=a,n[1]*=i,n[5]*=o,n[9]*=a,n[2]*=i,n[6]*=o,n[10]*=a,n[3]*=i,n[7]*=o,n[11]*=a,this}getMaxScaleOnAxis(){const t=this.elements,n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],o=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(n,i,o))}makeTranslation(t,n,i){return this.set(1,0,0,t,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(t){const n=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(t){const n=Math.cos(t),i=Math.sin(t);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(t){const n=Math.cos(t),i=Math.sin(t);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,n){const i=Math.cos(n),o=Math.sin(n),a=1-i,s=t.x,m=t.y,g=t.z,_=a*s,S=a*m;return this.set(_*s+i,_*m-o*g,_*g+o*m,0,_*m+o*g,S*m+i,S*g-o*s,0,_*g-o*m,S*g+o*s,a*g*g+i,0,0,0,0,1),this}makeScale(t,n,i){return this.set(t,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,n,i){return this.set(1,n,i,0,t,1,i,0,t,n,1,0,0,0,0,1),this}compose(t,n,i){const o=this.elements,a=n._x,s=n._y,m=n._z,g=n._w,_=a+a,S=s+s,M=m+m,T=a*_,O=a*S,A=a*M,P=s*S,L=s*M,R=m*M,N=g*_,I=g*S,j=g*M,V=i.x,U=i.y,G=i.z;return o[0]=(1-(P+R))*V,o[1]=(O+j)*V,o[2]=(A-I)*V,o[3]=0,o[4]=(O-j)*U,o[5]=(1-(T+R))*U,o[6]=(L+N)*U,o[7]=0,o[8]=(A+I)*G,o[9]=(L-N)*G,o[10]=(1-(T+P))*G,o[11]=0,o[12]=t.x,o[13]=t.y,o[14]=t.z,o[15]=1,this}decompose(t,n,i){const o=this.elements;let a=Nr.set(o[0],o[1],o[2]).length();const s=Nr.set(o[4],o[5],o[6]).length(),m=Nr.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),t.x=o[12],t.y=o[13],t.z=o[14],Ir.copy(this);const g=1/a,_=1/s,S=1/m;return Ir.elements[0]*=g,Ir.elements[1]*=g,Ir.elements[2]*=g,Ir.elements[4]*=_,Ir.elements[5]*=_,Ir.elements[6]*=_,Ir.elements[8]*=S,Ir.elements[9]*=S,Ir.elements[10]*=S,n.setFromRotationMatrix(Ir),i.x=a,i.y=s,i.z=m,this}makePerspective(t,n,i,o,a,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const m=this.elements,g=2*a/(n-t),_=2*a/(i-o),S=(n+t)/(n-t),M=(i+o)/(i-o),T=-(s+a)/(s-a),O=-2*s*a/(s-a);return m[0]=g,m[4]=0,m[8]=S,m[12]=0,m[1]=0,m[5]=_,m[9]=M,m[13]=0,m[2]=0,m[6]=0,m[10]=T,m[14]=O,m[3]=0,m[7]=0,m[11]=-1,m[15]=0,this}makeOrthographic(t,n,i,o,a,s){const m=this.elements,g=1/(n-t),_=1/(i-o),S=1/(s-a),M=(n+t)*g,T=(i+o)*_,O=(s+a)*S;return m[0]=2*g,m[4]=0,m[8]=0,m[12]=-M,m[1]=0,m[5]=2*_,m[9]=0,m[13]=-T,m[2]=0,m[6]=0,m[10]=-2*S,m[14]=-O,m[3]=0,m[7]=0,m[11]=0,m[15]=1,this}equals(t){const n=this.elements,i=t.elements;for(let t=0;t<16;t++)if(n[t]!==i[t])return!1;return!0}fromArray(t,n=0){for(let i=0;i<16;i++)this.elements[i]=t[i+n];return this}toArray(t=[],n=0){const i=this.elements;return t[n]=i[0],t[n+1]=i[1],t[n+2]=i[2],t[n+3]=i[3],t[n+4]=i[4],t[n+5]=i[5],t[n+6]=i[6],t[n+7]=i[7],t[n+8]=i[8],t[n+9]=i[9],t[n+10]=i[10],t[n+11]=i[11],t[n+12]=i[12],t[n+13]=i[13],t[n+14]=i[14],t[n+15]=i[15],t}}const Nr=new Vector3,Ir=new Matrix4,kr=new Vector3(0,0,0),jr=new Vector3(1,1,1),Fr=new Vector3,Dr=new Vector3,Br=new Vector3;class Euler{constructor(t=0,n=0,i=0,o=Euler.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=n,this._z=i,this._order=o}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,n,i,o){return this._x=t,this._y=n,this._z=i,this._order=o||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,n,i){const o=ar.clamp,a=t.elements,s=a[0],m=a[4],g=a[8],_=a[1],S=a[5],M=a[9],T=a[2],O=a[6],A=a[10];switch(n=n||this._order){case"XYZ":this._y=Math.asin(o(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(-M,A),this._z=Math.atan2(-m,s)):(this._x=Math.atan2(O,S),this._z=0);break;case"YXZ":this._x=Math.asin(-o(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(g,A),this._z=Math.atan2(_,S)):(this._y=Math.atan2(-T,s),this._z=0);break;case"ZXY":this._x=Math.asin(o(O,-1,1)),Math.abs(O)<.9999999?(this._y=Math.atan2(-T,A),this._z=Math.atan2(-m,S)):(this._y=0,this._z=Math.atan2(_,s));break;case"ZYX":this._y=Math.asin(-o(T,-1,1)),Math.abs(T)<.9999999?(this._x=Math.atan2(O,A),this._z=Math.atan2(_,s)):(this._x=0,this._z=Math.atan2(-m,S));break;case"YZX":this._z=Math.asin(o(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-M,S),this._y=Math.atan2(-T,s)):(this._x=0,this._y=Math.atan2(g,A));break;case"XZY":this._z=Math.asin(-o(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(O,S),this._y=Math.atan2(g,s)):(this._x=Math.atan2(-M,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(t,n,i){return Vr.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Vr,n,i)}setFromVector3(t,n){return this.set(t.x,t.y,t.z,n||this._order)}reorder(t){return Ur.setFromEuler(this),this.setFromQuaternion(Ur,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],n=0){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t[n+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Vr=new Matrix4,Ur=new Quaternion;class Layers{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Gr=0;const zr=new Vector3,Hr=new Quaternion,Wr=new Matrix4,qr=new Vector3,Zr=new Vector3,Xr=new Vector3,Qr=new Quaternion,Yr=new Vector3(1,0,0),Jr=new Vector3(0,1,0),Kr=new Vector3(0,0,1),$r={type:"added"},ei={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:Gr++}),this.uuid=ar.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const t=new Vector3,n=new Euler,i=new Quaternion,o=new Vector3(1,1,1);n._onChange((function onRotationChange(){i.setFromEuler(n,!1)})),i._onChange((function onQuaternionChange(){n.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,n){this.quaternion.setFromAxisAngle(t,n)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,n){return Hr.setFromAxisAngle(t,n),this.quaternion.multiply(Hr),this},rotateOnWorldAxis:function(t,n){return Hr.setFromAxisAngle(t,n),this.quaternion.premultiply(Hr),this},rotateX:function(t){return this.rotateOnAxis(Yr,t)},rotateY:function(t){return this.rotateOnAxis(Jr,t)},rotateZ:function(t){return this.rotateOnAxis(Kr,t)},translateOnAxis:function(t,n){return zr.copy(t).applyQuaternion(this.quaternion),this.position.add(zr.multiplyScalar(n)),this},translateX:function(t){return this.translateOnAxis(Yr,t)},translateY:function(t){return this.translateOnAxis(Jr,t)},translateZ:function(t){return this.translateOnAxis(Kr,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Wr.copy(this.matrixWorld).invert())},lookAt:function(t,n,i){t.isVector3?qr.copy(t):qr.set(t,n,i);const o=this.parent;this.updateWorldMatrix(!0,!1),Zr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Wr.lookAt(Zr,qr,this.up):Wr.lookAt(qr,Zr,this.up),this.quaternion.setFromRotationMatrix(Wr),o&&(Wr.extractRotation(o.matrixWorld),Hr.setFromRotationMatrix(Wr),this.quaternion.premultiply(Hr.invert()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent($r)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const n=this.children.indexOf(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(ei)),this},clear:function(){for(let t=0;t<this.children.length;t++){const n=this.children[t];n.parent=null,n.dispatchEvent(ei)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),Wr.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Wr.multiply(t.parent.matrixWorld)),t.applyMatrix4(Wr),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,n){if(this[t]===n)return this;for(let i=0,o=this.children.length;i<o;i++){const o=this.children[i].getObjectByProperty(t,n);if(void 0!==o)return o}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Vector3),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Quaternion),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zr,t,Xr),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Vector3),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zr,Qr,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Vector3),this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return t.set(n[8],n[9],n[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].traverseVisible(t)},traverseAncestors:function(t){const n=this.parent;null!==n&&(t(n),n.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].updateMatrixWorld(t)},updateWorldMatrix:function(t,n){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===n){const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateWorldMatrix(!1,!0)}},toJSON:function(t){const n=void 0===t||"string"==typeof t,i={};n&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const o={};function serialize(n,i){return void 0===n[i.uuid]&&(n[i.uuid]=i.toJSON(t)),i.uuid}if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){o.geometry=serialize(t.geometries,this.geometry);const n=this.geometry.parameters;if(void 0!==n&&void 0!==n.shapes){const i=n.shapes;if(Array.isArray(i))for(let n=0,o=i.length;n<o;n++){const o=i[n];serialize(t.shapes,o)}else serialize(t.shapes,i)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(serialize(t.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const n=[];for(let i=0,o=this.material.length;i<o;i++)n.push(serialize(t.materials,this.material[i]));o.material=n}else o.material=serialize(t.materials,this.material);if(this.children.length>0){o.children=[];for(let n=0;n<this.children.length;n++)o.children.push(this.children[n].toJSON(t).object)}if(this.animations.length>0){o.animations=[];for(let n=0;n<this.animations.length;n++){const i=this.animations[n];o.animations.push(serialize(t.animations,i))}}if(n){const n=extractFromCache(t.geometries),o=extractFromCache(t.materials),a=extractFromCache(t.textures),s=extractFromCache(t.images),m=extractFromCache(t.shapes),g=extractFromCache(t.skeletons),_=extractFromCache(t.animations);n.length>0&&(i.geometries=n),o.length>0&&(i.materials=o),a.length>0&&(i.textures=a),s.length>0&&(i.images=s),m.length>0&&(i.shapes=m),g.length>0&&(i.skeletons=g),_.length>0&&(i.animations=_)}return i.object=o,i;function extractFromCache(t){const n=[];for(const i in t){const o=t[i];delete o.metadata,n.push(o)}return n}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,n=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===n)for(let n=0;n<t.children.length;n++){const i=t.children[n];this.add(i.clone())}return this}});const ti=new Vector3,ni=new Vector3,ri=new Matrix3;class Plane{constructor(t,n){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new Vector3(1,0,0),this.constant=void 0!==n?n:0}set(t,n){return this.normal.copy(t),this.constant=n,this}setComponents(t,n,i,o){return this.normal.set(t,n,i),this.constant=o,this}setFromNormalAndCoplanarPoint(t,n){return this.normal.copy(t),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(t,n,i){const o=ti.subVectors(i,n).cross(ni.subVectors(t,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,n){return void 0===n&&(console.warn("THREE.Plane: .projectPoint() target is now required"),n=new Vector3),n.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new Vector3);const i=t.delta(ti),o=this.normal.dot(i);if(0===o)return 0===this.distanceToPoint(t.start)?n.copy(t.start):void 0;const a=-(t.start.dot(this.normal)+this.constant)/o;return a<0||a>1?void 0:n.copy(i).multiplyScalar(a).add(t.start)}intersectsLine(t){const n=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return n<0&&i>0||i<0&&n>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,n){const i=n||ri.getNormalMatrix(t),o=this.coplanarPoint(ti).applyMatrix4(t),a=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(a),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const ii=new Vector3,oi=new Vector3,ai=new Vector3,si=new Vector3,ci=new Vector3,ui=new Vector3,li=new Vector3,hi=new Vector3,di=new Vector3,pi=new Vector3;class Triangle{constructor(t,n,i){this.a=void 0!==t?t:new Vector3,this.b=void 0!==n?n:new Vector3,this.c=void 0!==i?i:new Vector3}static getNormal(t,n,i,o){void 0===o&&(console.warn("THREE.Triangle: .getNormal() target is now required"),o=new Vector3),o.subVectors(i,n),ii.subVectors(t,n),o.cross(ii);const a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}static getBarycoord(t,n,i,o,a){ii.subVectors(o,n),oi.subVectors(i,n),ai.subVectors(t,n);const s=ii.dot(ii),m=ii.dot(oi),g=ii.dot(ai),_=oi.dot(oi),S=oi.dot(ai),M=s*_-m*m;if(void 0===a&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),a=new Vector3),0===M)return a.set(-2,-1,-1);const T=1/M,O=(_*g-m*S)*T,A=(s*S-m*g)*T;return a.set(1-O-A,A,O)}static containsPoint(t,n,i,o){return this.getBarycoord(t,n,i,o,si),si.x>=0&&si.y>=0&&si.x+si.y<=1}static getUV(t,n,i,o,a,s,m,g){return this.getBarycoord(t,n,i,o,si),g.set(0,0),g.addScaledVector(a,si.x),g.addScaledVector(s,si.y),g.addScaledVector(m,si.z),g}static isFrontFacing(t,n,i,o){return ii.subVectors(i,n),oi.subVectors(t,n),ii.cross(oi).dot(o)<0}set(t,n,i){return this.a.copy(t),this.b.copy(n),this.c.copy(i),this}setFromPointsAndIndices(t,n,i,o){return this.a.copy(t[n]),this.b.copy(t[i]),this.c.copy(t[o]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ii.subVectors(this.c,this.b),oi.subVectors(this.a,this.b),.5*ii.cross(oi).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Vector3),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Triangle.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Plane),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,n){return Triangle.getBarycoord(t,this.a,this.b,this.c,n)}getUV(t,n,i,o,a){return Triangle.getUV(t,this.a,this.b,this.c,n,i,o,a)}containsPoint(t){return Triangle.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,n){void 0===n&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),n=new Vector3);const i=this.a,o=this.b,a=this.c;let s,m;ci.subVectors(o,i),ui.subVectors(a,i),hi.subVectors(t,i);const g=ci.dot(hi),_=ui.dot(hi);if(g<=0&&_<=0)return n.copy(i);di.subVectors(t,o);const S=ci.dot(di),M=ui.dot(di);if(S>=0&&M<=S)return n.copy(o);const T=g*M-S*_;if(T<=0&&g>=0&&S<=0)return s=g/(g-S),n.copy(i).addScaledVector(ci,s);pi.subVectors(t,a);const O=ci.dot(pi),A=ui.dot(pi);if(A>=0&&O<=A)return n.copy(a);const P=O*_-g*A;if(P<=0&&_>=0&&A<=0)return m=_/(_-A),n.copy(i).addScaledVector(ui,m);const L=S*A-O*M;if(L<=0&&M-S>=0&&O-A>=0)return li.subVectors(a,o),m=(M-S)/(M-S+(O-A)),n.copy(o).addScaledVector(li,m);const R=1/(L+P+T);return s=P*R,m=T*R,n.copy(i).addScaledVector(ci,s).addScaledVector(ui,m)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const fi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},mi={h:0,s:0,l:0},gi={h:0,s:0,l:0};function hue2rgb(t,n,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(n-t)*i:i<.5?n:i<2/3?t+6*(n-t)*(2/3-i):t}function SRGBToLinear(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function LinearToSRGB(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Color{constructor(t,n,i){return Object.defineProperty(this,"isColor",{value:!0}),void 0===n&&void 0===i?this.set(t):this.setRGB(t,n,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,n,i){return this.r=t,this.g=n,this.b=i,this}setHSL(t,n,i){if(t=ar.euclideanModulo(t,1),n=ar.clamp(n,0,1),i=ar.clamp(i,0,1),0===n)this.r=this.g=this.b=i;else{const o=i<=.5?i*(1+n):i+n-i*n,a=2*i-o;this.r=hue2rgb(a,o,t+1/3),this.g=hue2rgb(a,o,t),this.b=hue2rgb(a,o,t-1/3)}return this}setStyle(t){function handleAlpha(n){void 0!==n&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,handleAlpha(t[4]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,handleAlpha(t[4]),this;break;case"hsl":case"hsla":if(t=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const n=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,o=parseInt(t[3],10)/100;return handleAlpha(t[4]),this.setHSL(n,i,o)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const n=fi[t];return void 0!==n?this.setHex(n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,n=2){return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}copyLinearToGamma(t,n=2){const i=n>0?1/n:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const n=this.r,i=this.g,o=this.b,a=Math.max(n,i,o),s=Math.min(n,i,o);let m,g;const _=(s+a)/2;if(s===a)m=0,g=0;else{const t=a-s;switch(g=_<=.5?t/(a+s):t/(2-a-s),a){case n:m=(i-o)/t+(i<o?6:0);break;case i:m=(o-n)/t+2;break;case o:m=(n-i)/t+4}m/=6}return t.h=m,t.s=g,t.l=_,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,n,i){return this.getHSL(mi),mi.h+=t,mi.s+=n,mi.l+=i,this.setHSL(mi.h,mi.s,mi.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpHSL(t,n){this.getHSL(mi),t.getHSL(gi);const i=ar.lerp(mi.h,gi.h,n),o=ar.lerp(mi.s,gi.s,n),a=ar.lerp(mi.l,gi.l,n);return this.setHSL(i,o,a),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=fi,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;class Face3{constructor(t,n,i,o,a,s=0){this.a=t,this.b=n,this.c=i,this.normal=o&&o.isVector3?o:new Vector3,this.vertexNormals=Array.isArray(o)?o:[],this.color=a&&a.isColor?a:new Color,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let n=0,i=t.vertexNormals.length;n<i;n++)this.vertexNormals[n]=t.vertexNormals[n].clone();for(let n=0,i=t.vertexColors.length;n<i;n++)this.vertexColors[n]=t.vertexColors[n].clone();return this}}let yi=0;function Material(){Object.defineProperty(this,"id",{value:yi++}),this.uuid=ar.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=V,this.side=P,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=te,this.blendDst=ne,this.blendEquation=q,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=he,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=qn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Rn,this.stencilZFail=Rn,this.stencilZPass=Rn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function MeshBasicMaterial(t){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ge,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const n in t){const i=t[n];if(void 0===i){console.warn("THREE.Material: '"+n+"' parameter is undefined.");continue}if("shading"===n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===N;continue}const o=this[n];void 0!==o?o&&o.isColor?o.set(i):o&&o.isVector3&&i&&i.isVector3?o.copy(i):this[n]=i:console.warn("THREE."+this.type+": '"+n+"' is not a property of this material.")}},toJSON:function(t){const n=void 0===t||"string"==typeof t;n&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function extractFromCache(t){const n=[];for(const i in t){const o=t[i];delete o.metadata,n.push(o)}return n}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==V&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==P&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),n){const n=extractFromCache(t.textures),o=extractFromCache(t.images);n.length>0&&(i.textures=n),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const n=t.clippingPlanes;let i=null;if(null!==n){const t=n.length;i=new Array(t);for(let o=0;o!==t;++o)i[o]=n[o].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Material.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const vi=new Vector3,bi=new Vector2;function BufferAttribute(t,n,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===i,this.usage=Zn,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(t,n,i){BufferAttribute.call(this,new Int8Array(t),n,i)}function Uint8BufferAttribute(t,n,i){BufferAttribute.call(this,new Uint8Array(t),n,i)}function Uint8ClampedBufferAttribute(t,n,i){BufferAttribute.call(this,new Uint8ClampedArray(t),n,i)}function Int16BufferAttribute(t,n,i){BufferAttribute.call(this,new Int16Array(t),n,i)}function Uint16BufferAttribute(t,n,i){BufferAttribute.call(this,new Uint16Array(t),n,i)}function Int32BufferAttribute(t,n,i){BufferAttribute.call(this,new Int32Array(t),n,i)}function Uint32BufferAttribute(t,n,i){BufferAttribute.call(this,new Uint32Array(t),n,i)}function Float16BufferAttribute(t,n,i){BufferAttribute.call(this,new Uint16Array(t),n,i)}function Float32BufferAttribute(t,n,i){BufferAttribute.call(this,new Float32Array(t),n,i)}function Float64BufferAttribute(t,n,i){BufferAttribute.call(this,new Float64Array(t),n,i)}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,n,i){t*=this.itemSize,i*=n.itemSize;for(let o=0,a=this.itemSize;o<a;o++)this.array[t+o]=n.array[i+o];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const n=this.array;let i=0;for(let o=0,a=t.length;o<a;o++){let a=t[o];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",o),a=new Color),n[i++]=a.r,n[i++]=a.g,n[i++]=a.b}return this},copyVector2sArray:function(t){const n=this.array;let i=0;for(let o=0,a=t.length;o<a;o++){let a=t[o];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",o),a=new Vector2),n[i++]=a.x,n[i++]=a.y}return this},copyVector3sArray:function(t){const n=this.array;let i=0;for(let o=0,a=t.length;o<a;o++){let a=t[o];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",o),a=new Vector3),n[i++]=a.x,n[i++]=a.y,n[i++]=a.z}return this},copyVector4sArray:function(t){const n=this.array;let i=0;for(let o=0,a=t.length;o<a;o++){let a=t[o];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",o),a=new Vector4),n[i++]=a.x,n[i++]=a.y,n[i++]=a.z,n[i++]=a.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let n=0,i=this.count;n<i;n++)bi.fromBufferAttribute(this,n),bi.applyMatrix3(t),this.setXY(n,bi.x,bi.y);else if(3===this.itemSize)for(let n=0,i=this.count;n<i;n++)vi.fromBufferAttribute(this,n),vi.applyMatrix3(t),this.setXYZ(n,vi.x,vi.y,vi.z);return this},applyMatrix4:function(t){for(let n=0,i=this.count;n<i;n++)vi.x=this.getX(n),vi.y=this.getY(n),vi.z=this.getZ(n),vi.applyMatrix4(t),this.setXYZ(n,vi.x,vi.y,vi.z);return this},applyNormalMatrix:function(t){for(let n=0,i=this.count;n<i;n++)vi.x=this.getX(n),vi.y=this.getY(n),vi.z=this.getZ(n),vi.applyNormalMatrix(t),this.setXYZ(n,vi.x,vi.y,vi.z);return this},transformDirection:function(t){for(let n=0,i=this.count;n<i;n++)vi.x=this.getX(n),vi.y=this.getY(n),vi.z=this.getZ(n),vi.transformDirection(t),this.setXYZ(n,vi.x,vi.y,vi.z);return this},set:function(t,n=0){return this.array.set(t,n),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,n){return this.array[t*this.itemSize]=n,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,n){return this.array[t*this.itemSize+1]=n,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,n){return this.array[t*this.itemSize+2]=n,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,n){return this.array[t*this.itemSize+3]=n,this},setXY:function(t,n,i){return t*=this.itemSize,this.array[t+0]=n,this.array[t+1]=i,this},setXYZ:function(t,n,i,o){return t*=this.itemSize,this.array[t+0]=n,this.array[t+1]=i,this.array[t+2]=o,this},setXYZW:function(t,n,i,o,a){return t*=this.itemSize,this.array[t+0]=n,this.array[t+1]=i,this.array[t+2]=o,this.array[t+3]=a,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float16BufferAttribute.prototype.constructor=Float16BufferAttribute,Float16BufferAttribute.prototype.isFloat16BufferAttribute=!0,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;class DirectGeometry{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){const n=[];let i,o,a=void 0;const s=t.faces;for(o=0;o<s.length;o++){const t=s[o];t.materialIndex!==a&&(a=t.materialIndex,void 0!==i&&(i.count=3*o-i.start,n.push(i)),i={start:3*o,materialIndex:a})}void 0!==i&&(i.count=3*o-i.start,n.push(i)),this.groups=n}fromGeometry(t){const n=t.faces,i=t.vertices,o=t.faceVertexUvs,a=o[0]&&o[0].length>0,s=o[1]&&o[1].length>0,m=t.morphTargets,g=m.length;let _;if(g>0){_=[];for(let t=0;t<g;t++)_[t]={name:m[t].name,data:[]};this.morphTargets.position=_}const S=t.morphNormals,M=S.length;let T;if(M>0){T=[];for(let t=0;t<M;t++)T[t]={name:S[t].name,data:[]};this.morphTargets.normal=T}const O=t.skinIndices,A=t.skinWeights,P=O.length===i.length,L=A.length===i.length;i.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<n.length;t++){const R=n[t];this.vertices.push(i[R.a],i[R.b],i[R.c]);const N=R.vertexNormals;if(3===N.length)this.normals.push(N[0],N[1],N[2]);else{const t=R.normal;this.normals.push(t,t,t)}const I=R.vertexColors;if(3===I.length)this.colors.push(I[0],I[1],I[2]);else{const t=R.color;this.colors.push(t,t,t)}if(!0===a){const n=o[0][t];void 0!==n?this.uvs.push(n[0],n[1],n[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new Vector2,new Vector2,new Vector2))}if(!0===s){const n=o[1][t];void 0!==n?this.uvs2.push(n[0],n[1],n[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new Vector2,new Vector2,new Vector2))}for(let t=0;t<g;t++){const n=m[t].vertices;_[t].data.push(n[R.a],n[R.b],n[R.c])}for(let n=0;n<M;n++){const i=S[n].vertexNormals[t];T[n].data.push(i.a,i.b,i.c)}P&&this.skinIndices.push(O[R.a],O[R.b],O[R.c]),L&&this.skinWeights.push(A[R.a],A[R.b],A[R.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}}function arrayMax(t){if(0===t.length)return-1/0;let n=t[0];for(let i=1,o=t.length;i<o;++i)t[i]>n&&(n=t[i]);return n}const _i={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(t,n){return new _i[t](n)}let wi=1;const xi=new Matrix4,Si=new Object3D,Mi=new Vector3,Ei=new Box3,Ti=new Box3,Ci=new Vector3;function BufferGeometry(){Object.defineProperty(this,"id",{value:wi+=2}),this.uuid=ar.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(arrayMax(t)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,n){return this.attributes[t]=n,this},deleteAttribute:function(t){return delete this.attributes[t],this},hasAttribute:function(t){return void 0!==this.attributes[t]},addGroup:function(t,n,i=0){this.groups.push({start:t,count:n,materialIndex:i})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,n){this.drawRange.start=t,this.drawRange.count=n},applyMatrix4:function(t){const n=this.attributes.position;void 0!==n&&(n.applyMatrix4(t),n.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const n=(new Matrix3).getNormalMatrix(t);i.applyNormalMatrix(n),i.needsUpdate=!0}const o=this.attributes.tangent;return void 0!==o&&(o.transformDirection(t),o.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return xi.makeRotationX(t),this.applyMatrix4(xi),this},rotateY:function(t){return xi.makeRotationY(t),this.applyMatrix4(xi),this},rotateZ:function(t){return xi.makeRotationZ(t),this.applyMatrix4(xi),this},translate:function(t,n,i){return xi.makeTranslation(t,n,i),this.applyMatrix4(xi),this},scale:function(t,n,i){return xi.makeScale(t,n,i),this.applyMatrix4(xi),this},lookAt:function(t){return Si.lookAt(t),Si.updateMatrix(),this.applyMatrix4(Si.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Mi).negate(),this.translate(Mi.x,Mi.y,Mi.z),this},setFromObject:function(t){const n=t.geometry;if(t.isPoints||t.isLine){const t=new Float32BufferAttribute(3*n.vertices.length,3),i=new Float32BufferAttribute(3*n.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(n.vertices)),this.setAttribute("color",i.copyColorsArray(n.colors)),n.lineDistances&&n.lineDistances.length===n.vertices.length){const t=new Float32BufferAttribute(n.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(n.lineDistances))}null!==n.boundingSphere&&(this.boundingSphere=n.boundingSphere.clone()),null!==n.boundingBox&&(this.boundingBox=n.boundingBox.clone())}else t.isMesh&&n&&n.isGeometry&&this.fromGeometry(n);return this},setFromPoints:function(t){const n=[];for(let i=0,o=t.length;i<o;i++){const o=t[i];n.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Float32BufferAttribute(n,3)),this},updateFromObject:function(t){let n=t.geometry;if(t.isMesh){let t=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(t=void 0,n.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(n);t.verticesNeedUpdate=n.verticesNeedUpdate,t.normalsNeedUpdate=n.normalsNeedUpdate,t.colorsNeedUpdate=n.colorsNeedUpdate,t.uvsNeedUpdate=n.uvsNeedUpdate,t.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=t}if(!0===n.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1}if(!0===n.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1}if(!0===n.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1}if(n.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1}if(n.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1}return n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new DirectGeometry).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const n=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new BufferAttribute(n,3).copyVector3sArray(t.vertices)),t.normals.length>0){const n=new Float32Array(3*t.normals.length);this.setAttribute("normal",new BufferAttribute(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const n=new Float32Array(3*t.colors.length);this.setAttribute("color",new BufferAttribute(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const n=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new BufferAttribute(n,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const n=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new BufferAttribute(n,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const n in t.morphTargets){const i=[],o=t.morphTargets[n];for(let t=0,n=o.length;t<n;t++){const n=o[t],a=new Float32BufferAttribute(3*n.data.length,3);a.name=n.name,i.push(a.copyVector3sArray(n.data))}this.morphAttributes[n]=i}if(t.skinIndices.length>0){const n=new Float32BufferAttribute(4*t.skinIndices.length,4);this.setAttribute("skinIndex",n.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const n=new Float32BufferAttribute(4*t.skinWeights.length,4);this.setAttribute("skinWeight",n.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);const t=this.attributes.position,n=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),n)for(let t=0,i=n.length;t<i;t++){const i=n[t];Ei.setFromBufferAttribute(i),this.morphTargetsRelative?(Ci.addVectors(this.boundingBox.min,Ei.min),this.boundingBox.expandByPoint(Ci),Ci.addVectors(this.boundingBox.max,Ei.max),this.boundingBox.expandByPoint(Ci)):(this.boundingBox.expandByPoint(Ei.min),this.boundingBox.expandByPoint(Ei.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const t=this.attributes.position,n=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(t){const i=this.boundingSphere.center;if(Ei.setFromBufferAttribute(t),n)for(let t=0,i=n.length;t<i;t++){const i=n[t];Ti.setFromBufferAttribute(i),this.morphTargetsRelative?(Ci.addVectors(Ei.min,Ti.min),Ei.expandByPoint(Ci),Ci.addVectors(Ei.max,Ti.max),Ei.expandByPoint(Ci)):(Ei.expandByPoint(Ti.min),Ei.expandByPoint(Ti.max))}Ei.getCenter(i);let o=0;for(let n=0,a=t.count;n<a;n++)Ci.fromBufferAttribute(t,n),o=Math.max(o,i.distanceToSquared(Ci));if(n)for(let a=0,s=n.length;a<s;a++){const s=n[a],m=this.morphTargetsRelative;for(let n=0,a=s.count;n<a;n++)Ci.fromBufferAttribute(s,n),m&&(Mi.fromBufferAttribute(t,n),Ci.add(Mi)),o=Math.max(o,i.distanceToSquared(Ci))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,n=this.getAttribute("position");if(void 0!==n){let i=this.getAttribute("normal");if(void 0===i)i=new BufferAttribute(new Float32Array(3*n.count),3),this.setAttribute("normal",i);else for(let t=0,n=i.count;t<n;t++)i.setXYZ(t,0,0,0);const o=new Vector3,a=new Vector3,s=new Vector3,m=new Vector3,g=new Vector3,_=new Vector3,S=new Vector3,M=new Vector3;if(t)for(let T=0,O=t.count;T<O;T+=3){const O=t.getX(T+0),A=t.getX(T+1),P=t.getX(T+2);o.fromBufferAttribute(n,O),a.fromBufferAttribute(n,A),s.fromBufferAttribute(n,P),S.subVectors(s,a),M.subVectors(o,a),S.cross(M),m.fromBufferAttribute(i,O),g.fromBufferAttribute(i,A),_.fromBufferAttribute(i,P),m.add(S),g.add(S),_.add(S),i.setXYZ(O,m.x,m.y,m.z),i.setXYZ(A,g.x,g.y,g.z),i.setXYZ(P,_.x,_.y,_.z)}else for(let t=0,m=n.count;t<m;t+=3)o.fromBufferAttribute(n,t+0),a.fromBufferAttribute(n,t+1),s.fromBufferAttribute(n,t+2),S.subVectors(s,a),M.subVectors(o,a),S.cross(M),i.setXYZ(t+0,S.x,S.y,S.z),i.setXYZ(t+1,S.x,S.y,S.z),i.setXYZ(t+2,S.x,S.y,S.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(t,n){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===n&&(n=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const o in i){if(void 0===t.attributes[o])continue;const a=i[o].array,s=t.attributes[o],m=s.array,g=s.itemSize*n,_=Math.min(m.length,a.length-g);for(let t=0,n=g;t<_;t++,n++)a[n]=m[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let n=0,i=t.count;n<i;n++)Ci.fromBufferAttribute(t,n),Ci.normalize(),t.setXYZ(n,Ci.x,Ci.y,Ci.z)},toNonIndexed:function(){function convertBufferAttribute(t,n){const i=t.array,o=t.itemSize,a=t.normalized,s=new i.constructor(n.length*o);let m=0,g=0;for(let t=0,a=n.length;t<a;t++){m=n[t]*o;for(let t=0;t<o;t++)s[g++]=i[m++]}return new BufferAttribute(s,o,a)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const t=new BufferGeometry,n=this.index.array,i=this.attributes;for(const o in i){const a=convertBufferAttribute(i[o],n);t.setAttribute(o,a)}const o=this.morphAttributes;for(const i in o){const a=[],s=o[i];for(let t=0,i=s.length;t<i;t++){const i=convertBufferAttribute(s[t],n);a.push(i)}t.morphAttributes[i]=a}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let n=0,i=a.length;n<i;n++){const i=a[n];t.addGroup(i.start,i.count,i.materialIndex)}return t},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const n=this.parameters;for(const i in n)void 0!==n[i]&&(t[i]=n[i]);return t}t.data={attributes:{}};const n=this.index;null!==n&&(t.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const i=this.attributes;for(const n in i){const o=i[n],a=o.toJSON(t.data);""!==o.name&&(a.name=o.name),t.data.attributes[n]=a}const o={};let a=!1;for(const n in this.morphAttributes){const i=this.morphAttributes[n],s=[];for(let n=0,o=i.length;n<o;n++){const o=i[n],a=o.toJSON(t.data);""!==o.name&&(a.name=o.name),s.push(a)}s.length>0&&(o[n]=s,a=!0)}a&&(t.data.morphAttributes=o,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const m=this.boundingSphere;return null!==m&&(t.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),t},clone:function(){return(new BufferGeometry).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(n));const o=t.attributes;for(const t in o){const i=o[t];this.setAttribute(t,i.clone(n))}const a=t.morphAttributes;for(const t in a){const i=[],o=a[t];for(let t=0,a=o.length;t<a;t++)i.push(o[t].clone(n));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];this.addGroup(n.start,n.count,n.materialIndex)}const m=t.boundingBox;null!==m&&(this.boundingBox=m.clone());const g=t.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Oi=new Matrix4,Ai=new Ray,Pi=new Sphere,Li=new Vector3,Ri=new Vector3,Ni=new Vector3,Ii=new Vector3,ki=new Vector3,ji=new Vector3,Fi=new Vector3,Di=new Vector3,Bi=new Vector3,Vi=new Vector2,Ui=new Vector2,Gi=new Vector2,zi=new Vector3,Hi=new Vector3;function Mesh(t=new BufferGeometry,n=new MeshBasicMaterial){Object3D.call(this),this.type="Mesh",this.geometry=t,this.material=n,this.updateMorphTargets()}function checkIntersection(t,n,i,o,a,s,m,g){let _;if(_=n.side===L?o.intersectTriangle(m,s,a,!0,g):o.intersectTriangle(a,s,m,n.side!==R,g),null===_)return null;Hi.copy(g),Hi.applyMatrix4(t.matrixWorld);const S=i.ray.origin.distanceTo(Hi);return S<i.near||S>i.far?null:{distance:S,point:Hi.clone(),object:t}}function checkBufferGeometryIntersection(t,n,i,o,a,s,m,g,_,S,M,T){Li.fromBufferAttribute(a,S),Ri.fromBufferAttribute(a,M),Ni.fromBufferAttribute(a,T);const O=t.morphTargetInfluences;if(n.morphTargets&&s&&O){Fi.set(0,0,0),Di.set(0,0,0),Bi.set(0,0,0);for(let t=0,n=s.length;t<n;t++){const n=O[t],i=s[t];0!==n&&(Ii.fromBufferAttribute(i,S),ki.fromBufferAttribute(i,M),ji.fromBufferAttribute(i,T),m?(Fi.addScaledVector(Ii,n),Di.addScaledVector(ki,n),Bi.addScaledVector(ji,n)):(Fi.addScaledVector(Ii.sub(Li),n),Di.addScaledVector(ki.sub(Ri),n),Bi.addScaledVector(ji.sub(Ni),n)))}Li.add(Fi),Ri.add(Di),Ni.add(Bi)}t.isSkinnedMesh&&(t.boneTransform(S,Li),t.boneTransform(M,Ri),t.boneTransform(T,Ni));const A=checkIntersection(t,n,i,o,Li,Ri,Ni,zi);if(A){g&&(Vi.fromBufferAttribute(g,S),Ui.fromBufferAttribute(g,M),Gi.fromBufferAttribute(g,T),A.uv=Triangle.getUV(zi,Li,Ri,Ni,Vi,Ui,Gi,new Vector2)),_&&(Vi.fromBufferAttribute(_,S),Ui.fromBufferAttribute(_,M),Gi.fromBufferAttribute(_,T),A.uv2=Triangle.getUV(zi,Li,Ri,Ni,Vi,Ui,Gi,new Vector2));const t=new Face3(S,M,T);Triangle.getNormal(Li,Ri,Ni,t.normal),A.face=t}return A}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const n=t.morphAttributes,i=Object.keys(n);if(i.length>0){const t=n[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++){const i=t[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=n}}}}else{const n=t.morphTargets;void 0!==n&&n.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,n){const i=this.geometry,o=this.material,a=this.matrixWorld;if(void 0===o)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),Pi.copy(i.boundingSphere),Pi.applyMatrix4(a),!1===t.ray.intersectsSphere(Pi))return;if(Oi.copy(a).invert(),Ai.copy(t.ray).applyMatrix4(Oi),null!==i.boundingBox&&!1===Ai.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const a=i.index,m=i.attributes.position,g=i.morphAttributes.position,_=i.morphTargetsRelative,S=i.attributes.uv,M=i.attributes.uv2,T=i.groups,O=i.drawRange;if(null!==a)if(Array.isArray(o))for(let i=0,A=T.length;i<A;i++){const A=T[i],P=o[A.materialIndex];for(let i=Math.max(A.start,O.start),o=Math.min(A.start+A.count,O.start+O.count);i<o;i+=3){const o=a.getX(i),T=a.getX(i+1),O=a.getX(i+2);s=checkBufferGeometryIntersection(this,P,t,Ai,m,g,_,S,M,o,T,O),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=A.materialIndex,n.push(s))}}else for(let i=Math.max(0,O.start),T=Math.min(a.count,O.start+O.count);i<T;i+=3){const T=a.getX(i),O=a.getX(i+1),A=a.getX(i+2);s=checkBufferGeometryIntersection(this,o,t,Ai,m,g,_,S,M,T,O,A),s&&(s.faceIndex=Math.floor(i/3),n.push(s))}else if(void 0!==m)if(Array.isArray(o))for(let i=0,a=T.length;i<a;i++){const a=T[i],A=o[a.materialIndex];for(let i=Math.max(a.start,O.start),o=Math.min(a.start+a.count,O.start+O.count);i<o;i+=3)s=checkBufferGeometryIntersection(this,A,t,Ai,m,g,_,S,M,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=a.materialIndex,n.push(s))}else for(let i=Math.max(0,O.start),a=Math.min(m.count,O.start+O.count);i<a;i+=3)s=checkBufferGeometryIntersection(this,o,t,Ai,m,g,_,S,M,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),n.push(s))}else if(i.isGeometry){const a=Array.isArray(o),m=i.vertices,g=i.faces;let _;const S=i.faceVertexUvs[0];S.length>0&&(_=S);for(let i=0,S=g.length;i<S;i++){const S=g[i],M=a?o[S.materialIndex]:o;if(void 0===M)continue;const T=m[S.a],O=m[S.b],A=m[S.c];if(s=checkIntersection(this,M,t,Ai,T,O,A,zi),s){if(_&&_[i]){const t=_[i];Vi.copy(t[0]),Ui.copy(t[1]),Gi.copy(t[2]),s.uv=Triangle.getUV(zi,T,O,A,Vi,Ui,Gi,new Vector2)}s.face=S,s.faceIndex=i,n.push(s)}}}}});class BoxBufferGeometry extends BufferGeometry{constructor(t=1,n=1,i=1,o=1,a=1,s=1){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:n,depth:i,widthSegments:o,heightSegments:a,depthSegments:s};const m=this;o=Math.floor(o),a=Math.floor(a),s=Math.floor(s);const g=[],_=[],S=[],M=[];let T=0,O=0;function buildPlane(t,n,i,o,a,s,A,P,L,R,N){const I=s/L,j=A/R,V=s/2,U=A/2,G=P/2,z=L+1,H=R+1;let q=0,Z=0;const X=new Vector3;for(let s=0;s<H;s++){const m=s*j-U;for(let g=0;g<z;g++){const T=g*I-V;X[t]=T*o,X[n]=m*a,X[i]=G,_.push(X.x,X.y,X.z),X[t]=0,X[n]=0,X[i]=P>0?1:-1,S.push(X.x,X.y,X.z),M.push(g/L),M.push(1-s/R),q+=1}}for(let t=0;t<R;t++)for(let n=0;n<L;n++){const i=T+n+z*t,o=T+n+z*(t+1),a=T+(n+1)+z*(t+1),s=T+(n+1)+z*t;g.push(i,o,s),g.push(o,a,s),Z+=6}m.addGroup(O,Z,N),O+=Z,T+=q}buildPlane("z","y","x",-1,-1,i,n,t,s,a,0),buildPlane("z","y","x",1,-1,i,n,-t,s,a,1),buildPlane("x","z","y",1,1,t,i,n,o,s,2),buildPlane("x","z","y",1,-1,t,i,-n,o,s,3),buildPlane("x","y","z",1,-1,t,n,i,o,a,4),buildPlane("x","y","z",-1,-1,t,n,-i,o,a,5),this.setIndex(g),this.setAttribute("position",new Float32BufferAttribute(_,3)),this.setAttribute("normal",new Float32BufferAttribute(S,3)),this.setAttribute("uv",new Float32BufferAttribute(M,2))}}function cloneUniforms(t){const n={};for(const i in t){n[i]={};for(const o in t[i]){const a=t[i][o];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture)?n[i][o]=a.clone():Array.isArray(a)?n[i][o]=a.slice():n[i][o]=a}}return n}function mergeUniforms(t){const n={};for(let i=0;i<t.length;i++){const o=cloneUniforms(t[i]);for(const t in o)n[t]=o[t]}return n}const Wi={clone:cloneUniforms,merge:mergeUniforms};function ShaderMaterial(t){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function PerspectiveCamera(t=50,n=1,i=.1,o=2e3){Camera.call(this),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=o,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function CubeCamera(t,n,i){if(Object3D.call(this),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const o=new PerspectiveCamera(90,1,t,n);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Vector3(1,0,0)),this.add(o);const a=new PerspectiveCamera(90,1,t,n);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Vector3(-1,0,0)),this.add(a);const s=new PerspectiveCamera(90,1,t,n);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Vector3(0,1,0)),this.add(s);const m=new PerspectiveCamera(90,1,t,n);m.layers=this.layers,m.up.set(0,0,-1),m.lookAt(new Vector3(0,-1,0)),this.add(m);const g=new PerspectiveCamera(90,1,t,n);g.layers=this.layers,g.up.set(0,-1,0),g.lookAt(new Vector3(0,0,1)),this.add(g);const _=new PerspectiveCamera(90,1,t,n);_.layers=this.layers,_.up.set(0,-1,0),_.lookAt(new Vector3(0,0,-1)),this.add(_),this.update=function(t,n){null===this.parent&&this.updateMatrixWorld();const S=t.xr.enabled,M=t.getRenderTarget();t.xr.enabled=!1;const T=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(n,o),t.setRenderTarget(i,1),t.render(n,a),t.setRenderTarget(i,2),t.render(n,s),t.setRenderTarget(i,3),t.render(n,m),t.setRenderTarget(i,4),t.render(n,g),i.texture.generateMipmaps=T,t.setRenderTarget(i,5),t.render(n,_),t.setRenderTarget(M),t.xr.enabled=S}}function CubeTexture(t,n,i,o,a,s,m,g,_,S){t=void 0!==t?t:[],n=void 0!==n?n:Te,m=void 0!==m?m:it,Texture.call(this,t,n,i,o,a,s,m,g,_,S),this.flipY=!1,this._needsFlipEnvMap=!0}function WebGLCubeRenderTarget(t,n,i){Number.isInteger(n)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),n=i),WebGLRenderTarget.call(this,t,t,n),n=n||{},this.texture=new CubeTexture(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture._needsFlipEnvMap=!1}function DataTexture(t,n,i,o,a,s,m,g,_,S,M,T){Texture.call(this,null,s,m,g,_,S,o,a,M,T),this.image={data:t||null,width:n||1,height:i||1},this.magFilter=void 0!==_?_:ke,this.minFilter=void 0!==S?S:ke,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},ShaderMaterial.prototype.toJSON=function(t){const n=Material.prototype.toJSON.call(this,t);n.glslVersion=this.glslVersion,n.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?n.uniforms[i]={type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?n.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?n.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?n.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?n.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?n.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?n.uniforms[i]={type:"m4",value:o.toArray()}:n.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(n.extensions=i),n},Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(t,n){return Object3D.prototype.copy.call(this,t,n),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Vector3),this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return t.set(-n[8],-n[9],-n[10]).normalize()},updateMatrixWorld:function(t){Object3D.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(t,n){Object3D.prototype.updateWorldMatrix.call(this,t,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(t,n){return Camera.prototype.copy.call(this,t,n),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const n=.5*this.getFilmHeight()/t;this.fov=2*ar.RAD2DEG*Math.atan(n),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*ar.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*ar.RAD2DEG*Math.atan(Math.tan(.5*ar.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,n,i,o,a,s){this.aspect=t/n,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=o,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let n=t*Math.tan(.5*ar.DEG2RAD*this.fov)/this.zoom,i=2*n,o=this.aspect*i,a=-.5*o;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,m=s.fullHeight;a+=s.offsetX*o/t,n-=s.offsetY*i/m,o*=s.width/t,i*=s.height/m}const m=this.filmOffset;0!==m&&(a+=t*m/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+o,n,n-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const n=Object3D.prototype.toJSON.call(this,t);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,null!==this.view&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}),CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),WebGLCubeRenderTarget.prototype=Object.create(WebGLRenderTarget.prototype),WebGLCubeRenderTarget.prototype.constructor=WebGLCubeRenderTarget,WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0,WebGLCubeRenderTarget.prototype.fromEquirectangularTexture=function(t,n){this.texture.type=n.type,this.texture.format=ot,this.texture.encoding=n.encoding,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const i={tEquirect:{value:null}},o="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",a="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",s=new BoxBufferGeometry(5,5,5),m=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(i),vertexShader:o,fragmentShader:a,side:L,blending:j});m.uniforms.tEquirect.value=n;const g=new Mesh(s,m),_=n.minFilter;return n.minFilter===ze&&(n.minFilter=Ve),new CubeCamera(1,10,this).update(t,g),n.minFilter=_,g.geometry.dispose(),g.material.dispose(),this},WebGLCubeRenderTarget.prototype.clear=function(t,n,i,o){const a=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(n,i,o);t.setRenderTarget(a)},DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;const qi=new Sphere,Zi=new Vector3;class Frustum{constructor(t,n,i,o,a,s){this.planes=[void 0!==t?t:new Plane,void 0!==n?n:new Plane,void 0!==i?i:new Plane,void 0!==o?o:new Plane,void 0!==a?a:new Plane,void 0!==s?s:new Plane]}set(t,n,i,o,a,s){const m=this.planes;return m[0].copy(t),m[1].copy(n),m[2].copy(i),m[3].copy(o),m[4].copy(a),m[5].copy(s),this}clone(){return(new this.constructor).copy(this)}copy(t){const n=this.planes;for(let i=0;i<6;i++)n[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const n=this.planes,i=t.elements,o=i[0],a=i[1],s=i[2],m=i[3],g=i[4],_=i[5],S=i[6],M=i[7],T=i[8],O=i[9],A=i[10],P=i[11],L=i[12],R=i[13],N=i[14],I=i[15];return n[0].setComponents(m-o,M-g,P-T,I-L).normalize(),n[1].setComponents(m+o,M+g,P+T,I+L).normalize(),n[2].setComponents(m+a,M+_,P+O,I+R).normalize(),n[3].setComponents(m-a,M-_,P-O,I-R).normalize(),n[4].setComponents(m-s,M-S,P-A,I-N).normalize(),n[5].setComponents(m+s,M+S,P+A,I+N).normalize(),this}intersectsObject(t){const n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),qi.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(qi)}intersectsSprite(t){return qi.center.set(0,0,0),qi.radius=.7071067811865476,qi.applyMatrix4(t.matrixWorld),this.intersectsSphere(qi)}intersectsSphere(t){const n=this.planes,i=t.center,o=-t.radius;for(let t=0;t<6;t++)if(n[t].distanceToPoint(i)<o)return!1;return!0}intersectsBox(t){const n=this.planes;for(let i=0;i<6;i++){const o=n[i];if(Zi.x=o.normal.x>0?t.max.x:t.min.x,Zi.y=o.normal.y>0?t.max.y:t.min.y,Zi.z=o.normal.z>0?t.max.z:t.min.z,o.distanceToPoint(Zi)<0)return!1}return!0}containsPoint(t){const n=this.planes;for(let i=0;i<6;i++)if(n[i].distanceToPoint(t)<0)return!1;return!0}}function WebGLAnimation(){let t=null,n=!1,i=null,o=null;function onAnimationFrame(n,a){i(n,a),o=t.requestAnimationFrame(onAnimationFrame)}return{start:function(){!0!==n&&null!==i&&(o=t.requestAnimationFrame(onAnimationFrame),n=!0)},stop:function(){t.cancelAnimationFrame(o),n=!1},setAnimationLoop:function(t){i=t},setContext:function(n){t=n}}}function WebGLAttributes(t,n){const i=n.isWebGL2,o=new WeakMap;return{get:function get(t){return t.isInterleavedBufferAttribute&&(t=t.data),o.get(t)},remove:function remove(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=o.get(n);i&&(t.deleteBuffer(i.buffer),o.delete(n))},update:function update(n,a){if(n.isGLBufferAttribute){const t=o.get(n);return void((!t||t.version<n.version)&&o.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}n.isInterleavedBufferAttribute&&(n=n.data);const s=o.get(n);void 0===s?o.set(n,function createBuffer(n,o){const a=n.array,s=n.usage,m=t.createBuffer();t.bindBuffer(o,m),t.bufferData(o,a,s),n.onUploadCallback();let g=5126;return a instanceof Float32Array?g=5126:a instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):a instanceof Uint16Array?n.isFloat16BufferAttribute?i?g=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):g=5123:a instanceof Int16Array?g=5122:a instanceof Uint32Array?g=5125:a instanceof Int32Array?g=5124:a instanceof Int8Array?g=5120:a instanceof Uint8Array&&(g=5121),{buffer:m,type:g,bytesPerElement:a.BYTES_PER_ELEMENT,version:n.version}}(n,a)):s.version<n.version&&(function updateBuffer(n,o,a){const s=o.array,m=o.updateRange;t.bindBuffer(a,n),-1===m.count?t.bufferSubData(a,0,s):(i?t.bufferSubData(a,m.offset*s.BYTES_PER_ELEMENT,s,m.offset,m.count):t.bufferSubData(a,m.offset*s.BYTES_PER_ELEMENT,s.subarray(m.offset,m.offset+m.count)),m.count=-1)}(s.buffer,n,a),s.version=n.version)}}}class PlaneBufferGeometry extends BufferGeometry{constructor(t=1,n=1,i=1,o=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:t,height:n,widthSegments:i,heightSegments:o};const a=t/2,s=n/2,m=Math.floor(i),g=Math.floor(o),_=m+1,S=g+1,M=t/m,T=n/g,O=[],A=[],P=[],L=[];for(let t=0;t<S;t++){const n=t*T-s;for(let i=0;i<_;i++){const o=i*M-a;A.push(o,-n,0),P.push(0,0,1),L.push(i/m),L.push(1-t/g)}}for(let t=0;t<g;t++)for(let n=0;n<m;n++){const i=n+_*t,o=n+_*(t+1),a=n+1+_*(t+1),s=n+1+_*t;O.push(i,o,s),O.push(o,a,s)}this.setIndex(O),this.setAttribute("position",new Float32BufferAttribute(A,3)),this.setAttribute("normal",new Float32BufferAttribute(P,3)),this.setAttribute("uv",new Float32BufferAttribute(L,2))}}const Xi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Qi={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},Yi={basic:{uniforms:mergeUniforms([Qi.common,Qi.specularmap,Qi.envmap,Qi.aomap,Qi.lightmap,Qi.fog]),vertexShader:Xi.meshbasic_vert,fragmentShader:Xi.meshbasic_frag},lambert:{uniforms:mergeUniforms([Qi.common,Qi.specularmap,Qi.envmap,Qi.aomap,Qi.lightmap,Qi.emissivemap,Qi.fog,Qi.lights,{emissive:{value:new Color(0)}}]),vertexShader:Xi.meshlambert_vert,fragmentShader:Xi.meshlambert_frag},phong:{uniforms:mergeUniforms([Qi.common,Qi.specularmap,Qi.envmap,Qi.aomap,Qi.lightmap,Qi.emissivemap,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,Qi.fog,Qi.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:Xi.meshphong_vert,fragmentShader:Xi.meshphong_frag},standard:{uniforms:mergeUniforms([Qi.common,Qi.envmap,Qi.aomap,Qi.lightmap,Qi.emissivemap,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,Qi.roughnessmap,Qi.metalnessmap,Qi.fog,Qi.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Xi.meshphysical_vert,fragmentShader:Xi.meshphysical_frag},toon:{uniforms:mergeUniforms([Qi.common,Qi.aomap,Qi.lightmap,Qi.emissivemap,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,Qi.gradientmap,Qi.fog,Qi.lights,{emissive:{value:new Color(0)}}]),vertexShader:Xi.meshtoon_vert,fragmentShader:Xi.meshtoon_frag},matcap:{uniforms:mergeUniforms([Qi.common,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,Qi.fog,{matcap:{value:null}}]),vertexShader:Xi.meshmatcap_vert,fragmentShader:Xi.meshmatcap_frag},points:{uniforms:mergeUniforms([Qi.points,Qi.fog]),vertexShader:Xi.points_vert,fragmentShader:Xi.points_frag},dashed:{uniforms:mergeUniforms([Qi.common,Qi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xi.linedashed_vert,fragmentShader:Xi.linedashed_frag},depth:{uniforms:mergeUniforms([Qi.common,Qi.displacementmap]),vertexShader:Xi.depth_vert,fragmentShader:Xi.depth_frag},normal:{uniforms:mergeUniforms([Qi.common,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,{opacity:{value:1}}]),vertexShader:Xi.normal_vert,fragmentShader:Xi.normal_frag},sprite:{uniforms:mergeUniforms([Qi.sprite,Qi.fog]),vertexShader:Xi.sprite_vert,fragmentShader:Xi.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:Xi.background_vert,fragmentShader:Xi.background_frag},cube:{uniforms:mergeUniforms([Qi.envmap,{opacity:{value:1}}]),vertexShader:Xi.cube_vert,fragmentShader:Xi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xi.equirect_vert,fragmentShader:Xi.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([Qi.common,Qi.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xi.distanceRGBA_vert,fragmentShader:Xi.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([Qi.lights,Qi.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:Xi.shadow_vert,fragmentShader:Xi.shadow_frag}};function WebGLBackground(t,n,i,o,a){const s=new Color(0);let m,g,_=0,S=null,M=0,T=null;function setClear(t,n){i.buffers.color.setClear(t.r,t.g,t.b,n,a)}return{getClearColor:function(){return s},setClearColor:function(t,n=1){s.set(t),_=n,setClear(s,_)},getClearAlpha:function(){return _},setClearAlpha:function(t){_=t,setClear(s,_)},render:function render(i,a,O,A){let R=!0===a.isScene?a.background:null;R&&R.isTexture&&(R=n.get(R));const N=t.xr,I=N.getSession&&N.getSession();I&&"additive"===I.environmentBlendMode&&(R=null),null===R?setClear(s,_):R&&R.isColor&&(setClear(R,1),A=!0),(t.autoClear||A)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),R&&(R.isCubeTexture||R.isWebGLCubeRenderTarget||R.mapping===Pe)?(void 0===g&&(g=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(Yi.cube.uniforms),vertexShader:Yi.cube.vertexShader,fragmentShader:Yi.cube.fragmentShader,side:L,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),g.geometry.deleteAttribute("uv"),g.onBeforeRender=function(t,n,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(g.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(g)),R.isWebGLCubeRenderTarget&&(R=R.texture),g.material.uniforms.envMap.value=R,g.material.uniforms.flipEnvMap.value=R.isCubeTexture&&R._needsFlipEnvMap?-1:1,S===R&&M===R.version&&T===t.toneMapping||(g.material.needsUpdate=!0,S=R,M=R.version,T=t.toneMapping),i.unshift(g,g.geometry,g.material,0,0,null)):R&&R.isTexture&&(void 0===m&&(m=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(Yi.background.uniforms),vertexShader:Yi.background.vertexShader,fragmentShader:Yi.background.fragmentShader,side:P,depthTest:!1,depthWrite:!1,fog:!1})),m.geometry.deleteAttribute("normal"),Object.defineProperty(m.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(m)),m.material.uniforms.t2D.value=R,!0===R.matrixAutoUpdate&&R.updateMatrix(),m.material.uniforms.uvTransform.value.copy(R.matrix),S===R&&M===R.version&&T===t.toneMapping||(m.material.needsUpdate=!0,S=R,M=R.version,T=t.toneMapping),i.unshift(m,m.geometry,m.material,0,0,null))}}}function WebGLBindingStates(t,n,i,o){const a=t.getParameter(34921),s=o.isWebGL2?null:n.get("OES_vertex_array_object"),m=o.isWebGL2||null!==s,g={},_=createBindingState(null);let S=_;function bindVertexArrayObject(n){return o.isWebGL2?t.bindVertexArray(n):s.bindVertexArrayOES(n)}function deleteVertexArrayObject(n){return o.isWebGL2?t.deleteVertexArray(n):s.deleteVertexArrayOES(n)}function createBindingState(t){const n=[],i=[],o=[];for(let t=0;t<a;t++)n[t]=0,i[t]=0,o[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:n,enabledAttributes:i,attributeDivisors:o,object:t,attributes:{},index:null}}function initAttributes(){const t=S.newAttributes;for(let n=0,i=t.length;n<i;n++)t[n]=0}function enableAttribute(t){enableAttributeAndDivisor(t,0)}function enableAttributeAndDivisor(i,a){const s=S.newAttributes,m=S.enabledAttributes,g=S.attributeDivisors;s[i]=1,0===m[i]&&(t.enableVertexAttribArray(i),m[i]=1),g[i]!==a&&((o.isWebGL2?t:n.get("ANGLE_instanced_arrays"))[o.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,a),g[i]=a)}function disableUnusedAttributes(){const n=S.newAttributes,i=S.enabledAttributes;for(let o=0,a=i.length;o<a;o++)i[o]!==n[o]&&(t.disableVertexAttribArray(o),i[o]=0)}function vertexAttribPointer(n,i,a,s,m,g){!0!==o.isWebGL2||5124!==a&&5125!==a?t.vertexAttribPointer(n,i,a,s,m,g):t.vertexAttribIPointer(n,i,a,m,g)}function reset(){resetDefaultState(),S!==_&&(S=_,bindVertexArrayObject(S.object))}function resetDefaultState(){_.geometry=null,_.program=null,_.wireframe=!1}return{setup:function setup(a,_,M,T,O){let A=!1;if(m){const n=function getBindingState(n,i,a){const m=!0===a.wireframe;let _=g[n.id];void 0===_&&(_={},g[n.id]=_);let S=_[i.id];void 0===S&&(S={},_[i.id]=S);let M=S[m];return void 0===M&&(M=createBindingState(function createVertexArrayObject(){return o.isWebGL2?t.createVertexArray():s.createVertexArrayOES()}()),S[m]=M),M}(T,M,_);S!==n&&(S=n,bindVertexArrayObject(S.object)),A=function needsUpdate(t,n){const i=S.attributes,o=t.attributes;let a=0;for(const t in o){const n=i[t],s=o[t];if(void 0===n)return!0;if(n.attribute!==s)return!0;if(n.data!==s.data)return!0;a++}return S.attributesNum!==a||S.index!==n}(T,O),A&&function saveCache(t,n){const i={},o=t.attributes;let a=0;for(const t in o){const n=o[t],s={};s.attribute=n,n.data&&(s.data=n.data),i[t]=s,a++}S.attributes=i,S.attributesNum=a,S.index=n}(T,O)}else{const t=!0===_.wireframe;S.geometry===T.id&&S.program===M.id&&S.wireframe===t||(S.geometry=T.id,S.program=M.id,S.wireframe=t,A=!0)}!0===a.isInstancedMesh&&(A=!0),null!==O&&i.update(O,34963),A&&(function setupVertexAttributes(a,s,m,g){if(!1===o.isWebGL2&&(a.isInstancedMesh||g.isInstancedBufferGeometry)&&null===n.get("ANGLE_instanced_arrays"))return;initAttributes();const _=g.attributes,S=m.getAttributes(),M=s.defaultAttributeValues;for(const n in S){const o=S[n];if(o>=0){const s=_[n];if(void 0!==s){const n=s.normalized,a=s.itemSize,m=i.get(s);if(void 0===m)continue;const _=m.buffer,S=m.type,M=m.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,m=i.stride,T=s.offset;i&&i.isInstancedInterleavedBuffer?(enableAttributeAndDivisor(o,i.meshPerAttribute),void 0===g._maxInstanceCount&&(g._maxInstanceCount=i.meshPerAttribute*i.count)):enableAttribute(o),t.bindBuffer(34962,_),vertexAttribPointer(o,a,S,n,m*M,T*M)}else s.isInstancedBufferAttribute?(enableAttributeAndDivisor(o,s.meshPerAttribute),void 0===g._maxInstanceCount&&(g._maxInstanceCount=s.meshPerAttribute*s.count)):enableAttribute(o),t.bindBuffer(34962,_),vertexAttribPointer(o,a,S,n,0,0)}else if("instanceMatrix"===n){const n=i.get(a.instanceMatrix);if(void 0===n)continue;const s=n.buffer,m=n.type;enableAttributeAndDivisor(o+0,1),enableAttributeAndDivisor(o+1,1),enableAttributeAndDivisor(o+2,1),enableAttributeAndDivisor(o+3,1),t.bindBuffer(34962,s),t.vertexAttribPointer(o+0,4,m,!1,64,0),t.vertexAttribPointer(o+1,4,m,!1,64,16),t.vertexAttribPointer(o+2,4,m,!1,64,32),t.vertexAttribPointer(o+3,4,m,!1,64,48)}else if("instanceColor"===n){const n=i.get(a.instanceColor);if(void 0===n)continue;const s=n.buffer,m=n.type;enableAttributeAndDivisor(o,1),t.bindBuffer(34962,s),t.vertexAttribPointer(o,3,m,!1,12,0)}else if(void 0!==M){const i=M[n];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(o,i);break;case 3:t.vertexAttrib3fv(o,i);break;case 4:t.vertexAttrib4fv(o,i);break;default:t.vertexAttrib1fv(o,i)}}}}disableUnusedAttributes()}(a,_,M,T),null!==O&&t.bindBuffer(34963,i.get(O).buffer))},reset,resetDefaultState,dispose:function dispose(){reset();for(const t in g){const n=g[t];for(const t in n){const i=n[t];for(const t in i)deleteVertexArrayObject(i[t].object),delete i[t];delete n[t]}delete g[t]}},releaseStatesOfGeometry:function releaseStatesOfGeometry(t){if(void 0===g[t.id])return;const n=g[t.id];for(const t in n){const i=n[t];for(const t in i)deleteVertexArrayObject(i[t].object),delete i[t];delete n[t]}delete g[t.id]},releaseStatesOfProgram:function releaseStatesOfProgram(t){for(const n in g){const i=g[n];if(void 0===i[t.id])continue;const o=i[t.id];for(const t in o)deleteVertexArrayObject(o[t].object),delete o[t];delete i[t.id]}},initAttributes,enableAttribute,disableUnusedAttributes}}function WebGLBufferRenderer(t,n,i,o){const a=o.isWebGL2;let s;this.setMode=function setMode(t){s=t},this.render=function render(n,o){t.drawArrays(s,n,o),i.update(o,s,1)},this.renderInstances=function renderInstances(o,m,g){if(0===g)return;let _,S;if(a)_=t,S="drawArraysInstanced";else if(_=n.get("ANGLE_instanced_arrays"),S="drawArraysInstancedANGLE",null===_)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");_[S](s,o,m,g),i.update(m,s,g)}}function WebGLCapabilities(t,n,i){let o;function getMaxPrecision(n){if("highp"===n){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";n="mediump"}return"mediump"===n&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==i.precision?i.precision:"highp";const m=getMaxPrecision(s);m!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",m,"instead."),s=m);const g=!0===i.logarithmicDepthBuffer,_=t.getParameter(34930),S=t.getParameter(35660),M=t.getParameter(3379),T=t.getParameter(34076),O=t.getParameter(34921),A=t.getParameter(36347),P=t.getParameter(36348),L=t.getParameter(36349),R=S>0,N=a||!!n.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==o)return o;const i=n.get("EXT_texture_filter_anisotropic");return o=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,o},getMaxPrecision,precision:s,logarithmicDepthBuffer:g,maxTextures:_,maxVertexTextures:S,maxTextureSize:M,maxCubemapSize:T,maxAttributes:O,maxVertexUniforms:A,maxVaryings:P,maxFragmentUniforms:L,vertexTextures:R,floatFragmentTextures:N,floatVertexTextures:R&&N,maxSamples:a?t.getParameter(36183):0}}function WebGLClipping(t){const n=this;let i=null,o=0,a=!1,s=!1;const m=new Plane,g=new Matrix3,_={value:null,needsUpdate:!1};function resetGlobalState(){_.value!==i&&(_.value=i,_.needsUpdate=o>0),n.numPlanes=o,n.numIntersection=0}function projectPlanes(t,i,o,a){const s=null!==t?t.length:0;let S=null;if(0!==s){if(S=_.value,!0!==a||null===S){const n=o+4*s,a=i.matrixWorldInverse;g.getNormalMatrix(a),(null===S||S.length<n)&&(S=new Float32Array(n));for(let n=0,i=o;n!==s;++n,i+=4)m.copy(t[n]).applyMatrix4(a,g),m.normal.toArray(S,i),S[i+3]=m.constant}_.value=S,_.needsUpdate=!0}return n.numPlanes=s,n.numIntersection=0,S}this.uniform=_,this.numPlanes=0,this.numIntersection=0,this.init=function(t,n,s){const m=0!==t.length||n||0!==o||a;return a=n,i=projectPlanes(t,s,0),o=t.length,m},this.beginShadows=function(){s=!0,projectPlanes(null)},this.endShadows=function(){s=!1,resetGlobalState()},this.setState=function(n,m,g){const S=n.clippingPlanes,M=n.clipIntersection,T=n.clipShadows,O=t.get(n);if(!a||null===S||0===S.length||s&&!T)s?projectPlanes(null):resetGlobalState();else{const t=s?0:o,n=4*t;let a=O.clippingState||null;_.value=a,a=projectPlanes(S,m,n,g);for(let t=0;t!==n;++t)a[t]=i[t];O.clippingState=a,this.numIntersection=M?this.numPlanes:0,this.numPlanes+=t}}}function WebGLCubeMaps(t){let n=new WeakMap;function mapTextureMapping(t,n){return n===Oe?t.mapping=Te:n===Ae&&(t.mapping=Ce),t}function onTextureDispose(t){const i=t.target;i.removeEventListener("dispose",onTextureDispose);const o=n.get(i);void 0!==o&&(n.delete(i),o.dispose())}return{get:function get(i){if(i&&i.isTexture){const o=i.mapping;if(o===Oe||o===Ae){if(n.has(i))return mapTextureMapping(n.get(i).texture,i.mapping);{const o=i.image;if(o&&o.height>0){const a=t.getRenderList(),s=t.getRenderTarget(),m=new WebGLCubeRenderTarget(o.height/2);return m.fromEquirectangularTexture(t,i),n.set(i,m),t.setRenderTarget(s),t.setRenderList(a),i.addEventListener("dispose",onTextureDispose),mapTextureMapping(m.texture,i.mapping)}return null}}}return i},dispose:function dispose(){n=new WeakMap}}}function WebGLExtensions(t){const n={};return{has:function(i){if(void 0!==n[i])return null!==n[i];let o;switch(i){case"WEBGL_depth_texture":o=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=t.getExtension(i)}return n[i]=o,null!==o},get:function(t){return this.has(t)||console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),n[t]}}}function WebGLGeometries(t,n,i,o){const a=new WeakMap,s=new WeakMap;function onGeometryDispose(t){const m=t.target,g=a.get(m);null!==g.index&&n.remove(g.index);for(const t in g.attributes)n.remove(g.attributes[t]);m.removeEventListener("dispose",onGeometryDispose),a.delete(m);const _=s.get(g);_&&(n.remove(_),s.delete(g)),o.releaseStatesOfGeometry(g),!0===m.isInstancedBufferGeometry&&delete m._maxInstanceCount,i.memory.geometries--}function updateWireframeAttribute(t){const i=[],o=t.index,a=t.attributes.position;let m=0;if(null!==o){const t=o.array;m=o.version;for(let n=0,o=t.length;n<o;n+=3){const o=t[n+0],a=t[n+1],s=t[n+2];i.push(o,a,a,s,s,o)}}else{const t=a.array;m=a.version;for(let n=0,o=t.length/3-1;n<o;n+=3){const t=n+0,o=n+1,a=n+2;i.push(t,o,o,a,a,t)}}const g=new(arrayMax(i)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(i,1);g.version=m;const _=s.get(t);_&&n.remove(_),s.set(t,g)}return{get:function get(t,n){let o=a.get(n);return o||(n.addEventListener("dispose",onGeometryDispose),n.isBufferGeometry?o=n:n.isGeometry&&(void 0===n._bufferGeometry&&(n._bufferGeometry=(new BufferGeometry).setFromObject(t)),o=n._bufferGeometry),a.set(n,o),i.memory.geometries++,o)},update:function update(t){const i=t.attributes;for(const t in i)n.update(i[t],34962);const o=t.morphAttributes;for(const t in o){const i=o[t];for(let t=0,o=i.length;t<o;t++)n.update(i[t],34962)}},getWireframeAttribute:function getWireframeAttribute(t){const n=s.get(t);if(n){const i=t.index;null!==i&&n.version<i.version&&updateWireframeAttribute(t)}else updateWireframeAttribute(t);return s.get(t)}}}function WebGLIndexedBufferRenderer(t,n,i,o){const a=o.isWebGL2;let s,m,g;this.setMode=function setMode(t){s=t},this.setIndex=function setIndex(t){m=t.type,g=t.bytesPerElement},this.render=function render(n,o){t.drawElements(s,o,m,n*g),i.update(o,s,1)},this.renderInstances=function renderInstances(o,_,S){if(0===S)return;let M,T;if(a)M=t,T="drawElementsInstanced";else if(M=n.get("ANGLE_instanced_arrays"),T="drawElementsInstancedANGLE",null===M)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");M[T](s,_,m,o*g,S),i.update(_,s,S)}}function WebGLInfo(t){const n={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:n,programs:null,autoReset:!0,reset:function reset(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0},update:function update(t,i,o){switch(n.calls++,i){case 4:n.triangles+=o*(t/3);break;case 1:n.lines+=o*(t/2);break;case 3:n.lines+=o*(t-1);break;case 2:n.lines+=o*t;break;case 0:n.points+=o*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function numericalSort(t,n){return t[0]-n[0]}function absNumericalSort(t,n){return Math.abs(n[1])-Math.abs(t[1])}function WebGLMorphtargets(t){const n={},i=new Float32Array(8),o=[];for(let t=0;t<8;t++)o[t]=[t,0];return{update:function update(a,s,m,g){const _=a.morphTargetInfluences,S=void 0===_?0:_.length;let M=n[s.id];if(void 0===M){M=[];for(let t=0;t<S;t++)M[t]=[t,0];n[s.id]=M}for(let t=0;t<S;t++){const n=M[t];n[0]=t,n[1]=_[t]}M.sort(absNumericalSort);for(let t=0;t<8;t++)t<S&&M[t][1]?(o[t][0]=M[t][0],o[t][1]=M[t][1]):(o[t][0]=Number.MAX_SAFE_INTEGER,o[t][1]=0);o.sort(numericalSort);const T=m.morphTargets&&s.morphAttributes.position,O=m.morphNormals&&s.morphAttributes.normal;let A=0;for(let t=0;t<8;t++){const n=o[t],a=n[0],m=n[1];a!==Number.MAX_SAFE_INTEGER&&m?(T&&s.getAttribute("morphTarget"+t)!==T[a]&&s.setAttribute("morphTarget"+t,T[a]),O&&s.getAttribute("morphNormal"+t)!==O[a]&&s.setAttribute("morphNormal"+t,O[a]),i[t]=m,A+=m):(T&&!0===s.hasAttribute("morphTarget"+t)&&s.deleteAttribute("morphTarget"+t),O&&!0===s.hasAttribute("morphNormal"+t)&&s.deleteAttribute("morphNormal"+t),i[t]=0)}const P=s.morphTargetsRelative?1:1-A;g.getUniforms().setValue(t,"morphTargetBaseInfluence",P),g.getUniforms().setValue(t,"morphTargetInfluences",i)}}}function WebGLObjects(t,n,i,o){let a=new WeakMap;function onInstancedMeshDispose(t){const n=t.target;n.removeEventListener("dispose",onInstancedMeshDispose),i.remove(n.instanceMatrix),null!==n.instanceColor&&i.remove(n.instanceColor)}return{update:function update(t){const s=o.render.frame,m=t.geometry,g=n.get(t,m);return a.get(g)!==s&&(m.isGeometry&&g.updateFromObject(t),n.update(g),a.set(g,s)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",onInstancedMeshDispose)&&t.addEventListener("dispose",onInstancedMeshDispose),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),g},dispose:function dispose(){a=new WeakMap}}}function DataTexture2DArray(t=null,n=1,i=1,o=1){Texture.call(this,null),this.image={data:t,width:n,height:i,depth:o},this.magFilter=ke,this.minFilter=ke,this.wrapR=Ne,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function DataTexture3D(t=null,n=1,i=1,o=1){Texture.call(this,null),this.image={data:t,width:n,height:i,depth:o},this.magFilter=ke,this.minFilter=ke,this.wrapR=Ne,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Yi.physical={uniforms:mergeUniforms([Yi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Xi.meshphysical_vert,fragmentShader:Xi.meshphysical_frag},DataTexture2DArray.prototype=Object.create(Texture.prototype),DataTexture2DArray.prototype.constructor=DataTexture2DArray,DataTexture2DArray.prototype.isDataTexture2DArray=!0,DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;const Ji=new Texture,Ki=new DataTexture2DArray,$i=new DataTexture3D,eo=new CubeTexture,to=[],no=[],ro=new Float32Array(16),io=new Float32Array(9),oo=new Float32Array(4);function flatten(t,n,i){const o=t[0];if(o<=0||o>0)return t;const a=n*i;let s=to[a];if(void 0===s&&(s=new Float32Array(a),to[a]=s),0!==n){o.toArray(s,0);for(let o=1,a=0;o!==n;++o)a+=i,t[o].toArray(s,a)}return s}function arraysEqual(t,n){if(t.length!==n.length)return!1;for(let i=0,o=t.length;i<o;i++)if(t[i]!==n[i])return!1;return!0}function copyArray(t,n){for(let i=0,o=n.length;i<o;i++)t[i]=n[i]}function allocTexUnits(t,n){let i=no[n];void 0===i&&(i=new Int32Array(n),no[n]=i);for(let o=0;o!==n;++o)i[o]=t.allocateTextureUnit();return i}function setValueV1f(t,n){const i=this.cache;i[0]!==n&&(t.uniform1f(this.addr,n),i[0]=n)}function setValueV2f(t,n){const i=this.cache;if(void 0!==n.x)i[0]===n.x&&i[1]===n.y||(t.uniform2f(this.addr,n.x,n.y),i[0]=n.x,i[1]=n.y);else{if(arraysEqual(i,n))return;t.uniform2fv(this.addr,n),copyArray(i,n)}}function setValueV3f(t,n){const i=this.cache;if(void 0!==n.x)i[0]===n.x&&i[1]===n.y&&i[2]===n.z||(t.uniform3f(this.addr,n.x,n.y,n.z),i[0]=n.x,i[1]=n.y,i[2]=n.z);else if(void 0!==n.r)i[0]===n.r&&i[1]===n.g&&i[2]===n.b||(t.uniform3f(this.addr,n.r,n.g,n.b),i[0]=n.r,i[1]=n.g,i[2]=n.b);else{if(arraysEqual(i,n))return;t.uniform3fv(this.addr,n),copyArray(i,n)}}function setValueV4f(t,n){const i=this.cache;if(void 0!==n.x)i[0]===n.x&&i[1]===n.y&&i[2]===n.z&&i[3]===n.w||(t.uniform4f(this.addr,n.x,n.y,n.z,n.w),i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=n.w);else{if(arraysEqual(i,n))return;t.uniform4fv(this.addr,n),copyArray(i,n)}}function setValueM2(t,n){const i=this.cache,o=n.elements;if(void 0===o){if(arraysEqual(i,n))return;t.uniformMatrix2fv(this.addr,!1,n),copyArray(i,n)}else{if(arraysEqual(i,o))return;oo.set(o),t.uniformMatrix2fv(this.addr,!1,oo),copyArray(i,o)}}function setValueM3(t,n){const i=this.cache,o=n.elements;if(void 0===o){if(arraysEqual(i,n))return;t.uniformMatrix3fv(this.addr,!1,n),copyArray(i,n)}else{if(arraysEqual(i,o))return;io.set(o),t.uniformMatrix3fv(this.addr,!1,io),copyArray(i,o)}}function setValueM4(t,n){const i=this.cache,o=n.elements;if(void 0===o){if(arraysEqual(i,n))return;t.uniformMatrix4fv(this.addr,!1,n),copyArray(i,n)}else{if(arraysEqual(i,o))return;ro.set(o),t.uniformMatrix4fv(this.addr,!1,ro),copyArray(i,o)}}function setValueT1(t,n,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(t.uniform1i(this.addr,a),o[0]=a),i.safeSetTexture2D(n||Ji,a)}function setValueT2DArray1(t,n,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(t.uniform1i(this.addr,a),o[0]=a),i.setTexture2DArray(n||Ki,a)}function setValueT3D1(t,n,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(t.uniform1i(this.addr,a),o[0]=a),i.setTexture3D(n||$i,a)}function setValueT6(t,n,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(t.uniform1i(this.addr,a),o[0]=a),i.safeSetTextureCube(n||eo,a)}function setValueV1i(t,n){const i=this.cache;i[0]!==n&&(t.uniform1i(this.addr,n),i[0]=n)}function setValueV2i(t,n){const i=this.cache;arraysEqual(i,n)||(t.uniform2iv(this.addr,n),copyArray(i,n))}function setValueV3i(t,n){const i=this.cache;arraysEqual(i,n)||(t.uniform3iv(this.addr,n),copyArray(i,n))}function setValueV4i(t,n){const i=this.cache;arraysEqual(i,n)||(t.uniform4iv(this.addr,n),copyArray(i,n))}function setValueV1ui(t,n){const i=this.cache;i[0]!==n&&(t.uniform1ui(this.addr,n),i[0]=n)}function setValueV1fArray(t,n){t.uniform1fv(this.addr,n)}function setValueV1iArray(t,n){t.uniform1iv(this.addr,n)}function setValueV2iArray(t,n){t.uniform2iv(this.addr,n)}function setValueV3iArray(t,n){t.uniform3iv(this.addr,n)}function setValueV4iArray(t,n){t.uniform4iv(this.addr,n)}function setValueV2fArray(t,n){const i=flatten(n,this.size,2);t.uniform2fv(this.addr,i)}function setValueV3fArray(t,n){const i=flatten(n,this.size,3);t.uniform3fv(this.addr,i)}function setValueV4fArray(t,n){const i=flatten(n,this.size,4);t.uniform4fv(this.addr,i)}function setValueM2Array(t,n){const i=flatten(n,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function setValueM3Array(t,n){const i=flatten(n,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function setValueM4Array(t,n){const i=flatten(n,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function setValueT1Array(t,n,i){const o=n.length,a=allocTexUnits(i,o);t.uniform1iv(this.addr,a);for(let t=0;t!==o;++t)i.safeSetTexture2D(n[t]||Ji,a[t])}function setValueT6Array(t,n,i){const o=n.length,a=allocTexUnits(i,o);t.uniform1iv(this.addr,a);for(let t=0;t!==o;++t)i.safeSetTextureCube(n[t]||eo,a[t])}function SingleUniform(t,n,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function getSingularSetter(t){switch(t){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}(n.type)}function PureArrayUniform(t,n,i){this.id=t,this.addr=i,this.cache=[],this.size=n.size,this.setValue=function getPureArraySetter(t){switch(t){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}(n.type)}function StructuredUniform(t){this.id=t,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(t){const n=this.cache;t instanceof Float32Array&&n.length!==t.length&&(this.cache=new Float32Array(t.length)),copyArray(n,t)},StructuredUniform.prototype.setValue=function(t,n,i){const o=this.seq;for(let a=0,s=o.length;a!==s;++a){const s=o[a];s.setValue(t,n[s.id],i)}};const ao=/(\w+)(\])?(\[|\.)?/g;function addUniform(t,n){t.seq.push(n),t.map[n.id]=n}function parseUniform(t,n,i){const o=t.name,a=o.length;for(ao.lastIndex=0;;){const s=ao.exec(o),m=ao.lastIndex;let g=s[1];const _="]"===s[2],S=s[3];if(_&&(g|=0),void 0===S||"["===S&&m+2===a){addUniform(i,void 0===S?new SingleUniform(g,t,n):new PureArrayUniform(g,t,n));break}{let t=i.map[g];void 0===t&&(t=new StructuredUniform(g),addUniform(i,t)),i=t}}}function WebGLUniforms(t,n){this.seq=[],this.map={};const i=t.getProgramParameter(n,35718);for(let o=0;o<i;++o){const i=t.getActiveUniform(n,o);parseUniform(i,t.getUniformLocation(n,i.name),this)}}function WebGLShader(t,n,i){const o=t.createShader(n);return t.shaderSource(o,i),t.compileShader(o),o}WebGLUniforms.prototype.setValue=function(t,n,i,o){const a=this.map[n];void 0!==a&&a.setValue(t,i,o)},WebGLUniforms.prototype.setOptional=function(t,n,i){const o=n[i];void 0!==o&&this.setValue(t,i,o)},WebGLUniforms.upload=function(t,n,i,o){for(let a=0,s=n.length;a!==s;++a){const s=n[a],m=i[s.id];!1!==m.needsUpdate&&s.setValue(t,m.value,o)}},WebGLUniforms.seqWithValue=function(t,n){const i=[];for(let o=0,a=t.length;o!==a;++o){const a=t[o];a.id in n&&i.push(a)}return i};let so=0;function getEncodingComponents(t){switch(t){case bn:return["Linear","( value )"];case _n:return["sRGB","( value )"];case xn:return["RGBE","( value )"];case Mn:return["RGBM","( value, 7.0 )"];case En:return["RGBM","( value, 16.0 )"];case Tn:return["RGBD","( value, 256.0 )"];case wn:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Sn:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function getShaderErrors(t,n,i){const o=t.getShaderParameter(n,35713),a=t.getShaderInfoLog(n).trim();return o&&""===a?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+a+function addLineNumbers(t){const n=t.split("\n");for(let t=0;t<n.length;t++)n[t]=t+1+": "+n[t];return n.join("\n")}(t.getShaderSource(n))}function getTexelDecodingFunction(t,n){const i=getEncodingComponents(n);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function getTexelEncodingFunction(t,n){const i=getEncodingComponents(n);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(t,n){let i;switch(n){case _e:i="Linear";break;case we:i="Reinhard";break;case xe:i="OptimizedCineon";break;case Se:i="ACESFilmic";break;case Me:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",n),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function filterEmptyLine(t){return""!==t}function replaceLightNums(t,n){return t.replace(/NUM_DIR_LIGHTS/g,n.numDirLights).replace(/NUM_SPOT_LIGHTS/g,n.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,n.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,n.numPointLights).replace(/NUM_HEMI_LIGHTS/g,n.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,n.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,n.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,n.numPointLightShadows)}function replaceClippingPlaneNums(t,n){return t.replace(/NUM_CLIPPING_PLANES/g,n.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,n.numClippingPlanes-n.numClipIntersection)}const co=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(t){return t.replace(co,includeReplacer)}function includeReplacer(t,n){const i=Xi[n];if(void 0===i)throw new Error("Can not resolve #include <"+n+">");return resolveIncludes(i)}const uo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,lo=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(t){return t.replace(lo,loopReplacer).replace(uo,deprecatedLoopReplacer)}function deprecatedLoopReplacer(t,n,i,o){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(t,n,i,o)}function loopReplacer(t,n,i,o){let a="";for(let t=parseInt(n);t<parseInt(i);t++)a+=o.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return a}function generatePrecision(t){let n="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?n+="\n#define HIGH_PRECISION":"mediump"===t.precision?n+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(n+="\n#define LOW_PRECISION"),n}function WebGLProgram(t,n,i,o){const a=t.getContext(),s=i.defines;let m=i.vertexShader,g=i.fragmentShader;const _=function generateShadowMapTypeDefine(t){let n="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===T?n="SHADOWMAP_TYPE_PCF":t.shadowMapType===O?n="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===A&&(n="SHADOWMAP_TYPE_VSM"),n}(i),S=function generateEnvMapTypeDefine(t){let n="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Te:case Ce:n="ENVMAP_TYPE_CUBE";break;case Pe:case Le:n="ENVMAP_TYPE_CUBE_UV"}return n}(i),M=function generateEnvMapModeDefine(t){let n="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Ce:case Le:n="ENVMAP_MODE_REFRACTION"}return n}(i),P=function generateEnvMapBlendingDefine(t){let n="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case ge:n="ENVMAP_BLENDING_MULTIPLY";break;case ye:n="ENVMAP_BLENDING_MIX";break;case ve:n="ENVMAP_BLENDING_ADD"}return n}(i),L=t.gammaFactor>0?t.gammaFactor:1,R=i.isWebGL2?"":function generateExtensions(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(i),N=function generateDefines(t){const n=[];for(const i in t){const o=t[i];!1!==o&&n.push("#define "+i+" "+o)}return n.join("\n")}(s),I=a.createProgram();let j,V,U=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(j=[N].filter(filterEmptyLine).join("\n"),j.length>0&&(j+="\n"),V=[R,N].filter(filterEmptyLine).join("\n"),V.length>0&&(V+="\n")):(j=[generatePrecision(i),"#define SHADER_NAME "+i.shaderName,N,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+L,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+M:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+_:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),V=[R,generatePrecision(i),"#define SHADER_NAME "+i.shaderName,N,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+L,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+S:"",i.envMap?"#define "+M:"",i.envMap?"#define "+P:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+_:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==be?"#define TONE_MAPPING":"",i.toneMapping!==be?Xi.tonemapping_pars_fragment:"",i.toneMapping!==be?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",Xi.encodings_pars_fragment,i.map?getTexelDecodingFunction("mapTexelToLinear",i.mapEncoding):"",i.matcap?getTexelDecodingFunction("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?getTexelDecodingFunction("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",i.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),m=resolveIncludes(m),m=replaceLightNums(m,i),m=replaceClippingPlaneNums(m,i),g=resolveIncludes(g),g=replaceLightNums(g,i),g=replaceClippingPlaneNums(g,i),m=unrollLoops(m),g=unrollLoops(g),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(U="#version 300 es\n",j=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+j,V=["#define varying in",i.glslVersion===rr?"":"out highp vec4 pc_fragColor;",i.glslVersion===rr?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+V);const G=U+V+g,z=WebGLShader(a,35633,U+j+m),H=WebGLShader(a,35632,G);if(a.attachShader(I,z),a.attachShader(I,H),void 0!==i.index0AttributeName?a.bindAttribLocation(I,0,i.index0AttributeName):!0===i.morphTargets&&a.bindAttribLocation(I,0,"position"),a.linkProgram(I),t.debug.checkShaderErrors){const t=a.getProgramInfoLog(I).trim(),n=a.getShaderInfoLog(z).trim(),i=a.getShaderInfoLog(H).trim();let o=!0,s=!0;if(!1===a.getProgramParameter(I,35714)){o=!1;const n=getShaderErrors(a,z,"vertex"),i=getShaderErrors(a,H,"fragment");console.error("THREE.WebGLProgram: shader error: ",a.getError(),"35715",a.getProgramParameter(I,35715),"gl.getProgramInfoLog",t,n,i)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==n&&""!==i||(s=!1);s&&(this.diagnostics={runnable:o,programLog:t,vertexShader:{log:n,prefix:j},fragmentShader:{log:i,prefix:V}})}let q,Z;return a.deleteShader(z),a.deleteShader(H),this.getUniforms=function(){return void 0===q&&(q=new WebGLUniforms(a,I)),q},this.getAttributes=function(){return void 0===Z&&(Z=function fetchAttributeLocations(t,n){const i={},o=t.getProgramParameter(n,35721);for(let a=0;a<o;a++){const o=t.getActiveAttrib(n,a).name;i[o]=t.getAttribLocation(n,o)}return i}(a,I)),Z},this.destroy=function(){o.releaseStatesOfProgram(this),a.deleteProgram(I),this.program=void 0},this.name=i.shaderName,this.id=so++,this.cacheKey=n,this.usedTimes=1,this.program=I,this.vertexShader=z,this.fragmentShader=H,this}function WebGLPrograms(t,n,i,o,a,s){const m=[],g=o.isWebGL2,_=o.logarithmicDepthBuffer,S=o.floatVertexTextures,M=o.maxVertexUniforms,T=o.vertexTextures;let O=o.precision;const A={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},P=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function getTextureEncodingFromMap(t){let n;return t&&t.isTexture?n=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=t.texture.encoding):n=bn,n}return{getParameters:function getParameters(a,m,P,N,I){const j=N.fog,V=a.isMeshStandardMaterial?N.environment:null,U=n.get(a.envMap||V),G=A[a.type],z=I.isSkinnedMesh?function getMaxBones(t){const n=t.skeleton.bones;if(S)return 1024;{const t=M,i=Math.floor((t-20)/4),o=Math.min(i,n.length);return o<n.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+n.length+" bones. This GPU supports "+o+"."),0):o}}(I):0;let H,q;if(null!==a.precision&&(O=o.getMaxPrecision(a.precision),O!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",O,"instead.")),G){const t=Yi[G];H=t.vertexShader,q=t.fragmentShader}else H=a.vertexShader,q=a.fragmentShader;const Z=t.getRenderTarget();return{isWebGL2:g,shaderID:G,shaderName:a.type,vertexShader:H,fragmentShader:q,defines:a.defines,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:O,instancing:!0===I.isInstancedMesh,instancingColor:!0===I.isInstancedMesh&&null!==I.instanceColor,supportsVertexTextures:T,outputEncoding:null!==Z?getTextureEncodingFromMap(Z.texture):t.outputEncoding,map:!!a.map,mapEncoding:getTextureEncodingFromMap(a.map),matcap:!!a.matcap,matcapEncoding:getTextureEncodingFromMap(a.matcap),envMap:!!U,envMapMode:U&&U.mapping,envMapEncoding:getTextureEncodingFromMap(U),envMapCubeUV:!!U&&(U.mapping===Pe||U.mapping===Le),lightMap:!!a.lightMap,lightMapEncoding:getTextureEncodingFromMap(a.lightMap),aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(a.emissiveMap),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:a.normalMapType===Pn,tangentSpaceNormalMap:a.normalMapType===An,clearcoatMap:!!a.clearcoatMap,clearcoatRoughnessMap:!!a.clearcoatRoughnessMap,clearcoatNormalMap:!!a.clearcoatNormalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,alphaMap:!!a.alphaMap,gradientMap:!!a.gradientMap,sheen:!!a.sheen,transmissionMap:!!a.transmissionMap,combine:a.combine,vertexTangents:a.normalMap&&a.vertexTangents,vertexColors:a.vertexColors,vertexUvs:!!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatMap||a.clearcoatRoughnessMap||a.clearcoatNormalMap||a.displacementMap||a.transmissionMap),uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.transmissionMap||!a.displacementMap),fog:!!j,useFog:a.fog,fogExp2:j&&j.isFogExp2,flatShading:a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:_,skinning:a.skinning&&z>0,maxBones:z,useVertexTexture:S,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:m.directional.length,numPointLights:m.point.length,numSpotLights:m.spot.length,numRectAreaLights:m.rectArea.length,numHemiLights:m.hemi.length,numDirLightShadows:m.directionalShadowMap.length,numPointLightShadows:m.pointShadowMap.length,numSpotLightShadows:m.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:t.shadowMap.enabled&&P.length>0,shadowMapType:t.shadowMap.type,toneMapping:a.toneMapped?t.toneMapping:be,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,alphaTest:a.alphaTest,doubleSided:a.side===R,flipSided:a.side===L,depthPacking:void 0!==a.depthPacking&&a.depthPacking,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||i.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function getProgramCacheKey(n){const i=[];if(n.shaderID?i.push(n.shaderID):(i.push(n.fragmentShader),i.push(n.vertexShader)),void 0!==n.defines)for(const t in n.defines)i.push(t),i.push(n.defines[t]);if(!1===n.isRawShaderMaterial){for(let t=0;t<P.length;t++)i.push(n[P[t]]);i.push(t.outputEncoding),i.push(t.gammaFactor)}return i.push(n.customProgramCacheKey),i.join()},getUniforms:function getUniforms(t){const n=A[t.type];let i;if(n){const t=Yi[n];i=Wi.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function acquireProgram(n,i){let o;for(let t=0,n=m.length;t<n;t++){const n=m[t];if(n.cacheKey===i){o=n,++o.usedTimes;break}}return void 0===o&&(o=new WebGLProgram(t,i,n,a),m.push(o)),o},releaseProgram:function releaseProgram(t){if(0==--t.usedTimes){const n=m.indexOf(t);m[n]=m[m.length-1],m.pop(),t.destroy()}},programs:m}}function WebGLProperties(){let t=new WeakMap;return{get:function get(n){let i=t.get(n);return void 0===i&&(i={},t.set(n,i)),i},remove:function remove(n){t.delete(n)},update:function update(n,i,o){t.get(n)[i]=o},dispose:function dispose(){t=new WeakMap}}}function painterSortStable(t,n){return t.groupOrder!==n.groupOrder?t.groupOrder-n.groupOrder:t.renderOrder!==n.renderOrder?t.renderOrder-n.renderOrder:t.program!==n.program?t.program.id-n.program.id:t.material.id!==n.material.id?t.material.id-n.material.id:t.z!==n.z?t.z-n.z:t.id-n.id}function reversePainterSortStable(t,n){return t.groupOrder!==n.groupOrder?t.groupOrder-n.groupOrder:t.renderOrder!==n.renderOrder?t.renderOrder-n.renderOrder:t.z!==n.z?n.z-t.z:t.id-n.id}function WebGLRenderList(t){const n=[];let i=0;const o=[],a=[],s={id:-1};function getNextRenderItem(o,a,m,g,_,S){let M=n[i];const T=t.get(m);return void 0===M?(M={id:o.id,object:o,geometry:a,material:m,program:T.program||s,groupOrder:g,renderOrder:o.renderOrder,z:_,group:S},n[i]=M):(M.id=o.id,M.object=o,M.geometry=a,M.material=m,M.program=T.program||s,M.groupOrder=g,M.renderOrder=o.renderOrder,M.z=_,M.group=S),i++,M}return{opaque:o,transparent:a,init:function init(){i=0,o.length=0,a.length=0},push:function push(t,n,i,s,m,g){const _=getNextRenderItem(t,n,i,s,m,g);(!0===i.transparent?a:o).push(_)},unshift:function unshift(t,n,i,s,m,g){const _=getNextRenderItem(t,n,i,s,m,g);(!0===i.transparent?a:o).unshift(_)},finish:function finish(){for(let t=i,o=n.length;t<o;t++){const i=n[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function sort(t,n){o.length>1&&o.sort(t||painterSortStable),a.length>1&&a.sort(n||reversePainterSortStable)}}}function WebGLRenderLists(t){let n=new WeakMap;return{get:function get(i,o){const a=n.get(i);let s;return void 0===a?(s=new WebGLRenderList(t),n.set(i,new WeakMap),n.get(i).set(o,s)):(s=a.get(o),void 0===s&&(s=new WebGLRenderList(t),a.set(o,s))),s},dispose:function dispose(){n=new WeakMap}}}function UniformsCache(){const t={};return{get:function(n){if(void 0!==t[n.id])return t[n.id];let i;switch(n.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return t[n.id]=i,i}}}let ho=0;function shadowCastingLightsFirst(t,n){return(n.castShadow?1:0)-(t.castShadow?1:0)}function WebGLLights(t,n){const i=new UniformsCache,o=function ShadowUniformsCache(){const t={};return{get:function(n){if(void 0!==t[n.id])return t[n.id];let i;switch(n.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return t[n.id]=i,i}}}(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)a.probe.push(new Vector3);const s=new Vector3,m=new Matrix4,g=new Matrix4;return{setup:function setup(s){let m=0,g=0,_=0;for(let t=0;t<9;t++)a.probe[t].set(0,0,0);let S=0,M=0,T=0,O=0,A=0,P=0,L=0,R=0;s.sort(shadowCastingLightsFirst);for(let t=0,n=s.length;t<n;t++){const n=s[t],N=n.color,I=n.intensity,j=n.distance,V=n.shadow&&n.shadow.map?n.shadow.map.texture:null;if(n.isAmbientLight)m+=N.r*I,g+=N.g*I,_+=N.b*I;else if(n.isLightProbe)for(let t=0;t<9;t++)a.probe[t].addScaledVector(n.sh.coefficients[t],I);else if(n.isDirectionalLight){const t=i.get(n);if(t.color.copy(n.color).multiplyScalar(n.intensity),n.castShadow){const t=n.shadow,i=o.get(n);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,a.directionalShadow[S]=i,a.directionalShadowMap[S]=V,a.directionalShadowMatrix[S]=n.shadow.matrix,P++}a.directional[S]=t,S++}else if(n.isSpotLight){const t=i.get(n);if(t.position.setFromMatrixPosition(n.matrixWorld),t.color.copy(N).multiplyScalar(I),t.distance=j,t.coneCos=Math.cos(n.angle),t.penumbraCos=Math.cos(n.angle*(1-n.penumbra)),t.decay=n.decay,n.castShadow){const t=n.shadow,i=o.get(n);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,a.spotShadow[T]=i,a.spotShadowMap[T]=V,a.spotShadowMatrix[T]=n.shadow.matrix,R++}a.spot[T]=t,T++}else if(n.isRectAreaLight){const t=i.get(n);t.color.copy(N).multiplyScalar(I),t.halfWidth.set(.5*n.width,0,0),t.halfHeight.set(0,.5*n.height,0),a.rectArea[O]=t,O++}else if(n.isPointLight){const t=i.get(n);if(t.color.copy(n.color).multiplyScalar(n.intensity),t.distance=n.distance,t.decay=n.decay,n.castShadow){const t=n.shadow,i=o.get(n);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,a.pointShadow[M]=i,a.pointShadowMap[M]=V,a.pointShadowMatrix[M]=n.shadow.matrix,L++}a.point[M]=t,M++}else if(n.isHemisphereLight){const t=i.get(n);t.skyColor.copy(n.color).multiplyScalar(I),t.groundColor.copy(n.groundColor).multiplyScalar(I),a.hemi[A]=t,A++}}O>0&&(n.isWebGL2||!0===t.has("OES_texture_float_linear")?(a.rectAreaLTC1=Qi.LTC_FLOAT_1,a.rectAreaLTC2=Qi.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(a.rectAreaLTC1=Qi.LTC_HALF_1,a.rectAreaLTC2=Qi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=m,a.ambient[1]=g,a.ambient[2]=_;const N=a.hash;N.directionalLength===S&&N.pointLength===M&&N.spotLength===T&&N.rectAreaLength===O&&N.hemiLength===A&&N.numDirectionalShadows===P&&N.numPointShadows===L&&N.numSpotShadows===R||(a.directional.length=S,a.spot.length=T,a.rectArea.length=O,a.point.length=M,a.hemi.length=A,a.directionalShadow.length=P,a.directionalShadowMap.length=P,a.pointShadow.length=L,a.pointShadowMap.length=L,a.spotShadow.length=R,a.spotShadowMap.length=R,a.directionalShadowMatrix.length=P,a.pointShadowMatrix.length=L,a.spotShadowMatrix.length=R,N.directionalLength=S,N.pointLength=M,N.spotLength=T,N.rectAreaLength=O,N.hemiLength=A,N.numDirectionalShadows=P,N.numPointShadows=L,N.numSpotShadows=R,a.version=ho++)},setupView:function setupView(t,n){let i=0,o=0,_=0,S=0,M=0;const T=n.matrixWorldInverse;for(let n=0,O=t.length;n<O;n++){const O=t[n];if(O.isDirectionalLight){const t=a.directional[i];t.direction.setFromMatrixPosition(O.matrixWorld),s.setFromMatrixPosition(O.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(T),i++}else if(O.isSpotLight){const t=a.spot[_];t.position.setFromMatrixPosition(O.matrixWorld),t.position.applyMatrix4(T),t.direction.setFromMatrixPosition(O.matrixWorld),s.setFromMatrixPosition(O.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(T),_++}else if(O.isRectAreaLight){const t=a.rectArea[S];t.position.setFromMatrixPosition(O.matrixWorld),t.position.applyMatrix4(T),g.identity(),m.copy(O.matrixWorld),m.premultiply(T),g.extractRotation(m),t.halfWidth.set(.5*O.width,0,0),t.halfHeight.set(0,.5*O.height,0),t.halfWidth.applyMatrix4(g),t.halfHeight.applyMatrix4(g),S++}else if(O.isPointLight){const t=a.point[o];t.position.setFromMatrixPosition(O.matrixWorld),t.position.applyMatrix4(T),o++}else if(O.isHemisphereLight){const t=a.hemi[M];t.direction.setFromMatrixPosition(O.matrixWorld),t.direction.transformDirection(T),t.direction.normalize(),M++}}},state:a}}function WebGLRenderState(t,n){const i=new WebGLLights(t,n),o=[],a=[];return{init:function init(){o.length=0,a.length=0},state:{lightsArray:o,shadowsArray:a,lights:i},setupLights:function setupLights(){i.setup(o)},setupLightsView:function setupLightsView(t){i.setupView(o,t)},pushLight:function pushLight(t){o.push(t)},pushShadow:function pushShadow(t){a.push(t)}}}function WebGLRenderStates(t,n){let i=new WeakMap;return{get:function get(o,a=0){let s;return!1===i.has(o)?(s=new WebGLRenderState(t,n),i.set(o,[]),i.get(o).push(s)):a>=i.get(o).length?(s=new WebGLRenderState(t,n),i.get(o).push(s)):s=i.get(o)[a],s},dispose:function dispose(){i=new WeakMap}}}function MeshDepthMaterial(t){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=Cn,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function MeshDistanceMaterial(t){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}function WebGLShadowMap(t,n,i){let o=new Frustum;const a=new Vector2,s=new Vector2,m=new Vector4,g=[],_=[],S={},M={0:L,1:P,2:R},O=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),N=O.clone();N.defines.HORIZONTAL_PASS=1;const I=new BufferGeometry;I.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const V=new Mesh(I,O),U=this;function VSMPass(i,o){const a=n.update(V);O.uniforms.shadow_pass.value=i.map.texture,O.uniforms.resolution.value=i.mapSize,O.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(o,null,a,O,V,null),N.uniforms.shadow_pass.value=i.mapPass.texture,N.uniforms.resolution.value=i.mapSize,N.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(o,null,a,N,V,null)}function getDepthMaterialVariant(t,n,i){const o=t<<0|n<<1|i<<2;let a=g[o];return void 0===a&&(a=new MeshDepthMaterial({depthPacking:On,morphTargets:t,skinning:n}),g[o]=a),a}function getDistanceMaterialVariant(t,n,i){const o=t<<0|n<<1|i<<2;let a=_[o];return void 0===a&&(a=new MeshDistanceMaterial({morphTargets:t,skinning:n}),_[o]=a),a}function getDepthMaterial(n,i,o,a,s,m,g){let _=null,T=getDepthMaterialVariant,O=n.customDepthMaterial;if(!0===a.isPointLight&&(T=getDistanceMaterialVariant,O=n.customDistanceMaterial),void 0===O){let t=!1;!0===o.morphTargets&&(t=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0);let a=!1;!0===n.isSkinnedMesh&&(!0===o.skinning?a=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",n)),_=T(t,a,!0===n.isInstancedMesh)}else _=O;if(t.localClippingEnabled&&!0===o.clipShadows&&0!==o.clippingPlanes.length){const t=_.uuid,n=o.uuid;let i=S[t];void 0===i&&(i={},S[t]=i);let a=i[n];void 0===a&&(a=_.clone(),i[n]=a),_=a}return _.visible=o.visible,_.wireframe=o.wireframe,_.side=g===A?null!==o.shadowSide?o.shadowSide:o.side:null!==o.shadowSide?o.shadowSide:M[o.side],_.clipShadows=o.clipShadows,_.clippingPlanes=o.clippingPlanes,_.clipIntersection=o.clipIntersection,_.wireframeLinewidth=o.wireframeLinewidth,_.linewidth=o.linewidth,!0===a.isPointLight&&!0===_.isMeshDistanceMaterial&&(_.referencePosition.setFromMatrixPosition(a.matrixWorld),_.nearDistance=s,_.farDistance=m),_}function renderObject(i,a,s,m,g){if(!1===i.visible)return;if(i.layers.test(a.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&g===A)&&(!i.frustumCulled||o.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const o=n.update(i),a=i.material;if(Array.isArray(a)){const n=o.groups;for(let _=0,S=n.length;_<S;_++){const S=n[_],M=a[S.materialIndex];if(M&&M.visible){const n=getDepthMaterial(i,o,M,m,s.near,s.far,g);t.renderBufferDirect(s,null,o,n,i,S)}}}else if(a.visible){const n=getDepthMaterial(i,o,a,m,s.near,s.far,g);t.renderBufferDirect(s,null,o,n,i,null)}}const _=i.children;for(let t=0,n=_.length;t<n;t++)renderObject(_[t],a,s,m,g)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=T,this.render=function(n,g,_){if(!1===U.enabled)return;if(!1===U.autoUpdate&&!1===U.needsUpdate)return;if(0===n.length)return;const S=t.getRenderTarget(),M=t.getActiveCubeFace(),T=t.getActiveMipmapLevel(),O=t.state;O.setBlending(j),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);for(let S=0,M=n.length;S<M;S++){const M=n[S],T=M.shadow;if(void 0===T){console.warn("THREE.WebGLShadowMap:",M,"has no shadow.");continue}if(!1===T.autoUpdate&&!1===T.needsUpdate)continue;a.copy(T.mapSize);const P=T.getFrameExtents();if(a.multiply(P),s.copy(T.mapSize),(a.x>i||a.y>i)&&(a.x>i&&(s.x=Math.floor(i/P.x),a.x=s.x*P.x,T.mapSize.x=s.x),a.y>i&&(s.y=Math.floor(i/P.y),a.y=s.y*P.y,T.mapSize.y=s.y)),null===T.map&&!T.isPointLightShadow&&this.type===A){const t={minFilter:Ve,magFilter:Ve,format:ot};T.map=new WebGLRenderTarget(a.x,a.y,t),T.map.texture.name=M.name+".shadowMap",T.mapPass=new WebGLRenderTarget(a.x,a.y,t),T.camera.updateProjectionMatrix()}if(null===T.map){const t={minFilter:ke,magFilter:ke,format:ot};T.map=new WebGLRenderTarget(a.x,a.y,t),T.map.texture.name=M.name+".shadowMap",T.camera.updateProjectionMatrix()}t.setRenderTarget(T.map),t.clear();const L=T.getViewportCount();for(let t=0;t<L;t++){const n=T.getViewport(t);m.set(s.x*n.x,s.y*n.y,s.x*n.z,s.y*n.w),O.viewport(m),T.updateMatrices(M,t),o=T.getFrustum(),renderObject(g,_,T.camera,M,this.type)}T.isPointLightShadow||this.type!==A||VSMPass(T,_),T.needsUpdate=!1}U.needsUpdate=!1,t.setRenderTarget(S,M,T)}}function WebGLState(t,n,i){const o=i.isWebGL2,a=new function ColorBuffer(){let n=!1;const i=new Vector4;let o=null;const a=new Vector4(0,0,0,0);return{setMask:function(i){o===i||n||(t.colorMask(i,i,i,i),o=i)},setLocked:function(t){n=t},setClear:function(n,o,s,m,g){!0===g&&(n*=m,o*=m,s*=m),i.set(n,o,s,m),!1===a.equals(i)&&(t.clearColor(n,o,s,m),a.copy(i))},reset:function(){n=!1,o=null,a.set(-1,0,0,0)}}},s=new function DepthBuffer(){let n=!1,i=null,o=null,a=null;return{setTest:function(t){t?enable(2929):disable(2929)},setMask:function(o){i===o||n||(t.depthMask(o),i=o)},setFunc:function(n){if(o!==n){if(n)switch(n){case ce:t.depthFunc(512);break;case ue:t.depthFunc(519);break;case le:t.depthFunc(513);break;case he:t.depthFunc(515);break;case de:t.depthFunc(514);break;case pe:t.depthFunc(518);break;case fe:t.depthFunc(516);break;case me:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);o=n}},setLocked:function(t){n=t},setClear:function(n){a!==n&&(t.clearDepth(n),a=n)},reset:function(){n=!1,i=null,o=null,a=null}}},S=new function StencilBuffer(){let n=!1,i=null,o=null,a=null,s=null,m=null,g=null,_=null,S=null;return{setTest:function(t){n||(t?enable(2960):disable(2960))},setMask:function(o){i===o||n||(t.stencilMask(o),i=o)},setFunc:function(n,i,m){o===n&&a===i&&s===m||(t.stencilFunc(n,i,m),o=n,a=i,s=m)},setOp:function(n,i,o){m===n&&g===i&&_===o||(t.stencilOp(n,i,o),m=n,g=i,_=o)},setLocked:function(t){n=t},setClear:function(n){S!==n&&(t.clearStencil(n),S=n)},reset:function(){n=!1,i=null,o=null,a=null,s=null,m=null,g=null,_=null,S=null}}};let M={},T=null,O=null,A=null,P=null,N=null,I=null,ge=null,ye=null,ve=null,be=!1,_e=null,we=null,xe=null,Se=null,Me=null;const Ee=t.getParameter(35661);let Te=!1,Ce=0;const Oe=t.getParameter(7938);-1!==Oe.indexOf("WebGL")?(Ce=parseFloat(/^WebGL (\d)/.exec(Oe)[1]),Te=Ce>=1):-1!==Oe.indexOf("OpenGL ES")&&(Ce=parseFloat(/^OpenGL ES (\d)/.exec(Oe)[1]),Te=Ce>=2);let Ae=null,Pe={};const Le=new Vector4,Re=new Vector4;function createTexture(n,i,o){const a=new Uint8Array(4),s=t.createTexture();t.bindTexture(n,s),t.texParameteri(n,10241,9728),t.texParameteri(n,10240,9728);for(let n=0;n<o;n++)t.texImage2D(i+n,0,6408,1,1,0,6408,5121,a);return s}const Ne={};function enable(n){!0!==M[n]&&(t.enable(n),M[n]=!0)}function disable(n){!1!==M[n]&&(t.disable(n),M[n]=!1)}Ne[3553]=createTexture(3553,3553,1),Ne[34067]=createTexture(34067,34069,6),a.setClear(0,0,0,1),s.setClear(1),S.setClear(0),enable(2929),s.setFunc(he),setFlipSided(!1),setCullFace(g),enable(2884),setBlending(j);const Ie={[q]:32774,[Z]:32778,[X]:32779};if(o)Ie[Q]=32775,Ie[Y]=32776;else{const t=n.get("EXT_blend_minmax");null!==t&&(Ie[Q]=t.MIN_EXT,Ie[Y]=t.MAX_EXT)}const ke={[J]:0,[K]:1,[$]:768,[te]:770,[se]:776,[oe]:774,[re]:772,[ee]:769,[ne]:771,[ae]:775,[ie]:773};function setBlending(n,i,o,a,s,m,g,_){if(n!==j){if(O||(enable(3042),O=!0),n===H)s=s||i,m=m||o,g=g||a,i===P&&s===ge||(t.blendEquationSeparate(Ie[i],Ie[s]),P=i,ge=s),o===N&&a===I&&m===ye&&g===ve||(t.blendFuncSeparate(ke[o],ke[a],ke[m],ke[g]),N=o,I=a,ye=m,ve=g),A=n,be=null;else if(n!==A||_!==be){if(P===q&&ge===q||(t.blendEquation(32774),P=q,ge=q),_)switch(n){case V:t.blendFuncSeparate(1,771,1,771);break;case U:t.blendFunc(1,1);break;case G:t.blendFuncSeparate(0,0,769,771);break;case z:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",n)}else switch(n){case V:t.blendFuncSeparate(770,771,1,771);break;case U:t.blendFunc(770,1);break;case G:t.blendFunc(0,769);break;case z:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",n)}N=null,I=null,ye=null,ve=null,A=n,be=_}}else O&&(disable(3042),O=!1)}function setFlipSided(n){_e!==n&&(n?t.frontFace(2304):t.frontFace(2305),_e=n)}function setCullFace(n){n!==m?(enable(2884),n!==we&&(n===g?t.cullFace(1029):n===_?t.cullFace(1028):t.cullFace(1032))):disable(2884),we=n}function setPolygonOffset(n,i,o){n?(enable(32823),Se===i&&Me===o||(t.polygonOffset(i,o),Se=i,Me=o)):disable(32823)}function activeTexture(n){void 0===n&&(n=33984+Ee-1),Ae!==n&&(t.activeTexture(n),Ae=n)}return{buffers:{color:a,depth:s,stencil:S},enable,disable,useProgram:function useProgram(n){return T!==n&&(t.useProgram(n),T=n,!0)},setBlending,setMaterial:function setMaterial(t,n){t.side===R?disable(2884):enable(2884);let i=t.side===L;n&&(i=!i),setFlipSided(i),t.blending===V&&!1===t.transparent?setBlending(j):setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),a.setMask(t.colorWrite);const o=t.stencilWrite;S.setTest(o),o&&(S.setMask(t.stencilWriteMask),S.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),S.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided,setCullFace,setLineWidth:function setLineWidth(n){n!==xe&&(Te&&t.lineWidth(n),xe=n)},setPolygonOffset,setScissorTest:function setScissorTest(t){t?enable(3089):disable(3089)},activeTexture,bindTexture:function bindTexture(n,i){null===Ae&&activeTexture();let o=Pe[Ae];void 0===o&&(o={type:void 0,texture:void 0},Pe[Ae]=o),o.type===n&&o.texture===i||(t.bindTexture(n,i||Ne[n]),o.type=n,o.texture=i)},unbindTexture:function unbindTexture(){const n=Pe[Ae];void 0!==n&&void 0!==n.type&&(t.bindTexture(n.type,null),n.type=void 0,n.texture=void 0)},compressedTexImage2D:function compressedTexImage2D(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function texImage2D(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function texImage3D(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function scissor(scissor){!1===Le.equals(scissor)&&(t.scissor(scissor.x,scissor.y,scissor.z,scissor.w),Le.copy(scissor))},viewport:function viewport(viewport){!1===Re.equals(viewport)&&(t.viewport(viewport.x,viewport.y,viewport.z,viewport.w),Re.copy(viewport))},reset:function reset(){M={},Ae=null,Pe={},T=null,O=null,A=null,P=null,N=null,I=null,ge=null,ye=null,ve=null,be=!1,_e=null,we=null,xe=null,Se=null,Me=null,a.reset(),s.reset(),S.reset()}}}function WebGLTextures(t,n,i,o,a,s,m){const g=a.isWebGL2,_=a.maxTextures,S=a.maxCubemapSize,M=a.maxTextureSize,T=a.maxSamples,O=new WeakMap;let A,P=!1;try{P="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function createCanvas(t,n){return P?new OffscreenCanvas(t,n):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function resizeImage(t,n,i,o){let a=1;if((t.width>o||t.height>o)&&(a=o/Math.max(t.width,t.height)),a<1||!0===n){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const o=n?ar.floorPowerOfTwo:Math.floor,s=o(a*t.width),m=o(a*t.height);void 0===A&&(A=createCanvas(s,m));const g=i?createCanvas(s,m):A;return g.width=s,g.height=m,g.getContext("2d").drawImage(t,0,0,s,m),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+m+")."),g}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function isPowerOfTwo(t){return ar.isPowerOfTwo(t.width)&&ar.isPowerOfTwo(t.height)}function textureNeedsGenerateMipmaps(t,n){return t.generateMipmaps&&n&&t.minFilter!==ke&&t.minFilter!==Ve}function generateMipmap(n,i,a,s){t.generateMipmap(n),o.get(i).__maxMipLevel=Math.log(Math.max(a,s))*Math.LOG2E}function getInternalFormat(i,o,a){if(!1===g)return o;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let s=o;return 6403===o&&(5126===a&&(s=33326),5131===a&&(s=33325),5121===a&&(s=33321)),6407===o&&(5126===a&&(s=34837),5131===a&&(s=34843),5121===a&&(s=32849)),6408===o&&(5126===a&&(s=34836),5131===a&&(s=34842),5121===a&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||n.get("EXT_color_buffer_float"),s}function filterFallback(t){return t===ke||t===je||t===De?9728:9729}function onTextureDispose(n){const i=n.target;i.removeEventListener("dispose",onTextureDispose),function deallocateTexture(n){const i=o.get(n);void 0!==i.__webglInit&&(t.deleteTexture(i.__webglTexture),o.remove(n))}(i),i.isVideoTexture&&O.delete(i),m.memory.textures--}function onRenderTargetDispose(n){const i=n.target;i.removeEventListener("dispose",onRenderTargetDispose),function deallocateRenderTarget(n){const i=o.get(n),a=o.get(n.texture);if(n){if(void 0!==a.__webglTexture&&t.deleteTexture(a.__webglTexture),n.depthTexture&&n.depthTexture.dispose(),n.isWebGLCubeRenderTarget)for(let n=0;n<6;n++)t.deleteFramebuffer(i.__webglFramebuffer[n]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[n]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);o.remove(n.texture),o.remove(n)}}(i),m.memory.textures--}let L=0;function setTexture2D(t,n){const a=o.get(t);if(t.isVideoTexture&&function updateVideoTexture(t){const n=m.render.frame;O.get(t)!==n&&(O.set(t,n),t.update())}(t),t.version>0&&a.__version!==t.version){const i=t.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void uploadTexture(a,t,n);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+n),i.bindTexture(3553,a.__webglTexture)}function setTextureCube(n,a){const m=o.get(n);n.version>0&&m.__version!==n.version?function uploadCubeTexture(n,o,a){if(6!==o.image.length)return;initTexture(n,o),i.activeTexture(33984+a),i.bindTexture(34067,n.__webglTexture),t.pixelStorei(37440,o.flipY);const m=o&&(o.isCompressedTexture||o.image[0].isCompressedTexture),_=o.image[0]&&o.image[0].isDataTexture,M=[];for(let t=0;t<6;t++)M[t]=m||_?_?o.image[t].image:o.image[t]:resizeImage(o.image[t],!1,!0,S);const T=M[0],O=isPowerOfTwo(T)||g,A=s.convert(o.format),P=s.convert(o.type),L=getInternalFormat(o.internalFormat,A,P);let R;if(setTextureParameters(34067,o,O),m){for(let t=0;t<6;t++){R=M[t].mipmaps;for(let n=0;n<R.length;n++){const a=R[n];o.format!==ot&&o.format!==it?null!==A?i.compressedTexImage2D(34069+t,n,L,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+t,n,L,a.width,a.height,0,A,P,a.data)}}n.__maxMipLevel=R.length-1}else{R=o.mipmaps;for(let t=0;t<6;t++)if(_){i.texImage2D(34069+t,0,L,M[t].width,M[t].height,0,A,P,M[t].data);for(let n=0;n<R.length;n++){const o=R[n].image[t].image;i.texImage2D(34069+t,n+1,L,o.width,o.height,0,A,P,o.data)}}else{i.texImage2D(34069+t,0,L,A,P,M[t]);for(let n=0;n<R.length;n++){const o=R[n];i.texImage2D(34069+t,n+1,L,A,P,o.image[t])}}n.__maxMipLevel=R.length}textureNeedsGenerateMipmaps(o,O)&&generateMipmap(34067,o,T.width,T.height),n.__version=o.version,o.onUpdate&&o.onUpdate(o)}(m,n,a):(i.activeTexture(33984+a),i.bindTexture(34067,m.__webglTexture))}const R={[Re]:10497,[Ne]:33071,[Ie]:33648},N={[ke]:9728,[je]:9984,[De]:9986,[Ve]:9729,[Ue]:9985,[ze]:9987};function setTextureParameters(i,s,m){m?(t.texParameteri(i,10242,R[s.wrapS]),t.texParameteri(i,10243,R[s.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,R[s.wrapR]),t.texParameteri(i,10240,N[s.magFilter]),t.texParameteri(i,10241,N[s.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),s.wrapS===Ne&&s.wrapT===Ne||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,filterFallback(s.magFilter)),t.texParameteri(i,10241,filterFallback(s.minFilter)),s.minFilter!==ke&&s.minFilter!==Ve&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const _=n.get("EXT_texture_filter_anisotropic");if(_){if(s.type===Je&&null===n.get("OES_texture_float_linear"))return;if(s.type===Ke&&null===(g||n.get("OES_texture_half_float_linear")))return;(s.anisotropy>1||o.get(s).__currentAnisotropy)&&(t.texParameterf(i,_.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,a.getMaxAnisotropy())),o.get(s).__currentAnisotropy=s.anisotropy)}}function initTexture(n,i){void 0===n.__webglInit&&(n.__webglInit=!0,i.addEventListener("dispose",onTextureDispose),n.__webglTexture=t.createTexture(),m.memory.textures++)}function uploadTexture(n,o,a){let m=3553;o.isDataTexture2DArray&&(m=35866),o.isDataTexture3D&&(m=32879),initTexture(n,o),i.activeTexture(33984+a),i.bindTexture(m,n.__webglTexture),t.pixelStorei(37440,o.flipY),t.pixelStorei(37441,o.premultiplyAlpha),t.pixelStorei(3317,o.unpackAlignment);const _=function textureNeedsPowerOfTwo(t){return!g&&(t.wrapS!==Ne||t.wrapT!==Ne||t.minFilter!==ke&&t.minFilter!==Ve)}(o)&&!1===isPowerOfTwo(o.image),S=resizeImage(o.image,_,!1,M),T=isPowerOfTwo(S)||g,O=s.convert(o.format);let A,P=s.convert(o.type),L=getInternalFormat(o.internalFormat,O,P);setTextureParameters(m,o,T);const R=o.mipmaps;if(o.isDepthTexture)L=6402,g?L=o.type===Je?36012:o.type===Ye?33190:o.type===nt?35056:33189:o.type===Je&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),o.format===ut&&6402===L&&o.type!==Xe&&o.type!==Ye&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),o.type=Xe,P=s.convert(o.type)),o.format===lt&&6402===L&&(L=34041,o.type!==nt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),o.type=nt,P=s.convert(o.type))),i.texImage2D(3553,0,L,S.width,S.height,0,O,P,null);else if(o.isDataTexture)if(R.length>0&&T){for(let t=0,n=R.length;t<n;t++)A=R[t],i.texImage2D(3553,t,L,A.width,A.height,0,O,P,A.data);o.generateMipmaps=!1,n.__maxMipLevel=R.length-1}else i.texImage2D(3553,0,L,S.width,S.height,0,O,P,S.data),n.__maxMipLevel=0;else if(o.isCompressedTexture){for(let t=0,n=R.length;t<n;t++)A=R[t],o.format!==ot&&o.format!==it?null!==O?i.compressedTexImage2D(3553,t,L,A.width,A.height,0,A.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,t,L,A.width,A.height,0,O,P,A.data);n.__maxMipLevel=R.length-1}else if(o.isDataTexture2DArray)i.texImage3D(35866,0,L,S.width,S.height,S.depth,0,O,P,S.data),n.__maxMipLevel=0;else if(o.isDataTexture3D)i.texImage3D(32879,0,L,S.width,S.height,S.depth,0,O,P,S.data),n.__maxMipLevel=0;else if(R.length>0&&T){for(let t=0,n=R.length;t<n;t++)A=R[t],i.texImage2D(3553,t,L,O,P,A);o.generateMipmaps=!1,n.__maxMipLevel=R.length-1}else i.texImage2D(3553,0,L,O,P,S),n.__maxMipLevel=0;textureNeedsGenerateMipmaps(o,T)&&generateMipmap(m,o,S.width,S.height),n.__version=o.version,o.onUpdate&&o.onUpdate(o)}function setupFrameBufferTexture(n,a,m,g){const _=s.convert(a.texture.format),S=s.convert(a.texture.type),M=getInternalFormat(a.texture.internalFormat,_,S);i.texImage2D(g,0,M,a.width,a.height,0,_,S,null),t.bindFramebuffer(36160,n),t.framebufferTexture2D(36160,m,g,o.get(a.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function setupRenderBufferStorage(n,i,o){if(t.bindRenderbuffer(36161,n),i.depthBuffer&&!i.stencilBuffer){let a=33189;if(o){const n=i.depthTexture;n&&n.isDepthTexture&&(n.type===Je?a=36012:n.type===Ye&&(a=33190));const o=getRenderTargetSamples(i);t.renderbufferStorageMultisample(36161,o,a,i.width,i.height)}else t.renderbufferStorage(36161,a,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,n)}else if(i.depthBuffer&&i.stencilBuffer){if(o){const n=getRenderTargetSamples(i);t.renderbufferStorageMultisample(36161,n,35056,i.width,i.height)}else t.renderbufferStorage(36161,34041,i.width,i.height);t.framebufferRenderbuffer(36160,33306,36161,n)}else{const n=s.convert(i.texture.format),a=s.convert(i.texture.type),m=getInternalFormat(i.texture.internalFormat,n,a);if(o){const n=getRenderTargetSamples(i);t.renderbufferStorageMultisample(36161,n,m,i.width,i.height)}else t.renderbufferStorage(36161,m,i.width,i.height)}t.bindRenderbuffer(36161,null)}function getRenderTargetSamples(t){return g&&t.isWebGLMultisampleRenderTarget?Math.min(T,t.samples):0}let I=!1,j=!1;this.allocateTextureUnit=function allocateTextureUnit(){const t=L;return t>=_&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+_),L+=1,t},this.resetTextureUnits=function resetTextureUnits(){L=0},this.setTexture2D=setTexture2D,this.setTexture2DArray=function setTexture2DArray(t,n){const a=o.get(t);t.version>0&&a.__version!==t.version?uploadTexture(a,t,n):(i.activeTexture(33984+n),i.bindTexture(35866,a.__webglTexture))},this.setTexture3D=function setTexture3D(t,n){const a=o.get(t);t.version>0&&a.__version!==t.version?uploadTexture(a,t,n):(i.activeTexture(33984+n),i.bindTexture(32879,a.__webglTexture))},this.setTextureCube=setTextureCube,this.setupRenderTarget=function setupRenderTarget(n){const a=o.get(n),_=o.get(n.texture);n.addEventListener("dispose",onRenderTargetDispose),_.__webglTexture=t.createTexture(),m.memory.textures++;const S=!0===n.isWebGLCubeRenderTarget,M=!0===n.isWebGLMultisampleRenderTarget,T=isPowerOfTwo(n)||g;if(!g||n.texture.format!==it||n.texture.type!==Je&&n.texture.type!==Ke||(n.texture.format=ot,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),S){a.__webglFramebuffer=[];for(let n=0;n<6;n++)a.__webglFramebuffer[n]=t.createFramebuffer()}else if(a.__webglFramebuffer=t.createFramebuffer(),M)if(g){a.__webglMultisampledFramebuffer=t.createFramebuffer(),a.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,a.__webglColorRenderbuffer);const i=s.convert(n.texture.format),o=s.convert(n.texture.type),m=getInternalFormat(n.texture.internalFormat,i,o),g=getRenderTargetSamples(n);t.renderbufferStorageMultisample(36161,g,m,n.width,n.height),t.bindFramebuffer(36160,a.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,a.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),n.depthBuffer&&(a.__webglDepthRenderbuffer=t.createRenderbuffer(),setupRenderBufferStorage(a.__webglDepthRenderbuffer,n,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(S){i.bindTexture(34067,_.__webglTexture),setTextureParameters(34067,n.texture,T);for(let t=0;t<6;t++)setupFrameBufferTexture(a.__webglFramebuffer[t],n,36064,34069+t);textureNeedsGenerateMipmaps(n.texture,T)&&generateMipmap(34067,n.texture,n.width,n.height),i.bindTexture(34067,null)}else i.bindTexture(3553,_.__webglTexture),setTextureParameters(3553,n.texture,T),setupFrameBufferTexture(a.__webglFramebuffer,n,36064,3553),textureNeedsGenerateMipmaps(n.texture,T)&&generateMipmap(3553,n.texture,n.width,n.height),i.bindTexture(3553,null);n.depthBuffer&&function setupDepthRenderbuffer(n){const i=o.get(n),a=!0===n.isWebGLCubeRenderTarget;if(n.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function setupDepthTexture(n,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,n),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");o.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),setTexture2D(i.depthTexture,0);const a=o.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===ut)t.framebufferTexture2D(36160,36096,3553,a,0);else{if(i.depthTexture.format!==lt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,a,0)}}(i.__webglFramebuffer,n)}else if(a){i.__webglDepthbuffer=[];for(let o=0;o<6;o++)t.bindFramebuffer(36160,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=t.createRenderbuffer(),setupRenderBufferStorage(i.__webglDepthbuffer[o],n,!1)}else t.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),setupRenderBufferStorage(i.__webglDepthbuffer,n,!1);t.bindFramebuffer(36160,null)}(n)},this.updateRenderTargetMipmap=function updateRenderTargetMipmap(t){const n=t.texture;if(textureNeedsGenerateMipmaps(n,isPowerOfTwo(t)||g)){const a=t.isWebGLCubeRenderTarget?34067:3553,s=o.get(n).__webglTexture;i.bindTexture(a,s),generateMipmap(a,n,t.width,t.height),i.bindTexture(a,null)}},this.updateMultisampleRenderTarget=function updateMultisampleRenderTarget(n){if(n.isWebGLMultisampleRenderTarget)if(g){const i=o.get(n);t.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,i.__webglFramebuffer);const a=n.width,s=n.height;let m=16384;n.depthBuffer&&(m|=256),n.stencilBuffer&&(m|=1024),t.blitFramebuffer(0,0,a,s,0,0,a,s,m,9728),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function safeSetTexture2D(t,n){t&&t.isWebGLRenderTarget&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),I=!0),t=t.texture),setTexture2D(t,n)},this.safeSetTextureCube=function safeSetTextureCube(t,n){t&&t.isWebGLCubeRenderTarget&&(!1===j&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),j=!0),t=t.texture),setTextureCube(t,n)}}function WebGLUtils(t,n,i){const o=i.isWebGL2;return{convert:function convert(t){let i;if(t===We)return 5121;if(t===$e)return 32819;if(t===et)return 32820;if(t===tt)return 33635;if(t===qe)return 5120;if(t===Ze)return 5122;if(t===Xe)return 5123;if(t===Qe)return 5124;if(t===Ye)return 5125;if(t===Je)return 5126;if(t===Ke)return o?5131:(i=n.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(t===rt)return 6406;if(t===it)return 6407;if(t===ot)return 6408;if(t===at)return 6409;if(t===st)return 6410;if(t===ut)return 6402;if(t===lt)return 34041;if(t===ht)return 6403;if(t===dt)return 36244;if(t===pt)return 33319;if(t===ft)return 33320;if(t===mt)return 36248;if(t===gt)return 36249;if(t===yt||t===vt||t===bt||t===_t){if(i=n.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(t===yt)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===vt)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===bt)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===_t)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===wt||t===xt||t===St||t===Mt){if(i=n.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(t===wt)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===xt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===St)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Mt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Et)return i=n.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===Tt||t===Ct)&&(i=n.get("WEBGL_compressed_texture_etc"),null!==i)){if(t===Tt)return i.COMPRESSED_RGB8_ETC2;if(t===Ct)return i.COMPRESSED_RGBA8_ETC2_EAC}return t===Ot||t===At||t===Pt||t===Lt||t===Rt||t===Nt||t===It||t===kt||t===jt||t===Ft||t===Dt||t===Bt||t===Vt||t===Ut||t===zt||t===Ht||t===Wt||t===qt||t===Zt||t===Xt||t===Qt||t===Yt||t===Jt||t===Kt||t===$t||t===en||t===tn||t===nn?(i=n.get("WEBGL_compressed_texture_astc"),null!==i?t:null):t===Gt?(i=n.get("EXT_texture_compression_bptc"),null!==i?t:null):t===nt?o?34042:(i=n.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function ArrayCamera(t=[]){PerspectiveCamera.call(this),this.cameras=t}function Group(){Object3D.call(this),this.type="Group"}function WebXRController(){this._targetRay=null,this._grip=null,this._hand=null}function WebXRManager(t,n){const i=this;let o=null,a=1,s=null,m="local-floor",g=null;const _=[],S=new Map,M=new PerspectiveCamera;M.layers.enable(1),M.viewport=new Vector4;const T=new PerspectiveCamera;T.layers.enable(2),T.viewport=new Vector4;const O=[M,T],A=new ArrayCamera;A.layers.enable(1),A.layers.enable(2);let P=null,L=null;function onSessionEvent(t){const n=S.get(t.inputSource);n&&n.dispatchEvent({type:t.type,data:t.inputSource})}function onSessionEnd(){S.forEach((function(t,n){t.disconnect(n)})),S.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),j.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function onRequestReferenceSpace(t){s=t,j.setContext(o),j.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}function updateInputSources(t){const n=o.inputSources;for(let t=0;t<_.length;t++)S.set(n[t],_[t]);for(let n=0;n<t.removed.length;n++){const i=t.removed[n],o=S.get(i);o&&(o.dispatchEvent({type:"disconnected",data:i}),S.delete(i))}for(let n=0;n<t.added.length;n++){const i=t.added[n],o=S.get(i);o&&o.dispatchEvent({type:"connected",data:i})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let n=_[t];return void 0===n&&(n=new WebXRController,_[t]=n),n.getTargetRaySpace()},this.getControllerGrip=function(t){let n=_[t];return void 0===n&&(n=new WebXRController,_[t]=n),n.getGripSpace()},this.getHand=function(t){let n=_[t];return void 0===n&&(n=new WebXRController,_[t]=n),n.getHandSpace()},this.setFramebufferScaleFactor=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){m=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getSession=function(){return o},this.setSession=function(t){if(o=t,null!==o){o.addEventListener("select",onSessionEvent),o.addEventListener("selectstart",onSessionEvent),o.addEventListener("selectend",onSessionEvent),o.addEventListener("squeeze",onSessionEvent),o.addEventListener("squeezestart",onSessionEvent),o.addEventListener("squeezeend",onSessionEvent),o.addEventListener("end",onSessionEnd);const t=n.getContextAttributes();!0!==t.xrCompatible&&n.makeXRCompatible();const i={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:a},s=new XRWebGLLayer(o,n,i);o.updateRenderState({baseLayer:s}),o.requestReferenceSpace(m).then(onRequestReferenceSpace),o.addEventListener("inputsourceschange",updateInputSources)}};const R=new Vector3,N=new Vector3;function updateCamera(t,n){null===n?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(n.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.getCamera=function(t){A.near=T.near=M.near=t.near,A.far=T.far=M.far=t.far,P===A.near&&L===A.far||(o.updateRenderState({depthNear:A.near,depthFar:A.far}),P=A.near,L=A.far);const n=t.parent,i=A.cameras;updateCamera(A,n);for(let t=0;t<i.length;t++)updateCamera(i[t],n);t.matrixWorld.copy(A.matrixWorld);const a=t.children;for(let t=0,n=a.length;t<n;t++)a[t].updateMatrixWorld(!0);return 2===i.length?function setProjectionFromUnion(t,n,i){R.setFromMatrixPosition(n.matrixWorld),N.setFromMatrixPosition(i.matrixWorld);const o=R.distanceTo(N),a=n.projectionMatrix.elements,s=i.projectionMatrix.elements,m=a[14]/(a[10]-1),g=a[14]/(a[10]+1),_=(a[9]+1)/a[5],S=(a[9]-1)/a[5],M=(a[8]-1)/a[0],T=(s[8]+1)/s[0],O=m*M,A=m*T,P=o/(-M+T),L=P*-M;n.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(L),t.translateZ(P),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const I=m+P,j=g+P,V=O-L,U=A+(o-L),G=_*g/j*I,z=S*g/j*I;t.projectionMatrix.makePerspective(V,U,G,z,I,j)}(A,M,T):A.projectionMatrix.copy(M.projectionMatrix),A};let I=null;const j=new WebGLAnimation;j.setAnimationLoop((function onAnimationFrame(n,i){if(g=i.getViewerPose(s),null!==g){const n=g.views,i=o.renderState.baseLayer;t.setFramebuffer(i.framebuffer);let a=!1;n.length!==A.cameras.length&&(A.cameras.length=0,a=!0);for(let t=0;t<n.length;t++){const o=n[t],s=i.getViewport(o),m=O[t];m.matrix.fromArray(o.transform.matrix),m.projectionMatrix.fromArray(o.projectionMatrix),m.viewport.set(s.x,s.y,s.width,s.height),0===t&&A.matrix.copy(m.matrix),!0===a&&A.cameras.push(m)}}const a=o.inputSources;for(let t=0;t<_.length;t++){const n=_[t],o=a[t];n.update(o,i,s)}I&&I(n,i)})),this.setAnimationLoop=function(t){I=t},this.dispose=function(){}}function WebGLMaterials(t){function refreshUniformsCommon(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.specularMap&&(n.specularMap.value=i.specularMap);const o=t.get(i).envMap;if(o){n.envMap.value=o,n.flipEnvMap.value=o.isCubeTexture&&o._needsFlipEnvMap?-1:1,n.reflectivity.value=i.reflectivity,n.refractionRatio.value=i.refractionRatio;const a=t.get(o).__maxMipLevel;void 0!==a&&(n.maxMipLevel.value=a)}let a,s;i.lightMap&&(n.lightMap.value=i.lightMap,n.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.roughnessMap?a=i.roughnessMap:i.metalnessMap?a=i.metalnessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap?a=i.emissiveMap:i.clearcoatMap?a=i.clearcoatMap:i.clearcoatNormalMap?a=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(a=i.clearcoatRoughnessMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uvTransform.value.copy(a.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),n.uv2Transform.value.copy(s.matrix))}function refreshUniformsStandard(n,i){n.roughness.value=i.roughness,n.metalness.value=i.metalness,i.roughnessMap&&(n.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(n.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,i.side===L&&(n.bumpScale.value*=-1)),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),i.side===L&&n.normalScale.value.negate()),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),t.get(i).envMap&&(n.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function refreshFogUniforms(t,n){t.fogColor.value.copy(n.color),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function refreshMaterialUniforms(t,n,i,o){n.isMeshBasicMaterial?refreshUniformsCommon(t,n):n.isMeshLambertMaterial?(refreshUniformsCommon(t,n),function refreshUniformsLambert(t,n){n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap)}(t,n)):n.isMeshToonMaterial?(refreshUniformsCommon(t,n),function refreshUniformsToon(t,n){n.gradientMap&&(t.gradientMap.value=n.gradientMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===L&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===L&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias)}(t,n)):n.isMeshPhongMaterial?(refreshUniformsCommon(t,n),function refreshUniformsPhong(t,n){t.specular.value.copy(n.specular),t.shininess.value=Math.max(n.shininess,1e-4),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===L&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===L&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias)}(t,n)):n.isMeshStandardMaterial?(refreshUniformsCommon(t,n),n.isMeshPhysicalMaterial?function refreshUniformsPhysical(t,n){refreshUniformsStandard(t,n),t.reflectivity.value=n.reflectivity,t.clearcoat.value=n.clearcoat,t.clearcoatRoughness.value=n.clearcoatRoughness,n.sheen&&t.sheen.value.copy(n.sheen),n.clearcoatMap&&(t.clearcoatMap.value=n.clearcoatMap),n.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=n.clearcoatRoughnessMap),n.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(n.clearcoatNormalScale),t.clearcoatNormalMap.value=n.clearcoatNormalMap,n.side===L&&t.clearcoatNormalScale.value.negate()),t.transmission.value=n.transmission,n.transmissionMap&&(t.transmissionMap.value=n.transmissionMap)}(t,n):refreshUniformsStandard(t,n)):n.isMeshMatcapMaterial?(refreshUniformsCommon(t,n),function refreshUniformsMatcap(t,n){n.matcap&&(t.matcap.value=n.matcap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===L&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===L&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias)}(t,n)):n.isMeshDepthMaterial?(refreshUniformsCommon(t,n),function refreshUniformsDepth(t,n){n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(refreshUniformsCommon(t,n),function refreshUniformsDistance(t,n){n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),t.referencePosition.value.copy(n.referencePosition),t.nearDistance.value=n.nearDistance,t.farDistance.value=n.farDistance}(t,n)):n.isMeshNormalMaterial?(refreshUniformsCommon(t,n),function refreshUniformsNormal(t,n){n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===L&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===L&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias)}(t,n)):n.isLineBasicMaterial?(function refreshUniformsLine(t,n){t.diffuse.value.copy(n.color),t.opacity.value=n.opacity}(t,n),n.isLineDashedMaterial&&function refreshUniformsDash(t,n){t.dashSize.value=n.dashSize,t.totalSize.value=n.dashSize+n.gapSize,t.scale.value=n.scale}(t,n)):n.isPointsMaterial?function refreshUniformsPoints(t,n,i,o){let a;t.diffuse.value.copy(n.color),t.opacity.value=n.opacity,t.size.value=n.size*i,t.scale.value=.5*o,n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.map?a=n.map:n.alphaMap&&(a=n.alphaMap),void 0!==a&&(!0===a.matrixAutoUpdate&&a.updateMatrix(),t.uvTransform.value.copy(a.matrix))}(t,n,i,o):n.isSpriteMaterial?function refreshUniformsSprites(t,n){let i;t.diffuse.value.copy(n.color),t.opacity.value=n.opacity,t.rotation.value=n.rotation,n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.map?i=n.map:n.alphaMap&&(i=n.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function WebGLRenderer(t){const n=void 0!==(t=t||{}).canvas?t.canvas:function createCanvasElement(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,o=void 0!==t.alpha&&t.alpha,a=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,m=void 0!==t.antialias&&t.antialias,g=void 0===t.premultipliedAlpha||t.premultipliedAlpha,_=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,S=void 0!==t.powerPreference?t.powerPreference:"default",M=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let T=null,O=null;const A=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=bn,this.physicallyCorrectLights=!1,this.toneMapping=be,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const P=this;let L=!1,R=null,N=0,I=0,j=null,V=null,U=-1,G=null;const z=new Vector4,H=new Vector4;let q=null,Z=n.width,X=n.height,Q=1,Y=null,J=null;const K=new Vector4(0,0,Z,X),$=new Vector4(0,0,Z,X);let ee=!1;const te=new Frustum;let ne=!1,re=!1;const ie=new Matrix4,oe=new Vector3,ae={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function getTargetPixelRatio(){return null===j?Q:1}let se,ce,ue,le,he,de,pe,fe,me,ge,ye,ve,_e,we,xe,Se,Me,Ee,Te,Ce,Oe,Ae=i;function getContext(t,i){for(let o=0;o<t.length;o++){const a=t[o],s=n.getContext(a,i);if(null!==s)return s}return null}try{const t={alpha:o,depth:a,stencil:s,antialias:m,premultipliedAlpha:g,preserveDrawingBuffer:_,powerPreference:S,failIfMajorPerformanceCaveat:M};if(n.addEventListener("webglcontextlost",onContextLost,!1),n.addEventListener("webglcontextrestored",onContextRestore,!1),null===Ae){const n=["webgl2","webgl","experimental-webgl"];if(!0===P.isWebGL1Renderer&&n.shift(),Ae=getContext(n,t),null===Ae)throw getContext(n)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Ae.getShaderPrecisionFormat&&(Ae.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function initGLContext(){se=new WebGLExtensions(Ae),ce=new WebGLCapabilities(Ae,se,t),!1===ce.isWebGL2&&(se.get("WEBGL_depth_texture"),se.get("OES_texture_float"),se.get("OES_texture_half_float"),se.get("OES_texture_half_float_linear"),se.get("OES_standard_derivatives"),se.get("OES_element_index_uint"),se.get("OES_vertex_array_object"),se.get("ANGLE_instanced_arrays")),se.get("OES_texture_float_linear"),Ce=new WebGLUtils(Ae,se,ce),ue=new WebGLState(Ae,se,ce),ue.scissor(H.copy($).multiplyScalar(Q).floor()),ue.viewport(z.copy(K).multiplyScalar(Q).floor()),le=new WebGLInfo(Ae),he=new WebGLProperties,de=new WebGLTextures(Ae,se,ue,he,ce,Ce,le),pe=new WebGLCubeMaps(P),fe=new WebGLAttributes(Ae,ce),Oe=new WebGLBindingStates(Ae,se,fe,ce),me=new WebGLGeometries(Ae,fe,le,Oe),ge=new WebGLObjects(Ae,me,fe,le),Me=new WebGLMorphtargets(Ae),xe=new WebGLClipping(he),ye=new WebGLPrograms(P,pe,se,ce,Oe,xe),ve=new WebGLMaterials(he),_e=new WebGLRenderLists(he),we=new WebGLRenderStates(se,ce),Se=new WebGLBackground(P,pe,ue,ge,g),Ee=new WebGLBufferRenderer(Ae,se,le,ce),Te=new WebGLIndexedBufferRenderer(Ae,se,le,ce),le.programs=ye.programs,P.capabilities=ce,P.extensions=se,P.properties=he,P.renderLists=_e,P.state=ue,P.info=le}initGLContext();const Pe=new WebXRManager(P,Ae);this.xr=Pe;const Le=new WebGLShadowMap(P,ge,ce.maxTextureSize);function onContextLost(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),L=!0}function onContextRestore(){console.log("THREE.WebGLRenderer: Context Restored."),L=!1,initGLContext()}function onMaterialDispose(t){const n=t.target;n.removeEventListener("dispose",onMaterialDispose),function deallocateMaterial(t){releaseMaterialProgramReference(t),he.remove(t)}(n)}function releaseMaterialProgramReference(t){const n=he.get(t).program;void 0!==n&&ye.releaseProgram(n)}this.shadowMap=Le,this.getContext=function(){return Ae},this.getContextAttributes=function(){return Ae.getContextAttributes()},this.forceContextLoss=function(){const t=se.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=se.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return Q},this.setPixelRatio=function(t){void 0!==t&&(Q=t,this.setSize(Z,X,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Vector2),t.set(Z,X)},this.setSize=function(t,i,o){Pe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Z=t,X=i,n.width=Math.floor(t*Q),n.height=Math.floor(i*Q),!1!==o&&(n.style.width=t+"px",n.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Vector2),t.set(Z*Q,X*Q).floor()},this.setDrawingBufferSize=function(t,i,o){Z=t,X=i,Q=o,n.width=Math.floor(t*o),n.height=Math.floor(i*o),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Vector4),t.copy(z)},this.getViewport=function(t){return t.copy(K)},this.setViewport=function(t,n,i,o){t.isVector4?K.set(t.x,t.y,t.z,t.w):K.set(t,n,i,o),ue.viewport(z.copy(K).multiplyScalar(Q).floor())},this.getScissor=function(t){return t.copy($)},this.setScissor=function(t,n,i,o){t.isVector4?$.set(t.x,t.y,t.z,t.w):$.set(t,n,i,o),ue.scissor(H.copy($).multiplyScalar(Q).floor())},this.getScissorTest=function(){return ee},this.setScissorTest=function(t){ue.setScissorTest(ee=t)},this.setOpaqueSort=function(t){Y=t},this.setTransparentSort=function(t){J=t},this.getClearColor=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),t=new Color),t.copy(Se.getClearColor())},this.setClearColor=function(){Se.setClearColor.apply(Se,arguments)},this.getClearAlpha=function(){return Se.getClearAlpha()},this.setClearAlpha=function(){Se.setClearAlpha.apply(Se,arguments)},this.clear=function(t,n,i){let o=0;(void 0===t||t)&&(o|=16384),(void 0===n||n)&&(o|=256),(void 0===i||i)&&(o|=1024),Ae.clear(o)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",onContextLost,!1),n.removeEventListener("webglcontextrestored",onContextRestore,!1),_e.dispose(),we.dispose(),he.dispose(),pe.dispose(),ge.dispose(),Oe.dispose(),Pe.dispose(),Ne.stop()},this.renderBufferImmediate=function(t,n){Oe.initAttributes();const i=he.get(t);t.hasPositions&&!i.position&&(i.position=Ae.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=Ae.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=Ae.createBuffer()),t.hasColors&&!i.color&&(i.color=Ae.createBuffer());const o=n.getAttributes();t.hasPositions&&(Ae.bindBuffer(34962,i.position),Ae.bufferData(34962,t.positionArray,35048),Oe.enableAttribute(o.position),Ae.vertexAttribPointer(o.position,3,5126,!1,0,0)),t.hasNormals&&(Ae.bindBuffer(34962,i.normal),Ae.bufferData(34962,t.normalArray,35048),Oe.enableAttribute(o.normal),Ae.vertexAttribPointer(o.normal,3,5126,!1,0,0)),t.hasUvs&&(Ae.bindBuffer(34962,i.uv),Ae.bufferData(34962,t.uvArray,35048),Oe.enableAttribute(o.uv),Ae.vertexAttribPointer(o.uv,2,5126,!1,0,0)),t.hasColors&&(Ae.bindBuffer(34962,i.color),Ae.bufferData(34962,t.colorArray,35048),Oe.enableAttribute(o.color),Ae.vertexAttribPointer(o.color,3,5126,!1,0,0)),Oe.disableUnusedAttributes(),Ae.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,n,i,o,a,s){null===n&&(n=ae);const m=a.isMesh&&a.matrixWorld.determinant()<0,g=setProgram(t,n,o,a);ue.setMaterial(o,m);let _=i.index;const S=i.attributes.position;if(null===_){if(void 0===S||0===S.count)return}else if(0===_.count)return;let M,T=1;!0===o.wireframe&&(_=me.getWireframeAttribute(i),T=2),(o.morphTargets||o.morphNormals)&&Me.update(a,i,o,g),Oe.setup(a,o,g,i,_);let O=Ee;null!==_&&(M=fe.get(_),O=Te,O.setIndex(M));const A=null!==_?_.count:S.count,P=i.drawRange.start*T,L=i.drawRange.count*T,R=null!==s?s.start*T:0,N=null!==s?s.count*T:1/0,I=Math.max(P,R),j=Math.min(A,P+L,R+N)-1,V=Math.max(0,j-I+1);if(0!==V){if(a.isMesh)!0===o.wireframe?(ue.setLineWidth(o.wireframeLinewidth*getTargetPixelRatio()),O.setMode(1)):O.setMode(4);else if(a.isLine){let t=o.linewidth;void 0===t&&(t=1),ue.setLineWidth(t*getTargetPixelRatio()),a.isLineSegments?O.setMode(1):a.isLineLoop?O.setMode(2):O.setMode(3)}else a.isPoints?O.setMode(0):a.isSprite&&O.setMode(4);if(a.isInstancedMesh)O.renderInstances(I,V,a.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);O.renderInstances(I,V,t)}else O.render(I,V)}},this.compile=function(t,n){O=we.get(t),O.init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(n.layers)&&(O.pushLight(t),t.castShadow&&O.pushShadow(t))})),O.setupLights();const i=new WeakMap;t.traverse((function(n){const o=n.material;if(o)if(Array.isArray(o))for(let a=0;a<o.length;a++){const s=o[a];!1===i.has(s)&&(initMaterial(s,t,n),i.set(s))}else!1===i.has(o)&&(initMaterial(o,t,n),i.set(o))}))};let Re=null;const Ne=new WebGLAnimation;function projectObject(t,n,i,o){if(!1===t.visible)return;if(t.layers.test(n.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(n);else if(t.isLight)O.pushLight(t),t.castShadow&&O.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||te.intersectsSprite(t)){o&&oe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ie);const n=ge.update(t),a=t.material;a.visible&&T.push(t,n,a,i,oe.z,null)}}else if(t.isImmediateRenderObject)o&&oe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ie),T.push(t,null,t.material,i,oe.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==le.render.frame&&(t.skeleton.update(),t.skeleton.frame=le.render.frame),!t.frustumCulled||te.intersectsObject(t))){o&&oe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ie);const n=ge.update(t),a=t.material;if(Array.isArray(a)){const o=n.groups;for(let s=0,m=o.length;s<m;s++){const m=o[s],g=a[m.materialIndex];g&&g.visible&&T.push(t,n,g,i,oe.z,m)}}else a.visible&&T.push(t,n,a,i,oe.z,null)}const a=t.children;for(let t=0,s=a.length;t<s;t++)projectObject(a[t],n,i,o)}function renderObjects(t,n,i){const o=!0===n.isScene?n.overrideMaterial:null;for(let a=0,s=t.length;a<s;a++){const s=t[a],m=s.object,g=s.geometry,_=null===o?s.material:o,S=s.group;if(i.isArrayCamera){const t=i.cameras;for(let i=0,o=t.length;i<o;i++){const o=t[i];m.layers.test(o.layers)&&(ue.viewport(z.copy(o.viewport)),O.setupLightsView(o),renderObject(m,n,o,g,_,S))}}else renderObject(m,n,i,g,_,S)}}function renderObject(t,n,i,o,a,s){if(t.onBeforeRender(P,n,i,o,a,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const o=setProgram(i,n,a,t);ue.setMaterial(a),Oe.reset(),function renderObjectImmediate(t,n){t.render((function(t){P.renderBufferImmediate(t,n)}))}(t,o)}else P.renderBufferDirect(i,n,o,a,t,s);t.onAfterRender(P,n,i,o,a,s)}function initMaterial(t,n,i){!0!==n.isScene&&(n=ae);const o=he.get(t),a=O.state.lights,s=O.state.shadowsArray,m=a.state.version,g=ye.getParameters(t,a.state,s,n,i),_=ye.getProgramCacheKey(g);let S=o.program,M=!0;if(void 0===S)t.addEventListener("dispose",onMaterialDispose);else if(S.cacheKey!==_)releaseMaterialProgramReference(t);else if(o.lightsStateVersion!==m)M=!1;else{if(void 0!==g.shaderID){const i=t.isMeshStandardMaterial?n.environment:null;return void(o.envMap=pe.get(t.envMap||i))}M=!1}M&&(g.uniforms=ye.getUniforms(t),t.onBeforeCompile(g,P),S=ye.acquireProgram(g,_),o.program=S,o.uniforms=g.uniforms,o.outputEncoding=g.outputEncoding);const T=o.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(o.numClippingPlanes=xe.numPlanes,o.numIntersection=xe.numIntersection,T.clippingPlanes=xe.uniform),o.environment=t.isMeshStandardMaterial?n.environment:null,o.fog=n.fog,o.envMap=pe.get(t.envMap||o.environment),o.needsLights=function materialNeedsLights(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),o.lightsStateVersion=m,o.needsLights&&(T.ambientLightColor.value=a.state.ambient,T.lightProbe.value=a.state.probe,T.directionalLights.value=a.state.directional,T.directionalLightShadows.value=a.state.directionalShadow,T.spotLights.value=a.state.spot,T.spotLightShadows.value=a.state.spotShadow,T.rectAreaLights.value=a.state.rectArea,T.ltc_1.value=a.state.rectAreaLTC1,T.ltc_2.value=a.state.rectAreaLTC2,T.pointLights.value=a.state.point,T.pointLightShadows.value=a.state.pointShadow,T.hemisphereLights.value=a.state.hemi,T.directionalShadowMap.value=a.state.directionalShadowMap,T.directionalShadowMatrix.value=a.state.directionalShadowMatrix,T.spotShadowMap.value=a.state.spotShadowMap,T.spotShadowMatrix.value=a.state.spotShadowMatrix,T.pointShadowMap.value=a.state.pointShadowMap,T.pointShadowMatrix.value=a.state.pointShadowMatrix);const A=o.program.getUniforms(),L=WebGLUniforms.seqWithValue(A.seq,T);o.uniformsList=L}function setProgram(t,n,i,o){!0!==n.isScene&&(n=ae),de.resetTextureUnits();const a=n.fog,s=i.isMeshStandardMaterial?n.environment:null,m=null===j?P.outputEncoding:j.texture.encoding,g=pe.get(i.envMap||s),_=he.get(i),S=O.state.lights;if(!0===ne&&(!0===re||t!==G)){const n=t===G&&i.id===U;xe.setState(i,t,n)}i.version===_.__version?i.fog&&_.fog!==a||_.environment!==s||_.needsLights&&_.lightsStateVersion!==S.state.version?initMaterial(i,n,o):void 0===_.numClippingPlanes||_.numClippingPlanes===xe.numPlanes&&_.numIntersection===xe.numIntersection?(_.outputEncoding!==m||_.envMap!==g)&&initMaterial(i,n,o):initMaterial(i,n,o):(initMaterial(i,n,o),_.__version=i.version);let M=!1,T=!1,A=!1;const L=_.program,R=L.getUniforms(),N=_.uniforms;if(ue.useProgram(L.program)&&(M=!0,T=!0,A=!0),i.id!==U&&(U=i.id,T=!0),M||G!==t){if(R.setValue(Ae,"projectionMatrix",t.projectionMatrix),ce.logarithmicDepthBuffer&&R.setValue(Ae,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),G!==t&&(G=t,T=!0,A=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const n=R.map.cameraPosition;void 0!==n&&n.setValue(Ae,oe.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&R.setValue(Ae,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&R.setValue(Ae,"viewMatrix",t.matrixWorldInverse)}if(i.skinning){R.setOptional(Ae,o,"bindMatrix"),R.setOptional(Ae,o,"bindMatrixInverse");const t=o.skeleton;if(t){const n=t.bones;if(ce.floatVertexTextures){if(null===t.boneTexture){let i=Math.sqrt(4*n.length);i=ar.ceilPowerOfTwo(i),i=Math.max(i,4);const o=new Float32Array(i*i*4);o.set(t.boneMatrices);const a=new DataTexture(o,i,i,ot,Je);t.boneMatrices=o,t.boneTexture=a,t.boneTextureSize=i}R.setValue(Ae,"boneTexture",t.boneTexture,de),R.setValue(Ae,"boneTextureSize",t.boneTextureSize)}else R.setOptional(Ae,t,"boneMatrices")}}return(T||_.receiveShadow!==o.receiveShadow)&&(_.receiveShadow=o.receiveShadow,R.setValue(Ae,"receiveShadow",o.receiveShadow)),T&&(R.setValue(Ae,"toneMappingExposure",P.toneMappingExposure),_.needsLights&&function markUniformsLightsNeedsUpdate(t,n){t.ambientLightColor.needsUpdate=n,t.lightProbe.needsUpdate=n,t.directionalLights.needsUpdate=n,t.directionalLightShadows.needsUpdate=n,t.pointLights.needsUpdate=n,t.pointLightShadows.needsUpdate=n,t.spotLights.needsUpdate=n,t.spotLightShadows.needsUpdate=n,t.rectAreaLights.needsUpdate=n,t.hemisphereLights.needsUpdate=n}(N,A),a&&i.fog&&ve.refreshFogUniforms(N,a),ve.refreshMaterialUniforms(N,i,Q,X),WebGLUniforms.upload(Ae,_.uniformsList,N,de)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(WebGLUniforms.upload(Ae,_.uniformsList,N,de),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&R.setValue(Ae,"center",o.center),R.setValue(Ae,"modelViewMatrix",o.modelViewMatrix),R.setValue(Ae,"normalMatrix",o.normalMatrix),R.setValue(Ae,"modelMatrix",o.matrixWorld),L}Ne.setAnimationLoop((function onAnimationFrame(t){Pe.isPresenting||Re&&Re(t)})),"undefined"!=typeof window&&Ne.setContext(window),this.setAnimationLoop=function(t){Re=t,Pe.setAnimationLoop(t),null===t?Ne.stop():Ne.start()},this.render=function(t,n){let i,o;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),o=arguments[3]),void 0!==n&&!0!==n.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===L)return;Oe.resetDefaultState(),U=-1,G=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),!0===Pe.enabled&&!0===Pe.isPresenting&&(n=Pe.getCamera(n)),!0===t.isScene&&t.onBeforeRender(P,t,n,i||j),O=we.get(t,A.length),O.init(),A.push(O),ie.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),te.setFromProjectionMatrix(ie),re=this.localClippingEnabled,ne=xe.init(this.clippingPlanes,re,n),T=_e.get(t,n),T.init(),projectObject(t,n,0,P.sortObjects),T.finish(),!0===P.sortObjects&&T.sort(Y,J),!0===ne&&xe.beginShadows();const a=O.state.shadowsArray;Le.render(a,t,n),O.setupLights(),O.setupLightsView(n),!0===ne&&xe.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),Se.render(T,t,n,o);const s=T.opaque,m=T.transparent;s.length>0&&renderObjects(s,t,n),m.length>0&&renderObjects(m,t,n),!0===t.isScene&&t.onAfterRender(P,t,n),null!==j&&(de.updateRenderTargetMipmap(j),de.updateMultisampleRenderTarget(j)),ue.buffers.depth.setTest(!0),ue.buffers.depth.setMask(!0),ue.buffers.color.setMask(!0),ue.setPolygonOffset(!1),A.pop(),O=A.length>0?A[A.length-1]:null,T=null},this.setFramebuffer=function(t){R!==t&&null===j&&Ae.bindFramebuffer(36160,t),R=t},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return I},this.getRenderList=function(){return T},this.setRenderList=function(t){T=t},this.getRenderTarget=function(){return j},this.setRenderTarget=function(t,n=0,i=0){j=t,N=n,I=i,t&&void 0===he.get(t).__webglFramebuffer&&de.setupRenderTarget(t);let o=R,a=!1;if(t){const i=he.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(o=i[n],a=!0):o=t.isWebGLMultisampleRenderTarget?he.get(t).__webglMultisampledFramebuffer:i,z.copy(t.viewport),H.copy(t.scissor),q=t.scissorTest}else z.copy(K).multiplyScalar(Q).floor(),H.copy($).multiplyScalar(Q).floor(),q=ee;if(V!==o&&(Ae.bindFramebuffer(36160,o),V=o),ue.viewport(z),ue.scissor(H),ue.setScissorTest(q),a){const o=he.get(t.texture);Ae.framebufferTexture2D(36160,36064,34069+n,o.__webglTexture,i)}},this.readRenderTargetPixels=function(t,n,i,o,a,s,m){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let g=he.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==m&&(g=g[m]),g){let m=!1;g!==V&&(Ae.bindFramebuffer(36160,g),m=!0);try{const g=t.texture,_=g.format,S=g.type;if(_!==ot&&Ce.convert(_)!==Ae.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(S===We||Ce.convert(S)===Ae.getParameter(35738)||S===Je&&(ce.isWebGL2||se.get("OES_texture_float")||se.get("WEBGL_color_buffer_float"))||S===Ke&&(ce.isWebGL2?se.get("EXT_color_buffer_float"):se.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===Ae.checkFramebufferStatus(36160)?n>=0&&n<=t.width-o&&i>=0&&i<=t.height-a&&Ae.readPixels(n,i,o,a,Ce.convert(_),Ce.convert(S),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{m&&Ae.bindFramebuffer(36160,V)}}},this.copyFramebufferToTexture=function(t,n,i=0){const o=Math.pow(2,-i),a=Math.floor(n.image.width*o),s=Math.floor(n.image.height*o),m=Ce.convert(n.format);de.setTexture2D(n,0),Ae.copyTexImage2D(3553,i,m,t.x,t.y,a,s,0),ue.unbindTexture()},this.copyTextureToTexture=function(t,n,i,o=0){const a=n.image.width,s=n.image.height,m=Ce.convert(i.format),g=Ce.convert(i.type);de.setTexture2D(i,0),Ae.pixelStorei(37440,i.flipY),Ae.pixelStorei(37441,i.premultiplyAlpha),Ae.pixelStorei(3317,i.unpackAlignment),n.isDataTexture?Ae.texSubImage2D(3553,o,t.x,t.y,a,s,m,g,n.image.data):n.isCompressedTexture?Ae.compressedTexSubImage2D(3553,o,t.x,t.y,n.mipmaps[0].width,n.mipmaps[0].height,m,n.mipmaps[0].data):Ae.texSubImage2D(3553,o,t.x,t.y,m,g,n.image),0===o&&i.generateMipmaps&&Ae.generateMipmap(3553),ue.unbindTexture()},this.initTexture=function(t){de.setTexture2D(t,0),ue.unbindTexture()},this.resetState=function(){ue.reset(),Oe.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function WebGL1Renderer(t){WebGLRenderer.call(this,t)}MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),Object.assign(WebXRController.prototype,{constructor:WebXRController,getHandSpace:function(){if(null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let t=0;t<=window.XRHand.LITTLE_PHALANX_TIP;t++){const t=new Group;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,n,i){let o=null,a=null,s=null;const m=this._targetRay,g=this._grip,_=this._hand;if(t&&"visible-blurred"!==n.session.visibilityState)if(_&&t.hand){s=!0;for(let o=0;o<=window.XRHand.LITTLE_PHALANX_TIP;o++)if(t.hand[o]){const a=n.getJointPose(t.hand[o],i),s=_.joints[o];null!==a&&(s.matrix.fromArray(a.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.jointRadius=a.radius),s.visible=null!==a;const m=_.joints[window.XRHand.INDEX_PHALANX_TIP],g=_.joints[window.XRHand.THUMB_PHALANX_TIP],S=m.position.distanceTo(g.position),M=.02,T=.005;_.inputState.pinching&&S>M+T?(_.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!_.inputState.pinching&&S<=M-T&&(_.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==m&&(o=n.getPose(t.targetRaySpace,i),null!==o&&(m.matrix.fromArray(o.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale))),null!==g&&t.gripSpace&&(a=n.getPose(t.gripSpace,i),null!==a&&(g.matrix.fromArray(a.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale)));return null!==m&&(m.visible=null!==o),null!==g&&(g.visible=null!==a),null!==_&&(_.visible=null!==s),this}}),Object.assign(WebXRManager.prototype,EventDispatcher.prototype),WebGL1Renderer.prototype=Object.assign(Object.create(WebGLRenderer.prototype),{constructor:WebGL1Renderer,isWebGL1Renderer:!0});class FogExp2{constructor(t,n){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Color(t),this.density=void 0!==n?n:25e-5}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Fog{constructor(t,n,i){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Color(t),this.near=void 0!==n?n:1,this.far=void 0!==i?i:1e3}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,n){return super.copy(t,n),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const n=super.toJSON(t);return null!==this.background&&(n.object.background=this.background.toJSON(t)),null!==this.environment&&(n.object.environment=this.environment.toJSON(t)),null!==this.fog&&(n.object.fog=this.fog.toJSON()),n}}function InterleavedBuffer(t,n){this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=Zn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ar.generateUUID()}Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,n,i){t*=this.stride,i*=n.stride;for(let o=0,a=this.stride;o<a;o++)this.array[t+o]=n.array[i+o];return this},set:function(t,n=0){return this.array.set(t,n),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ar.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new InterleavedBuffer(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return n.setUsage(this.usage),n},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ar.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const po=new Vector3;function InterleavedBufferAttribute(t,n,i,o){this.name="",this.data=t,this.itemSize=n,this.offset=i,this.normalized=!0===o}function SpriteMaterial(t){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let fo;Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let n=0,i=this.data.count;n<i;n++)po.x=this.getX(n),po.y=this.getY(n),po.z=this.getZ(n),po.applyMatrix4(t),this.setXYZ(n,po.x,po.y,po.z);return this},setX:function(t,n){return this.data.array[t*this.data.stride+this.offset]=n,this},setY:function(t,n){return this.data.array[t*this.data.stride+this.offset+1]=n,this},setZ:function(t,n){return this.data.array[t*this.data.stride+this.offset+2]=n,this},setW:function(t,n){return this.data.array[t*this.data.stride+this.offset+3]=n,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=n,this.data.array[t+1]=i,this},setXYZ:function(t,n,i,o){return t=t*this.data.stride+this.offset,this.data.array[t+0]=n,this.data.array[t+1]=i,this.data.array[t+2]=o,this},setXYZW:function(t,n,i,o,a){return t=t*this.data.stride+this.offset,this.data.array[t+0]=n,this.data.array[t+1]=i,this.data.array[t+2]=o,this.data.array[t+3]=a,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[i+n])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new InterleavedBufferAttribute(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[i+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const mo=new Vector3,go=new Vector3,yo=new Vector3,vo=new Vector2,bo=new Vector2,_o=new Matrix4,wo=new Vector3,xo=new Vector3,So=new Vector3,Mo=new Vector2,Eo=new Vector2,To=new Vector2;function Sprite(t){if(Object3D.call(this),this.type="Sprite",void 0===fo){fo=new BufferGeometry;const t=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);fo.setIndex([0,1,2,0,2,3]),fo.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),fo.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=fo,this.material=void 0!==t?t:new SpriteMaterial,this.center=new Vector2(.5,.5)}function transformVertex(t,n,i,o,a,s){vo.subVectors(t,i).addScalar(.5).multiply(o),void 0!==a?(bo.x=s*vo.x-a*vo.y,bo.y=a*vo.x+s*vo.y):bo.copy(vo),t.copy(n),t.x+=bo.x,t.y+=bo.y,t.applyMatrix4(_o)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(t,n){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),go.setFromMatrixScale(this.matrixWorld),_o.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),yo.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&go.multiplyScalar(-yo.z);const i=this.material.rotation;let o,a;0!==i&&(a=Math.cos(i),o=Math.sin(i));const s=this.center;transformVertex(wo.set(-.5,-.5,0),yo,s,go,o,a),transformVertex(xo.set(.5,-.5,0),yo,s,go,o,a),transformVertex(So.set(.5,.5,0),yo,s,go,o,a),Mo.set(0,0),Eo.set(1,0),To.set(1,1);let m=t.ray.intersectTriangle(wo,xo,So,!1,mo);if(null===m&&(transformVertex(xo.set(-.5,.5,0),yo,s,go,o,a),Eo.set(0,1),m=t.ray.intersectTriangle(wo,So,xo,!1,mo),null===m))return;const g=t.ray.origin.distanceTo(mo);g<t.near||g>t.far||n.push({distance:g,point:mo.clone(),uv:Triangle.getUV(mo,wo,xo,So,Mo,Eo,To,new Vector2),face:null,object:this})},copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const Co=new Vector3,Oo=new Vector3;function LOD(){Object3D.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(t){Object3D.prototype.copy.call(this,t,!1);const n=t.levels;for(let t=0,i=n.length;t<i;t++){const i=n[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,n=0){n=Math.abs(n);const i=this.levels;let o;for(o=0;o<i.length&&!(n<i[o].distance);o++);return i.splice(o,0,{distance:n,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const n=this.levels;if(n.length>0){let i,o;for(i=1,o=n.length;i<o&&!(t<n[i].distance);i++);return n[i-1].object}return null},raycast:function(t,n){if(this.levels.length>0){Co.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(Co);this.getObjectForDistance(i).raycast(t,n)}},update:function(t){const n=this.levels;if(n.length>1){Co.setFromMatrixPosition(t.matrixWorld),Oo.setFromMatrixPosition(this.matrixWorld);const i=Co.distanceTo(Oo)/t.zoom;let o,a;for(n[0].object.visible=!0,o=1,a=n.length;o<a&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(this._currentLevel=o-1;o<a;o++)n[o].object.visible=!1}},toJSON:function(t){const n=Object3D.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(n.object.autoUpdate=!1),n.object.levels=[];const i=this.levels;for(let t=0,o=i.length;t<o;t++){const o=i[t];n.object.levels.push({object:o.object.uuid,distance:o.distance})}return n}});const Ao=new Vector3,Po=new Vector4,Lo=new Vector4,Ro=new Vector3,No=new Matrix4;function SkinnedMesh(t,n){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Mesh.call(this,t,n),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}function Bone(){Object3D.call(this),this.type="Bone"}SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,copy:function(t){return Mesh.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,n){this.skeleton=t,void 0===n&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new Vector4,n=this.geometry.attributes.skinWeight;for(let i=0,o=n.count;i<o;i++){t.x=n.getX(i),t.y=n.getY(i),t.z=n.getZ(i),t.w=n.getW(i);const o=1/t.manhattanLength();o!==1/0?t.multiplyScalar(o):t.set(1,0,0,0),n.setXYZW(i,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Mesh.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(t,n){const i=this.skeleton,o=this.geometry;Po.fromBufferAttribute(o.attributes.skinIndex,t),Lo.fromBufferAttribute(o.attributes.skinWeight,t),Ao.fromBufferAttribute(o.attributes.position,t).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let t=0;t<4;t++){const o=Lo.getComponent(t);if(0!==o){const a=Po.getComponent(t);No.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),n.addScaledVector(Ro.copy(Ao).applyMatrix4(No),o)}}return n.applyMatrix4(this.bindMatrixInverse)}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});const Io=new Matrix4,ko=new Matrix4;function Skeleton(t=[],n=[]){this.uuid=ar.generateUUID(),this.bones=t.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(Skeleton.prototype,{init:function(){const t=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===n.length)this.calculateInverses();else if(t.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,n=this.bones.length;t<n;t++)this.boneInverses.push(new Matrix4)}},calculateInverses:function(){this.boneInverses.length=0;for(let t=0,n=this.bones.length;t<n;t++){const n=new Matrix4;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}},pose:function(){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}},update:function(){const t=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture;for(let o=0,a=t.length;o<a;o++){const a=t[o]?t[o].matrixWorld:ko;Io.multiplyMatrices(a,n[o]),Io.toArray(i,16*o)}null!==o&&(o.needsUpdate=!0)},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(t){for(let n=0,i=this.bones.length;n<i;n++){const i=this.bones[n];if(i.name===t)return i}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(t,n){this.uuid=t.uuid;for(let i=0,o=t.bones.length;i<o;i++){const o=t.bones[i];let a=n[o];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),a=new Bone),this.bones.push(a),this.boneInverses.push((new Matrix4).fromArray(t.boneInverses[i]))}return this.init(),this},toJSON:function(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const n=this.bones,i=this.boneInverses;for(let o=0,a=n.length;o<a;o++){const a=n[o];t.bones.push(a.uuid);const s=i[o];t.boneInverses.push(s.toArray())}return t}});const jo=new Matrix4,Fo=new Matrix4,Do=[],Bo=new Mesh;function InstancedMesh(t,n,i){Mesh.call(this,t,n),this.instanceMatrix=new BufferAttribute(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function LineBasicMaterial(t){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,copy:function(t){return Mesh.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},getColorAt:function(t,n){n.fromArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,n){n.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,n){const i=this.matrixWorld,o=this.count;if(Bo.geometry=this.geometry,Bo.material=this.material,void 0!==Bo.material)for(let a=0;a<o;a++){this.getMatrixAt(a,jo),Fo.multiplyMatrices(i,jo),Bo.matrixWorld=Fo,Bo.raycast(t,Do);for(let t=0,i=Do.length;t<i;t++){const i=Do[t];i.instanceId=a,i.object=this,n.push(i)}Do.length=0}},setColorAt:function(t,n){null===this.instanceColor&&(this.instanceColor=new BufferAttribute(new Float32Array(3*this.count),3)),n.toArray(this.instanceColor.array,3*t)},setMatrixAt:function(t,n){n.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const Vo=new Vector3,Uo=new Vector3,Go=new Matrix4,zo=new Ray,Ho=new Sphere;function Line(t=new BufferGeometry,n=new LineBasicMaterial){Object3D.call(this),this.type="Line",this.geometry=t,this.material=n,this.updateMorphTargets()}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const n=t.attributes.position,i=[0];for(let t=1,o=n.count;t<o;t++)Vo.fromBufferAttribute(n,t-1),Uo.fromBufferAttribute(n,t),i[t]=i[t-1],i[t]+=Vo.distanceTo(Uo);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const n=t.vertices,i=t.lineDistances;i[0]=0;for(let t=1,o=n.length;t<o;t++)i[t]=i[t-1],i[t]+=n[t-1].distanceTo(n[t])}return this},raycast:function(t,n){const i=this.geometry,o=this.matrixWorld,a=t.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ho.copy(i.boundingSphere),Ho.applyMatrix4(o),Ho.radius+=a,!1===t.ray.intersectsSphere(Ho))return;Go.copy(o).invert(),zo.copy(t.ray).applyMatrix4(Go);const s=a/((this.scale.x+this.scale.y+this.scale.z)/3),m=s*s,g=new Vector3,_=new Vector3,S=new Vector3,M=new Vector3,T=this.isLineSegments?2:1;if(i.isBufferGeometry){const o=i.index,a=i.attributes.position;if(null!==o){const i=o.array;for(let o=0,s=i.length-1;o<s;o+=T){const s=i[o],T=i[o+1];if(g.fromBufferAttribute(a,s),_.fromBufferAttribute(a,T),zo.distanceSqToSegment(g,_,M,S)>m)continue;M.applyMatrix4(this.matrixWorld);const O=t.ray.origin.distanceTo(M);O<t.near||O>t.far||n.push({distance:O,point:S.clone().applyMatrix4(this.matrixWorld),index:o,face:null,faceIndex:null,object:this})}}else for(let i=0,o=a.count-1;i<o;i+=T){if(g.fromBufferAttribute(a,i),_.fromBufferAttribute(a,i+1),zo.distanceSqToSegment(g,_,M,S)>m)continue;M.applyMatrix4(this.matrixWorld);const o=t.ray.origin.distanceTo(M);o<t.near||o>t.far||n.push({distance:o,point:S.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(i.isGeometry){const o=i.vertices,a=o.length;for(let i=0;i<a-1;i+=T){if(zo.distanceSqToSegment(o[i],o[i+1],M,S)>m)continue;M.applyMatrix4(this.matrixWorld);const a=t.ray.origin.distanceTo(M);a<t.near||a>t.far||n.push({distance:a,point:S.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const n=t.morphAttributes,i=Object.keys(n);if(i.length>0){const t=n[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++){const i=t[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=n}}}}else{const n=t.morphTargets;void 0!==n&&n.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Wo=new Vector3,qo=new Vector3;function LineSegments(t,n){Line.call(this,t,n),this.type="LineSegments"}function LineLoop(t,n){Line.call(this,t,n),this.type="LineLoop"}function PointsMaterial(t){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const n=t.attributes.position,i=[];for(let t=0,o=n.count;t<o;t+=2)Wo.fromBufferAttribute(n,t),qo.fromBufferAttribute(n,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Wo.distanceTo(qo);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const n=t.vertices,i=t.lineDistances;for(let t=0,o=n.length;t<o;t+=2)Wo.copy(n[t]),qo.copy(n[t+1]),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Wo.distanceTo(qo)}return this}}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const Zo=new Matrix4,Xo=new Ray,Qo=new Sphere,Yo=new Vector3;function Points(t=new BufferGeometry,n=new PointsMaterial){Object3D.call(this),this.type="Points",this.geometry=t,this.material=n,this.updateMorphTargets()}function testPoint(t,n,i,o,a,s,m){const g=Xo.distanceSqToPoint(t);if(g<i){const i=new Vector3;Xo.closestPointToPoint(t,i),i.applyMatrix4(o);const _=a.ray.origin.distanceTo(i);if(_<a.near||_>a.far)return;s.push({distance:_,distanceToRay:Math.sqrt(g),point:i,index:n,face:null,object:m})}}function VideoTexture(t,n,i,o,a,s,m,g,_){Texture.call(this,t,n,i,o,a,s,m,g,_),this.format=void 0!==m?m:it,this.minFilter=void 0!==s?s:Ve,this.magFilter=void 0!==a?a:Ve,this.generateMipmaps=!1;const S=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function updateVideo(){S.needsUpdate=!0,t.requestVideoFrameCallback(updateVideo)}))}function CompressedTexture(t,n,i,o,a,s,m,g,_,S,M,T){Texture.call(this,null,s,m,g,_,S,o,a,M,T),this.image={width:n,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function CanvasTexture(t,n,i,o,a,s,m,g,_){Texture.call(this,t,n,i,o,a,s,m,g,_),this.needsUpdate=!0}function DepthTexture(t,n,i,o,a,s,m,g,_,S){if((S=void 0!==S?S:ut)!==ut&&S!==lt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&S===ut&&(i=Xe),void 0===i&&S===lt&&(i=nt),Texture.call(this,null,o,a,s,m,g,S,i,_),this.image={width:t,height:n},this.magFilter=void 0!==m?m:ke,this.minFilter=void 0!==g?g:ke,this.flipY=!1,this.generateMipmaps=!1}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,n){const i=this.geometry,o=this.matrixWorld,a=t.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Qo.copy(i.boundingSphere),Qo.applyMatrix4(o),Qo.radius+=a,!1===t.ray.intersectsSphere(Qo))return;Zo.copy(o).invert(),Xo.copy(t.ray).applyMatrix4(Zo);const s=a/((this.scale.x+this.scale.y+this.scale.z)/3),m=s*s;if(i.isBufferGeometry){const a=i.index,s=i.attributes.position;if(null!==a){const i=a.array;for(let a=0,g=i.length;a<g;a++){const g=i[a];Yo.fromBufferAttribute(s,g),testPoint(Yo,g,m,o,t,n,this)}}else for(let i=0,a=s.count;i<a;i++)Yo.fromBufferAttribute(s,i),testPoint(Yo,i,m,o,t,n,this)}else{const a=i.vertices;for(let i=0,s=a.length;i<s;i++)testPoint(a[i],i,m,o,t,n,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const n=t.morphAttributes,i=Object.keys(n);if(i.length>0){const t=n[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++){const i=t[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=n}}}}else{const n=t.morphTargets;void 0!==n&&n.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0;let Jo=0;const Ko=new Matrix4,$o=new Object3D,ea=new Vector3;function Geometry(){Object.defineProperty(this,"id",{value:Jo+=2}),this.uuid=ar.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix4:function(t){const n=(new Matrix3).getNormalMatrix(t);for(let n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(t);for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t];i.normal.applyMatrix3(n).normalize();for(let t=0,o=i.vertexNormals.length;t<o;t++)i.vertexNormals[t].applyMatrix3(n).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return Ko.makeRotationX(t),this.applyMatrix4(Ko),this},rotateY:function(t){return Ko.makeRotationY(t),this.applyMatrix4(Ko),this},rotateZ:function(t){return Ko.makeRotationZ(t),this.applyMatrix4(Ko),this},translate:function(t,n,i){return Ko.makeTranslation(t,n,i),this.applyMatrix4(Ko),this},scale:function(t,n,i){return Ko.makeScale(t,n,i),this.applyMatrix4(Ko),this},lookAt:function(t){return $o.lookAt(t),$o.updateMatrix(),this.applyMatrix4($o.matrix),this},fromBufferGeometry:function(t){const n=this,i=null!==t.index?t.index:void 0,o=t.attributes;if(void 0===o.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const a=o.position,s=o.normal,m=o.color,g=o.uv,_=o.uv2;void 0!==_&&(this.faceVertexUvs[1]=[]);for(let t=0;t<a.count;t++)n.vertices.push((new Vector3).fromBufferAttribute(a,t)),void 0!==m&&n.colors.push((new Color).fromBufferAttribute(m,t));function addFace(t,i,o,a){const S=void 0===m?[]:[n.colors[t].clone(),n.colors[i].clone(),n.colors[o].clone()],M=void 0===s?[]:[(new Vector3).fromBufferAttribute(s,t),(new Vector3).fromBufferAttribute(s,i),(new Vector3).fromBufferAttribute(s,o)],T=new Face3(t,i,o,M,S,a);n.faces.push(T),void 0!==g&&n.faceVertexUvs[0].push([(new Vector2).fromBufferAttribute(g,t),(new Vector2).fromBufferAttribute(g,i),(new Vector2).fromBufferAttribute(g,o)]),void 0!==_&&n.faceVertexUvs[1].push([(new Vector2).fromBufferAttribute(_,t),(new Vector2).fromBufferAttribute(_,i),(new Vector2).fromBufferAttribute(_,o)])}const S=t.groups;if(S.length>0)for(let t=0;t<S.length;t++){const n=S[t],o=n.start;for(let t=o,a=o+n.count;t<a;t+=3)void 0!==i?addFace(i.getX(t),i.getX(t+1),i.getX(t+2),n.materialIndex):addFace(t,t+1,t+2,n.materialIndex)}else if(void 0!==i)for(let t=0;t<i.count;t+=3)addFace(i.getX(t),i.getX(t+1),i.getX(t+2));else for(let t=0;t<a.count;t+=3)addFace(t,t+1,t+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ea).negate(),this.translate(ea.x,ea.y,ea.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,n=this.boundingSphere.radius,i=0===n?1:1/n,o=new Matrix4;return o.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix4(o),this},computeFaceNormals:function(){const t=new Vector3,n=new Vector3;for(let i=0,o=this.faces.length;i<o;i++){const o=this.faces[i],a=this.vertices[o.a],s=this.vertices[o.b],m=this.vertices[o.c];t.subVectors(m,s),n.subVectors(a,s),t.cross(n),t.normalize(),o.normal.copy(t)}},computeVertexNormals:function(t=!0){const n=new Array(this.vertices.length);for(let t=0,i=this.vertices.length;t<i;t++)n[t]=new Vector3;if(t){const t=new Vector3,i=new Vector3;for(let o=0,a=this.faces.length;o<a;o++){const a=this.faces[o],s=this.vertices[a.a],m=this.vertices[a.b],g=this.vertices[a.c];t.subVectors(g,m),i.subVectors(s,m),t.cross(i),n[a.a].add(t),n[a.b].add(t),n[a.c].add(t)}}else{this.computeFaceNormals();for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t];n[i.a].add(i.normal),n[i.b].add(i.normal),n[i.c].add(i.normal)}}for(let t=0,i=this.vertices.length;t<i;t++)n[t].normalize();for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t],o=i.vertexNormals;3===o.length?(o[0].copy(n[i.a]),o[1].copy(n[i.b]),o[2].copy(n[i.c])):(o[0]=n[i.a].clone(),o[1]=n[i.b].clone(),o[2]=n[i.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t],i=n.vertexNormals;3===i.length?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);for(let t=0,i=n.vertexNormals.length;t<i;t++)n.__originalVertexNormals[t]?n.__originalVertexNormals[t].copy(n.vertexNormals[t]):n.__originalVertexNormals[t]=n.vertexNormals[t].clone()}const t=new Geometry;t.faces=this.faces;for(let n=0,i=this.morphTargets.length;n<i;n++){if(!this.morphNormals[n]){this.morphNormals[n]={},this.morphNormals[n].faceNormals=[],this.morphNormals[n].vertexNormals=[];const t=this.morphNormals[n].faceNormals,i=this.morphNormals[n].vertexNormals;for(let n=0,o=this.faces.length;n<o;n++){const n=new Vector3,o={a:new Vector3,b:new Vector3,c:new Vector3};t.push(n),i.push(o)}}const i=this.morphNormals[n];t.vertices=this.morphTargets[n].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t],o=i.faceNormals[t],a=i.vertexNormals[t];o.copy(n.normal),a.a.copy(n.vertexNormals[0]),a.b.copy(n.vertexNormals[1]),a.c.copy(n.vertexNormals[2])}}for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,n,i=0){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let o;const a=this.vertices.length,s=this.vertices,m=t.vertices,g=this.faces,_=t.faces,S=this.colors,M=t.colors;void 0!==n&&(o=(new Matrix3).getNormalMatrix(n));for(let t=0,i=m.length;t<i;t++){const i=m[t].clone();void 0!==n&&i.applyMatrix4(n),s.push(i)}for(let t=0,n=M.length;t<n;t++)S.push(M[t].clone());for(let t=0,n=_.length;t<n;t++){const n=_[t];let s,m;const S=n.vertexNormals,M=n.vertexColors,T=new Face3(n.a+a,n.b+a,n.c+a);T.normal.copy(n.normal),void 0!==o&&T.normal.applyMatrix3(o).normalize();for(let t=0,n=S.length;t<n;t++)s=S[t].clone(),void 0!==o&&s.applyMatrix3(o).normalize(),T.vertexNormals.push(s);T.color.copy(n.color);for(let t=0,n=M.length;t<n;t++)m=M[t],T.vertexColors.push(m.clone());T.materialIndex=n.materialIndex+i,g.push(T)}for(let n=0,i=t.faceVertexUvs.length;n<i;n++){const i=t.faceVertexUvs[n];void 0===this.faceVertexUvs[n]&&(this.faceVertexUvs[n]=[]);for(let t=0,o=i.length;t<o;t++){const o=i[t],a=[];for(let t=0,n=o.length;t<n;t++)a.push(o[t].clone());this.faceVertexUvs[n].push(a)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(t=4){const n={},i=[],o=[],a=Math.pow(10,t);for(let t=0,s=this.vertices.length;t<s;t++){const s=this.vertices[t],m=Math.round(s.x*a)+"_"+Math.round(s.y*a)+"_"+Math.round(s.z*a);void 0===n[m]?(n[m]=t,i.push(this.vertices[t]),o[t]=i.length-1):o[t]=o[n[m]]}const s=[];for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];n.a=o[n.a],n.b=o[n.b],n.c=o[n.c];const i=[n.a,n.b,n.c];for(let n=0;n<3;n++)if(i[n]===i[(n+1)%3]){s.push(t);break}}for(let t=s.length-1;t>=0;t--){const n=s[t];this.faces.splice(n,1);for(let t=0,i=this.faceVertexUvs.length;t<i;t++)this.faceVertexUvs[t].splice(n,1)}const m=this.vertices.length-i.length;return this.vertices=i,m},setFromPoints:function(t){this.vertices=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];this.vertices.push(new Vector3(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,n=t.length;for(let i=0;i<n;i++)t[i]._id=i;t.sort((function materialIndexSort(t,n){return t.materialIndex-n.materialIndex}));const i=this.faceVertexUvs[0],o=this.faceVertexUvs[1];let a,s;i&&i.length===n&&(a=[]),o&&o.length===n&&(s=[]);for(let m=0;m<n;m++){const n=t[m]._id;a&&a.push(i[n]),s&&s.push(o[n])}a&&(this.faceVertexUvs[0]=a),s&&(this.faceVertexUvs[1]=s)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const n=this.parameters;for(const i in n)void 0!==n[i]&&(t[i]=n[i]);return t}const n=[];for(let t=0;t<this.vertices.length;t++){const i=this.vertices[t];n.push(i.x,i.y,i.z)}const i=[],o=[],a={},s=[],m={},g=[],_={};for(let t=0;t<this.faces.length;t++){const n=this.faces[t],o=!0,a=!1,s=void 0!==this.faceVertexUvs[0][t],m=n.normal.length()>0,g=n.vertexNormals.length>0,_=1!==n.color.r||1!==n.color.g||1!==n.color.b,S=n.vertexColors.length>0;let M=0;if(M=setBit(M,0,0),M=setBit(M,1,o),M=setBit(M,2,a),M=setBit(M,3,s),M=setBit(M,4,m),M=setBit(M,5,g),M=setBit(M,6,_),M=setBit(M,7,S),i.push(M),i.push(n.a,n.b,n.c),i.push(n.materialIndex),s){const n=this.faceVertexUvs[0][t];i.push(getUvIndex(n[0]),getUvIndex(n[1]),getUvIndex(n[2]))}if(m&&i.push(getNormalIndex(n.normal)),g){const t=n.vertexNormals;i.push(getNormalIndex(t[0]),getNormalIndex(t[1]),getNormalIndex(t[2]))}if(_&&i.push(getColorIndex(n.color)),S){const t=n.vertexColors;i.push(getColorIndex(t[0]),getColorIndex(t[1]),getColorIndex(t[2]))}}function setBit(t,n,i){return i?t|1<<n:t&~(1<<n)}function getNormalIndex(t){const n=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==a[n]||(a[n]=o.length/3,o.push(t.x,t.y,t.z)),a[n]}function getColorIndex(t){const n=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==m[n]||(m[n]=s.length,s.push(t.getHex())),m[n]}function getUvIndex(t){const n=t.x.toString()+t.y.toString();return void 0!==_[n]||(_[n]=g.length/2,g.push(t.x,t.y)),_[n]}return t.data={},t.data.vertices=n,t.data.normals=o,s.length>0&&(t.data.colors=s),g.length>0&&(t.data.uvs=[g]),t.data.faces=i,t},clone:function(){return(new Geometry).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const n=t.vertices;for(let t=0,i=n.length;t<i;t++)this.vertices.push(n[t].clone());const i=t.colors;for(let t=0,n=i.length;t<n;t++)this.colors.push(i[t].clone());const o=t.faces;for(let t=0,n=o.length;t<n;t++)this.faces.push(o[t].clone());for(let n=0,i=t.faceVertexUvs.length;n<i;n++){const i=t.faceVertexUvs[n];void 0===this.faceVertexUvs[n]&&(this.faceVertexUvs[n]=[]);for(let t=0,o=i.length;t<o;t++){const o=i[t],a=[];for(let t=0,n=o.length;t<n;t++){const n=o[t];a.push(n.clone())}this.faceVertexUvs[n].push(a)}}const a=t.morphTargets;for(let t=0,n=a.length;t<n;t++){const n={};if(n.name=a[t].name,void 0!==a[t].vertices){n.vertices=[];for(let i=0,o=a[t].vertices.length;i<o;i++)n.vertices.push(a[t].vertices[i].clone())}if(void 0!==a[t].normals){n.normals=[];for(let i=0,o=a[t].normals.length;i<o;i++)n.normals.push(a[t].normals[i].clone())}this.morphTargets.push(n)}const s=t.morphNormals;for(let t=0,n=s.length;t<n;t++){const n={};if(void 0!==s[t].vertexNormals){n.vertexNormals=[];for(let i=0,o=s[t].vertexNormals.length;i<o;i++){const o=s[t].vertexNormals[i],a={};a.a=o.a.clone(),a.b=o.b.clone(),a.c=o.c.clone(),n.vertexNormals.push(a)}}if(void 0!==s[t].faceNormals){n.faceNormals=[];for(let i=0,o=s[t].faceNormals.length;i<o;i++)n.faceNormals.push(s[t].faceNormals[i].clone())}this.morphNormals.push(n)}const m=t.skinWeights;for(let t=0,n=m.length;t<n;t++)this.skinWeights.push(m[t].clone());const g=t.skinIndices;for(let t=0,n=g.length;t<n;t++)this.skinIndices.push(g[t].clone());const _=t.lineDistances;for(let t=0,n=_.length;t<n;t++)this.lineDistances.push(_[t]);const S=t.boundingBox;null!==S&&(this.boundingBox=S.clone());const M=t.boundingSphere;return null!==M&&(this.boundingSphere=M.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class BoxGeometry extends Geometry{constructor(t,n,i,o,a,s){super(),this.type="BoxGeometry",this.parameters={width:t,height:n,depth:i,widthSegments:o,heightSegments:a,depthSegments:s},this.fromBufferGeometry(new BoxBufferGeometry(t,n,i,o,a,s)),this.mergeVertices()}}class CircleBufferGeometry extends BufferGeometry{constructor(t=1,n=8,i=0,o=2*Math.PI){super(),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:n,thetaStart:i,thetaLength:o},n=Math.max(3,n);const a=[],s=[],m=[],g=[],_=new Vector3,S=new Vector2;s.push(0,0,0),m.push(0,0,1),g.push(.5,.5);for(let a=0,M=3;a<=n;a++,M+=3){const T=i+a/n*o;_.x=t*Math.cos(T),_.y=t*Math.sin(T),s.push(_.x,_.y,_.z),m.push(0,0,1),S.x=(s[M]/t+1)/2,S.y=(s[M+1]/t+1)/2,g.push(S.x,S.y)}for(let t=1;t<=n;t++)a.push(t,t+1,0);this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2))}}class CircleGeometry extends Geometry{constructor(t,n,i,o){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new CircleBufferGeometry(t,n,i,o)),this.mergeVertices()}}class CylinderBufferGeometry extends BufferGeometry{constructor(t=1,n=1,i=1,o=8,a=1,s=!1,m=0,g=2*Math.PI){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:n,height:i,radialSegments:o,heightSegments:a,openEnded:s,thetaStart:m,thetaLength:g};const _=this;o=Math.floor(o),a=Math.floor(a);const S=[],M=[],T=[],O=[];let A=0;const P=[],L=i/2;let R=0;function generateCap(i){const a=A,s=new Vector2,P=new Vector3;let N=0;const I=!0===i?t:n,j=!0===i?1:-1;for(let t=1;t<=o;t++)M.push(0,L*j,0),T.push(0,j,0),O.push(.5,.5),A++;const V=A;for(let t=0;t<=o;t++){const n=t/o*g+m,i=Math.cos(n),a=Math.sin(n);P.x=I*a,P.y=L*j,P.z=I*i,M.push(P.x,P.y,P.z),T.push(0,j,0),s.x=.5*i+.5,s.y=.5*a*j+.5,O.push(s.x,s.y),A++}for(let t=0;t<o;t++){const n=a+t,o=V+t;!0===i?S.push(o,o+1,n):S.push(o+1,o,n),N+=3}_.addGroup(R,N,!0===i?1:2),R+=N}!function generateTorso(){const s=new Vector3,N=new Vector3;let I=0;const j=(n-t)/i;for(let _=0;_<=a;_++){const S=[],R=_/a,I=R*(n-t)+t;for(let t=0;t<=o;t++){const n=t/o,a=n*g+m,_=Math.sin(a),P=Math.cos(a);N.x=I*_,N.y=-R*i+L,N.z=I*P,M.push(N.x,N.y,N.z),s.set(_,j,P).normalize(),T.push(s.x,s.y,s.z),O.push(n,1-R),S.push(A++)}P.push(S)}for(let t=0;t<o;t++)for(let n=0;n<a;n++){const i=P[n][t],o=P[n+1][t],a=P[n+1][t+1],s=P[n][t+1];S.push(i,o,s),S.push(o,a,s),I+=6}_.addGroup(R,I,0),R+=I}(),!1===s&&(t>0&&generateCap(!0),n>0&&generateCap(!1)),this.setIndex(S),this.setAttribute("position",new Float32BufferAttribute(M,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(O,2))}}class CylinderGeometry extends Geometry{constructor(t,n,i,o,a,s,m,g){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:n,height:i,radialSegments:o,heightSegments:a,openEnded:s,thetaStart:m,thetaLength:g},this.fromBufferGeometry(new CylinderBufferGeometry(t,n,i,o,a,s,m,g)),this.mergeVertices()}}class ConeGeometry extends CylinderGeometry{constructor(t,n,i,o,a,s,m){super(0,t,n,i,o,a,s,m),this.type="ConeGeometry",this.parameters={radius:t,height:n,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:m}}}class ConeBufferGeometry extends CylinderBufferGeometry{constructor(t=1,n=1,i=8,o=1,a=!1,s=0,m=2*Math.PI){super(0,t,n,i,o,a,s,m),this.type="ConeBufferGeometry",this.parameters={radius:t,height:n,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:m}}}class PolyhedronBufferGeometry extends BufferGeometry{constructor(t,n,i=1,o=0){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:n,radius:i,detail:o};const a=[],s=[];function subdivideFace(t,n,i,o){const a=o+1,s=[];for(let o=0;o<=a;o++){s[o]=[];const m=t.clone().lerp(i,o/a),g=n.clone().lerp(i,o/a),_=a-o;for(let t=0;t<=_;t++)s[o][t]=0===t&&o===a?m:m.clone().lerp(g,t/_)}for(let t=0;t<a;t++)for(let n=0;n<2*(a-t)-1;n++){const i=Math.floor(n/2);n%2==0?(pushVertex(s[t][i+1]),pushVertex(s[t+1][i]),pushVertex(s[t][i])):(pushVertex(s[t][i+1]),pushVertex(s[t+1][i+1]),pushVertex(s[t+1][i]))}}function pushVertex(t){a.push(t.x,t.y,t.z)}function getVertexByIndex(n,i){const o=3*n;i.x=t[o+0],i.y=t[o+1],i.z=t[o+2]}function correctUV(t,n,i,o){o<0&&1===t.x&&(s[n]=t.x-1),0===i.x&&0===i.z&&(s[n]=o/2/Math.PI+.5)}function azimuth(t){return Math.atan2(t.z,-t.x)}!function subdivide(t){const i=new Vector3,o=new Vector3,a=new Vector3;for(let s=0;s<n.length;s+=3)getVertexByIndex(n[s+0],i),getVertexByIndex(n[s+1],o),getVertexByIndex(n[s+2],a),subdivideFace(i,o,a,t)}(o),function applyRadius(t){const n=new Vector3;for(let i=0;i<a.length;i+=3)n.x=a[i+0],n.y=a[i+1],n.z=a[i+2],n.normalize().multiplyScalar(t),a[i+0]=n.x,a[i+1]=n.y,a[i+2]=n.z}(i),function generateUVs(){const t=new Vector3;for(let i=0;i<a.length;i+=3){t.x=a[i+0],t.y=a[i+1],t.z=a[i+2];const o=azimuth(t)/2/Math.PI+.5,m=(n=t,Math.atan2(-n.y,Math.sqrt(n.x*n.x+n.z*n.z))/Math.PI+.5);s.push(o,1-m)}var n;(function correctUVs(){const t=new Vector3,n=new Vector3,i=new Vector3,o=new Vector3,m=new Vector2,g=new Vector2,_=new Vector2;for(let S=0,M=0;S<a.length;S+=9,M+=6){t.set(a[S+0],a[S+1],a[S+2]),n.set(a[S+3],a[S+4],a[S+5]),i.set(a[S+6],a[S+7],a[S+8]),m.set(s[M+0],s[M+1]),g.set(s[M+2],s[M+3]),_.set(s[M+4],s[M+5]),o.copy(t).add(n).add(i).divideScalar(3);const T=azimuth(o);correctUV(m,M+0,t,T),correctUV(g,M+2,n,T),correctUV(_,M+4,i,T)}})(),function correctSeam(){for(let t=0;t<s.length;t+=6){const n=s[t+0],i=s[t+2],o=s[t+4],a=Math.max(n,i,o),m=Math.min(n,i,o);a>.9&&m<.1&&(n<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),o<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(a.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),0===o?this.computeVertexNormals():this.normalizeNormals()}}class DodecahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t=1,n=0){const i=(1+Math.sqrt(5))/2,o=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,n),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:n}}}class DodecahedronGeometry extends Geometry{constructor(t,n){super(),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:n},this.fromBufferGeometry(new DodecahedronBufferGeometry(t,n)),this.mergeVertices()}}const ta=new Vector3,na=new Vector3,ra=new Vector3,ia=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(t,n){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:n},n=void 0!==n?n:1,t.isGeometry&&(t=(new BufferGeometry).fromGeometry(t));const i=Math.pow(10,4),o=Math.cos(ar.DEG2RAD*n),a=t.getIndex(),s=t.getAttribute("position"),m=a?a.count:s.count,g=[0,0,0],_=["a","b","c"],S=new Array(3),M={},T=[];for(let t=0;t<m;t+=3){a?(g[0]=a.getX(t),g[1]=a.getX(t+1),g[2]=a.getX(t+2)):(g[0]=t,g[1]=t+1,g[2]=t+2);const{a:n,b:m,c:O}=ia;if(n.fromBufferAttribute(s,g[0]),m.fromBufferAttribute(s,g[1]),O.fromBufferAttribute(s,g[2]),ia.getNormal(ra),S[0]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,S[1]=`${Math.round(m.x*i)},${Math.round(m.y*i)},${Math.round(m.z*i)}`,S[2]=`${Math.round(O.x*i)},${Math.round(O.y*i)},${Math.round(O.z*i)}`,S[0]!==S[1]&&S[1]!==S[2]&&S[2]!==S[0])for(let t=0;t<3;t++){const n=(t+1)%3,i=S[t],a=S[n],s=ia[_[t]],m=ia[_[n]],O=`${i}_${a}`,A=`${a}_${i}`;A in M&&M[A]?(ra.dot(M[A].normal)<=o&&(T.push(s.x,s.y,s.z),T.push(m.x,m.y,m.z)),M[A]=null):O in M||(M[O]={index0:g[t],index1:g[n],normal:ra.clone()})}}for(const t in M)if(M[t]){const{index0:n,index1:i}=M[t];ta.fromBufferAttribute(s,n),na.fromBufferAttribute(s,i),T.push(ta.x,ta.y,ta.z),T.push(na.x,na.y,na.z)}this.setAttribute("position",new Float32BufferAttribute(T,3))}}function linkedList(t,n,i,o,a){let s,m;if(a===function signedArea(t,n,i,o){let a=0;for(let s=n,m=i-o;s<i;s+=o)a+=(t[m]-t[s])*(t[s+1]+t[m+1]),m=s;return a}(t,n,i,o)>0)for(s=n;s<i;s+=o)m=insertNode(s,t[s],t[s+1],m);else for(s=i-o;s>=n;s-=o)m=insertNode(s,t[s],t[s+1],m);return m&&equals(m,m.next)&&(removeNode(m),m=m.next),m}function filterPoints(t,n){if(!t)return t;n||(n=t);let i,o=t;do{if(i=!1,o.steiner||!equals(o,o.next)&&0!==area(o.prev,o,o.next))o=o.next;else{if(removeNode(o),o=n=o.prev,o===o.next)break;i=!0}}while(i||o!==n);return n}function earcutLinked(t,n,i,o,a,s,m){if(!t)return;!m&&s&&function indexCurve(t,n,i,o){let a=t;do{null===a.z&&(a.z=zOrder(a.x,a.y,n,i,o)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,function sortLinked(t){let n,i,o,a,s,m,g,_,S=1;do{for(i=t,t=null,s=null,m=0;i;){for(m++,o=i,g=0,n=0;n<S&&(g++,o=o.nextZ,o);n++);for(_=S;g>0||_>0&&o;)0!==g&&(0===_||!o||i.z<=o.z)?(a=i,i=i.nextZ,g--):(a=o,o=o.nextZ,_--),s?s.nextZ=a:t=a,a.prevZ=s,s=a;i=o}s.nextZ=null,S*=2}while(m>1)}(a)}(t,o,a,s);let g,_,S=t;for(;t.prev!==t.next;)if(g=t.prev,_=t.next,s?isEarHashed(t,o,a,s):isEar(t))n.push(g.i/i),n.push(t.i/i),n.push(_.i/i),removeNode(t),t=_.next,S=_.next;else if((t=_)===S){m?1===m?earcutLinked(t=cureLocalIntersections(filterPoints(t),n,i),n,i,o,a,s,2):2===m&&splitEarcut(t,n,i,o,a,s):earcutLinked(filterPoints(t),n,i,o,a,s,1);break}}function isEar(t){const n=t.prev,i=t,o=t.next;if(area(n,i,o)>=0)return!1;let a=t.next.next;for(;a!==t.prev;){if(pointInTriangle(n.x,n.y,i.x,i.y,o.x,o.y,a.x,a.y)&&area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function isEarHashed(t,n,i,o){const a=t.prev,s=t,m=t.next;if(area(a,s,m)>=0)return!1;const g=a.x<s.x?a.x<m.x?a.x:m.x:s.x<m.x?s.x:m.x,_=a.y<s.y?a.y<m.y?a.y:m.y:s.y<m.y?s.y:m.y,S=a.x>s.x?a.x>m.x?a.x:m.x:s.x>m.x?s.x:m.x,M=a.y>s.y?a.y>m.y?a.y:m.y:s.y>m.y?s.y:m.y,T=zOrder(g,_,n,i,o),O=zOrder(S,M,n,i,o);let A=t.prevZ,P=t.nextZ;for(;A&&A.z>=T&&P&&P.z<=O;){if(A!==t.prev&&A!==t.next&&pointInTriangle(a.x,a.y,s.x,s.y,m.x,m.y,A.x,A.y)&&area(A.prev,A,A.next)>=0)return!1;if(A=A.prevZ,P!==t.prev&&P!==t.next&&pointInTriangle(a.x,a.y,s.x,s.y,m.x,m.y,P.x,P.y)&&area(P.prev,P,P.next)>=0)return!1;P=P.nextZ}for(;A&&A.z>=T;){if(A!==t.prev&&A!==t.next&&pointInTriangle(a.x,a.y,s.x,s.y,m.x,m.y,A.x,A.y)&&area(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;P&&P.z<=O;){if(P!==t.prev&&P!==t.next&&pointInTriangle(a.x,a.y,s.x,s.y,m.x,m.y,P.x,P.y)&&area(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function cureLocalIntersections(t,n,i){let o=t;do{const a=o.prev,s=o.next.next;!equals(a,s)&&intersects(a,o,o.next,s)&&locallyInside(a,s)&&locallyInside(s,a)&&(n.push(a.i/i),n.push(o.i/i),n.push(s.i/i),removeNode(o),removeNode(o.next),o=t=s),o=o.next}while(o!==t);return filterPoints(o)}function splitEarcut(t,n,i,o,a,s){let m=t;do{let t=m.next.next;for(;t!==m.prev;){if(m.i!==t.i&&isValidDiagonal(m,t)){let g=splitPolygon(m,t);return m=filterPoints(m,m.next),g=filterPoints(g,g.next),earcutLinked(m,n,i,o,a,s),void earcutLinked(g,n,i,o,a,s)}t=t.next}m=m.next}while(m!==t)}function compareX(t,n){return t.x-n.x}function eliminateHole(t,n){if(n=function findHoleBridge(t,n){let i=n;const o=t.x,a=t.y;let s,m=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const t=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=o&&t>m){if(m=t,t===o){if(a===i.y)return i;if(a===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==n);if(!s)return null;if(o===m)return s;const g=s,_=s.x,S=s.y;let M,T=1/0;i=s;do{o>=i.x&&i.x>=_&&o!==i.x&&pointInTriangle(a<S?o:m,a,_,S,a<S?m:o,a,i.x,i.y)&&(M=Math.abs(a-i.y)/(o-i.x),locallyInside(i,t)&&(M<T||M===T&&(i.x>s.x||i.x===s.x&&sectorContainsSector(s,i)))&&(s=i,T=M)),i=i.next}while(i!==g);return s}(t,n)){const i=splitPolygon(n,t);filterPoints(n,n.next),filterPoints(i,i.next)}}function sectorContainsSector(t,n){return area(t.prev,t,n.prev)<0&&area(n.next,t,t.next)<0}function zOrder(t,n,i,o,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*a)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-o)*a)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function getLeftmost(t){let n=t,i=t;do{(n.x<i.x||n.x===i.x&&n.y<i.y)&&(i=n),n=n.next}while(n!==t);return i}function pointInTriangle(t,n,i,o,a,s,m,g){return(a-m)*(n-g)-(t-m)*(s-g)>=0&&(t-m)*(o-g)-(i-m)*(n-g)>=0&&(i-m)*(s-g)-(a-m)*(o-g)>=0}function isValidDiagonal(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function intersectsPolygon(t,n){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==n.i&&i.next.i!==n.i&&intersects(i,i.next,t,n))return!0;i=i.next}while(i!==t);return!1}(t,n)&&(locallyInside(t,n)&&locallyInside(n,t)&&function middleInside(t,n){let i=t,o=!1;const a=(t.x+n.x)/2,s=(t.y+n.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&a<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(o=!o),i=i.next}while(i!==t);return o}(t,n)&&(area(t.prev,t,n.prev)||area(t,n.prev,n))||equals(t,n)&&area(t.prev,t,t.next)>0&&area(n.prev,n,n.next)>0)}function area(t,n,i){return(n.y-t.y)*(i.x-n.x)-(n.x-t.x)*(i.y-n.y)}function equals(t,n){return t.x===n.x&&t.y===n.y}function intersects(t,n,i,o){const a=sign(area(t,n,i)),s=sign(area(t,n,o)),m=sign(area(i,o,t)),g=sign(area(i,o,n));return a!==s&&m!==g||!(0!==a||!onSegment(t,i,n))||!(0!==s||!onSegment(t,o,n))||!(0!==m||!onSegment(i,t,o))||!(0!==g||!onSegment(i,n,o))}function onSegment(t,n,i){return n.x<=Math.max(t.x,i.x)&&n.x>=Math.min(t.x,i.x)&&n.y<=Math.max(t.y,i.y)&&n.y>=Math.min(t.y,i.y)}function sign(t){return t>0?1:t<0?-1:0}function locallyInside(t,n){return area(t.prev,t,t.next)<0?area(t,n,t.next)>=0&&area(t,t.prev,n)>=0:area(t,n,t.prev)<0||area(t,t.next,n)<0}function splitPolygon(t,n){const i=new Node(t.i,t.x,t.y),o=new Node(n.i,n.x,n.y),a=t.next,s=n.prev;return t.next=n,n.prev=t,i.next=a,a.prev=i,o.next=i,i.prev=o,s.next=o,o.prev=s,o}function insertNode(t,n,i,o){const a=new Node(t,n,i);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,n,i){this.i=t,this.x=n,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const oa={area:function(t){const n=t.length;let i=0;for(let o=n-1,a=0;a<n;o=a++)i+=t[o].x*t[a].y-t[a].x*t[o].y;return.5*i},isClockWise:function(t){return oa.area(t)<0},triangulateShape:function(t,n){const i=[],o=[],a=[];removeDupEndPts(t),addContour(i,t);let s=t.length;n.forEach(removeDupEndPts);for(let t=0;t<n.length;t++)o.push(s),s+=n[t].length,addContour(i,n[t]);const m=function(t,n,i){i=i||2;const o=n&&n.length,a=o?n[0]*i:t.length;let s=linkedList(t,0,a,i,!0);const m=[];if(!s||s.next===s.prev)return m;let g,_,S,M,T,O,A;if(o&&(s=function eliminateHoles(t,n,i,o){const a=[];let s,m,g,_,S;for(s=0,m=n.length;s<m;s++)g=n[s]*o,_=s<m-1?n[s+1]*o:t.length,S=linkedList(t,g,_,o,!1),S===S.next&&(S.steiner=!0),a.push(getLeftmost(S));for(a.sort(compareX),s=0;s<a.length;s++)eliminateHole(a[s],i),i=filterPoints(i,i.next);return i}(t,n,s,i)),t.length>80*i){g=S=t[0],_=M=t[1];for(let n=i;n<a;n+=i)T=t[n],O=t[n+1],T<g&&(g=T),O<_&&(_=O),T>S&&(S=T),O>M&&(M=O);A=Math.max(S-g,M-_),A=0!==A?1/A:0}return earcutLinked(s,m,i,g,_,A),m}(i,o);for(let t=0;t<m.length;t+=3)a.push(m.slice(t,t+3));return a}};function removeDupEndPts(t){const n=t.length;n>2&&t[n-1].equals(t[0])&&t.pop()}function addContour(t,n){for(let i=0;i<n.length;i++)t.push(n[i].x),t.push(n[i].y)}class ExtrudeBufferGeometry extends BufferGeometry{constructor(t,n){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:n},t=Array.isArray(t)?t:[t];const i=this,o=[],a=[];for(let n=0,i=t.length;n<i;n++)addShape(t[n]);function addShape(t){const s=[],m=void 0!==n.curveSegments?n.curveSegments:12,g=void 0!==n.steps?n.steps:1;let _=void 0!==n.depth?n.depth:100,S=void 0===n.bevelEnabled||n.bevelEnabled,M=void 0!==n.bevelThickness?n.bevelThickness:6,T=void 0!==n.bevelSize?n.bevelSize:M-2,O=void 0!==n.bevelOffset?n.bevelOffset:0,A=void 0!==n.bevelSegments?n.bevelSegments:3;const P=n.extrudePath,L=void 0!==n.UVGenerator?n.UVGenerator:aa;void 0!==n.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),_=n.amount);let R,N,I,j,V,U=!1;P&&(R=P.getSpacedPoints(g),U=!0,S=!1,N=P.computeFrenetFrames(g,!1),I=new Vector3,j=new Vector3,V=new Vector3),S||(A=0,M=0,T=0,O=0);const G=t.extractPoints(m);let z=G.shape;const H=G.holes;if(!oa.isClockWise(z)){z=z.reverse();for(let t=0,n=H.length;t<n;t++){const n=H[t];oa.isClockWise(n)&&(H[t]=n.reverse())}}const q=oa.triangulateShape(z,H),Z=z;for(let t=0,n=H.length;t<n;t++){const n=H[t];z=z.concat(n)}function scalePt2(t,n,i){return n||console.error("THREE.ExtrudeGeometry: vec does not exist"),n.clone().multiplyScalar(i).add(t)}const X=z.length,Q=q.length;function getBevelVec(t,n,i){let o,a,s;const m=t.x-n.x,g=t.y-n.y,_=i.x-t.x,S=i.y-t.y,M=m*m+g*g,T=m*S-g*_;if(Math.abs(T)>Number.EPSILON){const T=Math.sqrt(M),O=Math.sqrt(_*_+S*S),A=n.x-g/T,P=n.y+m/T,L=((i.x-S/O-A)*S-(i.y+_/O-P)*_)/(m*S-g*_);o=A+m*L-t.x,a=P+g*L-t.y;const R=o*o+a*a;if(R<=2)return new Vector2(o,a);s=Math.sqrt(R/2)}else{let t=!1;m>Number.EPSILON?_>Number.EPSILON&&(t=!0):m<-Number.EPSILON?_<-Number.EPSILON&&(t=!0):Math.sign(g)===Math.sign(S)&&(t=!0),t?(o=-g,a=m,s=Math.sqrt(M)):(o=m,a=g,s=Math.sqrt(M/2))}return new Vector2(o/s,a/s)}const Y=[];for(let t=0,n=Z.length,i=n-1,o=t+1;t<n;t++,i++,o++)i===n&&(i=0),o===n&&(o=0),Y[t]=getBevelVec(Z[t],Z[i],Z[o]);const J=[];let K,$=Y.concat();for(let t=0,n=H.length;t<n;t++){const n=H[t];K=[];for(let t=0,i=n.length,o=i-1,a=t+1;t<i;t++,o++,a++)o===i&&(o=0),a===i&&(a=0),K[t]=getBevelVec(n[t],n[o],n[a]);J.push(K),$=$.concat(K)}for(let t=0;t<A;t++){const n=t/A,i=M*Math.cos(n*Math.PI/2),o=T*Math.sin(n*Math.PI/2)+O;for(let t=0,n=Z.length;t<n;t++){const n=scalePt2(Z[t],Y[t],o);v(n.x,n.y,-i)}for(let t=0,n=H.length;t<n;t++){const n=H[t];K=J[t];for(let t=0,a=n.length;t<a;t++){const a=scalePt2(n[t],K[t],o);v(a.x,a.y,-i)}}}const ee=T+O;for(let t=0;t<X;t++){const n=S?scalePt2(z[t],$[t],ee):z[t];U?(j.copy(N.normals[0]).multiplyScalar(n.x),I.copy(N.binormals[0]).multiplyScalar(n.y),V.copy(R[0]).add(j).add(I),v(V.x,V.y,V.z)):v(n.x,n.y,0)}for(let t=1;t<=g;t++)for(let n=0;n<X;n++){const i=S?scalePt2(z[n],$[n],ee):z[n];U?(j.copy(N.normals[t]).multiplyScalar(i.x),I.copy(N.binormals[t]).multiplyScalar(i.y),V.copy(R[t]).add(j).add(I),v(V.x,V.y,V.z)):v(i.x,i.y,_/g*t)}for(let t=A-1;t>=0;t--){const n=t/A,i=M*Math.cos(n*Math.PI/2),o=T*Math.sin(n*Math.PI/2)+O;for(let t=0,n=Z.length;t<n;t++){const n=scalePt2(Z[t],Y[t],o);v(n.x,n.y,_+i)}for(let t=0,n=H.length;t<n;t++){const n=H[t];K=J[t];for(let t=0,a=n.length;t<a;t++){const a=scalePt2(n[t],K[t],o);U?v(a.x,a.y+R[g-1].y,R[g-1].x+i):v(a.x,a.y,_+i)}}}function sidewalls(t,n){let i=t.length;for(;--i>=0;){const o=i;let a=i-1;a<0&&(a=t.length-1);for(let t=0,i=g+2*A;t<i;t++){const i=X*t,s=X*(t+1);f4(n+o+i,n+a+i,n+a+s,n+o+s)}}}function v(t,n,i){s.push(t),s.push(n),s.push(i)}function f3(t,n,a){addVertex(t),addVertex(n),addVertex(a);const s=o.length/3,m=L.generateTopUV(i,o,s-3,s-2,s-1);addUV(m[0]),addUV(m[1]),addUV(m[2])}function f4(t,n,a,s){addVertex(t),addVertex(n),addVertex(s),addVertex(n),addVertex(a),addVertex(s);const m=o.length/3,g=L.generateSideWallUV(i,o,m-6,m-3,m-2,m-1);addUV(g[0]),addUV(g[1]),addUV(g[3]),addUV(g[1]),addUV(g[2]),addUV(g[3])}function addVertex(t){o.push(s[3*t+0]),o.push(s[3*t+1]),o.push(s[3*t+2])}function addUV(t){a.push(t.x),a.push(t.y)}!function buildLidFaces(){const t=o.length/3;if(S){let t=0,n=X*t;for(let t=0;t<Q;t++){const i=q[t];f3(i[2]+n,i[1]+n,i[0]+n)}t=g+2*A,n=X*t;for(let t=0;t<Q;t++){const i=q[t];f3(i[0]+n,i[1]+n,i[2]+n)}}else{for(let t=0;t<Q;t++){const n=q[t];f3(n[2],n[1],n[0])}for(let t=0;t<Q;t++){const n=q[t];f3(n[0]+X*g,n[1]+X*g,n[2]+X*g)}}i.addGroup(t,o.length/3-t,0)}(),function buildSideFaces(){const t=o.length/3;let n=0;sidewalls(Z,n),n+=Z.length;for(let t=0,i=H.length;t<i;t++){const i=H[t];sidewalls(i,n),n+=i.length}i.addGroup(t,o.length/3-t,1)}()}this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2)),this.computeVertexNormals()}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this);return function toJSON(t,n,i){if(i.shapes=[],Array.isArray(t))for(let n=0,o=t.length;n<o;n++){const o=t[n];i.shapes.push(o.uuid)}else i.shapes.push(t.uuid);return void 0!==n.extrudePath&&(i.options.extrudePath=n.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,t)}}const aa={generateTopUV:function(t,n,i,o,a){const s=n[3*i],m=n[3*i+1],g=n[3*o],_=n[3*o+1],S=n[3*a],M=n[3*a+1];return[new Vector2(s,m),new Vector2(g,_),new Vector2(S,M)]},generateSideWallUV:function(t,n,i,o,a,s){const m=n[3*i],g=n[3*i+1],_=n[3*i+2],S=n[3*o],M=n[3*o+1],T=n[3*o+2],O=n[3*a],A=n[3*a+1],P=n[3*a+2],L=n[3*s],R=n[3*s+1],N=n[3*s+2];return Math.abs(g-M)<.01?[new Vector2(m,1-_),new Vector2(S,1-T),new Vector2(O,1-P),new Vector2(L,1-N)]:[new Vector2(g,1-_),new Vector2(M,1-T),new Vector2(A,1-P),new Vector2(R,1-N)]}};class ExtrudeGeometry extends Geometry{constructor(t,n){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:n},this.fromBufferGeometry(new ExtrudeBufferGeometry(t,n)),this.mergeVertices()}toJSON(){const t=super.toJSON();return function toJSON$1(t,n,i){if(i.shapes=[],Array.isArray(t))for(let n=0,o=t.length;n<o;n++){const o=t[n];i.shapes.push(o.uuid)}else i.shapes.push(t.uuid);return void 0!==n.extrudePath&&(i.options.extrudePath=n.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,t)}}class IcosahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t=1,n=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,n),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:n}}}class IcosahedronGeometry extends Geometry{constructor(t,n){super(),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:n},this.fromBufferGeometry(new IcosahedronBufferGeometry(t,n)),this.mergeVertices()}}class LatheBufferGeometry extends BufferGeometry{constructor(t,n=12,i=0,o=2*Math.PI){super(),this.type="LatheBufferGeometry",this.parameters={points:t,segments:n,phiStart:i,phiLength:o},n=Math.floor(n),o=ar.clamp(o,0,2*Math.PI);const a=[],s=[],m=[],g=1/n,_=new Vector3,S=new Vector2;for(let a=0;a<=n;a++){const M=i+a*g*o,T=Math.sin(M),O=Math.cos(M);for(let i=0;i<=t.length-1;i++)_.x=t[i].x*T,_.y=t[i].y,_.z=t[i].x*O,s.push(_.x,_.y,_.z),S.x=a/n,S.y=i/(t.length-1),m.push(S.x,S.y)}for(let i=0;i<n;i++)for(let n=0;n<t.length-1;n++){const o=n+i*t.length,s=o,m=o+t.length,g=o+t.length+1,_=o+1;a.push(s,m,_),a.push(m,g,_)}if(this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2)),this.computeVertexNormals(),o===2*Math.PI){const i=this.attributes.normal.array,o=new Vector3,a=new Vector3,s=new Vector3,m=n*t.length*3;for(let n=0,g=0;n<t.length;n++,g+=3)o.x=i[g+0],o.y=i[g+1],o.z=i[g+2],a.x=i[m+g+0],a.y=i[m+g+1],a.z=i[m+g+2],s.addVectors(o,a).normalize(),i[g+0]=i[m+g+0]=s.x,i[g+1]=i[m+g+1]=s.y,i[g+2]=i[m+g+2]=s.z}}}class LatheGeometry extends Geometry{constructor(t,n,i,o){super(),this.type="LatheGeometry",this.parameters={points:t,segments:n,phiStart:i,phiLength:o},this.fromBufferGeometry(new LatheBufferGeometry(t,n,i,o)),this.mergeVertices()}}class OctahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t=1,n=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,n),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:n}}}class OctahedronGeometry extends Geometry{constructor(t,n){super(),this.type="OctahedronGeometry",this.parameters={radius:t,detail:n},this.fromBufferGeometry(new OctahedronBufferGeometry(t,n)),this.mergeVertices()}}function ParametricBufferGeometry(t,n,i){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:n,stacks:i};const o=[],a=[],s=[],m=[],g=1e-5,_=new Vector3,S=new Vector3,M=new Vector3,T=new Vector3,O=new Vector3;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const A=n+1;for(let o=0;o<=i;o++){const A=o/i;for(let i=0;i<=n;i++){const o=i/n;t(o,A,S),a.push(S.x,S.y,S.z),o-g>=0?(t(o-g,A,M),T.subVectors(S,M)):(t(o+g,A,M),T.subVectors(M,S)),A-g>=0?(t(o,A-g,M),O.subVectors(S,M)):(t(o,A+g,M),O.subVectors(M,S)),_.crossVectors(T,O).normalize(),s.push(_.x,_.y,_.z),m.push(o,A)}}for(let t=0;t<i;t++)for(let i=0;i<n;i++){const n=t*A+i,a=t*A+i+1,s=(t+1)*A+i+1,m=(t+1)*A+i;o.push(n,a,m),o.push(a,s,m)}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2))}function ParametricGeometry(t,n,i){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:n,stacks:i},this.fromBufferGeometry(new ParametricBufferGeometry(t,n,i)),this.mergeVertices()}ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry,ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry;class PlaneGeometry extends Geometry{constructor(t,n,i,o){super(),this.type="PlaneGeometry",this.parameters={width:t,height:n,widthSegments:i,heightSegments:o},this.fromBufferGeometry(new PlaneBufferGeometry(t,n,i,o)),this.mergeVertices()}}class PolyhedronGeometry extends Geometry{constructor(t,n,i,o){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:n,radius:i,detail:o},this.fromBufferGeometry(new PolyhedronBufferGeometry(t,n,i,o)),this.mergeVertices()}}class RingBufferGeometry extends BufferGeometry{constructor(t=.5,n=1,i=8,o=1,a=0,s=2*Math.PI){super(),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:n,thetaSegments:i,phiSegments:o,thetaStart:a,thetaLength:s},i=Math.max(3,i);const m=[],g=[],_=[],S=[];let M=t;const T=(n-t)/(o=Math.max(1,o)),O=new Vector3,A=new Vector2;for(let t=0;t<=o;t++){for(let t=0;t<=i;t++){const o=a+t/i*s;O.x=M*Math.cos(o),O.y=M*Math.sin(o),g.push(O.x,O.y,O.z),_.push(0,0,1),A.x=(O.x/n+1)/2,A.y=(O.y/n+1)/2,S.push(A.x,A.y)}M+=T}for(let t=0;t<o;t++){const n=t*(i+1);for(let t=0;t<i;t++){const o=t+n,a=o,s=o+i+1,g=o+i+2,_=o+1;m.push(a,s,_),m.push(s,g,_)}}this.setIndex(m),this.setAttribute("position",new Float32BufferAttribute(g,3)),this.setAttribute("normal",new Float32BufferAttribute(_,3)),this.setAttribute("uv",new Float32BufferAttribute(S,2))}}class RingGeometry extends Geometry{constructor(t,n,i,o,a,s){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:n,thetaSegments:i,phiSegments:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new RingBufferGeometry(t,n,i,o,a,s)),this.mergeVertices()}}class ShapeBufferGeometry extends BufferGeometry{constructor(t,n=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:n};const i=[],o=[],a=[],s=[];let m=0,g=0;if(!1===Array.isArray(t))addShape(t);else for(let n=0;n<t.length;n++)addShape(t[n]),this.addGroup(m,g,n),m+=g,g=0;function addShape(t){const m=o.length/3,_=t.extractPoints(n);let S=_.shape;const M=_.holes;!1===oa.isClockWise(S)&&(S=S.reverse());for(let t=0,n=M.length;t<n;t++){const n=M[t];!0===oa.isClockWise(n)&&(M[t]=n.reverse())}const T=oa.triangulateShape(S,M);for(let t=0,n=M.length;t<n;t++){const n=M[t];S=S.concat(n)}for(let t=0,n=S.length;t<n;t++){const n=S[t];o.push(n.x,n.y,0),a.push(0,0,1),s.push(n.x,n.y)}for(let t=0,n=T.length;t<n;t++){const n=T[t],o=n[0]+m,a=n[1]+m,s=n[2]+m;i.push(o,a,s),g+=3}}this.setIndex(i),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2))}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this);return function toJSON$2(t,n){if(n.shapes=[],Array.isArray(t))for(let i=0,o=t.length;i<o;i++){const o=t[i];n.shapes.push(o.uuid)}else n.shapes.push(t.uuid);return n}(this.parameters.shapes,t)}}class ShapeGeometry extends Geometry{constructor(t,n){super(),this.type="ShapeGeometry","object"==typeof n&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),n=n.curveSegments),this.parameters={shapes:t,curveSegments:n},this.fromBufferGeometry(new ShapeBufferGeometry(t,n)),this.mergeVertices()}toJSON(){const t=Geometry.prototype.toJSON.call(this);return function toJSON$3(t,n){if(n.shapes=[],Array.isArray(t))for(let i=0,o=t.length;i<o;i++){const o=t[i];n.shapes.push(o.uuid)}else n.shapes.push(t.uuid);return n}(this.parameters.shapes,t)}}class SphereBufferGeometry extends BufferGeometry{constructor(t=1,n=8,i=6,o=0,a=2*Math.PI,s=0,m=Math.PI){super(),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:n,heightSegments:i,phiStart:o,phiLength:a,thetaStart:s,thetaLength:m},n=Math.max(3,Math.floor(n)),i=Math.max(2,Math.floor(i));const g=Math.min(s+m,Math.PI);let _=0;const S=[],M=new Vector3,T=new Vector3,O=[],A=[],P=[],L=[];for(let O=0;O<=i;O++){const R=[],N=O/i;let I=0;0==O&&0==s?I=.5/n:O==i&&g==Math.PI&&(I=-.5/n);for(let i=0;i<=n;i++){const g=i/n;M.x=-t*Math.cos(o+g*a)*Math.sin(s+N*m),M.y=t*Math.cos(s+N*m),M.z=t*Math.sin(o+g*a)*Math.sin(s+N*m),A.push(M.x,M.y,M.z),T.copy(M).normalize(),P.push(T.x,T.y,T.z),L.push(g+I,1-N),R.push(_++)}S.push(R)}for(let t=0;t<i;t++)for(let o=0;o<n;o++){const n=S[t][o+1],a=S[t][o],m=S[t+1][o],_=S[t+1][o+1];(0!==t||s>0)&&O.push(n,a,_),(t!==i-1||g<Math.PI)&&O.push(a,m,_)}this.setIndex(O),this.setAttribute("position",new Float32BufferAttribute(A,3)),this.setAttribute("normal",new Float32BufferAttribute(P,3)),this.setAttribute("uv",new Float32BufferAttribute(L,2))}}class SphereGeometry extends Geometry{constructor(t,n,i,o,a,s,m){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:n,heightSegments:i,phiStart:o,phiLength:a,thetaStart:s,thetaLength:m},this.fromBufferGeometry(new SphereBufferGeometry(t,n,i,o,a,s,m)),this.mergeVertices()}}class TetrahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t=1,n=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,n),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:n}}}class TetrahedronGeometry extends Geometry{constructor(t,n){super(),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:n},this.fromBufferGeometry(new TetrahedronBufferGeometry(t,n)),this.mergeVertices()}}class TextBufferGeometry extends ExtrudeBufferGeometry{constructor(t,n={}){const i=n.font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new BufferGeometry;const o=i.generateShapes(t,n.size);n.depth=void 0!==n.height?n.height:50,void 0===n.bevelThickness&&(n.bevelThickness=10),void 0===n.bevelSize&&(n.bevelSize=8),void 0===n.bevelEnabled&&(n.bevelEnabled=!1),super(o,n),this.type="TextBufferGeometry"}}class TextGeometry extends Geometry{constructor(t,n){super(),this.type="TextGeometry",this.parameters={text:t,parameters:n},this.fromBufferGeometry(new TextBufferGeometry(t,n)),this.mergeVertices()}}class TorusBufferGeometry extends BufferGeometry{constructor(t=1,n=.4,i=8,o=6,a=2*Math.PI){super(),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:n,radialSegments:i,tubularSegments:o,arc:a},i=Math.floor(i),o=Math.floor(o);const s=[],m=[],g=[],_=[],S=new Vector3,M=new Vector3,T=new Vector3;for(let s=0;s<=i;s++)for(let O=0;O<=o;O++){const A=O/o*a,P=s/i*Math.PI*2;M.x=(t+n*Math.cos(P))*Math.cos(A),M.y=(t+n*Math.cos(P))*Math.sin(A),M.z=n*Math.sin(P),m.push(M.x,M.y,M.z),S.x=t*Math.cos(A),S.y=t*Math.sin(A),T.subVectors(M,S).normalize(),g.push(T.x,T.y,T.z),_.push(O/o),_.push(s/i)}for(let t=1;t<=i;t++)for(let n=1;n<=o;n++){const i=(o+1)*t+n-1,a=(o+1)*(t-1)+n-1,m=(o+1)*(t-1)+n,g=(o+1)*t+n;s.push(i,a,g),s.push(a,m,g)}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(g,3)),this.setAttribute("uv",new Float32BufferAttribute(_,2))}}class TorusGeometry extends Geometry{constructor(t,n,i,o,a){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:n,radialSegments:i,tubularSegments:o,arc:a},this.fromBufferGeometry(new TorusBufferGeometry(t,n,i,o,a)),this.mergeVertices()}}class TorusKnotBufferGeometry extends BufferGeometry{constructor(t=1,n=.4,i=64,o=8,a=2,s=3){super(),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:n,tubularSegments:i,radialSegments:o,p:a,q:s},i=Math.floor(i),o=Math.floor(o);const m=[],g=[],_=[],S=[],M=new Vector3,T=new Vector3,O=new Vector3,A=new Vector3,P=new Vector3,L=new Vector3,R=new Vector3;for(let m=0;m<=i;++m){const N=m/i*a*Math.PI*2;calculatePositionOnCurve(N,a,s,t,O),calculatePositionOnCurve(N+.01,a,s,t,A),L.subVectors(A,O),R.addVectors(A,O),P.crossVectors(L,R),R.crossVectors(P,L),P.normalize(),R.normalize();for(let t=0;t<=o;++t){const a=t/o*Math.PI*2,s=-n*Math.cos(a),A=n*Math.sin(a);M.x=O.x+(s*R.x+A*P.x),M.y=O.y+(s*R.y+A*P.y),M.z=O.z+(s*R.z+A*P.z),g.push(M.x,M.y,M.z),T.subVectors(M,O).normalize(),_.push(T.x,T.y,T.z),S.push(m/i),S.push(t/o)}}for(let t=1;t<=i;t++)for(let n=1;n<=o;n++){const i=(o+1)*(t-1)+(n-1),a=(o+1)*t+(n-1),s=(o+1)*t+n,g=(o+1)*(t-1)+n;m.push(i,a,g),m.push(a,s,g)}function calculatePositionOnCurve(t,n,i,o,a){const s=Math.cos(t),m=Math.sin(t),g=i/n*t,_=Math.cos(g);a.x=o*(2+_)*.5*s,a.y=o*(2+_)*m*.5,a.z=o*Math.sin(g)*.5}this.setIndex(m),this.setAttribute("position",new Float32BufferAttribute(g,3)),this.setAttribute("normal",new Float32BufferAttribute(_,3)),this.setAttribute("uv",new Float32BufferAttribute(S,2))}}class TorusKnotGeometry extends Geometry{constructor(t,n,i,o,a,s,m){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:n,tubularSegments:i,radialSegments:o,p:a,q:s},void 0!==m&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(t,n,i,o,a,s)),this.mergeVertices()}}class TubeBufferGeometry extends BufferGeometry{constructor(t,n=64,i=1,o=8,a=!1){super(),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:n,radius:i,radialSegments:o,closed:a};const s=t.computeFrenetFrames(n,a);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const m=new Vector3,g=new Vector3,_=new Vector2;let S=new Vector3;const M=[],T=[],O=[],A=[];function generateSegment(a){S=t.getPointAt(a/n,S);const _=s.normals[a],O=s.binormals[a];for(let t=0;t<=o;t++){const n=t/o*Math.PI*2,a=Math.sin(n),s=-Math.cos(n);g.x=s*_.x+a*O.x,g.y=s*_.y+a*O.y,g.z=s*_.z+a*O.z,g.normalize(),T.push(g.x,g.y,g.z),m.x=S.x+i*g.x,m.y=S.y+i*g.y,m.z=S.z+i*g.z,M.push(m.x,m.y,m.z)}}!function generateBufferData(){for(let t=0;t<n;t++)generateSegment(t);generateSegment(!1===a?n:0),function generateUVs(){for(let t=0;t<=n;t++)for(let i=0;i<=o;i++)_.x=t/n,_.y=i/o,O.push(_.x,_.y)}(),function generateIndices(){for(let t=1;t<=n;t++)for(let n=1;n<=o;n++){const i=(o+1)*(t-1)+(n-1),a=(o+1)*t+(n-1),s=(o+1)*t+n,m=(o+1)*(t-1)+n;A.push(i,a,m),A.push(a,s,m)}}()}(),this.setIndex(A),this.setAttribute("position",new Float32BufferAttribute(M,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(O,2))}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t}}class TubeGeometry extends Geometry{constructor(t,n,i,o,a,s){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:n,radius:i,radialSegments:o,closed:a},void 0!==s&&console.warn("THREE.TubeGeometry: taper has been removed.");const m=new TubeBufferGeometry(t,n,i,o,a);this.tangents=m.tangents,this.normals=m.normals,this.binormals=m.binormals,this.fromBufferGeometry(m),this.mergeVertices()}}class WireframeGeometry extends BufferGeometry{constructor(t){super(),this.type="WireframeGeometry";const n=[],i=[0,0],o={},a=["a","b","c"];if(t&&t.isGeometry){const s=t.faces;for(let t=0,n=s.length;t<n;t++){const n=s[t];for(let t=0;t<3;t++){const s=n[a[t]],m=n[a[(t+1)%3]];i[0]=Math.min(s,m),i[1]=Math.max(s,m);const g=i[0]+","+i[1];void 0===o[g]&&(o[g]={index1:i[0],index2:i[1]})}}for(const i in o){const a=o[i];let s=t.vertices[a.index1];n.push(s.x,s.y,s.z),s=t.vertices[a.index2],n.push(s.x,s.y,s.z)}}else if(t&&t.isBufferGeometry){const a=new Vector3;if(null!==t.index){const s=t.attributes.position,m=t.index;let g=t.groups;0===g.length&&(g=[{start:0,count:m.count,materialIndex:0}]);for(let t=0,n=g.length;t<n;++t){const n=g[t],a=n.start;for(let t=a,s=a+n.count;t<s;t+=3)for(let n=0;n<3;n++){const a=m.getX(t+n),s=m.getX(t+(n+1)%3);i[0]=Math.min(a,s),i[1]=Math.max(a,s);const g=i[0]+","+i[1];void 0===o[g]&&(o[g]={index1:i[0],index2:i[1]})}}for(const t in o){const i=o[t];a.fromBufferAttribute(s,i.index1),n.push(a.x,a.y,a.z),a.fromBufferAttribute(s,i.index2),n.push(a.x,a.y,a.z)}}else{const i=t.attributes.position;for(let t=0,o=i.count/3;t<o;t++)for(let o=0;o<3;o++){const s=3*t+o;a.fromBufferAttribute(i,s),n.push(a.x,a.y,a.z);const m=3*t+(o+1)%3;a.fromBufferAttribute(i,m),n.push(a.x,a.y,a.z)}}}this.setAttribute("position",new Float32BufferAttribute(n,3))}}var sa=Object.freeze({__proto__:null,BoxGeometry,BoxBufferGeometry,CircleGeometry,CircleBufferGeometry,ConeGeometry,ConeBufferGeometry,CylinderGeometry,CylinderBufferGeometry,DodecahedronGeometry,DodecahedronBufferGeometry,EdgesGeometry,ExtrudeGeometry,ExtrudeBufferGeometry,IcosahedronGeometry,IcosahedronBufferGeometry,LatheGeometry,LatheBufferGeometry,OctahedronGeometry,OctahedronBufferGeometry,ParametricGeometry,ParametricBufferGeometry,PlaneGeometry,PlaneBufferGeometry,PolyhedronGeometry,PolyhedronBufferGeometry,RingGeometry,RingBufferGeometry,ShapeGeometry,ShapeBufferGeometry,SphereGeometry,SphereBufferGeometry,TetrahedronGeometry,TetrahedronBufferGeometry,TextGeometry,TextBufferGeometry,TorusGeometry,TorusBufferGeometry,TorusKnotGeometry,TorusKnotBufferGeometry,TubeGeometry,TubeBufferGeometry,WireframeGeometry});function ShadowMaterial(t){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(t)}function RawShaderMaterial(t){ShaderMaterial.call(this,t),this.type="RawShaderMaterial"}function MeshStandardMaterial(t){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=An,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function MeshPhysicalMaterial(t){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=ar.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function MeshPhongMaterial(t){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=An,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ge,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshToonMaterial(t){Material.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=An,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshNormalMaterial(t){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=An,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshLambertMaterial(t){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ge,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshMatcapMaterial(t){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=An,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function LineDashedMaterial(t){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(t){return MeshStandardMaterial.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new Color).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshToonMaterial.prototype=Object.create(Material.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshMatcapMaterial.prototype=Object.create(Material.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(t){return LineBasicMaterial.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var ca=Object.freeze({__proto__:null,ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material});const ua={arraySlice:function(t,n,i){return ua.isTypedArray(t)?new t.constructor(t.subarray(n,void 0!==i?i:t.length)):t.slice(n,i)},convertArray:function(t,n,i){return!t||!i&&t.constructor===n?t:"number"==typeof n.BYTES_PER_ELEMENT?new n(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const n=t.length,i=new Array(n);for(let t=0;t!==n;++t)i[t]=t;return i.sort((function compareTime(n,i){return t[n]-t[i]})),i},sortedArray:function(t,n,i){const o=t.length,a=new t.constructor(o);for(let s=0,m=0;m!==o;++s){const o=i[s]*n;for(let i=0;i!==n;++i)a[m++]=t[o+i]}return a},flattenJSON:function(t,n,i,o){let a=1,s=t[0];for(;void 0!==s&&void 0===s[o];)s=t[a++];if(void 0===s)return;let m=s[o];if(void 0!==m)if(Array.isArray(m))do{m=s[o],void 0!==m&&(n.push(s.time),i.push.apply(i,m)),s=t[a++]}while(void 0!==s);else if(void 0!==m.toArray)do{m=s[o],void 0!==m&&(n.push(s.time),m.toArray(i,i.length)),s=t[a++]}while(void 0!==s);else do{m=s[o],void 0!==m&&(n.push(s.time),i.push(m)),s=t[a++]}while(void 0!==s)},subclip:function(t,n,i,o,a=30){const s=t.clone();s.name=n;const m=[];for(let t=0;t<s.tracks.length;++t){const n=s.tracks[t],g=n.getValueSize(),_=[],S=[];for(let t=0;t<n.times.length;++t){const s=n.times[t]*a;if(!(s<i||s>=o)){_.push(n.times[t]);for(let i=0;i<g;++i)S.push(n.values[t*g+i])}}0!==_.length&&(n.times=ua.convertArray(_,n.times.constructor),n.values=ua.convertArray(S,n.values.constructor),m.push(n))}s.tracks=m;let g=1/0;for(let t=0;t<s.tracks.length;++t)g>s.tracks[t].times[0]&&(g=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*g);return s.resetDuration(),s},makeClipAdditive:function(t,n=0,i=t,o=30){o<=0&&(o=30);const a=i.tracks.length,s=n/o;for(let n=0;n<a;++n){const o=i.tracks[n],a=o.ValueTypeName;if("bool"===a||"string"===a)continue;const m=t.tracks.find((function(t){return t.name===o.name&&t.ValueTypeName===a}));if(void 0===m)continue;let g=0;const _=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=_/3);let S=0;const M=m.getValueSize();m.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(S=M/3);const T=o.times.length-1;let O;if(s<=o.times[0]){const t=g,n=_-g;O=ua.arraySlice(o.values,t,n)}else if(s>=o.times[T]){const t=T*_+g,n=t+_-g;O=ua.arraySlice(o.values,t,n)}else{const t=o.createInterpolant(),n=g,i=_-g;t.evaluate(s),O=ua.arraySlice(t.resultBuffer,n,i)}"quaternion"===a&&(new Quaternion).fromArray(O).normalize().conjugate().toArray(O);const A=m.times.length;for(let t=0;t<A;++t){const n=t*M+S;if("quaternion"===a)Quaternion.multiplyQuaternionsFlat(m.values,n,O,0,m.values,n);else{const t=M-2*S;for(let i=0;i<t;++i)m.values[n+i]-=O[i]}}}return t.blendMode=mn,t}};function Interpolant(t,n,i,o){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==o?o:new n.constructor(i),this.sampleValues=n,this.valueSize=i}function CubicInterpolant(t,n,i,o){Interpolant.call(this,t,n,i,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(t,n,i,o){Interpolant.call(this,t,n,i,o)}function DiscreteInterpolant(t,n,i,o){Interpolant.call(this,t,n,i,o)}function KeyframeTrack(t,n,i,o){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ua.convertArray(n,this.TimeBufferType),this.values=ua.convertArray(i,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}function BooleanKeyframeTrack(t,n,i){KeyframeTrack.call(this,t,n,i)}function ColorKeyframeTrack(t,n,i,o){KeyframeTrack.call(this,t,n,i,o)}function NumberKeyframeTrack(t,n,i,o){KeyframeTrack.call(this,t,n,i,o)}function QuaternionLinearInterpolant(t,n,i,o){Interpolant.call(this,t,n,i,o)}function QuaternionKeyframeTrack(t,n,i,o){KeyframeTrack.call(this,t,n,i,o)}function StringKeyframeTrack(t,n,i,o){KeyframeTrack.call(this,t,n,i,o)}function VectorKeyframeTrack(t,n,i,o){KeyframeTrack.call(this,t,n,i,o)}function AnimationClip(t,n=-1,i,o=fn){this.name=t,this.tracks=i,this.duration=n,this.blendMode=o,this.uuid=ar.generateUUID(),this.duration<0&&this.resetDuration()}function parseKeyframeTrack(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const n=function getTrackTypeForValueTypeName(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const n=[],i=[];ua.flattenJSON(t.keys,n,i,"value"),t.times=n,t.values=i}return void 0!==n.parse?n.parse(t):new n(t.name,t.times,t.values,t.interpolation)}Object.assign(Interpolant.prototype,{evaluate:function(t){const n=this.parameterPositions;let i=this._cachedIndex,o=n[i],a=n[i-1];e:{t:{let s;n:{r:if(!(t<o)){for(let s=i+2;;){if(void 0===o){if(t<a)break r;return i=n.length,this._cachedIndex=i,this.afterEnd_(i-1,t,a)}if(i===s)break;if(a=o,o=n[++i],t<o)break t}s=n.length;break n}if(t>=a)break e;{const m=n[1];t<m&&(i=2,a=m);for(let s=i-2;;){if(void 0===a)return this._cachedIndex=0,this.beforeStart_(0,t,o);if(i===s)break;if(o=a,a=n[--i-1],t>=a)break t}s=i,i=0}}for(;i<s;){const o=i+s>>>1;t<n[o]?s=o:i=o+1}if(o=n[i],a=n[i-1],void 0===a)return this._cachedIndex=0,this.beforeStart_(0,t,o);if(void 0===o)return i=n.length,this._cachedIndex=i,this.afterEnd_(i-1,a,t)}this._cachedIndex=i,this.intervalChanged_(i,a,o)}return this.interpolate_(i,a,t,o)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const n=this.resultBuffer,i=this.sampleValues,o=this.valueSize,a=t*o;for(let t=0;t!==o;++t)n[t]=i[a+t];return n},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:hn,endingEnd:hn},intervalChanged_:function(t,n,i){const o=this.parameterPositions;let a=t-2,s=t+1,m=o[a],g=o[s];if(void 0===m)switch(this.getSettings_().endingStart){case dn:a=t,m=2*n-i;break;case pn:a=o.length-2,m=n+o[a]-o[a+1];break;default:a=t,m=i}if(void 0===g)switch(this.getSettings_().endingEnd){case dn:s=t,g=2*i-n;break;case pn:s=1,g=i+o[1]-o[0];break;default:s=t-1,g=n}const _=.5*(i-n),S=this.valueSize;this._weightPrev=_/(n-m),this._weightNext=_/(g-i),this._offsetPrev=a*S,this._offsetNext=s*S},interpolate_:function(t,n,i,o){const a=this.resultBuffer,s=this.sampleValues,m=this.valueSize,g=t*m,_=g-m,S=this._offsetPrev,M=this._offsetNext,T=this._weightPrev,O=this._weightNext,A=(i-n)/(o-n),P=A*A,L=P*A,R=-T*L+2*T*P-T*A,N=(1+T)*L+(-1.5-2*T)*P+(-.5+T)*A+1,I=(-1-O)*L+(1.5+O)*P+.5*A,j=O*L-O*P;for(let t=0;t!==m;++t)a[t]=R*s[S+t]+N*s[_+t]+I*s[g+t]+j*s[M+t];return a}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(t,n,i,o){const a=this.resultBuffer,s=this.sampleValues,m=this.valueSize,g=t*m,_=g-m,S=(i-n)/(o-n),M=1-S;for(let t=0;t!==m;++t)a[t]=s[_+t]*M+s[g+t]*S;return a}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(KeyframeTrack,{toJSON:function(t){const n=t.constructor;let i;if(void 0!==n.toJSON)i=n.toJSON(t);else{i={name:t.name,times:ua.convertArray(t.times,Array),values:ua.convertArray(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(i.interpolation=n)}return i.type=t.ValueTypeName,i}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:un,InterpolantFactoryMethodDiscrete:function(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let n;switch(t){case cn:n=this.InterpolantFactoryMethodDiscrete;break;case un:n=this.InterpolantFactoryMethodLinear;break;case ln:n=this.InterpolantFactoryMethodSmooth}if(void 0===n){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=n,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return cn;case this.InterpolantFactoryMethodLinear:return un;case this.InterpolantFactoryMethodSmooth:return ln}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const n=this.times;for(let i=0,o=n.length;i!==o;++i)n[i]+=t}return this},scale:function(t){if(1!==t){const n=this.times;for(let i=0,o=n.length;i!==o;++i)n[i]*=t}return this},trim:function(t,n){const i=this.times,o=i.length;let a=0,s=o-1;for(;a!==o&&i[a]<t;)++a;for(;-1!==s&&i[s]>n;)--s;if(++s,0!==a||s!==o){a>=s&&(s=Math.max(s,1),a=s-1);const t=this.getValueSize();this.times=ua.arraySlice(i,a,s),this.values=ua.arraySlice(this.values,a*t,s*t)}return this},validate:function(){let t=!0;const n=this.getValueSize();n-Math.floor(n)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,o=this.values,a=i.length;0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let n=0;n!==a;n++){const o=i[n];if("number"==typeof o&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,n,o),t=!1;break}if(null!==s&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,n,o,s),t=!1;break}s=o}if(void 0!==o&&ua.isTypedArray(o))for(let n=0,i=o.length;n!==i;++n){const i=o[n];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,n,i),t=!1;break}}return t},optimize:function(){const t=ua.arraySlice(this.times),n=ua.arraySlice(this.values),i=this.getValueSize(),o=this.getInterpolation()===ln,a=t.length-1;let s=1;for(let m=1;m<a;++m){let a=!1;const g=t[m];if(g!==t[m+1]&&(1!==m||g!==g[0]))if(o)a=!0;else{const t=m*i,o=t-i,s=t+i;for(let m=0;m!==i;++m){const i=n[t+m];if(i!==n[o+m]||i!==n[s+m]){a=!0;break}}}if(a){if(m!==s){t[s]=t[m];const o=m*i,a=s*i;for(let t=0;t!==i;++t)n[a+t]=n[o+t]}++s}}if(a>0){t[s]=t[a];for(let t=a*i,o=s*i,m=0;m!==i;++m)n[o+m]=n[t+m];++s}return s!==t.length?(this.times=ua.arraySlice(t,0,s),this.values=ua.arraySlice(n,0,s*i)):(this.times=t,this.values=n),this},clone:function(){const t=ua.arraySlice(this.times,0),n=ua.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,n);return i.createInterpolant=this.createInterpolant,i}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:cn,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(t,n,i,o){const a=this.resultBuffer,s=this.sampleValues,m=this.valueSize,g=(i-n)/(o-n);let _=t*m;for(let t=_+m;_!==t;_+=4)Quaternion.slerpFlat(a,0,s,_-m,s,_,g);return a}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:un,InterpolantFactoryMethodLinear:function(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:cn,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(t){const n=[],i=t.tracks,o=1/(t.fps||1);for(let t=0,a=i.length;t!==a;++t)n.push(parseKeyframeTrack(i[t]).scale(o));const a=new AnimationClip(t.name,t.duration,n,t.blendMode);return a.uuid=t.uuid,a},toJSON:function(t){const n=[],i=t.tracks,o={name:t.name,duration:t.duration,tracks:n,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,o=i.length;t!==o;++t)n.push(KeyframeTrack.toJSON(i[t]));return o},CreateFromMorphTargetSequence:function(t,n,i,o){const a=n.length,s=[];for(let t=0;t<a;t++){let m=[],g=[];m.push((t+a-1)%a,t,(t+1)%a),g.push(0,1,0);const _=ua.getKeyframeOrder(m);m=ua.sortedArray(m,1,_),g=ua.sortedArray(g,1,_),o||0!==m[0]||(m.push(a),g.push(g[0])),s.push(new NumberKeyframeTrack(".morphTargetInfluences["+n[t].name+"]",m,g).scale(1/i))}return new AnimationClip(t,-1,s)},findByName:function(t,n){let i=t;if(!Array.isArray(t)){const n=t;i=n.geometry&&n.geometry.animations||n.animations}for(let t=0;t<i.length;t++)if(i[t].name===n)return i[t];return null},CreateClipsFromMorphTargetSequences:function(t,n,i){const o={},a=/^([\w-]*?)([\d]+)$/;for(let n=0,i=t.length;n<i;n++){const i=t[n],s=i.name.match(a);if(s&&s.length>1){const t=s[1];let n=o[t];n||(o[t]=n=[]),n.push(i)}}const s=[];for(const t in o)s.push(AnimationClip.CreateFromMorphTargetSequence(t,o[t],n,i));return s},parseAnimation:function(t,n){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const addNonemptyTrack=function(t,n,i,o,a){if(0!==i.length){const s=[],m=[];ua.flattenJSON(i,s,m,o),0!==s.length&&a.push(new t(n,s,m))}},i=[],o=t.name||"default",a=t.fps||30,s=t.blendMode;let m=t.length||-1;const g=t.hierarchy||[];for(let t=0;t<g.length;t++){const o=g[t].keys;if(o&&0!==o.length)if(o[0].morphTargets){const t={};let n;for(n=0;n<o.length;n++)if(o[n].morphTargets)for(let i=0;i<o[n].morphTargets.length;i++)t[o[n].morphTargets[i]]=-1;for(const a in t){const t=[],s=[];for(let i=0;i!==o[n].morphTargets.length;++i){const i=o[n];t.push(i.time),s.push(i.morphTarget===a?1:0)}i.push(new NumberKeyframeTrack(".morphTargetInfluence["+a+"]",t,s))}m=t.length*(a||1)}else{const a=".bones["+n[t].name+"]";addNonemptyTrack(VectorKeyframeTrack,a+".position",o,"pos",i),addNonemptyTrack(QuaternionKeyframeTrack,a+".quaternion",o,"rot",i),addNonemptyTrack(VectorKeyframeTrack,a+".scale",o,"scl",i)}}return 0===i.length?null:new AnimationClip(o,m,i,s)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){let t=0;for(let n=0,i=this.tracks.length;n!==i;++n){const i=this.tracks[n];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let n=0;n<this.tracks.length;n++)t=t&&this.tracks[n].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let n=0;n<this.tracks.length;n++)t.push(this.tracks[n].clone());return new AnimationClip(this.name,this.duration,t,this.blendMode)},toJSON:function(){return AnimationClip.toJSON(this)}});const la={enabled:!1,files:{},add:function(t,n){!1!==this.enabled&&(this.files[t]=n)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function LoadingManager(t,n,i){const o=this;let a=!1,s=0,m=0,g=void 0;const _=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=i,this.itemStart=function(t){m++,!1===a&&void 0!==o.onStart&&o.onStart(t,s,m),a=!0},this.itemEnd=function(t){s++,void 0!==o.onProgress&&o.onProgress(t,s,m),s===m&&(a=!1,void 0!==o.onLoad&&o.onLoad())},this.itemError=function(t){void 0!==o.onError&&o.onError(t)},this.resolveURL=function(t){return g?g(t):t},this.setURLModifier=function(t){return g=t,this},this.addHandler=function(t,n){return _.push(t,n),this},this.removeHandler=function(t){const n=_.indexOf(t);return-1!==n&&_.splice(n,2),this},this.getHandler=function(t){for(let n=0,i=_.length;n<i;n+=2){const i=_[n],o=_[n+1];if(i.global&&(i.lastIndex=0),i.test(t))return o}return null}}const ha=new LoadingManager;function Loader(t){this.manager=void 0!==t?t:ha,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Loader.prototype,{load:function(){},loadAsync:function(t,n){const i=this;return new Promise((function(o,a){i.load(t,o,n,a)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const da={};function FileLoader(t){Loader.call(this,t)}function AnimationLoader(t){Loader.call(this,t)}function CompressedTextureLoader(t){Loader.call(this,t)}function ImageLoader(t){Loader.call(this,t)}function CubeTextureLoader(t){Loader.call(this,t)}function DataTextureLoader(t){Loader.call(this,t)}function TextureLoader(t){Loader.call(this,t)}function Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(t,n,i,o,a,s,m,g){Curve.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=n||0,this.xRadius=i||1,this.yRadius=o||1,this.aStartAngle=a||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=m||!1,this.aRotation=g||0}function ArcCurve(t,n,i,o,a,s){EllipseCurve.call(this,t,n,i,i,o,a,s),this.type="ArcCurve"}function CubicPoly(){let t=0,n=0,i=0,o=0;function init(a,s,m,g){t=a,n=m,i=-3*a+3*s-2*m-g,o=2*a-2*s+m+g}return{initCatmullRom:function(t,n,i,o,a){init(n,i,a*(i-t),a*(o-n))},initNonuniformCatmullRom:function(t,n,i,o,a,s,m){let g=(n-t)/a-(i-t)/(a+s)+(i-n)/s,_=(i-n)/s-(o-n)/(s+m)+(o-i)/m;g*=s,_*=s,init(n,i,g,_)},calc:function(a){const s=a*a;return t+n*a+i*s+o*(s*a)}}}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(t,n,i,o){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,s=la.get(t);if(void 0!==s)return a.manager.itemStart(t),setTimeout((function(){n&&n(s),a.manager.itemEnd(t)}),0),s;if(void 0!==da[t])return void da[t].push({onLoad:n,onProgress:i,onError:o});const m=t.match(/^data:(.*?)(;base64)?,(.*)$/);let g;if(m){const i=m[1],s=!!m[2];let g=m[3];g=decodeURIComponent(g),s&&(g=atob(g));try{let o;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(g.length);for(let n=0;n<g.length;n++)t[n]=g.charCodeAt(n);o="blob"===s?new Blob([t.buffer],{type:i}):t.buffer;break;case"document":const n=new DOMParser;o=n.parseFromString(g,i);break;case"json":o=JSON.parse(g);break;default:o=g}setTimeout((function(){n&&n(o),a.manager.itemEnd(t)}),0)}catch(n){setTimeout((function(){o&&o(n),a.manager.itemError(t),a.manager.itemEnd(t)}),0)}}else{da[t]=[],da[t].push({onLoad:n,onProgress:i,onError:o}),g=new XMLHttpRequest,g.open("GET",t,!0),g.addEventListener("load",(function(n){const i=this.response,o=da[t];if(delete da[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),la.add(t,i);for(let t=0,n=o.length;t<n;t++){const n=o[t];n.onLoad&&n.onLoad(i)}a.manager.itemEnd(t)}else{for(let t=0,i=o.length;t<i;t++){const i=o[t];i.onError&&i.onError(n)}a.manager.itemError(t),a.manager.itemEnd(t)}}),!1),g.addEventListener("progress",(function(n){const i=da[t];for(let t=0,o=i.length;t<o;t++){const o=i[t];o.onProgress&&o.onProgress(n)}}),!1),g.addEventListener("error",(function(n){const i=da[t];delete da[t];for(let t=0,o=i.length;t<o;t++){const o=i[t];o.onError&&o.onError(n)}a.manager.itemError(t),a.manager.itemEnd(t)}),!1),g.addEventListener("abort",(function(n){const i=da[t];delete da[t];for(let t=0,o=i.length;t<o;t++){const o=i[t];o.onError&&o.onError(n)}a.manager.itemError(t),a.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(g.responseType=this.responseType),void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)g.setRequestHeader(t,this.requestHeader[t]);g.send(null)}return a.manager.itemStart(t),g},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(t,n,i,o){const a=this,s=new FileLoader(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(t,(function(i){try{n(a.parse(JSON.parse(i)))}catch(n){o?o(n):console.error(n),a.manager.itemError(t)}}),i,o)},parse:function(t){const n=[];for(let i=0;i<t.length;i++){const o=AnimationClip.parse(t[i]);n.push(o)}return n}}),CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(t,n,i,o){const a=this,s=[],m=new CompressedTexture,g=new FileLoader(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(a.withCredentials);let _=0;function loadTexture(S){g.load(t[S],(function(t){const i=a.parse(t,!0);s[S]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},_+=1,6===_&&(1===i.mipmapCount&&(m.minFilter=Ve),m.image=s,m.format=i.format,m.needsUpdate=!0,n&&n(m))}),i,o)}if(Array.isArray(t))for(let n=0,i=t.length;n<i;++n)loadTexture(n);else g.load(t,(function(t){const i=a.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let n=0;n<t;n++){s[n]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[n].mipmaps.push(i.mipmaps[n*i.mipmapCount+t]),s[n].format=i.format,s[n].width=i.width,s[n].height=i.height}m.image=s}else m.image.width=i.width,m.image.height=i.height,m.mipmaps=i.mipmaps;1===i.mipmapCount&&(m.minFilter=Ve),m.format=i.format,m.needsUpdate=!0,n&&n(m)}),i,o);return m}}),ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(t,n,i,o){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,s=la.get(t);if(void 0!==s)return a.manager.itemStart(t),setTimeout((function(){n&&n(s),a.manager.itemEnd(t)}),0),s;const m=document.createElementNS("http://www.w3.org/1999/xhtml","img");function onImageLoad(){m.removeEventListener("load",onImageLoad,!1),m.removeEventListener("error",onImageError,!1),la.add(t,this),n&&n(this),a.manager.itemEnd(t)}function onImageError(n){m.removeEventListener("load",onImageLoad,!1),m.removeEventListener("error",onImageError,!1),o&&o(n),a.manager.itemError(t),a.manager.itemEnd(t)}return m.addEventListener("load",onImageLoad,!1),m.addEventListener("error",onImageError,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(m.crossOrigin=this.crossOrigin),a.manager.itemStart(t),m.src=t,m}}),CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(t,n,i,o){const a=new CubeTexture,s=new ImageLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let m=0;function loadTexture(i){s.load(t[i],(function(t){a.images[i]=t,m++,6===m&&(a.needsUpdate=!0,n&&n(a))}),void 0,o)}for(let n=0;n<t.length;++n)loadTexture(n);return a}}),DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(t,n,i,o){const a=this,s=new DataTexture,m=new FileLoader(this.manager);return m.setResponseType("arraybuffer"),m.setRequestHeader(this.requestHeader),m.setPath(this.path),m.setWithCredentials(a.withCredentials),m.load(t,(function(t){const i=a.parse(t);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:Ne,s.wrapT=void 0!==i.wrapT?i.wrapT:Ne,s.magFilter=void 0!==i.magFilter?i.magFilter:Ve,s.minFilter=void 0!==i.minFilter?i.minFilter:Ve,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=ze),1===i.mipmapCount&&(s.minFilter=Ve),s.needsUpdate=!0,n&&n(s,i))}),i,o),s}}),TextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader,load:function(t,n,i,o){const a=new Texture,s=new ImageLoader(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(i){a.image=i;const o=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);a.format=o?it:ot,a.needsUpdate=!0,void 0!==n&&n(a)}),i,o),a}}),Object.assign(Curve.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,n){const i=this.getUtoTmapping(t);return this.getPoint(i,n)},getPoints:function(t=5){const n=[];for(let i=0;i<=t;i++)n.push(this.getPoint(i/t));return n},getSpacedPoints:function(t=5){const n=[];for(let i=0;i<=t;i++)n.push(this.getPointAt(i/t));return n},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let i,o=this.getPoint(0),a=0;n.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),a+=i.distanceTo(o),n.push(a),o=i;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,n){const i=this.getLengths();let o=0;const a=i.length;let s;s=n||t*i[a-1];let m,g=0,_=a-1;for(;g<=_;)if(o=Math.floor(g+(_-g)/2),m=i[o]-s,m<0)g=o+1;else{if(!(m>0)){_=o;break}_=o-1}if(o=_,i[o]===s)return o/(a-1);const S=i[o];return(o+(s-S)/(i[o+1]-S))/(a-1)},getTangent:function(t,n){let i=t-1e-4,o=t+1e-4;i<0&&(i=0),o>1&&(o=1);const a=this.getPoint(i),s=this.getPoint(o),m=n||(a.isVector2?new Vector2:new Vector3);return m.copy(s).sub(a).normalize(),m},getTangentAt:function(t,n){const i=this.getUtoTmapping(t);return this.getTangent(i,n)},computeFrenetFrames:function(t,n){const i=new Vector3,o=[],a=[],s=[],m=new Vector3,g=new Matrix4;for(let n=0;n<=t;n++){const i=n/t;o[n]=this.getTangentAt(i,new Vector3),o[n].normalize()}a[0]=new Vector3,s[0]=new Vector3;let _=Number.MAX_VALUE;const S=Math.abs(o[0].x),M=Math.abs(o[0].y),T=Math.abs(o[0].z);S<=_&&(_=S,i.set(1,0,0)),M<=_&&(_=M,i.set(0,1,0)),T<=_&&i.set(0,0,1),m.crossVectors(o[0],i).normalize(),a[0].crossVectors(o[0],m),s[0].crossVectors(o[0],a[0]);for(let n=1;n<=t;n++){if(a[n]=a[n-1].clone(),s[n]=s[n-1].clone(),m.crossVectors(o[n-1],o[n]),m.length()>Number.EPSILON){m.normalize();const t=Math.acos(ar.clamp(o[n-1].dot(o[n]),-1,1));a[n].applyMatrix4(g.makeRotationAxis(m,t))}s[n].crossVectors(o[n],a[n])}if(!0===n){let n=Math.acos(ar.clamp(a[0].dot(a[t]),-1,1));n/=t,o[0].dot(m.crossVectors(a[0],a[t]))>0&&(n=-n);for(let i=1;i<=t;i++)a[i].applyMatrix4(g.makeRotationAxis(o[i],n*i)),s[i].crossVectors(o[i],a[i])}return{tangents:o,normals:a,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(t,n){const i=n||new Vector2,o=2*Math.PI;let a=this.aEndAngle-this.aStartAngle;const s=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=o;for(;a>o;)a-=o;a<Number.EPSILON&&(a=s?0:o),!0!==this.aClockwise||s||(a===o?a=-o:a-=o);const m=this.aStartAngle+t*a;let g=this.aX+this.xRadius*Math.cos(m),_=this.aY+this.yRadius*Math.sin(m);if(0!==this.aRotation){const t=Math.cos(this.aRotation),n=Math.sin(this.aRotation),i=g-this.aX,o=_-this.aY;g=i*t-o*n+this.aX,_=i*n+o*t+this.aY}return i.set(g,_)},EllipseCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},EllipseCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},EllipseCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;const pa=new Vector3,fa=new CubicPoly,ma=new CubicPoly,ga=new CubicPoly;function CatmullRomCurve3(t=[],n=!1,i="centripetal",o=.5){Curve.call(this),this.type="CatmullRomCurve3",this.points=t,this.closed=n,this.curveType=i,this.tension=o}function CatmullRom(t,n,i,o,a){const s=.5*(o-n),m=.5*(a-i),g=t*t;return(2*i-2*o+s+m)*(t*g)+(-3*i+3*o-2*s-m)*g+s*t+i}function QuadraticBezier(t,n,i,o){return function QuadraticBezierP0(t,n){const i=1-t;return i*i*n}(t,n)+function QuadraticBezierP1(t,n){return 2*(1-t)*t*n}(t,i)+function QuadraticBezierP2(t,n){return t*t*n}(t,o)}function CubicBezier(t,n,i,o,a){return function CubicBezierP0(t,n){const i=1-t;return i*i*i*n}(t,n)+function CubicBezierP1(t,n){const i=1-t;return 3*i*i*t*n}(t,i)+function CubicBezierP2(t,n){return 3*(1-t)*t*t*n}(t,o)+function CubicBezierP3(t,n){return t*t*t*n}(t,a)}function CubicBezierCurve(t=new Vector2,n=new Vector2,i=new Vector2,o=new Vector2){Curve.call(this),this.type="CubicBezierCurve",this.v0=t,this.v1=n,this.v2=i,this.v3=o}function CubicBezierCurve3(t=new Vector3,n=new Vector3,i=new Vector3,o=new Vector3){Curve.call(this),this.type="CubicBezierCurve3",this.v0=t,this.v1=n,this.v2=i,this.v3=o}function LineCurve(t=new Vector2,n=new Vector2){Curve.call(this),this.type="LineCurve",this.v1=t,this.v2=n}function LineCurve3(t=new Vector3,n=new Vector3){Curve.call(this),this.type="LineCurve3",this.v1=t,this.v2=n}function QuadraticBezierCurve(t=new Vector2,n=new Vector2,i=new Vector2){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=t,this.v1=n,this.v2=i}function QuadraticBezierCurve3(t=new Vector3,n=new Vector3,i=new Vector3){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=n,this.v2=i}function SplineCurve(t=[]){Curve.call(this),this.type="SplineCurve",this.points=t}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(t,n=new Vector3){const i=n,o=this.points,a=o.length,s=(a-(this.closed?0:1))*t;let m,g,_=Math.floor(s),S=s-_;this.closed?_+=_>0?0:(Math.floor(Math.abs(_)/a)+1)*a:0===S&&_===a-1&&(_=a-2,S=1),this.closed||_>0?m=o[(_-1)%a]:(pa.subVectors(o[0],o[1]).add(o[0]),m=pa);const M=o[_%a],T=o[(_+1)%a];if(this.closed||_+2<a?g=o[(_+2)%a]:(pa.subVectors(o[a-1],o[a-2]).add(o[a-1]),g=pa),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let n=Math.pow(m.distanceToSquared(M),t),i=Math.pow(M.distanceToSquared(T),t),o=Math.pow(T.distanceToSquared(g),t);i<1e-4&&(i=1),n<1e-4&&(n=i),o<1e-4&&(o=i),fa.initNonuniformCatmullRom(m.x,M.x,T.x,g.x,n,i,o),ma.initNonuniformCatmullRom(m.y,M.y,T.y,g.y,n,i,o),ga.initNonuniformCatmullRom(m.z,M.z,T.z,g.z,n,i,o)}else"catmullrom"===this.curveType&&(fa.initCatmullRom(m.x,M.x,T.x,g.x,this.tension),ma.initCatmullRom(m.y,M.y,T.y,g.y,this.tension),ga.initCatmullRom(m.z,M.z,T.z,g.z,this.tension));return i.set(fa.calc(S),ma.calc(S),ga.calc(S)),i},CatmullRomCurve3.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(let n=0,i=t.points.length;n<i;n++){const i=t.points[n];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CatmullRomCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);t.points=[];for(let n=0,i=this.points.length;n<i;n++){const i=this.points[n];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},CatmullRomCurve3.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(let n=0,i=t.points.length;n<i;n++){const i=t.points[n];this.points.push((new Vector3).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(t,n=new Vector2){const i=n,o=this.v0,a=this.v1,s=this.v2,m=this.v3;return i.set(CubicBezier(t,o.x,a.x,s.x,m.x),CubicBezier(t,o.y,a.y,s.y,m.y)),i},CubicBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(t,n=new Vector3){const i=n,o=this.v0,a=this.v1,s=this.v2,m=this.v3;return i.set(CubicBezier(t,o.x,a.x,s.x,m.x),CubicBezier(t,o.y,a.y,s.y,m.y),CubicBezier(t,o.z,a.z,s.z,m.z)),i},CubicBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(t,n=new Vector2){const i=n;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},LineCurve.prototype.getPointAt=function(t,n){return this.getPoint(t,n)},LineCurve.prototype.getTangent=function(t,n){const i=n||new Vector2;return i.copy(this.v2).sub(this.v1).normalize(),i},LineCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(t,n=new Vector3){const i=n;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},LineCurve3.prototype.getPointAt=function(t,n){return this.getPoint(t,n)},LineCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(t,n=new Vector2){const i=n,o=this.v0,a=this.v1,s=this.v2;return i.set(QuadraticBezier(t,o.x,a.x,s.x),QuadraticBezier(t,o.y,a.y,s.y)),i},QuadraticBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(t,n=new Vector3){const i=n,o=this.v0,a=this.v1,s=this.v2;return i.set(QuadraticBezier(t,o.x,a.x,s.x),QuadraticBezier(t,o.y,a.y,s.y),QuadraticBezier(t,o.z,a.z,s.z)),i},QuadraticBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(t,n=new Vector2){const i=n,o=this.points,a=(o.length-1)*t,s=Math.floor(a),m=a-s,g=o[0===s?s:s-1],_=o[s],S=o[s>o.length-2?o.length-1:s+1],M=o[s>o.length-3?o.length-1:s+2];return i.set(CatmullRom(m,g.x,_.x,S.x,M.x),CatmullRom(m,g.y,_.y,S.y,M.y)),i},SplineCurve.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(let n=0,i=t.points.length;n<i;n++){const i=t.points[n];this.points.push(i.clone())}return this},SplineCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);t.points=[];for(let n=0,i=this.points.length;n<i;n++){const i=this.points[n];t.points.push(i.toArray())}return t},SplineCurve.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(let n=0,i=t.points.length;n<i;n++){const i=t.points[n];this.points.push((new Vector2).fromArray(i))}return this};var ya=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(t){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}function Shape(t){Path.call(this,t),this.uuid=ar.generateUUID(),this.type="Shape",this.holes=[]}function Light(t,n=1){Object3D.call(this),this.type="Light",this.color=new Color(t),this.intensity=n}function HemisphereLight(t,n,i){Light.call(this,t,i),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(n)}function LightShadow(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500)),this.focus=1}function SpotLight(t,n,i,o,a,s){Light.call(this,t,n),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==o?o:Math.PI/3,this.penumbra=void 0!==a?a:0,this.decay=void 0!==s?s:1,this.shadow=new SpotLightShadow}function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}function PointLight(t,n,i,o){Light.call(this,t,n),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new PointLightShadow}function OrthographicCamera(t=-1,n=1,i=1,o=-1,a=.1,s=2e3){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=n,this.top=i,this.bottom=o,this.near=a,this.far=s,this.updateProjectionMatrix()}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(t,n){Light.call(this,t,n),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(t,n){Light.call(this,t,n),this.type="AmbientLight"}function RectAreaLight(t,n,i,o){Light.call(this,t,n),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==o?o:10}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);t.equals(n)||this.curves.push(new LineCurve(n,t))},getPoint:function(t){const n=t*this.getLength(),i=this.getCurveLengths();let o=0;for(;o<i.length;){if(i[o]>=n){const t=i[o]-n,a=this.curves[o],s=a.getLength(),m=0===s?0:1-t/s;return a.getPointAt(m)}o++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let n=0;for(let i=0,o=this.curves.length;i<o;i++)n+=this.curves[i].getLength(),t.push(n);return this.cacheLengths=t,t},getSpacedPoints:function(t=40){const n=[];for(let i=0;i<=t;i++)n.push(this.getPoint(i/t));return this.autoClose&&n.push(n[0]),n},getPoints:function(t=12){const n=[];let i;for(let o=0,a=this.curves;o<a.length;o++){const s=a[o],m=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,g=s.getPoints(m);for(let t=0;t<g.length;t++){const o=g[t];i&&i.equals(o)||(n.push(o),i=o)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(t){Curve.prototype.copy.call(this,t),this.curves=[];for(let n=0,i=t.curves.length;n<i;n++){const i=t.curves[n];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=Curve.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let n=0,i=this.curves.length;n<i;n++){const i=this.curves[n];t.curves.push(i.toJSON())}return t},fromJSON:function(t){Curve.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let n=0,i=t.curves.length;n<i;n++){const i=t.curves[n];this.curves.push((new ya[i.type]).fromJSON(i))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let n=1,i=t.length;n<i;n++)this.lineTo(t[n].x,t[n].y);return this},moveTo:function(t,n){return this.currentPoint.set(t,n),this},lineTo:function(t,n){const i=new LineCurve(this.currentPoint.clone(),new Vector2(t,n));return this.curves.push(i),this.currentPoint.set(t,n),this},quadraticCurveTo:function(t,n,i,o){const a=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,n),new Vector2(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},bezierCurveTo:function(t,n,i,o,a,s){const m=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,n),new Vector2(i,o),new Vector2(a,s));return this.curves.push(m),this.currentPoint.set(a,s),this},splineThru:function(t){const n=new SplineCurve([this.currentPoint.clone()].concat(t));return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,n,i,o,a,s){const m=this.currentPoint.x,g=this.currentPoint.y;return this.absarc(t+m,n+g,i,o,a,s),this},absarc:function(t,n,i,o,a,s){return this.absellipse(t,n,i,i,o,a,s),this},ellipse:function(t,n,i,o,a,s,m,g){const _=this.currentPoint.x,S=this.currentPoint.y;return this.absellipse(t+_,n+S,i,o,a,s,m,g),this},absellipse:function(t,n,i,o,a,s,m,g){const _=new EllipseCurve(t,n,i,o,a,s,m,g);if(this.curves.length>0){const t=_.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(_);const S=_.getPoint(1);return this.currentPoint.copy(S),this},copy:function(t){return CurvePath.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=CurvePath.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return CurvePath.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(t){const n=[];for(let i=0,o=this.holes.length;i<o;i++)n[i]=this.holes[i].getPoints(t);return n},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Path.prototype.copy.call(this,t),this.holes=[];for(let n=0,i=t.holes.length;n<i;n++){const i=t.holes[n];this.holes.push(i.clone())}return this},toJSON:function(){const t=Path.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let n=0,i=this.holes.length;n<i;n++){const i=this.holes[n];t.holes.push(i.toJSON())}return t},fromJSON:function(t){Path.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let n=0,i=t.holes.length;n<i;n++){const i=t.holes[n];this.holes.push((new Path).fromJSON(i))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const n=Object3D.prototype.toJSON.call(this,t);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,void 0!==this.groundColor&&(n.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(n.object.distance=this.distance),void 0!==this.angle&&(n.object.angle=this.angle),void 0!==this.decay&&(n.object.decay=this.decay),void 0!==this.penumbra&&(n.object.penumbra=this.penumbra),void 0!==this.shadow&&(n.object.shadow=this.shadow.toJSON()),n}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3,_lookTarget:new Vector3,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const n=this.camera,i=this.matrix,o=this._projScreenMatrix,a=this._lookTarget,s=this._lightPositionWorld;s.setFromMatrixPosition(t.matrixWorld),n.position.copy(s),a.setFromMatrixPosition(t.target.matrixWorld),n.lookAt(a),n.updateMatrixWorld(),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(n.projectionMatrix),i.multiply(n.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,updateMatrices:function(t){const n=this.camera,i=2*ar.RAD2DEG*t.angle*this.focus,o=this.mapSize.width/this.mapSize.height,a=t.distance||n.far;i===n.fov&&o===n.aspect&&a===n.far||(n.fov=i,n.aspect=o,n.far=a,n.updateProjectionMatrix()),LightShadow.prototype.updateMatrices.call(this,t)}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:!0,updateMatrices:function(t,n=0){const i=this.camera,o=this.matrix,a=this._lightPositionWorld,s=this._lookTarget,m=this._projScreenMatrix;a.setFromMatrixPosition(t.matrixWorld),i.position.copy(a),s.copy(i.position),s.add(this._cubeDirections[n]),i.up.copy(this._cubeUps[n]),i.lookAt(s),i.updateMatrixWorld(),o.makeTranslation(-a.x,-a.y,-a.z),m.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(m)}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(t,n){return Camera.prototype.copy.call(this,t,n),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,n,i,o,a,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=o,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let a=i-t,s=i+t,m=o+n,g=o-n;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,n=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=t*this.view.offsetX,s=a+t*this.view.width,m-=n*this.view.offsetY,g=m-n*this.view.height}this.projectionMatrix.makeOrthographic(a,s,m,g,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const n=Object3D.prototype.toJSON.call(this,t);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,null!==this.view&&(n.object.view=Object.assign({},this.view)),n}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:!0,updateMatrices:function(t){LightShadow.prototype.updateMatrices.call(this,t)}}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const n=Light.prototype.toJSON.call(this,t);return n.object.width=this.width,n.object.height=this.height,n}});class SphericalHarmonics3{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Vector3)}set(t){for(let n=0;n<9;n++)this.coefficients[n].copy(t[n]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,n){const i=t.x,o=t.y,a=t.z,s=this.coefficients;return n.copy(s[0]).multiplyScalar(.282095),n.addScaledVector(s[1],.488603*o),n.addScaledVector(s[2],.488603*a),n.addScaledVector(s[3],.488603*i),n.addScaledVector(s[4],i*o*1.092548),n.addScaledVector(s[5],o*a*1.092548),n.addScaledVector(s[6],.315392*(3*a*a-1)),n.addScaledVector(s[7],i*a*1.092548),n.addScaledVector(s[8],.546274*(i*i-o*o)),n}getIrradianceAt(t,n){const i=t.x,o=t.y,a=t.z,s=this.coefficients;return n.copy(s[0]).multiplyScalar(.886227),n.addScaledVector(s[1],1.023328*o),n.addScaledVector(s[2],1.023328*a),n.addScaledVector(s[3],1.023328*i),n.addScaledVector(s[4],.858086*i*o),n.addScaledVector(s[5],.858086*o*a),n.addScaledVector(s[6],.743125*a*a-.247708),n.addScaledVector(s[7],.858086*i*a),n.addScaledVector(s[8],.429043*(i*i-o*o)),n}add(t){for(let n=0;n<9;n++)this.coefficients[n].add(t.coefficients[n]);return this}addScaledSH(t,n){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],n);return this}scale(t){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(t);return this}lerp(t,n){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],n);return this}equals(t){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(t.coefficients[n]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,n=0){const i=this.coefficients;for(let o=0;o<9;o++)i[o].fromArray(t,n+3*o);return this}toArray(t=[],n=0){const i=this.coefficients;for(let o=0;o<9;o++)i[o].toArray(t,n+3*o);return t}static getBasisAt(t,n){const i=t.x,o=t.y,a=t.z;n[0]=.282095,n[1]=.488603*o,n[2]=.488603*a,n[3]=.488603*i,n[4]=1.092548*i*o,n[5]=1.092548*o*a,n[6]=.315392*(3*a*a-1),n[7]=1.092548*i*a,n[8]=.546274*(i*i-o*o)}}function LightProbe(t,n){Light.call(this,void 0,n),this.type="LightProbe",this.sh=void 0!==t?t:new SphericalHarmonics3}function MaterialLoader(t){Loader.call(this,t),this.textures={}}LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const n=Light.prototype.toJSON.call(this,t);return n.object.sh=this.sh.toArray(),n}}),MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(t,n,i,o){const a=this,s=new FileLoader(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(t,(function(i){try{n(a.parse(JSON.parse(i)))}catch(n){o?o(n):console.error(n),a.manager.itemError(t)}}),i,o)},parse:function(t){const n=this.textures;function getTexture(t){return void 0===n[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),n[t]}const i=new ca[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=(new Color).setHex(t.sheen)),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(i.morphNormals=t.morphNormals),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.vertexTangents&&(i.vertexTangents=t.vertexTangents),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const n in t.uniforms){const o=t.uniforms[n];switch(i.uniforms[n]={},o.type){case"t":i.uniforms[n].value=getTexture(o.value);break;case"c":i.uniforms[n].value=(new Color).setHex(o.value);break;case"v2":i.uniforms[n].value=(new Vector2).fromArray(o.value);break;case"v3":i.uniforms[n].value=(new Vector3).fromArray(o.value);break;case"v4":i.uniforms[n].value=(new Vector4).fromArray(o.value);break;case"m3":i.uniforms[n].value=(new Matrix3).fromArray(o.value);break;case"m4":i.uniforms[n].value=(new Matrix4).fromArray(o.value);break;default:i.uniforms[n].value=o.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const n in t.extensions)i.extensions[n]=t.extensions[n];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=getTexture(t.map)),void 0!==t.matcap&&(i.matcap=getTexture(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=getTexture(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=getTexture(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=getTexture(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let n=t.normalScale;!1===Array.isArray(n)&&(n=[n,n]),i.normalScale=(new Vector2).fromArray(n)}return void 0!==t.displacementMap&&(i.displacementMap=getTexture(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=getTexture(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=getTexture(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=getTexture(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=getTexture(t.specularMap)),void 0!==t.envMap&&(i.envMap=getTexture(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=getTexture(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=getTexture(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=getTexture(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=getTexture(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=getTexture(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=getTexture(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.transmissionMap&&(i.transmissionMap=getTexture(t.transmissionMap)),i},setTextures:function(t){return this.textures=t,this}});const va={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let n="";for(let i=0,o=t.length;i<o;i++)n+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(n))}catch(t){return n}},extractUrlBase:function(t){const n=t.lastIndexOf("/");return-1===n?"./":t.substr(0,n+1)}};function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function InstancedBufferAttribute(t,n,i,o){"number"==typeof i&&(o=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,t,n,i),this.meshPerAttribute=o||1}function BufferGeometryLoader(t){Loader.call(this,t)}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(t){return BufferGeometry.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=BufferGeometry.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(t){return BufferAttribute.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=BufferAttribute.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(t,n,i,o){const a=this,s=new FileLoader(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(t,(function(i){try{n(a.parse(JSON.parse(i)))}catch(n){o?o(n):console.error(n),a.manager.itemError(t)}}),i,o)},parse:function(t){const n={},i={};function getInterleavedBuffer(t,o){if(void 0!==n[o])return n[o];const a=t.interleavedBuffers[o],s=function getArrayBuffer(t,n){if(void 0!==i[n])return i[n];const o=t.arrayBuffers[n],a=new Uint32Array(o).buffer;return i[n]=a,a}(t,a.buffer),m=new InterleavedBuffer(getTypedArray(a.type,s),a.stride);return m.uuid=a.uuid,n[o]=m,m}const o=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,a=t.data.index;if(void 0!==a){const t=getTypedArray(a.type,a.array);o.setIndex(new BufferAttribute(t,1))}const s=t.data.attributes;for(const n in s){const i=s[n];let a;if(i.isInterleavedBufferAttribute)a=new InterleavedBufferAttribute(getInterleavedBuffer(t.data,i.data),i.itemSize,i.offset,i.normalized);else{const t=getTypedArray(i.type,i.array);a=new(i.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(t,i.itemSize,i.normalized)}void 0!==i.name&&(a.name=i.name),o.setAttribute(n,a)}const m=t.data.morphAttributes;if(m)for(const n in m){const i=m[n],a=[];for(let n=0,o=i.length;n<o;n++){const o=i[n];let s;s=o.isInterleavedBufferAttribute?new InterleavedBufferAttribute(getInterleavedBuffer(t.data,o.data),o.itemSize,o.offset,o.normalized):new BufferAttribute(getTypedArray(o.type,o.array),o.itemSize,o.normalized),void 0!==o.name&&(s.name=o.name),a.push(s)}o.morphAttributes[n]=a}t.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const g=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==g)for(let t=0,n=g.length;t!==n;++t){const n=g[t];o.addGroup(n.start,n.count,n.materialIndex)}const _=t.data.boundingSphere;if(void 0!==_){const t=new Vector3;void 0!==_.center&&t.fromArray(_.center),o.boundingSphere=new Sphere(t,_.radius)}return t.name&&(o.name=t.name),t.userData&&(o.userData=t.userData),o}});class ObjectLoader extends Loader{constructor(t){super(t)}load(t,n,i,o){const a=this,s=""===this.path?va.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const m=new FileLoader(this.manager);m.setPath(this.path),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(t,(function(i){let s=null;try{s=JSON.parse(i)}catch(n){return void 0!==o&&o(n),void console.error("THREE:ObjectLoader: Can't parse "+t+".",n.message)}const m=s.metadata;void 0!==m&&void 0!==m.type&&"geometry"!==m.type.toLowerCase()?a.parse(s,n):console.error("THREE.ObjectLoader: Can't load "+t)}),i,o)}parse(t,n){const i=this.parseAnimations(t.animations),o=this.parseShapes(t.shapes),a=this.parseGeometries(t.geometries,o),s=this.parseImages(t.images,(function(){void 0!==n&&n(_)})),m=this.parseTextures(t.textures,s),g=this.parseMaterials(t.materials,m),_=this.parseObject(t.object,a,g,i),S=this.parseSkeletons(t.skeletons,_);if(this.bindSkeletons(_,S),void 0!==n){let t=!1;for(const n in s)if(s[n]instanceof HTMLImageElement){t=!0;break}!1===t&&n(_)}return _}parseShapes(t){const n={};if(void 0!==t)for(let i=0,o=t.length;i<o;i++){const o=(new Shape).fromJSON(t[i]);n[o.uuid]=o}return n}parseSkeletons(t,n){const i={},o={};if(n.traverse((function(t){t.isBone&&(o[t.uuid]=t)})),void 0!==t)for(let n=0,a=t.length;n<a;n++){const a=(new Skeleton).fromJSON(t[n],o);i[a.uuid]=a}return i}parseGeometries(t,n){const i={};let o;if(void 0!==t){const a=new BufferGeometryLoader;for(let s=0,m=t.length;s<m;s++){let m;const g=t[s];switch(g.type){case"PlaneGeometry":case"PlaneBufferGeometry":m=new sa[g.type](g.width,g.height,g.widthSegments,g.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":m=new sa[g.type](g.width,g.height,g.depth,g.widthSegments,g.heightSegments,g.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":m=new sa[g.type](g.radius,g.segments,g.thetaStart,g.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":m=new sa[g.type](g.radiusTop,g.radiusBottom,g.height,g.radialSegments,g.heightSegments,g.openEnded,g.thetaStart,g.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":m=new sa[g.type](g.radius,g.height,g.radialSegments,g.heightSegments,g.openEnded,g.thetaStart,g.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":m=new sa[g.type](g.radius,g.widthSegments,g.heightSegments,g.phiStart,g.phiLength,g.thetaStart,g.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":m=new sa[g.type](g.radius,g.detail);break;case"RingGeometry":case"RingBufferGeometry":m=new sa[g.type](g.innerRadius,g.outerRadius,g.thetaSegments,g.phiSegments,g.thetaStart,g.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":m=new sa[g.type](g.radius,g.tube,g.radialSegments,g.tubularSegments,g.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":m=new sa[g.type](g.radius,g.tube,g.tubularSegments,g.radialSegments,g.p,g.q);break;case"TubeGeometry":case"TubeBufferGeometry":m=new sa[g.type]((new ya[g.path.type]).fromJSON(g.path),g.tubularSegments,g.radius,g.radialSegments,g.closed);break;case"LatheGeometry":case"LatheBufferGeometry":m=new sa[g.type](g.points,g.segments,g.phiStart,g.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":m=new sa[g.type](g.vertices,g.indices,g.radius,g.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":o=[];for(let t=0,i=g.shapes.length;t<i;t++){const i=n[g.shapes[t]];o.push(i)}m=new sa[g.type](o,g.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":o=[];for(let t=0,i=g.shapes.length;t<i;t++){const i=n[g.shapes[t]];o.push(i)}const t=g.options.extrudePath;void 0!==t&&(g.options.extrudePath=(new ya[t.type]).fromJSON(t)),m=new sa[g.type](o,g.options);break;case"BufferGeometry":case"InstancedBufferGeometry":m=a.parse(g);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+g.type+'"');continue}m.uuid=g.uuid,void 0!==g.name&&(m.name=g.name),!0===m.isBufferGeometry&&void 0!==g.userData&&(m.userData=g.userData),i[g.uuid]=m}}return i}parseMaterials(t,n){const i={},o={};if(void 0!==t){const a=new MaterialLoader;a.setTextures(n);for(let n=0,s=t.length;n<s;n++){const s=t[n];if("MultiMaterial"===s.type){const t=[];for(let n=0;n<s.materials.length;n++){const o=s.materials[n];void 0===i[o.uuid]&&(i[o.uuid]=a.parse(o)),t.push(i[o.uuid])}o[s.uuid]=t}else void 0===i[s.uuid]&&(i[s.uuid]=a.parse(s)),o[s.uuid]=i[s.uuid]}}return o}parseAnimations(t){const n={};if(void 0!==t)for(let i=0;i<t.length;i++){const o=t[i],a=AnimationClip.parse(o);n[a.uuid]=a}return n}parseImages(t,n){const i=this,o={};let a;function deserializeImage(t){if("string"==typeof t){const n=t;return function loadImage(t){return i.manager.itemStart(t),a.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:i.resourcePath+n)}return t.data?{data:getTypedArray(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new LoadingManager(n);a=new ImageLoader(i),a.setCrossOrigin(this.crossOrigin);for(let n=0,i=t.length;n<i;n++){const i=t[n],a=i.url;if(Array.isArray(a)){o[i.uuid]=[];for(let t=0,n=a.length;t<n;t++){const n=deserializeImage(a[t]);null!==n&&(n instanceof HTMLImageElement?o[i.uuid].push(n):o[i.uuid].push(new DataTexture(n.data,n.width,n.height)))}}else{const t=deserializeImage(i.url);null!==t&&(o[i.uuid]=t)}}}return o}parseTextures(t,n){function parseConstant(t,n){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),n[t])}const i={};if(void 0!==t)for(let o=0,a=t.length;o<a;o++){const a=t[o];let s;void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===n[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const m=n[a.image];Array.isArray(m)?(s=new CubeTexture(m),6===m.length&&(s.needsUpdate=!0)):(s=m&&m.data?new DataTexture(m.data,m.width,m.height):new Texture(m),m&&(s.needsUpdate=!0)),s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=parseConstant(a.mapping,ba)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=parseConstant(a.wrap[0],_a),s.wrapT=parseConstant(a.wrap[1],_a)),void 0!==a.format&&(s.format=a.format),void 0!==a.type&&(s.type=a.type),void 0!==a.encoding&&(s.encoding=a.encoding),void 0!==a.minFilter&&(s.minFilter=parseConstant(a.minFilter,wa)),void 0!==a.magFilter&&(s.magFilter=parseConstant(a.magFilter,wa)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(s.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(s.unpackAlignment=a.unpackAlignment),i[a.uuid]=s}return i}parseObject(t,n,i,o){let a,s,m;function getGeometry(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),n[t]}function getMaterial(t){if(void 0!==t){if(Array.isArray(t)){const n=[];for(let o=0,a=t.length;o<a;o++){const a=t[o];void 0===i[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),n.push(i[a])}return n}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}switch(t.type){case"Scene":a=new Scene,void 0!==t.background&&Number.isInteger(t.background)&&(a.background=new Color(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?a.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(a.fog=new FogExp2(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":a=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(a.focus=t.focus),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.filmGauge&&(a.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(a.filmOffset=t.filmOffset),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":a=new DirectionalLight(t.color,t.intensity);break;case"PointLight":a=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":a=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=(new LightProbe).fromJSON(t);break;case"SkinnedMesh":s=getGeometry(t.geometry),m=getMaterial(t.material),a=new SkinnedMesh(s,m),void 0!==t.bindMode&&(a.bindMode=t.bindMode),void 0!==t.bindMatrix&&a.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(a.skeleton=t.skeleton);break;case"Mesh":s=getGeometry(t.geometry),m=getMaterial(t.material),a=new Mesh(s,m);break;case"InstancedMesh":s=getGeometry(t.geometry),m=getMaterial(t.material);const n=t.count,i=t.instanceMatrix;a=new InstancedMesh(s,m,n),a.instanceMatrix=new BufferAttribute(new Float32Array(i.array),16);break;case"LOD":a=new LOD;break;case"Line":a=new Line(getGeometry(t.geometry),getMaterial(t.material));break;case"LineLoop":a=new LineLoop(getGeometry(t.geometry),getMaterial(t.material));break;case"LineSegments":a=new LineSegments(getGeometry(t.geometry),getMaterial(t.material));break;case"PointCloud":case"Points":a=new Points(getGeometry(t.geometry),getMaterial(t.material));break;case"Sprite":a=new Sprite(getMaterial(t.material));break;case"Group":a=new Group;break;case"Bone":a=new Bone;break;default:a=new Object3D}if(a.uuid=t.uuid,void 0!==t.name&&(a.name=t.name),void 0!==t.matrix?(a.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==t.position&&a.position.fromArray(t.position),void 0!==t.rotation&&a.rotation.fromArray(t.rotation),void 0!==t.quaternion&&a.quaternion.fromArray(t.quaternion),void 0!==t.scale&&a.scale.fromArray(t.scale)),void 0!==t.castShadow&&(a.castShadow=t.castShadow),void 0!==t.receiveShadow&&(a.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(a.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(a.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(a.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&a.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(a.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.frustumCulled&&(a.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(a.renderOrder=t.renderOrder),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.layers&&(a.layers.mask=t.layers),void 0!==t.children){const s=t.children;for(let t=0;t<s.length;t++)a.add(this.parseObject(s[t],n,i,o))}if(void 0!==t.animations){const n=t.animations;for(let t=0;t<n.length;t++){const i=n[t];a.animations.push(o[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(a.autoUpdate=t.autoUpdate);const n=t.levels;for(let t=0;t<n.length;t++){const i=n[t],o=a.getObjectByProperty("uuid",i.object);void 0!==o&&a.addLevel(o,i.distance)}}return a}bindSkeletons(t,n){0!==Object.keys(n).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=n[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}const ba={UVMapping:Ee,CubeReflectionMapping:Te,CubeRefractionMapping:Ce,EquirectangularReflectionMapping:Oe,EquirectangularRefractionMapping:Ae,CubeUVReflectionMapping:Pe,CubeUVRefractionMapping:Le},_a={RepeatWrapping:Re,ClampToEdgeWrapping:Ne,MirroredRepeatWrapping:Ie},wa={NearestFilter:ke,NearestMipmapNearestFilter:je,NearestMipmapLinearFilter:De,LinearFilter:Ve,LinearMipmapNearestFilter:Ue,LinearMipmapLinearFilter:ze};function ImageBitmapLoader(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Loader.call(this,t),this.options={premultiplyAlpha:"none"}}function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}function Font(t){this.type="Font",this.data=t}function createPath(t,n,i,o,a){const s=a.glyphs[t]||a.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+a.familyName+".");const m=new ShapePath;let g,_,S,M,T,O,A,P;if(s.o){const t=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let a=0,s=t.length;a<s;)switch(t[a++]){case"m":g=t[a++]*n+i,_=t[a++]*n+o,m.moveTo(g,_);break;case"l":g=t[a++]*n+i,_=t[a++]*n+o,m.lineTo(g,_);break;case"q":S=t[a++]*n+i,M=t[a++]*n+o,T=t[a++]*n+i,O=t[a++]*n+o,m.quadraticCurveTo(T,O,S,M);break;case"b":S=t[a++]*n+i,M=t[a++]*n+o,T=t[a++]*n+i,O=t[a++]*n+o,A=t[a++]*n+i,P=t[a++]*n+o,m.bezierCurveTo(T,O,A,P,S,M)}}return{offsetX:s.ha*n,path:m}}function FontLoader(t){Loader.call(this,t)}let xa;ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,isImageBitmapLoader:!0,setOptions:function setOptions(t){return this.options=t,this},load:function(t,n,i,o){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,s=la.get(t);if(void 0!==s)return a.manager.itemStart(t),setTimeout((function(){n&&n(s),a.manager.itemEnd(t)}),0),s;const m={};m.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,m).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,a.options)})).then((function(i){la.add(t,i),n&&n(i),a.manager.itemEnd(t)})).catch((function(n){o&&o(n),a.manager.itemError(t),a.manager.itemEnd(t)})),a.manager.itemStart(t)}}),Object.assign(ShapePath.prototype,{moveTo:function(t,n){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,n),this},lineTo:function(t,n){return this.currentPath.lineTo(t,n),this},quadraticCurveTo:function(t,n,i,o){return this.currentPath.quadraticCurveTo(t,n,i,o),this},bezierCurveTo:function(t,n,i,o,a,s){return this.currentPath.bezierCurveTo(t,n,i,o,a,s),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,n){function toShapesNoHoles(t){const n=[];for(let i=0,o=t.length;i<o;i++){const o=t[i],a=new Shape;a.curves=o.curves,n.push(a)}return n}function isPointInsidePolygon(t,n){const i=n.length;let o=!1;for(let a=i-1,s=0;s<i;a=s++){let i=n[a],m=n[s],g=m.x-i.x,_=m.y-i.y;if(Math.abs(_)>Number.EPSILON){if(_<0&&(i=n[s],g=-g,m=n[a],_=-_),t.y<i.y||t.y>m.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const n=_*(t.x-i.x)-g*(t.y-i.y);if(0===n)return!0;if(n<0)continue;o=!o}}else{if(t.y!==i.y)continue;if(m.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=m.x)return!0}}return o}const i=oa.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===n)return toShapesNoHoles(o);let a,s,m;const g=[];if(1===o.length)return s=o[0],m=new Shape,m.curves=s.curves,g.push(m),g;let _=!i(o[0].getPoints());_=t?!_:_;const S=[],M=[];let T,O,A=[],P=0;M[P]=void 0,A[P]=[];for(let n=0,m=o.length;n<m;n++)s=o[n],T=s.getPoints(),a=i(T),a=t?!a:a,a?(!_&&M[P]&&P++,M[P]={s:new Shape,p:T},M[P].s.curves=s.curves,_&&P++,A[P]=[]):A[P].push({h:s,p:T[0]});if(!M[0])return toShapesNoHoles(o);if(M.length>1){let t=!1;const n=[];for(let t=0,n=M.length;t<n;t++)S[t]=[];for(let i=0,o=M.length;i<o;i++){const o=A[i];for(let a=0;a<o.length;a++){const s=o[a];let m=!0;for(let o=0;o<M.length;o++)isPointInsidePolygon(s.p,M[o].p)&&(i!==o&&n.push({froms:i,tos:o,hole:a}),m?(m=!1,S[o].push(s)):t=!0);m&&S[i].push(s)}}n.length>0&&(t||(A=S))}for(let t=0,n=M.length;t<n;t++){m=M[t].s,g.push(m),O=A[t];for(let t=0,n=O.length;t<n;t++)m.holes.push(O[t].h)}return g}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(t,n=100){const i=[],o=function createPaths(t,n,i){const o=Array.from?Array.from(t):String(t).split(""),a=n/i.resolution,s=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*a,m=[];let g=0,_=0;for(let t=0;t<o.length;t++){const n=o[t];if("\n"===n)g=0,_-=s;else{const t=createPath(n,a,g,_,i);g+=t.offsetX,m.push(t.path)}}return m}(t,n,this.data);for(let t=0,n=o.length;t<n;t++)Array.prototype.push.apply(i,o[t].toShapes());return i}}),FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(t,n,i,o){const a=this,s=new FileLoader(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(a.withCredentials),s.load(t,(function(t){let i;try{i=JSON.parse(t)}catch(n){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}const o=a.parse(i);n&&n(o)}),i,o)},parse:function(t){return new Font(t)}});const Sa={getContext:function(){return void 0===xa&&(xa=new(window.AudioContext||window.webkitAudioContext)),xa},setContext:function(t){xa=t}};function AudioLoader(t){Loader.call(this,t)}function HemisphereLightProbe(t,n,i){LightProbe.call(this,void 0,i);const o=(new Color).set(t),a=(new Color).set(n),s=new Vector3(o.r,o.g,o.b),m=new Vector3(a.r,a.g,a.b),g=Math.sqrt(Math.PI),_=g*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(m).multiplyScalar(g),this.sh.coefficients[1].copy(s).sub(m).multiplyScalar(_)}function AmbientLightProbe(t,n){LightProbe.call(this,void 0,n);const i=(new Color).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(t,n,i,o){const a=this,s=new FileLoader(a.manager);s.setResponseType("arraybuffer"),s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(t,(function(i){try{const t=i.slice(0);Sa.getContext().decodeAudioData(t,(function(t){n(t)}))}catch(n){o?o(n):console.error(n),a.manager.itemError(t)}}),i,o)}}),HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}}),AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}});const Ma=new Matrix4,Ea=new Matrix4;function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(StereoCamera.prototype,{update:function(t){const n=this._cache;if(n.focus!==t.focus||n.fov!==t.fov||n.aspect!==t.aspect*this.aspect||n.near!==t.near||n.far!==t.far||n.zoom!==t.zoom||n.eyeSep!==this.eyeSep){n.focus=t.focus,n.fov=t.fov,n.aspect=t.aspect*this.aspect,n.near=t.near,n.far=t.far,n.zoom=t.zoom,n.eyeSep=this.eyeSep;const i=t.projectionMatrix.clone(),o=n.eyeSep/2,a=o*n.near/n.focus,s=n.near*Math.tan(ar.DEG2RAD*n.fov*.5)/n.zoom;let m,g;Ea.elements[12]=-o,Ma.elements[12]=o,m=-s*n.aspect+a,g=s*n.aspect+a,i.elements[0]=2*n.near/(g-m),i.elements[8]=(g+m)/(g-m),this.cameraL.projectionMatrix.copy(i),m=-s*n.aspect-a,g=s*n.aspect-a,i.elements[0]=2*n.near/(g-m),i.elements[8]=(g+m)/(g-m),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Ea),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Ma)}});class Clock{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}function now(){return("undefined"==typeof performance?Date:performance).now()}const Ta=new Vector3,Ca=new Quaternion,Oa=new Vector3,Aa=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=Sa.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const n=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ta,Ca,Oa),Aa.set(0,0,-1).applyQuaternion(Ca),n.positionX){const t=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(Ta.x,t),n.positionY.linearRampToValueAtTime(Ta.y,t),n.positionZ.linearRampToValueAtTime(Ta.z,t),n.forwardX.linearRampToValueAtTime(Aa.x,t),n.forwardY.linearRampToValueAtTime(Aa.y,t),n.forwardZ.linearRampToValueAtTime(Aa.z,t),n.upX.linearRampToValueAtTime(i.x,t),n.upY.linearRampToValueAtTime(i.y,t),n.upZ.linearRampToValueAtTime(i.z,t)}else n.setPosition(Ta.x,Ta.y,Ta.z),n.setOrientation(Aa.x,Aa.y,Aa.z,i.x,i.y,i.z)}}class Audio extends Object3D{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,n=this.filters.length;t<n;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,n=this.filters.length;t<n;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Pa=new Vector3,La=new Quaternion,Ra=new Vector3,Na=new Vector3;class PositionalAudio extends Audio{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,n,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=n,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Pa,La,Ra),Na.set(0,0,1).applyQuaternion(La);const n=this.panner;if(n.positionX){const t=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(Pa.x,t),n.positionY.linearRampToValueAtTime(Pa.y,t),n.positionZ.linearRampToValueAtTime(Pa.z,t),n.orientationX.linearRampToValueAtTime(Na.x,t),n.orientationY.linearRampToValueAtTime(Na.y,t),n.orientationZ.linearRampToValueAtTime(Na.z,t)}else n.setPosition(Pa.x,Pa.y,Pa.z),n.setOrientation(Na.x,Na.y,Na.z)}}class AudioAnalyser{constructor(t,n=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const n=this.getFrequencyData();for(let i=0;i<n.length;i++)t+=n[i];return t/n.length}}function PropertyMixer(t,n,i){let o,a,s;switch(this.binding=t,this.valueSize=i,n){case"quaternion":o=this._slerp,a=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":o=this._select,a=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:o=this._lerp,a=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=o,this._mixBufferRegionAdditive=a,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(PropertyMixer.prototype,{accumulate:function(t,n){const i=this.buffer,o=this.valueSize,a=t*o+o;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==o;++t)i[a+t]=i[t];s=n}else{s+=n;const t=n/s;this._mixBufferRegion(i,a,0,t,o)}this.cumulativeWeight=s},accumulateAdditive:function(t){const n=this.buffer,i=this.valueSize,o=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(n,o,0,t,i),this.cumulativeWeightAdditive+=t},apply:function(t){const n=this.valueSize,i=this.buffer,o=t*n+n,a=this.cumulativeWeight,s=this.cumulativeWeightAdditive,m=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const t=n*this._origIndex;this._mixBufferRegion(i,o,t,1-a,n)}s>0&&this._mixBufferRegionAdditive(i,o,this._addIndex*n,1,n);for(let t=n,a=n+n;t!==a;++t)if(i[t]!==i[t+n]){m.setValue(i,o);break}},saveOriginalState:function(){const t=this.binding,n=this.buffer,i=this.valueSize,o=i*this._origIndex;t.getValue(n,o);for(let t=i,a=o;t!==a;++t)n[t]=n[o+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,n=t+this.valueSize;for(let i=t;i<n;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[n+i]=this.buffer[t+i]},_select:function(t,n,i,o,a){if(o>=.5)for(let o=0;o!==a;++o)t[n+o]=t[i+o]},_slerp:function(t,n,i,o){Quaternion.slerpFlat(t,n,t,n,t,i,o)},_slerpAdditive:function(t,n,i,o,a){const s=this._workIndex*a;Quaternion.multiplyQuaternionsFlat(t,s,t,n,t,i),Quaternion.slerpFlat(t,n,t,n,t,s,o)},_lerp:function(t,n,i,o,a){const s=1-o;for(let m=0;m!==a;++m){const a=n+m;t[a]=t[a]*s+t[i+m]*o}},_lerpAdditive:function(t,n,i,o,a){for(let s=0;s!==a;++s){const a=n+s;t[a]=t[a]+t[i+s]*o}}});const Ia=new RegExp("[\\[\\]\\.:\\/]","g"),ka="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",ja=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Fa=/(WCOD+)?/.source.replace("WCOD",ka),Da=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ba=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Va=new RegExp("^"+ja+Fa+Da+Ba+"$"),Ua=["material","materials","bones"];function Composite(t,n,i){const o=i||PropertyBinding.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,o)}function PropertyBinding(t,n,i){this.path=n,this.parsedPath=i||PropertyBinding.parseTrackName(n),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function AnimationObjectGroup(){this.uuid=ar.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}Object.assign(Composite.prototype,{getValue:function(t,n){this.bind();const i=this._targetGroup.nCachedObjects_,o=this._bindings[i];void 0!==o&&o.getValue(t,n)},setValue:function(t,n){const i=this._bindings;for(let o=this._targetGroup.nCachedObjects_,a=i.length;o!==a;++o)i[o].setValue(t,n)},bind:function(){const t=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=t.length;n!==i;++n)t[n].bind()},unbind:function(){const t=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=t.length;n!==i;++n)t[n].unbind()}}),Object.assign(PropertyBinding,{Composite,create:function(t,n,i){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,n,i):new PropertyBinding(t,n,i)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(Ia,"")},parseTrackName:function(t){const n=Va.exec(t);if(!n)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},o=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==o&&-1!==o){const t=i.nodeName.substring(o+1);-1!==Ua.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,o),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i},findNode:function(t,n){if(!n||""===n||"."===n||-1===n||n===t.name||n===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(n);if(void 0!==i)return i}if(t.children){const searchNodeSubtree=function(t){for(let i=0;i<t.length;i++){const o=t[i];if(o.name===n||o.uuid===n)return o;const a=searchNodeSubtree(o.children);if(a)return a}return null},i=searchNodeSubtree(t.children);if(i)return i}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function getValue_direct(t,n){t[n]=this.node[this.propertyName]},function getValue_array(t,n){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)t[n++]=i[o]},function getValue_arrayElement(t,n){t[n]=this.resolvedProperty[this.propertyIndex]},function getValue_toArray(t,n){this.resolvedProperty.toArray(t,n)}],SetterByBindingTypeAndVersioning:[[function setValue_direct(t,n){this.targetObject[this.propertyName]=t[n]},function setValue_direct_setNeedsUpdate(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.needsUpdate=!0},function setValue_direct_setMatrixWorldNeedsUpdate(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_array(t,n){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)i[o]=t[n++]},function setValue_array_setNeedsUpdate(t,n){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)i[o]=t[n++];this.targetObject.needsUpdate=!0},function setValue_array_setMatrixWorldNeedsUpdate(t,n){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)i[o]=t[n++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_arrayElement(t,n){this.resolvedProperty[this.propertyIndex]=t[n]},function setValue_arrayElement_setNeedsUpdate(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.needsUpdate=!0},function setValue_arrayElement_setMatrixWorldNeedsUpdate(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_fromArray(t,n){this.resolvedProperty.fromArray(t,n)},function setValue_fromArray_setNeedsUpdate(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.needsUpdate=!0},function setValue_fromArray_setMatrixWorldNeedsUpdate(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function getValue_unbound(t,n){this.bind(),this.getValue(t,n)},setValue:function getValue_unbound(t,n){this.bind(),this.setValue(t,n)},bind:function(){let t=this.node;const n=this.parsedPath,i=n.objectName,o=n.propertyName;let a=n.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let o=n.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let n=0;n<t.length;n++)if(t[n].name===o){o=n;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}const s=t[o];if(void 0===s){const i=n.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+o+" but it wasn't found.",t)}let m=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?m=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(m=this.Versioning.MatrixWorldNeedsUpdate);let g=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===o){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}g=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=a}else void 0!==s.fromArray&&void 0!==s.toArray?(g=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(g=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=o;this.getValue=this.GetterByBindingType[g],this.setValue=this.SetterByBindingTypeAndVersioning[g][m]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length;let m=void 0,g=t.length,_=this.nCachedObjects_;for(let S=0,M=arguments.length;S!==M;++S){const M=arguments[S],T=M.uuid;let O=n[T];if(void 0===O){O=g++,n[T]=O,t.push(M);for(let t=0,n=s;t!==n;++t)a[t].push(new PropertyBinding(M,i[t],o[t]))}else if(O<_){m=t[O];const g=--_,S=t[g];n[S.uuid]=O,t[O]=S,n[T]=g,t[g]=M;for(let t=0,n=s;t!==n;++t){const n=a[t],s=n[g];let m=n[O];n[O]=s,void 0===m&&(m=new PropertyBinding(M,i[t],o[t])),n[g]=m}}else t[O]!==m&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=_},remove:function(){const t=this._objects,n=this._indicesByUUID,i=this._bindings,o=i.length;let a=this.nCachedObjects_;for(let s=0,m=arguments.length;s!==m;++s){const m=arguments[s],g=m.uuid,_=n[g];if(void 0!==_&&_>=a){const s=a++,S=t[s];n[S.uuid]=_,t[_]=S,n[g]=s,t[s]=m;for(let t=0,n=o;t!==n;++t){const n=i[t],o=n[s],a=n[_];n[_]=o,n[s]=a}}}this.nCachedObjects_=a},uncache:function(){const t=this._objects,n=this._indicesByUUID,i=this._bindings,o=i.length;let a=this.nCachedObjects_,s=t.length;for(let m=0,g=arguments.length;m!==g;++m){const g=arguments[m].uuid,_=n[g];if(void 0!==_)if(delete n[g],_<a){const m=--a,g=t[m],S=--s,M=t[S];n[g.uuid]=_,t[_]=g,n[M.uuid]=m,t[m]=M,t.pop();for(let t=0,n=o;t!==n;++t){const n=i[t],o=n[m],a=n[S];n[_]=o,n[m]=a,n.pop()}}else{const a=--s,m=t[a];a>0&&(n[m.uuid]=_),t[_]=m,t.pop();for(let t=0,n=o;t!==n;++t){const n=i[t];n[_]=n[a],n.pop()}}}this.nCachedObjects_=a},subscribe_:function(t,n){const i=this._bindingsIndicesByPath;let o=i[t];const a=this._bindings;if(void 0!==o)return a[o];const s=this._paths,m=this._parsedPaths,g=this._objects,_=g.length,S=this.nCachedObjects_,M=new Array(_);o=a.length,i[t]=o,s.push(t),m.push(n),a.push(M);for(let i=S,o=g.length;i!==o;++i){const o=g[i];M[i]=new PropertyBinding(o,t,n)}return M},unsubscribe_:function(t){const n=this._bindingsIndicesByPath,i=n[t];if(void 0!==i){const o=this._paths,a=this._parsedPaths,s=this._bindings,m=s.length-1,g=s[m];n[t[m]]=i,s[i]=g,s.pop(),a[i]=a[m],a.pop(),o[i]=o[m],o.pop()}}});class AnimationAction{constructor(t,n,i=null,o=n.blendMode){this._mixer=t,this._clip=n,this._localRoot=i,this.blendMode=o;const a=n.tracks,s=a.length,m=new Array(s),g={endingStart:hn,endingEnd:hn};for(let t=0;t!==s;++t){const n=a[t].createInterpolant(null);m[t]=n,n.settings=g}this._interpolantSettings=g,this._interpolants=m,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=an,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,n){return this.loop=t,this.repetitions=n,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,n,i){if(t.fadeOut(n),this.fadeIn(n),i){const i=this._clip.duration,o=t._clip.duration,a=o/i,s=i/o;t.warp(1,a,n),this.warp(s,1,n)}return this}crossFadeTo(t,n,i){return t.crossFadeFrom(this,n,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,n,i){const o=this._mixer,a=o.time,s=this.timeScale;let m=this._timeScaleInterpolant;null===m&&(m=o._lendControlInterpolant(),this._timeScaleInterpolant=m);const g=m.parameterPositions,_=m.sampleValues;return g[0]=a,g[1]=a+i,_[0]=t/s,_[1]=n/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,n,i,o){if(!this.enabled)return void this._updateWeight(t);const a=this._startTime;if(null!==a){const o=(t-a)*i;if(o<0||0===i)return;this._startTime=null,n=i*o}n*=this._updateTimeScale(t);const s=this._updateTime(n),m=this._updateWeight(t);if(m>0){const t=this._interpolants,n=this._propertyBindings;switch(this.blendMode){case mn:for(let i=0,o=t.length;i!==o;++i)t[i].evaluate(s),n[i].accumulateAdditive(m);break;case fn:default:for(let i=0,a=t.length;i!==a;++i)t[i].evaluate(s),n[i].accumulate(o,m)}}}_updateWeight(t){let n=0;if(this.enabled){n=this.weight;const i=this._weightInterpolant;if(null!==i){const o=i.evaluate(t)[0];n*=o,t>i.parameterPositions[1]&&(this.stopFading(),0===o&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(t){let n=0;if(!this.paused){n=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(n*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===n?this.paused=!0:this.timeScale=n))}return this._effectiveTimeScale=n,n}_updateTime(t){const n=this._clip.duration,i=this.loop;let o=this.time+t,a=this._loopCount;const s=i===sn;if(0===t)return-1===a?o:s&&1==(1&a)?n-o:o;if(i===rn){-1===a&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(o>=n)o=n;else{if(!(o<0)){this.time=o;break e}o=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===a&&(t>=0?(a=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),o>=n||o<0){const i=Math.floor(o/n);o-=n*i,a+=Math.abs(i);const m=this.repetitions-a;if(m<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o=t>0?n:0,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===m){const n=t<0;this._setEndings(n,!n,s)}else this._setEndings(!1,!1,s);this._loopCount=a,this.time=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=o;if(s&&1==(1&a))return n-o}return o}_setEndings(t,n,i){const o=this._interpolantSettings;i?(o.endingStart=dn,o.endingEnd=dn):(o.endingStart=t?this.zeroSlopeAtStart?dn:hn:pn,o.endingEnd=n?this.zeroSlopeAtEnd?dn:hn:pn)}_scheduleFading(t,n,i){const o=this._mixer,a=o.time;let s=this._weightInterpolant;null===s&&(s=o._lendControlInterpolant(),this._weightInterpolant=s);const m=s.parameterPositions,g=s.sampleValues;return m[0]=a,g[0]=n,m[1]=a+t,g[1]=i,this}}function AnimationMixer(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(t,n){const i=t._localRoot||this._root,o=t._clip.tracks,a=o.length,s=t._propertyBindings,m=t._interpolants,g=i.uuid,_=this._bindingsByRootAndName;let S=_[g];void 0===S&&(S={},_[g]=S);for(let t=0;t!==a;++t){const a=o[t],_=a.name;let M=S[_];if(void 0!==M)s[t]=M;else{if(M=s[t],void 0!==M){null===M._cacheIndex&&(++M.referenceCount,this._addInactiveBinding(M,g,_));continue}const o=n&&n._propertyBindings[t].binding.parsedPath;M=new PropertyMixer(PropertyBinding.create(i,_,o),a.ValueTypeName,a.getValueSize()),++M.referenceCount,this._addInactiveBinding(M,g,_),s[t]=M}m[t].resultBuffer=M.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const n=(t._localRoot||this._root).uuid,i=t._clip.uuid,o=this._actionsByClip[i];this._bindAction(t,o&&o.knownActions[0]),this._addInactiveAction(t,i,n)}const n=t._propertyBindings;for(let t=0,i=n.length;t!==i;++t){const i=n[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const n=t._propertyBindings;for(let t=0,i=n.length;t!==i;++t){const i=n[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const n=t._cacheIndex;return null!==n&&n<this._nActiveActions},_addInactiveAction:function(t,n,i){const o=this._actions,a=this._actionsByClip;let s=a[n];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,a[n]=s;else{const n=s.knownActions;t._byClipCacheIndex=n.length,n.push(t)}t._cacheIndex=o.length,o.push(t),s.actionByRoot[i]=t},_removeInactiveAction:function(t){const n=this._actions,i=n[n.length-1],o=t._cacheIndex;i._cacheIndex=o,n[o]=i,n.pop(),t._cacheIndex=null;const a=t._clip.uuid,s=this._actionsByClip,m=s[a],g=m.knownActions,_=g[g.length-1],S=t._byClipCacheIndex;_._byClipCacheIndex=S,g[S]=_,g.pop(),t._byClipCacheIndex=null,delete m.actionByRoot[(t._localRoot||this._root).uuid],0===g.length&&delete s[a],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const n=t._propertyBindings;for(let t=0,i=n.length;t!==i;++t){const i=n[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){const n=this._actions,i=t._cacheIndex,o=this._nActiveActions++,a=n[o];t._cacheIndex=o,n[o]=t,a._cacheIndex=i,n[i]=a},_takeBackAction:function(t){const n=this._actions,i=t._cacheIndex,o=--this._nActiveActions,a=n[o];t._cacheIndex=o,n[o]=t,a._cacheIndex=i,n[i]=a},_addInactiveBinding:function(t,n,i){const o=this._bindingsByRootAndName,a=this._bindings;let s=o[n];void 0===s&&(s={},o[n]=s),s[i]=t,t._cacheIndex=a.length,a.push(t)},_removeInactiveBinding:function(t){const n=this._bindings,i=t.binding,o=i.rootNode.uuid,a=i.path,s=this._bindingsByRootAndName,m=s[o],g=n[n.length-1],_=t._cacheIndex;g._cacheIndex=_,n[_]=g,n.pop(),delete m[a],0===Object.keys(m).length&&delete s[o]},_lendBinding:function(t){const n=this._bindings,i=t._cacheIndex,o=this._nActiveBindings++,a=n[o];t._cacheIndex=o,n[o]=t,a._cacheIndex=i,n[i]=a},_takeBackBinding:function(t){const n=this._bindings,i=t._cacheIndex,o=--this._nActiveBindings,a=n[o];t._cacheIndex=o,n[o]=t,a._cacheIndex=i,n[i]=a},_lendControlInterpolant:function(){const t=this._controlInterpolants,n=this._nActiveControlInterpolants++;let i=t[n];return void 0===i&&(i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=n,t[n]=i),i},_takeBackControlInterpolant:function(t){const n=this._controlInterpolants,i=t.__cacheIndex,o=--this._nActiveControlInterpolants,a=n[o];t.__cacheIndex=o,n[o]=t,a.__cacheIndex=i,n[i]=a},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,n,i){const o=n||this._root,a=o.uuid;let s="string"==typeof t?AnimationClip.findByName(o,t):t;const m=null!==s?s.uuid:t,g=this._actionsByClip[m];let _=null;if(void 0===i&&(i=null!==s?s.blendMode:fn),void 0!==g){const t=g.actionByRoot[a];if(void 0!==t&&t.blendMode===i)return t;_=g.knownActions[0],null===s&&(s=_._clip)}if(null===s)return null;const S=new AnimationAction(this,s,n,i);return this._bindAction(S,_),this._addInactiveAction(S,m,a),S},existingAction:function(t,n){const i=n||this._root,o=i.uuid,a="string"==typeof t?AnimationClip.findByName(i,t):t,s=a?a.uuid:t,m=this._actionsByClip[s];return void 0!==m&&m.actionByRoot[o]||null},stopAllAction:function(){const t=this._actions;for(let n=this._nActiveActions-1;n>=0;--n)t[n].stop();return this},update:function(t){t*=this.timeScale;const n=this._actions,i=this._nActiveActions,o=this.time+=t,a=Math.sign(t),s=this._accuIndex^=1;for(let m=0;m!==i;++m)n[m]._update(o,t,a,s);const m=this._bindings,g=this._nActiveBindings;for(let t=0;t!==g;++t)m[t].apply(s);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const n=this._actions,i=t.uuid,o=this._actionsByClip,a=o[i];if(void 0!==a){const t=a.knownActions;for(let i=0,o=t.length;i!==o;++i){const o=t[i];this._deactivateAction(o);const a=o._cacheIndex,s=n[n.length-1];o._cacheIndex=null,o._byClipCacheIndex=null,s._cacheIndex=a,n[a]=s,n.pop(),this._removeInactiveBindingsForAction(o)}delete o[i]}},uncacheRoot:function(t){const n=t.uuid,i=this._actionsByClip;for(const t in i){const o=i[t].actionByRoot[n];void 0!==o&&(this._deactivateAction(o),this._removeInactiveAction(o))}const o=this._bindingsByRootAndName[n];if(void 0!==o)for(const t in o){const n=o[t];n.restoreOriginalState(),this._removeInactiveBinding(n)}},uncacheAction:function(t,n){const i=this.existingAction(t,n);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}});class Uniform{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}function InstancedInterleavedBuffer(t,n,i){InterleavedBuffer.call(this,t,n),this.meshPerAttribute=i||1}function GLBufferAttribute(t,n,i,o,a){this.buffer=t,this.type=n,this.itemSize=i,this.elementSize=o,this.count=a,this.version=0}function Raycaster(t,n,i,o){this.ray=new Ray(t,n),this.near=i||0,this.far=o||1/0,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(t,n){return t.distance-n.distance}function intersectObject(t,n,i,o){if(t.layers.test(n.layers)&&t.raycast(n,i),!0===o){const o=t.children;for(let t=0,a=o.length;t<a;t++)intersectObject(o[t],n,i,!0)}}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(t){return InterleavedBuffer.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const n=InterleavedBuffer.prototype.clone.call(this,t);return n.meshPerAttribute=this.meshPerAttribute,n},toJSON:function(t){const n=InterleavedBuffer.prototype.toJSON.call(this,t);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}),Object.defineProperty(GLBufferAttribute.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(GLBufferAttribute.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,n){return this.type=t,this.elementSize=n,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(Raycaster.prototype,{set:function(t,n){this.ray.set(t,n)},setFromCamera:function(t,n){n&&n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n&&n.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)},intersectObject:function(t,n,i){const o=i||[];return intersectObject(t,this,o,n),o.sort(ascSort),o},intersectObjects:function(t,n,i){const o=i||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(let i=0,a=t.length;i<a;i++)intersectObject(t[i],this,o,n);return o.sort(ascSort),o}});class Spherical{constructor(t=1,n=0,i=0){return this.radius=t,this.phi=n,this.theta=i,this}set(t,n,i){return this.radius=t,this.phi=n,this.theta=i,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,n,i){return this.radius=Math.sqrt(t*t+n*n+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(ar.clamp(n/this.radius,-1,1))),this}}class Cylindrical{constructor(t,n,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==n?n:0,this.y=void 0!==i?i:0,this}set(t,n,i){return this.radius=t,this.theta=n,this.y=i,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,n,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=n,this}}const Ga=new Vector2;class Box2{constructor(t,n){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new Vector2(1/0,1/0),this.max=void 0!==n?n:new Vector2(-1/0,-1/0)}set(t,n){return this.min.copy(t),this.max.copy(n),this}setFromPoints(t){this.makeEmpty();for(let n=0,i=t.length;n<i;n++)this.expandByPoint(t[n]);return this}setFromCenterAndSize(t,n){const i=Ga.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Vector2),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Vector2),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,n){return void 0===n&&(console.warn("THREE.Box2: .getParameter() target is now required"),n=new Vector2),n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,n){return void 0===n&&(console.warn("THREE.Box2: .clampPoint() target is now required"),n=new Vector2),n.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Ga.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const za=new Vector3,Ha=new Vector3;class Line3{constructor(t,n){this.start=void 0!==t?t:new Vector3,this.end=void 0!==n?n:new Vector3}set(t,n){return this.start.copy(t),this.end.copy(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Vector3),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Vector3),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,n){return void 0===n&&(console.warn("THREE.Line3: .at() target is now required"),n=new Vector3),this.delta(n).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,n){za.subVectors(t,this.start),Ha.subVectors(this.end,this.start);const i=Ha.dot(Ha);let o=Ha.dot(za)/i;return n&&(o=ar.clamp(o,0,1)),o}closestPointToPoint(t,n,i){const o=this.closestPointToPointParameter(t,n);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new Vector3),this.delta(i).multiplyScalar(o).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}function ImmediateRenderObject(t){Object3D.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0;const Wa=new Vector3;class SpotLightHelper extends Object3D{constructor(t,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new BufferGeometry,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,n=1,i=32;t<i;t++,n++){const a=t/i*Math.PI*2,s=n/i*Math.PI*2;o.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Float32BufferAttribute(o,3));const a=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(i,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,n=t*Math.tan(this.light.angle);this.cone.scale.set(n,n,t),Wa.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Wa),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const qa=new Vector3,Za=new Matrix4,Xa=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const n=function getBoneList(t){const n=[];t&&t.isBone&&n.push(t);for(let i=0;i<t.children.length;i++)n.push.apply(n,getBoneList(t.children[i]));return n}(t),i=new BufferGeometry,o=[],a=[],s=new Color(0,0,1),m=new Color(0,1,0);for(let t=0;t<n.length;t++){const i=n[t];i.parent&&i.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),a.push(s.r,s.g,s.b),a.push(m.r,m.g,m.b))}i.setAttribute("position",new Float32BufferAttribute(o,3)),i.setAttribute("color",new Float32BufferAttribute(a,3)),super(i,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=n,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const n=this.bones,i=this.geometry,o=i.getAttribute("position");Xa.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<n.length;t++){const a=n[t];a.parent&&a.parent.isBone&&(Za.multiplyMatrices(Xa,a.matrixWorld),qa.setFromMatrixPosition(Za),o.setXYZ(i,qa.x,qa.y,qa.z),Za.multiplyMatrices(Xa,a.parent.matrixWorld),qa.setFromMatrixPosition(Za),o.setXYZ(i+1,qa.x,qa.y,qa.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}class PointLightHelper extends Mesh{constructor(t,n,i){super(new SphereBufferGeometry(n,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Qa=new Vector3,Ya=new Color,Ja=new Color;class HemisphereLightHelper extends Object3D{constructor(t,n,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const o=new OctahedronBufferGeometry(n);o.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const a=o.getAttribute("position"),s=new Float32Array(3*a.count);o.setAttribute("color",new BufferAttribute(s,3)),this.add(new Mesh(o,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const n=t.geometry.getAttribute("color");Ya.copy(this.light.color),Ja.copy(this.light.groundColor);for(let t=0,i=n.count;t<i;t++){const o=t<i/2?Ya:Ja;n.setXYZ(t,o.r,o.g,o.b)}n.needsUpdate=!0}t.lookAt(Qa.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(t=10,n=10,i=4473924,o=8947848){i=new Color(i),o=new Color(o);const a=n/2,s=t/n,m=t/2,g=[],_=[];for(let t=0,S=0,M=-m;t<=n;t++,M+=s){g.push(-m,0,M,m,0,M),g.push(M,0,-m,M,0,m);const n=t===a?i:o;n.toArray(_,S),S+=3,n.toArray(_,S),S+=3,n.toArray(_,S),S+=3,n.toArray(_,S),S+=3}const S=new BufferGeometry;S.setAttribute("position",new Float32BufferAttribute(g,3)),S.setAttribute("color",new Float32BufferAttribute(_,3)),super(S,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class PolarGridHelper extends LineSegments{constructor(t=10,n=16,i=8,o=64,a=4473924,s=8947848){a=new Color(a),s=new Color(s);const m=[],g=[];for(let i=0;i<=n;i++){const o=i/n*(2*Math.PI),_=Math.sin(o)*t,S=Math.cos(o)*t;m.push(0,0,0),m.push(_,0,S);const M=1&i?a:s;g.push(M.r,M.g,M.b),g.push(M.r,M.g,M.b)}for(let n=0;n<=i;n++){const _=1&n?a:s,S=t-t/i*n;for(let t=0;t<o;t++){let n=t/o*(2*Math.PI),i=Math.sin(n)*S,a=Math.cos(n)*S;m.push(i,0,a),g.push(_.r,_.g,_.b),n=(t+1)/o*(2*Math.PI),i=Math.sin(n)*S,a=Math.cos(n)*S,m.push(i,0,a),g.push(_.r,_.g,_.b)}}const _=new BufferGeometry;_.setAttribute("position",new Float32BufferAttribute(m,3)),_.setAttribute("color",new Float32BufferAttribute(g,3)),super(_,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const Ka=new Vector3,$a=new Vector3,es=new Vector3;class DirectionalLightHelper extends Object3D{constructor(t,n,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===n&&(n=1);let o=new BufferGeometry;o.setAttribute("position",new Float32BufferAttribute([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));const a=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(o,a),this.add(this.lightPlane),o=new BufferGeometry,o.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(o,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Ka.setFromMatrixPosition(this.light.matrixWorld),$a.setFromMatrixPosition(this.light.target.matrixWorld),es.subVectors($a,Ka),this.lightPlane.lookAt($a),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt($a),this.targetLine.scale.z=es.length()}}const ts=new Vector3,ns=new Camera;class CameraHelper extends LineSegments{constructor(t){const n=new BufferGeometry,i=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],a=[],s={},m=new Color(16755200),g=new Color(16711680),_=new Color(43775),S=new Color(16777215),M=new Color(3355443);function addLine(t,n,i){addPoint(t,i),addPoint(n,i)}function addPoint(t,n){o.push(0,0,0),a.push(n.r,n.g,n.b),void 0===s[t]&&(s[t]=[]),s[t].push(o.length/3-1)}addLine("n1","n2",m),addLine("n2","n4",m),addLine("n4","n3",m),addLine("n3","n1",m),addLine("f1","f2",m),addLine("f2","f4",m),addLine("f4","f3",m),addLine("f3","f1",m),addLine("n1","f1",m),addLine("n2","f2",m),addLine("n3","f3",m),addLine("n4","f4",m),addLine("p","n1",g),addLine("p","n2",g),addLine("p","n3",g),addLine("p","n4",g),addLine("u1","u2",_),addLine("u2","u3",_),addLine("u3","u1",_),addLine("c","t",S),addLine("p","c",M),addLine("cn1","cn2",M),addLine("cn3","cn4",M),addLine("cf1","cf2",M),addLine("cf3","cf4",M),n.setAttribute("position",new Float32BufferAttribute(o,3)),n.setAttribute("color",new Float32BufferAttribute(a,3)),super(n,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,n=this.pointMap;ns.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",n,t,ns,0,0,-1),setPoint("t",n,t,ns,0,0,1),setPoint("n1",n,t,ns,-1,-1,-1),setPoint("n2",n,t,ns,1,-1,-1),setPoint("n3",n,t,ns,-1,1,-1),setPoint("n4",n,t,ns,1,1,-1),setPoint("f1",n,t,ns,-1,-1,1),setPoint("f2",n,t,ns,1,-1,1),setPoint("f3",n,t,ns,-1,1,1),setPoint("f4",n,t,ns,1,1,1),setPoint("u1",n,t,ns,.7,1.1,-1),setPoint("u2",n,t,ns,-.7,1.1,-1),setPoint("u3",n,t,ns,0,2,-1),setPoint("cf1",n,t,ns,-1,0,1),setPoint("cf2",n,t,ns,1,0,1),setPoint("cf3",n,t,ns,0,-1,1),setPoint("cf4",n,t,ns,0,1,1),setPoint("cn1",n,t,ns,-1,0,-1),setPoint("cn2",n,t,ns,1,0,-1),setPoint("cn3",n,t,ns,0,-1,-1),setPoint("cn4",n,t,ns,0,1,-1),t.getAttribute("position").needsUpdate=!0}}function setPoint(t,n,i,o,a,s,m){ts.set(a,s,m).unproject(o);const g=n[t];if(void 0!==g){const t=i.getAttribute("position");for(let n=0,i=g.length;n<i;n++)t.setXYZ(g[n],ts.x,ts.y,ts.z)}}const rs=new Box3;class BoxHelper extends LineSegments{constructor(t,n=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),a=new BufferGeometry;a.setIndex(new BufferAttribute(i,1)),a.setAttribute("position",new BufferAttribute(o,3)),super(a,new LineBasicMaterial({color:n,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&rs.setFromObject(this.object),rs.isEmpty())return;const n=rs.min,i=rs.max,o=this.geometry.attributes.position,a=o.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=n.x,a[4]=i.y,a[5]=i.z,a[6]=n.x,a[7]=n.y,a[8]=i.z,a[9]=i.x,a[10]=n.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=n.z,a[15]=n.x,a[16]=i.y,a[17]=n.z,a[18]=n.x,a[19]=n.y,a[20]=n.z,a[21]=i.x,a[22]=n.y,a[23]=n.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return LineSegments.prototype.copy.call(this,t),this.object=t.object,this}}class Box3Helper extends LineSegments{constructor(t,n=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new BufferGeometry;o.setIndex(new BufferAttribute(i,1)),o.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(o,new LineBasicMaterial({color:n,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}class PlaneHelper extends Line{constructor(t,n=1,i=16776960){const o=i,a=new BufferGeometry;a.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),a.computeBoundingSphere(),super(a,new LineBasicMaterial({color:o,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=n;const s=new BufferGeometry;s.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new Mesh(s,new MeshBasicMaterial({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let n=-this.plane.constant;Math.abs(n)<1e-8&&(n=1e-8),this.scale.set(.5*this.size,.5*this.size,n),this.children[0].material.side=n<0?L:P,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}const is=new Vector3;let os,as;class ArrowHelper extends Object3D{constructor(t,n,i,o,a,s){super(),this.type="ArrowHelper",void 0===t&&(t=new Vector3(0,0,1)),void 0===n&&(n=new Vector3(0,0,0)),void 0===i&&(i=1),void 0===o&&(o=16776960),void 0===a&&(a=.2*i),void 0===s&&(s=.2*a),void 0===os&&(os=new BufferGeometry,os.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),as=new CylinderBufferGeometry(0,.5,1,5,1),as.translate(0,-.5,0)),this.position.copy(n),this.line=new Line(os,new LineBasicMaterial({color:o,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(as,new MeshBasicMaterial({color:o,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,a,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{is.set(t.z,0,-t.x).normalize();const n=Math.acos(t.y);this.quaternion.setFromAxisAngle(is,n)}}setLength(t,n,i){void 0===n&&(n=.2*t),void 0===i&&(i=.2*n),this.line.scale.set(1,Math.max(1e-4,t-n),1),this.line.updateMatrix(),this.cone.scale.set(i,n,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class AxesHelper extends LineSegments{constructor(t=1){const n=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute(n,3)),i.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const ss=new Float32Array(1),cs=new Int32Array(ss.buffer),us={toHalfFloat:function(t){ss[0]=t;const n=cs[0];let i=n>>16&32768,o=n>>12&2047;const a=n>>23&255;return a<103?i:a>142?(i|=31744,i|=(255==a?0:1)&&8388607&n,i):a<113?(o|=2048,i|=(o>>114-a)+(o>>113-a&1),i):(i|=a-112<<10|o>>1,i+=1&o,i)}},ls=Math.pow(2,8),hs=[.125,.215,.35,.446,.526,.582],ds=5+hs.length,ps={[bn]:0,[_n]:1,[xn]:2,[Mn]:3,[En]:4,[Tn]:5,[wn]:6},fs=new OrthographicCamera,{_lodPlanes:ms,_sizeLods:gs,_sigmas:ys}=function _createPlanes(){const t=[],n=[],i=[];let o=8;for(let a=0;a<ds;a++){const s=Math.pow(2,o);n.push(s);let m=1/s;a>4?m=hs[a-8+4-1]:0==a&&(m=0),i.push(m);const g=1/(s-1),_=-g/2,S=1+g/2,M=[_,_,S,_,S,S,_,_,S,S,_,S],T=6,O=6,A=3,P=2,L=1,R=new Float32Array(A*O*T),N=new Float32Array(P*O*T),I=new Float32Array(L*O*T);for(let t=0;t<T;t++){const n=t%3*2/3-1,i=t>2?0:-1,o=[n,i,0,n+2/3,i,0,n+2/3,i+1,0,n,i,0,n+2/3,i+1,0,n,i+1,0];R.set(o,A*O*t),N.set(M,P*O*t);const a=[t,t,t,t,t,t];I.set(a,L*O*t)}const j=new BufferGeometry;j.setAttribute("position",new BufferAttribute(R,A)),j.setAttribute("uv",new BufferAttribute(N,P)),j.setAttribute("faceIndex",new BufferAttribute(I,L)),t.push(j),o>4&&o--}return{_lodPlanes:t,_sizeLods:n,_sigmas:i}}(),vs=new Color;let bs=null;const _s=(1+Math.sqrt(5))/2,ws=1/_s,xs=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,_s,ws),new Vector3(0,_s,-ws),new Vector3(ws,0,_s),new Vector3(-ws,0,_s),new Vector3(_s,ws,0),new Vector3(-_s,ws,0)];class PMREMGenerator{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function _getBlurShader(t){return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(t)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Vector3(0,1,0)},inputEncoding:{value:ps[bn]},outputEncoding:{value:ps[bn]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:j,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,n=0,i=.1,o=100){bs=this._renderer.getRenderTarget();const a=this._allocateTargets();return this._sceneToCubeUV(t,i,o,a),n>0&&this._blur(a,0,0,n),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=_getCubemapShader(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=_getEquirectShader(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<ms.length;t++)ms[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(bs),t.scissorTest=!1,_setViewport(t,0,0,t.width,t.height)}_fromTexture(t){bs=this._renderer.getRenderTarget();const n=this._allocateTargets(t);return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(t){const n={magFilter:ke,minFilter:ke,generateMipmaps:!1,type:We,format:ct,encoding:_isLDR(t)?t.encoding:xn,depthBuffer:!1},i=_createRenderTarget(n);return i.depthBuffer=!t,this._pingPongRenderTarget=_createRenderTarget(n),i}_compileMaterial(t){const n=new Mesh(ms[0],t);this._renderer.compile(n,fs)}_sceneToCubeUV(t,n,i,o){const a=new PerspectiveCamera(90,1,n,i),s=[1,-1,1,1,1,1],m=[1,1,1,-1,-1,-1],g=this._renderer,_=g.outputEncoding,S=g.toneMapping;g.getClearColor(vs);const M=g.getClearAlpha();g.toneMapping=be,g.outputEncoding=bn;let T=t.background;if(T&&T.isColor){T.convertSRGBToLinear();const n=Math.max(T.r,T.g,T.b),i=Math.min(Math.max(Math.ceil(Math.log2(n)),-128),127);T=T.multiplyScalar(Math.pow(2,-i));const o=(i+128)/255;g.setClearColor(T,o),t.background=null}for(let n=0;n<6;n++){const i=n%3;0==i?(a.up.set(0,s[n],0),a.lookAt(m[n],0,0)):1==i?(a.up.set(0,0,s[n]),a.lookAt(0,m[n],0)):(a.up.set(0,s[n],0),a.lookAt(0,0,m[n])),_setViewport(o,i*ls,n>2?ls:0,ls,ls),g.setRenderTarget(o),g.render(t,a)}g.toneMapping=S,g.outputEncoding=_,g.setClearColor(vs,M)}_textureToCubeUV(t,n){const i=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=_getCubemapShader()):null==this._equirectShader&&(this._equirectShader=_getEquirectShader());const o=t.isCubeTexture?this._cubemapShader:this._equirectShader,a=new Mesh(ms[0],o),s=o.uniforms;s.envMap.value=t,t.isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),s.inputEncoding.value=ps[t.encoding],s.outputEncoding.value=ps[n.texture.encoding],_setViewport(n,0,0,3*ls,2*ls),i.setRenderTarget(n),i.render(a,fs)}_applyPMREM(t){const n=this._renderer,i=n.autoClear;n.autoClear=!1;for(let n=1;n<ds;n++){const i=Math.sqrt(ys[n]*ys[n]-ys[n-1]*ys[n-1]),o=xs[(n-1)%xs.length];this._blur(t,n-1,n,i,o)}n.autoClear=i}_blur(t,n,i,o,a){const s=this._pingPongRenderTarget;this._halfBlur(t,s,n,i,o,"latitudinal",a),this._halfBlur(s,t,i,i,o,"longitudinal",a)}_halfBlur(t,n,i,o,a,s,m){const g=this._renderer,_=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const S=new Mesh(ms[o],_),M=_.uniforms,T=gs[i]-1,O=isFinite(a)?Math.PI/(2*T):2*Math.PI/39,A=a/O,P=isFinite(a)?1+Math.floor(3*A):20;P>20&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${P} samples when the maximum is set to 20`);const L=[];let R=0;for(let t=0;t<20;++t){const n=t/A,i=Math.exp(-n*n/2);L.push(i),0==t?R+=i:t<P&&(R+=2*i)}for(let t=0;t<L.length;t++)L[t]=L[t]/R;M.envMap.value=t.texture,M.samples.value=P,M.weights.value=L,M.latitudinal.value="latitudinal"===s,m&&(M.poleAxis.value=m),M.dTheta.value=O,M.mipInt.value=8-i,M.inputEncoding.value=ps[t.texture.encoding],M.outputEncoding.value=ps[t.texture.encoding];const N=gs[o];_setViewport(n,3*Math.max(0,ls-2*N),(0===o?0:2*ls)+2*N*(o>4?o-8+4:0),3*N,2*N),g.setRenderTarget(n),g.render(S,fs)}}function _isLDR(t){return void 0!==t&&t.type===We&&(t.encoding===bn||t.encoding===_n||t.encoding===wn)}function _createRenderTarget(t){const n=new WebGLRenderTarget(3*ls,3*ls,t);return n.texture.mapping=Pe,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function _setViewport(t,n,i,o,a){t.viewport.set(n,i,o,a),t.scissor.set(n,i,o,a)}function _getEquirectShader(){return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Vector2(1,1)},inputEncoding:{value:ps[bn]},outputEncoding:{value:ps[bn]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:j,depthTest:!1,depthWrite:!1})}function _getCubemapShader(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ps[bn]},outputEncoding:{value:ps[bn]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:j,depthTest:!1,depthWrite:!1})}function Face4(t,n,i,o,a,s,m){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(t,n,i,a,s,m)}const Ss=0,Ms=1,Es=0,Ts=1,Cs=2;function MeshFaceMaterial(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function MultiMaterial(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function PointCloud(t,n){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(t,n)}function Particle(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(t)}function ParticleSystem(t,n){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(t,n)}function PointCloudMaterial(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleBasicMaterial(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleSystemMaterial(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function Vertex(t,n,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(t,n,i)}function DynamicBufferAttribute(t,n){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new BufferAttribute(t,n).setUsage(Xn)}function Int8Attribute(t,n){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(t,n)}function Uint8Attribute(t,n){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(t,n)}function Uint8ClampedAttribute(t,n){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(t,n)}function Int16Attribute(t,n){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(t,n)}function Uint16Attribute(t,n){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(t,n)}function Int32Attribute(t,n){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(t,n)}function Uint32Attribute(t,n){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(t,n)}function Float32Attribute(t,n){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(t,n)}function Float64Attribute(t,n){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(t,n)}function ClosedSplineCurve3(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom",this.closed=!0}function SplineCurve3(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom"}function Spline(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom"}function AxisHelper(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(t)}function BoundingBoxHelper(t,n){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(t,n)}function EdgesHelper(t,n){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(t.geometry),new LineBasicMaterial({color:void 0!==n?n:16777215}))}function WireframeHelper(t,n){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(t.geometry),new LineBasicMaterial({color:void 0!==n?n:16777215}))}function XHRLoader(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(t)}function BinaryTextureLoader(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(t)}function WebGLRenderTargetCube(t,n,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new WebGLCubeRenderTarget(t,i)}Curve.create=function(t,n){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Curve.prototype),t.prototype.constructor=t,t.prototype.getPoint=n,t},Object.assign(CurvePath.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const n=this.getPoints(t);return this.createGeometry(n)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const n=this.getSpacedPoints(t);return this.createGeometry(n)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const n=new Geometry;for(let i=0,o=t.length;i<o;i++){const o=t[i];n.vertices.push(new Vector3(o.x,o.y,o.z||0))}return n}}),Object.assign(Path.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),SplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Loader.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),va.extractUrlBase(t)}}),Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Box2.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Box3.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Sphere.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Frustum.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Line3.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(ar,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),ar.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),ar.ceilPowerOfTwo(t)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(t,n){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,n)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Object.assign(Matrix4.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,n){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,n)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,n,i,o,a,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,n,o,i,a,s)},getInverse:function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Plane.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Object.assign(Quaternion.prototype,{multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(Ray.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,n)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Triangle,{barycoordFromPoint:function(t,n,i,o,a){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(t,n,i,o,a)},normal:function(t,n,i,o){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(t,n,i,o)}}),Object.assign(Shape.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,t)}}),Object.assign(Vector2.prototype,{fromAttribute:function(t,n,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,n,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,n){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(n,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,n,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,n,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(t,n,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,n,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(Object3D.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,n){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(n,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Mesh.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),gn},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),PerspectiveCamera.prototype.setLens=function(t,n){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==n&&(this.filmGauge=n),this.setFocalLength(t)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Xn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Xn)}}}),Object.assign(BufferAttribute.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Xn:Zn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(BufferGeometry.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,n){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),n&&n.isBufferAttribute||n&&n.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(n),this):this.setAttribute(t,n):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new BufferAttribute(arguments[1],arguments[2])))},addDrawCall:function(t,n,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,n)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(InstancedBufferGeometry.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(Raycaster.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Xn},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(InterleavedBuffer.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Xn:Zn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Scene.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===N}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(MeshPhysicalMaterial.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(WebGLRenderer.prototype,{clearTarget:function(t,n,i,o){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(n,i,o)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?_n:bn}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Audio.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const n=this;return(new AudioLoader).load(t,(function(t){n.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(t,n){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,n)},CubeCamera.prototype.clear=function(t,n,i,o){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,n,i,o)};const Os={merge:function(t,n,i){let o;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),n.isMesh&&(n.matrixAutoUpdate&&n.updateMatrix(),o=n.matrix,n=n.geometry),t.merge(n,o,i)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function CanvasRenderer(){console.error("THREE.CanvasRenderer has been removed")}function JSONLoader(){console.error("THREE.JSONLoader has been removed.")}cr.crossOrigin=void 0,cr.loadTexture=function(t,n,i,o){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const a=new TextureLoader;a.setCrossOrigin(this.crossOrigin);const s=a.load(t,i,void 0,o);return n&&(s.mapping=n),s},cr.loadTextureCube=function(t,n,i,o){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const a=new CubeTextureLoader;a.setCrossOrigin(this.crossOrigin);const s=a.load(t,i,void 0,o);return n&&(s.mapping=n),s},cr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},cr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const As={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:o}}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return __extends}));var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)};function __extends(t,n){function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}},function(t,n,i){"use strict";i.d(n,"a",(function(){return TempNode}));var o=i(0),a=i(8);function TempNode(t,n){a.a.call(this,t),n=n||{},this.shared=void 0===n.shared||n.shared,this.unique=void 0!==n.unique&&n.unique}TempNode.prototype=Object.create(a.a.prototype),TempNode.prototype.constructor=TempNode,TempNode.prototype.build=function(t,n,i,s){if(n=n||this.getType(t),this.getShared(t,n)){var m=this.getUnique(t,n);m&&void 0===this.constructor.uuid&&(this.constructor.uuid=o.MathUtils.generateUUID()),i=t.getUuid(i||this.getUuid(),!m);var g=t.getNodeData(i),_=g.output||this.getType(t);if(t.analyzing)return(g.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,g,n),this.generate(t,n,i)):a.a.prototype.build.call(this,t,n,i);if(m)return g.name=g.name||a.a.prototype.build.call(this,t,n,i),g.name;if(!this.getLabel()&&(!this.getShared(t,_)||t.context.ignoreCache||1===g.deps))return a.a.prototype.build.call(this,t,n,i);i=this.getUuid(!1);var S=this.getTemp(t,i);if(S)return t.format(S,_,n);S=TempNode.prototype.generate.call(this,t,n,i,g.output,s);var M=this.generate(t,_,i);return t.addNodeCode(S+" = "+M+";"),t.format(S,_,n)}return a.a.prototype.build.call(this,t,n,i)},TempNode.prototype.getShared=function(t,n){return"sampler2D"!==n&&"samplerCube"!==n&&this.shared},TempNode.prototype.getUnique=function(){return this.unique},TempNode.prototype.setLabel=function(t){return this.label=t,this},TempNode.prototype.getLabel=function(){return this.label},TempNode.prototype.getUuid=function(t){var n=(t||null==t)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(n=this.scope+"-"+n),n},TempNode.prototype.getTemp=function(t,n){n=n||this.uuid;var i=t.getVars()[n];return i?i.name:void 0},TempNode.prototype.generate=function(t,n,i,o,a){return this.getShared(t,n)||console.error("THREE.TempNode is not shared!"),i=i||this.uuid,t.getTempVar(i,o||this.getType(t),a,this.getLabel()).name}},function(t,n,i){"use strict";i.d(n,"a",(function(){return M}));var o=i(1),a=i(59),s=i(117),m=i(9),g=i(89),_=i(39),S=i(76),M=function(t){function Subscriber(n,i,o){var a=t.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=s.a;break;case 1:if(!n){a.destination=s.a;break}if("object"==typeof n){n instanceof Subscriber?(a.syncErrorThrowable=n.syncErrorThrowable,a.destination=n,n.add(a)):(a.syncErrorThrowable=!0,a.destination=new T(a,n));break}default:a.syncErrorThrowable=!0,a.destination=new T(a,n,i,o)}return a}return o.a(Subscriber,t),Subscriber.prototype[g.a]=function(){return this},Subscriber.create=function(t,n,i){var o=new Subscriber(t,n,i);return o.syncErrorThrowable=!1,o},Subscriber.prototype.next=function(t){this.isStopped||this._next(t)},Subscriber.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},Subscriber.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},Subscriber.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},Subscriber.prototype._next=function(t){this.destination.next(t)},Subscriber.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},Subscriber.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},Subscriber.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},Subscriber}(m.a),T=function(t){function SafeSubscriber(n,i,o,m){var g,_=t.call(this)||this;_._parentSubscriber=n;var S=_;return Object(a.a)(i)?g=i:i&&(g=i.next,o=i.error,m=i.complete,i!==s.a&&(S=Object.create(i),Object(a.a)(S.unsubscribe)&&_.add(S.unsubscribe.bind(S)),S.unsubscribe=_.unsubscribe.bind(_))),_._context=S,_._next=g,_._error=o,_._complete=m,_}return o.a(SafeSubscriber,t),SafeSubscriber.prototype.next=function(t){if(!this.isStopped&&this._next){var n=this._parentSubscriber;_.a.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?this.__tryOrSetError(n,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},SafeSubscriber.prototype.error=function(t){if(!this.isStopped){var n=this._parentSubscriber,i=_.a.useDeprecatedSynchronousErrorHandling;if(this._error)i&&n.syncErrorThrowable?(this.__tryOrSetError(n,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(n.syncErrorThrowable)i?(n.syncErrorValue=t,n.syncErrorThrown=!0):Object(S.a)(t),this.unsubscribe();else{if(this.unsubscribe(),i)throw t;Object(S.a)(t)}}},SafeSubscriber.prototype.complete=function(){var t=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var wrappedComplete=function(){return t._complete.call(t._context)};_.a.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?(this.__tryOrSetError(n,wrappedComplete),this.unsubscribe()):(this.__tryOrUnsub(wrappedComplete),this.unsubscribe())}else this.unsubscribe()}},SafeSubscriber.prototype.__tryOrUnsub=function(t,n){try{t.call(this._context,n)}catch(t){if(this.unsubscribe(),_.a.useDeprecatedSynchronousErrorHandling)throw t;Object(S.a)(t)}},SafeSubscriber.prototype.__tryOrSetError=function(t,n,i){if(!_.a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,i)}catch(n){return _.a.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=n,t.syncErrorThrown=!0,!0):(Object(S.a)(n),!0)}return!1},SafeSubscriber.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},SafeSubscriber}(M)},function(t,n,i){"use strict";i.d(n,"a",(function(){return g})),i.d(n,"b",(function(){return _})),i.d(n,"c",(function(){return innerSubscribe}));var o=i(1),a=i(3),s=i(5),m=i(75),g=function(t){function SimpleInnerSubscriber(n){var i=t.call(this)||this;return i.parent=n,i}return o.a(SimpleInnerSubscriber,t),SimpleInnerSubscriber.prototype._next=function(t){this.parent.notifyNext(t)},SimpleInnerSubscriber.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},SimpleInnerSubscriber.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},SimpleInnerSubscriber}(a.a),_=(a.a,function(t){function SimpleOuterSubscriber(){return null!==t&&t.apply(this,arguments)||this}return o.a(SimpleOuterSubscriber,t),SimpleOuterSubscriber.prototype.notifyNext=function(t){this.destination.next(t)},SimpleOuterSubscriber.prototype.notifyError=function(t){this.destination.error(t)},SimpleOuterSubscriber.prototype.notifyComplete=function(){this.destination.complete()},SimpleOuterSubscriber}(a.a));function innerSubscribe(t,n){if(!n.closed)return t instanceof s.a?t.subscribe(n):Object(m.a)(t)(n)}a.a},function(t,n,i){"use strict";i.d(n,"a",(function(){return M}));var o=i(115),a=i(3),s=i(89),m=i(117),g=i(52),_=i(86),S=i(39),M=function(){function Observable(t){this._isScalar=!1,t&&(this._subscribe=t)}return Observable.prototype.lift=function(t){var n=new Observable;return n.source=this,n.operator=t,n},Observable.prototype.subscribe=function(t,n,i){var o=this.operator,g=function toSubscriber(t,n,i){if(t){if(t instanceof a.a)return t;if(t[s.a])return t[s.a]()}return t||n||i?new a.a(t,n,i):new a.a(m.a)}(t,n,i);if(o?g.add(o.call(g,this.source)):g.add(this.source||S.a.useDeprecatedSynchronousErrorHandling&&!g.syncErrorThrowable?this._subscribe(g):this._trySubscribe(g)),S.a.useDeprecatedSynchronousErrorHandling&&g.syncErrorThrowable&&(g.syncErrorThrowable=!1,g.syncErrorThrown))throw g.syncErrorValue;return g},Observable.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){S.a.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=n),Object(o.a)(t)?t.error(n):console.warn(n)}},Observable.prototype.forEach=function(t,n){var i=this;return new(n=getPromiseCtor(n))((function(n,o){var a;a=i.subscribe((function(n){try{t(n)}catch(t){o(t),a&&a.unsubscribe()}}),o,n)}))},Observable.prototype._subscribe=function(t){var n=this.source;return n&&n.subscribe(t)},Observable.prototype[g.a]=function(){return this},Observable.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 0===t.length?this:Object(_.b)(t)(this)},Observable.prototype.toPromise=function(t){var n=this;return new(t=getPromiseCtor(t))((function(t,i){var o;n.subscribe((function(t){return o=t}),(function(t){return i(t)}),(function(){return t(o)}))}))},Observable.create=function(t){return new Observable(t)},Observable}();function getPromiseCtor(t){if(t||(t=S.a.Promise||Promise),!t)throw new Error("no Promise impl found");return t}},function(t,n,i){"use strict";i.d(n,"a",(function(){return InputNode}));var o=i(2);function InputNode(t,n){(n=n||{}).shared=void 0!==n.shared&&n.shared,o.a.call(this,t,n),this.readonly=!1}InputNode.prototype=Object.create(o.a.prototype),InputNode.prototype.constructor=InputNode,InputNode.prototype.setReadonly=function(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this},InputNode.prototype.getReadonly=function(){return this.readonly},InputNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),void 0!==t.readonly&&(this.readonly=t.readonly),this},InputNode.prototype.createJSONNode=function(t){var n=o.a.prototype.createJSONNode.call(this,t);return!0===this.readonly&&(n.readonly=this.readonly),n},InputNode.prototype.generate=function(t,n,i,o,a,s){i=t.getUuid(i||this.getUuid()),o=o||this.getType(t);var m=t.getNodeData(i);return this.getReadonly(t)&&void 0!==this.generateReadonly?this.generateReadonly(t,n,i,o,a,s):t.isShader("vertex")?(m.vertex||(m.vertex=t.createVertexUniform(o,this,a,s,this.getLabel())),t.format(m.vertex.name,o,n)):(m.fragment||(m.fragment=t.createFragmentUniform(o,this,a,s,this.getLabel())),t.format(m.fragment.name,o,n))}},function(t,n,i){"use strict";i.d(n,"a",(function(){return FunctionNode}));var o=i(2),a=i(24),s=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,m=/[a-z_0-9]+/gi;function FunctionNode(t,n,i,a,s){this.isMethod=void 0===s,this.isInterface=!1,o.a.call(this,s),this.parse(t,n,i,a)}FunctionNode.prototype=Object.create(o.a.prototype),FunctionNode.prototype.constructor=FunctionNode,FunctionNode.prototype.nodeType="Function",FunctionNode.prototype.useKeywords=!0,FunctionNode.prototype.getShared=function(){return!this.isMethod},FunctionNode.prototype.getType=function(t){return t.getTypeByFormat(this.type)},FunctionNode.prototype.getInputByName=function(t){for(var n=this.inputs.length;n--;)if(this.inputs[n].name===t)return this.inputs[n]},FunctionNode.prototype.getIncludeByName=function(t){for(var n=this.includes.length;n--;)if(this.includes[n].name===t)return this.includes[n]},FunctionNode.prototype.generate=function(t,n){for(var i=0,o=this.src,s=0;s<this.includes.length;s++)t.include(this.includes[s],this);for(var g in this.extensions)t.extensions[g]=!0;for(var _=[];S=m.exec(this.src);)_.push(S);for(s=0;s<_.length;s++){var S,M=(S=_[s])[0],T=!this.isMethod||!this.getInputByName(M),O=M;if(this.keywords[M]||this.useKeywords&&T&&a.a.containsKeyword(M)){var A=this.keywords[M];if(!A){var P=a.a.getKeywordData(M);P.cache&&(A=t.keywords[M]),A=A||a.a.getKeyword(M,t),P.cache&&(t.keywords[M]=A)}O=A.build(t)}M!==O&&(o=o.substring(0,S.index+i)+O+o.substring(S.index+M.length+i),i+=O.length-M.length),void 0===this.getIncludeByName(O)&&a.a.contains(O)&&t.include(a.a.get(O))}return"source"===n?o:this.isMethod?(this.isInterface||t.include(this,!1,o),this.name):t.format("( "+o+" )",this.getType(t),n)},FunctionNode.prototype.parse=function(t,n,i,o){if(this.src=t||"",this.includes=n||[],this.extensions=i||{},this.keywords=o||{},this.isMethod){var a=this.src.match(s);if(this.inputs=[],a&&4==a.length){this.type=a[1],this.name=a[2];var g=a[3].match(m);if(g)for(var _=0;_<g.length;){var S,M,T=g[_++];"in"===T||"out"===T||"inout"===T?S=g[_++]:(S=T,T=""),M=g[_++],this.inputs.push({name:M,type:S,qualifier:T})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}},FunctionNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.isMethod=t.isMethod,this.useKeywords=t.useKeywords,this.parse(t.src,t.includes,t.extensions,t.keywords),void 0!==t.type&&(this.type=t.type),this},FunctionNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);if(!n){for(var i in(n=this.createJSONNode(t)).src=this.src,n.isMethod=this.isMethod,n.useKeywords=this.useKeywords,this.isMethod||(n.type=this.type),n.extensions=JSON.parse(JSON.stringify(this.extensions)),n.keywords={},this.keywords)n.keywords[i]=this.keywords[i].toJSON(t).uuid;if(this.includes.length){n.includes=[];for(var o=0;o<this.includes.length;o++)n.includes.push(this.includes[o].toJSON(t).uuid)}}return n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return Node}));var o=i(0);function Node(t){this.uuid=o.MathUtils.generateUUID(),this.name="",this.type=t,this.userData={}}Node.prototype={constructor:Node,isNode:!0,hashProperties:void 0,analyze:function(t,n){n=n||{},t.analyzing=!0,this.build(t.addFlow(n.slot,n.cache,n.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1},analyzeAndFlow:function(t,n,i){return i=i||{},this.analyze(t,i),this.flow(t,n,i)},flow:function(t,n,i){i=i||{},t.addFlow(i.slot,i.cache,i.context);var o={};return o.result=this.build(t,n),o.code=t.clearNodeCode(),o.extra=t.context.extra,t.removeFlow(),o},build:function(t,n,i){n=n||this.getType(t,n);var o=t.getNodeData(i||this);return t.analyzing&&this.appendDepsNode(t,o,n),-1===t.nodes.indexOf(this)&&t.nodes.push(this),void 0!==this.updateFrame&&-1===t.updaters.indexOf(this)&&t.updaters.push(this),this.generate(t,n,i)},generate:function(){},getHash:function(){var t,n,i="{";for(t in this)(n=this[t])instanceof Node&&(i+='"'+t+'":'+n.getHash()+",");if(this.hashProperties)for(var o=0;o<this.hashProperties.length;o++)n=this[t=this.hashProperties[o]],i+='"'+t+'":"'+String(n)+'",';return i+'"id":"'+this.uuid+'"}'},appendDepsNode:function(t,n,i){n.deps=(n.deps||0)+1;var o=t.getTypeLength(i);(o>(n.outputMax||0)||this.getType(t,i))&&(n.outputMax=o,n.output=i)},setName:function(t){return this.name=t,this},getName:function(){return this.name},getType:function(t,n){return"sampler2D"===n||"samplerCube"===n?n:this.type},getJSONNode:function(t){if(void 0!==t&&"string"!=typeof t&&void 0!==t.nodes[this.uuid])return t.nodes[this.uuid]},copy:function(t){return void 0!==t.name&&(this.name=t.name),void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this},createJSONNode:function(t){var n=void 0===t||"string"==typeof t,i={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return i.uuid=this.uuid,i.nodeType=this.nodeType,""!==this.name&&(i.name=this.name),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),n||(t.nodes[this.uuid]=i),i},toJSON:function(t){return this.getJSONNode(t)||this.createJSONNode(t)}}},function(t,n,i){"use strict";i.d(n,"a",(function(){return g}));var o=i(13),a=i(114),s=i(59),m=i(90),g=function(){function Subscription(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}var t;return Subscription.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this._parentOrParents,i=this._ctorUnsubscribe,g=this._unsubscribe,_=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof Subscription)n.remove(this);else if(null!==n)for(var S=0;S<n.length;++S)n[S].remove(this);if(Object(s.a)(g)){i&&(this._unsubscribe=void 0);try{g.call(this)}catch(n){t=n instanceof m.a?flattenUnsubscriptionErrors(n.errors):[n]}}if(Object(o.a)(_)){S=-1;for(var M=_.length;++S<M;){var T=_[S];if(Object(a.a)(T))try{T.unsubscribe()}catch(n){t=t||[],n instanceof m.a?t=t.concat(flattenUnsubscriptionErrors(n.errors)):t.push(n)}}}if(t)throw new m.a(t)}},Subscription.prototype.add=function(t){var n=t;if(!t)return Subscription.EMPTY;switch(typeof t){case"function":n=new Subscription(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof Subscription)){var i=n;(n=new Subscription)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var o=n._parentOrParents;if(null===o)n._parentOrParents=this;else if(o instanceof Subscription){if(o===this)return n;n._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return n;o.push(this)}var a=this._subscriptions;return null===a?this._subscriptions=[n]:a.push(n),n},Subscription.prototype.remove=function(t){var n=this._subscriptions;if(n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}},Subscription.EMPTY=((t=new Subscription).closed=!0,t),Subscription}();function flattenUnsubscriptionErrors(t){return t.reduce((function(t,n){return t.concat(n instanceof m.a?n.errors:n)}),[])}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AnalyticsSendActionEvent=n.ARObjectPlacedEvent=n.MouseWheelEvent=n.RotateEvent=n.PinchEvent=n.MouseMoveEvent=n.MouseDoubleClickEvent=n.MouseUpEvent=n.GamepadUpEvent=n.GamepadDownEvent=n.MouseDownEvent=n.GamepadPressSwipeEvent=n.GamepadSwipeEvent=n.MouseSwipeEvent=n.ARMarkerUndetected=n.ARMarkerDetected=n.ARModeEnded=n.ARModeStarted=n.KeyboardClickEvent=n.ChatMessageSentEvent=n.ZoneChangeEndedEvent=n.ZoneChangeStartedEvent=n.NavigateEvent=n.TransitionEndedEvent=n.TransitionStartedEvent=n.EffectEndedEvent=n.EffectStartedEvent=n.PropertieChangedEvent=n.UnfocusEvent=n.FocusEvent=n.GyroMotionEvent=n.LongTouchEndedEvent=n.LongTouchEvent=n.RightClickEvent=n.TouchEvent=n.ZoneLoadedEvent=n.ZoneLoadingEvent=n.ExperienceLoadedEvent=n.ExperienceLoadingEvent=n.ErrEvent=n.DestroyedEvent=n.LoadedEvent=n.LoadingEvent=n.UninitializedEvent=n.CameraChangedEvent=n.CameraZoomEvent=n.CameraMoveEvent=n.IElementLifeCycleEvent=n.VideoReadyEvent=n.VideoEndedEvent=n.VideoPlayingEvent=n.ShouldRenderEvent=void 0;n.ShouldRenderEvent=function ShouldRenderEvent(){this.name="ShouldRenderEvent"};n.VideoPlayingEvent=function VideoPlayingEvent(){this.name="VideoPlaying"};n.VideoEndedEvent=function VideoEndedEvent(){this.name="VideoEnded"};n.VideoReadyEvent=function VideoReadyEvent(){this.name="VideoReady"};n.IElementLifeCycleEvent=function IElementLifeCycleEvent(){};n.CameraMoveEvent=function CameraMoveEvent(){this.name="CameraMoveEvent"};n.CameraZoomEvent=function CameraZoomEvent(){this.name="CameraZoomEvent"};n.CameraChangedEvent=function CameraChangedEvent(){this.name="CameraChangedEvent"};n.UninitializedEvent=function UninitializedEvent(){this.name="Uninitialized"};n.LoadingEvent=function LoadingEvent(){this.name="Loading"};n.LoadedEvent=function LoadedEvent(){this.name="Loaded"};n.DestroyedEvent=function DestroyedEvent(){this.name="Destroyed"};n.ErrEvent=function ErrEvent(){this.name="Error"};n.ExperienceLoadingEvent=function ExperienceLoadingEvent(){this.name="ExperienceLoading"};n.ExperienceLoadedEvent=function ExperienceLoadedEvent(){this.name="ExperienceLoaded"};n.ZoneLoadingEvent=function ZoneLoadingEvent(){this.name="ZoneLoading"};n.ZoneLoadedEvent=function ZoneLoadedEvent(){this.name="ZoneLoaded"};n.TouchEvent=function TouchEvent(){this.name="touch"};n.RightClickEvent=function RightClickEvent(){this.name="rightClick"};n.LongTouchEvent=function LongTouchEvent(){this.name="longTouch"};n.LongTouchEndedEvent=function LongTouchEndedEvent(){this.name="longTouchEnded"};n.GyroMotionEvent=function GyroMotionEvent(){this.name="gyroMotion"};n.FocusEvent=function FocusEvent(){this.name="focus"};n.UnfocusEvent=function UnfocusEvent(){this.name="unfocus"};n.PropertieChangedEvent=function PropertieChangedEvent(){this.name="PropertieChanged"};n.EffectStartedEvent=function EffectStartedEvent(){this.name="EffectStarted"};n.EffectEndedEvent=function EffectEndedEvent(){this.name="EffectEnded"};n.TransitionStartedEvent=function TransitionStartedEvent(){this.name="TransitionStarted"};n.TransitionEndedEvent=function TransitionEndedEvent(){this.name="TransitionEnded"};n.NavigateEvent=function NavigateEvent(){this.name="Navigate"};n.ZoneChangeStartedEvent=function ZoneChangeStartedEvent(){this.name="ZoneChangeStarted"};n.ZoneChangeEndedEvent=function ZoneChangeEndedEvent(){this.name="ZoneChangeEnded"};n.ChatMessageSentEvent=function ChatMessageSentEvent(){this.name="ChatMessageSent"};n.KeyboardClickEvent=function KeyboardClickEvent(){this.name="KeyboardClick"};n.ARModeStarted=function ARModeStarted(){this.name="ARModeStarted"};n.ARModeEnded=function ARModeEnded(){this.name="ARModeEnded"};n.ARMarkerDetected=function ARMarkerDetected(){this.name="ARMarkerDetected"};n.ARMarkerUndetected=function ARMarkerUndetected(){this.name="ARMarkerUndetected"};n.MouseSwipeEvent=function MouseSwipeEvent(){this.name="MouseSwipe"};n.GamepadSwipeEvent=function GamepadSwipeEvent(){this.name="GamepadSwipe"};n.GamepadPressSwipeEvent=function GamepadPressSwipeEvent(){this.name="GamepadPressSwipe"};n.MouseDownEvent=function MouseDownEvent(){this.name="MouseDown"};n.GamepadDownEvent=function GamepadDownEvent(){this.name="GamepadDown"};n.GamepadUpEvent=function GamepadUpEvent(){this.name="GamepadUp"};n.MouseUpEvent=function MouseUpEvent(){this.name="MouseUp"};n.MouseDoubleClickEvent=function MouseDoubleClickEvent(){this.name="MouseDoubleClick"};n.MouseMoveEvent=function MouseMoveEvent(){this.name="MouseMove"};n.PinchEvent=function PinchEvent(){this.name="Pinch"};n.RotateEvent=function RotateEvent(){this.name="Rotate"};n.MouseWheelEvent=function MouseWheelEvent(){this.name="MouseWheel"};n.ARObjectPlacedEvent=function ARObjectPlacedEvent(){this.name="ARObjectPlaced"};n.AnalyticsSendActionEvent=function AnalyticsSendActionEvent(){this.name="AnalyticsSendAction"}},function(t,n,i){"use strict";i.d(n,"b",(function(){return M})),i.d(n,"a",(function(){return T}));var o=i(1),a=i(5),s=i(3),m=i(9),g=i(55),_=i(171),S=i(89),M=function(t){function SubjectSubscriber(n){var i=t.call(this,n)||this;return i.destination=n,i}return o.a(SubjectSubscriber,t),SubjectSubscriber}(s.a),T=function(t){function Subject(){var n=t.call(this)||this;return n.observers=[],n.closed=!1,n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return o.a(Subject,t),Subject.prototype[S.a]=function(){return new M(this)},Subject.prototype.lift=function(t){var n=new O(this,this);return n.operator=t,n},Subject.prototype.next=function(t){if(this.closed)throw new g.a;if(!this.isStopped)for(var n=this.observers,i=n.length,o=n.slice(),a=0;a<i;a++)o[a].next(t)},Subject.prototype.error=function(t){if(this.closed)throw new g.a;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var n=this.observers,i=n.length,o=n.slice(),a=0;a<i;a++)o[a].error(t);this.observers.length=0},Subject.prototype.complete=function(){if(this.closed)throw new g.a;this.isStopped=!0;for(var t=this.observers,n=t.length,i=t.slice(),o=0;o<n;o++)i[o].complete();this.observers.length=0},Subject.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},Subject.prototype._trySubscribe=function(n){if(this.closed)throw new g.a;return t.prototype._trySubscribe.call(this,n)},Subject.prototype._subscribe=function(t){if(this.closed)throw new g.a;return this.hasError?(t.error(this.thrownError),m.a.EMPTY):this.isStopped?(t.complete(),m.a.EMPTY):(this.observers.push(t),new _.a(this,t))},Subject.prototype.asObservable=function(){var t=new a.a;return t.source=this,t},Subject.create=function(t,n){return new O(t,n)},Subject}(a.a),O=function(t){function AnonymousSubject(n,i){var o=t.call(this)||this;return o.destination=n,o.source=i,o}return o.a(AnonymousSubject,t),AnonymousSubject.prototype.next=function(t){var n=this.destination;n&&n.next&&n.next(t)},AnonymousSubject.prototype.error=function(t){var n=this.destination;n&&n.error&&this.destination.error(t)},AnonymousSubject.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},AnonymousSubject.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):m.a.EMPTY},AnonymousSubject}(T)},function(t,n,i){"use strict";i.d(n,"b",(function(){return a})),i.d(n,"a",(function(){return s}));var o=i(68),a=new(i(65).a)(o.a),s=a},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=Array.isArray||function(t){return t&&"number"==typeof t.length}},function(t,n,i){"use strict";i.d(n,"a",(function(){return FloatNode}));var o=i(6);function FloatNode(t){o.a.call(this,"f"),this.value=t||0}FloatNode.prototype=Object.create(o.a.prototype),FloatNode.prototype.constructor=FloatNode,FloatNode.prototype.nodeType="Float",FloatNode.prototype.generateReadonly=function(t,n,i,o){return t.format(this.value+(this.value%1?"":".0"),o,n)},FloatNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.value=t.value,this},FloatNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value,!0===this.readonly&&(n.readonly=!0)),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return ExpressionNode}));var o=i(7);function ExpressionNode(t,n,i,a,s){o.a.call(this,t,s,a,i,n)}ExpressionNode.prototype=Object.create(o.a.prototype),ExpressionNode.prototype.constructor=ExpressionNode,ExpressionNode.prototype.nodeType="Expression"},function(t,n,i){"use strict";i.d(n,"a",(function(){return ConstNode}));var o=i(2),a=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;function ConstNode(t,n){o.a.call(this),this.parse(t||ConstNode.PI,n)}ConstNode.PI="PI",ConstNode.PI2="PI2",ConstNode.RECIPROCAL_PI="RECIPROCAL_PI",ConstNode.RECIPROCAL_PI2="RECIPROCAL_PI2",ConstNode.LOG2="LOG2",ConstNode.EPSILON="EPSILON",ConstNode.prototype=Object.create(o.a.prototype),ConstNode.prototype.constructor=ConstNode,ConstNode.prototype.nodeType="Const",ConstNode.prototype.getType=function(t){return t.getTypeByFormat(this.type)},ConstNode.prototype.parse=function(t,n){this.src=t||"";var i,o,s="",m=this.src.match(a);this.useDefine=n||"#"===this.src.charAt(0),m&&m.length>1?(o=m[1],i=m[2],s=m[3]):(i=this.src,o="f"),this.name=i,this.type=o,this.value=s},ConstNode.prototype.build=function(t,n){return"source"!==n?(t.include(this),t.format(this.name,this.getType(t),n)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0},ConstNode.prototype.generate=function(t,n){return t.format(this.name,this.getType(t),n)},ConstNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.parse(t.src,t.useDefine),this},ConstNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).src=this.src,!0===n.useDefine&&(n.useDefine=!0)),n}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Utils=void 0;var s=i(0),m=i(71),g=i(82),_=i(211),S=i(83),M=i(22),T=i(213),O=i(77),A=i(253);!function(t){t.matchObjToBounds=function matchObjToBounds(n,i,o,a,m){void 0===m&&(m=!0);var g=new s.Mesh(new s.BoxGeometry(i.x,i.y,i.z),new s.MeshStandardMaterial),_=SetBoxFromObj(new s.Box3,g),S=SetBoxFromObj(new s.Box3,n.obj),M=(_.max.x-_.min.x)/(S.max.x-S.min.x),T=(_.max.y-_.min.y)/(S.max.y-S.min.y),O=(_.max.z-_.min.z)/(S.max.z-S.min.z);if(o){var A=Math.min(M,T,O);n.obj.scale.copy(n.obj.scale.multiplyScalar(A))}else n.obj.scale.set(n.obj.scale.x*M,n.obj.scale.y*T,n.obj.scale.z*O);S=SetBoxFromObj(new s.Box3,n.obj);var P=t.randomColor();if(a){var L=new s.Vector3;S.getCenter(L);var R=n.obj.position;R.multiplyScalar(2),R.subVectors(R,L),n.obj.position.copy(R)}var N=new s.BoxHelper(n.obj,P);(Array.isArray(N.material)?N.material:[N.material]).forEach((function(t){t.transparent=!0,t.visible=!1})),m&&(n.obj.parent.add(N),N.add(n.obj),N.name="bounds_"+n.obj.name,n.boundingBox=N)},t.randomColor=function randomColor(){var t=new s.Color(16777215);return t.setHex(16777215*Math.random()),t};var n=["m3u8"];t.isHLS=function isHLS(t){var i=this.getExtension(t);return!!i&&n.indexOf(i)>-1};var i=["jpeg","jpg","png","gif","svg"];t.isImage=function isImage(t){return i.some((function(n){return t.includes(n)}))},t.isGif=function isGif(t){var n=this.getExtension(t);return!!n&&"gif"===n},t.isSVG=function isSVG(t){var n=this.getExtension(t);return!!n&&"svg"===n};var P=["mp4","m3u8"];function GetDefaultEulerVector(t){var n=t.rotation.clone();t.lookAt(new s.Vector3(0,0,0));var i=new s.Euler(t.rotation.x,t.rotation.y,t.rotation.z);return t.rotation.set(n.x,n.y,n.z),i}function saveString(t,n){save(new Blob([t],{type:"text/plain"}),n)}function save(t,n){var i=document.getElementById("glbExportLink");i||((i=document.createElement("a")).id="glbExportLink",i.style.display="none",document.body.appendChild(i)),i.href=URL.createObjectURL(t),i.download=n,i.click()}function setQuaternion(t,n,i,g){return void 0===i&&(i=0),o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,new Promise((function(o,a){if(0===i)t.quaternion.copy(n),o(),g&&g.length>0&&g.forEach((function(t){t()}));else{var _=t.quaternion.clone();new m.Tween({r:0}).to({r:1},1e3*i).onUpdate((function(i){try{s.Quaternion.slerp(_,n,t.quaternion,i.r),g&&g.length>0&&g.forEach((function(t){t()}))}catch(t){a()}})).onComplete((function(){t.quaternion.copy(n),g&&g.length>0&&g.forEach((function(t){t()})),o()})).start()}}))]}))}))}function SetBoxFromObj(t,n){return t.makeEmpty(),ExpandBoxByObj(t,n)}function ExpandBoxByObj(t,n){var i,o,a=new s.Vector3;if(n.updateWorldMatrix(!1,!1),n instanceof s.Mesh)if(n.geometry instanceof s.Geometry){var m=n.geometry.vertices;for(i=0,o=m.length;i<o;i++)a.copy(m[i]),a.applyMatrix4(n.matrixWorld),t.expandByPoint(a)}else if(n.geometry instanceof s.BufferGeometry){var g=n.geometry.attributes.position;if(void 0!==g&&g instanceof s.BufferAttribute)for(i=0,o=g.count;i<o;i++)a.fromBufferAttribute(g,i).applyMatrix4(n.matrixWorld),t.expandByPoint(a)}var _=n.children;for(i=0,o=_.length;i<o;i++)ExpandBoxByObj(t,_[i]);return t}t.isVideo=function isVideo(t){var n=this.getExtension(t);return!!n&&P.indexOf(n)>-1},t.getExtension=function getExtension(t){if(t){var n=t;return t.indexOf("?")>-1&&(n=t.substring(0,t.indexOf("?"))),n.substr(n.lastIndexOf(".")+1).toLowerCase()}},t.GetGeometryRatioFromTexture=function GetGeometryRatioFromTexture(t,n){void 0===n&&(n=1);var i=t.image.width/t.image.height;return new s.Vector2(n,n/i)},t.GetGeometryRatio=function GetGeometryRatio(t,n,i){void 0===i&&(i=1);var o=t/n;return new s.Vector2(i,i/o)},t.DegToRadVector=function DegToRadVector(t){return new s.Euler(s.MathUtils.degToRad(t.x||0),s.MathUtils.degToRad(t.y||0),s.MathUtils.degToRad(t.z||0))},t.RadToDegVector=function RadToDegVector(t){return new s.Euler(s.MathUtils.radToDeg(t.x||0),s.MathUtils.radToDeg(t.y||0),s.MathUtils.radToDeg(t.z||0))},t.GetDefaultEulerVector=GetDefaultEulerVector,t.setPosition=function setPosition(t,n,i,s,g){return void 0===i&&(i=0),o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,new Promise((function(o,a){if(0===i)t.position.copy(n),s&&s.length>0&&s.forEach((function(t){t()})),o();else{var _=t.position,S=new m.Tween(_).to(n,1e3*i).onUpdate((function(n){try{t.position.set(n.x,n.y,n.z),s&&s.length>0&&s.forEach((function(t){t()}))}catch(t){a()}})).onComplete((function(){t.position.copy(n),s&&s.length>0&&s.forEach((function(t){t()})),o()}));g&&S.easing(g),S.start()}}))]}))}))},t.exportGLB=function exportGLB(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){return n={trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!0,forceIndices:!1,forcePowerOfTwoTextures:!1},(new _.GLTFExporter).parse(t.currentExperience.scene,(function(t){t instanceof ArrayBuffer?function saveArrayBuffer(t,n){save(new Blob([t],{type:"application/octet-stream"}),n)}(t,"scene.glb"):saveString(JSON.stringify(t,null,2),"scene.gltf")}),n),[2]}))}))},t.saveString=saveString,t.exportOBJ=function exportOBJ(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,(new _.OBJExporter).parse(t.currentExperience.scene)];case 1:return n.sent().generateAsync({type:"blob"}).then((function(n){A.saveAs(n,t.currentExperience.getMetadata().hash+".zip")})),[2]}}))}))},t.setEnvMap=function setEnvMap(t,n,i,m){return void 0===i&&(i=null),void 0===m&&(m=null),o(this,void 0,void 0,(function(){function setMaterial(t,n){Array.isArray(t)?t.forEach((function(t){t instanceof s.MeshPhongMaterial||(t.envMap=n,t.envMapIntensity=P,t.needsUpdate=!0)})):t instanceof S.ChromakeyMaterial||t instanceof s.MeshPhongMaterial||(t.envMap=n,t.envMapIntensity=P,t.needsUpdate=!0)}var o,g,_,A,P;return a(this,(function(a){switch(a.label){case 0:return n.url!==M.CustomAttributes.Values.EnvMap.Auto?[3,1]:(A=T.ScreenShot.GetRenderTarget(t,512,256),o=A.texture,[3,4]);case 1:return n.url!==M.CustomAttributes.Values.EnvMap.Realtime?[3,2]:(o=t.cameraControlsRegistry.cameraControls.getCubeCamera().renderTarget.texture,[3,4]);case 2:return[4,new O.Image(t,{url:n.url,optimizerWidth:n.optimizerWidth}).Load()];case 3:(g=a.sent()).encoding=s.sRGBEncoding,(_=new s.PMREMGenerator(t.currentExperience.renderer)).compileEquirectangularShader(),A=_.fromEquirectangular(g),o=A.texture,g.dispose(),_.dispose(),o.format=s.RGBFormat,a.label=4;case 4:return P=n.intensity||1,i&&i.traverse((function(t){t instanceof s.Mesh&&setMaterial(t.material,o)})),!m||m instanceof S.ChromakeyMaterial||setMaterial(m,o),[2]}}))}))},t.setRotation=function setRotation(t,n,i,m){return void 0===i&&(i=0),o(this,void 0,void 0,(function(){var o,g;return a(this,(function(a){switch(a.label){case 0:return o=n||GetDefaultEulerVector(t),g=(new s.Quaternion).setFromEuler(o),[4,setQuaternion(t,g,i,m)];case 1:return a.sent(),[2]}}))}))},t.setScale=function setScale(t,n,i,s){return void 0===i&&(i=0),o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,new Promise((function(o,a){if(n&&n.x&&n.y&&n.z||o(),0===i)t.scale.set(n.x,n.y,n.z),o(),s&&s.length>0&&s.forEach((function(t){t()}));else{var g=t.scale;new m.Tween(g).to(n,1e3*i).onUpdate((function(n){try{t.scale.set(n.x,n.y,n.z),s&&s.length>0&&s.forEach((function(t){t()}))}catch(t){a()}})).onComplete((function(){t.scale.set(n.x,n.y,n.z),o()})).start()}}))]}))}))},t.setColor=function setColor(t,n,i,g){return void 0===n&&(n="#ffffff"),void 0===i&&(i=0),o(this,void 0,void 0,(function(){var o;return a(this,(function(a){return o=new s.Color(n),[2,new Promise((function(n,a){if(i&&0!==i){var s={r:t.color.r,g:t.color.g,b:t.color.b};new m.Tween(s).to({r:o.r,g:o.g,b:o.b},1e3*i).onUpdate((function(n){t.color.setRGB(n.r,n.g,n.b),g&&g.length>0&&g.forEach((function(t){t()}))})).onComplete((function(){n()})).start()}else t&&(t.color=o),n()}))]}))}))},t.setAlpha=function setAlpha(t,n,i,s){return void 0===i&&(i=0),o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,new Promise((function(o,a){if(i&&0!==i){var g={opacity:t.opacity};new m.Tween(g).to({opacity:n},1e3*i).onUpdate((function(n){try{t.opacity=n.opacity,s&&s.length>0&&s.forEach((function(t){t()}))}catch(t){a()}})).onComplete((function(){o()})).start()}else t&&(t.opacity=n,s&&s.length>0&&s.forEach((function(t){t()}))),o()}))]}))}))},t.setHtmlAlpha=function setHtmlAlpha(t,n,i,s){return void 0===i&&(i=0),o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,new Promise((function(o,a){if(i&&0!==i){var g={opacity:t.style.opacity};new m.Tween(g).to({opacity:n},1e3*i).onUpdate((function(n){try{t.style.opacity=""+n.opacity,s&&s.length>0&&s.forEach((function(t){t()}))}catch(t){a()}})).onComplete((function(){o()})).start()}else t.style.opacity=""+n,o()}))]}))}))},t.string2HtmlElement=function string2HtmlElement(t){var n=document.createElement("div");return n.innerHTML=t,n.firstChild},t.sleep=function sleep(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){setTimeout((function(){n()}),t)}))]}))}))},t.hexToRgb=function hexToRgb(t){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},t.getLookAtVector=function getLookAtVector(t,n){void 0===n&&(n=1e-4);var i=new s.Vector3;i=t.getWorldDirection(i);var o=new s.Vector3;return(o=t.getWorldPosition(o)).add(i.multiplyScalar(n))},t.setQuaternion=setQuaternion,t.getItemById=function getItemById(t,n){var i,o=t.currentExperience.currentZone;return o.getMetadata().byond_id===n?o:(o.artBoards&&(o.artBoards.some((function(t){if(t.getMetadata().byond_id===n)return i=t,!0})),i)||o.elementsList&&o.elementsList.some((function(t){return t.getMetadata().byond_id===n?(i=t,!0):t.elementsList?t.elementsList.some((function(o){if(o.getMetadata().byond_id===n)return i=t,!0})):void 0})),i)},t.byondPositionToThreePosition=function byondPositionToThreePosition(t){try{t=new s.Vector3(t.x,t.y,-1*t.z)}catch(n){t=new s.Vector3(0,0,0)}return t},t.byondRotationToThreeRotation=function byondRotationToThreeRotation(n){try{if(!n||null===n.x&&null===n.y&&null===n.z)n=void 0;else{var i=new s.Vector3(n.x||0,n.y?n.y+180:180,n.z||0);(n=t.DegToRadVector(i)).order="YXZ"}}catch(t){n=void 0}return n},t.byondScaleToThreeScale=function byondScaleToThreeScale(t){try{t=new s.Vector3(t.x,t.y,t.z)}catch(n){t=new s.Vector3(1,1,1)}return t},t.threePositionToByondPosition=function threePositionToByondPosition(t){try{t=new s.Vector3(t.x,t.y,-1*t.z)}catch(n){t=new s.Vector3(0,0,0)}return t},t.threeRotationToByondRotation=function threeRotationToByondRotation(n){try{(n=t.RadToDegVector(n)).y+=180}catch(t){n=void 0}return n},t.SetBoxFromObj=SetBoxFromObj,t.ExpandBoxByObj=ExpandBoxByObj,t.emitRender=function emitRender(t,n){t.eventManager.next({origin:n,eventType:new g.EventTypes.ShouldRenderEvent,message:{}})}}(n.Utils||(n.Utils={}))},function(t,n,i){"use strict";i.r(n),i.d(n,"audit",(function(){return audit})),i.d(n,"auditTime",(function(){return auditTime})),i.d(n,"buffer",(function(){return buffer_buffer})),i.d(n,"bufferCount",(function(){return bufferCount})),i.d(n,"bufferTime",(function(){return bufferTime})),i.d(n,"bufferToggle",(function(){return bufferToggle})),i.d(n,"bufferWhen",(function(){return bufferWhen})),i.d(n,"catchError",(function(){return catchError})),i.d(n,"combineAll",(function(){return combineAll})),i.d(n,"combineLatest",(function(){return combineLatest_combineLatest})),i.d(n,"concat",(function(){return concat_concat})),i.d(n,"concatAll",(function(){return $.a})),i.d(n,"concatMap",(function(){return concatMap})),i.d(n,"concatMapTo",(function(){return concatMapTo})),i.d(n,"count",(function(){return count_count})),i.d(n,"debounce",(function(){return debounce})),i.d(n,"debounceTime",(function(){return debounceTime})),i.d(n,"defaultIfEmpty",(function(){return defaultIfEmpty})),i.d(n,"delay",(function(){return delay_delay})),i.d(n,"delayWhen",(function(){return delayWhen})),i.d(n,"dematerialize",(function(){return dematerialize})),i.d(n,"distinct",(function(){return distinct})),i.d(n,"distinctUntilChanged",(function(){return distinctUntilChanged})),i.d(n,"distinctUntilKeyChanged",(function(){return distinctUntilKeyChanged})),i.d(n,"elementAt",(function(){return elementAt})),i.d(n,"endWith",(function(){return endWith})),i.d(n,"every",(function(){return every})),i.d(n,"exhaust",(function(){return exhaust})),i.d(n,"exhaustMap",(function(){return exhaustMap})),i.d(n,"expand",(function(){return expand})),i.d(n,"filter",(function(){return Ee.a})),i.d(n,"finalize",(function(){return finalize})),i.d(n,"find",(function(){return find})),i.d(n,"findIndex",(function(){return findIndex})),i.d(n,"first",(function(){return first})),i.d(n,"groupBy",(function(){return Ze.b})),i.d(n,"ignoreElements",(function(){return ignoreElements})),i.d(n,"isEmpty",(function(){return isEmpty})),i.d(n,"last",(function(){return last})),i.d(n,"map",(function(){return Fe.a})),i.d(n,"mapTo",(function(){return mapTo})),i.d(n,"materialize",(function(){return materialize})),i.d(n,"max",(function(){return max_max})),i.d(n,"merge",(function(){return merge_merge})),i.d(n,"mergeAll",(function(){return ct.a})),i.d(n,"mergeMap",(function(){return ee.b})),i.d(n,"flatMap",(function(){return ee.a})),i.d(n,"mergeMapTo",(function(){return mergeMapTo})),i.d(n,"mergeScan",(function(){return mergeScan})),i.d(n,"min",(function(){return min_min})),i.d(n,"multicast",(function(){return multicast})),i.d(n,"observeOn",(function(){return pt.b})),i.d(n,"onErrorResumeNext",(function(){return onErrorResumeNext})),i.d(n,"pairwise",(function(){return pairwise})),i.d(n,"partition",(function(){return partition})),i.d(n,"pluck",(function(){return pluck})),i.d(n,"publish",(function(){return publish})),i.d(n,"publishBehavior",(function(){return publishBehavior})),i.d(n,"publishLast",(function(){return publishLast})),i.d(n,"publishReplay",(function(){return publishReplay})),i.d(n,"race",(function(){return race_race})),i.d(n,"reduce",(function(){return reduce})),i.d(n,"repeat",(function(){return repeat})),i.d(n,"repeatWhen",(function(){return repeatWhen})),i.d(n,"retry",(function(){return retry})),i.d(n,"retryWhen",(function(){return retryWhen})),i.d(n,"refCount",(function(){return Rt.a})),i.d(n,"sample",(function(){return sample})),i.d(n,"sampleTime",(function(){return sampleTime})),i.d(n,"scan",(function(){return scan})),i.d(n,"sequenceEqual",(function(){return sequenceEqual})),i.d(n,"share",(function(){return share})),i.d(n,"shareReplay",(function(){return shareReplay})),i.d(n,"single",(function(){return single})),i.d(n,"skip",(function(){return skip})),i.d(n,"skipLast",(function(){return skipLast})),i.d(n,"skipUntil",(function(){return skipUntil})),i.d(n,"skipWhile",(function(){return skipWhile})),i.d(n,"startWith",(function(){return startWith})),i.d(n,"subscribeOn",(function(){return subscribeOn})),i.d(n,"switchAll",(function(){return switchAll})),i.d(n,"switchMap",(function(){return switchMap})),i.d(n,"switchMapTo",(function(){return switchMapTo})),i.d(n,"take",(function(){return take})),i.d(n,"takeLast",(function(){return takeLast})),i.d(n,"takeUntil",(function(){return takeUntil})),i.d(n,"takeWhile",(function(){return takeWhile})),i.d(n,"tap",(function(){return tap})),i.d(n,"throttle",(function(){return throttle})),i.d(n,"throttleTime",(function(){return throttleTime})),i.d(n,"throwIfEmpty",(function(){return throwIfEmpty})),i.d(n,"timeInterval",(function(){return timeInterval})),i.d(n,"timeout",(function(){return timeout})),i.d(n,"timeoutWith",(function(){return timeoutWith})),i.d(n,"timestamp",(function(){return timestamp})),i.d(n,"toArray",(function(){return toArray})),i.d(n,"window",(function(){return window_window})),i.d(n,"windowCount",(function(){return windowCount})),i.d(n,"windowTime",(function(){return windowTime_windowTime})),i.d(n,"windowToggle",(function(){return windowToggle})),i.d(n,"windowWhen",(function(){return windowWhen})),i.d(n,"withLatestFrom",(function(){return withLatestFrom})),i.d(n,"zip",(function(){return zip_zip})),i.d(n,"zipAll",(function(){return zipAll}));var o=i(1),a=i(4);function audit(t){return function auditOperatorFunction(n){return n.lift(new s(t))}}var s=function(){function AuditOperator(t){this.durationSelector=t}return AuditOperator.prototype.call=function(t,n){return n.subscribe(new m(t,this.durationSelector))},AuditOperator}(),m=function(t){function AuditSubscriber(n,i){var o=t.call(this,n)||this;return o.durationSelector=i,o.hasValue=!1,o}return o.a(AuditSubscriber,t),AuditSubscriber.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var n=void 0;try{n=(0,this.durationSelector)(t)}catch(t){return this.destination.error(t)}var i=Object(a.c)(n,new a.a(this));!i||i.closed?this.clearThrottle():this.add(this.throttled=i)}},AuditSubscriber.prototype.clearThrottle=function(){var t=this.value,n=this.hasValue,i=this.throttled;i&&(this.remove(i),this.throttled=void 0,i.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(t))},AuditSubscriber.prototype.notifyNext=function(){this.clearThrottle()},AuditSubscriber.prototype.notifyComplete=function(){this.clearThrottle()},AuditSubscriber}(a.b),g=i(12),_=i(165);function auditTime(t,n){return void 0===n&&(n=g.a),audit((function(){return Object(_.a)(t,n)}))}function buffer_buffer(t){return function bufferOperatorFunction(n){return n.lift(new S(t))}}var S=function(){function BufferOperator(t){this.closingNotifier=t}return BufferOperator.prototype.call=function(t,n){return n.subscribe(new M(t,this.closingNotifier))},BufferOperator}(),M=function(t){function BufferSubscriber(n,i){var o=t.call(this,n)||this;return o.buffer=[],o.add(Object(a.c)(i,new a.a(o))),o}return o.a(BufferSubscriber,t),BufferSubscriber.prototype._next=function(t){this.buffer.push(t)},BufferSubscriber.prototype.notifyNext=function(){var t=this.buffer;this.buffer=[],this.destination.next(t)},BufferSubscriber}(a.b),T=i(3);function bufferCount(t,n){return void 0===n&&(n=null),function bufferCountOperatorFunction(i){return i.lift(new O(t,n))}}var O=function(){function BufferCountOperator(t,n){this.bufferSize=t,this.startBufferEvery=n,this.subscriberClass=n&&t!==n?P:A}return BufferCountOperator.prototype.call=function(t,n){return n.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))},BufferCountOperator}(),A=function(t){function BufferCountSubscriber(n,i){var o=t.call(this,n)||this;return o.bufferSize=i,o.buffer=[],o}return o.a(BufferCountSubscriber,t),BufferCountSubscriber.prototype._next=function(t){var n=this.buffer;n.push(t),n.length==this.bufferSize&&(this.destination.next(n),this.buffer=[])},BufferCountSubscriber.prototype._complete=function(){var n=this.buffer;n.length>0&&this.destination.next(n),t.prototype._complete.call(this)},BufferCountSubscriber}(T.a),P=function(t){function BufferSkipCountSubscriber(n,i,o){var a=t.call(this,n)||this;return a.bufferSize=i,a.startBufferEvery=o,a.buffers=[],a.count=0,a}return o.a(BufferSkipCountSubscriber,t),BufferSkipCountSubscriber.prototype._next=function(t){var n=this.bufferSize,i=this.startBufferEvery,o=this.buffers,a=this.count;this.count++,a%i==0&&o.push([]);for(var s=o.length;s--;){var m=o[s];m.push(t),m.length===n&&(o.splice(s,1),this.destination.next(m))}},BufferSkipCountSubscriber.prototype._complete=function(){for(var n=this.buffers,i=this.destination;n.length>0;){var o=n.shift();o.length>0&&i.next(o)}t.prototype._complete.call(this)},BufferSkipCountSubscriber}(T.a),L=i(23);function bufferTime(t){var n=arguments.length,i=g.a;Object(L.a)(arguments[arguments.length-1])&&(i=arguments[arguments.length-1],n--);var o=null;n>=2&&(o=arguments[1]);var a=Number.POSITIVE_INFINITY;return n>=3&&(a=arguments[2]),function bufferTimeOperatorFunction(n){return n.lift(new R(t,o,a,i))}}var R=function(){function BufferTimeOperator(t,n,i,o){this.bufferTimeSpan=t,this.bufferCreationInterval=n,this.maxBufferSize=i,this.scheduler=o}return BufferTimeOperator.prototype.call=function(t,n){return n.subscribe(new I(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},BufferTimeOperator}(),N=function Context(){this.buffer=[]},I=function(t){function BufferTimeSubscriber(n,i,o,a,s){var m=t.call(this,n)||this;m.bufferTimeSpan=i,m.bufferCreationInterval=o,m.maxBufferSize=a,m.scheduler=s,m.contexts=[];var g=m.openContext();if(m.timespanOnly=null==o||o<0,m.timespanOnly){var _={subscriber:m,context:g,bufferTimeSpan:i};m.add(g.closeAction=s.schedule(dispatchBufferTimeSpanOnly,i,_))}else{var S={subscriber:m,context:g},M={bufferTimeSpan:i,bufferCreationInterval:o,subscriber:m,scheduler:s};m.add(g.closeAction=s.schedule(dispatchBufferClose,i,S)),m.add(s.schedule(dispatchBufferCreation,o,M))}return m}return o.a(BufferTimeSubscriber,t),BufferTimeSubscriber.prototype._next=function(t){for(var n,i=this.contexts,o=i.length,a=0;a<o;a++){var s=i[a],m=s.buffer;m.push(t),m.length==this.maxBufferSize&&(n=s)}n&&this.onBufferFull(n)},BufferTimeSubscriber.prototype._error=function(n){this.contexts.length=0,t.prototype._error.call(this,n)},BufferTimeSubscriber.prototype._complete=function(){for(var n=this.contexts,i=this.destination;n.length>0;){var o=n.shift();i.next(o.buffer)}t.prototype._complete.call(this)},BufferTimeSubscriber.prototype._unsubscribe=function(){this.contexts=null},BufferTimeSubscriber.prototype.onBufferFull=function(t){this.closeContext(t);var n=t.closeAction;if(n.unsubscribe(),this.remove(n),!this.closed&&this.timespanOnly){t=this.openContext();var i=this.bufferTimeSpan,o={subscriber:this,context:t,bufferTimeSpan:i};this.add(t.closeAction=this.scheduler.schedule(dispatchBufferTimeSpanOnly,i,o))}},BufferTimeSubscriber.prototype.openContext=function(){var t=new N;return this.contexts.push(t),t},BufferTimeSubscriber.prototype.closeContext=function(t){this.destination.next(t.buffer);var n=this.contexts;(n?n.indexOf(t):-1)>=0&&n.splice(n.indexOf(t),1)},BufferTimeSubscriber}(T.a);function dispatchBufferTimeSpanOnly(t){var n=t.subscriber,i=t.context;i&&n.closeContext(i),n.closed||(t.context=n.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function dispatchBufferCreation(t){var n=t.bufferCreationInterval,i=t.bufferTimeSpan,o=t.subscriber,a=t.scheduler,s=o.openContext();o.closed||(o.add(s.closeAction=a.schedule(dispatchBufferClose,i,{subscriber:o,context:s})),this.schedule(t,n))}function dispatchBufferClose(t){var n=t.subscriber,i=t.context;n.closeContext(i)}var j=i(9),V=i(37),U=i(42);function bufferToggle(t,n){return function bufferToggleOperatorFunction(i){return i.lift(new G(t,n))}}var G=function(){function BufferToggleOperator(t,n){this.openings=t,this.closingSelector=n}return BufferToggleOperator.prototype.call=function(t,n){return n.subscribe(new z(t,this.openings,this.closingSelector))},BufferToggleOperator}(),z=function(t){function BufferToggleSubscriber(n,i,o){var a=t.call(this,n)||this;return a.closingSelector=o,a.contexts=[],a.add(Object(V.a)(a,i)),a}return o.a(BufferToggleSubscriber,t),BufferToggleSubscriber.prototype._next=function(t){for(var n=this.contexts,i=n.length,o=0;o<i;o++)n[o].buffer.push(t)},BufferToggleSubscriber.prototype._error=function(n){for(var i=this.contexts;i.length>0;){var o=i.shift();o.subscription.unsubscribe(),o.buffer=null,o.subscription=null}this.contexts=null,t.prototype._error.call(this,n)},BufferToggleSubscriber.prototype._complete=function(){for(var n=this.contexts;n.length>0;){var i=n.shift();this.destination.next(i.buffer),i.subscription.unsubscribe(),i.buffer=null,i.subscription=null}this.contexts=null,t.prototype._complete.call(this)},BufferToggleSubscriber.prototype.notifyNext=function(t,n){t?this.closeBuffer(t):this.openBuffer(n)},BufferToggleSubscriber.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},BufferToggleSubscriber.prototype.openBuffer=function(t){try{var n=this.closingSelector.call(this,t);n&&this.trySubscribe(n)}catch(t){this._error(t)}},BufferToggleSubscriber.prototype.closeBuffer=function(t){var n=this.contexts;if(n&&t){var i=t.buffer,o=t.subscription;this.destination.next(i),n.splice(n.indexOf(t),1),this.remove(o),o.unsubscribe()}},BufferToggleSubscriber.prototype.trySubscribe=function(t){var n=this.contexts,i=new j.a,o={buffer:[],subscription:i};n.push(o);var a=Object(V.a)(this,t,o);!a||a.closed?this.closeBuffer(o):(a.context=o,this.add(a),i.add(a))},BufferToggleSubscriber}(U.a);function bufferWhen(t){return function(n){return n.lift(new H(t))}}var H=function(){function BufferWhenOperator(t){this.closingSelector=t}return BufferWhenOperator.prototype.call=function(t,n){return n.subscribe(new q(t,this.closingSelector))},BufferWhenOperator}(),q=function(t){function BufferWhenSubscriber(n,i){var o=t.call(this,n)||this;return o.closingSelector=i,o.subscribing=!1,o.openBuffer(),o}return o.a(BufferWhenSubscriber,t),BufferWhenSubscriber.prototype._next=function(t){this.buffer.push(t)},BufferWhenSubscriber.prototype._complete=function(){var n=this.buffer;n&&this.destination.next(n),t.prototype._complete.call(this)},BufferWhenSubscriber.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},BufferWhenSubscriber.prototype.notifyNext=function(){this.openBuffer()},BufferWhenSubscriber.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},BufferWhenSubscriber.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe());var n,i=this.buffer;this.buffer&&this.destination.next(i),this.buffer=[];try{n=(0,this.closingSelector)()}catch(t){return this.error(t)}t=new j.a,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add(Object(a.c)(n,new a.a(this))),this.subscribing=!1},BufferWhenSubscriber}(a.b);function catchError(t){return function catchErrorOperatorFunction(n){var i=new Z(t),o=n.lift(i);return i.caught=o}}var Z=function(){function CatchOperator(t){this.selector=t}return CatchOperator.prototype.call=function(t,n){return n.subscribe(new X(t,this.selector,this.caught))},CatchOperator}(),X=function(t){function CatchSubscriber(n,i,o){var a=t.call(this,n)||this;return a.selector=i,a.caught=o,a}return o.a(CatchSubscriber,t),CatchSubscriber.prototype.error=function(n){if(!this.isStopped){var i=void 0;try{i=this.selector(n,this.caught)}catch(n){return void t.prototype.error.call(this,n)}this._unsubscribeAndRecycle();var o=new a.a(this);this.add(o);var s=Object(a.c)(i,o);s!==o&&this.add(s)}},CatchSubscriber}(a.b),Q=i(107);function combineAll(t){return function(n){return n.lift(new Q.a(t))}}var Y=i(13),J=i(28);function combineLatest_combineLatest(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=null;return"function"==typeof t[t.length-1]&&(i=t.pop()),1===t.length&&Object(Y.a)(t[0])&&(t=t[0].slice()),function(n){return n.lift.call(Object(J.a)([n].concat(t)),new Q.a(i))}}var K=i(74);function concat_concat(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){return n.lift.call(K.a.apply(void 0,[n].concat(t)))}}var $=i(162),ee=i(63);function concatMap(t,n){return Object(ee.b)(t,n,1)}function concatMapTo(t,n){return concatMap((function(){return t}),n)}function count_count(t){return function(n){return n.lift(new te(t,n))}}var te=function(){function CountOperator(t,n){this.predicate=t,this.source=n}return CountOperator.prototype.call=function(t,n){return n.subscribe(new ne(t,this.predicate,this.source))},CountOperator}(),ne=function(t){function CountSubscriber(n,i,o){var a=t.call(this,n)||this;return a.predicate=i,a.source=o,a.count=0,a.index=0,a}return o.a(CountSubscriber,t),CountSubscriber.prototype._next=function(t){this.predicate?this._tryPredicate(t):this.count++},CountSubscriber.prototype._tryPredicate=function(t){var n;try{n=this.predicate(t,this.index++,this.source)}catch(t){return void this.destination.error(t)}n&&this.count++},CountSubscriber.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},CountSubscriber}(T.a);function debounce(t){return function(n){return n.lift(new re(t))}}var re=function(){function DebounceOperator(t){this.durationSelector=t}return DebounceOperator.prototype.call=function(t,n){return n.subscribe(new ie(t,this.durationSelector))},DebounceOperator}(),ie=function(t){function DebounceSubscriber(n,i){var o=t.call(this,n)||this;return o.durationSelector=i,o.hasValue=!1,o}return o.a(DebounceSubscriber,t),DebounceSubscriber.prototype._next=function(t){try{var n=this.durationSelector.call(this,t);n&&this._tryNext(t,n)}catch(t){this.destination.error(t)}},DebounceSubscriber.prototype._complete=function(){this.emitValue(),this.destination.complete()},DebounceSubscriber.prototype._tryNext=function(t,n){var i=this.durationSubscription;this.value=t,this.hasValue=!0,i&&(i.unsubscribe(),this.remove(i)),(i=Object(a.c)(n,new a.a(this)))&&!i.closed&&this.add(this.durationSubscription=i)},DebounceSubscriber.prototype.notifyNext=function(){this.emitValue()},DebounceSubscriber.prototype.notifyComplete=function(){this.emitValue()},DebounceSubscriber.prototype.emitValue=function(){if(this.hasValue){var n=this.value,i=this.durationSubscription;i&&(this.durationSubscription=void 0,i.unsubscribe(),this.remove(i)),this.value=void 0,this.hasValue=!1,t.prototype._next.call(this,n)}},DebounceSubscriber}(a.b);function debounceTime(t,n){return void 0===n&&(n=g.a),function(i){return i.lift(new oe(t,n))}}var oe=function(){function DebounceTimeOperator(t,n){this.dueTime=t,this.scheduler=n}return DebounceTimeOperator.prototype.call=function(t,n){return n.subscribe(new ae(t,this.dueTime,this.scheduler))},DebounceTimeOperator}(),ae=function(t){function DebounceTimeSubscriber(n,i,o){var a=t.call(this,n)||this;return a.dueTime=i,a.scheduler=o,a.debouncedSubscription=null,a.lastValue=null,a.hasValue=!1,a}return o.a(DebounceTimeSubscriber,t),DebounceTimeSubscriber.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(dispatchNext,this.dueTime,this))},DebounceTimeSubscriber.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},DebounceTimeSubscriber.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},DebounceTimeSubscriber.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},DebounceTimeSubscriber}(T.a);function dispatchNext(t){t.debouncedNext()}function defaultIfEmpty(t){return void 0===t&&(t=null),function(n){return n.lift(new se(t))}}var se=function(){function DefaultIfEmptyOperator(t){this.defaultValue=t}return DefaultIfEmptyOperator.prototype.call=function(t,n){return n.subscribe(new ce(t,this.defaultValue))},DefaultIfEmptyOperator}(),ce=function(t){function DefaultIfEmptySubscriber(n,i){var o=t.call(this,n)||this;return o.defaultValue=i,o.isEmpty=!0,o}return o.a(DefaultIfEmptySubscriber,t),DefaultIfEmptySubscriber.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},DefaultIfEmptySubscriber.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},DefaultIfEmptySubscriber}(T.a);function isDate(t){return t instanceof Date&&!isNaN(+t)}var ue=i(44);function delay_delay(t,n){void 0===n&&(n=g.a);var i=isDate(t)?+t-n.now():Math.abs(t);return function(t){return t.lift(new le(i,n))}}var le=function(){function DelayOperator(t,n){this.delay=t,this.scheduler=n}return DelayOperator.prototype.call=function(t,n){return n.subscribe(new he(t,this.delay,this.scheduler))},DelayOperator}(),he=function(t){function DelaySubscriber(n,i,o){var a=t.call(this,n)||this;return a.delay=i,a.scheduler=o,a.queue=[],a.active=!1,a.errored=!1,a}return o.a(DelaySubscriber,t),DelaySubscriber.dispatch=function(t){for(var n=t.source,i=n.queue,o=t.scheduler,a=t.destination;i.length>0&&i[0].time-o.now()<=0;)i.shift().notification.observe(a);if(i.length>0){var s=Math.max(0,i[0].time-o.now());this.schedule(t,s)}else this.unsubscribe(),n.active=!1},DelaySubscriber.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(DelaySubscriber.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},DelaySubscriber.prototype.scheduleNotification=function(t){if(!0!==this.errored){var n=this.scheduler,i=new de(n.now()+this.delay,t);this.queue.push(i),!1===this.active&&this._schedule(n)}},DelaySubscriber.prototype._next=function(t){this.scheduleNotification(ue.a.createNext(t))},DelaySubscriber.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},DelaySubscriber.prototype._complete=function(){this.scheduleNotification(ue.a.createComplete()),this.unsubscribe()},DelaySubscriber}(T.a),de=function DelayMessage(t,n){this.time=t,this.notification=n},pe=i(5);function delayWhen(t,n){return n?function(i){return new ge(i,n).lift(new fe(t))}:function(n){return n.lift(new fe(t))}}var fe=function(){function DelayWhenOperator(t){this.delayDurationSelector=t}return DelayWhenOperator.prototype.call=function(t,n){return n.subscribe(new me(t,this.delayDurationSelector))},DelayWhenOperator}(),me=function(t){function DelayWhenSubscriber(n,i){var o=t.call(this,n)||this;return o.delayDurationSelector=i,o.completed=!1,o.delayNotifierSubscriptions=[],o.index=0,o}return o.a(DelayWhenSubscriber,t),DelayWhenSubscriber.prototype.notifyNext=function(t,n,i,o,a){this.destination.next(t),this.removeSubscription(a),this.tryComplete()},DelayWhenSubscriber.prototype.notifyError=function(t,n){this._error(t)},DelayWhenSubscriber.prototype.notifyComplete=function(t){var n=this.removeSubscription(t);n&&this.destination.next(n),this.tryComplete()},DelayWhenSubscriber.prototype._next=function(t){var n=this.index++;try{var i=this.delayDurationSelector(t,n);i&&this.tryDelay(i,t)}catch(t){this.destination.error(t)}},DelayWhenSubscriber.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},DelayWhenSubscriber.prototype.removeSubscription=function(t){t.unsubscribe();var n=this.delayNotifierSubscriptions.indexOf(t);return-1!==n&&this.delayNotifierSubscriptions.splice(n,1),t.outerValue},DelayWhenSubscriber.prototype.tryDelay=function(t,n){var i=Object(V.a)(this,t,n);i&&!i.closed&&(this.destination.add(i),this.delayNotifierSubscriptions.push(i))},DelayWhenSubscriber.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},DelayWhenSubscriber}(U.a),ge=function(t){function SubscriptionDelayObservable(n,i){var o=t.call(this)||this;return o.source=n,o.subscriptionDelay=i,o}return o.a(SubscriptionDelayObservable,t),SubscriptionDelayObservable.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new ye(t,this.source))},SubscriptionDelayObservable}(pe.a),ye=function(t){function SubscriptionDelaySubscriber(n,i){var o=t.call(this)||this;return o.parent=n,o.source=i,o.sourceSubscribed=!1,o}return o.a(SubscriptionDelaySubscriber,t),SubscriptionDelaySubscriber.prototype._next=function(t){this.subscribeToSource()},SubscriptionDelaySubscriber.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},SubscriptionDelaySubscriber.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},SubscriptionDelaySubscriber.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},SubscriptionDelaySubscriber}(T.a);function dematerialize(){return function dematerializeOperatorFunction(t){return t.lift(new ve)}}var ve=function(){function DeMaterializeOperator(){}return DeMaterializeOperator.prototype.call=function(t,n){return n.subscribe(new be(t))},DeMaterializeOperator}(),be=function(t){function DeMaterializeSubscriber(n){return t.call(this,n)||this}return o.a(DeMaterializeSubscriber,t),DeMaterializeSubscriber.prototype._next=function(t){t.observe(this.destination)},DeMaterializeSubscriber}(T.a);function distinct(t,n){return function(i){return i.lift(new _e(t,n))}}var _e=function(){function DistinctOperator(t,n){this.keySelector=t,this.flushes=n}return DistinctOperator.prototype.call=function(t,n){return n.subscribe(new we(t,this.keySelector,this.flushes))},DistinctOperator}(),we=function(t){function DistinctSubscriber(n,i,o){var s=t.call(this,n)||this;return s.keySelector=i,s.values=new Set,o&&s.add(Object(a.c)(o,new a.a(s))),s}return o.a(DistinctSubscriber,t),DistinctSubscriber.prototype.notifyNext=function(){this.values.clear()},DistinctSubscriber.prototype.notifyError=function(t){this._error(t)},DistinctSubscriber.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},DistinctSubscriber.prototype._useKeySelector=function(t){var n,i=this.destination;try{n=this.keySelector(t)}catch(t){return void i.error(t)}this._finalizeNext(n,t)},DistinctSubscriber.prototype._finalizeNext=function(t,n){var i=this.values;i.has(t)||(i.add(t),this.destination.next(n))},DistinctSubscriber}(a.b);function distinctUntilChanged(t,n){return function(i){return i.lift(new xe(t,n))}}var xe=function(){function DistinctUntilChangedOperator(t,n){this.compare=t,this.keySelector=n}return DistinctUntilChangedOperator.prototype.call=function(t,n){return n.subscribe(new Se(t,this.compare,this.keySelector))},DistinctUntilChangedOperator}(),Se=function(t){function DistinctUntilChangedSubscriber(n,i,o){var a=t.call(this,n)||this;return a.keySelector=o,a.hasKey=!1,"function"==typeof i&&(a.compare=i),a}return o.a(DistinctUntilChangedSubscriber,t),DistinctUntilChangedSubscriber.prototype.compare=function(t,n){return t===n},DistinctUntilChangedSubscriber.prototype._next=function(t){var n;try{var i=this.keySelector;n=i?i(t):t}catch(t){return this.destination.error(t)}var o=!1;if(this.hasKey)try{o=(0,this.compare)(this.key,n)}catch(t){return this.destination.error(t)}else this.hasKey=!0;o||(this.key=n,this.destination.next(t))},DistinctUntilChangedSubscriber}(T.a);function distinctUntilKeyChanged(t,n){return distinctUntilChanged((function(i,o){return n?n(i[t],o[t]):i[t]===o[t]}))}var Me=i(58),Ee=i(43),Te=i(62);function throwIfEmpty(t){return void 0===t&&(t=defaultErrorFactory),function(n){return n.lift(new Ce(t))}}var Ce=function(){function ThrowIfEmptyOperator(t){this.errorFactory=t}return ThrowIfEmptyOperator.prototype.call=function(t,n){return n.subscribe(new Oe(t,this.errorFactory))},ThrowIfEmptyOperator}(),Oe=function(t){function ThrowIfEmptySubscriber(n,i){var o=t.call(this,n)||this;return o.errorFactory=i,o.hasValue=!1,o}return o.a(ThrowIfEmptySubscriber,t),ThrowIfEmptySubscriber.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},ThrowIfEmptySubscriber.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(n){t=n}this.destination.error(t)},ThrowIfEmptySubscriber}(T.a);function defaultErrorFactory(){return new Te.a}var Ae=i(26);function take(t){return function(n){return 0===t?Object(Ae.b)():n.lift(new Pe(t))}}var Pe=function(){function TakeOperator(t){if(this.total=t,this.total<0)throw new Me.a}return TakeOperator.prototype.call=function(t,n){return n.subscribe(new Le(t,this.total))},TakeOperator}(),Le=function(t){function TakeSubscriber(n,i){var o=t.call(this,n)||this;return o.total=i,o.count=0,o}return o.a(TakeSubscriber,t),TakeSubscriber.prototype._next=function(t){var n=this.total,i=++this.count;i<=n&&(this.destination.next(t),i===n&&(this.destination.complete(),this.unsubscribe()))},TakeSubscriber}(T.a);function elementAt(t,n){if(t<0)throw new Me.a;var i=arguments.length>=2;return function(o){return o.pipe(Object(Ee.a)((function(n,i){return i===t})),take(1),i?defaultIfEmpty(n):throwIfEmpty((function(){return new Me.a})))}}var Re=i(80);function endWith(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){return Object(K.a)(n,Re.a.apply(void 0,t))}}function every(t,n){return function(i){return i.lift(new Ne(t,n,i))}}var Ne=function(){function EveryOperator(t,n,i){this.predicate=t,this.thisArg=n,this.source=i}return EveryOperator.prototype.call=function(t,n){return n.subscribe(new Ie(t,this.predicate,this.thisArg,this.source))},EveryOperator}(),Ie=function(t){function EverySubscriber(n,i,o,a){var s=t.call(this,n)||this;return s.predicate=i,s.thisArg=o,s.source=a,s.index=0,s.thisArg=o||s,s}return o.a(EverySubscriber,t),EverySubscriber.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},EverySubscriber.prototype._next=function(t){var n=!1;try{n=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}n||this.notifyComplete(!1)},EverySubscriber.prototype._complete=function(){this.notifyComplete(!0)},EverySubscriber}(T.a);function exhaust(){return function(t){return t.lift(new ke)}}var ke=function(){function SwitchFirstOperator(){}return SwitchFirstOperator.prototype.call=function(t,n){return n.subscribe(new je(t))},SwitchFirstOperator}(),je=function(t){function SwitchFirstSubscriber(n){var i=t.call(this,n)||this;return i.hasCompleted=!1,i.hasSubscription=!1,i}return o.a(SwitchFirstSubscriber,t),SwitchFirstSubscriber.prototype._next=function(t){this.hasSubscription||(this.hasSubscription=!0,this.add(Object(a.c)(t,new a.a(this))))},SwitchFirstSubscriber.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},SwitchFirstSubscriber.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},SwitchFirstSubscriber}(a.b),Fe=i(19);function exhaustMap(t,n){return n?function(i){return i.pipe(exhaustMap((function(i,o){return Object(J.a)(t(i,o)).pipe(Object(Fe.a)((function(t,a){return n(i,t,o,a)})))})))}:function(n){return n.lift(new De(t))}}var De=function(){function ExhaustMapOperator(t){this.project=t}return ExhaustMapOperator.prototype.call=function(t,n){return n.subscribe(new Be(t,this.project))},ExhaustMapOperator}(),Be=function(t){function ExhaustMapSubscriber(n,i){var o=t.call(this,n)||this;return o.project=i,o.hasSubscription=!1,o.hasCompleted=!1,o.index=0,o}return o.a(ExhaustMapSubscriber,t),ExhaustMapSubscriber.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},ExhaustMapSubscriber.prototype.tryNext=function(t){var n,i=this.index++;try{n=this.project(t,i)}catch(t){return void this.destination.error(t)}this.hasSubscription=!0,this._innerSub(n)},ExhaustMapSubscriber.prototype._innerSub=function(t){var n=new a.a(this),i=this.destination;i.add(n);var o=Object(a.c)(t,n);o!==n&&i.add(o)},ExhaustMapSubscriber.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},ExhaustMapSubscriber.prototype.notifyNext=function(t){this.destination.next(t)},ExhaustMapSubscriber.prototype.notifyError=function(t){this.destination.error(t)},ExhaustMapSubscriber.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},ExhaustMapSubscriber}(a.b);function expand(t,n,i){return void 0===n&&(n=Number.POSITIVE_INFINITY),n=(n||0)<1?Number.POSITIVE_INFINITY:n,function(o){return o.lift(new Ve(t,n,i))}}var Ve=function(){function ExpandOperator(t,n,i){this.project=t,this.concurrent=n,this.scheduler=i}return ExpandOperator.prototype.call=function(t,n){return n.subscribe(new Ue(t,this.project,this.concurrent,this.scheduler))},ExpandOperator}(),Ue=function(t){function ExpandSubscriber(n,i,o,a){var s=t.call(this,n)||this;return s.project=i,s.concurrent=o,s.scheduler=a,s.index=0,s.active=0,s.hasCompleted=!1,o<Number.POSITIVE_INFINITY&&(s.buffer=[]),s}return o.a(ExpandSubscriber,t),ExpandSubscriber.dispatch=function(t){var n=t.subscriber,i=t.result,o=t.value,a=t.index;n.subscribeToProjection(i,o,a)},ExpandSubscriber.prototype._next=function(t){var n=this.destination;if(n.closed)this._complete();else{var i=this.index++;if(this.active<this.concurrent){n.next(t);try{var o=(0,this.project)(t,i);if(this.scheduler){var a={subscriber:this,result:o,value:t,index:i};this.destination.add(this.scheduler.schedule(ExpandSubscriber.dispatch,0,a))}else this.subscribeToProjection(o,t,i)}catch(t){n.error(t)}}else this.buffer.push(t)}},ExpandSubscriber.prototype.subscribeToProjection=function(t,n,i){this.active++,this.destination.add(Object(a.c)(t,new a.a(this)))},ExpandSubscriber.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},ExpandSubscriber.prototype.notifyNext=function(t){this._next(t)},ExpandSubscriber.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},ExpandSubscriber}(a.b);function finalize(t){return function(n){return n.lift(new Ge(t))}}var Ge=function(){function FinallyOperator(t){this.callback=t}return FinallyOperator.prototype.call=function(t,n){return n.subscribe(new ze(t,this.callback))},FinallyOperator}(),ze=function(t){function FinallySubscriber(n,i){var o=t.call(this,n)||this;return o.add(new j.a(i)),o}return o.a(FinallySubscriber,t),FinallySubscriber}(T.a);function find(t,n){if("function"!=typeof t)throw new TypeError("predicate is not a function");return function(i){return i.lift(new He(t,i,!1,n))}}var He=function(){function FindValueOperator(t,n,i,o){this.predicate=t,this.source=n,this.yieldIndex=i,this.thisArg=o}return FindValueOperator.prototype.call=function(t,n){return n.subscribe(new We(t,this.predicate,this.source,this.yieldIndex,this.thisArg))},FindValueOperator}(),We=function(t){function FindValueSubscriber(n,i,o,a,s){var m=t.call(this,n)||this;return m.predicate=i,m.source=o,m.yieldIndex=a,m.thisArg=s,m.index=0,m}return o.a(FindValueSubscriber,t),FindValueSubscriber.prototype.notifyComplete=function(t){var n=this.destination;n.next(t),n.complete(),this.unsubscribe()},FindValueSubscriber.prototype._next=function(t){var n=this.predicate,i=this.thisArg,o=this.index++;try{n.call(i||this,t,o,this.source)&&this.notifyComplete(this.yieldIndex?o:t)}catch(t){this.destination.error(t)}},FindValueSubscriber.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},FindValueSubscriber}(T.a);function findIndex(t,n){return function(i){return i.lift(new He(t,i,!0,n))}}var qe=i(40);function first(t,n){var i=arguments.length>=2;return function(o){return o.pipe(t?Object(Ee.a)((function(n,i){return t(n,i,o)})):qe.a,take(1),i?defaultIfEmpty(n):throwIfEmpty((function(){return new Te.a})))}}var Ze=i(137);function ignoreElements(){return function ignoreElementsOperatorFunction(t){return t.lift(new Xe)}}var Xe=function(){function IgnoreElementsOperator(){}return IgnoreElementsOperator.prototype.call=function(t,n){return n.subscribe(new Qe(t))},IgnoreElementsOperator}(),Qe=function(t){function IgnoreElementsSubscriber(){return null!==t&&t.apply(this,arguments)||this}return o.a(IgnoreElementsSubscriber,t),IgnoreElementsSubscriber.prototype._next=function(t){},IgnoreElementsSubscriber}(T.a);function isEmpty(){return function(t){return t.lift(new Ye)}}var Ye=function(){function IsEmptyOperator(){}return IsEmptyOperator.prototype.call=function(t,n){return n.subscribe(new Je(t))},IsEmptyOperator}(),Je=function(t){function IsEmptySubscriber(n){return t.call(this,n)||this}return o.a(IsEmptySubscriber,t),IsEmptySubscriber.prototype.notifyComplete=function(t){var n=this.destination;n.next(t),n.complete()},IsEmptySubscriber.prototype._next=function(t){this.notifyComplete(!1)},IsEmptySubscriber.prototype._complete=function(){this.notifyComplete(!0)},IsEmptySubscriber}(T.a);function takeLast(t){return function takeLastOperatorFunction(n){return 0===t?Object(Ae.b)():n.lift(new Ke(t))}}var Ke=function(){function TakeLastOperator(t){if(this.total=t,this.total<0)throw new Me.a}return TakeLastOperator.prototype.call=function(t,n){return n.subscribe(new $e(t,this.total))},TakeLastOperator}(),$e=function(t){function TakeLastSubscriber(n,i){var o=t.call(this,n)||this;return o.total=i,o.ring=new Array,o.count=0,o}return o.a(TakeLastSubscriber,t),TakeLastSubscriber.prototype._next=function(t){var n=this.ring,i=this.total,o=this.count++;n.length<i?n.push(t):n[o%i]=t},TakeLastSubscriber.prototype._complete=function(){var t=this.destination,n=this.count;if(n>0)for(var i=this.count>=this.total?this.total:this.count,o=this.ring,a=0;a<i;a++){var s=n++%i;t.next(o[s])}t.complete()},TakeLastSubscriber}(T.a);function last(t,n){var i=arguments.length>=2;return function(o){return o.pipe(t?Object(Ee.a)((function(n,i){return t(n,i,o)})):qe.a,takeLast(1),i?defaultIfEmpty(n):throwIfEmpty((function(){return new Te.a})))}}function mapTo(t){return function(n){return n.lift(new et(t))}}var et=function(){function MapToOperator(t){this.value=t}return MapToOperator.prototype.call=function(t,n){return n.subscribe(new tt(t,this.value))},MapToOperator}(),tt=function(t){function MapToSubscriber(n,i){var o=t.call(this,n)||this;return o.value=i,o}return o.a(MapToSubscriber,t),MapToSubscriber.prototype._next=function(t){this.destination.next(this.value)},MapToSubscriber}(T.a);function materialize(){return function materializeOperatorFunction(t){return t.lift(new nt)}}var nt=function(){function MaterializeOperator(){}return MaterializeOperator.prototype.call=function(t,n){return n.subscribe(new rt(t))},MaterializeOperator}(),rt=function(t){function MaterializeSubscriber(n){return t.call(this,n)||this}return o.a(MaterializeSubscriber,t),MaterializeSubscriber.prototype._next=function(t){this.destination.next(ue.a.createNext(t))},MaterializeSubscriber.prototype._error=function(t){var n=this.destination;n.next(ue.a.createError(t)),n.complete()},MaterializeSubscriber.prototype._complete=function(){var t=this.destination;t.next(ue.a.createComplete()),t.complete()},MaterializeSubscriber}(T.a);function scan(t,n){var i=!1;return arguments.length>=2&&(i=!0),function scanOperatorFunction(o){return o.lift(new it(t,n,i))}}var it=function(){function ScanOperator(t,n,i){void 0===i&&(i=!1),this.accumulator=t,this.seed=n,this.hasSeed=i}return ScanOperator.prototype.call=function(t,n){return n.subscribe(new ot(t,this.accumulator,this.seed,this.hasSeed))},ScanOperator}(),ot=function(t){function ScanSubscriber(n,i,o,a){var s=t.call(this,n)||this;return s.accumulator=i,s._seed=o,s.hasSeed=a,s.index=0,s}return o.a(ScanSubscriber,t),Object.defineProperty(ScanSubscriber.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),ScanSubscriber.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},ScanSubscriber.prototype._tryNext=function(t){var n,i=this.index++;try{n=this.accumulator(this.seed,t,i)}catch(t){this.destination.error(t)}this.seed=n,this.destination.next(n)},ScanSubscriber}(T.a),at=i(86);function reduce(t,n){return arguments.length>=2?function reduceOperatorFunctionWithSeed(i){return Object(at.a)(scan(t,n),takeLast(1),defaultIfEmpty(n))(i)}:function reduceOperatorFunction(n){return Object(at.a)(scan((function(n,i,o){return t(n,i,o+1)})),takeLast(1))(n)}}function max_max(t){return reduce("function"==typeof t?function(n,i){return t(n,i)>0?n:i}:function(t,n){return t>n?t:n})}var st=i(163);function merge_merge(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){return n.lift.call(st.a.apply(void 0,[n].concat(t)))}}var ct=i(108);function mergeMapTo(t,n,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),"function"==typeof n?Object(ee.b)((function(){return t}),n,i):("number"==typeof n&&(i=n),Object(ee.b)((function(){return t}),i))}function mergeScan(t,n,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),function(o){return o.lift(new ut(t,n,i))}}var ut=function(){function MergeScanOperator(t,n,i){this.accumulator=t,this.seed=n,this.concurrent=i}return MergeScanOperator.prototype.call=function(t,n){return n.subscribe(new lt(t,this.accumulator,this.seed,this.concurrent))},MergeScanOperator}(),lt=function(t){function MergeScanSubscriber(n,i,o,a){var s=t.call(this,n)||this;return s.accumulator=i,s.acc=o,s.concurrent=a,s.hasValue=!1,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return o.a(MergeScanSubscriber,t),MergeScanSubscriber.prototype._next=function(t){if(this.active<this.concurrent){var n=this.index++,i=this.destination,o=void 0;try{o=(0,this.accumulator)(this.acc,t,n)}catch(t){return i.error(t)}this.active++,this._innerSub(o)}else this.buffer.push(t)},MergeScanSubscriber.prototype._innerSub=function(t){var n=new a.a(this),i=this.destination;i.add(n);var o=Object(a.c)(t,n);o!==n&&i.add(o)},MergeScanSubscriber.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},MergeScanSubscriber.prototype.notifyNext=function(t){var n=this.destination;this.acc=t,this.hasValue=!0,n.next(t)},MergeScanSubscriber.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},MergeScanSubscriber}(a.b);function min_min(t){return reduce("function"==typeof t?function(n,i){return t(n,i)<0?n:i}:function(t,n){return t<n?t:n})}var ht=i(158);function multicast(t,n){return function multicastOperatorFunction(i){var o;if(o="function"==typeof t?t:function subjectFactory(){return t},"function"==typeof n)return i.lift(new dt(o,n));var a=Object.create(i,ht.b);return a.source=i,a.subjectFactory=o,a}}var dt=function(){function MulticastOperator(t,n){this.subjectFactory=t,this.selector=n}return MulticastOperator.prototype.call=function(t,n){var i=this.selector,o=this.subjectFactory(),a=i(o).subscribe(t);return a.add(n.subscribe(o)),a},MulticastOperator}(),pt=i(160);function onErrorResumeNext(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 1===t.length&&Object(Y.a)(t[0])&&(t=t[0]),function(n){return n.lift(new ft(t))}}var ft=function(){function OnErrorResumeNextOperator(t){this.nextSources=t}return OnErrorResumeNextOperator.prototype.call=function(t,n){return n.subscribe(new mt(t,this.nextSources))},OnErrorResumeNextOperator}(),mt=function(t){function OnErrorResumeNextSubscriber(n,i){var o=t.call(this,n)||this;return o.destination=n,o.nextSources=i,o}return o.a(OnErrorResumeNextSubscriber,t),OnErrorResumeNextSubscriber.prototype.notifyError=function(){this.subscribeToNextSource()},OnErrorResumeNextSubscriber.prototype.notifyComplete=function(){this.subscribeToNextSource()},OnErrorResumeNextSubscriber.prototype._error=function(t){this.subscribeToNextSource(),this.unsubscribe()},OnErrorResumeNextSubscriber.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},OnErrorResumeNextSubscriber.prototype.subscribeToNextSource=function(){var t=this.nextSources.shift();if(t){var n=new a.a(this),i=this.destination;i.add(n);var o=Object(a.c)(t,n);o!==n&&i.add(o)}else this.destination.complete()},OnErrorResumeNextSubscriber}(a.b);function pairwise(){return function(t){return t.lift(new gt)}}var gt=function(){function PairwiseOperator(){}return PairwiseOperator.prototype.call=function(t,n){return n.subscribe(new yt(t))},PairwiseOperator}(),yt=function(t){function PairwiseSubscriber(n){var i=t.call(this,n)||this;return i.hasPrev=!1,i}return o.a(PairwiseSubscriber,t),PairwiseSubscriber.prototype._next=function(t){var n;this.hasPrev?n=[this.prev,t]:this.hasPrev=!0,this.prev=t,n&&this.destination.next(n)},PairwiseSubscriber}(T.a),vt=i(175);function partition(t,n){return function(i){return[Object(Ee.a)(t,n)(i),Object(Ee.a)(Object(vt.a)(t,n))(i)]}}function pluck(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=t.length;if(0===i)throw new Error("list of properties cannot be empty.");return function(n){return Object(Fe.a)(plucker(t,i))(n)}}function plucker(t,n){return function(i){for(var o=i,a=0;a<n;a++){var s=null!=o?o[t[a]]:void 0;if(void 0===s)return;o=s}return o}}var bt=i(11);function publish(t){return t?multicast((function(){return new bt.a}),t):multicast(new bt.a)}var _t=i(159);function publishBehavior(t){return function(n){return multicast(new _t.a(t))(n)}}var wt=i(66);function publishLast(){return function(t){return multicast(new wt.a)(t)}}var xt=i(105);function publishReplay(t,n,i,o){i&&"function"!=typeof i&&(o=i);var a="function"==typeof i?i:void 0,s=new xt.a(t,n,o);return function(t){return multicast((function(){return s}),a)(t)}}var St=i(164);function race_race(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function raceOperatorFunction(n){return 1===t.length&&Object(Y.a)(t[0])&&(t=t[0]),n.lift.call(St.a.apply(void 0,[n].concat(t)))}}function repeat(t){return void 0===t&&(t=-1),function(n){return 0===t?Object(Ae.b)():t<0?n.lift(new Mt(-1,n)):n.lift(new Mt(t-1,n))}}var Mt=function(){function RepeatOperator(t,n){this.count=t,this.source=n}return RepeatOperator.prototype.call=function(t,n){return n.subscribe(new Et(t,this.count,this.source))},RepeatOperator}(),Et=function(t){function RepeatSubscriber(n,i,o){var a=t.call(this,n)||this;return a.count=i,a.source=o,a}return o.a(RepeatSubscriber,t),RepeatSubscriber.prototype.complete=function(){if(!this.isStopped){var n=this.source,i=this.count;if(0===i)return t.prototype.complete.call(this);i>-1&&(this.count=i-1),n.subscribe(this._unsubscribeAndRecycle())}},RepeatSubscriber}(T.a);function repeatWhen(t){return function(n){return n.lift(new Tt(t))}}var Tt=function(){function RepeatWhenOperator(t){this.notifier=t}return RepeatWhenOperator.prototype.call=function(t,n){return n.subscribe(new Ct(t,this.notifier,n))},RepeatWhenOperator}(),Ct=function(t){function RepeatWhenSubscriber(n,i,o){var a=t.call(this,n)||this;return a.notifier=i,a.source=o,a.sourceIsBeingSubscribedTo=!0,a}return o.a(RepeatWhenSubscriber,t),RepeatWhenSubscriber.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},RepeatWhenSubscriber.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return t.prototype.complete.call(this)},RepeatWhenSubscriber.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return t.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},RepeatWhenSubscriber.prototype._unsubscribe=function(){var t=this.notifications,n=this.retriesSubscription;t&&(t.unsubscribe(),this.notifications=void 0),n&&(n.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},RepeatWhenSubscriber.prototype._unsubscribeAndRecycle=function(){var n=this._unsubscribe;return this._unsubscribe=null,t.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=n,this},RepeatWhenSubscriber.prototype.subscribeToRetries=function(){var n;this.notifications=new bt.a;try{n=(0,this.notifier)(this.notifications)}catch(n){return t.prototype.complete.call(this)}this.retries=n,this.retriesSubscription=Object(a.c)(n,new a.a(this))},RepeatWhenSubscriber}(a.b);function retry(t){return void 0===t&&(t=-1),function(n){return n.lift(new Ot(t,n))}}var Ot=function(){function RetryOperator(t,n){this.count=t,this.source=n}return RetryOperator.prototype.call=function(t,n){return n.subscribe(new At(t,this.count,this.source))},RetryOperator}(),At=function(t){function RetrySubscriber(n,i,o){var a=t.call(this,n)||this;return a.count=i,a.source=o,a}return o.a(RetrySubscriber,t),RetrySubscriber.prototype.error=function(n){if(!this.isStopped){var i=this.source,o=this.count;if(0===o)return t.prototype.error.call(this,n);o>-1&&(this.count=o-1),i.subscribe(this._unsubscribeAndRecycle())}},RetrySubscriber}(T.a);function retryWhen(t){return function(n){return n.lift(new Pt(t,n))}}var Pt=function(){function RetryWhenOperator(t,n){this.notifier=t,this.source=n}return RetryWhenOperator.prototype.call=function(t,n){return n.subscribe(new Lt(t,this.notifier,this.source))},RetryWhenOperator}(),Lt=function(t){function RetryWhenSubscriber(n,i,o){var a=t.call(this,n)||this;return a.notifier=i,a.source=o,a}return o.a(RetryWhenSubscriber,t),RetryWhenSubscriber.prototype.error=function(n){if(!this.isStopped){var i=this.errors,o=this.retries,s=this.retriesSubscription;if(o)this.errors=void 0,this.retriesSubscription=void 0;else{i=new bt.a;try{o=(0,this.notifier)(i)}catch(n){return t.prototype.error.call(this,n)}s=Object(a.c)(o,new a.a(this))}this._unsubscribeAndRecycle(),this.errors=i,this.retries=o,this.retriesSubscription=s,i.next(n)}},RetryWhenSubscriber.prototype._unsubscribe=function(){var t=this.errors,n=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=void 0),n&&(n.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},RetryWhenSubscriber.prototype.notifyNext=function(){var t=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=t,this.source.subscribe(this)},RetryWhenSubscriber}(a.b),Rt=i(104);function sample(t){return function(n){return n.lift(new Nt(t))}}var Nt=function(){function SampleOperator(t){this.notifier=t}return SampleOperator.prototype.call=function(t,n){var i=new It(t),o=n.subscribe(i);return o.add(Object(a.c)(this.notifier,new a.a(i))),o},SampleOperator}(),It=function(t){function SampleSubscriber(){var n=null!==t&&t.apply(this,arguments)||this;return n.hasValue=!1,n}return o.a(SampleSubscriber,t),SampleSubscriber.prototype._next=function(t){this.value=t,this.hasValue=!0},SampleSubscriber.prototype.notifyNext=function(){this.emitValue()},SampleSubscriber.prototype.notifyComplete=function(){this.emitValue()},SampleSubscriber.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},SampleSubscriber}(a.b);function sampleTime(t,n){return void 0===n&&(n=g.a),function(i){return i.lift(new kt(t,n))}}var kt=function(){function SampleTimeOperator(t,n){this.period=t,this.scheduler=n}return SampleTimeOperator.prototype.call=function(t,n){return n.subscribe(new jt(t,this.period,this.scheduler))},SampleTimeOperator}(),jt=function(t){function SampleTimeSubscriber(n,i,o){var a=t.call(this,n)||this;return a.period=i,a.scheduler=o,a.hasValue=!1,a.add(o.schedule(dispatchNotification,i,{subscriber:a,period:i})),a}return o.a(SampleTimeSubscriber,t),SampleTimeSubscriber.prototype._next=function(t){this.lastValue=t,this.hasValue=!0},SampleTimeSubscriber.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},SampleTimeSubscriber}(T.a);function dispatchNotification(t){var n=t.subscriber,i=t.period;n.notifyNext(),this.schedule(t,i)}function sequenceEqual(t,n){return function(i){return i.lift(new Ft(t,n))}}var Ft=function(){function SequenceEqualOperator(t,n){this.compareTo=t,this.comparator=n}return SequenceEqualOperator.prototype.call=function(t,n){return n.subscribe(new Dt(t,this.compareTo,this.comparator))},SequenceEqualOperator}(),Dt=function(t){function SequenceEqualSubscriber(n,i,o){var a=t.call(this,n)||this;return a.compareTo=i,a.comparator=o,a._a=[],a._b=[],a._oneComplete=!1,a.destination.add(i.subscribe(new Bt(n,a))),a}return o.a(SequenceEqualSubscriber,t),SequenceEqualSubscriber.prototype._next=function(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())},SequenceEqualSubscriber.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},SequenceEqualSubscriber.prototype.checkValues=function(){for(var t=this._a,n=this._b,i=this.comparator;t.length>0&&n.length>0;){var o=t.shift(),a=n.shift(),s=!1;try{s=i?i(o,a):o===a}catch(t){this.destination.error(t)}s||this.emit(!1)}},SequenceEqualSubscriber.prototype.emit=function(t){var n=this.destination;n.next(t),n.complete()},SequenceEqualSubscriber.prototype.nextB=function(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())},SequenceEqualSubscriber.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},SequenceEqualSubscriber}(T.a),Bt=function(t){function SequenceEqualCompareToSubscriber(n,i){var o=t.call(this,n)||this;return o.parent=i,o}return o.a(SequenceEqualCompareToSubscriber,t),SequenceEqualCompareToSubscriber.prototype._next=function(t){this.parent.nextB(t)},SequenceEqualCompareToSubscriber.prototype._error=function(t){this.parent.error(t),this.unsubscribe()},SequenceEqualCompareToSubscriber.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},SequenceEqualCompareToSubscriber}(T.a);function shareSubjectFactory(){return new bt.a}function share(){return function(t){return Object(Rt.a)()(multicast(shareSubjectFactory)(t))}}function shareReplay(t,n,i){var o;return o=t&&"object"==typeof t?t:{bufferSize:t,windowTime:n,refCount:!1,scheduler:i},function(t){return t.lift(function shareReplayOperator(t){var n,i,o=t.bufferSize,a=void 0===o?Number.POSITIVE_INFINITY:o,s=t.windowTime,m=void 0===s?Number.POSITIVE_INFINITY:s,g=t.refCount,_=t.scheduler,S=0,M=!1,T=!1;return function shareReplayOperation(t){var o;S++,!n||M?(M=!1,n=new xt.a(a,m,_),o=n.subscribe(this),i=t.subscribe({next:function(t){n.next(t)},error:function(t){M=!0,n.error(t)},complete:function(){T=!0,i=void 0,n.complete()}})):o=n.subscribe(this),this.add((function(){S--,o.unsubscribe(),i&&!T&&g&&0===S&&(i.unsubscribe(),i=void 0,n=void 0)}))}}(o))}}function single(t){return function(n){return n.lift(new Vt(t,n))}}var Vt=function(){function SingleOperator(t,n){this.predicate=t,this.source=n}return SingleOperator.prototype.call=function(t,n){return n.subscribe(new Ut(t,this.predicate,this.source))},SingleOperator}(),Ut=function(t){function SingleSubscriber(n,i,o){var a=t.call(this,n)||this;return a.predicate=i,a.source=o,a.seenValue=!1,a.index=0,a}return o.a(SingleSubscriber,t),SingleSubscriber.prototype.applySingleValue=function(t){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=t)},SingleSubscriber.prototype._next=function(t){var n=this.index++;this.predicate?this.tryNext(t,n):this.applySingleValue(t)},SingleSubscriber.prototype.tryNext=function(t,n){try{this.predicate(t,n,this.source)&&this.applySingleValue(t)}catch(t){this.destination.error(t)}},SingleSubscriber.prototype._complete=function(){var t=this.destination;this.index>0?(t.next(this.seenValue?this.singleValue:void 0),t.complete()):t.error(new Te.a)},SingleSubscriber}(T.a);function skip(t){return function(n){return n.lift(new Gt(t))}}var Gt=function(){function SkipOperator(t){this.total=t}return SkipOperator.prototype.call=function(t,n){return n.subscribe(new zt(t,this.total))},SkipOperator}(),zt=function(t){function SkipSubscriber(n,i){var o=t.call(this,n)||this;return o.total=i,o.count=0,o}return o.a(SkipSubscriber,t),SkipSubscriber.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},SkipSubscriber}(T.a);function skipLast(t){return function(n){return n.lift(new Ht(t))}}var Ht=function(){function SkipLastOperator(t){if(this._skipCount=t,this._skipCount<0)throw new Me.a}return SkipLastOperator.prototype.call=function(t,n){return 0===this._skipCount?n.subscribe(new T.a(t)):n.subscribe(new Wt(t,this._skipCount))},SkipLastOperator}(),Wt=function(t){function SkipLastSubscriber(n,i){var o=t.call(this,n)||this;return o._skipCount=i,o._count=0,o._ring=new Array(i),o}return o.a(SkipLastSubscriber,t),SkipLastSubscriber.prototype._next=function(t){var n=this._skipCount,i=this._count++;if(i<n)this._ring[i]=t;else{var o=i%n,a=this._ring,s=a[o];a[o]=t,this.destination.next(s)}},SkipLastSubscriber}(T.a);function skipUntil(t){return function(n){return n.lift(new qt(t))}}var qt=function(){function SkipUntilOperator(t){this.notifier=t}return SkipUntilOperator.prototype.call=function(t,n){return n.subscribe(new Zt(t,this.notifier))},SkipUntilOperator}(),Zt=function(t){function SkipUntilSubscriber(n,i){var o=t.call(this,n)||this;o.hasValue=!1;var s=new a.a(o);o.add(s),o.innerSubscription=s;var m=Object(a.c)(i,s);return m!==s&&(o.add(m),o.innerSubscription=m),o}return o.a(SkipUntilSubscriber,t),SkipUntilSubscriber.prototype._next=function(n){this.hasValue&&t.prototype._next.call(this,n)},SkipUntilSubscriber.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},SkipUntilSubscriber.prototype.notifyComplete=function(){},SkipUntilSubscriber}(a.b);function skipWhile(t){return function(n){return n.lift(new Xt(t))}}var Xt=function(){function SkipWhileOperator(t){this.predicate=t}return SkipWhileOperator.prototype.call=function(t,n){return n.subscribe(new Qt(t,this.predicate))},SkipWhileOperator}(),Qt=function(t){function SkipWhileSubscriber(n,i){var o=t.call(this,n)||this;return o.predicate=i,o.skipping=!0,o.index=0,o}return o.a(SkipWhileSubscriber,t),SkipWhileSubscriber.prototype._next=function(t){var n=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||n.next(t)},SkipWhileSubscriber.prototype.tryCallPredicate=function(t){try{var n=this.predicate(t,this.index++);this.skipping=Boolean(n)}catch(t){this.destination.error(t)}},SkipWhileSubscriber}(T.a);function startWith(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=t[t.length-1];return Object(L.a)(i)?(t.pop(),function(n){return Object(K.a)(t,n,i)}):function(n){return Object(K.a)(t,n)}}var Yt=i(88),Jt=i(69),Kt=function(t){function SubscribeOnObservable(n,i,o){void 0===i&&(i=0),void 0===o&&(o=Yt.a);var a=t.call(this)||this;return a.source=n,a.delayTime=i,a.scheduler=o,(!Object(Jt.a)(i)||i<0)&&(a.delayTime=0),o&&"function"==typeof o.schedule||(a.scheduler=Yt.a),a}return o.a(SubscribeOnObservable,t),SubscribeOnObservable.create=function(t,n,i){return void 0===n&&(n=0),void 0===i&&(i=Yt.a),new SubscribeOnObservable(t,n,i)},SubscribeOnObservable.dispatch=function(t){var n=t.source,i=t.subscriber;return this.add(n.subscribe(i))},SubscribeOnObservable.prototype._subscribe=function(t){var n=this.delayTime,i=this.source;return this.scheduler.schedule(SubscribeOnObservable.dispatch,n,{source:i,subscriber:t})},SubscribeOnObservable}(pe.a);function subscribeOn(t,n){return void 0===n&&(n=0),function subscribeOnOperatorFunction(i){return i.lift(new $t(t,n))}}var $t=function(){function SubscribeOnOperator(t,n){this.scheduler=t,this.delay=n}return SubscribeOnOperator.prototype.call=function(t,n){return new Kt(n,this.delay,this.scheduler).subscribe(t)},SubscribeOnOperator}();function switchMap(t,n){return"function"==typeof n?function(i){return i.pipe(switchMap((function(i,o){return Object(J.a)(t(i,o)).pipe(Object(Fe.a)((function(t,a){return n(i,t,o,a)})))})))}:function(n){return n.lift(new en(t))}}var en=function(){function SwitchMapOperator(t){this.project=t}return SwitchMapOperator.prototype.call=function(t,n){return n.subscribe(new tn(t,this.project))},SwitchMapOperator}(),tn=function(t){function SwitchMapSubscriber(n,i){var o=t.call(this,n)||this;return o.project=i,o.index=0,o}return o.a(SwitchMapSubscriber,t),SwitchMapSubscriber.prototype._next=function(t){var n,i=this.index++;try{n=this.project(t,i)}catch(t){return void this.destination.error(t)}this._innerSub(n)},SwitchMapSubscriber.prototype._innerSub=function(t){var n=this.innerSubscription;n&&n.unsubscribe();var i=new a.a(this),o=this.destination;o.add(i),this.innerSubscription=Object(a.c)(t,i),this.innerSubscription!==i&&o.add(this.innerSubscription)},SwitchMapSubscriber.prototype._complete=function(){var n=this.innerSubscription;n&&!n.closed||t.prototype._complete.call(this),this.unsubscribe()},SwitchMapSubscriber.prototype._unsubscribe=function(){this.innerSubscription=void 0},SwitchMapSubscriber.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},SwitchMapSubscriber.prototype.notifyNext=function(t){this.destination.next(t)},SwitchMapSubscriber}(a.b);function switchAll(){return switchMap(qe.a)}function switchMapTo(t,n){return n?switchMap((function(){return t}),n):switchMap((function(){return t}))}function takeUntil(t){return function(n){return n.lift(new nn(t))}}var nn=function(){function TakeUntilOperator(t){this.notifier=t}return TakeUntilOperator.prototype.call=function(t,n){var i=new rn(t),o=Object(a.c)(this.notifier,new a.a(i));return o&&!i.seenValue?(i.add(o),n.subscribe(i)):i},TakeUntilOperator}(),rn=function(t){function TakeUntilSubscriber(n){var i=t.call(this,n)||this;return i.seenValue=!1,i}return o.a(TakeUntilSubscriber,t),TakeUntilSubscriber.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},TakeUntilSubscriber.prototype.notifyComplete=function(){},TakeUntilSubscriber}(a.b);function takeWhile(t,n){return void 0===n&&(n=!1),function(i){return i.lift(new an(t,n))}}var an=function(){function TakeWhileOperator(t,n){this.predicate=t,this.inclusive=n}return TakeWhileOperator.prototype.call=function(t,n){return n.subscribe(new sn(t,this.predicate,this.inclusive))},TakeWhileOperator}(),sn=function(t){function TakeWhileSubscriber(n,i,o){var a=t.call(this,n)||this;return a.predicate=i,a.inclusive=o,a.index=0,a}return o.a(TakeWhileSubscriber,t),TakeWhileSubscriber.prototype._next=function(t){var n,i=this.destination;try{n=this.predicate(t,this.index++)}catch(t){return void i.error(t)}this.nextOrComplete(t,n)},TakeWhileSubscriber.prototype.nextOrComplete=function(t,n){var i=this.destination;Boolean(n)?i.next(t):(this.inclusive&&i.next(t),i.complete())},TakeWhileSubscriber}(T.a),cn=i(49),un=i(59);function tap(t,n,i){return function tapOperatorFunction(o){return o.lift(new ln(t,n,i))}}var ln=function(){function DoOperator(t,n,i){this.nextOrObserver=t,this.error=n,this.complete=i}return DoOperator.prototype.call=function(t,n){return n.subscribe(new hn(t,this.nextOrObserver,this.error,this.complete))},DoOperator}(),hn=function(t){function TapSubscriber(n,i,o,a){var s=t.call(this,n)||this;return s._tapNext=cn.a,s._tapError=cn.a,s._tapComplete=cn.a,s._tapError=o||cn.a,s._tapComplete=a||cn.a,Object(un.a)(i)?(s._context=s,s._tapNext=i):i&&(s._context=i,s._tapNext=i.next||cn.a,s._tapError=i.error||cn.a,s._tapComplete=i.complete||cn.a),s}return o.a(TapSubscriber,t),TapSubscriber.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},TapSubscriber.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},TapSubscriber.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},TapSubscriber}(T.a),dn={leading:!0,trailing:!1};function throttle(t,n){return void 0===n&&(n=dn),function(i){return i.lift(new pn(t,!!n.leading,!!n.trailing))}}var pn=function(){function ThrottleOperator(t,n,i){this.durationSelector=t,this.leading=n,this.trailing=i}return ThrottleOperator.prototype.call=function(t,n){return n.subscribe(new fn(t,this.durationSelector,this.leading,this.trailing))},ThrottleOperator}(),fn=function(t){function ThrottleSubscriber(n,i,o,a){var s=t.call(this,n)||this;return s.destination=n,s.durationSelector=i,s._leading=o,s._trailing=a,s._hasValue=!1,s}return o.a(ThrottleSubscriber,t),ThrottleSubscriber.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},ThrottleSubscriber.prototype.send=function(){var t=this._hasValue,n=this._sendValue;t&&(this.destination.next(n),this.throttle(n)),this._hasValue=!1,this._sendValue=void 0},ThrottleSubscriber.prototype.throttle=function(t){var n=this.tryDurationSelector(t);n&&this.add(this._throttled=Object(a.c)(n,new a.a(this)))},ThrottleSubscriber.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},ThrottleSubscriber.prototype.throttlingDone=function(){var t=this._throttled,n=this._trailing;t&&t.unsubscribe(),this._throttled=void 0,n&&this.send()},ThrottleSubscriber.prototype.notifyNext=function(){this.throttlingDone()},ThrottleSubscriber.prototype.notifyComplete=function(){this.throttlingDone()},ThrottleSubscriber}(a.b);function throttleTime(t,n,i){return void 0===n&&(n=g.a),void 0===i&&(i=dn),function(o){return o.lift(new mn(t,n,i.leading,i.trailing))}}var mn=function(){function ThrottleTimeOperator(t,n,i,o){this.duration=t,this.scheduler=n,this.leading=i,this.trailing=o}return ThrottleTimeOperator.prototype.call=function(t,n){return n.subscribe(new gn(t,this.duration,this.scheduler,this.leading,this.trailing))},ThrottleTimeOperator}(),gn=function(t){function ThrottleTimeSubscriber(n,i,o,a,s){var m=t.call(this,n)||this;return m.duration=i,m.scheduler=o,m.leading=a,m.trailing=s,m._hasTrailingValue=!1,m._trailingValue=null,m}return o.a(ThrottleTimeSubscriber,t),ThrottleTimeSubscriber.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(throttleTime_dispatchNext,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},ThrottleTimeSubscriber.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},ThrottleTimeSubscriber.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},ThrottleTimeSubscriber}(T.a);function throttleTime_dispatchNext(t){t.subscriber.clearThrottle()}var yn=i(109);function timeInterval(t){return void 0===t&&(t=g.a),function(n){return Object(yn.a)((function(){return n.pipe(scan((function(n,i){var o=n.current;return{value:i,current:t.now(),last:o}}),{current:t.now(),value:void 0,last:void 0}),Object(Fe.a)((function(t){var n=t.current,i=t.last,o=t.value;return new vn(o,n-i)})))}))}}var vn=function TimeInterval(t,n){this.value=t,this.interval=n},bn=i(161);function timeoutWith(t,n,i){return void 0===i&&(i=g.a),function(o){var a=isDate(t),s=a?+t-i.now():Math.abs(t);return o.lift(new _n(s,a,n,i))}}var _n=function(){function TimeoutWithOperator(t,n,i,o){this.waitFor=t,this.absoluteTimeout=n,this.withObservable=i,this.scheduler=o}return TimeoutWithOperator.prototype.call=function(t,n){return n.subscribe(new wn(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},TimeoutWithOperator}(),wn=function(t){function TimeoutWithSubscriber(n,i,o,a,s){var m=t.call(this,n)||this;return m.absoluteTimeout=i,m.waitFor=o,m.withObservable=a,m.scheduler=s,m.scheduleTimeout(),m}return o.a(TimeoutWithSubscriber,t),TimeoutWithSubscriber.dispatchTimeout=function(t){var n=t.withObservable;t._unsubscribeAndRecycle(),t.add(Object(a.c)(n,new a.a(t)))},TimeoutWithSubscriber.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(TimeoutWithSubscriber.dispatchTimeout,this.waitFor,this))},TimeoutWithSubscriber.prototype._next=function(n){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,n)},TimeoutWithSubscriber.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},TimeoutWithSubscriber}(a.b),xn=i(106);function timeout(t,n){return void 0===n&&(n=g.a),timeoutWith(t,Object(xn.a)(new bn.a),n)}function timestamp(t){return void 0===t&&(t=g.a),Object(Fe.a)((function(n){return new Sn(n,t.now())}))}var Sn=function Timestamp(t,n){this.value=t,this.timestamp=n};function toArrayReducer(t,n,i){return 0===i?[n]:(t.push(n),t)}function toArray(){return reduce(toArrayReducer,[])}function window_window(t){return function windowOperatorFunction(n){return n.lift(new Mn(t))}}var Mn=function(){function WindowOperator(t){this.windowBoundaries=t}return WindowOperator.prototype.call=function(t,n){var i=new En(t),o=n.subscribe(i);return o.closed||i.add(Object(a.c)(this.windowBoundaries,new a.a(i))),o},WindowOperator}(),En=function(t){function WindowSubscriber(n){var i=t.call(this,n)||this;return i.window=new bt.a,n.next(i.window),i}return o.a(WindowSubscriber,t),WindowSubscriber.prototype.notifyNext=function(){this.openWindow()},WindowSubscriber.prototype.notifyError=function(t){this._error(t)},WindowSubscriber.prototype.notifyComplete=function(){this._complete()},WindowSubscriber.prototype._next=function(t){this.window.next(t)},WindowSubscriber.prototype._error=function(t){this.window.error(t),this.destination.error(t)},WindowSubscriber.prototype._complete=function(){this.window.complete(),this.destination.complete()},WindowSubscriber.prototype._unsubscribe=function(){this.window=null},WindowSubscriber.prototype.openWindow=function(){var t=this.window;t&&t.complete();var n=this.destination,i=this.window=new bt.a;n.next(i)},WindowSubscriber}(a.b);function windowCount(t,n){return void 0===n&&(n=0),function windowCountOperatorFunction(i){return i.lift(new Tn(t,n))}}var Tn=function(){function WindowCountOperator(t,n){this.windowSize=t,this.startWindowEvery=n}return WindowCountOperator.prototype.call=function(t,n){return n.subscribe(new Cn(t,this.windowSize,this.startWindowEvery))},WindowCountOperator}(),Cn=function(t){function WindowCountSubscriber(n,i,o){var a=t.call(this,n)||this;return a.destination=n,a.windowSize=i,a.startWindowEvery=o,a.windows=[new bt.a],a.count=0,n.next(a.windows[0]),a}return o.a(WindowCountSubscriber,t),WindowCountSubscriber.prototype._next=function(t){for(var n=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,i=this.destination,o=this.windowSize,a=this.windows,s=a.length,m=0;m<s&&!this.closed;m++)a[m].next(t);var g=this.count-o+1;if(g>=0&&g%n==0&&!this.closed&&a.shift().complete(),++this.count%n==0&&!this.closed){var _=new bt.a;a.push(_),i.next(_)}},WindowCountSubscriber.prototype._error=function(t){var n=this.windows;if(n)for(;n.length>0&&!this.closed;)n.shift().error(t);this.destination.error(t)},WindowCountSubscriber.prototype._complete=function(){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().complete();this.destination.complete()},WindowCountSubscriber.prototype._unsubscribe=function(){this.count=0,this.windows=null},WindowCountSubscriber}(T.a);function windowTime_windowTime(t){var n=g.a,i=null,o=Number.POSITIVE_INFINITY;return Object(L.a)(arguments[3])&&(n=arguments[3]),Object(L.a)(arguments[2])?n=arguments[2]:Object(Jt.a)(arguments[2])&&(o=Number(arguments[2])),Object(L.a)(arguments[1])?n=arguments[1]:Object(Jt.a)(arguments[1])&&(i=Number(arguments[1])),function windowTimeOperatorFunction(a){return a.lift(new On(t,i,o,n))}}var On=function(){function WindowTimeOperator(t,n,i,o){this.windowTimeSpan=t,this.windowCreationInterval=n,this.maxWindowSize=i,this.scheduler=o}return WindowTimeOperator.prototype.call=function(t,n){return n.subscribe(new Pn(t,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},WindowTimeOperator}(),An=function(t){function CountedSubject(){var n=null!==t&&t.apply(this,arguments)||this;return n._numberOfNextedValues=0,n}return o.a(CountedSubject,t),CountedSubject.prototype.next=function(n){this._numberOfNextedValues++,t.prototype.next.call(this,n)},Object.defineProperty(CountedSubject.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),CountedSubject}(bt.a),Pn=function(t){function WindowTimeSubscriber(n,i,o,a,s){var m=t.call(this,n)||this;m.destination=n,m.windowTimeSpan=i,m.windowCreationInterval=o,m.maxWindowSize=a,m.scheduler=s,m.windows=[];var g=m.openWindow();if(null!==o&&o>=0){var _={subscriber:m,window:g,context:null},S={windowTimeSpan:i,windowCreationInterval:o,subscriber:m,scheduler:s};m.add(s.schedule(dispatchWindowClose,i,_)),m.add(s.schedule(dispatchWindowCreation,o,S))}else{var M={subscriber:m,window:g,windowTimeSpan:i};m.add(s.schedule(dispatchWindowTimeSpanOnly,i,M))}return m}return o.a(WindowTimeSubscriber,t),WindowTimeSubscriber.prototype._next=function(t){for(var n=this.windows,i=n.length,o=0;o<i;o++){var a=n[o];a.closed||(a.next(t),a.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(a))}},WindowTimeSubscriber.prototype._error=function(t){for(var n=this.windows;n.length>0;)n.shift().error(t);this.destination.error(t)},WindowTimeSubscriber.prototype._complete=function(){for(var t=this.windows;t.length>0;){var n=t.shift();n.closed||n.complete()}this.destination.complete()},WindowTimeSubscriber.prototype.openWindow=function(){var t=new An;return this.windows.push(t),this.destination.next(t),t},WindowTimeSubscriber.prototype.closeWindow=function(t){t.complete();var n=this.windows;n.splice(n.indexOf(t),1)},WindowTimeSubscriber}(T.a);function dispatchWindowTimeSpanOnly(t){var n=t.subscriber,i=t.windowTimeSpan,o=t.window;o&&n.closeWindow(o),t.window=n.openWindow(),this.schedule(t,i)}function dispatchWindowCreation(t){var n=t.windowTimeSpan,i=t.subscriber,o=t.scheduler,a=t.windowCreationInterval,s=i.openWindow(),m={action:this,subscription:null},g={subscriber:i,window:s,context:m};m.subscription=o.schedule(dispatchWindowClose,n,g),this.add(m.subscription),this.schedule(t,a)}function dispatchWindowClose(t){var n=t.subscriber,i=t.window,o=t.context;o&&o.action&&o.subscription&&o.action.remove(o.subscription),n.closeWindow(i)}function windowToggle(t,n){return function(i){return i.lift(new Ln(t,n))}}var Ln=function(){function WindowToggleOperator(t,n){this.openings=t,this.closingSelector=n}return WindowToggleOperator.prototype.call=function(t,n){return n.subscribe(new Rn(t,this.openings,this.closingSelector))},WindowToggleOperator}(),Rn=function(t){function WindowToggleSubscriber(n,i,o){var a=t.call(this,n)||this;return a.openings=i,a.closingSelector=o,a.contexts=[],a.add(a.openSubscription=Object(V.a)(a,i,i)),a}return o.a(WindowToggleSubscriber,t),WindowToggleSubscriber.prototype._next=function(t){var n=this.contexts;if(n)for(var i=n.length,o=0;o<i;o++)n[o].window.next(t)},WindowToggleSubscriber.prototype._error=function(n){var i=this.contexts;if(this.contexts=null,i)for(var o=i.length,a=-1;++a<o;){var s=i[a];s.window.error(n),s.subscription.unsubscribe()}t.prototype._error.call(this,n)},WindowToggleSubscriber.prototype._complete=function(){var n=this.contexts;if(this.contexts=null,n)for(var i=n.length,o=-1;++o<i;){var a=n[o];a.window.complete(),a.subscription.unsubscribe()}t.prototype._complete.call(this)},WindowToggleSubscriber.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,i=-1;++i<n;){var o=t[i];o.window.unsubscribe(),o.subscription.unsubscribe()}},WindowToggleSubscriber.prototype.notifyNext=function(t,n,i,o,a){if(t===this.openings){var s=void 0;try{s=(0,this.closingSelector)(n)}catch(t){return this.error(t)}var m=new bt.a,g=new j.a,_={window:m,subscription:g};this.contexts.push(_);var S=Object(V.a)(this,s,_);S.closed?this.closeWindow(this.contexts.length-1):(S.context=_,g.add(S)),this.destination.next(m)}else this.closeWindow(this.contexts.indexOf(t))},WindowToggleSubscriber.prototype.notifyError=function(t){this.error(t)},WindowToggleSubscriber.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},WindowToggleSubscriber.prototype.closeWindow=function(t){if(-1!==t){var n=this.contexts,i=n[t],o=i.window,a=i.subscription;n.splice(t,1),o.complete(),a.unsubscribe()}},WindowToggleSubscriber}(U.a);function windowWhen(t){return function windowWhenOperatorFunction(n){return n.lift(new Nn(t))}}var Nn=function(){function WindowOperator(t){this.closingSelector=t}return WindowOperator.prototype.call=function(t,n){return n.subscribe(new In(t,this.closingSelector))},WindowOperator}(),In=function(t){function WindowSubscriber(n,i){var o=t.call(this,n)||this;return o.destination=n,o.closingSelector=i,o.openWindow(),o}return o.a(WindowSubscriber,t),WindowSubscriber.prototype.notifyNext=function(t,n,i,o,a){this.openWindow(a)},WindowSubscriber.prototype.notifyError=function(t){this._error(t)},WindowSubscriber.prototype.notifyComplete=function(t){this.openWindow(t)},WindowSubscriber.prototype._next=function(t){this.window.next(t)},WindowSubscriber.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},WindowSubscriber.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},WindowSubscriber.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},WindowSubscriber.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var n=this.window;n&&n.complete();var i,o=this.window=new bt.a;this.destination.next(o);try{i=(0,this.closingSelector)()}catch(t){return this.destination.error(t),void this.window.error(t)}this.add(this.closingNotification=Object(V.a)(this,i))},WindowSubscriber}(U.a);function withLatestFrom(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){var i;"function"==typeof t[t.length-1]&&(i=t.pop());var o=t;return n.lift(new kn(o,i))}}var kn=function(){function WithLatestFromOperator(t,n){this.observables=t,this.project=n}return WithLatestFromOperator.prototype.call=function(t,n){return n.subscribe(new jn(t,this.observables,this.project))},WithLatestFromOperator}(),jn=function(t){function WithLatestFromSubscriber(n,i,o){var a=t.call(this,n)||this;a.observables=i,a.project=o,a.toRespond=[];var s=i.length;a.values=new Array(s);for(var m=0;m<s;m++)a.toRespond.push(m);for(m=0;m<s;m++){var g=i[m];a.add(Object(V.a)(a,g,void 0,m))}return a}return o.a(WithLatestFromSubscriber,t),WithLatestFromSubscriber.prototype.notifyNext=function(t,n,i){this.values[i]=n;var o=this.toRespond;if(o.length>0){var a=o.indexOf(i);-1!==a&&o.splice(a,1)}},WithLatestFromSubscriber.prototype.notifyComplete=function(){},WithLatestFromSubscriber.prototype._next=function(t){if(0===this.toRespond.length){var n=[t].concat(this.values);this.project?this._tryProject(n):this.destination.next(n)}},WithLatestFromSubscriber.prototype._tryProject=function(t){var n;try{n=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(n)},WithLatestFromSubscriber}(U.a),Fn=i(110);function zip_zip(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function zipOperatorFunction(n){return n.lift.call(Fn.b.apply(void 0,[n].concat(t)))}}function zipAll(t){return function(n){return n.lift(new Fn.a(t))}}},function(t,n,i){"use strict";i.d(n,"a",(function(){return map}));var o=i(1),a=i(3);function map(t,n){return function mapOperation(i){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new s(t,n))}}var s=function(){function MapOperator(t,n){this.project=t,this.thisArg=n}return MapOperator.prototype.call=function(t,n){return n.subscribe(new m(t,this.project,this.thisArg))},MapOperator}(),m=function(t){function MapSubscriber(n,i,o){var a=t.call(this,n)||this;return a.project=i,a.count=0,a.thisArg=o||a,a}return o.a(MapSubscriber,t),MapSubscriber.prototype._next=function(t){var n;try{n=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(n)},MapSubscriber}(a.a)},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o={elements:["x","y","z","w"],addShortcuts:function(){function applyShortcut(t,n,i){return i?{get:function(){return this[t][n][i]},set:function(o){this[t][n][i]=o}}:{get:function(){return this[t][n]},set:function(i){this[t][n]=i}}}return function addShortcuts(t,n,i){for(var o={},a=0;a<i.length;++a){var s=i[a].split("."),m=s[0],g=s[1];o[m]=applyShortcut(n,m,g)}Object.defineProperties(t,o)}}()}},function(t,n,i){"use strict";i.d(n,"a",(function(){return NodeMaterial}));var o=i(0),a=i(112),s=i(47),m=i(29),g=i(135);function NodeMaterial(t,n){o.ShaderMaterial.call(this),this.vertex=t||new g.a(new m.a(m.a.PROJECTION)),this.fragment=n||new g.a(new s.a(16711680)),this.updaters=[]}NodeMaterial.prototype=Object.create(o.ShaderMaterial.prototype),NodeMaterial.prototype.constructor=NodeMaterial,NodeMaterial.prototype.type="NodeMaterial",NodeMaterial.prototype.isNodeMaterial=!0,Object.defineProperties(NodeMaterial.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(t){!0===t&&this.version++,this.needsCompile=t},get:function(){return this.needsCompile}}}),NodeMaterial.prototype.onBeforeCompile=function(t,n){this.build({renderer:n}),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=!0===this.extensions.derivatives,t.extensionFragDepth=!0===this.extensions.fragDepth,t.extensionDrawBuffers=!0===this.extensions.drawBuffers,t.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD},NodeMaterial.prototype.customProgramCacheKey=function(){return this.getHash()},NodeMaterial.prototype.getHash=function(){var t="{";return t+='"vertex":'+this.vertex.getHash()+",",(t+='"fragment":'+this.fragment.getHash())+"}"},NodeMaterial.prototype.updateFrame=function(t){for(var n=0;n<this.updaters.length;++n)t.updateNode(this.updaters[n])},NodeMaterial.prototype.build=function(t){var n=(t=t||{}).builder||new a.a;return n.setMaterial(this,t.renderer),n.build(this.vertex,this.fragment),this.vertexShader=n.getCode("vertex"),this.fragmentShader=n.getCode("fragment"),this.defines=n.defines,this.uniforms=n.uniforms,this.extensions=n.extensions,this.updaters=n.updaters,this.fog=n.requires.fog,this.lights=n.requires.lights,this.transparent=n.requires.transparent||this.blending>o.NormalBlending,this},NodeMaterial.prototype.copy=function(t){var n=this.uuid;for(var i in t)this[i]=t[i];return this.uuid=n,void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this},NodeMaterial.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.materials&&(t.materials={}),!t.materials[this.uuid]){var n={};n.uuid=this.uuid,n.type=this.type,t.materials[n.uuid]=n,""!==this.name&&(n.name=this.name),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==o.NormalBlending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==o.FrontSide&&(n.side=this.side),this.vertexColors!==o.NoColors&&(n.vertexColors=this.vertexColors),this.depthFunc!==o.LessEqualDepth&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.fog=this.fog,n.lights=this.lights,n.vertex=this.vertex.toJSON(t).uuid,n.fragment=this.fragment.toJSON(t).uuid}return t.material=this.uuid,t}},function(t,n,i){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.CustomAttributes=void 0,(o=n.CustomAttributes||(n.CustomAttributes={})).PlcaHolderAttribut=/^\$\{(.*)\}$/,o.Dependencies="$$dependencies",o.ElementEvents="$$element_events",o.GAID="$$ga_id",o.GTAG="$$gtag",o.PREFETCH="$$prefetch",o.EXPERIENCE_LOADER="$$experience_loader",o.EXPERIENCE_LOADER_OPACITY="$$experience_loader_opacity",o.ZONE_LOADER="$$zone_loader",o.ZONE_LOADER_OPACITY="$$zone_loader_opacity",o.UserHeight="$$user_height",o.FloorLevel="$$floor_level",o.EnableContextMenu="$$enable_context_menu",o.PreviewTransform="$$preview_transform",o.ApiKey="$$ar_api_key",o.GammaFactor="$$gamma_factor",o.physicallyCorrectLights="$$physically_correct_lights",o.CameraZoom="$$camera_zoom",o.CameraLookAt="$$camera_look_at",o.ZoneType="$$zone_type",o.Background="$$background",o.BackgroundVideoLoop="$$background_video_loop",o.BackgroundVideoAutoplay="$$background_video_autoplay",o.ShadowBiasCustomAttribute="$$shadow.bias",o.ShadowMapCustomAttribute="$$shadow_map",o.RenderOrder="$$render_order",o.Teleport="$$teleport",o.EnvironmentMap="$$environment_map",o.Parent="$$parent",o.Wireframe="$$wireframe",o.Effects="$$effects",o.LookAt="$$look_at",o.Bounds="$$bounds",o.OptimizationWidth="$$optimization_width",o.CameraLookAtTime="$$camera_look_at_time",o.TeleportOffset="$$teleport_offset",o.Bullet="$$bullet",o.ProgressiveLoading="$$progressive_loading",o.SVGSize="$$svg_size",o.MobileUrl="$$mobile_url",o.ChromakeyOption="$$chromakey_option",o.LOD="$$lod",o.CenterPivot="$$center_pivot",o.PreviewImage="$$preview_image",o.Values={ZoneType:{AR:"##ar"},EnvMap:{Auto:"##auto",Realtime:"##realtime",FromSource:"##from_source"},Effects:{ColorAdjustmentEffect:"color_adjustment"},CustomParent:{Camera:"##camera"},LookAt:{Camera:"##camera"}}},function(t,n,i){"use strict";function isScheduler(t){return t&&"function"==typeof t.schedule}i.d(n,"a",(function(){return isScheduler}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o={nodes:{},keywords:{},add:function(t){this.nodes[t.name]=t},addKeyword:function(t,n,i){i=void 0===i||i,this.keywords[t]={callback:n,cache:i}},remove:function(t){delete this.nodes[t.name]},removeKeyword:function(t){delete this.keywords[t]},get:function(t){return this.nodes[t]},getKeyword:function(t,n){return this.keywords[t].callback.call(this,n)},getKeywordData:function(t){return this.keywords[t]},contains:function(t){return void 0!==this.nodes[t]},containsKeyword:function(t){return void 0!==this.keywords[t]}}},function(t,n){var i,o,a=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(i===setTimeout)return setTimeout(t,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(n){try{return i.call(null,t,0)}catch(n){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){i=defaultSetTimout}try{o="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){o=defaultClearTimeout}}();var s,m=[],g=!1,_=-1;function cleanUpNextTick(){g&&s&&(g=!1,s.length?m=s.concat(m):_=-1,m.length&&drainQueue())}function drainQueue(){if(!g){var t=runTimeout(cleanUpNextTick);g=!0;for(var n=m.length;n;){for(s=m,m=[];++_<n;)s&&s[_].run();_=-1,n=m.length}s=null,g=!1,function runClearTimeout(t){if(o===clearTimeout)return clearTimeout(t);if((o===defaultClearTimeout||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(n){try{return o.call(null,t)}catch(n){return o.call(this,t)}}}(t)}}function Item(t,n){this.fun=t,this.array=n}function noop(){}a.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)n[i-1]=arguments[i];m.push(new Item(t,n)),1!==m.length||g||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=noop,a.addListener=noop,a.once=noop,a.off=noop,a.removeListener=noop,a.removeAllListeners=noop,a.emit=noop,a.prependListener=noop,a.prependOnceListener=noop,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,n,i){"use strict";i.d(n,"a",(function(){return a})),i.d(n,"b",(function(){return empty}));var o=i(5),a=new o.a((function(t){return t.complete()}));function empty(t){return t?function emptyScheduled(t){return new o.a((function(n){return t.schedule((function(){return n.complete()}))}))}(t):a}},function(t,n,i){"use strict";Object.defineProperty(n,"LEVEL",{value:Symbol.for("level")}),Object.defineProperty(n,"MESSAGE",{value:Symbol.for("message")}),Object.defineProperty(n,"SPLAT",{value:Symbol.for("splat")}),Object.defineProperty(n,"configs",{value:i(354)})},function(t,n,i){"use strict";i.d(n,"a",(function(){return from}));var o=i(5),a=i(75),s=i(170);function from(t,n){return n?Object(s.a)(t,n):t instanceof o.a?t:new o.a(Object(a.a)(t))}},function(t,n,i){"use strict";i.d(n,"a",(function(){return PositionNode}));var o=i(2),a=i(24);function PositionNode(t){o.a.call(this,"v3"),this.scope=t||PositionNode.LOCAL}PositionNode.LOCAL="local",PositionNode.WORLD="world",PositionNode.VIEW="view",PositionNode.PROJECTION="projection",PositionNode.prototype=Object.create(o.a.prototype),PositionNode.prototype.constructor=PositionNode,PositionNode.prototype.nodeType="Position",PositionNode.prototype.getType=function(){switch(this.scope){case PositionNode.PROJECTION:return"v4"}return this.type},PositionNode.prototype.getShared=function(){switch(this.scope){case PositionNode.LOCAL:case PositionNode.WORLD:return!1}return!0},PositionNode.prototype.generate=function(t,n){var i;switch(this.scope){case PositionNode.LOCAL:t.isShader("vertex")?i="transformed":(t.requires.position=!0,i="vPosition");break;case PositionNode.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,i="vWPosition";break;case PositionNode.VIEW:i=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case PositionNode.PROJECTION:i=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return t.format(i,this.getType(t),n)},PositionNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.scope=t.scope,this},PositionNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).scope=this.scope),n},a.a.addKeyword("position",(function(){return new PositionNode})),a.a.addKeyword("worldPosition",(function(){return new PositionNode(PositionNode.WORLD)})),a.a.addKeyword("viewPosition",(function(){return new PositionNode(PositionNode.VIEW)}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return Pass}));var o,a,s,m=i(0);function Pass(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(Pass.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Pass.FullScreenQuad=(o=new m.OrthographicCamera(-1,1,1,-1,0,1),a=new m.PlaneBufferGeometry(2,2),s=function(t){this._mesh=new m.Mesh(a,t)},Object.defineProperty(s.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(s.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,o)}}),s)},function(t,n,i){"use strict";(function(t){var o=i(318),a=i(319),s=i(207);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,n){if(kMaxLength()<n)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(n)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(n)),t.length=n),t}function Buffer(t,n,i){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,n,i);if("number"==typeof t){if("string"==typeof n)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,n,i)}function from(t,n,i,o){if("number"==typeof n)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer?function fromArrayBuffer(t,n,i,o){if(n.byteLength,i<0||n.byteLength<i)throw new RangeError("'offset' is out of bounds");if(n.byteLength<i+(o||0))throw new RangeError("'length' is out of bounds");return n=void 0===i&&void 0===o?new Uint8Array(n):void 0===o?new Uint8Array(n,i):new Uint8Array(n,i,o),Buffer.TYPED_ARRAY_SUPPORT?(t=n).__proto__=Buffer.prototype:t=fromArrayLike(t,n),t}(t,n,i,o):"string"==typeof n?function fromString(t,n,i){if("string"==typeof i&&""!==i||(i="utf8"),!Buffer.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var o=0|byteLength(n,i),a=(t=createBuffer(t,o)).write(n,i);return a!==o&&(t=t.slice(0,a)),t}(t,n,i):function fromObject(t,n){if(Buffer.isBuffer(n)){var i=0|checked(n.length);return 0===(t=createBuffer(t,i)).length||n.copy(t,0,0,i),t}if(n){if("undefined"!=typeof ArrayBuffer&&n.buffer instanceof ArrayBuffer||"length"in n)return"number"!=typeof n.length||function isnan(t){return t!=t}(n.length)?createBuffer(t,0):fromArrayLike(t,n);if("Buffer"===n.type&&s(n.data))return fromArrayLike(t,n.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,n)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(t,n){if(assertSize(n),t=createBuffer(t,n<0?0:0|checked(n)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<n;++i)t[i]=0;return t}function fromArrayLike(t,n){var i=n.length<0?0:0|checked(n.length);t=createBuffer(t,i);for(var o=0;o<i;o+=1)t[o]=255&n[o];return t}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function byteLength(t,n){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var o=!1;;)switch(n){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return base64ToBytes(t).length;default:if(o)return utf8ToBytes(t).length;n=(""+n).toLowerCase(),o=!0}}function slowToString(t,n,i){var o=!1;if((void 0===n||n<0)&&(n=0),n>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(n>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,n,i);case"utf8":case"utf-8":return utf8Slice(this,n,i);case"ascii":return asciiSlice(this,n,i);case"latin1":case"binary":return latin1Slice(this,n,i);case"base64":return base64Slice(this,n,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,n,i);default:if(o)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),o=!0}}function swap(t,n,i){var o=t[n];t[n]=t[i],t[i]=o}function bidirectionalIndexOf(t,n,i,o,a){if(0===t.length)return-1;if("string"==typeof i?(o=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=a?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(a)return-1;i=t.length-1}else if(i<0){if(!a)return-1;i=0}if("string"==typeof n&&(n=Buffer.from(n,o)),Buffer.isBuffer(n))return 0===n.length?-1:arrayIndexOf(t,n,i,o,a);if("number"==typeof n)return n&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(t,n,i):Uint8Array.prototype.lastIndexOf.call(t,n,i):arrayIndexOf(t,[n],i,o,a);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,n,i,o,a){var s,m=1,g=t.length,_=n.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(t.length<2||n.length<2)return-1;m=2,g/=2,_/=2,i/=2}function read(t,n){return 1===m?t[n]:t.readUInt16BE(n*m)}if(a){var S=-1;for(s=i;s<g;s++)if(read(t,s)===read(n,-1===S?0:s-S)){if(-1===S&&(S=s),s-S+1===_)return S*m}else-1!==S&&(s-=s-S),S=-1}else for(i+_>g&&(i=g-_),s=i;s>=0;s--){for(var M=!0,T=0;T<_;T++)if(read(t,s+T)!==read(n,T)){M=!1;break}if(M)return s}return-1}function hexWrite(t,n,i,o){i=Number(i)||0;var a=t.length-i;o?(o=Number(o))>a&&(o=a):o=a;var s=n.length;if(s%2!=0)throw new TypeError("Invalid hex string");o>s/2&&(o=s/2);for(var m=0;m<o;++m){var g=parseInt(n.substr(2*m,2),16);if(isNaN(g))return m;t[i+m]=g}return m}function utf8Write(t,n,i,o){return blitBuffer(utf8ToBytes(n,t.length-i),t,i,o)}function asciiWrite(t,n,i,o){return blitBuffer(function asciiToBytes(t){for(var n=[],i=0;i<t.length;++i)n.push(255&t.charCodeAt(i));return n}(n),t,i,o)}function latin1Write(t,n,i,o){return asciiWrite(t,n,i,o)}function base64Write(t,n,i,o){return blitBuffer(base64ToBytes(n),t,i,o)}function ucs2Write(t,n,i,o){return blitBuffer(function utf16leToBytes(t,n){for(var i,o,a,s=[],m=0;m<t.length&&!((n-=2)<0);++m)o=(i=t.charCodeAt(m))>>8,a=i%256,s.push(a),s.push(o);return s}(n,t.length-i),t,i,o)}function base64Slice(t,n,i){return 0===n&&i===t.length?o.fromByteArray(t):o.fromByteArray(t.slice(n,i))}function utf8Slice(t,n,i){i=Math.min(t.length,i);for(var o=[],a=n;a<i;){var s,m,g,_,S=t[a],M=null,T=S>239?4:S>223?3:S>191?2:1;if(a+T<=i)switch(T){case 1:S<128&&(M=S);break;case 2:128==(192&(s=t[a+1]))&&(_=(31&S)<<6|63&s)>127&&(M=_);break;case 3:s=t[a+1],m=t[a+2],128==(192&s)&&128==(192&m)&&(_=(15&S)<<12|(63&s)<<6|63&m)>2047&&(_<55296||_>57343)&&(M=_);break;case 4:s=t[a+1],m=t[a+2],g=t[a+3],128==(192&s)&&128==(192&m)&&128==(192&g)&&(_=(15&S)<<18|(63&s)<<12|(63&m)<<6|63&g)>65535&&_<1114112&&(M=_)}null===M?(M=65533,T=1):M>65535&&(M-=65536,o.push(M>>>10&1023|55296),M=56320|1023&M),o.push(M),a+=T}return function decodeCodePointsArray(t){var n=t.length;if(n<=4096)return String.fromCharCode.apply(String,t);for(var i="",o=0;o<n;)i+=String.fromCharCode.apply(String,t.slice(o,o+=4096));return i}(o)}function asciiSlice(t,n,i){var o="";i=Math.min(t.length,i);for(var a=n;a<i;++a)o+=String.fromCharCode(127&t[a]);return o}function latin1Slice(t,n,i){var o="";i=Math.min(t.length,i);for(var a=n;a<i;++a)o+=String.fromCharCode(t[a]);return o}function hexSlice(t,n,i){var o,a=t.length;(!n||n<0)&&(n=0),(!i||i<0||i>a)&&(i=a);for(var s="",m=n;m<i;++m)s+=(o=t[m])<16?"0"+o.toString(16):o.toString(16);return s}function utf16leSlice(t,n,i){for(var o=t.slice(n,i),a="",s=0;s<o.length;s+=2)a+=String.fromCharCode(o[s]+256*o[s+1]);return a}function checkOffset(t,n,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+n>i)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,n,i,o,a,s){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>a||n<s)throw new RangeError('"value" argument is out of bounds');if(i+o>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,n,i,o){n<0&&(n=65535+n+1);for(var a=0,s=Math.min(t.length-i,2);a<s;++a)t[i+a]=(n&255<<8*(o?a:1-a))>>>8*(o?a:1-a)}function objectWriteUInt32(t,n,i,o){n<0&&(n=4294967295+n+1);for(var a=0,s=Math.min(t.length-i,4);a<s;++a)t[i+a]=n>>>8*(o?a:3-a)&255}function checkIEEE754(t,n,i,o,a,s){if(i+o>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function writeFloat(t,n,i,o,s){return s||checkIEEE754(t,0,i,4),a.write(t,n,i,o,23,4),i+4}function writeDouble(t,n,i,o,s){return s||checkIEEE754(t,0,i,8),a.write(t,n,i,o,52,8),i+8}n.Buffer=Buffer,n.SlowBuffer=function SlowBuffer(t){return+t!=t&&(t=0),Buffer.alloc(+t)},n.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function typedArraySupport(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),n.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,n,i){return from(null,t,n,i)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(t,n,i){return function alloc(t,n,i,o){return assertSize(n),n<=0?createBuffer(t,n):void 0!==i?"string"==typeof o?createBuffer(t,n).fill(i,o):createBuffer(t,n).fill(i):createBuffer(t,n)}(null,t,n,i)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=function isBuffer(t){return!(null==t||!t._isBuffer)},Buffer.compare=function compare(t,n){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(n))throw new TypeError("Arguments must be Buffers");if(t===n)return 0;for(var i=t.length,o=n.length,a=0,s=Math.min(i,o);a<s;++a)if(t[a]!==n[a]){i=t[a],o=n[a];break}return i<o?-1:o<i?1:0},Buffer.isEncoding=function isEncoding(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(t,n){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var i;if(void 0===n)for(n=0,i=0;i<t.length;++i)n+=t[i].length;var o=Buffer.allocUnsafe(n),a=0;for(i=0;i<t.length;++i){var m=t[i];if(!Buffer.isBuffer(m))throw new TypeError('"list" argument must be an Array of Buffers');m.copy(o,a),a+=m.length}return o},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var n=0;n<t;n+=2)swap(this,n,n+1);return this},Buffer.prototype.swap32=function swap32(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var n=0;n<t;n+=4)swap(this,n,n+3),swap(this,n+1,n+2);return this},Buffer.prototype.swap64=function swap64(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var n=0;n<t;n+=8)swap(this,n,n+7),swap(this,n+1,n+6),swap(this,n+2,n+5),swap(this,n+3,n+4);return this},Buffer.prototype.toString=function toString(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function equals(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function inspect(){var t="",i=n.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function compare(t,n,i,o,a){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=0),void 0===i&&(i=t?t.length:0),void 0===o&&(o=0),void 0===a&&(a=this.length),n<0||i>t.length||o<0||a>this.length)throw new RangeError("out of range index");if(o>=a&&n>=i)return 0;if(o>=a)return-1;if(n>=i)return 1;if(this===t)return 0;for(var s=(a>>>=0)-(o>>>=0),m=(i>>>=0)-(n>>>=0),g=Math.min(s,m),_=this.slice(o,a),S=t.slice(n,i),M=0;M<g;++M)if(_[M]!==S[M]){s=_[M],m=S[M];break}return s<m?-1:m<s?1:0},Buffer.prototype.includes=function includes(t,n,i){return-1!==this.indexOf(t,n,i)},Buffer.prototype.indexOf=function indexOf(t,n,i){return bidirectionalIndexOf(this,t,n,i,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(t,n,i){return bidirectionalIndexOf(this,t,n,i,!1)},Buffer.prototype.write=function write(t,n,i,o){if(void 0===n)o="utf8",i=this.length,n=0;else if(void 0===i&&"string"==typeof n)o=n,i=this.length,n=0;else{if(!isFinite(n))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");n|=0,isFinite(i)?(i|=0,void 0===o&&(o="utf8")):(o=i,i=void 0)}var a=this.length-n;if((void 0===i||i>a)&&(i=a),t.length>0&&(i<0||n<0)||n>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var s=!1;;)switch(o){case"hex":return hexWrite(this,t,n,i);case"utf8":case"utf-8":return utf8Write(this,t,n,i);case"ascii":return asciiWrite(this,t,n,i);case"latin1":case"binary":return latin1Write(this,t,n,i);case"base64":return base64Write(this,t,n,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,n,i);default:if(s)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),s=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.slice=function slice(t,n){var i,o=this.length;if((t=~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),(n=void 0===n?o:~~n)<0?(n+=o)<0&&(n=0):n>o&&(n=o),n<t&&(n=t),Buffer.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,n)).__proto__=Buffer.prototype;else{var a=n-t;i=new Buffer(a,void 0);for(var s=0;s<a;++s)i[s]=this[s+t]}return i},Buffer.prototype.readUIntLE=function readUIntLE(t,n,i){t|=0,n|=0,i||checkOffset(t,n,this.length);for(var o=this[t],a=1,s=0;++s<n&&(a*=256);)o+=this[t+s]*a;return o},Buffer.prototype.readUIntBE=function readUIntBE(t,n,i){t|=0,n|=0,i||checkOffset(t,n,this.length);for(var o=this[t+--n],a=1;n>0&&(a*=256);)o+=this[t+--n]*a;return o},Buffer.prototype.readUInt8=function readUInt8(t,n){return n||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function readUInt16LE(t,n){return n||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(t,n){return n||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(t,n){return n||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(t,n){return n||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function readIntLE(t,n,i){t|=0,n|=0,i||checkOffset(t,n,this.length);for(var o=this[t],a=1,s=0;++s<n&&(a*=256);)o+=this[t+s]*a;return o>=(a*=128)&&(o-=Math.pow(2,8*n)),o},Buffer.prototype.readIntBE=function readIntBE(t,n,i){t|=0,n|=0,i||checkOffset(t,n,this.length);for(var o=n,a=1,s=this[t+--o];o>0&&(a*=256);)s+=this[t+--o]*a;return s>=(a*=128)&&(s-=Math.pow(2,8*n)),s},Buffer.prototype.readInt8=function readInt8(t,n){return n||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function readInt16LE(t,n){n||checkOffset(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},Buffer.prototype.readInt16BE=function readInt16BE(t,n){n||checkOffset(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},Buffer.prototype.readInt32LE=function readInt32LE(t,n){return n||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(t,n){return n||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function readFloatLE(t,n){return n||checkOffset(t,4,this.length),a.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(t,n){return n||checkOffset(t,4,this.length),a.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(t,n){return n||checkOffset(t,8,this.length),a.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(t,n){return n||checkOffset(t,8,this.length),a.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(t,n,i,o){t=+t,n|=0,i|=0,o||checkInt(this,t,n,i,Math.pow(2,8*i)-1,0);var a=1,s=0;for(this[n]=255&t;++s<i&&(a*=256);)this[n+s]=t/a&255;return n+i},Buffer.prototype.writeUIntBE=function writeUIntBE(t,n,i,o){t=+t,n|=0,i|=0,o||checkInt(this,t,n,i,Math.pow(2,8*i)-1,0);var a=i-1,s=1;for(this[n+a]=255&t;--a>=0&&(s*=256);)this[n+a]=t/s&255;return n+i},Buffer.prototype.writeUInt8=function writeUInt8(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[n]=255&t,n+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):objectWriteUInt16(this,t,n,!0),n+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):objectWriteUInt16(this,t,n,!1),n+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[n+3]=t>>>24,this[n+2]=t>>>16,this[n+1]=t>>>8,this[n]=255&t):objectWriteUInt32(this,t,n,!0),n+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):objectWriteUInt32(this,t,n,!1),n+4},Buffer.prototype.writeIntLE=function writeIntLE(t,n,i,o){if(t=+t,n|=0,!o){var a=Math.pow(2,8*i-1);checkInt(this,t,n,i,a-1,-a)}var s=0,m=1,g=0;for(this[n]=255&t;++s<i&&(m*=256);)t<0&&0===g&&0!==this[n+s-1]&&(g=1),this[n+s]=(t/m>>0)-g&255;return n+i},Buffer.prototype.writeIntBE=function writeIntBE(t,n,i,o){if(t=+t,n|=0,!o){var a=Math.pow(2,8*i-1);checkInt(this,t,n,i,a-1,-a)}var s=i-1,m=1,g=0;for(this[n+s]=255&t;--s>=0&&(m*=256);)t<0&&0===g&&0!==this[n+s+1]&&(g=1),this[n+s]=(t/m>>0)-g&255;return n+i},Buffer.prototype.writeInt8=function writeInt8(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[n]=255&t,n+1},Buffer.prototype.writeInt16LE=function writeInt16LE(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):objectWriteUInt16(this,t,n,!0),n+2},Buffer.prototype.writeInt16BE=function writeInt16BE(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):objectWriteUInt16(this,t,n,!1),n+2},Buffer.prototype.writeInt32LE=function writeInt32LE(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8,this[n+2]=t>>>16,this[n+3]=t>>>24):objectWriteUInt32(this,t,n,!0),n+4},Buffer.prototype.writeInt32BE=function writeInt32BE(t,n,i){return t=+t,n|=0,i||checkInt(this,t,n,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):objectWriteUInt32(this,t,n,!1),n+4},Buffer.prototype.writeFloatLE=function writeFloatLE(t,n,i){return writeFloat(this,t,n,!0,i)},Buffer.prototype.writeFloatBE=function writeFloatBE(t,n,i){return writeFloat(this,t,n,!1,i)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(t,n,i){return writeDouble(this,t,n,!0,i)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(t,n,i){return writeDouble(this,t,n,!1,i)},Buffer.prototype.copy=function copy(t,n,i,o){if(i||(i=0),o||0===o||(o=this.length),n>=t.length&&(n=t.length),n||(n=0),o>0&&o<i&&(o=i),o===i)return 0;if(0===t.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),t.length-n<o-i&&(o=t.length-n+i);var a,s=o-i;if(this===t&&i<n&&n<o)for(a=s-1;a>=0;--a)t[a+n]=this[a+i];else if(s<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(a=0;a<s;++a)t[a+n]=this[a+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+s),n);return s},Buffer.prototype.fill=function fill(t,n,i,o){if("string"==typeof t){if("string"==typeof n?(o=n,n=0,i=this.length):"string"==typeof i&&(o=i,i=this.length),1===t.length){var a=t.charCodeAt(0);a<256&&(t=a)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!Buffer.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof t&&(t&=255);if(n<0||this.length<n||this.length<i)throw new RangeError("Out of range index");if(i<=n)return this;var s;if(n>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(s=n;s<i;++s)this[s]=t;else{var m=Buffer.isBuffer(t)?t:utf8ToBytes(new Buffer(t,o).toString()),g=m.length;for(s=0;s<i-n;++s)this[s+n]=m[s%g]}return this};var m=/[^+\/0-9A-Za-z-_]/g;function utf8ToBytes(t,n){var i;n=n||1/0;for(var o=t.length,a=null,s=[],m=0;m<o;++m){if((i=t.charCodeAt(m))>55295&&i<57344){if(!a){if(i>56319){(n-=3)>-1&&s.push(239,191,189);continue}if(m+1===o){(n-=3)>-1&&s.push(239,191,189);continue}a=i;continue}if(i<56320){(n-=3)>-1&&s.push(239,191,189),a=i;continue}i=65536+(a-55296<<10|i-56320)}else a&&(n-=3)>-1&&s.push(239,191,189);if(a=null,i<128){if((n-=1)<0)break;s.push(i)}else if(i<2048){if((n-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((n-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((n-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function base64ToBytes(t){return o.toByteArray(function base64clean(t){if((t=function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(m,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function blitBuffer(t,n,i,o){for(var a=0;a<o&&!(a+i>=n.length||a>=t.length);++a)n[a+i]=t[a];return a}}).call(this,i(33))},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.Metadata=void 0;var m=i(0),g=i(36),_=i(17);!function(t){var n=function(){function CustomAttributesMetadata(){}return s([g.Transform((function(t){try{t=JSON.parse(t)}catch(t){}return t}))],CustomAttributesMetadata.prototype,"value",void 0),CustomAttributesMetadata}();t.CustomAttributesMetadata=n;var i=function(){function BaseElementMetadata(){}return BaseElementMetadata.prototype.getCustomAttribute=function(t){if(this.custom_attributes){var n=this.custom_attributes.map((function(n){if(n.key===t)return n.value}));return(n=n.filter((function(t){return!!t||!1===t})))[0]}},s([g.Type((function(){return n}))],BaseElementMetadata.prototype,"custom_attributes",void 0),BaseElementMetadata}();t.BaseElementMetadata=i;var o=function(t){function Element3DMetadata(){var n=null!==t&&t.apply(this,arguments)||this;return n.metadataName="Element3DMetadata",n.position=new m.Vector3(0,0,0),n.scale=new m.Vector3(1,1,1),n.is_cast_shadow=!1,n.is_receive_shadow=!1,n}return a(Element3DMetadata,t),s([g.Transform((function(t){return _.Utils.byondPositionToThreePosition(t)}))],Element3DMetadata.prototype,"position",void 0),s([g.Transform((function(t){return _.Utils.byondRotationToThreeRotation(t)}))],Element3DMetadata.prototype,"rotation",void 0),s([g.Transform((function(t){return _.Utils.byondScaleToThreeScale(t)}))],Element3DMetadata.prototype,"scale",void 0),Element3DMetadata}(i);t.Element3DMetadata=o;t.OnHover=function OnHover(){};t.OnClick=function OnClick(){};var S=function(t){function ZoneMetadata(){var n=null!==t&&t.apply(this,arguments)||this;return n.is_stereoscopic=!1,n}return a(ZoneMetadata,t),Object.defineProperty(ZoneMetadata.prototype,"ElementName",{get:function(){return"zone"},enumerable:!1,configurable:!0}),s([g.Type((function(){return i}))],ZoneMetadata.prototype,"elements",void 0),ZoneMetadata}(i);t.ZoneMetadata=S;var M=function(t){function BaseExperienceMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(BaseExperienceMetadata,t),Object.defineProperty(BaseExperienceMetadata.prototype,"ElementName",{get:function(){return"experience"},enumerable:!1,configurable:!0}),BaseExperienceMetadata}(t.BaseElementMetadata);t.BaseExperienceMetadata=M;var T=function(n){function ExperienceMetadata(){return null!==n&&n.apply(this,arguments)||this}return a(ExperienceMetadata,n),s([g.Type((function(){return t.ZoneMetadata}))],ExperienceMetadata.prototype,"locations",void 0),ExperienceMetadata}(M);t.ExperienceMetadata=T;t.Marker=function Marker(){};t.MarkerInfo=function MarkerInfo(){};t.Asset=function Asset(){};t.Dependencies=function Dependencies(){};t.ActivationConfig=function ActivationConfig(){};t.Configuration=function Configuration(){}}(n.Metadata||(n.Metadata={}))},function(t,n){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HistoryEventManager=n.EditorEventManager=n.EventManager=n.EventMessage=void 0;var o=i(130);n.EventMessage=function EventMessage(t,n,i){this.origin=t,this.eventType=n,this.message=i};var a=function(){function EventManager(t){this.subject=new o.Subject,this.appManager=t}return EventManager.prototype.next=function(t,n){var i;if(void 0===n&&(n=!1),n){var o=new CustomEvent(t.eventType.name,{detail:{message:t.message,origin:t.origin}});null===(i=this.appManager.container)||void 0===i||i.dispatchEvent(o)}this.subject.next(t)},EventManager.prototype.pipe=function(t){return this.subject.pipe(t)},EventManager}();n.EventManager=a;n.EditorEventManager=function EditorEventManager(){this.subject=new o.Subject};n.HistoryEventManager=function HistoryEventManager(){this.subject=new o.Subject}},function(t,n,i){"use strict";i.d(n,"a",(function(){return OperatorNode}));var o=i(2);function OperatorNode(t,n,i){o.a.call(this),this.a=t,this.b=n,this.op=i}OperatorNode.ADD="+",OperatorNode.SUB="-",OperatorNode.MUL="*",OperatorNode.DIV="/",OperatorNode.prototype=Object.create(o.a.prototype),OperatorNode.prototype.constructor=OperatorNode,OperatorNode.prototype.nodeType="Operator",OperatorNode.prototype.getType=function(t){var n=this.a.getType(t),i=this.b.getType(t);return t.isTypeMatrix(n)?"v4":t.getTypeLength(i)>t.getTypeLength(n)?i:n},OperatorNode.prototype.generate=function(t,n){var i=this.getType(t),o=this.a.build(t,i),a=this.b.build(t,i);return t.format("( "+o+" "+this.op+" "+a+" )",i,n)},OperatorNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.a=t.a,this.b=t.b,this.op=t.op,this},OperatorNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,n.b=this.b.toJSON(t).uuid,n.op=this.op),n}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(176),a=i(176);n.ClassTransformer=a.ClassTransformer,function __export(t){for(var i in t)n.hasOwnProperty(i)||(n[i]=t[i])}(i(321));var s,m=new o.ClassTransformer;n.classToPlain=function classToPlain(t,n){return m.classToPlain(t,n)},n.classToPlainFromExist=function classToPlainFromExist(t,n,i){return m.classToPlainFromExist(t,n,i)},n.plainToClass=function plainToClass(t,n,i){return m.plainToClass(t,n,i)},n.plainToClassFromExist=function plainToClassFromExist(t,n,i){return m.plainToClassFromExist(t,n,i)},n.classToClass=function classToClass(t,n){return m.classToClass(t,n)},n.classToClassFromExist=function classToClassFromExist(t,n,i){return m.classToClassFromExist(t,n,i)},n.serialize=function serialize(t,n){return m.serialize(t,n)},n.deserialize=function deserialize(t,n,i){return m.deserialize(t,n,i)},n.deserializeArray=function deserializeArray(t,n,i){return m.deserializeArray(t,n,i)},(s=n.TransformationType||(n.TransformationType={}))[s.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",s[s.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",s[s.CLASS_TO_CLASS=2]="CLASS_TO_CLASS"},function(t,n,i){"use strict";i.d(n,"a",(function(){return subscribeToResult}));var o=i(1),a=function(t){function InnerSubscriber(n,i,o){var a=t.call(this)||this;return a.parent=n,a.outerValue=i,a.outerIndex=o,a.index=0,a}return o.a(InnerSubscriber,t),InnerSubscriber.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},InnerSubscriber.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},InnerSubscriber.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},InnerSubscriber}(i(3).a),s=i(75),m=i(5);function subscribeToResult(t,n,i,o,g){if(void 0===g&&(g=new a(t,i,o)),!g.closed)return n instanceof m.a?n.subscribe(g):Object(s.a)(n)(g)}},function(t,n,i){"use strict";i.d(n,"a",(function(){return TextureNode}));var o=i(6),a=i(41),s=i(60),m=i(15);function TextureNode(t,n,i,s){o.a.call(this,"v4",{shared:!0}),this.value=t,this.uv=n||new a.a,this.bias=i,this.project=void 0!==s&&s}TextureNode.prototype=Object.create(o.a.prototype),TextureNode.prototype.constructor=TextureNode,TextureNode.prototype.nodeType="Texture",TextureNode.prototype.getTexture=function(t,n){return o.a.prototype.generate.call(this,t,n,this.value.uuid,"t")},TextureNode.prototype.generate=function(t,n){if("sampler2D"===n)return this.getTexture(t,n);var i,o,a=this.getTexture(t,n),g=this.uv.build(t,this.project?"v4":"v2"),_=this.bias?this.bias.build(t,"f"):void 0;void 0===_&&t.context.bias&&(_=t.context.bias.setTexture(this).build(t,"f")),i=this.project?"texture2DProj":_?"tex2DBias":"tex2D",o=_?i+"( "+a+", "+g+", "+_+" )":i+"( "+a+", "+g+" )";var S={include:t.isShader("vertex"),ignoreCache:!0},M=this.getType(t);return t.addContext(S),this.colorSpace=this.colorSpace||new s.a(new m.a("",M)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(t,M),t.removeContext(),t.format(o,M,n)},TextureNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),void 0!==t.project&&(this.project=t.project),this},TextureNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||(n=this.createJSONNode(t),this.value&&(n.value=this.value.uuid),n.uv=this.uv.toJSON(t).uuid,n.project=this.project,this.bias&&(n.bias=this.bias.toJSON(t).uuid)),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return a}));var o=!1,a={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack,o=t},get useDeprecatedSynchronousErrorHandling(){return o}}},function(t,n,i){"use strict";function identity(t){return t}i.d(n,"a",(function(){return identity}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return UVNode}));var o=i(2),a=i(24);function UVNode(t){o.a.call(this,"v2",{shared:!1}),this.index=t||0}UVNode.prototype=Object.create(o.a.prototype),UVNode.prototype.constructor=UVNode,UVNode.prototype.nodeType="UV",UVNode.prototype.generate=function(t,n){t.requires.uv[this.index]=!0;var i=this.index>0?this.index+1:"",o=t.isShader("vertex")?"uv"+i:"vUv"+i;return t.format(o,this.getType(t),n)},UVNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.index=t.index,this},UVNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).index=this.index),n},a.a.addKeyword("uv",(function(){return new UVNode})),a.a.addKeyword("uv2",(function(){return new UVNode(1)}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return a}));var o=i(1),a=function(t){function OuterSubscriber(){return null!==t&&t.apply(this,arguments)||this}return o.a(OuterSubscriber,t),OuterSubscriber.prototype.notifyNext=function(t,n,i,o,a){this.destination.next(n)},OuterSubscriber.prototype.notifyError=function(t,n){this.destination.error(t)},OuterSubscriber.prototype.notifyComplete=function(t){this.destination.complete()},OuterSubscriber}(i(3).a)},function(t,n,i){"use strict";i.d(n,"a",(function(){return filter}));var o=i(1),a=i(3);function filter(t,n){return function filterOperatorFunction(i){return i.lift(new s(t,n))}}var s=function(){function FilterOperator(t,n){this.predicate=t,this.thisArg=n}return FilterOperator.prototype.call=function(t,n){return n.subscribe(new m(t,this.predicate,this.thisArg))},FilterOperator}(),m=function(t){function FilterSubscriber(n,i,o){var a=t.call(this,n)||this;return a.predicate=i,a.thisArg=o,a.count=0,a}return o.a(FilterSubscriber,t),FilterSubscriber.prototype._next=function(t){var n;try{n=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}n&&this.destination.next(t)},FilterSubscriber}(a.a)},function(t,n,i){"use strict";i.d(n,"b",(function(){return o})),i.d(n,"a",(function(){return g}));var o,a=i(26),s=i(80),m=i(106);o||(o={});var g=function(){function Notification(t,n,i){this.kind=t,this.value=n,this.error=i,this.hasValue="N"===t}return Notification.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},Notification.prototype.do=function(t,n,i){switch(this.kind){case"N":return t&&t(this.value);case"E":return n&&n(this.error);case"C":return i&&i()}},Notification.prototype.accept=function(t,n,i){return t&&"function"==typeof t.next?this.observe(t):this.do(t,n,i)},Notification.prototype.toObservable=function(){switch(this.kind){case"N":return Object(s.a)(this.value);case"E":return Object(m.a)(this.error);case"C":return Object(a.b)()}throw new Error("unexpected notification kind value")},Notification.createNext=function(t){return void 0!==t?new Notification("N",t):Notification.undefinedValueNotification},Notification.createError=function(t){return new Notification("E",void 0,t)},Notification.createComplete=function(){return Notification.completeNotification},Notification.completeNotification=new Notification("C"),Notification.undefinedValueNotification=new Notification("N",void 0),Notification}()},function(t,n){"function"==typeof Object.create?t.exports=function inherits(t,n){n&&(t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function inherits(t,n){if(n){t.super_=n;var TempCtor=function(){};TempCtor.prototype=n.prototype,t.prototype=new TempCtor,t.prototype.constructor=t}}},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ByondInteractiveElement=n.AnimationOptions=void 0;var g=i(0),_=i(18),S=i(17),M=i(100),T=i(10),O=i(34),A=i(83),P=i(22);n.AnimationOptions=function AnimationOptions(){this.time=0};var L=function(t){function ByondInteractiveElement(n,i,o){var a=t.call(this,n,i,o)||this;return a._isActive=!1,a}return a(ByondInteractiveElement,t),ByondInteractiveElement.prototype.init=function(){var n,i;return s(this,void 0,void 0,(function(){var o,a,M,O,A,L=this;return m(this,(function(R){switch(R.label){case 0:return this.setState(new T.LoadingEvent),this.obj||(this.obj=new g.Mesh(this.geometry,this.material)),this.material&&(Array.isArray(this.material)?this.material.forEach((function(t){t.transparent=!0,t.opacity=L.isVisible?1:0,t.side=g.DoubleSide,t.needsUpdate=!0})):(this.material.transparent=!0,this.material.opacity=this.isVisible?1:0,this.material.side=g.DoubleSide,this.material.needsUpdate=!0)),[4,this.Reset()];case 1:return R.sent(),this.obj.castShadow=null===(n=this.metadata)||void 0===n?void 0:n.is_cast_shadow,this.obj.receiveShadow=null===(i=this.metadata)||void 0===i?void 0:i.is_receive_shadow,[4,t.prototype.init.call(this)];case 2:return R.sent(),(o=this.getCustomAttribute(P.CustomAttributes.Teleport))&&(this.attachedTeleport=S.Utils.getItemById(this.appManager,o)),(a=this.getCustomAttribute(P.CustomAttributes.EnvironmentMap))&&a.url?a.url!==P.CustomAttributes.Values.EnvMap.Auto?[3,3]:(this.subscriptions.push(this.appManager.eventManager.pipe(_.filter((function(t){return t.eventType.name===(new T.ZoneChangeEndedEvent).name||t.eventType===T.ZoneChangeEndedEvent}))).subscribe((function(){return s(L,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,S.Utils.setEnvMap(this.appManager,a,this.obj,this.material)];case 1:return t.sent(),a.exposure&&(this.appManager.currentExperience.renderer.toneMappingExposure=+a.exposure),[2]}}))}))}))),[3,5]):[3,5];case 3:return[4,S.Utils.setEnvMap(this.appManager,a,this.obj,this.material)];case 4:R.sent(),a.exposure&&(this.appManager.currentExperience.renderer.toneMappingExposure=+a.exposure),R.label=5;case 5:return(M=this.getCustomAttribute(P.CustomAttributes.LookAt))&&this.subscriptions.push(this.appManager.renderEventManager.subscribe((function(){L.setLookAtItem(M)}))),(O=this.getCustomAttribute(P.CustomAttributes.Wireframe))&&!0===O&&this.renderWireframe(O),(A=this.getCustomAttribute(P.CustomAttributes.Bounds))&&A.vector&&(S.Utils.matchObjToBounds(this,A.vector,void 0===A.best_fit||A.best_fit,void 0===A.force_position||A.force_position),this.appManager.boundsMode&&this.showBoundingBox()),[2]}}))}))},ByondInteractiveElement.prototype.HandleEditorEventStarted=function(n){var i={originId:n.originId,type:n.type,oldValue:{},historyMode:n.actionType?n.actionType:"action"};switch(n.type){case"delete":var o=Object.assign({},this.getMetadata(),{ElementName:this.getMetadata().ElementName}),a=new g.Vector3;a=this.obj.getWorldPosition(a),o.position=S.Utils.threePositionToByondPosition(a),o.rotation=S.Utils.threeRotationToByondRotation(this.obj.rotation.clone()),o.scale=this.obj.scale.clone(),i.originId=this.appManager.currentExperience.currentZone.getMetadata().byond_id,i.type="create",i.oldValue={metadata:o},this.appManager.historyManager.historyEventManager.next(i);break;case"transform":i.oldValue.position=this.obj.position.clone(),i.oldValue.rotation=this.obj.rotation.clone(),i.oldValue.scale=this.obj.scale.clone(),this.appManager.historyManager.historyEventManager.next(i)}t.prototype.HandleEditorEventStarted.call(this,n)},ByondInteractiveElement.prototype.HandleEditorEventEnded=function(n){t.prototype.HandleEditorEventEnded.call(this,n);var i={originId:this.getMetadata().byond_id,oldValue:{},type:n.type,historyMode:n.actionType?n.actionType:"action"};"transform"===n.type&&(n.value&&(n.value.position&&(i.oldValue.position=this.obj.position.clone(),this.obj.position.copy(n.value.position)),n.value.rotation&&(i.oldValue.rotation=this.obj.rotation.clone(),this.obj.rotation.copy(n.value.rotation)),n.value.scale&&(i.oldValue.scale=this.obj.scale.clone(),this.obj.scale.copy(n.value.scale)),i.oldValue!=={}&&this.appManager.historyManager.historyEventManager.next(i)),this.metadata.position=S.Utils.threePositionToByondPosition(this.obj.position.clone()),this.metadata.rotation=S.Utils.threeRotationToByondRotation(this.obj.rotation.clone()),this.metadata.scale=this.obj.scale.clone())},ByondInteractiveElement.prototype.setLookAtItem=function(t){var n;if(t.item===P.CustomAttributes.Values.LookAt.Camera)n=this.appManager.currentExperience.cameraControlsRegistry.cameraControls.camera;else{var i=S.Utils.getItemById(this.appManager,t.item);if(!i)return;n=i.obj}var o=n.position.clone();t.x&&(o.x=this.obj.position.x),t.y&&(o.y=this.obj.position.y),t.z&&(o.z=this.obj.position.z),this.obj.lookAt(o)},ByondInteractiveElement.prototype.renderWireframe=function(t){this.traverseMaterials(this.obj,(function(n){n.wireframe=t}))},ByondInteractiveElement.prototype.traverseMaterials=function(t,n){t.traverse((function(t){t.isMesh&&(Array.isArray(t.material)?t.material:[t.material]).forEach(n)}))},ByondInteractiveElement.prototype.showBoundingBox=function(){if(this.boundingBox){var t=Array.isArray(this.boundingBox.material)?this.boundingBox.material:[this.boundingBox.material],n=S.Utils.randomColor();t.forEach((function(t){t.transparent=!0,t.visible=!0,t.color&&(n=t.color)})),this.boundingBox.geometry.computeBoundingBox();var i=(new g.Vector3).subVectors(this.boundingBox.geometry.boundingBox.max,this.boundingBox.geometry.boundingBox.min),o=(new g.Vector3).addVectors(this.boundingBox.geometry.boundingBox.max,this.boundingBox.geometry.boundingBox.min).multiplyScalar(.5),a="("+i.x.toFixed(2)+", "+i.y.toFixed(2)+", "+i.z.toFixed(2)+")",s=new g.FontLoader,m=this;s.load("https://s3.amazonaws.com/webapps.byondvr.com/assets/Fonts/helvetiker_regular.typeface.json",(function(t){var i=new g.TextGeometry(a,{height:0,curveSegments:4,font:t,size:1}),s=new g.MeshBasicMaterial({color:n,transparent:!0}),_=new g.Mesh(i,s);_.rotation.set(0,Math.PI,0),m.boundingBox.add(_),i.computeBoundingBox();var S=(new g.Vector3).subVectors(i.boundingBox.max,i.boundingBox.min);_.position.set(m.obj.position.x+S.x/2,o.y,m.boundingBox.geometry.boundingBox.min.z)}))}},ByondInteractiveElement.prototype.updateTransformMetadata=function(){this.getMetadata().scale=this.obj.scale.clone(),this.getMetadata().position=this.obj.position.clone(),this.getMetadata().rotation=this.obj.rotation.clone()},ByondInteractiveElement.prototype.Reset=function(t){return void 0===t&&(t=0),s(this,void 0,void 0,(function(){var n,i;return m(this,(function(o){switch(o.label){case 0:return(n=this.getMetadata())&&"Element3DMetadata"===n.metadataName?((i={Position:n.position?n.position.clone():n.position,Rotation:n.rotation?n.rotation.clone():n.rotation,Scale:n.scale?n.scale.clone():n.scale}).time=t,[4,this.Animate(i)]):[2];case 1:return o.sent(),[2]}}))}))},ByondInteractiveElement.prototype.SenarioAnimate=function(t){return s(this,void 0,void 0,(function(){var n=this;return m(this,(function(i){return t.forEach((function(t){return s(n,void 0,void 0,(function(){var n,i=this;return m(this,(function(o){switch(o.label){case 0:return n=[],t.map((function(t){n.push(i.Animate(t))})),[4,Promise.all(n)];case 1:return o.sent(),[2]}}))}))})),[2]}))}))},ByondInteractiveElement.prototype.Animate=function(t){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){return n=[],t.Position&&n.push(this.setPosition(t.Position,t.time)),n.push(this.setRotation(t.Rotation,t.time)),t.Scale&&n.push(this.setScale(t.Scale,t.time)),t.Color&&n.push(this.setColor(t.Color,t.time)),[2,Promise.all(n)]}))}))},ByondInteractiveElement.prototype.setEnabled=function(n){t.prototype.setEnabled.call(this,n),n?this.appManager.currentExperience.userInteractionControlsRegistry.AddObject(this.obj,this):this.appManager.currentExperience.userInteractionControlsRegistry.RemoveObject(this.obj)},ByondInteractiveElement.prototype.setPosition=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i=this;return m(this,(function(o){switch(o.label){case 0:return[4,S.Utils.setPosition(this.obj,t,n,[function(){i.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(i),i.appManager.eventManager.next(new O.EventMessage(self,new T.PropertieChangedEvent,"position")),i.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(i)}])];case 1:return o.sent(),[2]}}))}))},ByondInteractiveElement.prototype.setRotation=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i=this;return m(this,(function(o){switch(o.label){case 0:return[4,S.Utils.setRotation(this.obj,t,n,[function(){i.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(i),i.appManager.eventManager.next(new O.EventMessage(self,new T.PropertieChangedEvent,"rotation")),i.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(i)}])];case 1:return o.sent(),[2]}}))}))},ByondInteractiveElement.prototype.setScale=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i=this;return m(this,(function(o){switch(o.label){case 0:return[4,S.Utils.setScale(this.obj,t,n,[function(){i.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(i),i.appManager.eventManager.next(new O.EventMessage(self,new T.PropertieChangedEvent,"scale")),i.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(i)}])];case 1:return o.sent(),[2]}}))}))},ByondInteractiveElement.prototype.setColor=function(t,n){return void 0===t&&(t="#ffffff"),void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i,o=this;return m(this,(function(a){switch(a.label){case 0:return this.material instanceof A.ChromakeyMaterial?[2]:Array.isArray(this.material)?(this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this),i=[],this.material.forEach((function(o){i.push(S.Utils.setColor(o,t,n))})),[4,Promise.all(i)]):[3,2];case 1:return a.sent(),this.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(this),[3,4];case 2:return[4,S.Utils.setColor(this.material,t,n,[function(){o.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(o),o.appManager.eventManager.next(new O.EventMessage(self,new T.PropertieChangedEvent,"color")),o.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(o)}])];case 3:a.sent(),a.label=4;case 4:return[2]}}))}))},ByondInteractiveElement.prototype.setAlpha=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i,o=this;return m(this,(function(a){switch(a.label){case 0:return this.obj.visible=!0,Array.isArray(this.material)?(this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this),i=[],this.material.forEach((function(o){i.push(S.Utils.setAlpha(o,t,n))})),[4,Promise.all(i)]):[3,2];case 1:return a.sent(),this.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(this),[3,4];case 2:return[4,S.Utils.setAlpha(this.material,t,n,[function(){o.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(o),o.appManager.eventManager.next(new O.EventMessage(self,new T.PropertieChangedEvent,"opacity")),o.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(o)}])];case 3:a.sent(),a.label=4;case 4:return this.obj.visible=t>0,[2]}}))}))},ByondInteractiveElement.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return this.isVisible===t?[2]:[4,this.setAlpha(t?1:0,n)];case 1:return i.sent(),this.visible=t,[2]}}))}))},ByondInteractiveElement.prototype.getMetadata=function(){return this.metadata},ByondInteractiveElement.prototype.destroy=function(){this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this),t.prototype.destroy.call(this),this.geometry&&this.geometry.dispose(),this.geometry=void 0,this.material&&(Array.isArray(this.material)?this.material.forEach((function(t){t.dispose()})):this.material.dispose()),this.setEnabled(!1),this.material=void 0,delete this.obj,this.obj=void 0,this.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(this)},ByondInteractiveElement.prototype.activateElement=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return t.isActive=!0,t.attachedTeleport&&t.attachedTeleport!==t&&t.attachedTeleport instanceof ByondInteractiveElement?[4,t.attachedTeleport.activateElement(t.attachedTeleport)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},ByondInteractiveElement.prototype.deactivateElement=function(){return s(this,void 0,void 0,(function(){return m(this,(function(t){return this.isActive=!1,[2]}))}))},Object.defineProperty(ByondInteractiveElement.prototype,"isActive",{get:function(){return this._isActive},set:function(t){this._isActive=t},enumerable:!1,configurable:!0}),ByondInteractiveElement.prototype.handleDependencies=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.handleDependencies.call(this)];case 1:return i.sent(),(n=this.getCustomAttribute(P.CustomAttributes.RenderOrder))&&this.obj&&(this.obj.renderOrder=n),this.HandleElementEventsAttribute(),[2]}}))}))},ByondInteractiveElement.prototype.showRotationHandles=function(t){},ByondInteractiveElement.prototype.showScaleHandles=function(t){},ByondInteractiveElement.prototype.getMinVector=function(){var t=new g.Box3;return t=S.Utils.SetBoxFromObj(t,this.obj),(new g.Vector3).copy(t.min)},ByondInteractiveElement.prototype.getMaxVector=function(){var t=new g.Box3;return t=S.Utils.SetBoxFromObj(t,this.obj),(new g.Vector3).copy(t.max)},ByondInteractiveElement.prototype.HandleElementEventsAttribute=function(){var t=this,n=this.getCustomAttribute(P.CustomAttributes.ElementEvents);n&&(n.ontouch&&this.subscriptions.push(this.appManager.eventManager.pipe(_.filter((function(n){return n.origin===t&&(n.eventType.name===(new T.TouchEvent).name||n.eventType===T.TouchEvent)}))).subscribe((function(){t.triggerOnEvent(n.ontouch)}))),n.onhover&&this.subscriptions.push(this.appManager.eventManager.pipe(_.filter((function(n){return n.origin===t&&(n.eventType.name===(new T.FocusEvent).name||n.eventType===T.FocusEvent)}))).subscribe((function(){t.triggerOnEvent(n.onhover)}))),n.onunhover&&this.subscriptions.push(this.appManager.eventManager.pipe(_.filter((function(n){return n.origin===t&&(n.eventType.name===(new T.UnfocusEvent).name||n.eventType===T.UnfocusEvent)}))).subscribe((function(){t.triggerOnEvent(n.onunhover)}))))},ByondInteractiveElement.prototype.triggerOnEvent=function(t){return s(this,void 0,void 0,(function(){var n,i=this;return m(this,(function(o){switch(o.label){case 0:return n=[],t.forEach((function(t){n.push(i.triggerFlow(t.flow))})),[4,Promise.all(n)];case 1:return o.sent(),[2]}}))}))},ByondInteractiveElement.prototype.triggerFlow=function(t){return s(this,void 0,void 0,(function(){var n=this;return m(this,(function(i){return t.steps.forEach((function(t){return s(n,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,this.triggerStep(t)];case 1:return n.sent(),[2]}}))}))})),[2]}))}))},ByondInteractiveElement.prototype.triggerStep=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:switch(t.type){case"async":return[3,1];case"touch_element":return[3,3]}return[3,5];case 1:return[4,this.triggerAsyncStep(t)];case 2:return n.sent(),[3,5];case 3:return[4,this.triggerTouchElement(t)];case 4:return n.sent(),[3,5];case 5:return[2]}}))}))},ByondInteractiveElement.prototype.triggerTouchElement=function(t){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){return t.id&&(n=S.Utils.getItemById(this.appManager,t.id))?(this.appManager.eventManager.next(new O.EventMessage(n,new T.TouchEvent),!0),[2]):[2]}))}))},ByondInteractiveElement.prototype.triggerAsyncStep=function(t){return s(this,void 0,void 0,(function(){var n,i=this;return m(this,(function(o){switch(o.label){case 0:return n=[],t.steps.forEach((function(t){return s(i,void 0,void 0,(function(){return m(this,(function(i){return n.push(this.triggerStep(t)),[2]}))}))})),[4,Promise.all(n)];case 1:return o.sent(),[2]}}))}))},ByondInteractiveElement}(M.ByondBaseElement);n.ByondInteractiveElement=L},function(t,n,i){"use strict";i.d(n,"a",(function(){return ColorNode}));var o=i(0),a=i(6),s=i(20);function ColorNode(t,n,i){a.a.call(this,"c"),this.value=t instanceof o.Color?t:new o.Color(t||0,n,i)}ColorNode.prototype=Object.create(a.a.prototype),ColorNode.prototype.constructor=ColorNode,ColorNode.prototype.nodeType="Color",s.a.addShortcuts(ColorNode.prototype,"value",["r","g","b"]),ColorNode.prototype.generateReadonly=function(t,n,i,o){return t.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",o,n)},ColorNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.value.copy(t),this},ColorNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).r=this.r,n.g=this.g,n.b=this.b,!0===this.readonly&&(n.readonly=!0)),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=function getSymbolIterator(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},function(t,n,i){"use strict";function noop(){}i.d(n,"a",(function(){return noop}))},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Log=n.RemoveLogger=n.AddLogger=n.Configure=void 0;var o=i(215),a=i(251),s=i(73),m=i(440),g=i(143),_=i(95),S=g.v1();function Configure(t){void 0===t&&(t="debug"),o.configure({transports:[new a.BrowserConsole({format:o.format.simple(),level:t})]})}n.Configure=Configure,n.AddLogger=function AddLogger(t){o.add(t)},n.RemoveLogger=function RemoveLogger(t){o.remove(t)},function(t){function setLogData(t,n,i,o){n&&"object"!=typeof n&&(n={data:n}),(n=function setLogOptions(t,n){return n?((n.allData||n.memory)&&(t.memory=_.DeviceUtils.getMemoryInfo()),(n.allData||n.page_load_time)&&(t.page_load_time=_.DeviceUtils.getPageLoadTime()),(n.allData||n.platform)&&(t.platform=m),(n.allData||n.user_agent)&&(t.user_agent=window.navigator.userAgent),(n.allData||n.url)&&(t.url=window.location.href),(n.allData||n.query_parameters)&&(t.query_parameters=s.JsUtils.strMapToObj(s.JsUtils.GetQuerysFromUrl())),t):t}(n=n||{},o)).instance_id=S;var a=(new Date).toUTCString();return n.log_data={log_type:i.toLowerCase(),time:a,description:t},{message:t=i+", "+t+", "+a+"\n",data:n}}t.Debug=function Debug(t,n,i){void 0===t&&(t="");var a=setLogData(t,n,"Debug",i),s=a.message,m=a.data;o.debug(s,m)},t.Info=function Info(t,n,i){void 0===t&&(t="");var a=setLogData(t,n,"Info",i),s=a.message,m=a.data;o.info(s,m)},t.Warn=function Warn(t,n,i){void 0===t&&(t="");var a=setLogData(t,n,"Warn",i),s=a.message,m=a.data;o.warn(s,m)},t.Error=function Error(t,n,i){void 0===t&&(t="");var a=setLogData(t,n,"Error",i),s=a.message,m=a.data;o.error(s,m)}}(n.Log||(n.Log={})),Configure("debug")},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ByondBaseElementFactoryImpl=void 0;n.ByondBaseElementFactoryImpl=function ByondBaseElementFactoryImpl(t){this.appManager=t}},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(t,n,i){"use strict";i.d(n,"a",(function(){return Vector2Node}));var o=i(0),a=i(6),s=i(20);function Vector2Node(t,n){a.a.call(this,"v2"),this.value=t instanceof o.Vector2?t:new o.Vector2(t,n)}Vector2Node.prototype=Object.create(a.a.prototype),Vector2Node.prototype.constructor=Vector2Node,Vector2Node.prototype.nodeType="Vector2",s.a.addShortcuts(Vector2Node.prototype,"value",["x","y"]),Vector2Node.prototype.generateReadonly=function(t,n,i,o){return t.format("vec2( "+this.x+", "+this.y+" )",o,n)},Vector2Node.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.value.copy(t),this},Vector2Node.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).x=this.x,n.y=this.y,!0===this.readonly&&(n.readonly=!0)),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return NormalNode}));var o=i(2),a=i(24);function NormalNode(t){o.a.call(this,"v3"),this.scope=t||NormalNode.VIEW}NormalNode.LOCAL="local",NormalNode.WORLD="world",NormalNode.VIEW="view",NormalNode.prototype=Object.create(o.a.prototype),NormalNode.prototype.constructor=NormalNode,NormalNode.prototype.nodeType="Normal",NormalNode.prototype.getShared=function(){return this.scope===NormalNode.WORLD},NormalNode.prototype.build=function(t,n,i,a){var s=t.context[this.scope+"Normal"];return s?s.build(t,n,i,a):o.a.prototype.build.call(this,t,n,i)},NormalNode.prototype.generate=function(t,n){var i;switch(this.scope){case NormalNode.VIEW:i=t.isShader("vertex")?"transformedNormal":"geometryNormal";break;case NormalNode.LOCAL:t.isShader("vertex")?i="objectNormal":(t.requires.normal=!0,i="vObjectNormal");break;case NormalNode.WORLD:t.isShader("vertex")?i="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,i="vWNormal")}return t.format(i,this.getType(t),n)},NormalNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.scope=t.scope,this},NormalNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).scope=this.scope),n},a.a.addKeyword("viewNormal",(function(){return new NormalNode(NormalNode.VIEW)})),a.a.addKeyword("localNormal",(function(){return new NormalNode(NormalNode.NORMAL)})),a.a.addKeyword("worldNormal",(function(){return new NormalNode(NormalNode.WORLD)}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=function(){function ObjectUnsubscribedErrorImpl(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return ObjectUnsubscribedErrorImpl.prototype=Object.create(Error.prototype),ObjectUnsubscribedErrorImpl}()},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AppManagerOptions=n.AppManager=n.Utils=n.UIElements=n.Factories=n.Elements=n.Effects=n.Core=n.Controls=n.THREE=n.ClassTransformer=void 0,i(317);var o=i(36);n.ClassTransformer=o;var a=i(0);n.THREE=a,window.THREE=a;var s=i(326);n.Controls=s;var m=i(277);n.Core=m;var g=i(279);n.Effects=g;var _=i(290);n.Elements=_;var S=i(533);n.Factories=S;var M=i(569);n.UIElements=M;var T=i(99);n.Utils=T;var O=i(580);Object.defineProperty(n,"AppManager",{enumerable:!0,get:function(){return O.AppManager}}),Object.defineProperty(n,"AppManagerOptions",{enumerable:!0,get:function(){return O.AppManagerOptions}})},function(t,n,i){"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?_assertThisInitialized(t):n}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,Wrapper)}function Wrapper(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,t)})(t)}function _construct(t,n,i){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function _construct(t,n,i){var o=[null];o.push.apply(o,n);var a=new(Function.bind.apply(t,o));return i&&_setPrototypeOf(a,i.prototype),a}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,n){return t.__proto__=n,t})(t,n)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=function(t){!function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_setPrototypeOf(t,n)}(InvalidFormatError,t);var n=function _createSuper(t){var n=_isNativeReflectConstruct();return function _createSuperInternal(){var i,o=_getPrototypeOf(t);if(n){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}(InvalidFormatError);function InvalidFormatError(t){var i;return function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,InvalidFormatError),i=n.call(this,"Format functions must be synchronous taking a two arguments: (info, opts)\nFound: ".concat(t.toString().split("\n")[0],"\n")),Error.captureStackTrace(_assertThisInitialized(i),InvalidFormatError),i}return InvalidFormatError}(_wrapNativeSuper(Error));t.exports=function(t){if(t.length>2)throw new o(t);function Format(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t}function createFormatWrap(t){return new Format(t)}return Format.prototype.transform=t,createFormatWrap.Format=Format,createFormatWrap}},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=function(){function ArgumentOutOfRangeErrorImpl(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return ArgumentOutOfRangeErrorImpl.prototype=Object.create(Error.prototype),ArgumentOutOfRangeErrorImpl}()},function(t,n,i){"use strict";function isFunction(t){return"function"==typeof t}i.d(n,"a",(function(){return isFunction}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return ColorSpaceNode}));var o,a,s=i(0),m=i(2),g=i(16),_=i(14),S=i(7),M=i(15);function ColorSpaceNode(t,n){m.a.call(this,"v4"),this.input=t,this.method=n||ColorSpaceNode.LINEAR_TO_LINEAR}ColorSpaceNode.Nodes={LinearToLinear:new S.a(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),GammaToLinear:new S.a(["vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );","}"].join("\n")),LinearToGamma:new S.a(["vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );","}"].join("\n")),sRGBToLinear:new S.a(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new S.a(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n")),RGBEToLinear:new S.a(["vec4 RGBEToLinear( in vec4 value ) {","\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );","}"].join("\n")),LinearToRGBE:new S.a(["vec4 LinearToRGBE( in vec4 value ) {","\tfloat maxComponent = max( max( value.r, value.g ), value.b );","\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );","\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );","}"].join("\n")),RGBMToLinear:new S.a(["vec3 RGBMToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.xyz * value.w * maxRange, 1.0 );","}"].join("\n")),LinearToRGBM:new S.a(["vec3 LinearToRGBM( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );","\tM            = ceil( M * 255.0 ) / 255.0;","\treturn vec4( value.rgb / ( M * maxRange ), M );","}"].join("\n")),RGBDToLinear:new S.a(["vec3 RGBDToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );","}"].join("\n")),LinearToRGBD:new S.a(["vec3 LinearToRGBD( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat D      = max( maxRange / maxRGB, 1.0 );","\tD            = clamp( floor( D ) / 255.0, 0.0, 1.0 );","\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );","}"].join("\n")),cLogLuvM:o=new g.a("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),LinearToLogLuv:new S.a(["vec4 LinearToLogLuv( in vec4 value ) {","\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;","\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));","\tvec4 vResult;","\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;","\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;","\tvResult.w = fract(Le);","\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;","\treturn vResult;","}"].join("\n"),[o]),cLogLuvInverseM:a=new g.a("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );"),LogLuvToLinear:new S.a(["vec4 LogLuvToLinear( in vec4 value ) {","\tfloat Le = value.z * 255.0 + value.w;","\tvec3 Xp_Y_XYZp;","\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;","\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;","\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;","\treturn vec4( max(vRGB, 0.0), 1.0 );","}"].join("\n"),[a])},ColorSpaceNode.LINEAR_TO_LINEAR="LinearToLinear",ColorSpaceNode.GAMMA_TO_LINEAR="GammaToLinear",ColorSpaceNode.LINEAR_TO_GAMMA="LinearToGamma",ColorSpaceNode.SRGB_TO_LINEAR="sRGBToLinear",ColorSpaceNode.LINEAR_TO_SRGB="LinearTosRGB",ColorSpaceNode.RGBE_TO_LINEAR="RGBEToLinear",ColorSpaceNode.LINEAR_TO_RGBE="LinearToRGBE",ColorSpaceNode.RGBM_TO_LINEAR="RGBMToLinear",ColorSpaceNode.LINEAR_TO_RGBM="LinearToRGBM",ColorSpaceNode.RGBD_TO_LINEAR="RGBDToLinear",ColorSpaceNode.LINEAR_TO_RGBD="LinearToRGBD",ColorSpaceNode.LINEAR_TO_LOG_LUV="LinearToLogLuv",ColorSpaceNode.LOG_LUV_TO_LINEAR="LogLuvToLinear",ColorSpaceNode.getEncodingComponents=function(t){switch(t){case s.LinearEncoding:return["Linear"];case s.sRGBEncoding:return["sRGB"];case s.RGBEEncoding:return["RGBE"];case s.RGBM7Encoding:return["RGBM",new _.a(7).setReadonly(!0)];case s.RGBM16Encoding:return["RGBM",new _.a(16).setReadonly(!0)];case s.RGBDEncoding:return["RGBD",new _.a(256).setReadonly(!0)];case s.GammaEncoding:return["Gamma",new M.a("float( GAMMA_FACTOR )","f")]}},ColorSpaceNode.prototype=Object.create(m.a.prototype),ColorSpaceNode.prototype.constructor=ColorSpaceNode,ColorSpaceNode.prototype.nodeType="ColorSpace",ColorSpaceNode.prototype.hashProperties=["method"],ColorSpaceNode.prototype.generate=function(t,n){var i=this.input.build(t,"v4"),o=this.getType(t),a=ColorSpaceNode.Nodes[this.method],s=t.include(a);if(s===ColorSpaceNode.LINEAR_TO_LINEAR)return t.format(i,o,n);if(2===a.inputs.length){var m=this.factor.build(t,"f");return t.format(s+"( "+i+", "+m+" )",o,n)}return t.format(s+"( "+i+" )",o,n)},ColorSpaceNode.prototype.fromEncoding=function(t){var n=ColorSpaceNode.getEncodingComponents(t);this.method="LinearTo"+n[0],this.factor=n[1]},ColorSpaceNode.prototype.fromDecoding=function(t){var n=ColorSpaceNode.getEncodingComponents(t);this.method=n[0]+"ToLinear",this.factor=n[1]},ColorSpaceNode.prototype.copy=function(t){return m.a.prototype.copy.call(this,t),this.input=t.input,this.method=t.method,this},ColorSpaceNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).input=this.input.toJSON(t).uuid,n.method=this.method),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return MathNode}));var o=i(2);function MathNode(t,n,i,a){o.a.call(this),this.a=t,"string"!=typeof n?this.b=n:a=n,"string"!=typeof i?this.c=i:a=i,this.method=a}MathNode.RAD="radians",MathNode.DEG="degrees",MathNode.EXP="exp",MathNode.EXP2="exp2",MathNode.LOG="log",MathNode.LOG2="log2",MathNode.SQRT="sqrt",MathNode.INV_SQRT="inversesqrt",MathNode.FLOOR="floor",MathNode.CEIL="ceil",MathNode.NORMALIZE="normalize",MathNode.FRACT="fract",MathNode.SATURATE="saturate",MathNode.SIN="sin",MathNode.COS="cos",MathNode.TAN="tan",MathNode.ASIN="asin",MathNode.ACOS="acos",MathNode.ARCTAN="atan",MathNode.ABS="abs",MathNode.SIGN="sign",MathNode.LENGTH="length",MathNode.NEGATE="negate",MathNode.INVERT="invert",MathNode.MIN="min",MathNode.MAX="max",MathNode.MOD="mod",MathNode.STEP="step",MathNode.REFLECT="reflect",MathNode.DISTANCE="distance",MathNode.DOT="dot",MathNode.CROSS="cross",MathNode.POW="pow",MathNode.MIX="mix",MathNode.CLAMP="clamp",MathNode.REFRACT="refract",MathNode.SMOOTHSTEP="smoothstep",MathNode.FACEFORWARD="faceforward",MathNode.prototype=Object.create(o.a.prototype),MathNode.prototype.constructor=MathNode,MathNode.prototype.nodeType="Math",MathNode.prototype.hashProperties=["method"],MathNode.prototype.getNumInputs=function(){switch(this.method){case MathNode.MIX:case MathNode.CLAMP:case MathNode.REFRACT:case MathNode.SMOOTHSTEP:case MathNode.FACEFORWARD:return 3;case MathNode.MIN:case MathNode.MAX:case MathNode.MOD:case MathNode.STEP:case MathNode.REFLECT:case MathNode.DISTANCE:case MathNode.DOT:case MathNode.CROSS:case MathNode.POW:return 2;default:return 1}},MathNode.prototype.getInputType=function(t){var n=t.getTypeLength(this.a.getType(t)),i=this.b?t.getTypeLength(this.b.getType(t)):0,o=this.c?t.getTypeLength(this.c.getType(t)):0;return n>i&&n>o?this.a.getType(t):i>o?this.b.getType(t):this.c.getType(t)},MathNode.prototype.getType=function(t){switch(this.method){case MathNode.LENGTH:case MathNode.DISTANCE:case MathNode.DOT:return"f";case MathNode.CROSS:return"v3"}return this.getInputType(t)},MathNode.prototype.generate=function(t,n){var i,o,a,s=this.a?t.getTypeLength(this.a.getType(t)):0,m=this.b?t.getTypeLength(this.b.getType(t)):0,g=this.c?t.getTypeLength(this.c.getType(t)):0,_=this.getInputType(t),S=this.getType(t);switch(this.method){case MathNode.NEGATE:return t.format("( -"+this.a.build(t,_)+" )",_,n);case MathNode.INVERT:return t.format("( 1.0 - "+this.a.build(t,_)+" )",_,n);case MathNode.CROSS:i=this.a.build(t,"v3"),o=this.b.build(t,"v3");break;case MathNode.STEP:i=this.a.build(t,1===s?"f":_),o=this.b.build(t,_);break;case MathNode.MIN:case MathNode.MAX:case MathNode.MOD:i=this.a.build(t,_),o=this.b.build(t,1===m?"f":_);break;case MathNode.REFRACT:i=this.a.build(t,_),o=this.b.build(t,_),a=this.c.build(t,"f");break;case MathNode.MIX:i=this.a.build(t,_),o=this.b.build(t,_),a=this.c.build(t,1===g?"f":_);break;default:i=this.a.build(t,_),this.b&&(o=this.b.build(t,_)),this.c&&(a=this.c.build(t,_))}var M=[];M.push(i),o&&M.push(o),a&&M.push(a);var T=this.getNumInputs(t);if(M.length!==T)throw Error(`Arguments not match used in "${this.method}". Require ${T}, currently ${M.length}.`);return t.format(this.method+"( "+M.join(", ")+" )",S,n)},MathNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.a=t.a,this.b=t.b,this.c=t.c,this.method=t.method,this},MathNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,this.b&&(n.b=this.b.toJSON(t).uuid),this.c&&(n.c=this.c.toJSON(t).uuid),n.method=this.method),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=function(){function EmptyErrorImpl(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return EmptyErrorImpl.prototype=Object.create(Error.prototype),EmptyErrorImpl}()},function(t,n,i){"use strict";i.d(n,"b",(function(){return mergeMap})),i.d(n,"a",(function(){return S}));var o=i(1),a=i(19),s=i(28),m=i(4);function mergeMap(t,n,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),"function"==typeof n?function(o){return o.pipe(mergeMap((function(i,o){return Object(s.a)(t(i,o)).pipe(Object(a.a)((function(t,a){return n(i,t,o,a)})))}),i))}:("number"==typeof n&&(i=n),function(n){return n.lift(new g(t,i))})}var g=function(){function MergeMapOperator(t,n){void 0===n&&(n=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=n}return MergeMapOperator.prototype.call=function(t,n){return n.subscribe(new _(t,this.project,this.concurrent))},MergeMapOperator}(),_=function(t){function MergeMapSubscriber(n,i,o){void 0===o&&(o=Number.POSITIVE_INFINITY);var a=t.call(this,n)||this;return a.project=i,a.concurrent=o,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return o.a(MergeMapSubscriber,t),MergeMapSubscriber.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},MergeMapSubscriber.prototype._tryNext=function(t){var n,i=this.index++;try{n=this.project(t,i)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(n)},MergeMapSubscriber.prototype._innerSub=function(t){var n=new m.a(this),i=this.destination;i.add(n);var o=Object(m.c)(t,n);o!==n&&i.add(o)},MergeMapSubscriber.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},MergeMapSubscriber.prototype.notifyNext=function(t){this.destination.next(t)},MergeMapSubscriber.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},MergeMapSubscriber}(m.b),S=mergeMap},function(t,n,i){"use strict";i.d(n,"a",(function(){return fromArray}));var o=i(5),a=i(172),s=i(116);function fromArray(t,n){return n?Object(s.a)(t,n):new o.a(Object(a.a)(t))}},function(t,n,i){"use strict";i.d(n,"a",(function(){return s}));var o=i(1),a=i(132),s=function(t){function AsyncScheduler(n,i){void 0===i&&(i=a.a.now);var o=t.call(this,n,(function(){return AsyncScheduler.delegate&&AsyncScheduler.delegate!==o?AsyncScheduler.delegate.now():i()}))||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return o.a(AsyncScheduler,t),AsyncScheduler.prototype.schedule=function(n,i,o){return void 0===i&&(i=0),AsyncScheduler.delegate&&AsyncScheduler.delegate!==this?AsyncScheduler.delegate.schedule(n,i,o):t.prototype.schedule.call(this,n,i,o)},AsyncScheduler.prototype.flush=function(t){var n=this.actions;if(this.active)n.push(t);else{var i;this.active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=n.shift());if(this.active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}}},AsyncScheduler}(a.a)},function(t,n,i){"use strict";i.d(n,"a",(function(){return m}));var o=i(1),a=i(11),s=i(9),m=function(t){function AsyncSubject(){var n=null!==t&&t.apply(this,arguments)||this;return n.value=null,n.hasNext=!1,n.hasCompleted=!1,n}return o.a(AsyncSubject,t),AsyncSubject.prototype._subscribe=function(n){return this.hasError?(n.error(this.thrownError),s.a.EMPTY):this.hasCompleted&&this.hasNext?(n.next(this.value),n.complete(),s.a.EMPTY):t.prototype._subscribe.call(this,n)},AsyncSubject.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},AsyncSubject.prototype.error=function(n){this.hasCompleted||t.prototype.error.call(this,n)},AsyncSubject.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t.prototype.next.call(this,this.value),t.prototype.complete.call(this)},AsyncSubject}(a.a)},function(t,n,i){"use strict";i.r(n),i.d(n,"ShaderPass",(function(){return ShaderPass}));var o=i(0),a=i(30),ShaderPass=function(t,n){a.a.call(this),this.textureID=void 0!==n?n:"tDiffuse",t instanceof o.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=o.UniformsUtils.clone(t.uniforms),this.material=new o.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new a.a.FullScreenQuad(this.material)};ShaderPass.prototype=Object.assign(Object.create(a.a.prototype),{constructor:ShaderPass,render:function(t,n,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}})},function(t,n,i){"use strict";i.d(n,"a",(function(){return a}));var o=i(1),a=function(t){function AsyncAction(n,i){var o=t.call(this,n,i)||this;return o.scheduler=n,o.work=i,o.pending=!1,o}return o.a(AsyncAction,t),AsyncAction.prototype.schedule=function(t,n){if(void 0===n&&(n=0),this.closed)return this;this.state=t;var i=this.id,o=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(o,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(o,this.id,n),this},AsyncAction.prototype.requestAsyncId=function(t,n,i){return void 0===i&&(i=0),setInterval(t.flush.bind(t,this),i)},AsyncAction.prototype.recycleAsyncId=function(t,n,i){if(void 0===i&&(i=0),null!==i&&this.delay===i&&!1===this.pending)return n;clearInterval(n)},AsyncAction.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,n);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},AsyncAction.prototype._execute=function(t,n){var i=!1,o=void 0;try{this.work(t)}catch(t){i=!0,o=!!t&&t||new Error(t)}if(i)return this.unsubscribe(),o},AsyncAction.prototype._unsubscribe=function(){var t=this.id,n=this.scheduler,i=n.actions,o=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==o&&i.splice(o,1),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null},AsyncAction}(function(t){function Action(n,i){return t.call(this)||this}return o.a(Action,t),Action.prototype.schedule=function(t,n){return void 0===n&&(n=0),this},Action}(i(9).a))},function(t,n,i){"use strict";i.d(n,"a",(function(){return isNumeric}));var o=i(13);function isNumeric(t){return!Object(o.a)(t)&&t-parseFloat(t)+1>=0}},function(t,n,i){"use strict";i.r(n),i.d(n,"CopyShader",(function(){return o}));var o={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")}},function(t,n,i){(function(i){var o,_Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},update:function(t,n){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(t=void 0!==t?t:s.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var o=0;o<i.length;o++){var a=this._tweens[i[o]];a&&!1===a.update(t)&&(a._isPlaying=!1,n||delete this._tweens[i[o]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var a,s=new _Group;s.Group=_Group,s._nextId=0,s.nextId=function(){return s._nextId++},"undefined"==typeof self&&void 0!==i&&i.hrtime?s.now=function(){var t=i.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?s.now=self.performance.now.bind(self.performance):void 0!==Date.now?s.now=Date.now:s.now=function(){return(new Date).getTime()},s.Tween=function(t,n){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=s.Easing.Linear.None,this._interpolationFunction=s.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=n||s,this._id=s.nextId()},s.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(t,n){return this._valuesEnd=t,void 0!==n&&(this._duration=n),this},duration:function duration(t){return this._duration=t,this},start:function(t){for(var n in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?"string"==typeof t?s.now()+parseFloat(t):t:s.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[n]instanceof Array){if(0===this._valuesEnd[n].length)continue;this._valuesEnd[n]=[this._object[n]].concat(this._valuesEnd[n])}void 0!==this._object[n]&&(this._valuesStart[n]=this._object[n],this._valuesStart[n]instanceof Array==0&&(this._valuesStart[n]*=1),this._valuesStartRepeat[n]=this._valuesStart[n]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var t=0,n=this._chainedTweens.length;t<n;t++)this._chainedTweens[t].stop()},group:function(t){return this._group=t,this},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onRepeat:function onRepeat(t){return this._onRepeatCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var n,i,o;if(t<this._startTime)return!0;for(n in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(t-this._startTime)/this._duration,i=0===this._duration||i>1?1:i,o=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[n]){var a=this._valuesStart[n]||0,s=this._valuesEnd[n];s instanceof Array?this._object[n]=this._interpolationFunction(s,o):("string"==typeof s&&(s="+"===s.charAt(0)||"-"===s.charAt(0)?a+parseFloat(s):parseFloat(s)),"number"==typeof s&&(this._object[n]=a+(s-a)*o))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[n]&&(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo){var m=this._valuesStartRepeat[n];this._valuesStartRepeat[n]=this._valuesEnd[n],this._valuesEnd[n]=m}this._valuesStart[n]=this._valuesStartRepeat[n]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var g=0,_=this._chainedTweens.length;g<_;g++)this._chainedTweens[g].start(this._startTime+this._duration);return!1}return!0}},s.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var n=1.70158;return t*t*((n+1)*t-n)},Out:function(t){var n=1.70158;return--t*t*((n+1)*t+n)+1},InOut:function(t){var n=2.5949095;return(t*=2)<1?t*t*((n+1)*t-n)*.5:.5*((t-=2)*t*((n+1)*t+n)+2)}},Bounce:{In:function(t){return 1-s.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*s.Easing.Bounce.In(2*t):.5*s.Easing.Bounce.Out(2*t-1)+.5}}},s.Interpolation={Linear:function(t,n){var i=t.length-1,o=i*n,a=Math.floor(o),m=s.Interpolation.Utils.Linear;return n<0?m(t[0],t[1],o):n>1?m(t[i],t[i-1],i-o):m(t[a],t[a+1>i?i:a+1],o-a)},Bezier:function(t,n){for(var i=0,o=t.length-1,a=Math.pow,m=s.Interpolation.Utils.Bernstein,g=0;g<=o;g++)i+=a(1-n,o-g)*a(n,g)*t[g]*m(o,g);return i},CatmullRom:function(t,n){var i=t.length-1,o=i*n,a=Math.floor(o),m=s.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(n<0&&(a=Math.floor(o=i*(1+n))),m(t[(a-1+i)%i],t[a],t[(a+1)%i],t[(a+2)%i],o-a)):n<0?t[0]-(m(t[0],t[0],t[1],t[1],-o)-t[0]):n>1?t[i]-(m(t[i],t[i],t[i-1],t[i-1],o-i)-t[i]):m(t[a?a-1:0],t[a],t[i<a+1?i:a+1],t[i<a+2?i:a+2],o-a)},Utils:{Linear:function(t,n,i){return(n-t)*i+t},Bernstein:function(t,n){var i=s.Interpolation.Utils.Factorial;return i(t)/i(n)/i(t-n)},Factorial:(a=[1],function(t){var n=1;if(a[t])return a[t];for(var i=t;i>1;i--)n*=i;return a[t]=n,n}),CatmullRom:function(t,n,i,o,a){var s=.5*(i-t),m=.5*(o-n),g=a*a;return(2*n-2*i+s+m)*(a*g)+(-3*n+3*i-2*s-m)*g+s*a+n}}},void 0===(o=function(){return s}.apply(n,[]))||(t.exports=o)}).call(this,i(25))},function(t,n,i){(function(t){var o=Object.getOwnPropertyDescriptors||function getOwnPropertyDescriptors(t){for(var n=Object.keys(t),i={},o=0;o<n.length;o++)i[n[o]]=Object.getOwnPropertyDescriptor(t,n[o]);return i},a=/%[sdj%]/g;n.format=function(t){if(!isString(t)){for(var n=[],i=0;i<arguments.length;i++)n.push(inspect(arguments[i]));return n.join(" ")}i=1;for(var o=arguments,s=o.length,m=String(t).replace(a,(function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(o[i++]);case"%d":return Number(o[i++]);case"%j":try{return JSON.stringify(o[i++])}catch(t){return"[Circular]"}default:return t}})),g=o[i];i<s;g=o[++i])isNull(g)||!isObject(g)?m+=" "+g:m+=" "+inspect(g);return m},n.deprecate=function(i,o){if(void 0!==t&&!0===t.noDeprecation)return i;if(void 0===t)return function(){return n.deprecate(i,o).apply(this,arguments)};var a=!1;return function deprecated(){if(!a){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),a=!0}return i.apply(this,arguments)}};var s,m={};function inspect(t,i){var o={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(o.depth=arguments[2]),arguments.length>=4&&(o.colors=arguments[3]),isBoolean(i)?o.showHidden=i:i&&n._extend(o,i),isUndefined(o.showHidden)&&(o.showHidden=!1),isUndefined(o.depth)&&(o.depth=2),isUndefined(o.colors)&&(o.colors=!1),isUndefined(o.customInspect)&&(o.customInspect=!0),o.colors&&(o.stylize=stylizeWithColor),formatValue(o,t,o.depth)}function stylizeWithColor(t,n){var i=inspect.styles[n];return i?"["+inspect.colors[i][0]+"m"+t+"["+inspect.colors[i][1]+"m":t}function stylizeNoColor(t,n){return t}function formatValue(t,i,o){if(t.customInspect&&i&&isFunction(i.inspect)&&i.inspect!==n.inspect&&(!i.constructor||i.constructor.prototype!==i)){var a=i.inspect(o,t);return isString(a)||(a=formatValue(t,a,o)),a}var s=function formatPrimitive(t,n){if(isUndefined(n))return t.stylize("undefined","undefined");if(isString(n)){var i="'"+JSON.stringify(n).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return isNumber(n)?t.stylize(""+n,"number"):isBoolean(n)?t.stylize(""+n,"boolean"):isNull(n)?t.stylize("null","null"):void 0}(t,i);if(s)return s;var m=Object.keys(i),g=function arrayToHash(t){var n={};return t.forEach((function(t,i){n[t]=!0})),n}(m);if(t.showHidden&&(m=Object.getOwnPropertyNames(i)),isError(i)&&(m.indexOf("message")>=0||m.indexOf("description")>=0))return formatError(i);if(0===m.length){if(isFunction(i)){var _=i.name?": "+i.name:"";return t.stylize("[Function"+_+"]","special")}if(isRegExp(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(isDate(i))return t.stylize(Date.prototype.toString.call(i),"date");if(isError(i))return formatError(i)}var S,M="",T=!1,O=["{","}"];return isArray(i)&&(T=!0,O=["[","]"]),isFunction(i)&&(M=" [Function"+(i.name?": "+i.name:"")+"]"),isRegExp(i)&&(M=" "+RegExp.prototype.toString.call(i)),isDate(i)&&(M=" "+Date.prototype.toUTCString.call(i)),isError(i)&&(M=" "+formatError(i)),0!==m.length||T&&0!=i.length?o<0?isRegExp(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),S=T?function formatArray(t,n,i,o,a){for(var s=[],m=0,g=n.length;m<g;++m)hasOwnProperty(n,String(m))?s.push(formatProperty(t,n,i,o,String(m),!0)):s.push("");return a.forEach((function(a){a.match(/^\d+$/)||s.push(formatProperty(t,n,i,o,a,!0))})),s}(t,i,o,g,m):m.map((function(n){return formatProperty(t,i,o,g,n,T)})),t.seen.pop(),function reduceToSingleString(t,n,i){return t.reduce((function(t,n){return n.indexOf("\n"),t+n.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===n?"":n+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+n+" "+t.join(", ")+" "+i[1]}(S,M,O)):O[0]+M+O[1]}function formatError(t){return"["+Error.prototype.toString.call(t)+"]"}function formatProperty(t,n,i,o,a,s){var m,g,_;if((_=Object.getOwnPropertyDescriptor(n,a)||{value:n[a]}).get?g=_.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):_.set&&(g=t.stylize("[Setter]","special")),hasOwnProperty(o,a)||(m="["+a+"]"),g||(t.seen.indexOf(_.value)<0?(g=isNull(i)?formatValue(t,_.value,null):formatValue(t,_.value,i-1)).indexOf("\n")>-1&&(g=s?g.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+g.split("\n").map((function(t){return"   "+t})).join("\n")):g=t.stylize("[Circular]","special")),isUndefined(m)){if(s&&a.match(/^\d+$/))return g;(m=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(m=m.substr(1,m.length-2),m=t.stylize(m,"name")):(m=m.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),m=t.stylize(m,"string"))}return m+": "+g}function isArray(t){return Array.isArray(t)}function isBoolean(t){return"boolean"==typeof t}function isNull(t){return null===t}function isNumber(t){return"number"==typeof t}function isString(t){return"string"==typeof t}function isUndefined(t){return void 0===t}function isRegExp(t){return isObject(t)&&"[object RegExp]"===objectToString(t)}function isObject(t){return"object"==typeof t&&null!==t}function isDate(t){return isObject(t)&&"[object Date]"===objectToString(t)}function isError(t){return isObject(t)&&("[object Error]"===objectToString(t)||t instanceof Error)}function isFunction(t){return"function"==typeof t}function objectToString(t){return Object.prototype.toString.call(t)}function pad(t){return t<10?"0"+t.toString(10):t.toString(10)}n.debuglog=function(i){if(isUndefined(s)&&(s=t.env.NODE_DEBUG||""),i=i.toUpperCase(),!m[i])if(new RegExp("\\b"+i+"\\b","i").test(s)){var o=t.pid;m[i]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",i,o,t)}}else m[i]=function(){};return m[i]},n.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=isArray,n.isBoolean=isBoolean,n.isNull=isNull,n.isNullOrUndefined=function isNullOrUndefined(t){return null==t},n.isNumber=isNumber,n.isString=isString,n.isSymbol=function isSymbol(t){return"symbol"==typeof t},n.isUndefined=isUndefined,n.isRegExp=isRegExp,n.isObject=isObject,n.isDate=isDate,n.isError=isError,n.isFunction=isFunction,n.isPrimitive=function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},n.isBuffer=i(343);var g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var t=new Date,n=[pad(t.getHours()),pad(t.getMinutes()),pad(t.getSeconds())].join(":");return[t.getDate(),g[t.getMonth()],n].join(" ")}function hasOwnProperty(t,n){return Object.prototype.hasOwnProperty.call(t,n)}n.log=function(){console.log("%s - %s",timestamp(),n.format.apply(n,arguments))},n.inherits=i(344),n._extend=function(t,n){if(!n||!isObject(n))return t;for(var i=Object.keys(n),o=i.length;o--;)t[i[o]]=n[i[o]];return t};var _="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function callbackifyOnRejected(t,n){if(!t){var i=new Error("Promise was rejected with a falsy value");i.reason=t,t=i}return n(t)}n.promisify=function promisify(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(_&&t[_]){var n;if("function"!=typeof(n=t[_]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(n,_,{value:n,enumerable:!1,writable:!1,configurable:!0}),n}function n(){for(var n,i,o=new Promise((function(t,o){n=t,i=o})),a=[],s=0;s<arguments.length;s++)a.push(arguments[s]);a.push((function(t,o){t?i(t):n(o)}));try{t.apply(this,a)}catch(t){i(t)}return o}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),_&&Object.defineProperty(n,_,{value:n,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(n,o(t))},n.promisify.custom=_,n.callbackify=function callbackify(n){if("function"!=typeof n)throw new TypeError('The "original" argument must be of type Function');function callbackified(){for(var i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);var a=i.pop();if("function"!=typeof a)throw new TypeError("The last argument must be of type Function");var s=this,cb=function(){return a.apply(s,arguments)};n.apply(this,i).then((function(n){t.nextTick(cb,null,n)}),(function(n){t.nextTick(callbackifyOnRejected,n,cb)}))}return Object.setPrototypeOf(callbackified,Object.getPrototypeOf(n)),Object.defineProperties(callbackified,o(n)),callbackified}}).call(this,i(25))},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.JsUtils=void 0;var s=i(71),m=i(253),g=i(142),_=i(212);i(439),window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,function(t){function loadImage(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){var o=new Image;o.onload=function(){n(o)},o.onerror=function(t){i(t)},o.src=t instanceof Blob?URL.createObjectURL(t):t}))]}))}))}t.FileSystemPrefix="filesystem:"+window.location.protocol+"//"+window.location.hostname+":"+window.location.port+"/temporary/",t.injectCssFile=function injectCssFile(t,n){var i=document.createElement("link");return i.rel="stylesheet",i.href=t,n&&(i.integrity=n),i.setAttribute("crossorigin","anonymous"),document.head.appendChild(i),i},t.injectJsFile=function injectJsFile(t,n){return void 0===n&&(n="text/javascript"),o(this,void 0,void 0,(function(){return a(this,(function(i){return[2,new Promise((function(i,o){var a=document.createElement("script");a.async=!0,a.crossOrigin="anonymous",a.type=n,a.onload=function(){i(a)},a.onerror=function(t){o(t)},a.src=t,document.head.appendChild(a)}))]}))}))},t.injectFontFile=function injectFontFile(t,n){return new Promise((function(i,o){var a=document.createElement("style");a.type="text/css",a.onload=function(){i()},a.onerror=function(t){o(t)},a.textContent="@font-face { font-family: "+n+"; src: url("+t+"); }",document.head.appendChild(a)}))},t.GetQueryFromUrl=function GetQueryFromUrl(t,n){n||(n=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(n);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},t.GetQuerysFromUrl=function GetQuerysFromUrl(){var t=location.search.substring(1);if(t){var n=JSON.parse('{"'+t.replace(/&/g,'","').replace(/=/g,'":"')+'"}',(function(t,n){return""===t?n:decodeURIComponent(n)})),i=new Map;for(var o in n)o&&i.set(o,n[o]);return i}},t.SaveFileToFileSystem=function SaveFileToFileSystem(n,i){return o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,new Promise((function(o,a){window.requestFileSystem(window.TEMPORARY,26214400,(function(a){a.root.getFile(n,{create:!0},(function(a){a.createWriter((function(a){a.write(i),o(t.FileSystemPrefix+n)}))}))}))}))]}))}))},t.SaveDirectoryToFileSystem=function SaveDirectoryToFileSystem(n){return o(this,void 0,void 0,(function(){return a(this,(function(i){return[2,new Promise((function(i,o){window.requestFileSystem(window.TEMPORARY,26214400,(function(o){o.root.getDirectory(n,{create:!0},(function(o){i(t.FileSystemPrefix+n)}))}))}))]}))}))},t.LoadZipData=function LoadZipData(t){return _.loadAsync(t)},t.ZipDataToBlob=function ZipDataToBlob(t){return t.async("blob")},t.DownloadFile=function DownloadFile(t,n){return o(this,void 0,void 0,(function(){var i=this;return a(this,(function(s){return[2,new Promise((function(s,m){return o(i,void 0,void 0,(function(){var i,o;return a(this,(function(a){switch(a.label){case 0:(n=n||{}).url=t,void 0===n.crossDomain&&(n.crossDomain=!0),i=null,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,g.Networking.get(t,n)];case 2:return i=a.sent(),[3,4];case 3:return o=a.sent(),[2,m(o)];case 4:return[2,s(i)]}}))}))}))]}))}))},t.SaveAsDataUrl=function SaveAsDataUrl(t,n){for(var i=t.split(","),o=i[0].match(/:(.*?);/)[1],a=atob(i[1]),s=a.length,g=new Uint8Array(s);s--;)g[s]=a.charCodeAt(s);var _=new Blob([g],{type:o});m.saveAs(_,n)},t.loadImage=loadImage,t.canvasToImageData=function canvasToImageData(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,t.toDataURL()]}))}))},t.canvasToImageAsync=function canvasToImageAsync(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){t.toBlob((function(t){loadImage(t).then((function(t){n(t)})).catch((function(t){i(t)}))}))}))]}))}))},t.resizeImage=function resizeImage(t,n,i){return o(this,void 0,void 0,(function(){var o,s;return a(this,(function(a){switch(a.label){case 0:return o=document.createElement("canvas"),s=o.getContext("2d"),o.width=n,o.height=i,s.drawImage(t,0,0,n,i),[4,loadImage(o.toDataURL())];case 1:return[2,a.sent()]}}))}))},t.setHtmlOpacity=function setHtmlOpacity(t,n,i,m){return void 0===i&&(i=0),o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,new Promise((function(o,a){if(i&&0!==i){var g={opacity:t.style.opacity};new s.Tween(g).to({opacity:n},1e3*i).onUpdate((function(n){try{t.style.opacity=n.opacity+"",m&&m()}catch(t){a()}})).onComplete((function(){t.style.opacity=n+"",o()})).start()}else t.style.opacity=n+"",o()}))]}))}))},t.strMapToObj=function strMapToObj(t){if(!t||0===t.size)return{};var n=Object.create(null);return t.forEach((function(t,i){n[i]=t})),n},t.isIframe=function isIframe(){try{return window.self!==window.top}catch(t){return!0}},t.OpenVideoInTab=function OpenVideoInTab(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){var o=window.open(),a=document.createElement("video");a.src=t,a.autoplay=!0,a.muted=!0,a.controls=!0,a.style.width="100%",a.style.height="100%";var callback=function(){o.close(),n()};a.onended=callback,a.onerror=callback,o.onbeforeunload=function(){n()},o.document.body.appendChild(a)}))]}))}))}}(n.JsUtils||(n.JsUtils={}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return concat}));var o=i(80),a=i(162);function concat(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Object(a.a)()(o.a.apply(void 0,t))}},function(t,n,i){"use strict";i.d(n,"a",(function(){return subscribeTo}));var o=i(172),a=i(76),s=i(48),m=i(52),g=i(173),_=i(174),S=i(114),subscribeTo=function(t){if(t&&"function"==typeof t[m.a])return M=t,function(t){var n=M[m.a]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)};if(Object(g.a)(t))return Object(o.a)(t);if(Object(_.a)(t))return i=t,function(t){return i.then((function(n){t.closed||(t.next(n),t.complete())}),(function(n){return t.error(n)})).then(null,a.a),t};if(t&&"function"==typeof t[s.a])return n=t,function(t){for(var i=n[s.a]();;){var o=void 0;try{o=i.next()}catch(n){return t.error(n),t}if(o.done){t.complete();break}if(t.next(o.value),t.closed)break}return"function"==typeof i.return&&t.add((function(){i.return&&i.return()})),t};var n,i,M,T=Object(S.a)(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+T+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},function(t,n,i){"use strict";function hostReportError(t){setTimeout((function(){throw t}),0)}i.d(n,"a",(function(){return hostReportError}))},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Image=n.ImageOptions=n.SVGCanvasWidth=n.SVGCanvasHeight=void 0;var s=i(0),m=i(50),g=i(144),_=i(17),S=i(257),M=i(259);n.SVGCanvasHeight=512,n.SVGCanvasWidth=512;n.ImageOptions=function ImageOptions(){this.svgSize={width:n.SVGCanvasHeight,height:n.SVGCanvasWidth}};var T=function(){function Image(t,n){this.isDisposed=!1,this.appManager=t,this.imageOptions=n}return Image.prototype.Load=function(){return o(this,void 0,void 0,(function(){var t,n,i,o;return a(this,(function(a){switch(a.label){case 0:if(!_.Utils.isImage(this.imageOptions.url))return[3,10];a.label=1;case 1:return a.trys.push([1,8,,9]),_.Utils.isGif(this.imageOptions.url)?(t=this,[4,this.loadGif()]):[3,3];case 2:return t.Texture=a.sent(),[3,7];case 3:return _.Utils.isSVG(this.imageOptions.url)?(n=this,[4,this.loadSVG()]):[3,5];case 4:return n.Texture=a.sent(),[3,7];case 5:return i=this,[4,this.LoadImage()];case 6:i.Texture=a.sent(),a.label=7;case 7:return this.Texture&&this.setTextureProp(),[2,this.Texture];case 8:return o=a.sent(),m.Log.Warn("error in loading image: "+this.imageOptions.url,o),[2,null];case 9:return[3,11];case 10:return m.Log.Warn("not supported image: "+this.imageOptions.url),[2,null];case 11:return[2]}}))}))},Image.prototype.LoadImage=function(){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(i){switch(i.label){case 0:return this.imageOptions.optimizerWidth&&(this.imageOptions.url=M.ImageOptimizeService.GetImage(this.imageOptions.url,this.imageOptions.optimizerWidth)),[4,this._LoadImage()];case 1:return(t=i.sent())||!this.imageOptions.url?[3,3]:(m.Log.Warn("try to workaround browser cache, adding a query version to: "+this.imageOptions.url),n=this.imageOptions.url,this.imageOptions.url+=(n.indexOf("?")>-1?"&":"?")+"version="+Date.now(),[4,this._LoadImage()]);case 2:!(t=i.sent())&&this.imageOptions.url&&g.Notify.Send("warning","failed to retrieve asset: "+this.imageOptions.url,"warning"),i.label=3;case 3:return[2,t]}}))}))},Image.prototype._LoadImage=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){return t=this,[2,new Promise((function(n,i){var o=new s.TextureLoader;s.ImageUtils.crossOrigin="",o.setCrossOrigin("anonymous"),o.load(t.imageOptions.url,(function(t){n(t)}),null,(function(t){n(void 0)}))}))]}))}))},Image.prototype.loadGif=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){return t=this,[2,new Promise((function(n,i){(new S.GifLoader).load(t.imageOptions.url,(function(t){t.play(),n(t)}),null,(function(t){i(t)}))}))]}))}))},Image.prototype.loadSVG=function(){return o(this,void 0,void 0,(function(){var t,n=this;return a(this,(function(i){return(t=new window.Image(this.imageOptions.svgSize.width,this.imageOptions.svgSize.height)).crossOrigin="anonymous",[2,new Promise((function(i,o){t.onload=function(){var n=new s.Texture(t);n.needsUpdate=!0,i(n)},t.onerror=function(t){console.warn(t),o(t)},t.src=n.imageOptions.url}))]}))}))},Image.prototype.setTextureProp=function(){return this.Texture.magFilter=this.imageOptions.magFilter?this.imageOptions.magFilter:s.LinearFilter,this.Texture.minFilter=this.imageOptions.minFilter?this.imageOptions.minFilter:s.LinearMipMapLinearFilter,this.imageOptions.anisotropy&&(this.Texture.anisotropy=this.imageOptions.anisotropy),this.imageOptions.encoding&&(this.Texture.encoding=this.imageOptions.encoding),this.Texture.generateMipmaps=void 0===this.imageOptions.generateMipmaps||this.imageOptions.generateMipmaps,this.Texture.needsUpdate=!0,this.Texture},Image.prototype.Dispose=function(){this.isDisposed=!0,this.Texture&&(this.Texture.dispose(),this.Texture=void 0),this.canvas&&(this.canvas.remove(),this.canvas=void 0)},Image}();n.Image=T},function(t,n,i){(function(t){var o=void 0!==t&&t||"undefined"!=typeof self&&self||window,a=Function.prototype.apply;function Timeout(t,n){this._id=t,this._clearFn=n}n.setTimeout=function(){return new Timeout(a.call(setTimeout,o,arguments),clearTimeout)},n.setInterval=function(){return new Timeout(a.call(setInterval,o,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(t){t&&t.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(o,this._id)},n.enroll=function(t,n){clearTimeout(t._idleTimeoutId),t._idleTimeout=n},n.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},n._unrefActive=n.active=function(t){clearTimeout(t._idleTimeoutId);var n=t._idleTimeout;n>=0&&(t._idleTimeoutId=setTimeout((function onTimeout(){t._onTimeout&&t._onTimeout()}),n))},i(375),n.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,n.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(33))},function(t,n,i){"use strict";var o=i(72),a=i(220),s=i(27).LEVEL,m=t.exports=function TransportStream(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.call(this,{objectMode:!0,highWaterMark:n.highWaterMark}),this.format=n.format,this.level=n.level,this.handleExceptions=n.handleExceptions,this.handleRejections=n.handleRejections,this.silent=n.silent,n.log&&(this.log=n.log),n.logv&&(this.logv=n.logv),n.close&&(this.close=n.close),this.once("pipe",(function(n){t.levels=n.levels,t.parent=n})),this.once("unpipe",(function(n){n===t.parent&&(t.parent=null,t.close&&t.close())}))};o.inherits(m,a),m.prototype._write=function _write(t,n,i){if(this.silent||!0===t.exception&&!this.handleExceptions)return i(null);var o=this.level||this.parent&&this.parent.level;if(!o||this.levels[o]>=this.levels[t[s]]){if(t&&!this.format)return this.log(t,i);var a=void 0,m=void 0;try{m=this.format.transform(Object.assign({},t),this.format.options)}catch(t){a=t}if(a||!m){if(i(),a)throw a;return}return this.log(m,i)}return i(null)},m.prototype._writev=function _writev(t,n){if(this.logv){var i=t.filter(this._accept,this);return i.length?this.logv(i,n):n(null)}for(var o=0;o<t.length;o++)if(this._accept(t[o]))if(!t[o].chunk||this.format){var a=void 0,s=void 0;try{s=this.format.transform(Object.assign({},t[o].chunk),this.format.options)}catch(t){a=t}if(a||!s){if(t[o].callback(),a)throw n(null),a}else this.log(s,t[o].callback)}else this.log(t[o].chunk,t[o].callback);return n(null)},m.prototype._accept=function _accept(t){var n=t.chunk;if(this.silent)return!1;var i=this.level||this.parent&&this.parent.level;return!(!0!==n.exception&&i&&!(this.levels[i]>=this.levels[n[s]])||!this.handleExceptions&&!0===n.exception)},m.prototype._nop=function _nop(){},t.exports.LegacyTransportStream=i(380)},function(t,n,i){"use strict";i.d(n,"a",(function(){return of}));var o=i(23),a=i(64),s=i(116);function of(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=t[t.length-1];return Object(o.a)(i)?(t.pop(),Object(s.a)(t,i)):Object(a.a)(t)}},function(t,n,i){"use strict";i.d(n,"a",(function(){return Vector3Node}));var o=i(0),a=i(6),s=i(20);function Vector3Node(t,n,i){a.a.call(this,"v3"),this.value=t instanceof o.Vector3?t:new o.Vector3(t,n,i)}Vector3Node.prototype=Object.create(a.a.prototype),Vector3Node.prototype.constructor=Vector3Node,Vector3Node.prototype.nodeType="Vector3",s.a.addShortcuts(Vector3Node.prototype,"value",["x","y","z"]),Vector3Node.prototype.generateReadonly=function(t,n,i,o){return t.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",o,n)},Vector3Node.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.value.copy(t),this},Vector3Node.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).x=this.x,n.y=this.y,n.z=this.z,!0===this.readonly&&(n.readonly=!0)),n}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventTypes=n.EventMessageImpl=void 0;var o=i(34);n.EventMessageImpl=o;var a=i(10);n.EventTypes=a},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.ChromakeyMaterial=n.ChromakeyOptions=void 0;var s=i(0),m=function ChromakeyOptions(){this.baseColor="0x00ff00",this.distance="0.5",this.sensibility="7.0"};n.ChromakeyOptions=m;var g=function(t){function ChromakeyMaterial(n,i,o){void 0===i&&(i=new m);var a=t.call(this,o)||this;return a.materialName="ChromakeyMaterial",a.uniforms={uTexture:{value:n},color:{value:new s.Color(i.baseColor)},distance:{value:i.distance||.5},sensibility:{value:i.sensibility||7}},a.setVertexShader(),a.setFragmentShader(),a.needsUpdate=!0,a}return a(ChromakeyMaterial,t),ChromakeyMaterial.prototype.updateTexture=function(t){this.uniforms.uTexture.value=t,this.needsUpdate=!0},ChromakeyMaterial.prototype.setVertexShader=function(){this.vertexShader=["varying vec2 vUv;","void main(void)","{","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n")},ChromakeyMaterial.prototype.setFragmentShader=function(){this.fragmentShader=["uniform float distance;","uniform float sensibility;","uniform sampler2D uTexture;","uniform vec3 color;","varying vec2 vUv;","void main(void)","{","vec3 tColor = texture2D( uTexture, vUv ).rgb;","float a = (length(tColor - color) - distance ) * sensibility;","gl_FragColor = vec4(tColor, a);","}"].join("\n")},ChromakeyMaterial}(s.ShaderMaterial);n.ChromakeyMaterial=g},function(t,n,i){"use strict";var o=i(139),a=Object.keys||function(t){var n=[];for(var i in t)n.push(i);return n};t.exports=Duplex;var s=Object.create(i(118));s.inherits=i(45);var m=i(224),g=i(178);s.inherits(Duplex,m);for(var _=a(g.prototype),S=0;S<_.length;S++){var M=_[S];Duplex.prototype[M]||(Duplex.prototype[M]=g.prototype[M])}function Duplex(t){if(!(this instanceof Duplex))return new Duplex(t);m.call(this,t),g.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||o.nextTick(onEndNT,this)}function onEndNT(t){t.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),Duplex.prototype._destroy=function(t,n){this.push(null),this.end(),o.nextTick(n,t)}},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenImage=void 0;var g=i(0),_=i(10),S=i(101),M=i(22),T=function(t){function ScreenImage(n,i,o){var a=t.call(this,n,i,o)||this;return a.stopMainProgressiveImageLoading=!1,a}return a(ScreenImage,t),ScreenImage.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},ScreenImage.prototype.activateElement=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.activateElement.call(this,n)];case 1:return i.sent(),n.presentImage(),n.applyAnimateScreenToFov(),[2]}}))}))},ScreenImage.prototype.presentImage=function(){return s(this,void 0,void 0,(function(){var t,n,i,o=this;return m(this,(function(a){switch(a.label){case 0:return this.stopMainProgressiveImageLoading=!1,this.stopPreviewProgressiveImageLoading=!0,(t=this.getMetadata().picture)&&t.startsWith("#")?(this.material.color=new g.Color(t),this.geometry=new g.PlaneBufferGeometry(3.3,3.3),this.obj.geometry=this.geometry,this.material.map=null,this.setState(new _.LoadedEvent),[2]):(n=this.getCustomAttribute(M.CustomAttributes.ProgressiveLoading),i=n&&n.images?n.images:[t],[4,this.loadProgressiveImages(i,!1,(function(){return o.stopMainProgressiveImageLoading}))]);case 1:return a.sent(),[2]}}))}))},ScreenImage.prototype.deactivateElement=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.deactivateElement.call(this)];case 1:return i.sent(),this.stopMainProgressiveImageLoading=!0,this.restorePreviewImage(),this.destroyed||(n=this.metadata.grow_type)&&"none"===n.toLowerCase()?[2]:[4,this.Reset(this.triggerAnimTime)];case 2:return i.sent(),[2]}}))}))},ScreenImage.prototype.restorePreviewImage=function(){this.previewImage&&this.loadPreviewImage(void 0,!0)},ScreenImage.prototype.destroy=function(){t.prototype.destroy.call(this),this.image&&this.image.Dispose()},ScreenImage}(S.ScreenImpl);n.ScreenImage=T},function(t,n,i){"use strict";i.d(n,"a",(function(){return pipe})),i.d(n,"b",(function(){return pipeFromArray}));var o=i(40);function pipe(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return pipeFromArray(t)}function pipeFromArray(t){return 0===t.length?o.a:1===t.length?t[0]:function piped(n){return t.reduce((function(t,n){return n(t)}),n)}}},function(t,n,i){"use strict";i.d(n,"a",(function(){return ReflectNode}));var o=i(2),a=i(29),s=i(54);function ReflectNode(t){o.a.call(this,"v3"),this.scope=t||ReflectNode.CUBE}ReflectNode.CUBE="cube",ReflectNode.SPHERE="sphere",ReflectNode.VECTOR="vector",ReflectNode.prototype=Object.create(o.a.prototype),ReflectNode.prototype.constructor=ReflectNode,ReflectNode.prototype.nodeType="Reflect",ReflectNode.prototype.getUnique=function(t){return!t.context.viewNormal},ReflectNode.prototype.getType=function(){switch(this.scope){case ReflectNode.SPHERE:return"v2"}return this.type},ReflectNode.prototype.generate=function(t,n){var i=this.getUnique(t);if(t.isShader("fragment")){var o;switch(this.scope){case ReflectNode.VECTOR:var m=new s.a(s.a.VIEW),g=t.context.roughness,_=m.build(t,"v3"),S=new a.a(a.a.VIEW).build(t,"v3"),M=g?g.build(t,"f"):void 0,T=`reflect( -normalize( ${S} ), ${_} )`;M&&(T=`normalize( mix( ${T}, ${_}, ${M} * ${M} ) )`);var O=`inverseTransformDirection( ${T}, viewMatrix )`;i?(t.addNodeCode(`vec3 reflectVec = ${O};`),o="reflectVec"):o=O;break;case ReflectNode.CUBE:O="vec3( -"+(A=new ReflectNode(ReflectNode.VECTOR).build(t,"v3"))+".x, "+A+".yz )",i?(t.addNodeCode(`vec3 reflectCubeVec = ${O};`),o="reflectCubeVec"):o=O;break;case ReflectNode.SPHERE:var A;O="normalize( ( viewMatrix * vec4( "+(A=new ReflectNode(ReflectNode.VECTOR).build(t,"v3"))+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5",i?(t.addNodeCode(`vec2 reflectSphereVec = ${O};`),o="reflectSphereVec"):o=O}return t.format(o,this.getType(t),n)}return console.warn("THREE.ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,n)},ReflectNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).scope=this.scope),n}},function(t,n,i){"use strict";i.d(n,"b",(function(){return _})),i.d(n,"a",(function(){return S}));var o=i(1),a=1,s=Promise.resolve(),m={};function findAndClearHandle(t){return t in m&&(delete m[t],!0)}var g=function(t){function AsapAction(n,i){var o=t.call(this,n,i)||this;return o.scheduler=n,o.work=i,o}return o.a(AsapAction,t),AsapAction.prototype.requestAsyncId=function(n,i,o){return void 0===o&&(o=0),null!==o&&o>0?t.prototype.requestAsyncId.call(this,n,i,o):(n.actions.push(this),n.scheduled||(n.scheduled=(g=n.flush.bind(n,null),_=a++,m[_]=!0,s.then((function(){return findAndClearHandle(_)&&g()})),_)));var g,_},AsapAction.prototype.recycleAsyncId=function(n,i,o){if(void 0===o&&(o=0),null!==o&&o>0||null===o&&this.delay>0)return t.prototype.recycleAsyncId.call(this,n,i,o);0===n.actions.length&&(findAndClearHandle(i),n.scheduled=void 0)},AsapAction}(i(68).a),_=new(function(t){function AsapScheduler(){return null!==t&&t.apply(this,arguments)||this}return o.a(AsapScheduler,t),AsapScheduler.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var n,i=this.actions,o=-1,a=i.length;t=t||i.shift();do{if(n=t.execute(t.state,t.delay))break}while(++o<a&&(t=i.shift()));if(this.active=!1,n){for(;++o<a&&(t=i.shift());)t.unsubscribe();throw n}},AsapScheduler}(i(65).a))(g),S=_},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=function(){function UnsubscriptionErrorImpl(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,n){return n+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return UnsubscriptionErrorImpl.prototype=Object.create(Error.prototype),UnsubscriptionErrorImpl}()},function(t,n){n.endianness=function(){return"LE"},n.hostname=function(){return"undefined"!=typeof location?location.hostname:""},n.loadavg=function(){return[]},n.uptime=function(){return 0},n.freemem=function(){return Number.MAX_VALUE},n.totalmem=function(){return Number.MAX_VALUE},n.cpus=function(){return[]},n.type=function(){return"Browser"},n.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},n.networkInterfaces=n.getNetworkInterfaces=function(){return{}},n.arch=function(){return"javascript"},n.platform=function(){return"browser"},n.tmpdir=n.tmpDir=function(){return"/tmp"},n.EOL="\n",n.homedir=function(){return"/"}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isAsyncIterable=n.isAsyncGenerator=n.isAsync=void 0;var o=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(i(384));function isAsync(t){return"AsyncFunction"===t[Symbol.toStringTag]}n.default=function wrapAsync(t){if("function"!=typeof t)throw new Error("expected a function");return isAsync(t)?(0,o.default)(t):t},n.isAsync=isAsync,n.isAsyncGenerator=function isAsyncGenerator(t){return"AsyncGenerator"===t[Symbol.toStringTag]},n.isAsyncIterable=function isAsyncIterable(t){return"function"==typeof t[Symbol.asyncIterator]}},function(t,n,i){"use strict";var o={};function createErrorType(t,n,i){i||(i=Error);var a=function(t){function NodeError(i,o,a){return t.call(this,function getMessage(t,i,o){return"string"==typeof n?n:n(t,i,o)}(i,o,a))||this}return function _inheritsLoose(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}(NodeError,t),NodeError}(i);a.prototype.name=i.name,a.prototype.code=t,o[t]=a}function oneOf(t,n){if(Array.isArray(t)){var i=t.length;return t=t.map((function(t){return String(t)})),i>2?"one of ".concat(n," ").concat(t.slice(0,i-1).join(", "),", or ")+t[i-1]:2===i?"one of ".concat(n," ").concat(t[0]," or ").concat(t[1]):"of ".concat(n," ").concat(t[0])}return"of ".concat(n," ").concat(String(t))}createErrorType("ERR_INVALID_OPT_VALUE",(function(t,n){return'The value "'+n+'" is invalid for option "'+t+'"'}),TypeError),createErrorType("ERR_INVALID_ARG_TYPE",(function(t,n,i){var o,a;if("string"==typeof n&&function startsWith(t,n,i){return t.substr(!i||i<0?0:+i,n.length)===n}(n,"not ")?(o="must not be",n=n.replace(/^not /,"")):o="must be",function endsWith(t,n,i){return(void 0===i||i>t.length)&&(i=t.length),t.substring(i-n.length,i)===n}(t," argument"))a="The ".concat(t," ").concat(o," ").concat(oneOf(n,"type"));else{var s=function includes(t,n,i){return"number"!=typeof i&&(i=0),!(i+n.length>t.length)&&-1!==t.indexOf(n,i)}(t,".")?"property":"argument";a='The "'.concat(t,'" ').concat(s," ").concat(o," ").concat(oneOf(n,"type"))}return a+". Received type ".concat(typeof i)}),TypeError),createErrorType("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),createErrorType("ERR_METHOD_NOT_IMPLEMENTED",(function(t){return"The "+t+" method is not implemented"})),createErrorType("ERR_STREAM_PREMATURE_CLOSE","Premature close"),createErrorType("ERR_STREAM_DESTROYED",(function(t){return"Cannot call "+t+" after a stream was destroyed"})),createErrorType("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),createErrorType("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end"),createErrorType("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),createErrorType("ERR_UNKNOWN_ENCODING",(function(t){return"Unknown encoding: "+t}),TypeError),createErrorType("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=o},function(t,n,i){"use strict";(function(n){var o=Object.keys||function(t){var n=[];for(var i in t)n.push(i);return n};t.exports=Duplex;var a=i(233),s=i(237);i(45)(Duplex,a);for(var m=o(s.prototype),g=0;g<m.length;g++){var _=m[g];Duplex.prototype[_]||(Duplex.prototype[_]=s.prototype[_])}function Duplex(t){if(!(this instanceof Duplex))return new Duplex(t);a.call(this,t),s.call(this,t),this.allowHalfOpen=!0,t&&(!1===t.readable&&(this.readable=!1),!1===t.writable&&(this.writable=!1),!1===t.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",onend)))}function onend(){this._writableState.ended||n.nextTick(onEndNT,this)}function onEndNT(t){t.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function get(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"writableBuffer",{enumerable:!1,get:function get(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Duplex.prototype,"writableLength",{enumerable:!1,get:function get(){return this._writableState.length}}),Object.defineProperty(Duplex.prototype,"destroyed",{enumerable:!1,get:function get(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function set(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}})}).call(this,i(25))},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DeviceUtils=void 0;var o=i(256);!function(t){function isIOS(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}function isTablet(){var t=window.navigator.userAgent||window.navigator.vendor||window.opera;return/ipad|Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(t)}function isR7(){var t=window.navigator.userAgent||window.navigator.vendor||window.opera;return/R7 Build/.test(t)}t.IphoneUtils=o.IphoneUtils,t.IsGearVR=function IsGearVR(){return/SamsungBrowser.+Mobile VR/i.test(window.navigator.userAgent)},t.IsMobile=function IsMobile(){var t=window.navigator.userAgent||window.navigator.vendor||window.opera;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))||!!(isIOS()||isTablet()||isR7())||void 0},t.isIpad=function isIpad(){return/iPad/.test(window.navigator.platform)},t.isIOS=isIOS,t.isMacOS=function isMacOS(){return/macintel/i.test(window.navigator.platform)},t.isTablet=isTablet,t.isR7=isR7,t.IsOculusBrowser=function IsOculusBrowser(){var t=window.navigator.userAgent||window.navigator.vendor||window.opera;return/OculusBrowser/.test(t)},t.getPageLoadTime=function getPageLoadTime(){var t=window.performance.timing;return(t.loadEventEnd-t.navigationStart)/1e3},t.getMemoryInfo=function getMemoryInfo(){var t=window.performance.memory;return t?{size:t.usedJSHeapSize/1048576,limit:t.jsHeapSizeLimit/1048576}:t},t.isWebGLAvailable=function isWebGLAvailable(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},t.isWebAssemblySupported=function isWebAssemblySupported(){try{if("object"==typeof window.WebAssembly&&"function"==typeof window.WebAssembly.instantiate){var t=new window.WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof window.WebAssembly.Module)return new window.WebAssembly.Instance(t)instanceof window.WebAssembly.Instance}}catch(t){}return!1}}(n.DeviceUtils||(n.DeviceUtils={}))},function(t,n,i){"use strict";t.exports=function(t){var n=[];return n.toString=function toString(){return this.map((function(n){var i=function cssWithMappingToString(t,n){var i=t[1]||"",o=t[3];if(!o)return i;if(n&&"function"==typeof btoa){var a=function toComment(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(o),s=o.sources.map((function(t){return"/*# sourceURL="+o.sourceRoot+t+" */"}));return[i].concat(s).concat([a]).join("\n")}return[i].join("\n")}(n,t);return n[2]?"@media "+n[2]+"{"+i+"}":i})).join("")},n.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var o={},a=0;a<this.length;a++){var s=this[a][0];null!=s&&(o[s]=!0)}for(a=0;a<t.length;a++){var m=t[a];null!=m[0]&&o[m[0]]||(i&&!m[2]?m[2]=i:i&&(m[2]="("+m[2]+") and ("+i+")"),n.push(m))}},n}},function(t,n,i){var o,a,s={},m=(o=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===a&&(a=o.apply(this,arguments)),a}),getTarget=function(t,n){return n?n.querySelector(t):document.querySelector(t)},g=function(t){var n={};return function(t,i){if("function"==typeof t)return t();if(void 0===n[t]){var o=getTarget.call(this,t,i);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(t){o=null}n[t]=o}return n[t]}}(),_=null,S=0,M=[],T=i(445);function addStylesToDom(t,n){for(var i=0;i<t.length;i++){var o=t[i],a=s[o.id];if(a){a.refs++;for(var m=0;m<a.parts.length;m++)a.parts[m](o.parts[m]);for(;m<o.parts.length;m++)a.parts.push(addStyle(o.parts[m],n))}else{var g=[];for(m=0;m<o.parts.length;m++)g.push(addStyle(o.parts[m],n));s[o.id]={id:o.id,refs:1,parts:g}}}}function listToStyles(t,n){for(var i=[],o={},a=0;a<t.length;a++){var s=t[a],m=n.base?s[0]+n.base:s[0],g={css:s[1],media:s[2],sourceMap:s[3]};o[m]?o[m].parts.push(g):i.push(o[m]={id:m,parts:[g]})}return i}function insertStyleElement(t,n){var i=g(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var o=M[M.length-1];if("top"===t.insertAt)o?o.nextSibling?i.insertBefore(n,o.nextSibling):i.appendChild(n):i.insertBefore(n,i.firstChild),M.push(n);else if("bottom"===t.insertAt)i.appendChild(n);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var a=g(t.insertAt.before,i);i.insertBefore(n,a)}}function removeStyleElement(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var n=M.indexOf(t);n>=0&&M.splice(n,1)}function createStyleElement(t){var n=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var o=function getNonce(){return i.nc}();o&&(t.attrs.nonce=o)}return addAttrs(n,t.attrs),insertStyleElement(t,n),n}function addAttrs(t,n){Object.keys(n).forEach((function(i){t.setAttribute(i,n[i])}))}function addStyle(t,n){var i,o,a,s;if(n.transform&&t.css){if(!(s="function"==typeof n.transform?n.transform(t.css):n.transform.default(t.css)))return function(){};t.css=s}if(n.singleton){var m=S++;i=_||(_=createStyleElement(n)),o=applyToSingletonTag.bind(null,i,m,!1),a=applyToSingletonTag.bind(null,i,m,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function createLinkElement(t){var n=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",addAttrs(n,t.attrs),insertStyleElement(t,n),n}(n),o=updateLink.bind(null,i,n),a=function(){removeStyleElement(i),i.href&&URL.revokeObjectURL(i.href)}):(i=createStyleElement(n),o=applyToTag.bind(null,i),a=function(){removeStyleElement(i)});return o(t),function updateStyle(n){if(n){if(n.css===t.css&&n.media===t.media&&n.sourceMap===t.sourceMap)return;o(t=n)}else a()}}t.exports=function(t,n){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(n=n||{}).attrs="object"==typeof n.attrs?n.attrs:{},n.singleton||"boolean"==typeof n.singleton||(n.singleton=m()),n.insertInto||(n.insertInto="head"),n.insertAt||(n.insertAt="bottom");var i=listToStyles(t,n);return addStylesToDom(i,n),function update(t){for(var o=[],a=0;a<i.length;a++){var m=i[a];(g=s[m.id]).refs--,o.push(g)}for(t&&addStylesToDom(listToStyles(t,n),n),a=0;a<o.length;a++){var g;if(0===(g=o[a]).refs){for(var _=0;_<g.parts.length;_++)g.parts[_]();delete s[g.id]}}}};var O,A=(O=[],function(t,n){return O[t]=n,O.filter(Boolean).join("\n")});function applyToSingletonTag(t,n,i,o){var a=i?"":o.css;if(t.styleSheet)t.styleSheet.cssText=A(n,a);else{var s=document.createTextNode(a),m=t.childNodes;m[n]&&t.removeChild(m[n]),m.length?t.insertBefore(s,m[n]):t.appendChild(s)}}function applyToTag(t,n){var i=n.css,o=n.media;if(o&&t.setAttribute("media",o),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function updateLink(t,n,i){var o=i.css,a=i.sourceMap,s=void 0===n.convertToAbsoluteUrls&&a;(n.convertToAbsoluteUrls||s)&&(o=T(o)),a&&(o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var m=new Blob([o],{type:"text/css"}),g=t.href;t.href=URL.createObjectURL(m),g&&URL.revokeObjectURL(g)}},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.OrbitControlsOptions=n.OrbitBasedCameraControls=void 0;var g=i(136),_=i(18),S=i(10),M=i(17),T=i(452),O=i(56),A=function(t){function OrbitBasedCameraControls(n,i){void 0===i&&(i=new P);var o=t.call(this,n)||this;return o.rotateSpeed=-.25,o.target={x:0,y:0,z:-1e-4},o.autoRotateThreshold=2e4,o.didSwipeDisableGyro=!1,o.orbitOptions=i,o}return a(OrbitBasedCameraControls,t),OrbitBasedCameraControls.prototype.init=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this,n)];case 1:return i.sent(),this.orbitControls=new T.OrbitControls(this.camera,this.appManager.currentExperience.cssRenderer.domElement,this.appManager.currentExperience.getCustomAttribute(O.Core.CustomAttributes.EnableContextMenu)),this._updateOrbitControls(),[2]}}))}))},OrbitBasedCameraControls.prototype.addListeners=function(){var n=this;t.prototype.addListeners.call(this),this.subscribtions.push(this.appManager.eventManager.pipe(_.filter((function(t){return t.eventType.name===(new S.MouseDownEvent).name||t.eventType===S.MouseDownEvent||t.eventType.name===(new S.MouseWheelEvent).name||t.eventType===S.MouseWheelEvent||t.eventType.name===(new S.PinchEvent).name||t.eventType===S.PinchEvent}))).subscribe((function(t){n.orbitOptions&&n.orbitOptions.auto_rotate&&n.handleAutoRotate(),n.gyroManager&&n.gyroEnabled&&(n.disableGyro(),n.didSwipeDisableGyro=!0)}))),this.subscribtions.push(this.appManager.eventManager.pipe(_.filter((function(t){return t.eventType.name===(new S.MouseUpEvent).name||t.eventType===S.MouseUpEvent||t.eventType.name===(new S.LongTouchEndedEvent).name||t.eventType===S.LongTouchEndedEvent||t.eventType.name===(new S.TouchEvent).name||t.eventType===S.TouchEvent}))).subscribe((function(t){n.gyroManager&&!n.gyroEnabled&&n.didSwipeDisableGyro&&(n.resetGyro(!0),n.enableGyro()),n.didSwipeDisableGyro=!1})))},OrbitBasedCameraControls.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.orbitControls&&this.orbitControls.removeEventListener&&this.orbitControls.removeEventListener("change",this.onCameraMoveFunc),this.stopAutoRotateTimer()},OrbitBasedCameraControls.prototype.handleAutoRotate=function(t){void 0===t&&(t=this.autoRotateThreshold),this.orbitControls.autoRotate=!1,this.stopAutoRotateTimer();var n=this;this.autoRotateTimer=window.setTimeout((function(){n.orbitControls.autoRotate=!0}),t)},OrbitBasedCameraControls.prototype.stopAutoRotateTimer=function(){this.autoRotateTimer&&clearTimeout(this.autoRotateTimer)},OrbitBasedCameraControls.prototype._updateOrbitControls=function(){var t=this;!function updateOrbitControls(){t.orbitControls&&t.orbitControls.update(),requestAnimationFrame(updateOrbitControls)}()},OrbitBasedCameraControls.prototype.enable=function(){this.orbitOptions&&this.orbitOptions.auto_rotate&&this.handleAutoRotate(),this.enabled||(t.prototype.enable.call(this),this.orbitControls&&this.orbitControls.addEventListener("change",this.onCameraMoveFunc),this.orbitControls.enabled=!0,this.orbitControls.rotateSpeed=this.rotateSpeed)},OrbitBasedCameraControls.prototype.disableGyro=function(){var n=M.Utils.getLookAtVector(this.camera);this.orbitControls.target.set(n.x,n.y,n.z),this.target=n,t.prototype.disableGyro.call(this),this.orbitControls.enabled=!0},OrbitBasedCameraControls.prototype.enableGyro=function(){t.prototype.enableGyro.call(this),this.orbitControls.enabled=!1},OrbitBasedCameraControls.prototype.disable=function(){this.enabled&&(t.prototype.disable.call(this),this.orbitControls.enabled=!1,this.orbitControls.rotateSpeed=0,this.stopAutoRotateTimer())},OrbitBasedCameraControls.prototype.destroy=function(){t.prototype.destroy.call(this)},OrbitBasedCameraControls.prototype.setCameraHeight=function(n,i){return s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.setCameraHeight.call(this,n,i)];case 1:return o.sent(),[2]}}))}))},OrbitBasedCameraControls.prototype.animateCamera=function(n,i,o,a,g,_){return void 0===a&&(a=0),s(this,void 0,void 0,(function(){return m(this,(function(s){switch(s.label){case 0:return[4,t.prototype.animateCamera.call(this,n,i,o,a,g,_)];case 1:return s.sent(),[2]}}))}))},OrbitBasedCameraControls}(g.CameraControlsImpl);n.OrbitBasedCameraControls=A;var P=function OrbitControlsOptions(){this.max_distance=1/0,this.min_distance=0,this.max_polar_angle=Math.PI,this.min_polar_angle=0,this.max_azimuth_angle=1/0,this.min_azimuth_angle=-1/0,this.max_zoom=1/0,this.min_zoom=0,this.max_y=1/0,this.min_y=-1/0,this.auto_rotate=!1,this.auto_rotate_speed=.2,this.enable_pan="false",this.fps=60};n.OrbitControlsOptions=P},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RxUtils=n.Utils=n.RGBA=n.Notify=n.Networking=n.ModelsUtils=n.MediaUtils=n.Logger=n.JsZipUtils=n.JsUtils=n.IphoneUtils=n.InjectModule=n.ImageOptimizeService=n.Image=n.GyroscopeManager=n.DeviceUtils=n.Debug=n.CameraUtils=n.ARUtils=n.XR=n.WinstonTranports=n.Video=n.SocialConnectors=n.ScreenShot=n.MaterialUtils=n.GifUtils=n.Exporters=n.GoogleAnalytics=void 0;var o=i(454);Object.defineProperty(n,"GoogleAnalytics",{enumerable:!0,get:function(){return o.GoogleAnalytics}});var a=i(211);n.Exporters=a;var s=i(257);n.GifUtils=s;var m=i(262);Object.defineProperty(n,"MaterialUtils",{enumerable:!0,get:function(){return m.MaterialUtils}});var g=i(455);n.ScreenShot=g;var _=i(456);n.SocialConnectors=_;var S=i(147);n.Video=S;var M=i(467);n.WinstonTranports=M;var T=i(468);n.XR=T;var O=i(269);Object.defineProperty(n,"ARUtils",{enumerable:!0,get:function(){return O.ARUtils}});var A=i(470);Object.defineProperty(n,"CameraUtils",{enumerable:!0,get:function(){return A.CameraUtils}});var P=i(270);Object.defineProperty(n,"Debug",{enumerable:!0,get:function(){return P.Debug}});var L=i(95);Object.defineProperty(n,"DeviceUtils",{enumerable:!0,get:function(){return L.DeviceUtils}});var R=i(145);n.GyroscopeManager=R;var N=i(77);n.Image=N;var I=i(259);Object.defineProperty(n,"ImageOptimizeService",{enumerable:!0,get:function(){return I.ImageOptimizeService}});var j=i(271);Object.defineProperty(n,"InjectModule",{enumerable:!0,get:function(){return j.InjectModule}});var V=i(256);Object.defineProperty(n,"IphoneUtils",{enumerable:!0,get:function(){return V.IphoneUtils}});var U=i(73);Object.defineProperty(n,"JsUtils",{enumerable:!0,get:function(){return U.JsUtils}});var G=i(272);Object.defineProperty(n,"JsZipUtils",{enumerable:!0,get:function(){return G.JsZipUtils}});var z=i(50);n.Logger=z;var H=i(188);Object.defineProperty(n,"MediaUtils",{enumerable:!0,get:function(){return H.MediaUtils}});var q=i(149);Object.defineProperty(n,"ModelsUtils",{enumerable:!0,get:function(){return q.ModelsUtils}});var Z=i(142);Object.defineProperty(n,"Networking",{enumerable:!0,get:function(){return Z.Networking}});var X=i(144);Object.defineProperty(n,"Notify",{enumerable:!0,get:function(){return X.Notify}});var Q=i(476);Object.defineProperty(n,"RGBA",{enumerable:!0,get:function(){return Q.RGBA}});var Y=i(17);Object.defineProperty(n,"Utils",{enumerable:!0,get:function(){return Y.Utils}});var J=i(477);n.RxUtils=J},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ByondBaseElement=void 0;var g=i(0),_=i(18),S=i(32),M=i(191),T=i(34),O=i(10),A=i(22),P=i(271),L=i(142),R=i(36),N=i(17),I=i(143),j=function(){function ActionDescriptor(t,n){this.appManager=t,this.element=n}return ActionDescriptor.prototype.execute=function(t){},ActionDescriptor}(),V=function(t){function TouchExecutable(){return null!==t&&t.apply(this,arguments)||this}return a(TouchExecutable,t),TouchExecutable.prototype.execute=function(t){this.appManager.eventManager.next(new T.EventMessage(this.element,new O.TouchEvent,t.Hit))},TouchExecutable}(j),U=function(t){function LongTouchExecutable(){return null!==t&&t.apply(this,arguments)||this}return a(LongTouchExecutable,t),LongTouchExecutable.prototype.execute=function(t){this.appManager.eventManager.next(new T.EventMessage(this.element,new O.LongTouchEvent,t.Hit))},LongTouchExecutable}(j),G=function(t){function LongTouchEndedExecutable(){return null!==t&&t.apply(this,arguments)||this}return a(LongTouchEndedExecutable,t),LongTouchEndedExecutable.prototype.execute=function(t){this.appManager.eventManager.next(new T.EventMessage(this.element,new O.LongTouchEndedEvent,t.Hit))},LongTouchEndedExecutable}(j),z=function(t){function DoubleClickExecutable(){return null!==t&&t.apply(this,arguments)||this}return a(DoubleClickExecutable,t),DoubleClickExecutable.prototype.execute=function(t){this.appManager.eventManager.next(new T.EventMessage(this.element,new O.MouseDoubleClickEvent,t.Hit))},DoubleClickExecutable}(j),H=function(t){function RightClickExecutable(){return null!==t&&t.apply(this,arguments)||this}return a(RightClickExecutable,t),RightClickExecutable.prototype.execute=function(t){this.appManager.eventManager.next(new T.EventMessage(this.element,new O.RightClickEvent,t.Hit))},RightClickExecutable}(j),q=function(t){function FocusExecutable(){return null!==t&&t.apply(this,arguments)||this}return a(FocusExecutable,t),FocusExecutable.prototype.execute=function(t){this.appManager.eventManager.next(new T.EventMessage(this.element,new O.FocusEvent,t.Hit))},FocusExecutable}(j),Z=function(t){function UnfocusExecutable(){return null!==t&&t.apply(this,arguments)||this}return a(UnfocusExecutable,t),UnfocusExecutable.prototype.execute=function(){this.appManager.eventManager.next(new T.EventMessage(this.element,new O.UnfocusEvent))},UnfocusExecutable}(j),X=function(){function ByondBaseElement(t,n,i){this.id=null,this.destroyed=!1,this.visible=!1,this.enabled=!1,this.state=new O.UninitializedEvent,this.componentList=[],this.effects=new Array,this.subscriptions=Array(),this.editorUuid=I.v1(),this.childElements=[],this.metadata=t,this.id=i,this.parent=n,this.appManager=n?n.appManager:null,this.interactable=new M.InteractableImpl(this),this.interactable.interactableActions.Add(M.TouchActionDescriptor.typeName,new V(this.appManager,this)),this.interactable.interactableActions.Add(M.RightClickActionDescriptor.typeName,new H(this.appManager,this)),this.interactable.interactableActions.Add(M.LongTouchActionDescriptor.typeName,new U(this.appManager,this)),this.interactable.interactableActions.Add(M.LongTouchEndedActionDescriptor.typeName,new G(this.appManager,this)),this.interactable.interactableActions.Add(M.DoubleClickActionDescriptor.typeName,new z(this.appManager,this)),this.interactable.interactableActions.Add(M.FocusActionDescriptor.typeName,new q(this.appManager,this)),this.interactable.interactableActions.Add(M.UnfocusActionDescriptor.typeName,new Z(this.appManager,this))}return ByondBaseElement.prototype.init=function(t){return s(this,void 0,void 0,(function(){var t,n=this;return m(this,(function(i){switch(i.label){case 0:return this.subscriptions.push(this.appManager.eventManager.pipe(_.filter((function(t){return t.eventType.name===(new O.ZoneChangeEndedEvent).name||t.eventType===O.ZoneChangeEndedEvent}))).subscribe((function(t){n.ofterZoneLoaded()}))),this.subscriptions.push(this.appManager.editorEventManager.pipe(_.filter((function(t){return n.metadata&&t.originId&&t.originId===n.metadata.byond_id&&!t.editStart}))).subscribe((function(t){return s(n,void 0,void 0,(function(){return m(this,(function(n){return this.HandleEditorEventEnded(t),[2]}))}))}))),this.subscriptions.push(this.appManager.editorEventManager.pipe(_.filter((function(t){return n.metadata&&t.originId&&t.originId===n.metadata.byond_id&&t.editStart}))).subscribe((function(t){return s(n,void 0,void 0,(function(){return m(this,(function(n){return this.HandleEditorEventStarted(t),[2]}))}))}))),this.setState(new O.LoadingEvent),this.obj||(this.obj=new g.Group),this.obj.name=this.GetElementName(),this.parent&&this.parent!==this.appManager?this.parent.obj.add(this.obj):this.parent===this.appManager&&this.appManager.currentExperience.scene.add(this.obj),this.getCustomAttribute("$$connector_config")?[4,this.DownloadCustomAttributes(this.getCustomAttribute("$$connector_config"))]:[3,2];case 1:t=i.sent(),this.metadata.custom_attributes&&(this.metadata.custom_attributes=new Array),t&&t.forEach((function(t){n.getCustomAttribute(t.key)||n.metadata.custom_attributes.push(t)})),i.label=2;case 2:return[4,this.handleDependencies()];case 3:return i.sent(),[2]}}))}))},ByondBaseElement.prototype.HandleEditorEventStarted=function(t){switch(t.type){case"delete":this.parent&&this.parent.onChildDeleted(this),this.destroy()}},ByondBaseElement.prototype.HandleEditorEventEnded=function(t){switch(t.type){case"create":t.value&&t.value.metadata&&(t.value.metadata.byond_id&&this.appManager.historyManager.historyEventManager.next({originId:t.value.metadata.byond_id,historyMode:t.actionType?t.actionType:"action",type:"delete"}),this.createChildElement(t.value.metadata))}},ByondBaseElement.prototype.createChildElement=function(t){return s(this,void 0,void 0,(function(){var n,i;return m(this,(function(o){switch(o.label){case 0:return t.position&&(t.rotation?(t.rotation.y=0,t.rotation.x=0):t.rotation=new g.Euler(0,0,0),(n=this.obj.worldToLocal(t.position)).z=0,t.position=n),[4,this.appManager.elementsRegistry.GetElement(t,this)];case 1:return(i=o.sent()).length?(this.childElements.push(i[0]),[2]):[2]}}))}))},ByondBaseElement.prototype.ofterZoneLoaded=function(){this.setCustomParent()},ByondBaseElement.prototype.setCustomParent=function(){var t,n=this.getCustomAttribute(A.CustomAttributes.Parent);if(n)if(n===A.CustomAttributes.Values.CustomParent.Camera)t=this.appManager.cameraControlsRegistry.cameraControls.camera;else{var i=N.Utils.getItemById(this.appManager,n);i&&(t=i.obj)}t&&t.add(this.obj)},ByondBaseElement.prototype.activate=function(t){this===t.interactable.obj?t.interactable.interactableActions.Contains(t)&&t.interactable.interactableActions.Execute(t):this.activateChildElementHandler(t)},ByondBaseElement.prototype.activateChildElementHandler=function(t){if(0!==t.handlers.length){var n=t.handlers[0];t.handlers.shift(),n.activate(t)}},ByondBaseElement.prototype.onChildDeleted=function(t){var n=this.getMetadata();for(var i in n)n.hasOwnProperty(i)&&Array.isArray(n[i])&&(n[i]=n[i].filter((function(n){var i=n instanceof S.Metadata.BaseElementMetadata,o=n.byond_id===t.getMetadata().byond_id;return!(i&&o)})))},ByondBaseElement.prototype.onChildDestroyed=function(t){this.childElements=this.childElements.filter((function(n){return n!==t}))},ByondBaseElement.prototype.destroy=function(){var t=this;this.subscriptions.forEach((function(t){t&&t.unsubscribe()})),this.subscriptions=[],this.componentList.forEach((function(t){t&&t.destroy()})),this.componentList=[],this.setEnabled(!1),this.obj&&this.obj.parent&&this.obj.parent.remove(this.obj),this.parent&&this.parent.onChildDestroyed(this),this.parent=void 0,this.metadata=void 0,this.interactable&&this.interactable.dispose(),this.interactable=void 0,this.effects.forEach((function(t){t.destroy()})),this.effects=[],this.childElements.forEach((function(n){t.destroyed||n.destroy()})),this.destroyed=!0},ByondBaseElement.prototype.getMetadata=function(){return this.metadata},ByondBaseElement.prototype.setState=function(t){t!==this.state&&(this.state=t,this.appManager.eventManager.next(new T.EventMessage(this,t),!0))},Object.defineProperty(ByondBaseElement.prototype,"isEnabled",{get:function(){return this.enabled},enumerable:!1,configurable:!0}),ByondBaseElement.prototype.setEnabled=function(t){this.enabled=t},ByondBaseElement.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(n){return this.visible=t,[2]}))}))},Object.defineProperty(ByondBaseElement.prototype,"isVisible",{get:function(){return this.visible},enumerable:!1,configurable:!0}),ByondBaseElement.prototype.Id=function(){return this.id},ByondBaseElement.prototype.handleDependencies=function(){return s(this,void 0,void 0,(function(){var t,n,i=this;return m(this,(function(o){switch(o.label){case 0:return(t=this.getCustomAttribute(A.CustomAttributes.Dependencies))?(t=Array.isArray(t)?t:[t],n=[],t.forEach((function(t){n.push(i.injectAndResolveModule(t))})),[4,Promise.all(n)]):[2];case 1:return o.sent(),[2]}}))}))},ByondBaseElement.prototype.injectAndResolveModule=function(t){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return[4,P.InjectModule(t)];case 1:return(n=i.sent())&&n.init?(console.log(n),[4,n.init(this.appManager,this)]):[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},ByondBaseElement.prototype.getCustomAttribute=function(t,n){void 0===n&&(n=!1);var i=this.getMetadata();if(i&&i.custom_attributes){var o=i.custom_attributes.map((function(n){if(n.key===t)return n.value}));if(o=o.filter((function(t){return!!t||!1===t||0===t})),this.parent&&o&&o[0]&&"string"==typeof o[0]){if(A.CustomAttributes.PlcaHolderAttribut.test(o[0])){var a=A.CustomAttributes.PlcaHolderAttribut.exec(o[0]);a&&a[1]&&(o[0]=this.parent.getCustomAttribute(a[1],!0))}}else n&&this.parent&&!o[0]&&(o[0]=this.parent.getCustomAttribute(t,!0));return o[0]}},ByondBaseElement.prototype.addCustomAttribute=function(t,n){var i=this.getMetadata();if(i&&i.custom_attributes){var o=i.custom_attributes,a=o.map((function(n){if(n.key===t)return n}));(a=a.filter((function(t){return!!t})))&&a[0]?a[0].value=n:o.push({key:t,value:n})}},ByondBaseElement.prototype.DownloadCustomAttributes=function(t){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,L.Networking.get(t)];case 1:return(n=i.sent())&&Array.isArray(n)?[2,n.map((function(t){return R.deserialize(S.Metadata.CustomAttributesMetadata,t)}))]:[3,3];case 2:return i.sent(),[3,3];case 3:return[2]}}))}))},ByondBaseElement.prototype.attachElement=function(t){return this.componentList.push(t),t},ByondBaseElement.prototype.detachElement=function(t){var n=this.componentList.findIndex((function(n){return n===t}));n>-1&&this.componentList.splice(n,1)},ByondBaseElement.prototype.addEditorItems=function(){var t=this;this.appManager.currentExperience.editor.addBooleanMenuItem(this.constructor.name,this.editorUuid,this.obj,"visible",(function(t){})),this.effects.forEach((function(n){n.addEditorItems(t.constructor.name,t.editorUuid)}))},ByondBaseElement.prototype.GetElementName=function(){var t=this.constructor.name;return this.metadata&&this.metadata.title&&(t+="_"+this.metadata.title),this.metadata&&this.metadata.byond_id&&(t+="_"+this.metadata.byond_id),t},ByondBaseElement}();n.ByondBaseElement=X},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenImpl=void 0;var g=i(0),_=i(71),S=i(77),M=i(17),T=i(46),O=i(10),A=i(83),P=i(18),L=i(50),R=i(22),N=["photo","video","open_url"],I=function(t){function ScreenImpl(n,i,o){var a=t.call(this,n,i,o)||this;a.material=new g.MeshPhongMaterial({transparent:!0,alphaTest:0}),a.triggerAnimTime=1,a.fovAnimations=[],a.stopPreviewProgressiveImageLoading=!1;var s=a.appManager.eventManager.pipe(P.filter((function(t){return t.origin===a&&(t.eventType.name===(new O.FocusEvent).name||t.eventType===O.FocusEvent)}))).subscribe((function(t){a.isActive||a.onHover()}));a.subscriptions.push(s);var m=a.appManager.eventManager.pipe(P.filter((function(t){return t.origin===a&&(t.eventType.name===(new O.UnfocusEvent).name||t.eventType===O.UnfocusEvent)}))).subscribe((function(t){a.isActive||a.onUnHover()}));a.subscriptions.push(m);var _=a,S=a.appManager.eventManager.pipe(P.filter((function(t){return t.origin===a&&(t.eventType.name===(new O.TouchEvent).name||t.eventType===O.TouchEvent)}))).subscribe((function(t){if(!a.isActive){a.onUnHover(),a.activateElement(_);var n=a.appManager.currentExperience.getCustomAttribute(R.CustomAttributes.GTAG);if(a.getMetadata().type&&N.includes(a.getMetadata().type)&&n){var i="",o="";switch(a.getMetadata().type){case"photo":i="open_image",o=a.getMetadata().picture;break;case"video":i="open_video",o=a.getMetadata().source;break;case"open_url":i="open_url",o=a.getMetadata().open_url}a.appManager.eventManager.next({origin:a,eventType:new O.AnalyticsSendActionEvent,message:{action:i,category:a.getMetadata().ElementName+"_"+a.getMetadata().byond_id,label:o,gtag:n}})}}var s=_.getCustomAttribute(R.CustomAttributes.CameraLookAt),m=_.getCustomAttribute(R.CustomAttributes.CameraLookAtTime);s&&_.appManager.currentExperience.setCameraLookAt(s,m||0===m?+m:.5)}));a.subscriptions.push(S);var M=a.appManager.eventManager.pipe(P.filter((function(t){return!(null!==t.origin&&t.origin===a||t.eventType.name!==(new O.TouchEvent).name&&t.eventType!==O.TouchEvent)}))).subscribe((function(t){a.isActive&&a.deactivateElement()}));a.subscriptions.push(M);var T=a.appManager.eventManager.pipe(P.filter((function(t){return t.origin===a&&(t.eventType.name===(new O.LongTouchEvent).name||t.eventType===O.LongTouchEvent)}))).subscribe((function(t){L.Log.Info("longPress")}));a.subscriptions.push(T);var A=a.appManager.eventManager.pipe(P.filter((function(t){return t.origin===a&&(t.eventType.name===(new O.MouseDoubleClickEvent).name||t.eventType===O.MouseDoubleClickEvent)}))).subscribe((function(t){L.Log.Info("dd click")}));return a.subscriptions.push(A),a}return a(ScreenImpl,t),Object.defineProperty(ScreenImpl.prototype,"Title",{get:function(){return this.title},set:function(t){this.title=t},enumerable:!1,configurable:!0}),ScreenImpl.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),this.obj.visible=this.isVisible,[4,this.loadPreviewImage()];case 2:return n.sent(),[2]}}))}))},ScreenImpl.prototype.getProxyImageUrl=function(t,n){var i=n.url;return n.parameters&&n.parameters.forEach((function(n){i="##url"===n.value?i.replace(n.key,t):i.replace(n.key,n.value)})),i},ScreenImpl.prototype.loadPreviewImage=function(t,n){return void 0===n&&(n=!1),s(this,void 0,void 0,(function(){var i,o,a,s,_,S=this;return m(this,(function(m){switch(m.label){case 0:return this.stopPreviewProgressiveImageLoading=!1,(i=this.getPreviewImage())&&i.startsWith("#")?(this.material.color=new g.Color(i),this.geometry=new g.PlaneBufferGeometry(3.3,3.3),this.obj.geometry=this.geometry,this.material.map=null,this.setState(new O.LoadedEvent),[2]):(o=this.getCustomAttribute(R.CustomAttributes.ProgressiveLoading),a=o&&"proxy"===o.type?o.preview.map((function(t){return S.getProxyImageUrl(i,t)})):o&&o.preview?o.preview:[i],n&&(a=[a[a.length-1]]),s=a[0],[4,this.loadImage(s,t,this.stopLoadingImageCheck.bind(this))]);case 1:return _=m.sent(),a.length>1&&this.subscriptions.push(this.appManager.eventManager.pipe(P.filter((function(t){return t.eventType.name===(new O.ZoneChangeEndedEvent).name||t.eventType===O.ZoneChangeEndedEvent}))).subscribe((function(n){a.shift(),S.loadProgressiveImages(a,t,S.stopLoadingImageCheck.bind(S))}))),_?this.setState(new O.LoadedEvent):(this.obj.visible=!1,this.setState(new O.ErrEvent)),[2]}}))}))},ScreenImpl.prototype.stopLoadingImageCheck=function(){return this.stopPreviewProgressiveImageLoading},ScreenImpl.prototype.loadImage=function(t,n,i){return s(this,void 0,void 0,(function(){var o,a,s,_,T;return m(this,(function(m){switch(m.label){case 0:return o=this.appManager.currentExperience.renderer.outputEncoding?g.LinearEncoding:g.sRGBEncoding,(a=new S.ImageOptions).url=t,a.encoding=o,a.optimizerWidth=this.getCustomAttribute(R.CustomAttributes.OptimizationWidth,!0),M.Utils.isGif(t)&&this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this),M.Utils.isSVG(t)&&(s=this.getCustomAttribute(R.CustomAttributes.SVGSize))&&s.width&&s.height&&(a.svgSize.width=+s.width,a.svgSize.width=+s.height),this.previewImage=new S.Image(this.appManager,a),[4,this.previewImage.Load()];case 1:return _=m.sent(),T=!!i&&i(),_&&!T?(this.material instanceof A.ChromakeyMaterial||(this.material.map=_),this.material.transparent=!0,this.material.needsUpdate=!0,n||(this.geoSize=M.Utils.GetGeometryRatioFromTexture(_,3.3),this.geometry=new g.PlaneBufferGeometry(this.geoSize.x,this.geoSize.y),this.obj.geometry=this.geometry),[2,_]):[2]}}))}))},ScreenImpl.prototype.loadProgressiveImages=function(t,n,i,o){return void 0===o&&(o=0),s(this,void 0,void 0,(function(){var a,s;return m(this,(function(m){switch(m.label){case 0:return[4,this.loadImage(t[o],n,i)];case 1:return a=m.sent(),!(i&&i())&&a&&!this.destroyed&&o<t.length-1&&(s=o+1,this.loadProgressiveImages(t,n,i,s)),[2,a]}}))}))},ScreenImpl.prototype.getPreviewImage=function(){var t=this.getMetadata(),n=this.getCustomAttribute(R.CustomAttributes.PreviewImage);return n||(n=t.thumb||t.medium||t.picture),n},ScreenImpl.prototype.getMetadata=function(){return this.metadata},ScreenImpl.prototype.onHover=function(){var t=this.getMetadata().on_hover;if(t&&t.type&&"string"==typeof t.value)switch(t.type){case"change_color":this.setColor(t.value);break;case"scale":var n=this.getMetadata().scale,i=+t.value;this.setScale(new g.Vector3(i*n.x,i*n.y,i*n.z));break;case"highlight":if(!this.lineSegments){var o=new g.EdgesGeometry(this.obj.geometry,1),a=new g.LineBasicMaterial({color:t.value,transparent:!0});this.lineSegments=new g.LineSegments(o,a)}this.obj.add(this.lineSegments)}},ScreenImpl.prototype.onUnHover=function(){var t=this.getMetadata().on_hover;if(t&&t.type&&"string"==typeof t.value)switch(t.type){case"change_color":this.setColor();break;case"scale":this.setScale(this.getMetadata().scale);break;case"highlight":this.obj.remove(this.lineSegments)}},ScreenImpl.prototype.destroy=function(){this.lineSegments&&(this.obj&&this.obj.remove(this.lineSegments),this.lineSegments=void 0),t.prototype.destroy.call(this),this.previewImage&&this.previewImage.Dispose(),this.previewImage=void 0,this.stopFovAnimation()},ScreenImpl.prototype.setVisible=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){var o;return m(this,(function(a){switch(a.label){case 0:return o=[t.prototype.setVisible.call(this,n,i)],this.title&&o.push(this.title.setVisible(n,i)),[4,Promise.all(o)];case 1:return a.sent(),[2]}}))}))},ScreenImpl.prototype.applyAnimateScreenToFov=function(){return s(this,void 0,void 0,(function(){var t,n,i;return m(this,(function(o){return t=this.getMetadata(),n=t.grow_type,i=t.grow_value,n&&"none"===n.toLowerCase()||this.animateScreenToFov(.8,i||50),[2]}))}))},ScreenImpl.prototype.stopFovAnimation=function(){this.fovAnimations.length&&(this.fovAnimations.forEach((function(t){t.stop()})),this.fovAnimations=[])},ScreenImpl.prototype.animateScreenToFov=function(t,n,i){return void 0===n&&(n=50),void 0===i&&(i=new g.Vector3),s(this,void 0,void 0,(function(){var o,a,s,S,M,T,O,A,P,L,R,N,I,j,V,U,G=this;return m(this,(function(m){return this.stopFovAnimation(),o=this.obj.parent,this.appManager.currentExperience.currentZone.obj.attach(this.obj),a=this.appManager.cameraControlsRegistry.cameraControls.camera,s=a.fov*Math.PI/180,S=2*Math.tan(s/2)*1*(n/100),M=window.innerWidth/window.innerHeight,T=S*M/this.geoSize.x/this.obj.scale.x,O=new g.Vector3(0,0,-1),A=new g.Quaternion,a.getWorldQuaternion(A),O.applyQuaternion(A),P=new g.Vector3,a.getWorldPosition(P),L=O.clone().add(P),R=Math.abs(this.obj.scale.x*T),N=new g.Vector3(R,R,R),I=this.obj.position.clone(),this.obj.position.copy(L),this.obj.lookAt(P),j=this.obj.quaternion.clone(),this.obj.position.copy(I),V=this.obj,L=L.add(i),U=this.obj.quaternion.clone(),[2,new Promise((function(n,i){var a=new _.Tween(G.obj.position);G.fovAnimations.push(a),a.to(L,1e3*t).onUpdate((function(t){G.setPosition(t,0)})).start();var s=new _.Tween({r:0});G.fovAnimations.push(s),s.to({r:1},1e3*t).onUpdate((function(t){G.setRotation((new g.Euler).setFromQuaternion(g.Quaternion.slerp(U,j,V.quaternion,t.r)),0)})).start();var m=new _.Tween(G.obj.scale);G.fovAnimations.push(m),m.to(N,1e3*t).onUpdate((function(t){G.setScale(t,0)})).onComplete((function(){G.stopFovAnimation(),G.setScale(N,0),G.setPosition(L,0),G.setRotation((new g.Euler).setFromQuaternion(j),0),o.attach(G.obj),n()})).start()}))]}))}))},ScreenImpl}(T.ByondInteractiveElement);n.ScreenImpl=I},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneMetadata=n.ScreenVideoMetadata=n.ScreenMetadata=void 0;var m=i(32),g=i(36),_=function(t){function ScreenMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ScreenMetadata,t),Object.defineProperty(ScreenMetadata.prototype,"ElementName",{get:function(){return"screen"},enumerable:!1,configurable:!0}),ScreenMetadata}(m.Metadata.Element3DMetadata);n.ScreenMetadata=_;var S=function(t){function ScreenVideoMetadata(){var n=null!==t&&t.apply(this,arguments)||this;return n.is_loop=!1,n.auto_play=!1,n}return a(ScreenVideoMetadata,t),Object.defineProperty(ScreenVideoMetadata.prototype,"ElementName",{get:function(){return"screenVideo"},enumerable:!1,configurable:!0}),ScreenVideoMetadata}(_);n.ScreenVideoMetadata=S;var M=function(t){function ZoneMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ZoneMetadata,t),s([g.Type((function(){return _}))],ZoneMetadata.prototype,"screens",void 0),ZoneMetadata}(m.Metadata.ZoneMetadata);n.ZoneMetadata=M,m.Metadata.ZoneMetadata=Object.assign(M,m.Metadata.ZoneMetadata)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BaseCameraControlsFactoryImpl=void 0;n.BaseCameraControlsFactoryImpl=function BaseCameraControlsFactoryImpl(t){this.appManager=t}},function(t,n,i){"use strict";i.d(n,"a",(function(){return refCount}));var o=i(1),a=i(3);function refCount(){return function refCountOperatorFunction(t){return t.lift(new s(t))}}var s=function(){function RefCountOperator(t){this.connectable=t}return RefCountOperator.prototype.call=function(t,n){var i=this.connectable;i._refCount++;var o=new m(t,i),a=n.subscribe(o);return o.closed||(o.connection=i.connect()),a},RefCountOperator}(),m=function(t){function RefCountSubscriber(n,i){var o=t.call(this,n)||this;return o.connectable=i,o}return o.a(RefCountSubscriber,t),RefCountSubscriber.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var n=t._refCount;if(n<=0)this.connection=null;else if(t._refCount=n-1,n>1)this.connection=null;else{var i=this.connection,o=t._connection;this.connection=null,!o||i&&o!==i||o.unsubscribe()}}else this.connection=null},RefCountSubscriber}(a.a)},function(t,n,i){"use strict";i.d(n,"a",(function(){return M}));var o=i(1),a=i(11),s=i(131),m=i(9),g=i(160),_=i(55),S=i(171),M=function(t){function ReplaySubject(n,i,o){void 0===n&&(n=Number.POSITIVE_INFINITY),void 0===i&&(i=Number.POSITIVE_INFINITY);var a=t.call(this)||this;return a.scheduler=o,a._events=[],a._infiniteTimeWindow=!1,a._bufferSize=n<1?1:n,a._windowTime=i<1?1:i,i===Number.POSITIVE_INFINITY?(a._infiniteTimeWindow=!0,a.next=a.nextInfiniteTimeWindow):a.next=a.nextTimeWindow,a}return o.a(ReplaySubject,t),ReplaySubject.prototype.nextInfiniteTimeWindow=function(n){if(!this.isStopped){var i=this._events;i.push(n),i.length>this._bufferSize&&i.shift()}t.prototype.next.call(this,n)},ReplaySubject.prototype.nextTimeWindow=function(n){this.isStopped||(this._events.push(new T(this._getNow(),n)),this._trimBufferThenGetEvents()),t.prototype.next.call(this,n)},ReplaySubject.prototype._subscribe=function(t){var n,i=this._infiniteTimeWindow,o=i?this._events:this._trimBufferThenGetEvents(),a=this.scheduler,s=o.length;if(this.closed)throw new _.a;if(this.isStopped||this.hasError?n=m.a.EMPTY:(this.observers.push(t),n=new S.a(this,t)),a&&t.add(t=new g.a(t,a)),i)for(var M=0;M<s&&!t.closed;M++)t.next(o[M]);else for(M=0;M<s&&!t.closed;M++)t.next(o[M].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),n},ReplaySubject.prototype._getNow=function(){return(this.scheduler||s.a).now()},ReplaySubject.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),n=this._bufferSize,i=this._windowTime,o=this._events,a=o.length,s=0;s<a&&!(t-o[s].time<i);)s++;return a>n&&(s=Math.max(s,a-n)),s>0&&o.splice(0,s),o},ReplaySubject}(a.a),T=function ReplayEvent(t,n){this.time=t,this.value=n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return throwError}));var o=i(5);function throwError(t,n){return n?new o.a((function(i){return n.schedule(dispatch,0,{error:t,subscriber:i})})):new o.a((function(n){return n.error(t)}))}function dispatch(t){var n=t.error;t.subscriber.error(n)}},function(t,n,i){"use strict";i.d(n,"b",(function(){return combineLatest})),i.d(n,"a",(function(){return M}));var o=i(1),a=i(23),s=i(13),m=i(42),g=i(37),_=i(64),S={};function combineLatest(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=void 0,o=void 0;return Object(a.a)(t[t.length-1])&&(o=t.pop()),"function"==typeof t[t.length-1]&&(i=t.pop()),1===t.length&&Object(s.a)(t[0])&&(t=t[0]),Object(_.a)(t,o).lift(new M(i))}var M=function(){function CombineLatestOperator(t){this.resultSelector=t}return CombineLatestOperator.prototype.call=function(t,n){return n.subscribe(new T(t,this.resultSelector))},CombineLatestOperator}(),T=function(t){function CombineLatestSubscriber(n,i){var o=t.call(this,n)||this;return o.resultSelector=i,o.active=0,o.values=[],o.observables=[],o}return o.a(CombineLatestSubscriber,t),CombineLatestSubscriber.prototype._next=function(t){this.values.push(S),this.observables.push(t)},CombineLatestSubscriber.prototype._complete=function(){var t=this.observables,n=t.length;if(0===n)this.destination.complete();else{this.active=n,this.toRespond=n;for(var i=0;i<n;i++){var o=t[i];this.add(Object(g.a)(this,o,void 0,i))}}},CombineLatestSubscriber.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},CombineLatestSubscriber.prototype.notifyNext=function(t,n,i){var o=this.values,a=o[i],s=this.toRespond?a===S?--this.toRespond:this.toRespond:0;o[i]=n,0===s&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},CombineLatestSubscriber.prototype._tryResultSelector=function(t){var n;try{n=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(n)},CombineLatestSubscriber}(m.a)},function(t,n,i){"use strict";i.d(n,"a",(function(){return mergeAll}));var o=i(63),a=i(40);function mergeAll(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),Object(o.b)(a.a,t)}},function(t,n,i){"use strict";i.d(n,"a",(function(){return defer}));var o=i(5),a=i(28),s=i(26);function defer(t){return new o.a((function(n){var i;try{i=t()}catch(t){return void n.error(t)}return(i?Object(a.a)(i):Object(s.b)()).subscribe(n)}))}},function(t,n,i){"use strict";i.d(n,"b",(function(){return zip})),i.d(n,"a",(function(){return S}));var o=i(1),a=i(64),s=i(13),m=i(3),g=i(48),_=i(4);function zip(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=t[t.length-1];return"function"==typeof i&&t.pop(),Object(a.a)(t,void 0).lift(new S(i))}var S=function(){function ZipOperator(t){this.resultSelector=t}return ZipOperator.prototype.call=function(t,n){return n.subscribe(new M(t,this.resultSelector))},ZipOperator}(),M=function(t){function ZipSubscriber(n,i,o){void 0===o&&(o=Object.create(null));var a=t.call(this,n)||this;return a.resultSelector=i,a.iterators=[],a.active=0,a.resultSelector="function"==typeof i?i:void 0,a}return o.a(ZipSubscriber,t),ZipSubscriber.prototype._next=function(t){var n=this.iterators;Object(s.a)(t)?n.push(new O(t)):"function"==typeof t[g.a]?n.push(new T(t[g.a]())):n.push(new A(this.destination,this,t))},ZipSubscriber.prototype._complete=function(){var t=this.iterators,n=t.length;if(this.unsubscribe(),0!==n){this.active=n;for(var i=0;i<n;i++){var o=t[i];o.stillUnsubscribed?this.destination.add(o.subscribe()):this.active--}}else this.destination.complete()},ZipSubscriber.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},ZipSubscriber.prototype.checkIterators=function(){for(var t=this.iterators,n=t.length,i=this.destination,o=0;o<n;o++)if("function"==typeof(m=t[o]).hasValue&&!m.hasValue())return;var a=!1,s=[];for(o=0;o<n;o++){var m,g=(m=t[o]).next();if(m.hasCompleted()&&(a=!0),g.done)return void i.complete();s.push(g.value)}this.resultSelector?this._tryresultSelector(s):i.next(s),a&&i.complete()},ZipSubscriber.prototype._tryresultSelector=function(t){var n;try{n=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(n)},ZipSubscriber}(m.a),T=function(){function StaticIterator(t){this.iterator=t,this.nextResult=t.next()}return StaticIterator.prototype.hasValue=function(){return!0},StaticIterator.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},StaticIterator.prototype.hasCompleted=function(){var t=this.nextResult;return Boolean(t&&t.done)},StaticIterator}(),O=function(){function StaticArrayIterator(t){this.array=t,this.index=0,this.length=0,this.length=t.length}return StaticArrayIterator.prototype[g.a]=function(){return this},StaticArrayIterator.prototype.next=function(t){var n=this.index++,i=this.array;return n<this.length?{value:i[n],done:!1}:{value:null,done:!0}},StaticArrayIterator.prototype.hasValue=function(){return this.array.length>this.index},StaticArrayIterator.prototype.hasCompleted=function(){return this.array.length===this.index},StaticArrayIterator}(),A=function(t){function ZipBufferIterator(n,i,o){var a=t.call(this,n)||this;return a.parent=i,a.observable=o,a.stillUnsubscribed=!0,a.buffer=[],a.isComplete=!1,a}return o.a(ZipBufferIterator,t),ZipBufferIterator.prototype[g.a]=function(){return this},ZipBufferIterator.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},ZipBufferIterator.prototype.hasValue=function(){return this.buffer.length>0},ZipBufferIterator.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},ZipBufferIterator.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},ZipBufferIterator.prototype.notifyNext=function(t){this.buffer.push(t),this.parent.checkIterators()},ZipBufferIterator.prototype.subscribe=function(){return Object(_.c)(this.observable,new _.a(this))},ZipBufferIterator}(_.b)},function(t,n,i){"use strict";i.d(n,"a",(function(){return StructNode}));var o=i(2),a=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,s=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim;function StructNode(t){o.a.call(this),this.parse(t)}StructNode.prototype=Object.create(o.a.prototype),StructNode.prototype.constructor=StructNode,StructNode.prototype.nodeType="Struct",StructNode.prototype.getType=function(t){return t.getTypeByFormat(this.name)},StructNode.prototype.getInputByName=function(t){for(var n=this.inputs.length;n--;)if(this.inputs[n].name===t)return this.inputs[n]},StructNode.prototype.generate=function(t,n){return"source"===n?this.src+";":t.format("( "+this.src+" )",this.getType(t),n)},StructNode.prototype.parse=function(t){this.src=t||"",this.inputs=[];var n=a.exec(this.src);if(n){for(var i,o=n[2];i=s.exec(o);)this.inputs.push({type:i[1],name:i[2]});this.name=n[1]}else this.name="";this.type=this.name},StructNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).src=this.src),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return NodeBuilder}));var o=i(0),a=i(166),s=i(20),m=i(24),g=i(7),_=i(16),S=i(111),M=i(53),T=i(81),O=i(167),A=i(38),P=i(168),L=i(169),R=s.a.elements,N=["float","vec2","vec3","vec4"],I={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},j={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"};function NodeBuilder(){this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1,transparent:!1,irradiance:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.analyzing=!1}NodeBuilder.prototype={constructor:NodeBuilder,build:function(t,n){this.buildShader("vertex",t),this.buildShader("fragment",n);for(var i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){var o=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+o+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+o+";"),this.addVertexFinalCode("vUv"+o+" = uv"+o+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this},buildShader:function(t,n){this.resultCode[t]=n.build(this.setShader(t),"v4")},setMaterial:function(t,n){return this.material=t,this.renderer=n,this.requires.lights=t.lights,this.requires.fog=t.fog,this.mergeDefines(t.defines),this},addFlow:function(t,n,i){return this.addSlot(t).addCache(n).addContext(i)},removeFlow:function(){return this.removeSlot().removeCache().removeContext()},addCache:function(t){return this.cache=t||"",this.caches.push(this.cache),this},removeCache:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this},addContext:function(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this},removeContext:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this},addSlot:function(t){return this.slot=t||"",this.slots.push(this.slot),this},removeSlot:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this},addVertexCode:function(t){this.addCode(t,"vertex")},addFragmentCode:function(t){this.addCode(t,"fragment")},addCode:function(t,n){this.code[n||this.shader]+=t+"\n"},addVertexNodeCode:function(t){this.addNodeCode(t,"vertex")},addFragmentNodeCode:function(t){this.addNodeCode(t,"fragment")},addNodeCode:function(t,n){this.nodeCode[n||this.shader]+=t+"\n"},clearNodeCode:function(t){t=t||this.shader;var n=this.nodeCode[t];return this.nodeCode[t]="",n},clearVertexNodeCode:function(){return this.clearNodeCode("vertex")},clearFragmentNodeCode:function(){return this.clearNodeCode("fragment")},addVertexFinalCode:function(t){this.addFinalCode(t,"vertex")},addFragmentFinalCode:function(t){this.addFinalCode(t,"fragment")},addFinalCode:function(t,n){this.finalCode[n||this.shader]+=t+"\n"},addVertexParsCode:function(t){this.addParsCode(t,"vertex")},addFragmentParsCode:function(t){this.addParsCode(t,"fragment")},addParsCode:function(t,n){this.parsCode[n||this.shader]+=t+"\n"},addVaryCode:function(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)},isCache:function(t){return-1!==this.caches.indexOf(t)},isSlot:function(t){return-1!==this.slots.indexOf(t)},define:function(t,n){this.defines[t]=void 0===n?1:n},require:function(t){this.requires[t]=!0},isDefined:function(t){return void 0!==this.defines[t]},getVar:function(t,n,i,o="varying",a="V",s=""){var m=this.getVars(o),g=m[t];if(!g){var _=m.length;g={name:i||"node"+a+_+(s?"_"+s:""),type:n},m.push(g),m[t]=g}return g},getTempVar:function(t,n,i,o){return this.getVar(t,n,i,this.shader,"T",o)},getAttribute:function(t,n){if(!this.attributes[t]){var i=this.getVar(t,n);this.addVertexParsCode("attribute "+n+" "+t+";"),this.addVertexFinalCode(i.name+" = "+t+";"),this.attributes[t]={varying:i,name:t,type:n}}return this.attributes[t]},getCode:function(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join("\n")},getVarListCode:function(t,n){n=n||"";for(var i="",o=0,a=t.length;o<a;++o){var s=t[o],m=s.type,g=s.name,_=this.getFormatByType(m);if(void 0===_)throw new Error("Node pars "+_+" not found.");i+=n+" "+_+" "+g+";\n"}return i},getVars:function(t){return this.inputs.vars[t||this.shader]},getNodeData:function(t){var n=t.isNode?t.uuid:t;return this.nodeData[n]=this.nodeData[n]||{}},createUniform:function(t,n,i,o,s,m){var g=this.inputs.uniforms,_=g.list.length,S=new a.a({type:n,name:o||"nodeU"+_+(m?"_"+m:""),node:i,needsUpdate:s});return g.list.push(S),g[t].push(S),g[t][S.name]=S,this.uniforms[S.name]=S,S},createVertexUniform:function(t,n,i,o,a){return this.createUniform("vertex",t,n,i,o,a)},createFragmentUniform:function(t,n,i,o,a){return this.createUniform("fragment",t,n,i,o,a)},include:function(t,n,i){var o;if(t="string"==typeof t?m.a.get(t):t,!1===this.context.include)return t.name;t instanceof g.a?o=this.includes.functions:t instanceof _.a?o=this.includes.consts:t instanceof S.a&&(o=this.includes.structs);var a=o[this.shader]=o[this.shader]||[];if(t){var s=a[t.name];if(s||(s=a[t.name]={node:t,deps:[]},a.push(s),s.src=t.build(this,"source")),t instanceof g.a&&n&&a[n.name]&&-1==a[n.name].deps.indexOf(t)&&(a[n.name].deps.push(t),t.includes&&t.includes.length)){var M=0;do{this.include(t.includes[M++],n)}while(M<t.includes.length)}return i&&(s.src=i),t.name}throw new Error("Include not found.")},colorToVectorProperties:function(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},colorToVector:function(t){return t.replace(/c/g,"v3")},getIncludes:function(t,n){return this.includes[t][n||this.shader]},getIncludesCode:function(){function sortByPosition(t,n){return t.deps.length-n.deps.length}return function getIncludesCode(t,n){if(!(o=this.getIncludes(t,n)))return"";for(var i="",o=o.sort(sortByPosition),a=0;a<o.length;a++)o[a].src&&(i+=o[a].src+"\n");return i}}(),getConstructorFromLength:function(t){return N[t-1]},isTypeMatrix:function(t){return/^m/.test(t)},getTypeLength:function(t){return"f"===t?1:parseInt(this.colorToVector(t).substr(1))},getTypeFromLength:function(t){return 1===t?"f":"v"+t},findNode:function(){for(var t=0;t<arguments.length;t++){var n=arguments[t];if(void 0!==n&&n.isNode)return n}},resolve:function(){for(var t=0;t<arguments.length;t++){var n=arguments[t];if(void 0!==n){if(n.isNode)return n;if(n.isTexture)switch(n.mapping){case o.CubeReflectionMapping:case o.CubeRefractionMapping:return new P.a(n);case o.CubeUVReflectionMapping:case o.CubeUVRefractionMapping:return new L.a(new A.a(n));default:return new A.a(n)}else{if(n.isVector2)return new M.a(n);if(n.isVector3)return new T.a(n);if(n.isVector4)return new O.a(n)}}}},format:function(t,n,i){switch(this.colorToVector(i+" <- "+n)){case"f <- v2":case"f <- v3":case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t},getTypeByFormat:function(t){return I[t]||t},getFormatByType:function(t){return j[t]||t},getUuid:function(t,n){return(n=void 0===n||n)&&this.cache&&(t=this.cache+"-"+t),t},getElementByIndex:function(t){return R[t]},getIndexByElement:function(t){return R.indexOf(t)},isShader:function(t){return this.shader===t},setShader:function(t){return this.shader=t,this},mergeDefines:function(t){for(var n in t)this.defines[n]=t[n];return this.defines},mergeUniform:function(t){for(var n in t)this.uniforms[n]=t[n];return this.uniforms},getTextureEncodingFromMap:function(t){var n;return t?t.isTexture?n=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=t.texture.encoding):n=o.LinearEncoding,n===o.LinearEncoding&&this.context.gamma&&(n=o.GammaEncoding),n}}},function(t,n,i){"use strict";i.d(n,"a",(function(){return ScreenNode}));var o=i(6),a=i(38);function ScreenNode(t){a.a.call(this,void 0,t)}ScreenNode.prototype=Object.create(a.a.prototype),ScreenNode.prototype.constructor=ScreenNode,ScreenNode.prototype.nodeType="Screen",ScreenNode.prototype.getUnique=function(){return!0},ScreenNode.prototype.getTexture=function(t,n){return o.a.prototype.generate.call(this,t,n,this.getUuid(),"t","renderTexture")}},function(t,n,i){"use strict";function isObject(t){return null!==t&&"object"==typeof t}i.d(n,"a",(function(){return isObject}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return canReportError}));var o=i(3);function canReportError(t){for(;t;){var n=t,i=n.closed,a=n.destination,s=n.isStopped;if(i||s)return!1;t=a&&a instanceof o.a?a:null}return!0}},function(t,n,i){"use strict";i.d(n,"a",(function(){return scheduleArray}));var o=i(5),a=i(9);function scheduleArray(t,n){return new o.a((function(i){var o=new a.a,s=0;return o.add(n.schedule((function(){s!==t.length?(i.next(t[s++]),i.closed||o.add(this.schedule())):i.complete()}))),o}))}},function(t,n,i){"use strict";i.d(n,"a",(function(){return s}));var o=i(39),a=i(76),s={closed:!0,next:function(t){},error:function(t){if(o.a.useDeprecatedSynchronousErrorHandling)throw t;Object(a.a)(t)},complete:function(){}}},function(t,n,i){(function(t){function objectToString(t){return Object.prototype.toString.call(t)}n.isArray=function isArray(t){return Array.isArray?Array.isArray(t):"[object Array]"===objectToString(t)},n.isBoolean=function isBoolean(t){return"boolean"==typeof t},n.isNull=function isNull(t){return null===t},n.isNullOrUndefined=function isNullOrUndefined(t){return null==t},n.isNumber=function isNumber(t){return"number"==typeof t},n.isString=function isString(t){return"string"==typeof t},n.isSymbol=function isSymbol(t){return"symbol"==typeof t},n.isUndefined=function isUndefined(t){return void 0===t},n.isRegExp=function isRegExp(t){return"[object RegExp]"===objectToString(t)},n.isObject=function isObject(t){return"object"==typeof t&&null!==t},n.isDate=function isDate(t){return"[object Date]"===objectToString(t)},n.isError=function isError(t){return"[object Error]"===objectToString(t)||t instanceof Error},n.isFunction=function isFunction(t){return"function"==typeof t},n.isPrimitive=function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},n.isBuffer=t.isBuffer}).call(this,i(31).Buffer)},function(t,n,i){"use strict";var o,a="object"==typeof Reflect?Reflect:null,s=a&&"function"==typeof a.apply?a.apply:function ReflectApply(t,n,i){return Function.prototype.apply.call(t,n,i)};o=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t)};var m=Number.isNaN||function NumberIsNaN(t){return t!=t};function EventEmitter(){EventEmitter.init.call(this)}t.exports=EventEmitter,t.exports.once=function once(t,n){return new Promise((function(i,o){function eventListener(){void 0!==a&&t.removeListener("error",a),i([].slice.call(arguments))}var a;"error"!==n&&(a=function errorListener(i){t.removeListener(n,eventListener),o(i)},t.once("error",a)),t.once(n,eventListener)}))},EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var g=10;function checkListener(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function _getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function _addListener(t,n,i,o){var a,s,m;if(checkListener(i),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",n,i.listener?i.listener:i),s=t._events),m=s[n]),void 0===m)m=s[n]=i,++t._eventsCount;else if("function"==typeof m?m=s[n]=o?[i,m]:[m,i]:o?m.unshift(i):m.push(i),(a=_getMaxListeners(t))>0&&m.length>a&&!m.warned){m.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=t,g.type=n,g.count=m.length,function ProcessEmitWarning(t){console&&console.warn&&console.warn(t)}(g)}return t}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(t,n,i){var o={fired:!1,wrapFn:void 0,target:t,type:n,listener:i},a=onceWrapper.bind(o);return a.listener=i,o.wrapFn=a,a}function _listeners(t,n,i){var o=t._events;if(void 0===o)return[];var a=o[n];return void 0===a?[]:"function"==typeof a?i?[a.listener||a]:[a]:i?function unwrapListeners(t){for(var n=new Array(t.length),i=0;i<n.length;++i)n[i]=t[i].listener||t[i];return n}(a):arrayClone(a,a.length)}function listenerCount(t){var n=this._events;if(void 0!==n){var i=n[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function arrayClone(t,n){for(var i=new Array(n),o=0;o<n;++o)i[o]=t[o];return i}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(t){if("number"!=typeof t||t<0||m(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");g=t}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(t){if("number"!=typeof t||t<0||m(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(t){for(var n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);var o="error"===t,a=this._events;if(void 0!==a)o=o&&void 0===a.error;else if(!o)return!1;if(o){var m;if(n.length>0&&(m=n[0]),m instanceof Error)throw m;var g=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw g.context=m,g}var _=a[t];if(void 0===_)return!1;if("function"==typeof _)s(_,this,n);else{var S=_.length,M=arrayClone(_,S);for(i=0;i<S;++i)s(M[i],this,n)}return!0},EventEmitter.prototype.addListener=function addListener(t,n){return _addListener(this,t,n,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(t,n){return _addListener(this,t,n,!0)},EventEmitter.prototype.once=function once(t,n){return checkListener(n),this.on(t,_onceWrap(this,t,n)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(t,n){return checkListener(n),this.prependListener(t,_onceWrap(this,t,n)),this},EventEmitter.prototype.removeListener=function removeListener(t,n){var i,o,a,s,m;if(checkListener(n),void 0===(o=this._events))return this;if(void 0===(i=o[t]))return this;if(i===n||i.listener===n)0==--this._eventsCount?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,i.listener||n));else if("function"!=typeof i){for(a=-1,s=i.length-1;s>=0;s--)if(i[s]===n||i[s].listener===n){m=i[s].listener,a=s;break}if(a<0)return this;0===a?i.shift():function spliceOne(t,n){for(;n+1<t.length;n++)t[n]=t[n+1];t.pop()}(i,a),1===i.length&&(o[t]=i[0]),void 0!==o.removeListener&&this.emit("removeListener",t,m||n)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var n,i,o;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var a,s=Object.keys(i);for(o=0;o<s.length;++o)"removeListener"!==(a=s[o])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=i[t]))this.removeListener(t,n);else if(void 0!==n)for(o=n.length-1;o>=0;o--)this.removeListener(t,n[o]);return this},EventEmitter.prototype.listeners=function listeners(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function rawListeners(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,n){return"function"==typeof t.listenerCount?t.listenerCount(n):listenerCount.call(t,n)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?o(this._events):[]}},function(t,n,i){"use strict";var o=i(379).Buffer,a=o.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(t){var n;switch(this.encoding=function normalizeEncoding(t){var n=function _normalizeEncoding(t){if(!t)return"utf8";for(var n;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(n)return;t=(""+t).toLowerCase(),n=!0}}(t);if("string"!=typeof n&&(o.isEncoding===a||!a(t)))throw new Error("Unknown encoding: "+t);return n||t}(t),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,n=4;break;case"utf8":this.fillLast=utf8FillLast,n=4;break;case"base64":this.text=base64Text,this.end=base64End,n=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=o.allocUnsafe(n)}function utf8CheckByte(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function utf8FillLast(t){var n=this.lastTotal-this.lastNeed,i=function utf8CheckExtraBytes(t,n,i){if(128!=(192&n[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&n.length>1){if(128!=(192&n[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&n.length>2&&128!=(192&n[2]))return t.lastNeed=2,"�"}}(this,t);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,n,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,n,0,t.length),void(this.lastNeed-=t.length))}function utf16Text(t,n){if((t.length-n)%2==0){var i=t.toString("utf16le",n);if(i){var o=i.charCodeAt(i.length-1);if(o>=55296&&o<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",n,t.length-1)}function utf16End(t){var n=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return n+this.lastChar.toString("utf16le",0,i)}return n}function base64Text(t,n){var i=(t.length-n)%3;return 0===i?t.toString("base64",n):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",n,t.length-i))}function base64End(t){var n=t&&t.length?this.write(t):"";return this.lastNeed?n+this.lastChar.toString("base64",0,3-this.lastNeed):n}function simpleWrite(t){return t.toString(this.encoding)}function simpleEnd(t){return t&&t.length?this.write(t):""}n.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(t){if(0===t.length)return"";var n,i;if(this.lastNeed){if(void 0===(n=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?n?n+this.text(t,i):this.text(t,i):n||""},StringDecoder.prototype.end=function utf8End(t){var n=t&&t.length?this.write(t):"";return this.lastNeed?n+"�":n},StringDecoder.prototype.text=function utf8Text(t,n){var i=function utf8CheckIncomplete(t,n,i){var o=n.length-1;if(o<i)return 0;var a=utf8CheckByte(n[o]);return a>=0?(a>0&&(t.lastNeed=a-1),a):--o<i||-2===a?0:(a=utf8CheckByte(n[o]))>=0?(a>0&&(t.lastNeed=a-2),a):--o<i||-2===a?0:(a=utf8CheckByte(n[o]))>=0?(a>0&&(2===a?a=0:t.lastNeed=a-3),a):0}(this,t,n);if(!this.lastNeed)return t.toString("utf8",n);this.lastTotal=i;var o=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,o),t.toString("utf8",n,o)},StringDecoder.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function awaitify(t,n=t.length){if(!n)throw new Error("arity is undefined");return function awaitable(...i){return"function"==typeof i[n-1]?t.apply(this,i):new Promise((o,a)=>{i[n-1]=(t,...n)=>{if(t)return a(t);o(n.length>1?n:n[0])},t.apply(this,i)})}},t.exports=n.default},function(t,n,i){(n=t.exports=i(224)).Stream=n,n.Readable=n,n.Writable=i(178),n.Duplex=i(84),n.Transform=i(229),n.PassThrough=i(394)},function(t,n,i){(n=t.exports=i(233)).Stream=n,n.Readable=n,n.Writable=i(237),n.Duplex=i(94),n.Transform=i(238),n.PassThrough=i(413),n.finished=i(183),n.pipeline=i(414)},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.VROrbitCameraControls=void 0;var g=i(267),_=i(0),S=i(17),M=i(18),T=i(10),O=i(98),A=function(t){function VROrbitCameraControls(n,i){void 0===i&&(i=new O.OrbitControlsOptions);var o=t.call(this,n)||this;return o.target=new _.Vector3(0,0,-1e-4),o.zoomSpeedVR=10,o.moveSpeedVR=1,o.isVR=!0,o.orbitOptions=i,o.orbitOptions.target&&(o.target=o.orbitOptions.target),o}return a(VROrbitCameraControls,t),VROrbitCameraControls.prototype.init=function(n,i,o){return s(this,void 0,void 0,(function(){return m(this,(function(a){switch(a.label){case 0:return[4,t.prototype.init.call(this,n,i,o)];case 1:return a.sent(),this.camera.name="VROrbitCamera",this.dummyCamera=new _.Object3D,this.dummyCamera.name="dummyCamera",this.appManager.currentExperience.scene.add(this.dummyCamera),this.dummyCamera.add(this.camera),this.dummyTarget=new _.Object3D,this.dummyTarget.name="dummyTarget",this.dummyTarget.position.set(this.target.x,this.target.y,this.target.z),this.appManager.currentExperience.scene.add(this.dummyTarget),this.dummyTarget.add(this.dummyCamera),this.setCameraOptions(this.orbitOptions),this.addListeners(),[2]}}))}))},VROrbitCameraControls.prototype.addListeners=function(){var t=this,n=this.appManager.eventManager.pipe(M.filter((function(t){return(t.eventType.name===(new T.GamepadSwipeEvent).name||t.eventType===T.GamepadSwipeEvent)&&t.message&&0===t.message.buttonIndex}))).subscribe((function(n){var i=n.message.delta,o=new _.Vector2(i.x*t.moveSpeedVR,i.y*t.moveSpeedVR);t.onSwipe(o)}));this.subscribtions.push(n);var i=this.appManager.eventManager.pipe(M.filter((function(t){return(t.eventType.name===(new T.GamepadPressSwipeEvent).name||t.eventType===T.GamepadPressSwipeEvent)&&t.message&&0===t.message.buttonIndex}))).subscribe((function(n){var i=n.message.delta;t.onZoom(i.y*t.zoomSpeedVR)}));this.subscribtions.push(i)},VROrbitCameraControls.prototype.onSwipe=function(t){this.dummyTarget.rotateY(t.x)},VROrbitCameraControls.prototype.onZoom=function(t){this.dummyCamera.translateZ(t)},VROrbitCameraControls.prototype.changeCamRotation=function(t,n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},VROrbitCameraControls.prototype.changeCamPosition=function(t,n,i,o){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(a){switch(a.label){case 0:return[4,S.Utils.setPosition(this.dummyCamera,t,n,i,o)];case 1:return a.sent(),[2]}}))}))},VROrbitCameraControls.prototype.setCameraAttr=function(t){t.orbit_camera&&this.setCameraOptions(t.orbit_camera)},VROrbitCameraControls.prototype.setCameraOptions=function(t){var n=new _.Vector3(0,0,0);t.position&&(n=new _.Vector3(+t.position.x,+t.position.y,+t.position.z)),this.animateCamera(n,void 0,void 0,.5),this.orbitOptions=t},VROrbitCameraControls.prototype.destroy=function(){t.prototype.destroy.call(this),this.dummyCamera&&this.dummyCamera.parent&&this.dummyCamera.parent.remove(this.dummyCamera),this.dummyTarget&&this.dummyTarget.parent&&this.dummyTarget.parent.remove(this.dummyTarget)},VROrbitCameraControls}(g.VRCameraControls);n.VROrbitCameraControls=A},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.MouseControls=void 0;var s=i(0),m=i(190),g=i(95),_=function(t){function MouseControls(){var n=null!==t&&t.apply(this,arguments)||this;return n.mobileHover=!1,n.dblClickThresholdTime=300,n.lastTouchUpTime=(new Date).getTime(),n}return a(MouseControls,t),MouseControls.prototype.enable=function(){this.enabled||(this.detectCollisionFunc=this.checkShouldDetectCollision.bind(null,this),this.domElement.addEventListener("mousemove",this.detectCollisionFunc),this.onMouseDownFunc=this.checkShouldOnMouseDown.bind(null,this),this.domElement.addEventListener("mousedown",this.onMouseDownFunc),this.domElement.addEventListener("pointerdown",this.onMouseDownFunc),this.domElement.addEventListener("touchstart",this.onMouseDownFunc),this.detectClickFunc=this.checkShouldDetectClick.bind(null,this),this.domElement.addEventListener("click",this.detectClickFunc),this.detectRightClickFunc=this.checkShouldDetectRightClick.bind(null,this),this.domElement.addEventListener("contextmenu",this.detectRightClickFunc),this.detectTouchFunc=this.checkShouldDetectTouch.bind(null,this),this.domElement.addEventListener("touchend",this.detectTouchFunc),this.enabled=!0)},MouseControls.prototype.checkShouldDetectCollision=function(t,n){t.isDescendant(t.appManager.container,n.target)&&t.detectCollision(t,n)},MouseControls.prototype.checkShouldDetectTouch=function(t,n){(new Date).getTime()-t.lastTouchUpTime>t.dblClickThresholdTime?t.clickTimeout=window.setTimeout((function(){t.isDescendant(t.appManager.container,n.target)&&t.detectTouch(t,n)}),t.dblClickThresholdTime):(window.clearTimeout(t.clickTimeout),t.lastTouchUpTime=0),t.lastTouchUpTime=(new Date).getTime()},MouseControls.prototype.checkShouldDetectClick=function(t,n){n.detail>1?window.clearTimeout(t.clickTimeout):t.clickTimeout=window.setTimeout((function(){t.isDescendant(t.appManager.container,n.target)&&t.detectTouch(t,n)}),t.dblClickThresholdTime)},MouseControls.prototype.checkShouldDetectRightClick=function(t,n){n.preventDefault(),t.isDescendant(t.appManager.container,n.target)&&t.detectRightClick(t,n)},MouseControls.prototype.checkShouldOnMouseDown=function(t,n){t.isDescendant(t.appManager.container,n.target)&&t.onMouseDown(t)},MouseControls.prototype.isDescendant=function(t,n){for(var i=n.parentNode;null!==i;){if(i===t)return!0;i=i.parentNode}return!1},MouseControls.prototype.disable=function(){this.enabled&&(this.domElement.removeEventListener("mousemove",this.detectCollisionFunc),this.domElement.removeEventListener("mousedown",this.onMouseDownFunc),this.domElement.removeEventListener("pointerdown",this.onMouseDownFunc),this.domElement.removeEventListener("touchstart",this.onMouseDownFunc),this.domElement.removeEventListener("click",this.detectClickFunc),this.domElement.removeEventListener("contextmenu",this.detectRightClickFunc),this.domElement.removeEventListener("touchend",this.detectTouchFunc),this.enabled=!1)},MouseControls.prototype.enableMobileHover=function(){g.DeviceUtils.IsMobile()&&!this.mobileHover&&(this.mobileHover=!0,this.loopFOV())},MouseControls.prototype.disableMobileHover=function(){this.mobileHover=!1},MouseControls.prototype.triggerFocus=function(n,i,o){!this.mobileHover&&g.DeviceUtils.IsMobile()||t.prototype.triggerFocus.call(this,n,i,o)},MouseControls.prototype.triggerUnfocus=function(n,i){!this.mobileHover&&g.DeviceUtils.IsMobile()||t.prototype.triggerUnfocus.call(this,n,i)},MouseControls.prototype.detectCollision=function(t,n){var i=t.appManager.currentExperience.renderer?t.appManager.currentExperience.renderer.domElement:void 0,o=t.appManager.cameraControlsRegistry;if(i&&n&&t.targetList&&o.cameraControls){var a;window.TouchEvent&&n instanceof TouchEvent?a=new s.Vector2(n.changedTouches[0].clientX,n.changedTouches[0].clientY):n instanceof MouseEvent&&(a=new s.Vector2(n.clientX,n.clientY));var m=t.GetIntersectsFromController(t.raycaster,o.cameraControls.camera,i,a,Array.from(t.targetList.keys()));if(m.length>0){var g=m[0].object;if(!g)return;return g===t.focusedElement||(t.focusedElement?(t.triggerUnfocus(t,t.focusedElement),t.focusedElement=g,t.triggerFocus(t,t.focusedElement,m[0].point)):(t.focusedElement=g,t.triggerFocus(t,t.focusedElement,m[0].point))),t.getHitInfoFromIntersection(t,m[0])}t.focusedElement&&t.triggerUnfocus(t,t.focusedElement),t.focusedElement=void 0}},MouseControls.prototype.detectCollisionFromFOV=function(t,n){if((t.appManager.currentExperience.renderer?t.appManager.currentExperience.renderer.domElement:void 0)&&t.targetList&&0!==t.targetList.size){var i=t.appManager.cameraControlsRegistry;t.raycaster.setFromCamera({x:0,y:0},i.cameraControls.camera);var o=t.raycaster.intersectObjects(Array.from(t.targetList.keys()),!0);if(o.length>0){var a=o[0].object;if(!a)return;return a===t.focusedElement||(t.focusedElement?(t.triggerUnfocus(t,t.focusedElement),t.focusedElement=a,t.triggerFocus(t,t.focusedElement,o[0].point)):(t.focusedElement=a,t.triggerFocus(t,t.focusedElement,o[0].point))),o[0].point}t.focusedElement&&t.triggerUnfocus(t,t.focusedElement),t.focusedElement=void 0}},MouseControls.prototype.loopFOV=function(){var t=this;this.appManager.renderEventManager.subscribe((function(){t.mobileHover&&t.detectCollisionFromFOV(t,null)}))},MouseControls.prototype.GetIntersectsFromController=function(t,n,i,o,a){void 0===t&&(t=new s.Raycaster);var m=new s.Vector2(0,0),g=i,_=(window.pageYOffset,null==g?void 0:g.getBoundingClientRect()),S=(null==_?void 0:_.top)?null==_?void 0:_.top:0,M=(null==_?void 0:_.bottom)?null==_?void 0:_.bottom:1,T=(null==_?void 0:_.left)?null==_?void 0:_.left:0,O=(null==_?void 0:_.right)?null==_?void 0:_.right:1;return m.x=(o.x-T)/(O-T)*2-1,m.y=-(o.y-S)/(M-S)*2+1,t.setFromCamera(m,n),t.intersectObjects(Array.from(a),!0)},MouseControls}(m.UserInteractionControlsImpl);n.MouseControls=_},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EffectImpl=void 0;var o=i(585),a=i(10),s=i(34),m=function(){function EffectImpl(t){this.appManager=t}return EffectImpl.prototype.init=function(){this.composer=new o.EffectComposer(this.appManager.currentExperience.renderer),this.onResizeFunction=this.onResize.bind(this),window.addEventListener("resize",this.onResizeFunction)},EffectImpl.prototype.onResize=function(){this.composer.setSize(window.innerWidth,window.innerHeight)},EffectImpl.prototype.start=function(){this.enabled||(this.enabled=!0,this.render(),this.appManager.eventManager.next(new s.EventMessage(this,new a.EffectStartedEvent)))},EffectImpl.prototype.stop=function(){this.enabled&&(this.enabled=!1,this.appManager.eventManager.next(new s.EventMessage(this,new a.EffectEndedEvent)))},EffectImpl.prototype.render=function(){var t=this,n=this.appManager.renderEventManager.subscribe((function(i){t.enabled?t.composer.render():n.unsubscribe()}))},EffectImpl.prototype.destroy=function(){this.stop(),this.composer.reset(),this.composer.passes.forEach((function(t){t.enabled&&(t.enabled=!1),t.renderToScreen&&(t.renderToScreen=!1)})),this.composer.passes=[],delete this.composer,this.composer=void 0,window.removeEventListener("resize",this.onResizeFunction)},EffectImpl.prototype.addEditorItems=function(t,n){},EffectImpl}();n.EffectImpl=m},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EquirectangularBackground=void 0;var g=i(0),_=i(196),S=i(10),M=i(18),T=function(t){function EquirectangularBackground(n,i,o){var a=t.call(this,n,i,o)||this;a.RADIUS=400,a.WSEGMENTS=64,a.HSEGMENTS=32,a.geometry=new g.SphereGeometry(a.RADIUS,a.WSEGMENTS,a.HSEGMENTS),a.material=new g.MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1,depthTest:!1,side:g.BackSide});var s=a,m=a.appManager.eventManager.pipe(M.filter((function(t){return t.eventType.name===(new S.TouchEvent).name||t.eventType===S.TouchEvent}))).subscribe((function(){a.activateElement(s)}));return a.subscriptions.push(m),a}return a(EquirectangularBackground,t),EquirectangularBackground.prototype.setAlpha=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return this.material.transparent=!0,[4,t.prototype.setAlpha.call(this,n,i)];case 1:return o.sent(),this.material.transparent=!1,[2]}}))}))},EquirectangularBackground.prototype.init=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this)];case 1:return i.sent(),this.material.side=g.BackSide,this.obj.position.set(0,0,0),n=g.MathUtils.degToRad(this.getMetadata().background_rotation||0),this.obj.rotateY(-Math.PI/2+n),this.obj.scale.set(-1,1,1),this.obj.renderOrder=-999999,[2]}}))}))},EquirectangularBackground.prototype.getMetadata=function(){return this.metadata},EquirectangularBackground}(_.BackgroundImpl);n.EquirectangularBackground=T},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneManagerImpl=n.CameraAttribute=void 0;var g=i(100),_=i(22),S=i(17),M=i(46),T=i(18),O=i(10),A=i(98),P=i(0),L=i(34);n.CameraAttribute="$$camera";var R=function(t){function ZoneManagerImpl(n,i,o){return t.call(this,n,i,o)||this}return a(ZoneManagerImpl,t),ZoneManagerImpl.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o=this;return m(this,(function(a){switch(a.label){case 0:return this.appManager.eventManager.next(new L.EventMessage(this,new O.ZoneLoadingEvent),!0),this.subscriptions.push(this.appManager.eventManager.pipe(T.filter((function(t){return t.eventType.name===(new O.ZoneChangeEndedEvent).name||t.eventType===O.ZoneChangeEndedEvent}))).subscribe((function(t){o.checkDefaultEntryPoint()}))),[4,t.prototype.init.call(this)];case 1:return a.sent(),n=this.getCustomAttribute(_.CustomAttributes.UserHeight),i=this.getCustomAttribute(_.CustomAttributes.FloorLevel)||0,n&&(this.cameraHeight=i+n,this.setCameraheight(this.cameraHeight)),[2]}}))}))},ZoneManagerImpl.prototype.setCameraheight=function(t){this.appManager.cameraControlsRegistry.cameraControls.setCameraHeight(this.cameraHeight)},ZoneManagerImpl.prototype.afterInit=function(){this.handleCameraAttributeAfterInit()},ZoneManagerImpl.prototype.createElements=function(){return s(this,void 0,void 0,(function(){var t,n,i,o,a,s,g,_;return m(this,(function(m){switch(m.label){case 0:for(o in t=new Array,n=this.getMetadata(),i=[],n)i.push(o);a=0,m.label=1;case 1:return a<i.length?(s=i[a],n.hasOwnProperty(s)?(g=n[s],[4,this.getElementByMetadata(g)]):[3,3]):[3,4];case 2:(_=m.sent())&&_.length&&(t=t.concat(_)),m.label=3;case 3:return a++,[3,1];case 4:return[2,t]}}))}))},ZoneManagerImpl.prototype.getElementByMetadata=function(t){return s(this,void 0,void 0,(function(){var n,i,o,a=this;return m(this,(function(g){switch(g.label){case 0:return n=new Array,t&&Array.isArray(t)?(i=[],t.forEach((function(t){return s(a,void 0,void 0,(function(){var n;return m(this,(function(o){return(n=this.appManager.elementsRegistry.GetElement(t,this))&&i.push(n),[2]}))}))})),[4,Promise.all(i)]):[3,2];case 1:return g.sent().forEach((function(t){t&&(n=n.concat(t))})),[3,4];case 2:return[4,this.appManager.elementsRegistry.GetElement(t,this)];case 3:(o=g.sent())&&(n=n.concat(o)),g.label=4;case 4:return[2,n]}}))}))},ZoneManagerImpl.prototype.getMetadata=function(){return this.metadata},ZoneManagerImpl.prototype.getElementMetadataByID=function(t){var n,i=this.getMetadata();for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];if(a&&Array.isArray(a)&&(n=a.find((function(n){return n.byond_id===t}))))break}return n},ZoneManagerImpl.prototype.resetZone=function(){},ZoneManagerImpl.prototype.onChildDestroyed=function(n){t.prototype.onChildDestroyed.call(this,n),this.elementsList=this.elementsList.filter((function(t){return t!==n}))},ZoneManagerImpl.prototype.destroy=function(){var n;t.prototype.destroy.call(this);var i=this.appManager.currentExperience.cameraControlsRegistry.cameraControls;i instanceof A.OrbitBasedCameraControls&&this.unsetZoomSupport(i,!1),null===(n=this.elementsList)||void 0===n||n.forEach((function(t){t.destroy()})),this.elementsList=void 0},ZoneManagerImpl.prototype.handleDependencies=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.handleDependencies.call(this)];case 1:return n.sent(),this.checkGammaFactor(),[2]}}))}))},ZoneManagerImpl.prototype.checkGammaFactor=function(){var t=this.getCustomAttribute(_.CustomAttributes.physicallyCorrectLights);this.appManager.currentExperience.renderer.physicallyCorrectLights=!!t;var n=this.getCustomAttribute(_.CustomAttributes.GammaFactor);this.setGammaFactor(n)},ZoneManagerImpl.prototype.setGammaFactor=function(t){t?(this.appManager.currentExperience.renderer.outputEncoding=P.GammaEncoding,this.appManager.currentExperience.renderer.gammaFactor=+t):(this.appManager.currentExperience.renderer.outputEncoding=P.LinearEncoding,this.appManager.currentExperience.renderer.gammaFactor=1)},ZoneManagerImpl.prototype.checkDefaultCameraZoom=function(){var t=this.getCustomAttribute(_.CustomAttributes.CameraZoom),n=this.appManager.cameraControlsRegistry.cameraControls.camera;n.zoom=t?+t:1,n.updateProjectionMatrix()},ZoneManagerImpl.prototype.checkDefaultEntryPoint=function(){return s(this,void 0,void 0,(function(){var t,n;return m(this,(function(i){switch(i.label){case 0:return(t=this.getCustomAttribute("$$default_entry_point"))&&(n=S.Utils.getItemById(this.appManager,t))instanceof M.ByondInteractiveElement?(this.appManager.currentExperience.cameraControlsRegistry.cameraControls.gyroManager&&(this.appManager.currentExperience.cameraControlsRegistry.cameraControls.gyroEnabled=!1),[4,n.activateElement(n)]):[3,2];case 1:i.sent(),this.appManager.currentExperience.cameraControlsRegistry.cameraControls.gyroManager&&(this.appManager.currentExperience.cameraControlsRegistry.cameraControls.gyroEnabled=!0,this.appManager.currentExperience.cameraControlsRegistry.cameraControls.resetGyro(!0)),i.label=2;case 2:return[2]}}))}))},ZoneManagerImpl.prototype.getEntryPoints=function(){return s(this,void 0,void 0,(function(){var t;return m(this,(function(n){return t=[],this.elementsList.forEach((function(n){n.getCustomAttribute("$$entry_point")&&t.push(n)})),[2,t]}))}))},ZoneManagerImpl.prototype.handleCameraAttributeAfterInit=function(){var t=this.appManager.cameraControlsRegistry.cameraControls;if(t instanceof A.OrbitBasedCameraControls){var i=this.getCustomAttribute(n.CameraAttribute);i&&i.camera_zoom?this.setZoomSupport(i.camera_zoom):this.unsetZoomSupport(t,!this.destroyed)}},ZoneManagerImpl.prototype.setZoomSupport=function(t){var n=this,i=t.min?+t.min:0,o=t.max?+t.max:1/0,a=t.factor?+t.factor:1;this.ZoomSub=this.appManager.eventManager.pipe(T.filter((function(t){return t.eventType.name===(new O.MouseWheelEvent).name||t.eventType===O.MouseWheelEvent}))).subscribe((function(t){n.onZoom(t.message.delta,i,o,a)})),this.PinchSub=this.appManager.eventManager.pipe(T.filter((function(t){return t.eventType.name===(new O.PinchEvent).name||t.eventType===O.PinchEvent}))).subscribe((function(t){n.onZoom(-1*t.message.delta,i,o,25*a)}))},ZoneManagerImpl.prototype.unsetZoomSupport=function(t,n){if(void 0===n&&(n=!0),this.ZoomSub&&this.ZoomSub.unsubscribe(),this.PinchSub&&this.PinchSub.unsubscribe(),n){var i=this.getCustomAttribute(_.CustomAttributes.CameraZoom)||"1";t.camera.zoom=+i}t.camera.updateProjectionMatrix()},ZoneManagerImpl.prototype.onZoom=function(t,n,i,o){var a=this.appManager.cameraControlsRegistry.cameraControls;a instanceof A.OrbitBasedCameraControls&&t&&(a.camera.zoom+=.001*t*o,a.camera.zoom=a.camera.zoom<n?n:a.camera.zoom>i?i:a.camera.zoom,a.camera.updateProjectionMatrix(),a.onCameraZoomFunc())},ZoneManagerImpl}(g.ByondBaseElement);n.ZoneManagerImpl=R},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getHotspotPreviewImage=void 0;var o="https://webxr-apps.byondxr.com/assets/images/hotspots/default.png";n.getHotspotPreviewImage=function getHotspotPreviewImage(t){switch(t.model_type){case"default":return o;case"invisible":return"https://webxr-apps.byondxr.com/assets/images/hotspots/invisible.png";case"pin":return"https://webxr-apps.byondxr.com/assets/images/hotspots/pin.png";case"eye":return"https://webxr-apps.byondxr.com/assets/images/hotspots/eye.png";case"balloon":return"https://webxr-apps.byondxr.com/assets/images/hotspots/balloon.png";default:return o}}},function(t,n,i){"use strict";i.r(n),i.d(n,"Observable",(function(){return o.a})),i.d(n,"ConnectableObservable",(function(){return a.a})),i.d(n,"GroupedObservable",(function(){return s.a})),i.d(n,"observable",(function(){return m.a})),i.d(n,"Subject",(function(){return g.a})),i.d(n,"BehaviorSubject",(function(){return _.a})),i.d(n,"ReplaySubject",(function(){return S.a})),i.d(n,"AsyncSubject",(function(){return M.a})),i.d(n,"asap",(function(){return T.a})),i.d(n,"asapScheduler",(function(){return T.b})),i.d(n,"async",(function(){return O.a})),i.d(n,"asyncScheduler",(function(){return O.b})),i.d(n,"queue",(function(){return A.a})),i.d(n,"queueScheduler",(function(){return A.b})),i.d(n,"animationFrame",(function(){return j})),i.d(n,"animationFrameScheduler",(function(){return I})),i.d(n,"VirtualTimeScheduler",(function(){return V})),i.d(n,"VirtualAction",(function(){return U})),i.d(n,"Scheduler",(function(){return G.a})),i.d(n,"Subscription",(function(){return z.a})),i.d(n,"Subscriber",(function(){return H.a})),i.d(n,"Notification",(function(){return q.a})),i.d(n,"NotificationKind",(function(){return q.b})),i.d(n,"pipe",(function(){return Z.a})),i.d(n,"noop",(function(){return X.a})),i.d(n,"identity",(function(){return Q.a})),i.d(n,"isObservable",(function(){return isObservable})),i.d(n,"ArgumentOutOfRangeError",(function(){return Y.a})),i.d(n,"EmptyError",(function(){return J.a})),i.d(n,"ObjectUnsubscribedError",(function(){return K.a})),i.d(n,"UnsubscriptionError",(function(){return $.a})),i.d(n,"TimeoutError",(function(){return ee.a})),i.d(n,"bindCallback",(function(){return bindCallback})),i.d(n,"bindNodeCallback",(function(){return bindNodeCallback})),i.d(n,"combineLatest",(function(){return oe.b})),i.d(n,"concat",(function(){return ae.a})),i.d(n,"defer",(function(){return se.a})),i.d(n,"empty",(function(){return ce.b})),i.d(n,"forkJoin",(function(){return forkJoin})),i.d(n,"from",(function(){return le.a})),i.d(n,"fromEvent",(function(){return fromEvent})),i.d(n,"fromEventPattern",(function(){return fromEventPattern})),i.d(n,"generate",(function(){return generate})),i.d(n,"iif",(function(){return iif})),i.d(n,"interval",(function(){return interval})),i.d(n,"merge",(function(){return pe.a})),i.d(n,"never",(function(){return never})),i.d(n,"of",(function(){return me.a})),i.d(n,"onErrorResumeNext",(function(){return onErrorResumeNext})),i.d(n,"pairs",(function(){return pairs})),i.d(n,"partition",(function(){return partition})),i.d(n,"race",(function(){return be.a})),i.d(n,"range",(function(){return range})),i.d(n,"throwError",(function(){return _e.a})),i.d(n,"timer",(function(){return we.a})),i.d(n,"using",(function(){return using})),i.d(n,"zip",(function(){return xe.b})),i.d(n,"scheduled",(function(){return Se.a})),i.d(n,"EMPTY",(function(){return ce.a})),i.d(n,"NEVER",(function(){return fe})),i.d(n,"config",(function(){return Me.a}));var o=i(5),a=i(158),s=i(137),m=i(52),g=i(11),_=i(159),S=i(105),M=i(66),T=i(88),O=i(12),A=i(131),P=i(1),L=i(68),R=function(t){function AnimationFrameAction(n,i){var o=t.call(this,n,i)||this;return o.scheduler=n,o.work=i,o}return P.a(AnimationFrameAction,t),AnimationFrameAction.prototype.requestAsyncId=function(n,i,o){return void 0===o&&(o=0),null!==o&&o>0?t.prototype.requestAsyncId.call(this,n,i,o):(n.actions.push(this),n.scheduled||(n.scheduled=requestAnimationFrame((function(){return n.flush(null)}))))},AnimationFrameAction.prototype.recycleAsyncId=function(n,i,o){if(void 0===o&&(o=0),null!==o&&o>0||null===o&&this.delay>0)return t.prototype.recycleAsyncId.call(this,n,i,o);0===n.actions.length&&(cancelAnimationFrame(i),n.scheduled=void 0)},AnimationFrameAction}(L.a),N=i(65),I=new(function(t){function AnimationFrameScheduler(){return null!==t&&t.apply(this,arguments)||this}return P.a(AnimationFrameScheduler,t),AnimationFrameScheduler.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var n,i=this.actions,o=-1,a=i.length;t=t||i.shift();do{if(n=t.execute(t.state,t.delay))break}while(++o<a&&(t=i.shift()));if(this.active=!1,n){for(;++o<a&&(t=i.shift());)t.unsubscribe();throw n}},AnimationFrameScheduler}(N.a))(R),j=I,V=function(t){function VirtualTimeScheduler(n,i){void 0===n&&(n=U),void 0===i&&(i=Number.POSITIVE_INFINITY);var o=t.call(this,n,(function(){return o.frame}))||this;return o.maxFrames=i,o.frame=0,o.index=-1,o}return P.a(VirtualTimeScheduler,t),VirtualTimeScheduler.prototype.flush=function(){for(var t,n,i=this.actions,o=this.maxFrames;(n=i[0])&&n.delay<=o&&(i.shift(),this.frame=n.delay,!(t=n.execute(n.state,n.delay))););if(t){for(;n=i.shift();)n.unsubscribe();throw t}},VirtualTimeScheduler.frameTimeFactor=10,VirtualTimeScheduler}(N.a),U=function(t){function VirtualAction(n,i,o){void 0===o&&(o=n.index+=1);var a=t.call(this,n,i)||this;return a.scheduler=n,a.work=i,a.index=o,a.active=!0,a.index=n.index=o,a}return P.a(VirtualAction,t),VirtualAction.prototype.schedule=function(n,i){if(void 0===i&&(i=0),!this.id)return t.prototype.schedule.call(this,n,i);this.active=!1;var o=new VirtualAction(this.scheduler,this.work);return this.add(o),o.schedule(n,i)},VirtualAction.prototype.requestAsyncId=function(t,n,i){void 0===i&&(i=0),this.delay=t.frame+i;var o=t.actions;return o.push(this),o.sort(VirtualAction.sortActions),!0},VirtualAction.prototype.recycleAsyncId=function(t,n,i){void 0===i&&(i=0)},VirtualAction.prototype._execute=function(n,i){if(!0===this.active)return t.prototype._execute.call(this,n,i)},VirtualAction.sortActions=function(t,n){return t.delay===n.delay?t.index===n.index?0:t.index>n.index?1:-1:t.delay>n.delay?1:-1},VirtualAction}(L.a),G=i(132),z=i(9),H=i(3),q=i(44),Z=i(86),X=i(49),Q=i(40);function isObservable(t){return!!t&&(t instanceof o.a||"function"==typeof t.lift&&"function"==typeof t.subscribe)}var Y=i(58),J=i(62),K=i(55),$=i(90),ee=i(161),te=i(19),ne=i(115),re=i(13),ie=i(23);function bindCallback(t,n,i){if(n){if(!Object(ie.a)(n))return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return bindCallback(t,i).apply(void 0,o).pipe(Object(te.a)((function(t){return Object(re.a)(t)?n.apply(void 0,t):n(t)})))};i=n}return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];var s,m=this,g={context:m,subject:s,callbackFunc:t,scheduler:i};return new o.a((function(o){if(i){var a={args:n,subscriber:o,params:g};return i.schedule(dispatch,0,a)}if(!s){s=new M.a;try{t.apply(m,n.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];s.next(t.length<=1?t[0]:t),s.complete()}]))}catch(t){Object(ne.a)(s)?s.error(t):console.warn(t)}}return s.subscribe(o)}))}}function dispatch(t){var n=this,i=t.args,o=t.subscriber,a=t.params,s=a.callbackFunc,m=a.context,g=a.scheduler,_=a.subject;if(!_){_=a.subject=new M.a;try{s.apply(m,i.concat([function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=t.length<=1?t[0]:t;n.add(g.schedule(dispatchNext,0,{value:o,subject:_}))}]))}catch(t){_.error(t)}}this.add(_.subscribe(o))}function dispatchNext(t){var n=t.value,i=t.subject;i.next(n),i.complete()}function bindNodeCallback(t,n,i){if(n){if(!Object(ie.a)(n))return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return bindNodeCallback(t,i).apply(void 0,o).pipe(Object(te.a)((function(t){return Object(re.a)(t)?n.apply(void 0,t):n(t)})))};i=n}return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];var s={subject:void 0,args:n,callbackFunc:t,scheduler:i,context:this};return new o.a((function(o){var a=s.context,m=s.subject;if(i)return i.schedule(bindNodeCallback_dispatch,0,{params:s,subscriber:o,context:a});if(!m){m=s.subject=new M.a;try{t.apply(a,n.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=t.shift();i?m.error(i):(m.next(t.length<=1?t[0]:t),m.complete())}]))}catch(t){Object(ne.a)(m)?m.error(t):console.warn(t)}}return m.subscribe(o)}))}}function bindNodeCallback_dispatch(t){var n=this,i=t.params,o=t.subscriber,a=t.context,s=i.callbackFunc,m=i.args,g=i.scheduler,_=i.subject;if(!_){_=i.subject=new M.a;try{s.apply(a,m.concat([function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=t.shift();if(o)n.add(g.schedule(bindNodeCallback_dispatchError,0,{err:o,subject:_}));else{var a=t.length<=1?t[0]:t;n.add(g.schedule(bindNodeCallback_dispatchNext,0,{value:a,subject:_}))}}]))}catch(t){this.add(g.schedule(bindNodeCallback_dispatchError,0,{err:t,subject:_}))}}this.add(_.subscribe(o))}function bindNodeCallback_dispatchNext(t){var n=t.value,i=t.subject;i.next(n),i.complete()}function bindNodeCallback_dispatchError(t){var n=t.err;t.subject.error(n)}var oe=i(107),ae=i(74),se=i(109),ce=i(26),ue=i(114),le=i(28);function forkJoin(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(1===t.length){var i=t[0];if(Object(re.a)(i))return forkJoinInternal(i,null);if(Object(ue.a)(i)&&Object.getPrototypeOf(i)===Object.prototype){var o=Object.keys(i);return forkJoinInternal(o.map((function(t){return i[t]})),o)}}if("function"==typeof t[t.length-1]){var a=t.pop();return forkJoinInternal(t=1===t.length&&Object(re.a)(t[0])?t[0]:t,null).pipe(Object(te.a)((function(t){return a.apply(void 0,t)})))}return forkJoinInternal(t,null)}function forkJoinInternal(t,n){return new o.a((function(i){var o=t.length;if(0!==o)for(var a=new Array(o),s=0,m=0,_loop_1=function(g){var _=Object(le.a)(t[g]),S=!1;i.add(_.subscribe({next:function(t){S||(S=!0,m++),a[g]=t},error:function(t){return i.error(t)},complete:function(){++s!==o&&S||(m===o&&i.next(n?n.reduce((function(t,n,i){return t[n]=a[i],t}),{}):a),i.complete())}}))},g=0;g<o;g++)_loop_1(g);else i.complete()}))}var he=i(59);function fromEvent(t,n,i,a){return Object(he.a)(i)&&(a=i,i=void 0),a?fromEvent(t,n,i).pipe(Object(te.a)((function(t){return Object(re.a)(t)?a.apply(void 0,t):a(t)}))):new o.a((function(o){!function setupSubscription(t,n,i,o,a){var s;if(function isEventTarget(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){var m=t;t.addEventListener(n,i,a),s=function(){return m.removeEventListener(n,i,a)}}else if(function isJQueryStyleEventEmitter(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){var g=t;t.on(n,i),s=function(){return g.off(n,i)}}else if(function isNodeStyleEventEmitter(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){var _=t;t.addListener(n,i),s=function(){return _.removeListener(n,i)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var S=0,M=t.length;S<M;S++)setupSubscription(t[S],n,i,o,a)}o.add(s)}(t,n,(function handler(t){arguments.length>1?o.next(Array.prototype.slice.call(arguments)):o.next(t)}),o,i)}))}function fromEventPattern(t,n,i){return i?fromEventPattern(t,n).pipe(Object(te.a)((function(t){return Object(re.a)(t)?i.apply(void 0,t):i(t)}))):new o.a((function(i){var o,handler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i.next(1===t.length?t[0]:t)};try{o=t(handler)}catch(t){return void i.error(t)}if(Object(he.a)(n))return function(){return n(handler,o)}}))}function generate(t,n,i,a,s){var m,g;if(1==arguments.length){var _=t;g=_.initialState,n=_.condition,i=_.iterate,m=_.resultSelector||Q.a,s=_.scheduler}else void 0===a||Object(ie.a)(a)?(g=t,m=Q.a,s=a):(g=t,m=a);return new o.a((function(t){var o=g;if(s)return s.schedule(generate_dispatch,0,{subscriber:t,iterate:i,condition:n,resultSelector:m,state:o});for(;;){if(n){var a=void 0;try{a=n(o)}catch(n){return void t.error(n)}if(!a){t.complete();break}}var _=void 0;try{_=m(o)}catch(n){return void t.error(n)}if(t.next(_),t.closed)break;try{o=i(o)}catch(n){return void t.error(n)}}}))}function generate_dispatch(t){var n=t.subscriber,i=t.condition;if(!n.closed){if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void n.error(t)}else t.needIterate=!0;if(i){var o=void 0;try{o=i(t.state)}catch(t){return void n.error(t)}if(!o)return void n.complete();if(n.closed)return}var a;try{a=t.resultSelector(t.state)}catch(t){return void n.error(t)}if(!n.closed&&(n.next(a),!n.closed))return this.schedule(t)}}function iif(t,n,i){return void 0===n&&(n=ce.a),void 0===i&&(i=ce.a),Object(se.a)((function(){return t()?n:i}))}var de=i(69);function interval(t,n){return void 0===t&&(t=0),void 0===n&&(n=O.a),(!Object(de.a)(t)||t<0)&&(t=0),n&&"function"==typeof n.schedule||(n=O.a),new o.a((function(i){return i.add(n.schedule(interval_dispatch,t,{subscriber:i,counter:0,period:t})),i}))}function interval_dispatch(t){var n=t.subscriber,i=t.counter,o=t.period;n.next(i),this.schedule({subscriber:n,counter:i+1,period:o},o)}var pe=i(163),fe=new o.a(X.a);function never(){return fe}var me=i(80);function onErrorResumeNext(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)return ce.a;var i=t[0],a=t.slice(1);return 1===t.length&&Object(re.a)(i)?onErrorResumeNext.apply(void 0,i):new o.a((function(t){var subNext=function(){return t.add(onErrorResumeNext.apply(void 0,a).subscribe(t))};return Object(le.a)(i).subscribe({next:function(n){t.next(n)},error:subNext,complete:subNext})}))}function pairs(t,n){return n?new o.a((function(i){var o=Object.keys(t),a=new z.a;return a.add(n.schedule(pairs_dispatch,0,{keys:o,index:0,subscriber:i,subscription:a,obj:t})),a})):new o.a((function(n){for(var i=Object.keys(t),o=0;o<i.length&&!n.closed;o++){var a=i[o];t.hasOwnProperty(a)&&n.next([a,t[a]])}n.complete()}))}function pairs_dispatch(t){var n=t.keys,i=t.index,o=t.subscriber,a=t.subscription,s=t.obj;if(!o.closed)if(i<n.length){var m=n[i];o.next([m,s[m]]),a.add(this.schedule({keys:n,index:i+1,subscriber:o,subscription:a,obj:s}))}else o.complete()}var ge=i(175),ye=i(75),ve=i(43);function partition(t,n,i){return[Object(ve.a)(n,i)(new o.a(Object(ye.a)(t))),Object(ve.a)(Object(ge.a)(n,i))(new o.a(Object(ye.a)(t)))]}var be=i(164);function range(t,n,i){return void 0===t&&(t=0),new o.a((function(o){void 0===n&&(n=t,t=0);var a=0,s=t;if(i)return i.schedule(range_dispatch,0,{index:a,count:n,start:t,subscriber:o});for(;;){if(a++>=n){o.complete();break}if(o.next(s++),o.closed)break}}))}function range_dispatch(t){var n=t.start,i=t.index,o=t.count,a=t.subscriber;i>=o?a.complete():(a.next(n),a.closed||(t.index=i+1,t.start=n+1,this.schedule(t)))}var _e=i(106),we=i(165);function using(t,n){return new o.a((function(i){var o,a;try{o=t()}catch(t){return void i.error(t)}try{a=n(o)}catch(t){return void i.error(t)}var s=(a?Object(le.a)(a):ce.a).subscribe(i);return function(){s.unsubscribe(),o&&o.unsubscribe()}}))}var xe=i(110),Se=i(170),Me=i(39)},function(t,n,i){"use strict";i.d(n,"b",(function(){return s})),i.d(n,"a",(function(){return m}));var o=i(1),a=function(t){function QueueAction(n,i){var o=t.call(this,n,i)||this;return o.scheduler=n,o.work=i,o}return o.a(QueueAction,t),QueueAction.prototype.schedule=function(n,i){return void 0===i&&(i=0),i>0?t.prototype.schedule.call(this,n,i):(this.delay=i,this.state=n,this.scheduler.flush(this),this)},QueueAction.prototype.execute=function(n,i){return i>0||this.closed?t.prototype.execute.call(this,n,i):this._execute(n,i)},QueueAction.prototype.requestAsyncId=function(n,i,o){return void 0===o&&(o=0),null!==o&&o>0||null===o&&this.delay>0?t.prototype.requestAsyncId.call(this,n,i,o):n.flush(this)},QueueAction}(i(68).a),s=new(function(t){function QueueScheduler(){return null!==t&&t.apply(this,arguments)||this}return o.a(QueueScheduler,t),QueueScheduler}(i(65).a))(a),m=s},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=function(){function Scheduler(t,n){void 0===n&&(n=Scheduler.now),this.SchedulerAction=t,this.now=n}return Scheduler.prototype.schedule=function(t,n,i){return void 0===n&&(n=0),new this.SchedulerAction(this,t).schedule(i,n)},Scheduler.now=function(){return Date.now()},Scheduler}()},function(t,n,i){"use strict";i.d(n,"a",(function(){return FunctionCallNode}));var o=i(2);function FunctionCallNode(t,n){o.a.call(this),this.setFunction(t,n)}FunctionCallNode.prototype=Object.create(o.a.prototype),FunctionCallNode.prototype.constructor=FunctionCallNode,FunctionCallNode.prototype.nodeType="FunctionCall",FunctionCallNode.prototype.setFunction=function(t,n){this.value=t,this.inputs=n||[]},FunctionCallNode.prototype.getFunction=function(){return this.value},FunctionCallNode.prototype.getType=function(t){return this.value.getType(t)},FunctionCallNode.prototype.generate=function(t,n){for(var i=this.getType(t),o=this.value,a=o.build(t,n)+"( ",s=[],m=0;m<o.inputs.length;m++){var g=o.inputs[m],_=this.inputs[m]||this.inputs[g.name];s.push(_.build(t,t.getTypeByFormat(g.type)))}return a+=s.join(", ")+" )",t.format(a,i,n)},FunctionCallNode.prototype.copy=function(t){for(var n in o.a.prototype.copy.call(this,t),t.inputs)this.inputs[n]=t.inputs[n];return this.value=t.value,this},FunctionCallNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);if(!n){var i=this.value;if((n=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,i.inputs.length){n.inputs={};for(var o=0;o<i.inputs.length;o++){var a=i.inputs[o],s=this.inputs[o]||this.inputs[a.name];n.inputs[a.name]=s.toJSON(t).uuid}}}return n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return TextureCubeUVNode}));var o=i(2),a=i(16),s=i(111),m=i(7),g=i(133),_=i(15),S=i(14),M=i(35),T=i(61),O=i(60);function TextureCubeUVNode(t,n,i){o.a.call(this,"v4"),this.value=t,this.uv=n,this.bias=i}TextureCubeUVNode.Nodes=function(){var t=new s.a("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),n=new a.a("float cubeUV_maxMipLevel 8.0",!0),i=new a.a("float cubeUV_minMipLevel 4.0",!0),o=new a.a("float cubeUV_maxTileSize 256.0",!0),g=new a.a("float cubeUV_minTileSize 16.0",!0),_=new m.a("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");_.useKeywords=!1;var S=new m.a("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");S.useKeywords=!1;var M=new m.a("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[t,_,S,n,i,o,g]);M.useKeywords=!1;var T=new a.a("float r0 1.0",!0),O=new a.a("float v0 0.339",!0),A=new a.a("float m0 -2.0",!0),P=[T,O,A,new a.a("float r1 0.8",!0),new a.a("float v1 0.276",!0),new a.a("float m1 -1.0",!0),new a.a("float r4 0.4",!0),new a.a("float v4 0.046",!0),new a.a("float m4 2.0",!0),new a.a("float r5 0.305",!0),new a.a("float v5 0.016",!0),new a.a("float m5 3.0",!0),new a.a("float r6 0.21",!0),new a.a("float v6 0.0038",!0),new a.a("float m6 4.0",!0)];return{bilinearCubeUV:M,roughnessToMip:new m.a("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",P),m0:A,cubeUV_maxMipLevel:n}}(),TextureCubeUVNode.prototype=Object.create(o.a.prototype),TextureCubeUVNode.prototype.constructor=TextureCubeUVNode,TextureCubeUVNode.prototype.nodeType="TextureCubeUV",TextureCubeUVNode.prototype.bilinearCubeUV=function(t,n,i,o){var a=new g.a(TextureCubeUVNode.Nodes.bilinearCubeUV,[n,i,o]);this.colorSpaceTL=this.colorSpaceTL||new O.a(new _.a("","v4")),this.colorSpaceTL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(a.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR||new O.a(new _.a("","v4")),this.colorSpaceTR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(a.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL||new O.a(new _.a("","v4")),this.colorSpaceBL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(a.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR||new O.a(new _.a("","v4")),this.colorSpaceBR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(a.build(t)+".br");var s={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(s),this.colorSpaceTLExp=new _.a(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new _.a(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new _.a(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new _.a(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();var m=new _.a("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return m.keywords.cubeUV_TL=this.colorSpaceTLExp,m.keywords.cubeUV_TR=this.colorSpaceTRExp,m.keywords.cubeUV_BL=this.colorSpaceBLExp,m.keywords.cubeUV_BR=this.colorSpaceBRExp,m.keywords.cubeUV=a,m},TextureCubeUVNode.prototype.generate=function(t,n){if(t.isShader("fragment")){var i=this.uv,o=this.bias||t.context.roughness,a=new g.a(TextureCubeUVNode.Nodes.roughnessToMip,[o]),s=new T.a(a,TextureCubeUVNode.Nodes.m0,TextureCubeUVNode.Nodes.cubeUV_maxMipLevel,T.a.CLAMP),m=new T.a(s,T.a.FLOOR),_=new T.a(s,T.a.FRACT),O=this.bilinearCubeUV(t,this.value,i,m),A=this.bilinearCubeUV(t,this.value,i,new M.a(m,new S.a(1).setReadonly(!0),M.a.ADD)),P=new T.a(O,A,_,T.a.MIX);return t.format(P.build(t),"v4",n)}return console.warn("THREE.TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),n)},TextureCubeUVNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,n.uv=this.uv.toJSON(t).uuid,n.bias=this.bias.toJSON(t).uuid),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return RawNode}));var o=i(8);function RawNode(t){o.a.call(this,"v4"),this.value=t}RawNode.prototype=Object.create(o.a.prototype),RawNode.prototype.constructor=RawNode,RawNode.prototype.nodeType="Raw",RawNode.prototype.generate=function(t){var n=this.value.analyzeAndFlow(t,this.type),i=n.code+"\n";return t.isShader("vertex")?i+="gl_Position = "+n.result+";":i+="gl_FragColor = "+n.result+";",i},RawNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.value=t.value,this},RawNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value.toJSON(t).uuid),n}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CameraControlsImpl=void 0;var s=i(328),m=i(0),g=i(17),_=i(10),S=i(260),M=i(18),T=function(){function CameraControlsImpl(t){this.enabled=!1,this.isVR=!1,this.gyroPresent=!1,this.gyroEnabled=!0,this.subscribtions=[],this.prevHeight=0,this.appManager=t,this.resizeFunc=this.onResize.bind(this),this.onDelayResizeFunc=this.onDelayResize.bind(this),this.onCameraMoveFunc=this.onCameraMove.bind(this),this.onCameraZoomFunc=this.onCameraZoom.bind(this)}return CameraControlsImpl.prototype.onCameraMove=function(){this.appManager.eventManager.next({origin:this,eventType:new _.CameraMoveEvent})},CameraControlsImpl.prototype.onCameraZoom=function(){this.appManager.eventManager.next({origin:this,eventType:new _.CameraZoomEvent})},CameraControlsImpl.prototype.freezeCamera=function(t){this.IsCameraFreezed=t},CameraControlsImpl.prototype.calcFrustum=function(){this.camera.updateMatrix(),this.camera.updateMatrixWorld(!0),this.camera.matrixWorldInverse.copy(this.camera.matrixWorld).invert(),this.frustum=new m.Frustum,this.frustum.setFromProjectionMatrix((new m.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse))},CameraControlsImpl.prototype.init=function(t,n){return o(this,void 0,void 0,(function(){return a(this,(function(n){return this.camera=t||new m.PerspectiveCamera(80,this.appManager.container.offsetWidth/this.appManager.container.offsetHeight,.01,700),this.dummyCalcObj=new m.Object3D,this.dummyCalcObj.name="dummyCalcObj",this.camera.add(this.dummyCalcObj),this.renderManager=new S.RenderManager(this.appManager),this.renderManager.init(),this.erd=s(),[2]}))}))},CameraControlsImpl.prototype.getAngleXFromCamera=function(t,n){if(void 0===n&&(n=!1),n){var i=new m.Vector3;i=t.getWorldPosition(i),this.dummyCalcObj.lookAt(i)}else this.dummyCalcObj.rotation.set(0,0,0);this.dummyCalcObj.updateMatrixWorld(!0),t.updateMatrixWorld(!0);var o=new m.Matrix4;o=o.getInverse(this.dummyCalcObj.matrixWorld);var a,s=t.matrixWorld.multiply(o),g=90*s.elements[0],_=90*s.elements[2];return(a=g>0&&_>=0?g:g>0&&_<0?180-g:g<0&&_<0?180+-1*g:360+g)>=180?a-180:a+180},CameraControlsImpl.prototype.calcDistanceFromCamera=function(t){var n=new m.Vector3,i=new m.Vector3;return n.setFromMatrixPosition(this.camera.matrixWorld),i.setFromMatrixPosition(t.matrixWorld),n.distanceTo(i)},CameraControlsImpl.prototype.resetGyro=function(t){void 0===t&&(t=!0);var n=this.gyroManager.initialCenter.toVector3();t&&((n=this.camera.rotation.toVector3()).multiplyScalar(180/Math.PI),this.isAndroid()&&n.setY(n.y+90));var i=(new m.Euler).setFromVector3(n,"YXZ");this.gyroManager.initMembers(i)},CameraControlsImpl.prototype.isAndroid=function(){return navigator.userAgent.toLowerCase().indexOf("android")>-1},CameraControlsImpl.prototype.enableGyro=function(){this.gyroEnabled=!0},CameraControlsImpl.prototype.disableGyro=function(){this.gyroEnabled=!1},CameraControlsImpl.prototype.isObjectVisible=function(t){return!!this.frustum&&this.frustum.intersectsBox(t)},CameraControlsImpl.prototype.getCubeCamera=function(){return this.cubeCamera||(this.cubeCamera=new m.CubeCamera(.01,700,new m.WebGLCubeRenderTarget(256)),this.cubeCamera.name="cubeCamera",this.camera.add(this.cubeCamera)),this.cubeCamera},CameraControlsImpl.prototype.enable=function(){this.enabled||(this.enabled=!0,window.addEventListener("resize",this.resizeFunc),window.matchMedia("(orientation: portrait)").addEventListener("change",this.onDelayResizeFunc),window.addEventListener("orientationchange",this.onDelayResizeFunc),window.addEventListener("fullscreenchange",this.onDelayResizeFunc),window.addEventListener("mozfullscreenchange",this.onDelayResizeFunc),window.addEventListener("MSFullscreenChange",this.onDelayResizeFunc),window.addEventListener("webkitfullscreenchange",this.onDelayResizeFunc),this.erd.listenTo(this.appManager.container,this.resizeFunc),this.addListeners())},CameraControlsImpl.prototype.disable=function(){this.enabled&&(window.removeEventListener("resize",this.resizeFunc),window.matchMedia("(orientation: portrait)").removeEventListener("change",this.onDelayResizeFunc),window.removeEventListener("orientationchange",this.onDelayResizeFunc),window.removeEventListener("fullscreenchange",this.onDelayResizeFunc),window.removeEventListener("mozfullscreenchange",this.onDelayResizeFunc),window.removeEventListener("MSFullscreenChange",this.onDelayResizeFunc),window.removeEventListener("webkitfullscreenchange",this.onDelayResizeFunc),this.erd.removeAllListeners(this.appManager.container),this.enabled=!1,this.removeListeners())},CameraControlsImpl.prototype.addListeners=function(){var t=this,n=this;this.isGyroPresentFunc=function(t){(t.rotationRate.alpha||t.rotationRate.beta||t.rotationRate.gamma)&&(n.gyroPresent=!0)},window.addEventListener("devicemotion",this.isGyroPresentFunc),this.subscribtions.push(this.appManager.renderEventManager.subscribe((function(){t.calcFrustum()}))),this.subscribtions.push(this.appManager.eventManager.pipe(M.filter((function(t){return t.eventType.name===(new _.ShouldRenderEvent).name||t.eventType===_.ShouldRenderEvent}))).subscribe((function(n){t._render(n.message.time)})))},CameraControlsImpl.prototype.removeListeners=function(){window.removeEventListener("devicemotion",this.isGyroPresentFunc),this.subscribtions.forEach((function(t){t.unsubscribe()}))},CameraControlsImpl.prototype.onDelayResize=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,g.Utils.sleep(300)];case 1:return t.sent(),[4,this.resizeFunc()];case 2:return t.sent(),this._render(),[2]}}))}))},CameraControlsImpl.prototype.onResize=function(){var t;return o(this,void 0,void 0,(function(){var n,i,o,s,m,_,S,M;return a(this,(function(a){switch(a.label){case 0:return this.enabled?[4,g.Utils.sleep(100)]:[2];case 1:return a.sent(),n=null===(t=this.appManager.currentExperience.renderer)||void 0===t?void 0:t.domElement,i=n.getBoundingClientRect(),o=i.width,s=i.height,m=o/s,this.camera.aspect=m,m>1?(_=80,this.camera.fov=360*Math.atan(Math.tan(_*Math.PI/360)/this.camera.aspect)/Math.PI):(_=60,this.camera.fov=_),S=this.appManager.container.offsetWidth,M=this.appManager.container.offsetHeight,this.appManager.currentExperience.renderer.setSize(S,M),this.appManager.currentExperience.cssRenderer.setSize(S,M),this.camera.updateProjectionMatrix(),this._render(),[2]}}))}))},CameraControlsImpl.prototype.destroy=function(){this.disable(),this.camera.parent.remove(this.camera),this.camera=void 0},CameraControlsImpl.prototype.setCameraHeight=function(t,n){return void 0===n&&(n=1),o(this,void 0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:return(i=this.camera.position.clone()).y=t,[4,g.Utils.setPosition(this.camera,i,n)];case 1:return o.sent(),[2]}}))}))},CameraControlsImpl.prototype.animateCamera=function(t,n,i,s,g,_,S){return void 0===s&&(s=0),o(this,void 0,void 0,(function(){var i,o;return a(this,(function(a){switch(a.label){case 0:return i=new m.Vector3(t.x,t.y,t.z),(o=[]).push(this.changeCamPosition(i,s,g,S)),n&&o.push(this.changeCamRotation(n,i,s,_)),[4,Promise.all(o)];case 1:return a.sent(),[2]}}))}))},CameraControlsImpl.prototype.changeCamPosition=function(t,n,i,s){return void 0===n&&(n=0),o(this,void 0,void 0,(function(){return a(this,(function(o){switch(o.label){case 0:return i||(i=new Array),i.push(this.onCameraMoveFunc),[4,g.Utils.setPosition(this.camera,t,n,i,s)];case 1:return o.sent(),[2]}}))}))},CameraControlsImpl.prototype.changeCamRotation=function(t,n,i,s){return void 0===i&&(i=0),o(this,void 0,void 0,(function(){var o;return a(this,(function(a){switch(a.label){case 0:return o=this.GetLookAtQuaternion(this.camera,t,n),s||(s=new Array),s.push(this.onCameraMoveFunc),[4,g.Utils.setQuaternion(this.camera,o,i,s)];case 1:return a.sent(),[2]}}))}))},CameraControlsImpl.prototype.handleGyro=function(){if(this.gyroEnabled){var t=this.gyroManager.getGyroCoordinates();t&&this.camera.rotation.copy(t)}},CameraControlsImpl.prototype.GetLookAtQuaternion=function(t,n,i){var o=t.position.clone(),a=t.quaternion.clone();t.position.set(i.x,i.y,i.z),t.lookAt(n);var s=t.quaternion.clone();return t.position.copy(o),t.quaternion.copy(a),s},CameraControlsImpl.prototype.FocusCameraOnObject=function(t,n,i,s,_){return void 0===n&&(n=0),void 0===i&&(i=1),o(this,void 0,void 0,(function(){var o,S,M,T,O,A,P;return a(this,(function(a){switch(a.label){case 0:return o=new m.Box3,Array.isArray(t)?t.forEach((function(t){o=g.Utils.ExpandBoxByObj(o,t)})):o=g.Utils.SetBoxFromObj(o,t),S=new m.Vector3,S=o.getCenter(S),M=new m.Vector3,M=o.getSize(M),T=this.camera.aspect,O=this.camera.fov*Math.PI/180,A=M.y/i/2/Math.tan(O/2),M.x/T>M.y&&(A=M.x/i/2/Math.tan(O/2)/T),P=new m.Vector3(S.x,S.y,S.z+A),[4,this.changeCamPosition(P,n,s,_)];case 1:return a.sent(),[2]}}))}))},CameraControlsImpl}();n.CameraControlsImpl=T},function(t,n,i){"use strict";i.d(n,"b",(function(){return groupBy})),i.d(n,"a",(function(){return T}));var o=i(1),a=i(3),s=i(9),m=i(5),g=i(11);function groupBy(t,n,i,o){return function(a){return a.lift(new _(t,n,i,o))}}var _=function(){function GroupByOperator(t,n,i,o){this.keySelector=t,this.elementSelector=n,this.durationSelector=i,this.subjectSelector=o}return GroupByOperator.prototype.call=function(t,n){return n.subscribe(new S(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},GroupByOperator}(),S=function(t){function GroupBySubscriber(n,i,o,a,s){var m=t.call(this,n)||this;return m.keySelector=i,m.elementSelector=o,m.durationSelector=a,m.subjectSelector=s,m.groups=null,m.attemptedToUnsubscribe=!1,m.count=0,m}return o.a(GroupBySubscriber,t),GroupBySubscriber.prototype._next=function(t){var n;try{n=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,n)},GroupBySubscriber.prototype._group=function(t,n){var i=this.groups;i||(i=this.groups=new Map);var o,a=i.get(n);if(this.elementSelector)try{o=this.elementSelector(t)}catch(t){this.error(t)}else o=t;if(!a){a=this.subjectSelector?this.subjectSelector():new g.a,i.set(n,a);var s=new T(n,a,this);if(this.destination.next(s),this.durationSelector){var m=void 0;try{m=this.durationSelector(new T(n,a))}catch(t){return void this.error(t)}this.add(m.subscribe(new M(n,a,this)))}}a.closed||a.next(o)},GroupBySubscriber.prototype._error=function(t){var n=this.groups;n&&(n.forEach((function(n,i){n.error(t)})),n.clear()),this.destination.error(t)},GroupBySubscriber.prototype._complete=function(){var t=this.groups;t&&(t.forEach((function(t,n){t.complete()})),t.clear()),this.destination.complete()},GroupBySubscriber.prototype.removeGroup=function(t){this.groups.delete(t)},GroupBySubscriber.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&t.prototype.unsubscribe.call(this))},GroupBySubscriber}(a.a),M=function(t){function GroupDurationSubscriber(n,i,o){var a=t.call(this,i)||this;return a.key=n,a.group=i,a.parent=o,a}return o.a(GroupDurationSubscriber,t),GroupDurationSubscriber.prototype._next=function(t){this.complete()},GroupDurationSubscriber.prototype._unsubscribe=function(){var t=this.parent,n=this.key;this.key=this.parent=null,t&&t.removeGroup(n)},GroupDurationSubscriber}(a.a),T=function(t){function GroupedObservable(n,i,o){var a=t.call(this)||this;return a.key=n,a.groupSubject=i,a.refCountSubscription=o,a}return o.a(GroupedObservable,t),GroupedObservable.prototype._subscribe=function(t){var n=new s.a,i=this.refCountSubscription,o=this.groupSubject;return i&&!i.closed&&n.add(new O(i)),n.add(o.subscribe(t)),n},GroupedObservable}(m.a),O=function(t){function InnerRefCountSubscription(n){var i=t.call(this)||this;return i.parent=n,n.count++,i}return o.a(InnerRefCountSubscription,t),InnerRefCountSubscription.prototype.unsubscribe=function(){var n=this.parent;n.closed||this.closed||(t.prototype.unsubscribe.call(this),n.count-=1,0===n.count&&n.attemptedToUnsubscribe&&n.unsubscribe())},InnerRefCountSubscription}(s.a)},function(t,n){t.exports=stringify,stringify.default=stringify,stringify.stable=deterministicStringify,stringify.stableStringify=deterministicStringify;var i=[],o=[];function stringify(t,n,a){var s;for(function decirc(t,n,a,s){var m;if("object"==typeof t&&null!==t){for(m=0;m<a.length;m++)if(a[m]===t){var g=Object.getOwnPropertyDescriptor(s,n);return void(void 0!==g.get?g.configurable?(Object.defineProperty(s,n,{value:"[Circular]"}),i.push([s,n,t,g])):o.push([t,n]):(s[n]="[Circular]",i.push([s,n,t])))}if(a.push(t),Array.isArray(t))for(m=0;m<t.length;m++)decirc(t[m],m,a,t);else{var _=Object.keys(t);for(m=0;m<_.length;m++){var S=_[m];decirc(t[S],S,a,t)}}a.pop()}}(t,"",[],void 0),s=0===o.length?JSON.stringify(t,n,a):JSON.stringify(t,replaceGetterValues(n),a);0!==i.length;){var m=i.pop();4===m.length?Object.defineProperty(m[0],m[1],m[3]):m[0][m[1]]=m[2]}return s}function compareFunction(t,n){return t<n?-1:t>n?1:0}function deterministicStringify(t,n,a){var s,m=function deterministicDecirc(t,n,a,s){var m;if("object"==typeof t&&null!==t){for(m=0;m<a.length;m++)if(a[m]===t){var g=Object.getOwnPropertyDescriptor(s,n);return void(void 0!==g.get?g.configurable?(Object.defineProperty(s,n,{value:"[Circular]"}),i.push([s,n,t,g])):o.push([t,n]):(s[n]="[Circular]",i.push([s,n,t])))}if("function"==typeof t.toJSON)return;if(a.push(t),Array.isArray(t))for(m=0;m<t.length;m++)deterministicDecirc(t[m],m,a,t);else{var _={},S=Object.keys(t).sort(compareFunction);for(m=0;m<S.length;m++){var M=S[m];deterministicDecirc(t[M],M,a,t),_[M]=t[M]}if(void 0===s)return _;i.push([s,n,t]),s[n]=_}a.pop()}}(t,"",[],void 0)||t;for(s=0===o.length?JSON.stringify(m,n,a):JSON.stringify(m,replaceGetterValues(n),a);0!==i.length;){var g=i.pop();4===g.length?Object.defineProperty(g[0],g[1],g[3]):g[0][g[1]]=g[2]}return s}function replaceGetterValues(t){return t=void 0!==t?t:function(t,n){return n},function(n,i){if(o.length>0)for(var a=0;a<o.length;a++){var s=o[a];if(s[1]===n&&s[0]===i){i="[Circular]",o.splice(a,1);break}}return t.call(this,n,i)}}},function(t,n,i){"use strict";(function(n){void 0===n||!n.version||0===n.version.indexOf("v0.")||0===n.version.indexOf("v1.")&&0!==n.version.indexOf("v1.8.")?t.exports={nextTick:function nextTick(t,i,o,a){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var s,m,g=arguments.length;switch(g){case 0:case 1:return n.nextTick(t);case 2:return n.nextTick((function afterTickOne(){t.call(null,i)}));case 3:return n.nextTick((function afterTickTwo(){t.call(null,i,o)}));case 4:return n.nextTick((function afterTickThree(){t.call(null,i,o,a)}));default:for(s=new Array(g-1),m=0;m<s.length;)s[m++]=arguments[m];return n.nextTick((function afterTick(){t.apply(null,s)}))}}}:t.exports=n}).call(this,i(25))},function(t,n,i){"use strict";var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(t,n){return Object.prototype.hasOwnProperty.call(t,n)}n.assign=function(t){for(var n=Array.prototype.slice.call(arguments,1);n.length;){var i=n.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var o in i)_has(i,o)&&(t[o]=i[o])}}return t},n.shrinkBuf=function(t,n){return t.length===n?t:t.subarray?t.subarray(0,n):(t.length=n,t)};var a={arraySet:function(t,n,i,o,a){if(n.subarray&&t.subarray)t.set(n.subarray(i,i+o),a);else for(var s=0;s<o;s++)t[a+s]=n[i+s]},flattenChunks:function(t){var n,i,o,a,s,m;for(o=0,n=0,i=t.length;n<i;n++)o+=t[n].length;for(m=new Uint8Array(o),a=0,n=0,i=t.length;n<i;n++)s=t[n],m.set(s,a),a+=s.length;return m}},s={arraySet:function(t,n,i,o,a){for(var s=0;s<o;s++)t[a+s]=n[i+s]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,a)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(o)},function(t,n,i){t.exports=i(415)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Networking=void 0,(n.Networking||(n.Networking={})).get=function get(t,n,i){return void 0===i&&(i="GET"),new Promise((function(o,a){var s=new XMLHttpRequest;s.onload=function(t){return o(t.target.response)},n.onprogress&&"function"==typeof n.onprogress&&(s.onprogress=function(t){n.onprogress(t)}),s.onerror=function(t){return a(t)},s.onabort=function(t){return a(t)},s.open(i,t,!0),n&&n.dataType&&(s.responseType=n.dataType),n&&n.headers&&n.headers.forEach((function(t){s.setRequestHeader(t.name,t.value)})),s.send()}))}},function(t,n,i){var o=i(441),a=i(442),s=a;s.v1=o,s.v4=a,t.exports=s},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Notify=void 0,i(443),i(446);var o,a=i(448),s=i(449),m=i(130),g=i(95);!function(t){var n=!1;t.setDebugMode=function setDebugMode(t){n=t},t.Send=function Send(t,i,o,m){if(void 0===m&&(m=3500),n||"error"===o){var g=""+s;t=t.charAt(0).toUpperCase()+t.slice(1),g=(g=g.replace("$$title",t)).replace("$$msg",i),new a({text:g,theme:"mint",type:o,force:"error"===o||"alert"===o,timeout:m}).show()}}}(o=n.Notify||(n.Notify={})),function addOfflineWarning(){window.addEventListener("offline",(function(t){o.Send("error","Network is unavailable","error")}))}(),function addMemorycheckWarning(){m.interval(3e3).subscribe((function(){var t=g.DeviceUtils.getMemoryInfo();t&&t.size&&t.limit&&t.size/t.limit>.9&&o.Send("warning","The device is about to reach the memory limit","warning")}))}(),function addIphone6Warning(){g.DeviceUtils.isIOS()&&g.DeviceUtils.IphoneUtils.isIphoneModel("6")&&o.Send("error","This device is not fully supported","error")}()},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GyroscopeManager=n.MotionAxisOptions=n.GyroMotionOptions=n.GyroOptions=void 0;var o=i(0),a=i(34),s=i(10),m=function GyroOptions(){this.max_x=180,this.min_x=-180,this.max_y=180,this.min_y=-180,this.max_z=180,this.min_z=-180,this.motion=new g};n.GyroOptions=m;var g=function GyroMotionOptions(){this.x_axis=new _,this.z_axis=new _};n.GyroMotionOptions=g;var _=function MotionAxisOptions(){this.angle_threshold=45,this.angle_duration=200,this.distance=3,this.motion_duration=500};n.MotionAxisOptions=_;var S=function(){function GyroscopeManager(t,n,i){void 0===i&&(i=new o.Euler(0,0,0)),this.initialRotation=void 0,this.rotation=new o.Euler(0,0,0),this.preResetRotation=new o.Euler(0,0,0),this.quaternion=new o.Quaternion(0,0,0,0),this.zee=new o.Vector3(0,0,1),this.euler=new o.Euler,this.q0=new o.Quaternion,this.q1=new o.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this.zCenter=void 0,this.xCenter=void 0,this.yCenter=void 0,this.options=new m,this.xMotionQueue=[],this.zMotionQueue=[],this.androidFactor=0,this.firstInit=!0,this.gyroReseted=!1,this.appManager=t,this.initialCenter=i,this.options=n}return GyroscopeManager.prototype.init=function(){this.screenOrientation=window.orientation||0,this.DeviceOrientationChangeEvent=this.onDeviceOrientationChangeEvent.bind(this),this.ScreenOrientationChangeEvent=this.onScreenOrientationChangeEvent.bind(this),this.initMembers(),window.addEventListener("orientationchange",this.ScreenOrientationChangeEvent,!1),window.addEventListener("deviceorientation",this.DeviceOrientationChangeEvent,!1),this.initialScreenOrientation=this.screenOrientation,this.update(),this.options.motion&&this.handleMotion()},GyroscopeManager.prototype.initMembers=function(t,n){void 0===t&&(t=this.initialCenter),void 0===n&&(n=this.options),this.gyroReseted=!0,this.androidFactor=this.isAndroid()?-Math.PI/2:0,this.initialRotation=void 0,this.quaternion=new o.Quaternion(0,0,0,0),this.zee=new o.Vector3(0,0,1),this.euler=new o.Euler,this.q0=new o.Quaternion,this.q1=new o.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this.xMotionQueue=[],this.zMotionQueue=[],this.initialCenter.copy(t),this.xCenter=t.x,this.yCenter=t.y,this.zCenter=t.z,this.rotation.reorder("YXZ"),this.deviceOrientation={},this.setGyroOptions(this.options)},GyroscopeManager.prototype.setGyroOptions=function(t){t.max_z&&(this.options.max_z=Math.min(+t.max_z,180)),t.max_x&&(this.options.max_x=Math.min(+t.max_x,180)),t.max_y&&(this.options.max_y=Math.min(+t.max_y,180)),t.min_z&&(this.options.min_z=Math.max(+t.min_z,-179)),t.min_x&&(this.options.min_x=Math.max(+t.min_x,-179)),t.min_y&&(this.options.min_y=Math.max(+t.min_y,-179)),this.options.motion=t.motion},GyroscopeManager.prototype.onDeviceOrientationChangeEvent=function(t){this.deviceOrientation=t,this.update()},GyroscopeManager.prototype.onScreenOrientationChangeEvent=function(){this.screenOrientation=window.orientation||0,this.initMembers(),this.update()},GyroscopeManager.prototype.setQuaternion=function(t,n,i,a){this.euler.set(n,t,-i,"YXZ"),this.quaternion.setFromEuler(this.euler),this.quaternion.multiply(this.q1),this.quaternion.multiply(this.q0.setFromAxisAngle(this.zee,-a)),this.initialRotation||(this.initialRotation=new o.Euler,this.initialRotation.setFromQuaternion(this.quaternion,"YXZ")),this.recenterCoordinates()},GyroscopeManager.prototype.recenterCoordinates=function(){if(this.rotation.setFromQuaternion(this.quaternion,"YXZ"),!this.rotation.equals(this.initialRotation)){this.firstInit&&(this.initialRotation=new o.Euler(0,0,0),this.firstInit=!1);var t=this.options.max_z+this.zCenter,n=this.options.max_x+this.xCenter,i=this.options.max_y+this.yCenter,a=this.options.min_z+this.zCenter,s=this.options.min_x+this.xCenter,m=this.options.min_y+this.yCenter;t>360&&(t-=360),n>360&&(n-=360),i>360&&(i-=360),a<0&&(a+=360),s<0&&(s+=360),m<0&&(m+=360);var g=o.MathUtils.radToDeg(this.rotation.z-this.initialRotation.z),_=o.MathUtils.radToDeg(this.rotation.x-this.initialRotation.x),S=o.MathUtils.radToDeg(this.rotation.y-this.initialRotation.y+this.androidFactor)+this.initialScreenOrientation;this.isAndroid()&&S<-180&&(S+=360),S<0&&(S+=360),g<0&&(g+=360),_>=0&&S>90&&S<270&&g>90&&g<270&&(_=180-_),_<0&&(_=S<90||S>270||g<90||g>270?360+_:180-_),(g+=this.initialCenter.z)>360&&(g-=360),(_+=this.initialCenter.x)>360&&(_-=360),(S+=this.initialCenter.y)>360&&(S-=360),g<0&&(g+=360),_<0&&(_+=360),S<0&&(S+=360),this.calculateNewCenters(_,n,s,S,i,m,g,t,a),_-=this.xCenter-this.initialCenter.x,(S-=this.yCenter-this.initialCenter.y)>180&&(S-=360),(g-=this.zCenter-this.initialCenter.z)>180&&(g-=360),_>270&&(_-=360),_>90&&(_=180-_),this.rotation.set(o.MathUtils.degToRad(_),o.MathUtils.degToRad(S),o.MathUtils.degToRad(g)),this.gyroReseted=!1}},GyroscopeManager.prototype.calculateNewCenters=function(t,n,i,o,a,s,m,g,_){n<t&&!(n<i&&t>i)&&(n>=i?Math.abs(t-n)>Math.abs(t-360-i)?this.xCenter=t-this.options.min_x:this.xCenter=t-this.options.max_x:Math.abs(t-i)>Math.abs(t-n)&&(this.xCenter=t-this.options.max_x)),i>t&&!(n<i&&t<n)&&(n>=i?Math.abs(t-i)>Math.abs(t+360-n)?this.xCenter=t-this.options.max_x:this.xCenter=t-this.options.min_x:Math.abs(t-i)<Math.abs(t-n)&&(this.xCenter=t-this.options.min_x)),g<m&&!(g<_&&m>_)&&(g>=_?Math.abs(m-g)>Math.abs(m-360-_)?this.zCenter=m-this.options.min_z:this.zCenter=m-this.options.max_z:Math.abs(m-_)>Math.abs(m-g)&&(this.zCenter=m-this.options.max_z)),_>m&&!(g<_&&m<g)&&(g>=_?Math.abs(m-_)>Math.abs(m+360-g)?this.zCenter=m-this.options.max_z:this.zCenter=m-this.options.min_z:Math.abs(m-_)<Math.abs(m-g)&&(this.zCenter=m-this.options.min_z)),a<o&&!(a<s&&o>s)&&(a>=s?Math.abs(o-a)>Math.abs(o-360-s)?this.yCenter=o-this.options.min_y:this.yCenter=o-this.options.max_y:Math.abs(o-s)>Math.abs(o-a)&&(this.yCenter=o-this.options.max_y)),s>o&&!(a<s&&o<a)&&(a>=s?Math.abs(o-s)>Math.abs(o+360-a)?this.yCenter=o-this.options.max_y:this.yCenter=o-this.options.min_y:Math.abs(o-s)<Math.abs(o-a)&&(this.yCenter=o-this.options.min_y)),this.zCenter>360&&(this.zCenter-=360),this.xCenter>360&&(this.xCenter-=360),this.yCenter>360&&(this.yCenter-=360),this.zCenter<0&&(this.zCenter+=360),this.xCenter<0&&(this.xCenter+=360),this.yCenter<0&&(this.yCenter+=360)},GyroscopeManager.prototype.handleMotion=function(){if(this.quaternion){var t=new o.Euler;if(t.setFromQuaternion(this.quaternion,"YXZ"),t.equals(this.initialRotation))setTimeout(this.handleMotion.bind(this),10);else{if(this.options.motion.x_axis){this.xMotionQueue.push(o.MathUtils.radToDeg(t.z)),this.xMotionQueue.length>this.options.motion.x_axis.angle_duration/10&&this.xMotionQueue.shift();var n=Math.max.apply(Math,this.xMotionQueue),i=Math.min.apply(Math,this.xMotionQueue);if(n-i>this.options.motion.x_axis.angle_threshold){var a=this.xMotionQueue.indexOf(n)>this.xMotionQueue.indexOf(i)?-1:1;return this.fireMotionEvent("x",a),this.xMotionQueue=[],void setTimeout(this.handleMotion.bind(this),1e3)}}if(this.options.motion.z_axis){this.zMotionQueue.push(o.MathUtils.radToDeg(t.x)),this.zMotionQueue.length>this.options.motion.z_axis.angle_duration/10&&this.zMotionQueue.shift();var s=Math.max.apply(Math,this.zMotionQueue),m=Math.min.apply(Math,this.zMotionQueue);if(s-m>this.options.motion.z_axis.angle_threshold)return a=this.zMotionQueue.indexOf(s)>this.zMotionQueue.indexOf(m)?1:-1,this.fireMotionEvent("z",a),this.zMotionQueue=[],void setTimeout(this.handleMotion.bind(this),1e3)}this&&setTimeout(this.handleMotion.bind(this),10)}}else setTimeout(this.handleMotion.bind(this),10)},GyroscopeManager.prototype.fireMotionEvent=function(t,n){this.appManager.eventManager.next(new a.EventMessage(this,new s.GyroMotionEvent,{motionAxis:t,motionDirection:n,gyroManager:this}))},GyroscopeManager.prototype.update=function(){var t=this.deviceOrientation;if(t){var n=t.alpha?o.MathUtils.degToRad(t.alpha):0,i=t.beta?o.MathUtils.degToRad(t.beta):0,a=t.gamma?o.MathUtils.degToRad(t.gamma):0,s=this.screenOrientation?o.MathUtils.degToRad(this.screenOrientation):0;this.setQuaternion(n,i,a,s)}},GyroscopeManager.prototype.getGyroCoordinates=function(){if(!this.gyroReseted)return this.rotation.clone()},GyroscopeManager.prototype.isAndroid=function(){return navigator.userAgent.toLowerCase().indexOf("android")>-1},GyroscopeManager}();n.GyroscopeManager=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.OrbitCameraControls=void 0;var g=i(98),_=i(17),S=i(0),M=i(145),T=function(t){function OrbitCameraControls(n,i){void 0===i&&(i=new g.OrbitControlsOptions);var o=t.call(this,n,i)||this;return o.rotateSpeed=-.25,o.max_y=1/0,o.min_y=-1/0,o.target={x:0,y:0,z:-1e-4},o}return a(OrbitCameraControls,t),OrbitCameraControls.prototype.init=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this,n)];case 1:return i.sent(),this.orbitControls.enabled=!1,this.orbitControls.enableDamping=!0,this.orbitControls.screenSpacePanning=!0,this.orbitControls.enableKeys=!1,this.setCameraOptions(this.orbitOptions),this.camera.name="OrbitCamera",this.orbitControls.target.set(this.target.x,this.target.y,this.target.z),this.orbitControls.rotateSpeed=this.rotateSpeed,this.orbitControls.update(),this.appManager.currentExperience.scene.add(this.camera),[2]}}))}))},OrbitCameraControls.prototype.onCameraMove=function(){t.prototype.onCameraMove.call(this);var n=this.orbitOptions.max_y,i=this.orbitOptions.min_y;n||0===n||(n=1/0),i||0===i||(i=-1/0),this.orbitControls.target.set(this.target.x,Math.min(Math.max(this.orbitControls.target.y,i),n),this.target.z),this.gyroManager&&this.gyroPresent&&this.handleGyro()},OrbitCameraControls.prototype.ensureCameraLimits=function(){if(!new S.Vector3(0,0,-1e-4).equals(this.orbitControls.target)){var t=this.camera.position.distanceTo(this.orbitControls.target),n=this.orbitOptions.min_y-(this.orbitControls.target.y-t),i=t+this.orbitControls.target.y-this.orbitOptions.max_y,o=this.orbitOptions.max_polar_angle,a=this.orbitOptions.min_polar_angle;void 0===o&&(o=Math.PI),void 0===a&&(a=0),n>0&&n<t&&(this.orbitControls.maxPolarAngle=Math.min(o,Math.max(a,Math.PI/2+Math.asin((t-n)/t)))),i>0&&i<t&&(this.orbitControls.minPolarAngle=Math.max(a,Math.min(o,Math.PI/2-Math.asin((t-i)/t)))),this.camera.position.y>this.max_y&&this.camera.position.setY(this.max_y),this.camera.position.y<this.min_y&&this.camera.position.setY(this.min_y)}},OrbitCameraControls.prototype._render=function(t){this.enabled&&(this.gyroManager&&this.gyroPresent&&this.handleGyro(),this.orbitControls.enabled&&(this.orbitControls.update(),this.ensureCameraLimits()),this.cubeCamera&&this.cubeCamera.update(this.appManager.currentExperience.renderer,this.appManager.currentExperience.scene),this.appManager.currentExperience.renderer.render(this.appManager.currentExperience.scene,this.camera),this.appManager.currentExperience.cssRenderer.render(this.appManager.currentExperience.scene,this.camera),this.appManager.renderEventManager.next(t))},OrbitCameraControls.prototype.destroy=function(){t.prototype.destroy.call(this),this.orbitControls.dispose(),this.orbitControls=void 0},OrbitCameraControls.prototype.setCameraHeight=function(n,i){return s(this,void 0,void 0,(function(){var o,a;return m(this,(function(s){switch(s.label){case 0:return o=this.orbitControls.enabled,this.orbitControls.enabled=!1,[4,t.prototype.setCameraHeight.call(this,n,i)];case 1:return s.sent(),a=_.Utils.getLookAtVector(this.camera),this.orbitControls.target.set(a.x,a.y,a.z),this.orbitControls.enabled=o,[2]}}))}))},OrbitCameraControls.prototype.animateCamera=function(n,i,o,a){return void 0===a&&(a=0),s(this,void 0,void 0,(function(){var s;return m(this,(function(m){switch(m.label){case 0:return this.orbitControls.enabled=!1,[4,t.prototype.animateCamera.call(this,n,i,o,a)];case 1:return m.sent(),s=o?i:_.Utils.getLookAtVector(this.camera),this.orbitControls.target.set(s.x,s.y,s.z),this.target=s,this.orbitControls.enabled=!0,[2]}}))}))},OrbitCameraControls.prototype.setCameraAttr=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return t.orbit_camera?[4,this.setCameraOptions(t.orbit_camera)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},OrbitCameraControls.prototype.setCameraOptions=function(t){return s(this,void 0,void 0,(function(){var n,i;return m(this,(function(o){switch(o.label){case 0:return n=new S.Vector3(0,0,0),t.target&&(i=new S.Vector3(+t.target.x,+t.target.y,+t.target.z)),t.position&&(n=new S.Vector3(+t.position.x,+t.position.y,+t.position.z)),[4,this.animateCamera(n,i,!!i,0)];case 1:return o.sent(),this.orbitOptions=t,this.orbitControls.maxDistance=t.max_distance?+t.max_distance:1/0,this.orbitControls.minDistance=t.min_distance?+t.min_distance:0,this.orbitControls.maxZoom=t.max_zoom?+t.max_zoom:1/0,this.orbitControls.minZoom=t.min_zoom?+t.min_zoom:0,this.orbitControls.maxPolarAngle=t.max_polar_angle?+t.max_polar_angle:Math.PI,this.orbitControls.minPolarAngle=t.min_polar_angle?+t.min_polar_angle:0,this.orbitControls.maxAzimuthAngle=t.max_azimuth_angle?+t.max_azimuth_angle:1/0,this.orbitControls.minAzimuthAngle=t.min_azimuth_angle?+t.min_azimuth_angle:-1/0,this.orbitControls.enableZoom=void 0!==t.max_distance||void 0!==t.min_distance,this.orbitControls.enablePan=void 0!==t.enable_pan&&"true"===t.enable_pan,this.max_y=+t.max_y,this.min_y=+t.min_y,this.orbitControls.max_y=this.max_y,this.orbitControls.min_y=this.min_y,this.orbitControls.autoRotate=!!t.auto_rotate,this.orbitControls.autoRotateSpeed=t.auto_rotate_speed,t.angular_rotation&&(this.orbitControls.maxPolarAngle=t.angular_rotation.vertical_max?S.MathUtils.degToRad(+t.angular_rotation.vertical_max):Math.PI,this.orbitControls.minPolarAngle=t.angular_rotation.vertical_min?S.MathUtils.degToRad(+t.angular_rotation.vertical_min):0,this.orbitControls.maxAzimuthAngle=t.angular_rotation.horizontal_max?S.MathUtils.degToRad(+t.angular_rotation.horizontal_max):1/0,this.orbitControls.minAzimuthAngle=t.angular_rotation.horizontal_min?S.MathUtils.degToRad(+t.angular_rotation.horizontal_min):-1/0),this.orbitOptions.max_azimuth_angle=this.orbitControls.maxAzimuthAngle,this.orbitOptions.min_azimuth_angle=this.orbitControls.minAzimuthAngle,this.orbitOptions.max_polar_angle=this.orbitControls.maxPolarAngle,this.orbitOptions.min_polar_angle=this.orbitControls.minPolarAngle,this.orbitOptions.gyro&&(this.gyroManager=new M.GyroscopeManager(this.appManager,this.orbitOptions.gyro),this.gyroManager.init()),this.autoRotateThreshold=t.auto_rotate_threshold?+t.auto_rotate_threshold:this.autoRotateThreshold,this.renderManager.setFPS(+t.fps||60),[2]}}))}))},OrbitCameraControls}(g.OrbitBasedCameraControls);n.OrbitCameraControls=T},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.Video=n.VideoStatus=n.VideoOptions=void 0;var s=i(77),m=i(457);Object.defineProperty(n,"Video",{enumerable:!0,get:function(){return m.Video}});var g,_=function(t){function VideoOptions(){var n=null!==t&&t.apply(this,arguments)||this;return n.loop=!1,n.preload=!1,n.autoplay=!1,n.muted=!1,n}return a(VideoOptions,t),VideoOptions}(s.ImageOptions);n.VideoOptions=_,(g=n.VideoStatus||(n.VideoStatus={}))[g.Unloaded=0]="Unloaded",g[g.Loading=1]="Loading",g[g.Ready=2]="Ready",g[g.Playing=3]="Playing",g[g.Paused=4]="Paused",g[g.Stoped=5]="Stoped",g[g.Ended=6]="Ended"},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Subscription=n.EventListBase=n.DispatcherWrapper=n.DispatcherBase=void 0;var o=i(458);Object.defineProperty(n,"DispatcherBase",{enumerable:!0,get:function(){return o.DispatcherBase}}),Object.defineProperty(n,"DispatcherWrapper",{enumerable:!0,get:function(){return o.DispatcherWrapper}}),Object.defineProperty(n,"EventListBase",{enumerable:!0,get:function(){return o.EventListBase}});var a=i(264);Object.defineProperty(n,"Subscription",{enumerable:!0,get:function(){return a.Subscription}})},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}},s=this&&this.__spreadArrays||function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;var o=Array(t),a=0;for(n=0;n<i;n++)for(var s=arguments[n],m=0,g=s.length;m<g;m++,a++)o[a]=s[m];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.ModelsUtils=void 0;var m=i(0),g=i(180),_=i(472),S=i(473),M=i(583),T=i(474),O=i(584),A=i(475),P=i(17),L=i(73),R=i(272),N=i(95),I=new A.DRACOLoader;I.setDecoderPath("./assets/libs/draco/"),N.DeviceUtils.isWebAssemblySupported()||I.setDecoderConfig({type:"js"}),function(t){function LoadObJ(t,n){return o(this,void 0,void 0,(function(){var i;return a(this,(function(o){return i=new S.OBJLoader,n&&(n.preload(),i.setMaterials(n)),[2,new Promise((function(n,o){i.load(t,(function(t){n(t)}),null,(function(t){o(t)}))}))]}))}))}function LoadMtl(t,n){return o(this,void 0,void 0,(function(){var i;return a(this,(function(o){return i=new T.MTLLoader,n&&i.setResourcePath(n),[2,new Promise((function(n,o){i.load(t,(function(t){n(t)}),null,(function(t){o(t)}))}))]}))}))}function extractObjZip(t,n){return o(this,void 0,void 0,(function(){var i,o,s,m,_,S,M,T,O;return a(this,(function(a){switch(a.label){case 0:return[4,R.JsZipUtils.getBinaryContent(t)];case 1:return i=a.sent(),[4,L.JsUtils.LoadZipData(i)];case 2:for(_ in o=a.sent(),s=o.files,m=[],s)s[_].name&&(S=s[_],M=g.join(n,S.name),m.push(getZipDataAndSave(S,M)));return[4,Promise.all(m)];case 3:return a.sent().forEach((function(t){"obj"===P.Utils.getExtension(t)&&(T=t),"mtl"===P.Utils.getExtension(t)&&(O=t)})),[2,{objPath:T,mtlPath:O}]}}))}))}function getZipDataAndSave(t,n){return o(this,void 0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:return t.dir?[4,L.JsUtils.SaveDirectoryToFileSystem(n)]:[3,2];case 1:return[2,o.sent()];case 2:return[4,L.JsUtils.ZipDataToBlob(t)];case 3:return i=o.sent(),[4,L.JsUtils.SaveFileToFileSystem(n,i)];case 4:return[2,o.sent()]}}))}))}t.GetDracoLoader=function GetDracoLoader(){return I},t.LoadModelFromUrl=function LoadModelFromUrl(n,i,s){return o(this,void 0,void 0,(function(){var o,g,_,S;return a(this,(function(a){switch(a.label){case 0:switch(P.Utils.getExtension(i)){case"zip":case"obj":return[3,1];case"glb":return[3,3];case"fbx":return[3,5]}return[3,7];case 1:return[4,t.loadZipObj(n,s,i)];case 2:return o=a.sent(),[3,8];case 3:return[4,t.LoadGltfModel(n,i)];case 4:return _=a.sent(),(o=new m.Group).add(_.scene),_.animations&&_.animations.length&&(g=n.animationManager.addMixer(o),_.animations.forEach((function(t){var n=g.clipAction(t);n.setLoop(m.LoopRepeat,void 0),n.play()})),n.animationManager.setEnable(!0)),[3,8];case 5:return[4,t.LoadFBXModel(n,i)];case 6:return S=a.sent(),o=S,S.animations&&S.animations.length&&(g=n.animationManager.addMixer(o),S.animations.forEach((function(t){var n=g.clipAction(t);n.setLoop(m.LoopRepeat,void 0),n.play()})),n.animationManager.setEnable(!0)),[3,8];case 7:return o=new m.Group,[3,8];case 8:return[2,{obj:o,animationMixer:g}]}}))}))},t.loadZipObj=function loadZipObj(n,i,s){return o(this,void 0,void 0,(function(){var o,m;return a(this,(function(a){switch(a.label){case 0:return(o=n.currentExperience.prefetchManager.get(s,"zip"))?[4,o]:[3,2];case 1:return[2,a.sent().clone()];case 2:return[4,L.JsUtils.SaveDirectoryToFileSystem(i)];case 3:return a.sent(),[4,extractObjZip(s,i)];case 4:return m=a.sent(),[4,t.LoadObjMtl(m.objPath,m.mtlPath,g.join(L.JsUtils.FileSystemPrefix,i))];case 5:return[2,a.sent()]}}))}))},t.LoadObjectJsonModel=function LoadObjectJsonModel(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){return n=new m.ObjectLoader,[2,new Promise((function(i,o){n.load(t,(function(t){i(t)}),null,(function(t){o(t)}))}))]}))}))},t.LoadColladaModel=function LoadColladaModel(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){return n=new O.ColladaLoader,[2,new Promise((function(i,o){n.load(t,(function(t){i(t)}),null,(function(t){o(t)}))}))]}))}))},t.LoadFBXModel=function LoadFBXModel(t,n){return o(this,void 0,void 0,(function(){var i,o;return a(this,(function(a){switch(a.label){case 0:return(i=t.currentExperience.prefetchManager.get(n,"fbx"))?[4,i]:[3,2];case 1:return[2,a.sent().clone()];case 2:return(o=new M.FBXLoader).setCrossOrigin("anonymous"),[2,new Promise((function(t,i){o.load(n,(function(n){t(n)}),null,(function(t){i(t)}))}))]}}))}))},t.LoadGltfModel=function LoadGltfModel(t,n){return o(this,void 0,void 0,(function(){var i,o,m;return a(this,(function(a){switch(a.label){case 0:return(i=t.currentExperience.prefetchManager.get(n,"glb"))?[4,i]:[3,2];case 1:return o=a.sent(),[2,{animations:s(o.animations||[]),asset:Object.assign({},o.asset),cameras:s(o.cameras||[]),scene:o.scene.clone(),scenes:s(o.scenes||[]),parser:o.parser,userData:o.userData}];case 2:return(m=new _.GLTFLoader).setCrossOrigin("anonymous"),m.setDRACOLoader(I),[2,new Promise((function(t,i){m.load(n,(function(n){t(n)}),null,(function(t){i(t)}))}))]}}))}))},t.LoadObjMtl=function LoadObjMtl(t,n,i){return o(this,void 0,void 0,(function(){var o;return a(this,(function(a){switch(a.label){case 0:return[4,LoadMtl(n,i)];case 1:return o=a.sent(),[2,LoadObJ(t,o)]}}))}))},t.LoadObJ=LoadObJ,t.LoadMtl=LoadMtl}(n.ModelsUtils||(n.ModelsUtils={}))},function(t,n,i){"use strict";i.r(n),i.d(n,"RenderPass",(function(){return RenderPass}));var o=i(0),a=i(30),RenderPass=function(t,n,i,s,m){a.a.call(this),this.scene=t,this.camera=n,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=void 0!==m?m:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new o.Color};RenderPass.prototype=Object.assign(Object.create(a.a.prototype),{constructor:RenderPass,render:function(t,n,i){var o,a,s=t.autoClear;t.autoClear=!1,void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),o=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:i),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,o),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),t.autoClear=s}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(495);Object.defineProperty(n,"ScreenFactory",{enumerable:!0,get:function(){return o.ScreenFactory}});var a=i(102);Object.defineProperty(n,"ScreenMetadata",{enumerable:!0,get:function(){return a.ScreenMetadata}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TransparentBackground=n.EquirectangularBackgroundImageStereo=n.EquirectangularBackgroundVideoStereo=n.EquirectangularBackgroundImage=n.EquirectangularBackgroundVideo=n.EquirectangularBackground=n.CubemapBackgroundVideo=n.CubemapBackgroundImage=n.CubemapBackground=void 0;var o=i(195);Object.defineProperty(n,"CubemapBackground",{enumerable:!0,get:function(){return o.CubemapBackground}});var a=i(496);Object.defineProperty(n,"CubemapBackgroundImage",{enumerable:!0,get:function(){return a.CubemapBackgroundImage}});var s=i(499);Object.defineProperty(n,"CubemapBackgroundVideo",{enumerable:!0,get:function(){return s.CubemapBackgroundVideo}});var m=i(127);Object.defineProperty(n,"EquirectangularBackground",{enumerable:!0,get:function(){return m.EquirectangularBackground}});var g=i(291);Object.defineProperty(n,"EquirectangularBackgroundVideo",{enumerable:!0,get:function(){return g.EquirectangularBackgroundVideo}});var _=i(292);Object.defineProperty(n,"EquirectangularBackgroundImage",{enumerable:!0,get:function(){return _.EquirectangularBackgroundImage}});var S=i(500);Object.defineProperty(n,"EquirectangularBackgroundVideoStereo",{enumerable:!0,get:function(){return S.EquirectangularBackgroundVideoStereo}});var M=i(501);Object.defineProperty(n,"EquirectangularBackgroundImageStereo",{enumerable:!0,get:function(){return M.EquirectangularBackgroundImageStereo}});var T=i(502);Object.defineProperty(n,"TransparentBackground",{enumerable:!0,get:function(){return T.TransparentBackground}})},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.GridBaseElement=void 0;var s=i(0),m=i(187),g=i(17),_=function(){function GridBaseElement(t,n,i){this._OnPropertieChanged=new m.EventDispatcher,this.material=new s.MeshBasicMaterial({opacity:.2,transparent:!0,visible:!1,color:g.Utils.randomColor()}),this._wireframe=!1,this.parent=t,this.initialPosition=n,this.cellSize=new s.Vector3(+i.x,+i.y,+i.z)}return GridBaseElement.prototype.init=function(){},GridBaseElement.prototype.enable=function(){},GridBaseElement.prototype.disable=function(){},GridBaseElement.prototype.checkProp=function(){},Object.defineProperty(GridBaseElement.prototype,"wireframe",{get:function(){return this._wireframe},set:function(t){this._wireframe=t,this.material.visible=t},enumerable:!1,configurable:!0}),Object.defineProperty(GridBaseElement.prototype,"OnPropertieChanged",{get:function(){return this._OnPropertieChanged.asEvent()},enumerable:!1,configurable:!0}),GridBaseElement.prototype.setPosition=function(t,n){return void 0===n&&(n=0),o(this,void 0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:return i=this,[4,g.Utils.setPosition(this.obj,t,n,[function(){i._OnPropertieChanged.dispatch(i,"position")}])];case 1:return o.sent(),[2]}}))}))},GridBaseElement.prototype.setRotation=function(t,n){return void 0===n&&(n=0),o(this,void 0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:return i=this,[4,g.Utils.setRotation(this.obj,t,n,[function(){i._OnPropertieChanged.dispatch(i,"rotation")}])];case 1:return o.sent(),[2]}}))}))},GridBaseElement.prototype.setScale=function(t,n){return void 0===n&&(n=0),o(this,void 0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:return i=this,[4,g.Utils.setScale(this.obj,t,n,[function(){i._OnPropertieChanged.dispatch(i,"scale")}])];case 1:return o.sent(),[2]}}))}))},GridBaseElement.prototype.destroy=function(){this._OnPropertieChanged.clear(),this.parent instanceof GridBaseElement?this.parent.obj.remove(this.obj):this.parent.remove(this.obj),this.gridChild&&this.gridChild.destroy()},GridBaseElement}();n.GridBaseElement=_},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.GalleryImpl=void 0;var g=i(0),_=function(t){function GalleryImpl(n,i,o,a,s){void 0===a&&(a=2),void 0===s&&(s=3);var m=t.call(this,n,i,o)||this;return m.objects=new Array,m.obj=new g.Group,m}return a(GalleryImpl,t),GalleryImpl.prototype.constructGalleryObjects=function(t){return s(this,void 0,void 0,(function(){var n,i,o,a,s,g;return m(this,(function(m){switch(m.label){case 0:for(n=[],i=0;i<t.length;i++)o=t[i],(a=this.constructObject(o,this))&&n.push(a);return[4,Promise.all(n)];case 1:return s=m.sent(),g=[],s.forEach((function(t){t&&g.push(t)})),[2,g]}}))}))},GalleryImpl.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},GalleryImpl.prototype.setEnabled=function(t){this.enabled=t},GalleryImpl.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(n){return this.visible=t,[2]}))}))},GalleryImpl.prototype.setObjectGroupVisible=function(t,n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){var o;return m(this,(function(a){switch(a.label){case 0:return o=[],n.forEach((function(n){o.push(n.setVisible(t,i))})),[4,Promise.all(o)];case 1:return a.sent(),[2]}}))}))},GalleryImpl.prototype.setObjectGroupEnabled=function(t,n){n.forEach((function(n){n.setEnabled(t)}))},GalleryImpl.prototype.objectsSortOrder=function(t){var n=Object.assign([],t);return n.sort((function(t,n){var i=t.getCustomAttribute("$$order"),o=n.getCustomAttribute("$$order");return i||(i=0),o||(o=0),i-o})),n},GalleryImpl.prototype.destroy=function(){t.prototype.destroy.call(this),this.objects.forEach((function(t){t.forEach((function(t){t.destroy()}))}))},GalleryImpl}(i(46).ByondInteractiveElement);n.GalleryImpl=_},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.BaseGalleryElementMetadata=void 0;var m=i(36),g=i(32),_=function(t){function BaseGalleryElementMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(BaseGalleryElementMetadata,t),Object.defineProperty(BaseGalleryElementMetadata.prototype,"ElementName",{get:function(){return"BaseGalleryElementMetadata"},enumerable:!1,configurable:!0}),s([m.Type((function(){return g.Metadata.BaseElementMetadata}))],BaseGalleryElementMetadata.prototype,"data",void 0),BaseGalleryElementMetadata}(g.Metadata.Element3DMetadata);n.BaseGalleryElementMetadata=_},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.GridBasedGallery=void 0;var g=i(0),_=i(46),S=i(307),M=i(305),T=function(t){function GridBasedGallery(n,i,o,a,s,m,_,S,M){void 0===a&&(a=2),void 0===s&&(s=3),void 0===m&&(m=1),void 0===_&&(_=0),void 0===S&&(S=new g.Vector2(.5,.5)),void 0===M&&(M=new g.Vector3(4,2,.1));var T=t.call(this,n,i,o)||this;T.currentPage=0,T.obj=new g.Group,T.nRow=a,T.nCol=s,T.nElementsInPage=a*s;var O=n.data.length%T.nElementsInPage==0?n.data.length/T.nElementsInPage:Math.floor(n.data.length/T.nElementsInPage)+1;return T.nOfPages=O,T.alpha=m,T.padding=_,T.margin=S,T.cellSize=M,T}return a(GridBasedGallery,t),GridBasedGallery.prototype.constructElementsPage=function(t){return s(this,void 0,void 0,(function(){var n,i;return m(this,(function(o){switch(o.label){case 0:return this.grid.getTables(),n=this.metadata.data.slice(t*this.nElementsInPage,t*this.nElementsInPage+this.nElementsInPage),[4,this.constructGalleryObjects(n)];case 1:return i=o.sent(),this.objects[t]=i,[2]}}))}))},GridBasedGallery.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return this.nElementsInPage=this.nRow*this.nCol,this.nOfPages=this.metadata.data.length%this.nElementsInPage==0?this.metadata.data.length/this.nElementsInPage:Math.floor(this.metadata.data.length/this.nElementsInPage)+1,this.grid=new S.Grid(this.obj,this.nCol,this.nRow,this.nOfPages,new g.Vector3(0,0,0),this.cellSize,this.padding,this.margin),this.grid.init(),[4,this.constructElementsPage(0)];case 1:return n.sent(),[4,t.prototype.init.call(this)];case 2:return n.sent(),[4,this.initPage(this.currentPage)];case 3:return n.sent(),[4,this.grid.enable()];case 4:return n.sent(),this.metadata.paging_controls_layout&&"none"!==this.metadata.paging_controls_layout?(this.galleryNavigationButtons=new M.GalleryNavigationButtons(this,this.nOfPages),[4,this.galleryNavigationButtons.init()]):[3,6];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},GridBasedGallery.prototype.constructObject=function(t,n){return s(this,void 0,void 0,(function(){var i;return m(this,(function(o){switch(o.label){case 0:return[4,this.appManager.elementsRegistry.GetElement(t,n)];case 1:return(i=o.sent())&&i[0]?[2,i[0]]:[2]}}))}))},GridBasedGallery.prototype.setEnabled=function(t){this.setObjectGroupEnabled(t,this.CurrentPageElements),this.galleryNavigationButtons&&this.galleryNavigationButtons.setEnabled(t)},GridBasedGallery.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,this.setObjectGroupVisible(t,this.CurrentPageElements,n)];case 1:return i.sent(),this.galleryNavigationButtons?[4,this.galleryNavigationButtons.setVisible(t,n)]:[3,3];case 2:i.sent(),i.label=3;case 3:return t?[4,this.setAlpha(this.alpha)]:[3,5];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},GridBasedGallery.prototype.setAlpha=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i;return m(this,(function(o){switch(o.label){case 0:return i=[],this.CurrentPageElements.forEach((function(o){o instanceof _.ByondInteractiveElement&&i.push(o.setAlpha(t,n))})),[4,Promise.all(i)];case 1:return o.sent(),[2]}}))}))},GridBasedGallery.prototype.initPage=function(t){return s(this,void 0,void 0,(function(){var n,i,o,a,s=this;return m(this,(function(m){switch(m.label){case 0:return n=this.grid.getTables(),i=n[t],o=i.getCells(),a=[],this.objects[t]&&this.objects[t].length?[3,2]:[4,this.constructElementsPage(t)];case 1:m.sent(),m.label=2;case 2:return o.forEach((function(n,i){if(!n.hasChild&&s.metadata.data.length>s.nElementsInPage*t+i){var o=s.objects[t][i];a.push(s.initAndAttachElementsToCell(o,n))}})),[4,Promise.all(a)];case 3:return m.sent(),[2]}}))}))},GridBasedGallery.prototype.initAndAttachElementsToCell=function(t,n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.init()];case 1:return i.sent(),n.setContainedChild(t.obj),[4,n.enable()];case 2:return i.sent(),t.updateTransformMetadata(),[2]}}))}))},Object.defineProperty(GridBasedGallery.prototype,"CurrentPageElements",{get:function(){return this.objects[this.currentPage]},enumerable:!1,configurable:!0}),GridBasedGallery.prototype.animateToPage=function(t){return s(this,void 0,void 0,(function(){var n,i;return m(this,(function(o){switch(o.label){case 0:return this.CurrentPageElements.forEach((function(t){t.setEnabled(!1)})),n=0,i=this.nCol*this.grid.cellSize.x,n=t>this.currentPage?i:-i,[4,this.initPage(t)];case 1:return o.sent(),Promise.all([this.animatePage(this.currentPage,new g.Vector3(n,0,0),null,0,.5),this.animatePage(t,new g.Vector3(0,0,0),new g.Vector3(-n,0,0),this.alpha,.5)]),this.currentPage=t,this.CurrentPageElements.forEach((function(t){t.setEnabled(!0)})),[4,this.grid.enable()];case 2:return o.sent(),[2]}}))}))},GridBasedGallery.prototype.animatePage=function(t,n,i,o,a){return void 0===o&&(o=1),void 0===a&&(a=0),s(this,void 0,void 0,(function(){var s,g,S;return m(this,(function(m){switch(m.label){case 0:return s=this.grid.getTables()[t],g=this.objects[t],S=[],g.forEach((function(t){t instanceof _.ByondInteractiveElement&&S.push(t.setAlpha(o,a))})),i&&s.setPosition(i,0),S.push(s.setPosition(n,a)),[4,Promise.all(S)];case 1:return m.sent(),[2]}}))}))},GridBasedGallery}(i(154).GalleryImpl);n.GridBasedGallery=T},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.LightElementImpl=void 0;var g=i(46),_=i(22),S=function(t){function LightElementImpl(){return null!==t&&t.apply(this,arguments)||this}return a(LightElementImpl,t),LightElementImpl.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o;return m(this,(function(a){switch(a.label){case 0:return this.setLight(),[4,t.prototype.init.call(this)];case 1:return a.sent(),n=this.getMetadata().cast_shadows,this.obj.castShadow=n,(i=this.getCustomAttribute(_.CustomAttributes.ShadowBiasCustomAttribute))&&this.obj.shadow&&(this.obj.shadow.bias=i),(o=this.getCustomAttribute(_.CustomAttributes.ShadowMapCustomAttribute))&&o.size&&(this.obj.shadow.mapSize.x=o.size.x,this.obj.shadow.mapSize.y=o.size.y),[2]}}))}))},LightElementImpl.prototype.getMetadata=function(){return this.metadata},LightElementImpl.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},LightElementImpl}(g.ByondInteractiveElement);n.LightElementImpl=S},function(t,n,i){"use strict";i.d(n,"a",(function(){return M})),i.d(n,"b",(function(){return T}));var o,a=i(1),s=i(11),m=i(5),g=i(3),_=i(9),S=i(104),M=function(t){function ConnectableObservable(n,i){var o=t.call(this)||this;return o.source=n,o.subjectFactory=i,o._refCount=0,o._isComplete=!1,o}return a.a(ConnectableObservable,t),ConnectableObservable.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},ConnectableObservable.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},ConnectableObservable.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new _.a).add(this.source.subscribe(new O(this.getSubject(),this))),t.closed&&(this._connection=null,t=_.a.EMPTY)),t},ConnectableObservable.prototype.refCount=function(){return Object(S.a)()(this)},ConnectableObservable}(m.a),T={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(o=M.prototype)._subscribe},_isComplete:{value:o._isComplete,writable:!0},getSubject:{value:o.getSubject},connect:{value:o.connect},refCount:{value:o.refCount}},O=function(t){function ConnectableSubscriber(n,i){var o=t.call(this,n)||this;return o.connectable=i,o}return a.a(ConnectableSubscriber,t),ConnectableSubscriber.prototype._error=function(n){this._unsubscribe(),t.prototype._error.call(this,n)},ConnectableSubscriber.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},ConnectableSubscriber.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var n=t._connection;t._refCount=0,t._subject=null,t._connection=null,n&&n.unsubscribe()}},ConnectableSubscriber}(s.b);g.a},function(t,n,i){"use strict";i.d(n,"a",(function(){return m}));var o=i(1),a=i(11),s=i(55),m=function(t){function BehaviorSubject(n){var i=t.call(this)||this;return i._value=n,i}return o.a(BehaviorSubject,t),Object.defineProperty(BehaviorSubject.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),BehaviorSubject.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return i&&!i.closed&&n.next(this._value),i},BehaviorSubject.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new s.a;return this._value},BehaviorSubject.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},BehaviorSubject}(a.a)},function(t,n,i){"use strict";i.d(n,"b",(function(){return observeOn})),i.d(n,"a",(function(){return g}));var o=i(1),a=i(3),s=i(44);function observeOn(t,n){return void 0===n&&(n=0),function observeOnOperatorFunction(i){return i.lift(new m(t,n))}}var m=function(){function ObserveOnOperator(t,n){void 0===n&&(n=0),this.scheduler=t,this.delay=n}return ObserveOnOperator.prototype.call=function(t,n){return n.subscribe(new g(t,this.scheduler,this.delay))},ObserveOnOperator}(),g=function(t){function ObserveOnSubscriber(n,i,o){void 0===o&&(o=0);var a=t.call(this,n)||this;return a.scheduler=i,a.delay=o,a}return o.a(ObserveOnSubscriber,t),ObserveOnSubscriber.dispatch=function(t){var n=t.notification,i=t.destination;n.observe(i),this.unsubscribe()},ObserveOnSubscriber.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(ObserveOnSubscriber.dispatch,this.delay,new _(t,this.destination)))},ObserveOnSubscriber.prototype._next=function(t){this.scheduleMessage(s.a.createNext(t))},ObserveOnSubscriber.prototype._error=function(t){this.scheduleMessage(s.a.createError(t)),this.unsubscribe()},ObserveOnSubscriber.prototype._complete=function(){this.scheduleMessage(s.a.createComplete()),this.unsubscribe()},ObserveOnSubscriber}(a.a),_=function ObserveOnMessage(t,n){this.notification=t,this.destination=n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=function(){function TimeoutErrorImpl(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return TimeoutErrorImpl.prototype=Object.create(Error.prototype),TimeoutErrorImpl}()},function(t,n,i){"use strict";i.d(n,"a",(function(){return concatAll}));var o=i(108);function concatAll(){return Object(o.a)(1)}},function(t,n,i){"use strict";i.d(n,"a",(function(){return merge}));var o=i(5),a=i(23),s=i(108),m=i(64);function merge(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=Number.POSITIVE_INFINITY,g=null,_=t[t.length-1];return Object(a.a)(_)?(g=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(i=t.pop())):"number"==typeof _&&(i=t.pop()),null===g&&1===t.length&&t[0]instanceof o.a?t[0]:Object(s.a)(i)(Object(m.a)(t,g))}},function(t,n,i){"use strict";i.d(n,"a",(function(){return race}));var o=i(1),a=i(13),s=i(64),m=i(42),g=i(37);function race(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(1===t.length){if(!Object(a.a)(t[0]))return t[0];t=t[0]}return Object(s.a)(t,void 0).lift(new _)}var _=function(){function RaceOperator(){}return RaceOperator.prototype.call=function(t,n){return n.subscribe(new S(t))},RaceOperator}(),S=function(t){function RaceSubscriber(n){var i=t.call(this,n)||this;return i.hasFirst=!1,i.observables=[],i.subscriptions=[],i}return o.a(RaceSubscriber,t),RaceSubscriber.prototype._next=function(t){this.observables.push(t)},RaceSubscriber.prototype._complete=function(){var t=this.observables,n=t.length;if(0===n)this.destination.complete();else{for(var i=0;i<n&&!this.hasFirst;i++){var o=t[i],a=Object(g.a)(this,o,void 0,i);this.subscriptions&&this.subscriptions.push(a),this.add(a)}this.observables=null}},RaceSubscriber.prototype.notifyNext=function(t,n,i){if(!this.hasFirst){this.hasFirst=!0;for(var o=0;o<this.subscriptions.length;o++)if(o!==i){var a=this.subscriptions[o];a.unsubscribe(),this.remove(a)}this.subscriptions=null}this.destination.next(n)},RaceSubscriber}(m.a)},function(t,n,i){"use strict";i.d(n,"a",(function(){return timer}));var o=i(5),a=i(12),s=i(69),m=i(23);function timer(t,n,i){void 0===t&&(t=0);var g=-1;return Object(s.a)(n)?g=Number(n)<1?1:Number(n):Object(m.a)(n)&&(i=n),Object(m.a)(i)||(i=a.a),new o.a((function(n){var o=Object(s.a)(t)?t:+t-i.now();return i.schedule(dispatch,o,{index:0,period:g,subscriber:n})}))}function dispatch(t){var n=t.index,i=t.period,o=t.subscriber;if(o.next(n),!o.closed){if(-1===i)return o.complete();t.index=n+1,this.schedule(t,i)}}},function(t,n,i){"use strict";function NodeUniform(t){t=t||{},this.name=t.name,this.type=t.type,this.node=t.node,this.needsUpdate=t.needsUpdate}i.d(n,"a",(function(){return NodeUniform})),Object.defineProperties(NodeUniform.prototype,{value:{get:function(){return this.node.value},set:function(t){this.node.value=t}}})},function(t,n,i){"use strict";i.d(n,"a",(function(){return Vector4Node}));var o=i(0),a=i(6),s=i(20);function Vector4Node(t,n,i,s){a.a.call(this,"v4"),this.value=t instanceof o.Vector4?t:new o.Vector4(t,n,i,s)}Vector4Node.prototype=Object.create(a.a.prototype),Vector4Node.prototype.constructor=Vector4Node,Vector4Node.prototype.nodeType="Vector4",s.a.addShortcuts(Vector4Node.prototype,"value",["x","y","z","w"]),Vector4Node.prototype.generateReadonly=function(t,n,i,o){return t.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",o,n)},Vector4Node.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.value.copy(t),this},Vector4Node.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).x=this.x,n.y=this.y,n.z=this.z,n.w=this.w,!0===this.readonly&&(n.readonly=!0)),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return CubeTextureNode}));var o=i(6),a=i(87),s=i(60),m=i(15);function CubeTextureNode(t,n,i){o.a.call(this,"v4",{shared:!0}),this.value=t,this.uv=n||new a.a,this.bias=i}CubeTextureNode.prototype=Object.create(o.a.prototype),CubeTextureNode.prototype.constructor=CubeTextureNode,CubeTextureNode.prototype.nodeType="CubeTexture",CubeTextureNode.prototype.getTexture=function(t,n){return o.a.prototype.generate.call(this,t,n,this.value.uuid,"tc")},CubeTextureNode.prototype.generate=function(t,n){if("samplerCube"===n)return this.getTexture(t,n);var i,o=this.getTexture(t,n),a=this.uv.build(t,"v3"),g=this.bias?this.bias.build(t,"f"):void 0;void 0===g&&t.context.bias&&(g=t.context.bias.setTexture(this).build(t,"f")),i=g?"texCubeBias( "+o+", "+a+", "+g+" )":"texCube( "+o+", "+a+" )";var _={include:t.isShader("vertex"),ignoreCache:!0},S=this.getType(t);return t.addContext(_),this.colorSpace=this.colorSpace||new s.a(new m.a("",S)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(t,S),t.removeContext(),t.format(i,S,n)},CubeTextureNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),this},CubeTextureNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value.uuid,n.uv=this.uv.toJSON(t).uuid,this.bias&&(n.bias=this.bias.toJSON(t).uuid)),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return TextureCubeNode}));var o=i(2),a=i(14),s=i(134),m=i(87),g=i(54);function TextureCubeNode(t,n,i){o.a.call(this,"v4"),this.value=t,this.radianceNode=new s.a(this.value,n||new m.a(m.a.VECTOR),i),this.irradianceNode=new s.a(this.value,new g.a(g.a.WORLD),new a.a(1).setReadonly(!0))}TextureCubeNode.prototype=Object.create(o.a.prototype),TextureCubeNode.prototype.constructor=TextureCubeNode,TextureCubeNode.prototype.nodeType="TextureCube",TextureCubeNode.prototype.generate=function(t,n){return t.isShader("fragment")?(t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value),("irradiance"===t.slot?this.irradianceNode:this.radianceNode).build(t,n)):(console.warn("THREE.TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),n))},TextureCubeNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.value=t.value,this},TextureCubeNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value.toJSON(t).uuid),n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return scheduled}));var o=i(5),a=i(9),s=i(52),m=i(116),g=i(48),_=i(174),S=i(173);function scheduled(t,n){if(null!=t){if(function isInteropObservable(t){return t&&"function"==typeof t[s.a]}(t))return function scheduleObservable(t,n){return new o.a((function(i){var o=new a.a;return o.add(n.schedule((function(){var a=t[s.a]();o.add(a.subscribe({next:function(t){o.add(n.schedule((function(){return i.next(t)})))},error:function(t){o.add(n.schedule((function(){return i.error(t)})))},complete:function(){o.add(n.schedule((function(){return i.complete()})))}}))}))),o}))}(t,n);if(Object(_.a)(t))return function schedulePromise(t,n){return new o.a((function(i){var o=new a.a;return o.add(n.schedule((function(){return t.then((function(t){o.add(n.schedule((function(){i.next(t),o.add(n.schedule((function(){return i.complete()})))})))}),(function(t){o.add(n.schedule((function(){return i.error(t)})))}))}))),o}))}(t,n);if(Object(S.a)(t))return Object(m.a)(t,n);if(function isIterable(t){return t&&"function"==typeof t[g.a]}(t)||"string"==typeof t)return function scheduleIterable(t,n){if(!t)throw new Error("Iterable cannot be null");return new o.a((function(i){var o,s=new a.a;return s.add((function(){o&&"function"==typeof o.return&&o.return()})),s.add(n.schedule((function(){o=t[g.a](),s.add(n.schedule((function(){if(!i.closed){var t,n;try{var a=o.next();t=a.value,n=a.done}catch(t){return void i.error(t)}n?i.complete():(i.next(t),this.schedule())}})))}))),s}))}(t,n)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}},function(t,n,i){"use strict";i.d(n,"a",(function(){return a}));var o=i(1),a=function(t){function SubjectSubscription(n,i){var o=t.call(this)||this;return o.subject=n,o.subscriber=i,o.closed=!1,o}return o.a(SubjectSubscription,t),SubjectSubscription.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,n=t.observers;if(this.subject=null,n&&0!==n.length&&!t.isStopped&&!t.closed){var i=n.indexOf(this.subscriber);-1!==i&&n.splice(i,1)}}},SubjectSubscription}(i(9).a)},function(t,n,i){"use strict";i.d(n,"a",(function(){return subscribeToArray}));var subscribeToArray=function(t){return function(n){for(var i=0,o=t.length;i<o&&!n.closed;i++)n.next(t[i]);n.complete()}}},function(t,n,i){"use strict";i.d(n,"a",(function(){return isArrayLike}));var isArrayLike=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t}},function(t,n,i){"use strict";function isPromise(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}i.d(n,"a",(function(){return isPromise}))},function(t,n,i){"use strict";function not(t,n){function notPred(){return!notPred.pred.apply(notPred.thisArg,arguments)}return notPred.pred=t,notPred.thisArg=n,notPred}i.d(n,"a",(function(){return not}))},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(206),a=function(){function ClassTransformer(){}return ClassTransformer.prototype.classToPlain=function(t,n){return new o.TransformOperationExecutor(o.TransformationType.CLASS_TO_PLAIN,n||{}).transform(void 0,t,void 0,void 0,void 0,void 0)},ClassTransformer.prototype.classToPlainFromExist=function(t,n,i){return new o.TransformOperationExecutor(o.TransformationType.CLASS_TO_PLAIN,i||{}).transform(n,t,void 0,void 0,void 0,void 0)},ClassTransformer.prototype.plainToClass=function(t,n,i){return new o.TransformOperationExecutor(o.TransformationType.PLAIN_TO_CLASS,i||{}).transform(void 0,n,t,void 0,void 0,void 0)},ClassTransformer.prototype.plainToClassFromExist=function(t,n,i){return new o.TransformOperationExecutor(o.TransformationType.PLAIN_TO_CLASS,i||{}).transform(t,n,void 0,void 0,void 0,void 0)},ClassTransformer.prototype.classToClass=function(t,n){return new o.TransformOperationExecutor(o.TransformationType.CLASS_TO_CLASS,n||{}).transform(void 0,t,void 0,void 0,void 0,void 0)},ClassTransformer.prototype.classToClassFromExist=function(t,n,i){return new o.TransformOperationExecutor(o.TransformationType.CLASS_TO_CLASS,i||{}).transform(n,t,void 0,void 0,void 0,void 0)},ClassTransformer.prototype.serialize=function(t,n){return JSON.stringify(this.classToPlain(t,n))},ClassTransformer.prototype.deserialize=function(t,n,i){var o=JSON.parse(n);return this.plainToClass(t,o,i)},ClassTransformer.prototype.deserializeArray=function(t,n,i){var o=JSON.parse(n);return this.plainToClass(t,o,i)},ClassTransformer}();n.ClassTransformer=a},function(t,n,i){"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=i(217),a=i(27),s=a.LEVEL,m=a.MESSAGE;o.enabled=!0;var g=/\s+/,_=function(){function Colorizer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Colorizer),t.colors&&this.addColors(t.colors),this.options=t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Colorizer,[{key:"addColors",value:function addColors(t){return Colorizer.addColors(t)}},{key:"colorize",value:function colorize(t,n,i){if(void 0===i&&(i=n),!Array.isArray(Colorizer.allColors[t]))return o[Colorizer.allColors[t]](i);for(var a=0,s=Colorizer.allColors[t].length;a<s;a++)i=o[Colorizer.allColors[t][a]](i);return i}},{key:"transform",value:function transform(t,n){return n.all&&"string"==typeof t[m]&&(t[m]=this.colorize(t[s],t.level,t[m])),(n.level||n.all||!n.message)&&(t.level=this.colorize(t[s],t.level)),(n.all||n.message)&&(t.message=this.colorize(t[s],t.level,t.message)),t}}],[{key:"addColors",value:function addColors(t){var n=Object.keys(t).reduce((function(n,i){return n[i]=g.test(t[i])?t[i].split(g):t[i],n}),{});return Colorizer.allColors=Object.assign({},Colorizer.allColors||{},n),Colorizer.allColors}}]),Colorizer}();t.exports=function(t){return new _(t)},t.exports.Colorizer=t.exports.Format=_},function(t,n,i){"use strict";(function(n,o,a){var s=i(139);function CorkedRequest(t){var n=this;this.next=null,this.entry=null,this.finish=function(){!function onCorkedFinish(t,n,i){var o=t.entry;for(t.entry=null;o;){var a=o.callback;n.pendingcb--,a(i),o=o.next}n.corkedRequestsFree?n.corkedRequestsFree.next=t:n.corkedRequestsFree=t}(n,t)}}t.exports=Writable;var m,g=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?o:s.nextTick;Writable.WritableState=WritableState;var _=Object.create(i(118));_.inherits=i(45);var S,M={deprecate:i(221)},T=i(222),O=i(179).Buffer,A=a.Uint8Array||function(){},P=i(223);function nop(){}function WritableState(t,n){m=m||i(84),t=t||{};var o=n instanceof m;this.objectMode=!!t.objectMode,o&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var a=t.highWaterMark,_=t.writableHighWaterMark,S=this.objectMode?16:16384;this.highWaterMark=a||0===a?a:o&&(_||0===_)?_:S,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var M=!1===t.decodeStrings;this.decodeStrings=!M,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function onwrite(t,n){var i=t._writableState,o=i.sync,a=i.writecb;if(function onwriteStateUpdate(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),n)!function onwriteError(t,n,i,o,a){--n.pendingcb,i?(s.nextTick(a,o),s.nextTick(finishMaybe,t,n),t._writableState.errorEmitted=!0,t.emit("error",o)):(a(o),t._writableState.errorEmitted=!0,t.emit("error",o),finishMaybe(t,n))}(t,i,o,n,a);else{var m=needFinish(i);m||i.corked||i.bufferProcessing||!i.bufferedRequest||clearBuffer(t,i),o?g(afterWrite,t,i,m,a):afterWrite(t,i,m,a)}}(n,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(t){if(m=m||i(84),!(S.call(Writable,this)||this instanceof m))return new Writable(t);this._writableState=new WritableState(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),T.call(this)}function doWrite(t,n,i,o,a,s,m){n.writelen=o,n.writecb=m,n.writing=!0,n.sync=!0,i?t._writev(a,n.onwrite):t._write(a,s,n.onwrite),n.sync=!1}function afterWrite(t,n,i,o){i||function onwriteDrain(t,n){0===n.length&&n.needDrain&&(n.needDrain=!1,t.emit("drain"))}(t,n),n.pendingcb--,o(),finishMaybe(t,n)}function clearBuffer(t,n){n.bufferProcessing=!0;var i=n.bufferedRequest;if(t._writev&&i&&i.next){var o=n.bufferedRequestCount,a=new Array(o),s=n.corkedRequestsFree;s.entry=i;for(var m=0,g=!0;i;)a[m]=i,i.isBuf||(g=!1),i=i.next,m+=1;a.allBuffers=g,doWrite(t,n,!0,n.length,a,"",s.finish),n.pendingcb++,n.lastBufferedRequest=null,s.next?(n.corkedRequestsFree=s.next,s.next=null):n.corkedRequestsFree=new CorkedRequest(n),n.bufferedRequestCount=0}else{for(;i;){var _=i.chunk,S=i.encoding,M=i.callback;if(doWrite(t,n,!1,n.objectMode?1:_.length,_,S,M),i=i.next,n.bufferedRequestCount--,n.writing)break}null===i&&(n.lastBufferedRequest=null)}n.bufferedRequest=i,n.bufferProcessing=!1}function needFinish(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function callFinal(t,n){t._final((function(i){n.pendingcb--,i&&t.emit("error",i),n.prefinished=!0,t.emit("prefinish"),finishMaybe(t,n)}))}function finishMaybe(t,n){var i=needFinish(n);return i&&(function prefinish(t,n){n.prefinished||n.finalCalled||("function"==typeof t._final?(n.pendingcb++,n.finalCalled=!0,s.nextTick(callFinal,t,n)):(n.prefinished=!0,t.emit("prefinish")))}(t,n),0===n.pendingcb&&(n.finished=!0,t.emit("finish"))),i}_.inherits(Writable,T),WritableState.prototype.getBuffer=function getBuffer(){for(var t=this.bufferedRequest,n=[];t;)n.push(t),t=t.next;return n},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:M.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(S=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(t){return!!S.call(this,t)||this===Writable&&t&&t._writableState instanceof WritableState}})):S=function(t){return t instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(t,n,i){var o=this._writableState,a=!1,m=!o.objectMode&&function _isUint8Array(t){return O.isBuffer(t)||t instanceof A}(t);return m&&!O.isBuffer(t)&&(t=function _uint8ArrayToBuffer(t){return O.from(t)}(t)),"function"==typeof n&&(i=n,n=null),m?n="buffer":n||(n=o.defaultEncoding),"function"!=typeof i&&(i=nop),o.ended?function writeAfterEnd(t,n){var i=new Error("write after end");t.emit("error",i),s.nextTick(n,i)}(this,i):(m||function validChunk(t,n,i,o){var a=!0,m=!1;return null===i?m=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||n.objectMode||(m=new TypeError("Invalid non-string/buffer chunk")),m&&(t.emit("error",m),s.nextTick(o,m),a=!1),a}(this,o,t,i))&&(o.pendingcb++,a=function writeOrBuffer(t,n,i,o,a,s){if(!i){var m=function decodeChunk(t,n,i){return t.objectMode||!1===t.decodeStrings||"string"!=typeof n||(n=O.from(n,i)),n}(n,o,a);o!==m&&(i=!0,a="buffer",o=m)}var g=n.objectMode?1:o.length;n.length+=g;var _=n.length<n.highWaterMark;if(_||(n.needDrain=!0),n.writing||n.corked){var S=n.lastBufferedRequest;n.lastBufferedRequest={chunk:o,encoding:a,isBuf:i,callback:s,next:null},S?S.next=n.lastBufferedRequest:n.bufferedRequest=n.lastBufferedRequest,n.bufferedRequestCount+=1}else doWrite(t,n,!1,g,o,a,s);return _}(this,o,m,t,n,i)),a},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||clearBuffer(this,t))},Writable.prototype.setDefaultEncoding=function setDefaultEncoding(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(t,n,i){i(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(t,n,i){var o=this._writableState;"function"==typeof t?(i=t,t=null,n=null):"function"==typeof n&&(i=n,n=null),null!=t&&this.write(t,n),o.corked&&(o.corked=1,this.uncork()),o.ending||o.finished||function endWritable(t,n,i){n.ending=!0,finishMaybe(t,n),i&&(n.finished?s.nextTick(i):t.once("finish",i)),n.ended=!0,t.writable=!1}(this,o,i)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),Writable.prototype.destroy=P.destroy,Writable.prototype._undestroy=P.undestroy,Writable.prototype._destroy=function(t,n){this.end(),n(t)}}).call(this,i(25),i(78).setImmediate,i(33))},function(t,n,i){var o=i(31),a=o.Buffer;function copyProps(t,n){for(var i in t)n[i]=t[i]}function SafeBuffer(t,n,i){return a(t,n,i)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?t.exports=o:(copyProps(o,n),n.Buffer=SafeBuffer),copyProps(a,SafeBuffer),SafeBuffer.from=function(t,n,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return a(t,n,i)},SafeBuffer.alloc=function(t,n,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var o=a(t);return void 0!==n?"string"==typeof i?o.fill(n,i):o.fill(n):o.fill(0),o},SafeBuffer.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return a(t)},SafeBuffer.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return o.SlowBuffer(t)}},function(t,n,i){(function(t){function normalizeArray(t,n){for(var i=0,o=t.length-1;o>=0;o--){var a=t[o];"."===a?t.splice(o,1):".."===a?(t.splice(o,1),i++):i&&(t.splice(o,1),i--)}if(n)for(;i--;i)t.unshift("..");return t}function filter(t,n){if(t.filter)return t.filter(n);for(var i=[],o=0;o<t.length;o++)n(t[o],o,t)&&i.push(t[o]);return i}n.resolve=function(){for(var n="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var a=o>=0?arguments[o]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(n=a+"/"+n,i="/"===a.charAt(0))}return(i?"/":"")+(n=normalizeArray(filter(n.split("/"),(function(t){return!!t})),!i).join("/"))||"."},n.normalize=function(t){var o=n.isAbsolute(t),a="/"===i(t,-1);return(t=normalizeArray(filter(t.split("/"),(function(t){return!!t})),!o).join("/"))||o||(t="."),t&&a&&(t+="/"),(o?"/":"")+t},n.isAbsolute=function(t){return"/"===t.charAt(0)},n.join=function(){var t=Array.prototype.slice.call(arguments,0);return n.normalize(filter(t,(function(t,n){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))},n.relative=function(t,i){function trim(t){for(var n=0;n<t.length&&""===t[n];n++);for(var i=t.length-1;i>=0&&""===t[i];i--);return n>i?[]:t.slice(n,i-n+1)}t=n.resolve(t).substr(1),i=n.resolve(i).substr(1);for(var o=trim(t.split("/")),a=trim(i.split("/")),s=Math.min(o.length,a.length),m=s,g=0;g<s;g++)if(o[g]!==a[g]){m=g;break}var _=[];for(g=m;g<o.length;g++)_.push("..");return(_=_.concat(a.slice(m))).join("/")},n.sep="/",n.delimiter=":",n.dirname=function(t){if("string"!=typeof t&&(t+=""),0===t.length)return".";for(var n=t.charCodeAt(0),i=47===n,o=-1,a=!0,s=t.length-1;s>=1;--s)if(47===(n=t.charCodeAt(s))){if(!a){o=s;break}}else a=!1;return-1===o?i?"/":".":i&&1===o?"/":t.slice(0,o)},n.basename=function(t,n){var i=function basename(t){"string"!=typeof t&&(t+="");var n,i=0,o=-1,a=!0;for(n=t.length-1;n>=0;--n)if(47===t.charCodeAt(n)){if(!a){i=n+1;break}}else-1===o&&(a=!1,o=n+1);return-1===o?"":t.slice(i,o)}(t);return n&&i.substr(-1*n.length)===n&&(i=i.substr(0,i.length-n.length)),i},n.extname=function(t){"string"!=typeof t&&(t+="");for(var n=-1,i=0,o=-1,a=!0,s=0,m=t.length-1;m>=0;--m){var g=t.charCodeAt(m);if(47!==g)-1===o&&(a=!1,o=m+1),46===g?-1===n?n=m:1!==s&&(s=1):-1!==n&&(s=-1);else if(!a){i=m+1;break}}return-1===n||-1===o||0===s||1===s&&n===o-1&&n===i+1?"":t.slice(n,o)};var i="b"==="ab".substr(-1)?function(t,n,i){return t.substr(n,i)}:function(t,n,i){return n<0&&(n=t.length+n),t.substr(n,i)}}).call(this,i(25))},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function isArrayLike(t){return t&&"number"==typeof t.length&&t.length>=0&&t.length%1==0},t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={},t.exports=n.default},function(t,n,i){"use strict";var o=i(93).codes.ERR_STREAM_PREMATURE_CLOSE;function noop(){}t.exports=function eos(t,n,i){if("function"==typeof n)return eos(t,null,n);n||(n={}),i=function once(t){var n=!1;return function(){if(!n){n=!0;for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];t.apply(this,o)}}}(i||noop);var a=n.readable||!1!==n.readable&&t.readable,s=n.writable||!1!==n.writable&&t.writable,m=function onlegacyfinish(){t.writable||_()},g=t._writableState&&t._writableState.finished,_=function onfinish(){s=!1,g=!0,a||i.call(t)},S=t._readableState&&t._readableState.endEmitted,M=function onend(){a=!1,S=!0,s||i.call(t)},T=function onerror(n){i.call(t,n)},O=function onclose(){var n;return a&&!S?(t._readableState&&t._readableState.ended||(n=new o),i.call(t,n)):s&&!g?(t._writableState&&t._writableState.ended||(n=new o),i.call(t,n)):void 0},A=function onrequest(){t.req.on("finish",_)};return function isRequest(t){return t.setHeader&&"function"==typeof t.abort}(t)?(t.on("complete",_),t.on("abort",O),t.req?A():t.on("request",A)):s&&!t._writableState&&(t.on("end",m),t.on("close",m)),t.on("end",M),t.on("finish",_),!1!==n.error&&t.on("error",T),t.on("close",O),function(){t.removeListener("complete",_),t.removeListener("abort",O),t.removeListener("request",A),t.req&&t.req.removeListener("finish",_),t.removeListener("end",m),t.removeListener("close",m),t.removeListener("finish",_),t.removeListener("end",M),t.removeListener("error",T),t.removeListener("close",O)}}},function(t,n,i){"use strict";var o=i(216),a=i(27).configs;n.cli=o.levels(a.cli),n.npm=o.levels(a.npm),n.syslog=o.levels(a.syslog),n.addColors=o.levels},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=_interopRequireDefault(i(431)),a=_interopRequireDefault(i(432)),s=_interopRequireDefault(i(92)),m=_interopRequireDefault(i(121));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}n.default=(0,m.default)((function eachLimit(t,n,i){return(0,o.default)(t,(0,a.default)((0,s.default)(n)),i)}),3),t.exports=n.default},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TouchCameraControls=void 0;var g=i(17),_=i(0),S=i(98),M=i(145),T=i(18),O=i(82),A=i(99),P=function(t){function TouchCameraControls(n,i){void 0===i&&(i=new S.OrbitControlsOptions);var o=t.call(this,n,i)||this;return o.rotateSpeed=-.25,o}return a(TouchCameraControls,t),TouchCameraControls.prototype.init=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this,n)];case 1:return i.sent(),this.orbitControls.enabled=!1,this.orbitControls.enableDamping=!0,this.orbitControls.screenSpacePanning=!0,this.orbitControls.enableKeys=!1,this.setCameraOptions(this.orbitOptions),[4,this.setCameraPositionRotation()];case 2:return i.sent(),this.camera.name="TouchCamera",this.orbitControls.target.set(0,0,-1e-4),this.orbitControls.rotateSpeed=this.rotateSpeed,this.orbitControls.update(),this.appManager.currentExperience.scene.add(this.camera),[2]}}))}))},TouchCameraControls.prototype.addListeners=function(){var n=this;t.prototype.addListeners.call(this),this.subscribtions.push(this.appManager.eventManager.pipe(T.filter((function(t){return t.eventType.name===(new O.EventTypes.MouseWheelEvent).name||t.eventType===O.EventTypes.MouseWheelEvent||t.eventType.name===(new O.EventTypes.PinchEvent).name||t.eventType===O.EventTypes.PinchEvent}))).subscribe((function(t){n.onMouseWheel(t.message.delta)})))},TouchCameraControls.prototype.onMouseWheel=function(t){var n=3e-4;A.DeviceUtils.IsMobile()&&(n=-.003),t*=n,this.orbitControls.enableZoom&&t&&(this.camera.zoom+=t,this.camera.zoom>this.orbitControls.maxZoom&&(this.camera.zoom=this.orbitControls.maxZoom),this.camera.zoom<this.orbitControls.minZoom&&(this.camera.zoom=this.orbitControls.minZoom),this.onCameraZoomFunc(),this.camera.updateProjectionMatrix())},TouchCameraControls.prototype._render=function(t){this.enabled&&(this.orbitControls.enabled&&this.orbitControls.update(),this.cubeCamera&&this.cubeCamera.update(this.appManager.currentExperience.renderer,this.appManager.currentExperience.scene),this.appManager.currentExperience.renderer.render(this.appManager.currentExperience.scene,this.camera),this.appManager.currentExperience.cssRenderer.render(this.appManager.currentExperience.scene,this.camera),this.gyroManager&&this.gyroPresent&&this.handleGyro(),this.appManager.renderEventManager.next(t))},TouchCameraControls.prototype.destroy=function(){t.prototype.destroy.call(this),this.orbitControls.dispose(),this.orbitControls=void 0},TouchCameraControls.prototype.setCameraHeight=function(n,i){return s(this,void 0,void 0,(function(){var o,a;return m(this,(function(s){switch(s.label){case 0:return o=this.orbitControls.enabled,this.orbitControls.enabled=!1,[4,t.prototype.setCameraHeight.call(this,n,i)];case 1:return s.sent(),a=g.Utils.getLookAtVector(this.camera),this.orbitControls.target.set(a.x,a.y,a.z),this.orbitControls.enabled=o,[2]}}))}))},TouchCameraControls.prototype.animateCamera=function(n,i,o,a){return void 0===a&&(a=0),s(this,void 0,void 0,(function(){var s;return m(this,(function(m){switch(m.label){case 0:return this.orbitControls.enabled=!1,[4,t.prototype.animateCamera.call(this,n,i,o,a,void 0)];case 1:return m.sent(),s=g.Utils.getLookAtVector(this.camera.clone()),this.orbitControls.target.set(s.x,s.y,s.z),this.orbitControls.enabled=!0,this.onCameraMoveFunc(),[2]}}))}))},TouchCameraControls.prototype.setCameraPositionRotation=function(t){return void 0===t&&(t=!1),s(this,void 0,void 0,(function(){var n,i;return m(this,(function(o){switch(o.label){case 0:return n=new _.Vector3(0,0,0),this.orbitOptions.target&&!t&&(i=new _.Vector3(+this.orbitOptions.target.x,+this.orbitOptions.target.y,+this.orbitOptions.target.z)),this.orbitOptions.position&&(n=new _.Vector3(+this.orbitOptions.position.x,+this.orbitOptions.position.y,+this.orbitOptions.position.z)),[4,this.animateCamera(n,i,!!i,0)];case 1:return o.sent(),[2]}}))}))},TouchCameraControls.prototype.setCameraAttr=function(t,n){return void 0===n&&(n=!1),s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return t&&t.touch_camera?this.setCameraOptions(t.touch_camera):this.setCameraOptions(new S.OrbitControlsOptions),[4,this.setCameraPositionRotation(n)];case 1:return i.sent(),[2]}}))}))},TouchCameraControls.prototype.setCameraOptions=function(t){this.orbitOptions=t,this.orbitOptions.gyro&&(this.gyroManager=new M.GyroscopeManager(this.appManager,this.orbitOptions.gyro),this.gyroManager.init()),this.orbitControls.maxDistance=1e-4,this.orbitControls.minDistance=1e-4,this.orbitControls.maxPolarAngle=t.max_polar_angle?+t.max_polar_angle:Math.PI,this.orbitControls.minPolarAngle=t.min_polar_angle?+t.min_polar_angle:0,this.orbitControls.maxAzimuthAngle=t.max_azimuth_angle?+t.max_azimuth_angle:1/0,this.orbitControls.minAzimuthAngle=t.min_azimuth_angle?+t.min_azimuth_angle:-1/0,this.orbitControls.maxZoom=t.max_zoom?+t.max_zoom:1/0,this.orbitControls.minZoom=t.min_zoom?+t.min_zoom:0,this.orbitControls.enableZoom=void 0!==t.max_zoom||void 0!==t.min_zoom,this.orbitControls.enablePan=!1,this.orbitControls.autoRotate=!!t.auto_rotate,this.orbitControls.autoRotateSpeed=+t.auto_rotate_speed,this.autoRotateThreshold=t.auto_rotate_threshold?+t.auto_rotate_threshold:this.autoRotateThreshold,this.renderManager.setFPS(+t.fps||60)},TouchCameraControls}(S.OrbitBasedCameraControls);n.TouchCameraControls=P},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SignalList=n.SignalHandlingBase=n.SignalDispatcher=n.NonUniformSimpleEventList=n.SimpleEventList=n.SimpleEventHandlingBase=n.SimpleEventDispatcher=n.NonUniformEventList=n.EventList=n.EventHandlingBase=n.EventDispatcher=n.Subscription=n.EventListBase=n.DispatcherWrapper=n.DispatcherBase=void 0;var o=i(148);Object.defineProperty(n,"DispatcherBase",{enumerable:!0,get:function(){return o.DispatcherBase}}),Object.defineProperty(n,"DispatcherWrapper",{enumerable:!0,get:function(){return o.DispatcherWrapper}}),Object.defineProperty(n,"EventListBase",{enumerable:!0,get:function(){return o.EventListBase}}),Object.defineProperty(n,"Subscription",{enumerable:!0,get:function(){return o.Subscription}});var a=i(460);Object.defineProperty(n,"EventDispatcher",{enumerable:!0,get:function(){return a.EventDispatcher}}),Object.defineProperty(n,"EventHandlingBase",{enumerable:!0,get:function(){return a.EventHandlingBase}}),Object.defineProperty(n,"EventList",{enumerable:!0,get:function(){return a.EventList}}),Object.defineProperty(n,"NonUniformEventList",{enumerable:!0,get:function(){return a.NonUniformEventList}});var s=i(462);Object.defineProperty(n,"SimpleEventDispatcher",{enumerable:!0,get:function(){return s.SimpleEventDispatcher}}),Object.defineProperty(n,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return s.SimpleEventHandlingBase}}),Object.defineProperty(n,"SimpleEventList",{enumerable:!0,get:function(){return s.SimpleEventList}}),Object.defineProperty(n,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return s.NonUniformSimpleEventList}});var m=i(464);Object.defineProperty(n,"SignalDispatcher",{enumerable:!0,get:function(){return m.SignalDispatcher}}),Object.defineProperty(n,"SignalHandlingBase",{enumerable:!0,get:function(){return m.SignalHandlingBase}}),Object.defineProperty(n,"SignalList",{enumerable:!0,get:function(){return m.SignalList}})},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.MediaUtils=void 0;var s=i(0);!function(t){var n;function getCubeSideFromCrossImage(t,n,i){return o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,new Promise((function(o,a){var m=t.height/3,g=document.createElement("canvas");g.width=m,g.height=m,g.getContext("2d").drawImage(t,-n*m,-i*m);var _=new s.Texture;_.image=g,_.needsUpdate=!0,o(_)}))]}))}))}function loadImage(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){var o=new Image;o.onload=function(){n(o)},o.onerror=function(){i()},o.crossOrigin="anonymous",o.src=t}))]}))}))}t.getAssetsElement=function getAssetsElement(){return n||((n=document.createElement("div")).setAttribute("id","assets"),n.style.display="None",document.body.appendChild(n),n)},t.CleanCache=function CleanCache(){s.Cache.clear()},t.getCubeTexturesFromCrossImage=function getCubeTexturesFromCrossImage(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return[4,loadImage(t)];case 1:return n=i.sent(),[2,[function(){return getCubeSideFromCrossImage(n,2,1)},function(){return getCubeSideFromCrossImage(n,0,1)},function(){return getCubeSideFromCrossImage(n,1,0)},function(){return getCubeSideFromCrossImage(n,1,2)},function(){return getCubeSideFromCrossImage(n,1,1)},function(){return getCubeSideFromCrossImage(n,3,1)}]]}}))}))},t.getCubeTexturesFromVerticalImage=function getCubeTexturesFromVerticalImage(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return[4,loadImage(t)];case 1:return n=i.sent(),[2,[0,1,2,3,4,5].map((function(t){return function(){return function getCubeSideFromVerticalImage(t,n){return o(this,void 0,void 0,(function(){return a(this,(function(i){return[2,new Promise((function(i,o){var a=t.height/6,m=document.createElement("canvas");m.width=a,m.height=a,m.getContext("2d").drawImage(t,0,-n*a);var g=new s.Texture;g.image=m,g.needsUpdate=!0,i(g)}))]}))}))}(n,t)}}))]}}))}))}}(n.MediaUtils||(n.MediaUtils={}))},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.VRControls=void 0;var s=i(190),m=i(0),g=i(192),_=i(124),S=i(18),M=i(10),T=new m.Matrix4,O=function(t){function VRControls(){var n=null!==t&&t.apply(this,arguments)||this;return n.lines=[],n.ctrlMaterial=new m.LineBasicMaterial({vertexColors:!0,blending:m.AdditiveBlending,transparent:!0,alphaTest:0}),n.CtrlGeometry=new m.BufferGeometry,n}return a(VRControls,t),VRControls.prototype.init=function(){t.prototype.init.call(this),this.CtrlGeometry.addAttribute("position",new m.Float32BufferAttribute([0,0,0,0,0,-10],3)),this.CtrlGeometry.addAttribute("color",new m.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),this.ctrlOnMouseDown=this.onMouseDown.bind(null,this),this.ctrlDetectTouch=this.detectTouch.bind(null,this),this.createControllers()},VRControls.prototype.enable=function(){this.enabled||(t.prototype.enable.call(this),this.loop())},VRControls.prototype.addListeners=function(){var n=this;t.prototype.addListeners.call(this);var i=this.appManager.eventManager.pipe(S.filter((function(t){return t.eventType.name===(new M.ZoneChangeEndedEvent).name||t.eventType===M.ZoneChangeEndedEvent}))).subscribe((function(t){n.recreateControllers()}));this.subscribtions.push(i),this.controller1&&(this.controller1.addEventListener("selectstart",this.ctrlOnMouseDown),this.controller1.addEventListener("selectend",this.ctrlDetectTouch)),this.controller2&&(this.controller2.addEventListener("selectstart",this.ctrlOnMouseDown),this.controller2.addEventListener("selectend",this.ctrlDetectTouch))},VRControls.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.controller1&&(this.controller1.removeEventListener("selectstart",this.ctrlOnMouseDown),this.controller1.removeEventListener("selectend",this.ctrlDetectTouch)),this.controller2&&(this.controller2.removeEventListener("selectstart",this.ctrlOnMouseDown),this.controller2.removeEventListener("selectend",this.ctrlDetectTouch))},VRControls.prototype.recreateControllers=function(){this.removeControllers(),this.createControllers()},VRControls.prototype.createControllers=function(){var t=this.appManager.currentExperience.renderer.vr;this.controller1=t.getController(0);var n,i=this.appManager.cameraControlsRegistry.cameraControls;this.controller1&&(this.controller1.name="controller1",i instanceof g.VRDollyCameraControls?i.dolly.add(this.controller1):i instanceof _.VROrbitCameraControls?i.dummyCamera.add(this.controller1):i.camera.add(this.controller1),(n=new m.Line(this.CtrlGeometry,this.ctrlMaterial)).name="line1",this.lines.push(n),this.controller1.add(n)),this.controller2=t.getController(1),this.controller2&&(this.controller2.name="controller2",i instanceof g.VRDollyCameraControls?i.dolly.add(this.controller2):i instanceof _.VROrbitCameraControls?i.dummyCamera.add(this.controller2):i.camera.add(this.controller2),(n=new m.Line(this.CtrlGeometry,this.ctrlMaterial)).name="line2",this.lines.push(n),this.controller2.add(n))},VRControls.prototype.removeControllers=function(){this.lines.forEach((function(t){t&&t.parent&&t.parent.remove(t)})),this.lines=[],this.controller1&&this.controller1.parent&&this.controller1.parent.remove(this.controller1),this.controller1=void 0,this.controller2&&this.controller2.parent&&this.controller2.parent.remove(this.controller2),this.controller2=void 0},VRControls.prototype.disable=function(){this.enabled&&(t.prototype.disable.call(this),this.removeControllers())},VRControls.prototype.detectCollision=function(t){if(t.targetList&&0!==t.targetList.size){var n=t.GetIntersectsFromController(t.controller1,t.raycaster,Array.from(t.targetList.keys()));if(n.length>0){var i=n[0].object;if(!i)return;return i===t.focusedElement||(t.focusedElement?(t.triggerUnfocus(t,t.focusedElement),t.focusedElement=i,t.triggerFocus(t,t.focusedElement,n[0].point)):(t.focusedElement=i,t.triggerFocus(t,t.focusedElement,n[0].point))),t.getHitInfoFromIntersection(t,n[0])}t.focusedElement&&t.triggerUnfocus(t,t.focusedElement),t.focusedElement=void 0}},VRControls.prototype.GetIntersectsFromController=function(t,n,i){return void 0===n&&(n=new m.Raycaster),T.identity().extractRotation(t.matrixWorld),n.ray.origin.setFromMatrixPosition(t.matrixWorld),n.ray.direction.set(0,0,-1).applyMatrix4(T),n.intersectObjects(Array.from(i),!0)},VRControls.prototype.handleController=function(t){if(t){t.visible=!0;var n=t.getObjectByName("pivot"),i=new m.Vector3(0,1,0);if(n){var o=n.matrixWorld,a=t.userData.points[0],s=t.userData.points[1],g=t.userData.matrices[0],_=t.userData.matrices[1];a.setFromMatrixPosition(o),g.lookAt(s,a,i),s.copy(a),_.copy(g)}}},VRControls.prototype.loop=function(){var t=this;this.appManager.renderEventManager.subscribe((function(){t.enabled&&(t.detectCollision(t),t.handleController(t.controller1),t.handleController(t.controller2))}))},VRControls.prototype.destroy=function(){t.prototype.destroy.call(this),this.removeControllers()},VRControls}(s.UserInteractionControlsImpl);n.VRControls=O},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserInteractionControlsImpl=void 0;var o=i(0),a=i(191),s=i(10),m=function(){function UserInteractionControlsImpl(t,n){this.enabled=!1,this.longPressThreshold=500,this.subscribtions=[],this.appManager=t,this.domElement=t.currentExperience.cssRenderer.domElement,this.targetList=n?new Map(n.targetList):new Map}return UserInteractionControlsImpl.prototype.init=function(){this.appManager.currentExperience.vrControllerEventManager&&this.appManager.currentExperience.vrControllerEventManager.updateGamepads(),this.raycaster=new o.Raycaster},UserInteractionControlsImpl.prototype.reset=function(){this.focusedElement=void 0},UserInteractionControlsImpl.prototype.enable=function(){this.enabled||(this.enabled=!0,this.addListeners())},UserInteractionControlsImpl.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.removeListeners())},UserInteractionControlsImpl.prototype.addListeners=function(){},UserInteractionControlsImpl.prototype.AddObject=function(t,n){this.targetList.set(t,n)},UserInteractionControlsImpl.prototype.RemoveObject=function(t){this.targetList.delete(t)},UserInteractionControlsImpl.prototype.triggerLongTouch=function(t,n,i){var o=t.getElementFromObject(t,n);o&&o.interactable&&t.appManager.activate(new a.LongTouchActionDescriptor(o.interactable,{HitLocation:i,Mesh:n}))},UserInteractionControlsImpl.prototype.triggerLongTouchEnded=function(t,n,i){var o=t.getElementFromObject(t,n);o&&o.interactable&&t.appManager.activate(new a.LongTouchEndedActionDescriptor(o.interactable,{HitLocation:i,Mesh:n}))},UserInteractionControlsImpl.prototype.triggerDoubleClick=function(t,n,i){var o=t.getElementFromObject(t,n);o&&o.interactable&&t.appManager.activate(new a.DoubleClickActionDescriptor(o.interactable,{HitLocation:i,Mesh:n}))},UserInteractionControlsImpl.prototype.triggerFocus=function(t,n,i){var o=t.getElementFromObject(t,n);o&&o.interactable&&(document.body.style.cursor="pointer",this.appManager.activate(new a.FocusActionDescriptor(o.interactable,{HitLocation:i,Mesh:n})))},UserInteractionControlsImpl.prototype.triggerUnfocus=function(t,n){var i=t.getElementFromObject(t,n);i&&i.interactable&&(document.body.style.cursor="default",this.appManager.activate(new a.UnfocusActionDescriptor(i.interactable,n)))},UserInteractionControlsImpl.prototype.triggerTouch=function(t,n,i){var o=t.getElementFromObject(t,n);o&&o.interactable&&t.appManager.activate(new a.TouchActionDescriptor(o.interactable,{HitLocation:i,Mesh:n}))},UserInteractionControlsImpl.prototype.triggerRightClick=function(t,n,i){var o=t.getElementFromObject(t,n);o&&o.interactable&&t.appManager.activate(new a.RightClickActionDescriptor(o.interactable,{HitLocation:i,Mesh:n}))},UserInteractionControlsImpl.prototype.detectRightClick=function(t,n){var i=t.detectCollision(t,n);t.focusedElement?t.triggerRightClick(t,t.focusedElement,i.intersection.point):t.appManager.eventManager.next({origin:null,eventType:new s.RightClickEvent})},UserInteractionControlsImpl.prototype.detectTouch=function(t,n){var i=t.detectCollision(t,n),o=(new Date).getTime()-t.longPressClickTime>t.longPressThreshold;-1!==t.timer?(t.timer<t.longPressThreshold&&(clearTimeout(t.timer),t.timer=0),t.focusedElement?o?t.triggerLongTouchEnded(t,t.focusedElement,i.intersection.point):t.triggerTouch(t,t.focusedElement,i.intersection.point):t.appManager.eventManager.next({origin:null,eventType:o?new s.LongTouchEndedEvent:new s.TouchEvent})):t.timer=0},UserInteractionControlsImpl.prototype.getHitInfoFromIntersection=function(t,n){return{intersection:n,object:t.getElementFromObject(t,n.object)}},UserInteractionControlsImpl.prototype.getElementFromObject=function(t,n){if(n)return t.targetList.get(n)},UserInteractionControlsImpl.prototype.onMouseDown=function(t){t.longPressClickTime=(new Date).getTime(),t.timer=setTimeout((function(){t.triggerLongTouch(t,t.focusedElement,null)}),t.longPressThreshold)},UserInteractionControlsImpl.prototype.removeListeners=function(){this.subscribtions.forEach((function(t){t.unsubscribe()}))},UserInteractionControlsImpl.prototype.destroy=function(){this.disable(),this.reset(),this.raycaster=void 0,this.targetList.clear(),this.targetList=void 0},UserInteractionControlsImpl}();n.UserInteractionControlsImpl=m},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.UnfocusActionDescriptor=n.FocusActionDescriptor=n.DoubleClickActionDescriptor=n.LongTouchEndedActionDescriptor=n.LongTouchActionDescriptor=n.RightClickActionDescriptor=n.TouchActionDescriptor=n.ByondElementInteractionActionDescriptor=n.HitDetails=n.GeneralExecutable=n.ByondCommonActionDescriptor=n.InteractableImpl=n.InteractableActions=void 0;var s=function(){function InteractableActions(){this._actionableInstructions=new Map}return InteractableActions.prototype.Add=function(t,n){this.AssertIfNull(t,"descriptor parameter is null"),this.AssertIfNull(n,"executable parameter is null"),this._actionableInstructions.set(t,n)},InteractableActions.prototype.AssertIfNull=function(t,n){if(null==t)throw new EvalError(n)},InteractableActions.prototype.Contains=function(t){return this.AssertIfNull(t,"actionDescriptorType parameter is null"),this._actionableInstructions.has(t.typeName)},InteractableActions.prototype.Execute=function(t){this.AssertIfNull(t,"descriptor is null"),this.AssertIfNull(t.interactable,"descriptor interactable is null");var n=this._actionableInstructions.get(t.typeName);try{null!=n&&n.execute(t)}catch(i){throw new EvalError("Executable: "+typeof n+" failed for Action: "+t.typeName+"\n"+i)}},InteractableActions.prototype.Remove=function(t){this._actionableInstructions.delete(t)},InteractableActions.prototype.Clear=function(){this._actionableInstructions.clear()},InteractableActions}();n.InteractableActions=s;var m=function(){function InteractableImpl(t){this.interactableActions=new s,t&&(this.obj=t)}return InteractableImpl.prototype.getParentElementHandlers=function(){var t=new Array;if(this.obj)for(var n=this.obj;n;)t.push(n),n=n.parent;return t.reverse()},InteractableImpl.prototype.dispose=function(){this.interactableActions.Clear(),this.interactableActions=void 0,this.obj=void 0},InteractableImpl}();n.InteractableImpl=m;var g=function(){function ByondCommonActionDescriptor(t){null!=t&&null!=t.obj&&(this._interactable=t,this._handlers=t.getParentElementHandlers())}return Object.defineProperty(ByondCommonActionDescriptor.prototype,"interactable",{get:function(){return this._interactable},enumerable:!1,configurable:!0}),Object.defineProperty(ByondCommonActionDescriptor.prototype,"typeName",{get:function(){return ByondCommonActionDescriptor.typeName},enumerable:!1,configurable:!0}),Object.defineProperty(ByondCommonActionDescriptor.prototype,"handlers",{get:function(){return null==this._handlers&&null!=this._interactable&&null!=this._interactable.obj&&(this._handlers=this._interactable.getParentElementHandlers()),this._handlers},enumerable:!1,configurable:!0}),ByondCommonActionDescriptor}();n.ByondCommonActionDescriptor=g;var _=function(){function GeneralExecutable(t,n){this.appManager=t,this.action=n}return GeneralExecutable.prototype.execute=function(t){this.action&&this.action()},GeneralExecutable}();n.GeneralExecutable=_;n.HitDetails=function HitDetails(){};var S=function(t){function ByondElementInteractionActionDescriptor(n,i){var o=t.call(this,n)||this;return o.Hit=i,o}return a(ByondElementInteractionActionDescriptor,t),Object.defineProperty(ByondElementInteractionActionDescriptor.prototype,"typeName",{get:function(){return ByondElementInteractionActionDescriptor.typeName},enumerable:!1,configurable:!0}),ByondElementInteractionActionDescriptor}(g);n.ByondElementInteractionActionDescriptor=S;var M=function(t){function TouchActionDescriptor(n,i){return t.call(this,n,i)||this}return a(TouchActionDescriptor,t),Object.defineProperty(TouchActionDescriptor.prototype,"typeName",{get:function(){return TouchActionDescriptor.typeName},enumerable:!1,configurable:!0}),TouchActionDescriptor.typeName="TouchActionDescriptor",TouchActionDescriptor}(S);n.TouchActionDescriptor=M;var T=function(t){function RightClickActionDescriptor(n,i){return t.call(this,n,i)||this}return a(RightClickActionDescriptor,t),Object.defineProperty(RightClickActionDescriptor.prototype,"typeName",{get:function(){return RightClickActionDescriptor.typeName},enumerable:!1,configurable:!0}),RightClickActionDescriptor.typeName="RightClickActionDescriptor",RightClickActionDescriptor}(S);n.RightClickActionDescriptor=T;var O=function(t){function LongTouchActionDescriptor(n,i){return t.call(this,n,i)||this}return a(LongTouchActionDescriptor,t),Object.defineProperty(LongTouchActionDescriptor.prototype,"typeName",{get:function(){return LongTouchActionDescriptor.typeName},enumerable:!1,configurable:!0}),LongTouchActionDescriptor.typeName="LongTouchActionDescriptor",LongTouchActionDescriptor}(S);n.LongTouchActionDescriptor=O;var A=function(t){function LongTouchEndedActionDescriptor(n,i){return t.call(this,n,i)||this}return a(LongTouchEndedActionDescriptor,t),Object.defineProperty(LongTouchEndedActionDescriptor.prototype,"typeName",{get:function(){return LongTouchEndedActionDescriptor.typeName},enumerable:!1,configurable:!0}),LongTouchEndedActionDescriptor.typeName="LongTouchEndedActionDescriptor",LongTouchEndedActionDescriptor}(S);n.LongTouchEndedActionDescriptor=A;var P=function(t){function DoubleClickActionDescriptor(n,i){return t.call(this,n,i)||this}return a(DoubleClickActionDescriptor,t),Object.defineProperty(DoubleClickActionDescriptor.prototype,"typeName",{get:function(){return DoubleClickActionDescriptor.typeName},enumerable:!1,configurable:!0}),DoubleClickActionDescriptor.typeName="DoubleClickActionDescriptor",DoubleClickActionDescriptor}(S);n.DoubleClickActionDescriptor=P;var L=function(t){function FocusActionDescriptor(n,i){return t.call(this,n,i)||this}return a(FocusActionDescriptor,t),Object.defineProperty(FocusActionDescriptor.prototype,"typeName",{get:function(){return FocusActionDescriptor.typeName},enumerable:!1,configurable:!0}),FocusActionDescriptor.typeName="FocusActionDescriptor",FocusActionDescriptor}(S);n.FocusActionDescriptor=L;var R=function(t){function UnfocusActionDescriptor(n,i){return t.call(this,n,{HitLocation:null,Mesh:i})||this}return a(UnfocusActionDescriptor,t),Object.defineProperty(UnfocusActionDescriptor.prototype,"typeName",{get:function(){return UnfocusActionDescriptor.typeName},enumerable:!1,configurable:!0}),UnfocusActionDescriptor.typeName="UnfocusActionDescriptor",UnfocusActionDescriptor}(S);n.UnfocusActionDescriptor=R},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.VRDollyCameraControls=void 0;var g=i(0),_=i(18),S=i(261),M=i(10),T=function(t){function VRDollyCameraControls(n,i){void 0===i&&(i=new S.DollyOptions);var o=t.call(this,n)||this;return o.frameOfReferenceType="eye-level",o.zoomSpeedVR=1,o.moveSpeedVR=50,o.isVR=!0,o}return a(VRDollyCameraControls,t),VRDollyCameraControls.prototype.init=function(n,i,o){return s(this,void 0,void 0,(function(){return m(this,(function(a){switch(a.label){case 0:return[4,t.prototype.init.call(this,n)];case 1:return a.sent(),i&&(this.vrDisplay=i),this.camera.name="VRDollyCamera",this.frameOfReferenceType=o||this.frameOfReferenceType,this.appManager.currentExperience.renderer.vr.setFrameOfReferenceType(this.frameOfReferenceType),[2]}}))}))},VRDollyCameraControls.prototype.addListeners=function(){var t=this,n=this.appManager.eventManager.pipe(_.filter((function(t){return(t.eventType.name===(new M.GamepadSwipeEvent).name||t.eventType===M.GamepadSwipeEvent)&&t.message&&0===t.message.buttonIndex}))).subscribe((function(n){var i=n.message.delta,o=new g.Vector2(i.x*t.moveSpeedVR,i.y*t.moveSpeedVR);t.onSwipe(o)}));if(this.subscribtions.push(n),this.dollyOptions.z_enabled){var i=this.appManager.eventManager.pipe(_.filter((function(t){return(t.eventType.name===(new M.GamepadPressSwipeEvent).name||t.eventType===M.GamepadPressSwipeEvent)&&t.message&&0===t.message.buttonIndex}))).subscribe((function(n){var i=n.message.delta;t.onZoom(i.y*t.zoomSpeedVR)}));this.subscribtions.push(i)}},VRDollyCameraControls.prototype.enable=function(){this.enabled||(t.prototype.enable.call(this),this.appManager.currentExperience.renderer.xr.enabled=!0)},VRDollyCameraControls.prototype.disable=function(){this.enabled&&(t.prototype.disable.call(this),this.appManager.currentExperience.renderer.xr.enabled=!1,this.appManager.container.appendChild(this.appManager.currentExperience.renderer.domElement),this.appManager.container.appendChild(this.appManager.currentExperience.cssRenderer.domElement))},VRDollyCameraControls.prototype.setCameraAttr=function(t){t.dolly_camera&&this.setCameraOptions(t.dolly_camera)},VRDollyCameraControls.prototype.setCameraOptions=function(t){},VRDollyCameraControls.prototype._render=function(t){this.enabled&&(this.updateDamping(),this.appManager.currentExperience.renderer.render(this.appManager.currentExperience.scene,this.camera),this.cubeCamera&&this.cubeCamera.update(this.appManager.currentExperience.renderer,this.appManager.currentExperience.scene),this.appManager.renderEventManager.next(t))},VRDollyCameraControls}(S.DollyCameraControls);n.VRDollyCameraControls=T},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.IsXRSupported=n.XRBtn=void 0,i(266);var s=i(189),m=i(125),g=i(56),_=i(146),S=i(124),M=function(){function XRBtn(t){this.currentSession=null,this.enabled=!1,this.button=document.createElement("button"),this.appManager=t,this.button.textContent="ENTER XR",this.button.className="XRBtn"}return XRBtn.prototype.init=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.enabled?[2]:[4,this.getDevice()];case 1:return t.sent(),this.button.onclick=this.enterXR.bind(this),document.body.appendChild(this.button),this.enabled=!0,[2]}}))}))},XRBtn.prototype.getDevice=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,navigator.xr.requestDevice()];case 1:return(t=n.sent())&&(this.device=t),[2]}}))}))},XRBtn.prototype.enterXR=function(){var t,n=this.appManager.cameraControlsRegistry.cameraControls;if(n instanceof g.Controls.CameraControls.DollyCameraControls.DollyCameraControls){var i=Object.assign(Object.create(Object.getPrototypeOf(n.dollyOptions)),n.dollyOptions);t=new g.Controls.CameraControls.VRDollyCameraControls(this.appManager,i)}else n instanceof _.OrbitCameraControls?(i=Object.assign(Object.create(Object.getPrototypeOf(n.orbitOptions)),n.orbitOptions),t=new S.VROrbitCameraControls(this.appManager,i)):t=new g.Controls.CameraControls.VRCameraControls(this.appManager);t.init(),this.appManager.cameraControlsRegistry.Unregister(),this.appManager.cameraControlsRegistry.Register(t),t.enable(),this.device.requestSession({immersive:!0,exclusive:!0}).then(this.onSessionStarted.bind(this))},XRBtn.prototype.onSessionStarted=function(t){t.addEventListener("end",this.onSessionEnded.bind(this)),this.appManager.currentExperience.renderer.vr.setSession(t),this.currentSession=t;var n=new s.VRControls(this.appManager,this.appManager.currentExperience.userInteractionControlsRegistry.userInteractionControls);this.appManager.currentExperience.userInteractionControlsRegistry.Unregister(),this.appManager.currentExperience.userInteractionControlsRegistry.Register(n),this.appManager.currentExperience.userInteractionControlsRegistry.Init(),this.appManager.currentExperience.userInteractionControlsRegistry.Enable()},XRBtn.prototype.onSessionEnded=function(){this.currentSession&&this.currentSession.removeEventListener("end",this.onSessionEnded),this.appManager.currentExperience.renderer.vr.setSession(null),this.currentSession=null;var t=new m.MouseControls(this.appManager,this.appManager.currentExperience.userInteractionControlsRegistry.userInteractionControls);this.appManager.currentExperience.userInteractionControlsRegistry.Unregister(),this.appManager.currentExperience.userInteractionControlsRegistry.Register(t),this.appManager.currentExperience.userInteractionControlsRegistry.Init(),this.appManager.currentExperience.userInteractionControlsRegistry.Enable(),this.appManager.currentExperience.handleCurrentZoneCamera(!0)},XRBtn}();n.XRBtn=M,n.IsXRSupported=function IsXRSupported(){return"xr"in navigator}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransitionEfffectImpl=void 0;var s=function(){function TransitionEfffectImpl(t){this.appManager=t}return TransitionEfffectImpl.prototype.transition=function(t,n,i,s){return o(this,void 0,void 0,(function(){return a(this,(function(t){return[2]}))}))},TransitionEfffectImpl}();n.TransitionEfffectImpl=s},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CubemapBackground=void 0;var g=i(196),_=i(10),S=i(18),M=function(t){function CubemapBackground(n,i,o){var a=t.call(this,n,i,o)||this,s=a,m=a.appManager.eventManager.pipe(S.filter((function(t){return t.eventType.name===(new _.TouchEvent).name||t.eventType===_.TouchEvent}))).subscribe((function(t){a.activateElement(s)}));return a.subscriptions.push(m),a}return a(CubemapBackground,t),CubemapBackground.prototype.activateElement=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},CubemapBackground.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),this.obj.position.set(0,0,0),this.obj.renderOrder=-999999,[2]}}))}))},CubemapBackground.prototype.getMetadata=function(){return this.metadata},CubemapBackground}(g.BackgroundImpl);n.CubemapBackground=M},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundImpl=void 0;var g=function(t){function BackgroundImpl(){return null!==t&&t.apply(this,arguments)||this}return a(BackgroundImpl,t),BackgroundImpl.prototype.handleDependencies=function(){return s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},BackgroundImpl}(i(46).ByondInteractiveElement);n.BackgroundImpl=g},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Row=void 0;var g=i(0),_=i(306),S=i(153),M=function(t){function Row(n,i,o,a,s,m){void 0===s&&(s=.05),void 0===m&&(m=new g.Vector2(.5,.5));var _=t.call(this,n,o,a)||this;return _.cells=new Array,_.colSize=i,_.padding=s,_.margin=m,_}return a(Row,t),Row.prototype.init=function(){this.geometry=new g.BoxGeometry(this.cellSize.x*this.colSize,this.cellSize.y,this.cellSize.z),this.obj=new g.Mesh(this.geometry,this.material),this.obj.name="row",this.obj.position.set(this.initialPosition.x,this.initialPosition.y,this.initialPosition.z),this.parent instanceof S.GridBaseElement?this.parent.obj.add(this.obj):this.parent.add(this.obj);for(var t=-(this.cellSize.x+this.margin.x)*this.colSize/2+this.cellSize.x/2+this.margin.x/2,n=0;n<this.colSize;n++){var i=new g.Vector3(t,0,0),o=new _.Cell(this,i,this.cellSize,this.padding);o.init(),t+=this.cellSize.x+this.margin.x,this.cells.push(o)}},Row.prototype.getCells=function(){return this.cells},Row.prototype.enable=function(){return s(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return t=[],this.cells.forEach((function(n){return t.push(n.enable())})),[4,Promise.all(t)];case 1:return n.sent(),[2]}}))}))},Row.prototype.disable=function(){this.cells.forEach((function(t){return t.disable()}))},Object.defineProperty(Row.prototype,"wireframe",{set:function(t){this._wireframe=t,this.cells.forEach((function(n){n.wireframe=t}))},enumerable:!1,configurable:!0}),Row.prototype.RecheckProp=function(){this.cells.forEach((function(t){return t.RecheckProp()}))},Row}(S.GridBaseElement);n.Row=M},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.GenericGalleryHelix=void 0;var g=i(0),_=function(t){function GenericGalleryHelix(n,i,o){var a=t.call(this,n,i,o,2,3)||this;return a.placeHolders=new Array,a}return a(GenericGalleryHelix,t),GenericGalleryHelix.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o;return m(this,(function(a){switch(a.label){case 0:return[4,t.prototype.init.call(this)];case 1:return a.sent(),n=this.metadata.data.slice(0,100),i=this.objects,o=0,[4,this.constructGalleryObjects(n)];case 2:return i[o]=a.sent(),[4,this.placeScreens()];case 3:return a.sent(),[2]}}))}))},GenericGalleryHelix.prototype.constructObject=function(t,n){return s(this,void 0,void 0,(function(){var i;return m(this,(function(o){switch(o.label){case 0:return[4,this.appManager.elementsRegistry.GetElement(t,n)];case 1:return(i=o.sent())&&i[0]?[2,i[0]]:[2]}}))}))},GenericGalleryHelix.prototype.setEnabled=function(t){this.setObjectGroupEnabled(t,this.objects[0])},GenericGalleryHelix.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(i){return this.setObjectGroupVisible(t,this.objects[0],n),[2]}))}))},GenericGalleryHelix.prototype.placeScreens=function(){return s(this,void 0,void 0,(function(){var t,n,i,o,a,s,_,S;return m(this,(function(m){switch(m.label){case 0:t=new g.Vector3,n=3,i=0,o=this.objects[0].length,m.label=1;case 1:return i<o?[4,this.objects[0][i].init()]:[3,4];case 2:m.sent(),a=new g.Mesh,_=.175*(s=i*n)+Math.PI,(S=new g.Vector3).setX(20/n*Math.sin(_)),S.setY((2*s-o*n)/20),S.setZ(20/n*Math.cos(_)),this.obj.add(a),a.position.set(S.x,S.y,S.z),t.x=0,t.y=S.y,t.z=0,a.lookAt(t),a.add(this.objects[0][i].obj),this.objects[0][i].obj.position.set(0,0,0),this.placeHolders.push(a),m.label=3;case 3:return i++,[3,1];case 4:return[2]}}))}))},GenericGalleryHelix}(i(154).GalleryImpl);n.GenericGalleryHelix=_},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.LayeredGallery=void 0;var g=i(0),_=i(155),S=i(156),M=i(154),T="$$levels",O=function(t){function LayeredGallery(n,i,o){var a=t.call(this,n,i,o)||this;return a.layersDistance=5,a.galleries=[],a.obj=new g.Group,a}return a(LayeredGallery,t),LayeredGallery.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o,a,_,S,M,O,A,P,L,R,N,I,j,V,U,G,z,H=this;return m(this,(function(q){switch(q.label){case 0:if(n=this.getCustomAttribute(T),i=this.getCustomAttribute("$$rows"),o=this.getCustomAttribute("$$cols"),a=this.getCustomAttribute("$$padding"),_=this.getCustomAttribute("$$cell_size"),i||(i=3),o||(o=2),a||(a=0),_||(_=new g.Vector3(4,2,.1)),this.orderedMetadata=this.orderMetadata(),this.orderedMetadata&&this.orderedMetadata.length>0)for(z=0;z<this.orderedMetadata.length;z++)S=T+"."+n[z]+".rows",M=T+"."+n[z]+".cols",O=T+"."+n[z]+".alpha",A=T+"."+n[z]+".padding",P=T+"."+n[z]+".margin",L=T+"."+n[z]+".cell_size",R=this.getCustomAttribute(S),N=this.getCustomAttribute(M),I=this.getCustomAttribute(O),j=this.getCustomAttribute(A),V=this.getCustomAttribute(P),U=this.getCustomAttribute(L),R||(R=i),N||(N=o),I||(I=1),j||(j=a),V||(V=new g.Vector2(.5,.5)),U||(U=_),this.addScreensLayer(this.orderedMetadata[z],R,N,I,j,V,U,z);else this.addScreensLayer(this.metadata.data,i,o);return[4,Promise.all(this.galleries.map((function(t){return s(H,void 0,void 0,(function(){return m(this,(function(n){return[2,t.init()]}))}))})))];case 1:for(q.sent(),(G=this.getCustomAttribute("$$levels.distance"))&&(this.layersDistance=G),z=0;z<this.galleries.length;z++)this.galleries[z].obj.translateZ(this.layersDistance*z*-1);return[4,t.prototype.init.call(this)];case 2:return q.sent(),[2]}}))}))},LayeredGallery.prototype.constructObject=function(t,n){return s(this,void 0,void 0,(function(){var i;return m(this,(function(o){switch(o.label){case 0:return[4,this.appManager.elementsRegistry.GetElement(t,n)];case 1:return(i=o.sent())&&i[0]?[2,i[0]]:[2]}}))}))},LayeredGallery.prototype.orderMetadata=function(){var t=this,n=[];if(this.metadata.data){var i=this.getCustomAttribute(T);if(i)return i.forEach((function(i){var o=[];t.metadata.data.forEach((function(t){var n=t.getCustomAttribute("$$level");null!=n&&n===i&&o.push(t)})),t.objectsSortOrder(o),n.push(o)})),n}},LayeredGallery.prototype.setLayersDistance=function(t){this.layersDistance=t},LayeredGallery.prototype.getLayersDistance=function(){return this.layersDistance},LayeredGallery.prototype.addScreensLayer=function(t,n,i,o,a,s,m,M){void 0===n&&(n=2),void 0===i&&(i=3),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=new g.Vector2(.5,.5)),void 0===m&&(m=new g.Vector3(4,2,.1)),void 0===M&&(M=this.galleries.length);var T=new _.BaseGalleryElementMetadata;T.collapse_expand_behavior=this.metadata.collapse_expand_behavior,T.data=t,T.picture=this.metadata.picture,T.position=new g.Vector3(0,0,0),T.rotation=new g.Euler(0,0,0),T.paging_controls_layout=this.metadata.paging_controls_layout,T.scale=new g.Vector3(1,1,1),this.galleries[M]=new S.GridBasedGallery(T,this,this.id+M,n,i,o,a,s,m)},LayeredGallery.prototype.setEnabled=function(t){this.getCustomAttribute(T);for(var n=0;n<this.galleries.length;n++)this.setLayerEnabled(this.galleries[n],t);this.enabled=t},LayeredGallery.prototype.setLayerEnabled=function(t,n){t.setEnabled(n)},LayeredGallery.prototype.setLayerVisible=function(t,n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.setVisible(n)];case 1:return i.sent(),[2]}}))}))},LayeredGallery.prototype.setLayerAlpha=function(t,n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.setAlpha(n,i)];case 1:return o.sent(),[2]}}))}))},LayeredGallery.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var n,i;return m(this,(function(o){switch(o.label){case 0:for(n=[],i=0;i<this.galleries.length;i++)n.push(this.setLayerVisible(this.galleries[i],t));return[4,Promise.all(n)];case 1:return o.sent(),[2]}}))}))},LayeredGallery.prototype.setAlpha=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i,o=this;return m(this,(function(a){switch(a.label){case 0:return i=[],this.galleries.forEach((function(a){i.push(o.setLayerAlpha(a,t,n))})),[4,Promise.all(i)];case 1:return a.sent(),[2]}}))}))},LayeredGallery.prototype.destroy=function(){t.prototype.destroy.call(this),this.galleries.forEach((function(t){t.destroy()}))},LayeredGallery}(M.GalleryImpl);n.LayeredGallery=O},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenNavigation=void 0;var g=i(101),_=i(10),S=i(34),M=function(t){function ScreenNavigation(n,i,o){return t.call(this,n,i,o)||this}return a(ScreenNavigation,t),ScreenNavigation.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},ScreenNavigation.prototype.activateElement=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.activateElement.call(this,n)];case 1:return i.sent(),this.appManager.eventManager.next(new S.EventMessage(n,new _.NavigateEvent,{targetZone:n.getMetadata().source})),[2]}}))}))},ScreenNavigation}(g.ScreenImpl);n.ScreenNavigation=M},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenVideo=void 0;var g=i(0),_=i(56),S=i(101),M=i(83),T=i(22),O=i(34),A=i(82),P=function(t){function ScreenVideo(n,i,o){var a=t.call(this,n,i,o)||this;return a.autoPlay=!1,a.loop=!1,a}return a(ScreenVideo,t),ScreenVideo.prototype.init=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this)];case 1:return i.sent(),n=this.metadata,this.autoPlay=this.getMetadata().auto_play||n.getCustomAttribute("$$autoplay"),this.loop=this.getMetadata().is_loop||n.getCustomAttribute("$$loop"),this.playFullScreen=n.getCustomAttribute("$$play_full_screen"),this.autoPlay&&this.playVideo(!1),[2]}}))}))},ScreenVideo.prototype.initVideo=function(t){var n=this;this.stopPreviewProgressiveImageLoading=!0,this.video=new _.Utils.Video.Video({url:this.getMetadata().source,autoplay:!0,loop:this.loop,muted:this.autoPlay}),this.video.OnStateChanged.subscribe((function(i,o){switch(o){case _.Utils.Video.VideoStatus.Ended:n.appManager.eventManager.next(new O.EventMessage(n,new A.EventTypes.VideoEndedEvent),!0),n.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(n),n.deactivateElement();break;case _.Utils.Video.VideoStatus.Ready:if(n.appManager.eventManager.next(new O.EventMessage(n,new A.EventTypes.VideoReadyEvent),!0),n.video.videoOptions.autoplay){n.play();var a=_.Utils.Utils.GetGeometryRatio(n.video.getWidth(),n.video.getHeight(),3);if(t||(n.geometry=new g.PlaneBufferGeometry(a.x,a.y)),n.getMetadata().is_alpha){var s=n.getCustomAttribute(T.CustomAttributes.ChromakeyOption),m=new M.ChromakeyOptions;s&&(s.baseColor&&(m.baseColor=s.baseColor),s.distance&&(m.distance=s.distance),s.sensibility&&(m.sensibility=s.sensibility)),n.chromakeyMaterial=new M.ChromakeyMaterial(n.video.Texture,m,{transparent:!0,alphaTest:0,side:g.DoubleSide}),n.obj.material=n.chromakeyMaterial}n.material instanceof M.ChromakeyMaterial||(n.material.map=n.video.Texture,n.material.needsUpdate=!0),t||(n.obj.geometry=n.geometry)}n.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(n),n.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(n);break;case _.Utils.Video.VideoStatus.Playing:n.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(n),n.appManager.eventManager.next(new O.EventMessage(n,new A.EventTypes.VideoPlayingEvent),!0);break;case _.Utils.Video.VideoStatus.Paused:case _.Utils.Video.VideoStatus.Stoped:case _.Utils.Video.VideoStatus.Unloaded:n.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(n)}})),this.video.Load()},ScreenVideo.prototype.setVisible=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){var o;return m(this,(function(a){switch(a.label){case 0:return[4,t.prototype.setVisible.call(this,n,i)];case 1:return o=[a.sent()],[4,Promise.all(o)];case 2:return a.sent(),[2]}}))}))},ScreenVideo.prototype.setEnabled=function(n){t.prototype.setEnabled.call(this,n)},ScreenVideo.prototype.deactivateElement=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return this.autoPlay&&this.loop&&!this.playFullScreen?[2]:[4,t.prototype.deactivateElement.call(this)];case 1:return n.sent(),this.playFullScreen?[2]:(this.video&&this.video.Stop(),[4,this.OnVideoEnded()]);case 2:return n.sent(),[2]}}))}))},ScreenVideo.prototype.OnVideoEnded=function(t){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return this.video&&(this.video.Dispose(),delete this.video,this.video=void 0),this.obj.material instanceof M.ChromakeyMaterial&&(this.obj.material=this.material),this.loadPreviewImage(t),(n=this.metadata.grow_type)&&"none"===n.toLowerCase()?[2]:[4,this.Reset(this.triggerAnimTime)];case 1:return i.sent(),[2]}}))}))},ScreenVideo.prototype.activateElement=function(n,i){return s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.activateElement.call(this,n)];case 1:return o.sent(),n.playFullScreen?[4,_.Utils.JsUtils.OpenVideoInTab(n.getMetadata().source)]:[3,3];case 2:return o.sent(),n.deactivateElement(),[3,4];case 3:n.playVideo(i),o.label=4;case 4:return[2]}}))}))},ScreenVideo.prototype.playVideo=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return this.video?[3,2]:(this.initVideo(),t?[3,2]:[4,this.applyAnimateScreenToFov()]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},ScreenVideo.prototype.destroy=function(){t.prototype.destroy.call(this),this.video&&this.video.Dispose(),this.chromakeyMaterial&&this.chromakeyMaterial.dispose()},ScreenVideo.prototype.play=function(t){(t||0===t)&&this.video.Seek(t),this.video.Play()},ScreenVideo.prototype.stop=function(){this.video&&this.video.Stop()},ScreenVideo.prototype.pause=function(){this.video&&this.video.Pause()},ScreenVideo.prototype.resume=function(){this.play()},Object.defineProperty(ScreenVideo.prototype,"CurrentTime",{get:function(){return this.video.CurrentTime()},set:function(t){this.video.Seek(t)},enumerable:!1,configurable:!0}),Object.defineProperty(ScreenVideo.prototype,"volume",{get:function(){return this.video.volume},set:function(t){this.video.volume=t},enumerable:!1,configurable:!0}),ScreenVideo.prototype.getMetadata=function(){return this.metadata},ScreenVideo}(S.ScreenImpl);n.ScreenVideo=P},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TargetLightElementImpl=void 0;var g=i(157),_=i(17),S=function(t){function TargetLightElementImpl(){return null!==t&&t.apply(this,arguments)||this}return a(TargetLightElementImpl,t),TargetLightElementImpl.prototype.setLightTarget=function(){var t=this.getMetadata().lighting_target;if(t){var n=_.Utils.getItemById(this.appManager,t);n&&(this.obj.target=n.obj)}},TargetLightElementImpl.prototype.setVisible=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){return this.setLightTarget(),t.prototype.setVisible.call(this,n,i),[2]}))}))},TargetLightElementImpl}(g.LightElementImpl);n.TargetLightElementImpl=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneMetadata=n.CssElementMetadata=void 0;var m=i(32),g=i(36),_=function(t){function CssElementMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(CssElementMetadata,t),Object.defineProperty(CssElementMetadata.prototype,"ElementName",{get:function(){return"cssElement"},enumerable:!1,configurable:!0}),CssElementMetadata}(m.Metadata.Element3DMetadata);n.CssElementMetadata=_;var S=function(t){function ZoneMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ZoneMetadata,t),s([g.Type((function(){return _}))],ZoneMetadata.prototype,"css_elements",void 0),ZoneMetadata}(m.Metadata.ZoneMetadata);n.ZoneMetadata=S,m.Metadata.ZoneMetadata=Object.assign(S,m.Metadata.ZoneMetadata)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.subTypes=void 0,n.subTypes=[]},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.GenericGalleryFactory=void 0;var s=function(t){function GenericGalleryFactory(n){return t.call(this,n)||this}return a(GenericGalleryFactory,t),GenericGalleryFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},GenericGalleryFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},GenericGalleryFactory}(i(51).ByondBaseElementFactoryImpl);n.GenericGalleryFactory=s},function(t,n,i){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0});var o,a=i(208);!function(t){t[t.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",t[t.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",t[t.CLASS_TO_CLASS=2]="CLASS_TO_CLASS"}(o=n.TransformationType||(n.TransformationType={}));var s=function(){function TransformOperationExecutor(t,n){this.transformationType=t,this.options=n,this.recursionStack=new Set}return TransformOperationExecutor.prototype.transform=function(n,i,s,m,g,_){var S=this;if(void 0===_&&(_=0),Array.isArray(i)||i instanceof Set){var M=m&&this.transformationType===o.PLAIN_TO_CLASS?function instantiateArrayType(t){var n=new t;return n instanceof Set||"push"in n?n:[]}(m):[];return i.forEach((function(t,i){var a=n?n[i]:void 0;if(S.options.enableCircularCheck&&S.isCircular(t))S.transformationType===o.CLASS_TO_CLASS&&(M instanceof Set?M.add(t):M.push(t));else{var m=void 0;if("function"!=typeof s&&s&&s.options&&s.options.discriminator&&s.options.discriminator.property&&s.options.discriminator.subTypes){if(S.transformationType===o.PLAIN_TO_CLASS){m=s.options.discriminator.subTypes.find((function(n){return n.name===t[s.options.discriminator.property]}));var g={newObject:M,object:t,property:void 0},T=s.typeFunction(g);m=void 0===m?T:m.value,s.options.keepDiscriminatorProperty||delete t[s.options.discriminator.property]}S.transformationType===o.CLASS_TO_CLASS&&(m=t.constructor),S.transformationType===o.CLASS_TO_PLAIN&&(t[s.options.discriminator.property]=s.options.discriminator.subTypes.find((function(n){return n.value===t.constructor})).name)}else m=s;var O=S.transform(a,t,m,void 0,t instanceof Map,_+1);M instanceof Set?M.add(O):M.push(O)}})),M}if(s!==String||g){if(s!==Number||g){if(s!==Boolean||g){if((s===Date||i instanceof Date)&&!g)return i instanceof Date?new Date(i.valueOf()):null==i?i:new Date(i);if(testForBuffer()&&(s===t||i instanceof t)&&!g)return null==i?i:t.from(i);if("object"==typeof i&&null!==i){s||i.constructor===Object||(s=i.constructor),!s&&n&&(s=n.constructor),this.options.enableCircularCheck&&this.recursionStack.add(i);var T=this.getKeys(s,i),O=n||{};n||this.transformationType!==o.PLAIN_TO_CLASS&&this.transformationType!==o.CLASS_TO_CLASS||(O=g?new Map:s?new s:{});for(var _loop_1=function(t){var m=t,S=t,M=t;if(!A.options.ignoreDecorators&&s)if(A.transformationType===o.PLAIN_TO_CLASS)(T=a.defaultMetadataStorage.findExposeMetadataByCustomName(s,t))&&(M=T.propertyName,S=T.propertyName);else if(A.transformationType===o.CLASS_TO_PLAIN||A.transformationType===o.CLASS_TO_CLASS){var T;(T=a.defaultMetadataStorage.findExposeMetadata(s,t))&&T.options&&T.options.name&&(S=T.options.name)}var P=void 0;P=i instanceof Map?i.get(m):i[m]instanceof Function?i[m]():i[m];var L=void 0,R=P instanceof Map;if(s&&g)L=s;else if(s){var N=a.defaultMetadataStorage.findTypeMetadata(s,M);if(N){var I={newObject:O,object:i,property:M},j=N.typeFunction?N.typeFunction(I):N.reflectedType;N.options&&N.options.discriminator&&N.options.discriminator.property&&N.options.discriminator.subTypes?i[m]instanceof Array?L=N:(A.transformationType===o.PLAIN_TO_CLASS&&(L=void 0===(L=N.options.discriminator.subTypes.find((function(t){if(P&&N.options.discriminator.property in P)return t.name===P[N.options.discriminator.property]})))?j:L.value,N.options.keepDiscriminatorProperty||P&&N.options.discriminator.property in P&&delete P[N.options.discriminator.property]),A.transformationType===o.CLASS_TO_CLASS&&(L=P.constructor),A.transformationType===o.CLASS_TO_PLAIN&&(P[N.options.discriminator.property]=N.options.discriminator.subTypes.find((function(t){return t.value===P.constructor})).name)):L=j,R=R||N.reflectedType===Map}else if(A.options.targetMaps)A.options.targetMaps.filter((function(t){return t.target===s&&!!t.properties[M]})).forEach((function(t){return L=t.properties[M]}));else if(A.options.enableImplicitConversion&&A.transformationType===o.PLAIN_TO_CLASS){var V=Reflect.getMetadata("design:type",s.prototype,M);V&&(L=V)}}var U=Array.isArray(i[m])?A.getReflectedType(s,M):void 0,G=n?n[m]:void 0;if(O.constructor.prototype){var z=Object.getOwnPropertyDescriptor(O.constructor.prototype,S);if((A.transformationType===o.PLAIN_TO_CLASS||A.transformationType===o.CLASS_TO_CLASS)&&(z&&!z.set||O[S]instanceof Function))return"continue"}if(A.options.enableCircularCheck&&A.isCircular(P))A.transformationType===o.CLASS_TO_CLASS&&(q=P,q=A.applyCustomTransformations(q,s,t,i,A.transformationType),O instanceof Map?O.set(S,q):O[S]=q);else{var H=A.transformationType===o.PLAIN_TO_CLASS?S:t,q=void 0;A.transformationType===o.CLASS_TO_PLAIN?(q=i[H],q=A.applyCustomTransformations(q,s,H,i,A.transformationType),q=i[H]===q?P:q,q=A.transform(G,q,L,U,R,_+1)):(q=A.transform(G,P,L,U,R,_+1),q=A.applyCustomTransformations(q,s,H,i,A.transformationType)),O instanceof Map?O.set(S,q):O[S]=q}},A=this,P=0,L=T;P<L.length;P++)_loop_1(L[P]);return this.options.enableCircularCheck&&this.recursionStack.delete(i),O}return i}return null==i?i:Boolean(i)}return null==i?i:Number(i)}return null==i?i:String(i)},TransformOperationExecutor.prototype.applyCustomTransformations=function(t,n,i,o,s){var m=this,g=a.defaultMetadataStorage.findTransformMetadatas(n,i,this.transformationType);return void 0!==this.options.version&&(g=g.filter((function(t){return!t.options||m.checkVersion(t.options.since,t.options.until)}))),(g=this.options.groups&&this.options.groups.length?g.filter((function(t){return!t.options||m.checkGroups(t.options.groups)})):g.filter((function(t){return!t.options||!t.options.groups||!t.options.groups.length}))).forEach((function(n){t=n.transformFn(t,o,s)})),t},TransformOperationExecutor.prototype.isCircular=function(t){return this.recursionStack.has(t)},TransformOperationExecutor.prototype.getReflectedType=function(t,n){if(t){var i=a.defaultMetadataStorage.findTypeMetadata(t,n);return i?i.reflectedType:void 0}},TransformOperationExecutor.prototype.getKeys=function(t,n){var i=this,s=a.defaultMetadataStorage.getStrategy(t);"none"===s&&(s=this.options.strategy||"exposeAll");var m=[];if("exposeAll"===s&&(m=n instanceof Map?Array.from(n.keys()):Object.keys(n)),!this.options.ignoreDecorators&&t){var g=a.defaultMetadataStorage.getExposedProperties(t,this.transformationType);this.transformationType===o.PLAIN_TO_CLASS&&(g=g.map((function(n){var i=a.defaultMetadataStorage.findExposeMetadata(t,n);return i&&i.options&&i.options.name?i.options.name:n}))),m=this.options.excludeExtraneousValues?g:m.concat(g);var _=a.defaultMetadataStorage.getExcludedProperties(t,this.transformationType);_.length>0&&(m=m.filter((function(t){return-1===_.indexOf(t)}))),void 0!==this.options.version&&(m=m.filter((function(n){var o=a.defaultMetadataStorage.findExposeMetadata(t,n);return!o||!o.options||i.checkVersion(o.options.since,o.options.until)}))),m=this.options.groups&&this.options.groups.length?m.filter((function(n){var o=a.defaultMetadataStorage.findExposeMetadata(t,n);return!o||!o.options||i.checkGroups(o.options.groups)})):m.filter((function(n){var i=a.defaultMetadataStorage.findExposeMetadata(t,n);return!(i&&i.options&&i.options.groups&&i.options.groups.length)}))}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(m=m.filter((function(t){return i.options.excludePrefixes.every((function(n){return t.substr(0,n.length)!==n}))}))),m.filter((function(t,n,i){return i.indexOf(t)===n}))},TransformOperationExecutor.prototype.checkVersion=function(t,n){var i=!0;return i&&t&&(i=this.options.version>=t),i&&n&&(i=this.options.version<n),i},TransformOperationExecutor.prototype.checkGroups=function(t){return!t||this.options.groups.some((function(n){return-1!==t.indexOf(n)}))},TransformOperationExecutor}();function testForBuffer(){try{return!0}catch(t){}return!1}n.TransformOperationExecutor=s,n.testForBuffer=testForBuffer}).call(this,i(31).Buffer)},function(t,n){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(320);n.defaultMetadataStorage=new o.MetadataStorage},function(t,n,i){"use strict";(t.exports={}).forEach=function(t,n){for(var i=0;i<t.length;i++){var o=n(t[i]);if(o)return o}}},function(t,n,i){"use strict";var o=t.exports={};o.isIE=function(t){return!(!function isAnyIeVersion(){var t=navigator.userAgent.toLowerCase();return-1!==t.indexOf("msie")||-1!==t.indexOf("trident")||-1!==t.indexOf(" edge/")}()||t&&t!==function(){var t=3,n=document.createElement("div"),i=n.getElementsByTagName("i");do{n.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i></i><![endif]--\x3e"}while(i[0]);return t>4?t:void 0}())},o.isLegacyOpera=function(){return!!window.opera}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OBJExporter=n.GLTFExporter=void 0;var o=i(339);Object.defineProperty(n,"GLTFExporter",{enumerable:!0,get:function(){return o.GLTFExporter}});var a=i(340);Object.defineProperty(n,"OBJExporter",{enumerable:!0,get:function(){return a.OBJExporter}})},function(n,i){n.exports=t},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenShot=void 0;var o,a,s=i(0),m=i(214),g=i(17),_=function(){function ScreenShotClass(){}return ScreenShotClass.prototype.init=function(t){this.appManager=t,this.width=1,this.height=1,this.material=new s.RawShaderMaterial({uniforms:{map:{value:null}},vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,side:s.DoubleSide,transparent:!0}),this.scene=new s.Scene,this.quad=new s.Mesh(new s.PlaneBufferGeometry(1,1),this.material),this.scene.add(this.quad),this.camera=new s.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.cubeCamera=null,this.attachedCamera=null,this.setSize(4096,2048);var n=this.appManager.currentExperience.renderer.getContext();this.cubeMapSize=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),this.getCubeCamera(2048)},ScreenShotClass.prototype.setSize=function(t,n){this.width=t,this.height=n,this.quad.scale.set(this.width,this.height,1),this.camera.left=this.width/-2,this.camera.right=this.width/2,this.camera.top=this.height/2,this.camera.bottom=this.height/-2,this.camera.updateProjectionMatrix(),this.output=new s.WebGLRenderTarget(this.width,this.height,{minFilter:s.LinearFilter,magFilter:s.LinearFilter,wrapS:s.ClampToEdgeWrapping,wrapT:s.ClampToEdgeWrapping,format:s.RGBAFormat,type:s.UnsignedByteType}),this.canvas.width=this.width,this.canvas.height=this.height},ScreenShotClass.prototype.getCubeCamera=function(t){var n=Math.min(this.cubeMapSize,t),i={format:s.RGBAFormat,magFilter:s.LinearFilter,minFilter:s.LinearFilter},o=new s.WebGLCubeRenderTarget(n,i);return this.cubeCamera=new s.CubeCamera(.1,1e3,o),this.cubeCamera},ScreenShotClass.prototype.convert=function(t,n,i,o){this.quad.material.uniforms.map.value=t.renderTarget.texture;var a=this.appManager.currentExperience.renderer.getCurrentRenderTarget();this.appManager.currentExperience.renderer.setRenderTarget(this.output),this.appManager.currentExperience.renderer.render(this.scene,this.camera);var s=new Uint8Array(4*this.width*this.height);this.appManager.currentExperience.renderer.readRenderTargetPixels(this.output,0,0,this.width,this.height,s),this.appManager.currentExperience.renderer.setRenderTarget(a);var m=new ImageData(new Uint8ClampedArray(s),this.width,this.height);return n&&this.download(m,i,o),m},ScreenShotClass.prototype.download=function(t,n,i){var o=this;return new Promise((function(a,s){o.ctx.putImageData(t,0,0),o.canvas.toBlob((function(t){var i=URL.createObjectURL(t),o="pano-"+document.title+"-"+Date.now()+".jpg",s=document.createElement("a");s.href=i,s.setAttribute("download",n||o),s.className="download-js-link",s.innerHTML="downloading...",s.style.display="none",document.body.appendChild(s),setTimeout((function(){s.click(),document.body.removeChild(s),a()}),1)}),i||"image/jpeg")}))},ScreenShotClass.prototype.capture=function(t,n,i){return void 0===t&&(t=!0),this.update(),this.convert(this.cubeCamera,t,n,i)},ScreenShotClass.prototype.update=function(){var t=this.appManager.currentExperience.renderer.autoClear;this.appManager.currentExperience.renderer.autoClear=!0;var n=this.appManager.currentExperience.cameraControlsRegistry.cameraControls.camera;this.cubeCamera.position.copy(n.position);var i=g.Utils.getLookAtVector(n);i.y=n.position.y,this.cubeCamera.lookAt(i),this.cubeCamera.update(this.appManager.currentExperience.renderer,this.appManager.currentExperience.scene),this.appManager.currentExperience.renderer.autoClear=t},ScreenShotClass.prototype.getRenderTarget=function(){return this.update(),this.cubeCamera.renderTarget},ScreenShotClass}(),S=!1;(a=n.ScreenShot||(n.ScreenShot={})).Capture=function Capture(t,n,i,a,s,m){return void 0===a&&(a=!0),S||((o=new _).init(t),S=!0),n&&i&&o.setSize(n,i),o.capture(a,s,m)},a.GetRenderTarget=function GetRenderTarget(t,n,i){return S||((o=new _).init(t),S=!0),n&&i&&o.setSize(n,i),o.getRenderTarget()}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fragmentShader=n.vertexShader=void 0,n.vertexShader="\nattribute vec3 position;\nattribute vec2 uv;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nvarying vec2 vUv;\nvoid main()  {\n\tvUv = vec2( 1.- uv.x, uv.y );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",n.fragmentShader="\nprecision mediump float;\nuniform samplerCube map;\nvarying vec2 vUv;\n#define M_PI 3.1415926535897932384626433832795\nvoid main()  {\n\tvec2 uv = vUv;\n\tfloat longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;\n\tfloat latitude = uv.y * M_PI;\n\tvec3 dir = vec3(\n\t\t- sin( longitude ) * sin( latitude ),\n\t\tcos( latitude ),\n\t\t- cos( longitude ) * sin( latitude )\n\t);\n\tnormalize( dir );\n\tgl_FragColor = textureCube( map, dir );\n}\n"},function(t,n,i){"use strict";var o=i(216),a=i(219).warn,s=n;s.version=i(372).version,s.transports=i(373),s.config=i(184),s.addColors=o.levels,s.format=o.format,s.createLogger=i(245),s.ExceptionHandler=i(246),s.RejectionHandler=i(250),s.Container=i(438),s.Transport=i(79),s.loggers=new s.Container;var m=s.createLogger();Object.keys(s.config.npm.levels).concat(["log","query","stream","add","remove","clear","profile","startTimer","handleExceptions","unhandleExceptions","handleRejections","unhandleRejections","configure","child"]).forEach((function(t){return s[t]=function(){return m[t].apply(m,arguments)}})),Object.defineProperty(s,"level",{get:function get(){return m.level},set:function set(t){m.level=t}}),Object.defineProperty(s,"exceptions",{get:function get(){return m.exceptions}}),["exitOnError"].forEach((function(t){Object.defineProperty(s,t,{get:function get(){return m[t]},set:function set(n){m[t]=n}})})),Object.defineProperty(s,"default",{get:function get(){return{exceptionHandlers:m.exceptionHandlers,rejectionHandlers:m.rejectionHandlers,transports:m.transports}}}),a.deprecated(s,"setLevels"),a.forFunctions(s,"useFormat",["cli"]),a.forProperties(s,"useFormat",["padLevels","stripColors"]),a.forFunctions(s,"deprecated",["addRewriter","addFilter","clone","extend"]),a.forProperties(s,"deprecated",["emitErrs","levelLength"]),a.moved(s,"createLogger","Logger")},function(t,n,i){"use strict";var o=n.format=i(57);n.levels=i(341),Object.defineProperty(o,"align",{value:i(358)}),Object.defineProperty(o,"cli",{value:i(359)}),Object.defineProperty(o,"combine",{value:i(360)}),Object.defineProperty(o,"colorize",{value:i(177)}),Object.defineProperty(o,"json",{value:i(361)}),Object.defineProperty(o,"label",{value:i(362)}),Object.defineProperty(o,"logstash",{value:i(363)}),Object.defineProperty(o,"metadata",{value:i(364)}),Object.defineProperty(o,"padLevels",{value:i(218)}),Object.defineProperty(o,"prettyPrint",{value:i(365)}),Object.defineProperty(o,"printf",{value:i(366)}),Object.defineProperty(o,"simple",{value:i(367)}),Object.defineProperty(o,"splat",{value:i(368)}),Object.defineProperty(o,"timestamp",{value:i(369)}),Object.defineProperty(o,"uncolorize",{value:i(371)})},function(t,n,i){var o=i(342);t.exports=o},function(t,n,i){"use strict";function _arrayLikeToArray(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,o=new Array(n);i<n;i++)o[i]=t[i];return o}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=i(27),a=o.configs,s=o.LEVEL,m=o.MESSAGE,g=function(){function Padder(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{levels:a.npm.levels};_classCallCheck(this,Padder),this.paddings=Padder.paddingForLevels(t.levels,t.filler),this.options=t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Padder,[{key:"transform",value:function transform(t,n){return t.message="".concat(this.paddings[t[s]]).concat(t.message),t[m]&&(t[m]="".concat(this.paddings[t[s]]).concat(t[m])),t}}],[{key:"getLongestLevel",value:function getLongestLevel(t){var n=Object.keys(t).map((function(t){return t.length}));return Math.max.apply(Math,function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function _unsupportedIterableToArray(t,n){if(t){if("string"==typeof t)return _arrayLikeToArray(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,n):void 0}}(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n))}},{key:"paddingForLevel",value:function paddingForLevel(t,n,i){var o=i+1-t.length,a=Math.floor(o/n.length);return"".concat(n).concat(n.repeat(a)).slice(0,o)}},{key:"paddingForLevels",value:function paddingForLevels(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",i=Padder.getLongestLevel(t);return Object.keys(t).reduce((function(t,o){return t[o]=Padder.paddingForLevel(o,n,i),t}),{})}}]),Padder}();t.exports=function(t){return new g(t)},t.exports.Padder=t.exports.Format=g},function(t,n,i){"use strict";var o=i(72).format;n.warn={deprecated:function deprecated(t){return function(){throw new Error(o("{ %s } was removed in winston@3.0.0.",t))}},useFormat:function useFormat(t){return function(){throw new Error([o("{ %s } was removed in winston@3.0.0.",t),"Use a custom winston.format = winston.format(function) instead."].join("\n"))}},forFunctions:function forFunctions(t,i,o){o.forEach((function(o){t[o]=n.warn[i](o)}))},moved:function moved(t,n,i){function movedNotice(){return function(){throw new Error([o("winston.%s was moved in winston@3.0.0.",i),o("Use a winston.%s instead.",n)].join("\n"))}}Object.defineProperty(t,i,{get:movedNotice,set:movedNotice})},forProperties:function forProperties(t,i,o){o.forEach((function(o){var a=n.warn[i](o);Object.defineProperty(t,o,{get:a,set:a})}))}}},function(t,n,i){t.exports=i(178)},function(t,n,i){(function(n){function config(t){try{if(!n.localStorage)return!1}catch(t){return!1}var i=n.localStorage[t];return null!=i&&"true"===String(i).toLowerCase()}t.exports=function deprecate(t,n){if(config("noDeprecation"))return t;var i=!1;return function deprecated(){if(!i){if(config("throwDeprecation"))throw new Error(n);config("traceDeprecation")?console.trace(n):console.warn(n),i=!0}return t.apply(this,arguments)}}}).call(this,i(33))},function(t,n,i){t.exports=i(119).EventEmitter},function(t,n,i){"use strict";var o=i(139);function emitErrorNT(t,n){t.emit("error",n)}t.exports={destroy:function destroy(t,n){var i=this,a=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return a||s?(n?n(t):!t||this._writableState&&this._writableState.errorEmitted||o.nextTick(emitErrorNT,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!n&&t?(o.nextTick(emitErrorNT,i,t),i._writableState&&(i._writableState.errorEmitted=!0)):n&&n(t)})),this)},undestroy:function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,n,i){"use strict";(function(n,o){var a=i(139);t.exports=Readable;var s,m=i(207);Readable.ReadableState=ReadableState,i(119).EventEmitter;var EElistenerCount=function(t,n){return t.listeners(n).length},g=i(222),_=i(179).Buffer,S=n.Uint8Array||function(){},M=Object.create(i(118));M.inherits=i(45);var T=i(376),O=void 0;O=T&&T.debuglog?T.debuglog("stream"):function(){};var A,P=i(377),L=i(223);M.inherits(Readable,g);var R=["error","close","destroy","pause","resume"];function ReadableState(t,n){t=t||{};var o=n instanceof(s=s||i(84));this.objectMode=!!t.objectMode,o&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var a=t.highWaterMark,m=t.readableHighWaterMark,g=this.objectMode?16:16384;this.highWaterMark=a||0===a?a:o&&(m||0===m)?m:g,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new P,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(A||(A=i(120).StringDecoder),this.decoder=new A(t.encoding),this.encoding=t.encoding)}function Readable(t){if(s=s||i(84),!(this instanceof Readable))return new Readable(t);this._readableState=new ReadableState(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),g.call(this)}function readableAddChunk(t,n,i,o,a){var s,m=t._readableState;return null===n?(m.reading=!1,function onEofChunk(t,n){if(!n.ended){if(n.decoder){var i=n.decoder.end();i&&i.length&&(n.buffer.push(i),n.length+=n.objectMode?1:i.length)}n.ended=!0,emitReadable(t)}}(t,m)):(a||(s=function chunkInvalid(t,n){var i;return function _isUint8Array(t){return _.isBuffer(t)||t instanceof S}(n)||"string"==typeof n||void 0===n||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}(m,n)),s?t.emit("error",s):m.objectMode||n&&n.length>0?("string"==typeof n||m.objectMode||Object.getPrototypeOf(n)===_.prototype||(n=function _uint8ArrayToBuffer(t){return _.from(t)}(n)),o?m.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):addChunk(t,m,n,!0):m.ended?t.emit("error",new Error("stream.push() after EOF")):(m.reading=!1,m.decoder&&!i?(n=m.decoder.write(n),m.objectMode||0!==n.length?addChunk(t,m,n,!1):maybeReadMore(t,m)):addChunk(t,m,n,!1))):o||(m.reading=!1)),function needMoreData(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(m)}function addChunk(t,n,i,o){n.flowing&&0===n.length&&!n.sync?(t.emit("data",i),t.read(0)):(n.length+=n.objectMode?1:i.length,o?n.buffer.unshift(i):n.buffer.push(i),n.needReadable&&emitReadable(t)),maybeReadMore(t,n)}function howMuchToRead(t,n){return t<=0||0===n.length&&n.ended?0:n.objectMode?1:t!=t?n.flowing&&n.length?n.buffer.head.data.length:n.length:(t>n.highWaterMark&&(n.highWaterMark=function computeNewHighWaterMark(t){return t>=8388608?t=8388608:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=n.length?t:n.ended?n.length:(n.needReadable=!0,0))}function emitReadable(t){var n=t._readableState;n.needReadable=!1,n.emittedReadable||(O("emitReadable",n.flowing),n.emittedReadable=!0,n.sync?a.nextTick(emitReadable_,t):emitReadable_(t))}function emitReadable_(t){O("emit readable"),t.emit("readable"),flow(t)}function maybeReadMore(t,n){n.readingMore||(n.readingMore=!0,a.nextTick(maybeReadMore_,t,n))}function maybeReadMore_(t,n){for(var i=n.length;!n.reading&&!n.flowing&&!n.ended&&n.length<n.highWaterMark&&(O("maybeReadMore read 0"),t.read(0),i!==n.length);)i=n.length;n.readingMore=!1}function nReadingNextTick(t){O("readable nexttick read 0"),t.read(0)}function resume_(t,n){n.reading||(O("resume read 0"),t.read(0)),n.resumeScheduled=!1,n.awaitDrain=0,t.emit("resume"),flow(t),n.flowing&&!n.reading&&t.read(0)}function flow(t){var n=t._readableState;for(O("flow",n.flowing);n.flowing&&null!==t.read(););}function fromList(t,n){return 0===n.length?null:(n.objectMode?i=n.buffer.shift():!t||t>=n.length?(i=n.decoder?n.buffer.join(""):1===n.buffer.length?n.buffer.head.data:n.buffer.concat(n.length),n.buffer.clear()):i=function fromListPartial(t,n,i){var o;return t<n.head.data.length?(o=n.head.data.slice(0,t),n.head.data=n.head.data.slice(t)):o=t===n.head.data.length?n.shift():i?function copyFromBufferString(t,n){var i=n.head,o=1,a=i.data;for(t-=a.length;i=i.next;){var s=i.data,m=t>s.length?s.length:t;if(m===s.length?a+=s:a+=s.slice(0,t),0==(t-=m)){m===s.length?(++o,i.next?n.head=i.next:n.head=n.tail=null):(n.head=i,i.data=s.slice(m));break}++o}return n.length-=o,a}(t,n):function copyFromBuffer(t,n){var i=_.allocUnsafe(t),o=n.head,a=1;for(o.data.copy(i),t-=o.data.length;o=o.next;){var s=o.data,m=t>s.length?s.length:t;if(s.copy(i,i.length-t,0,m),0==(t-=m)){m===s.length?(++a,o.next?n.head=o.next:n.head=n.tail=null):(n.head=o,o.data=s.slice(m));break}++a}return n.length-=a,i}(t,n),o}(t,n.buffer,n.decoder),i);var i}function endReadable(t){var n=t._readableState;if(n.length>0)throw new Error('"endReadable()" called on non-empty stream');n.endEmitted||(n.ended=!0,a.nextTick(endReadableNT,n,t))}function endReadableNT(t,n){t.endEmitted||0!==t.length||(t.endEmitted=!0,n.readable=!1,n.emit("end"))}function indexOf(t,n){for(var i=0,o=t.length;i<o;i++)if(t[i]===n)return i;return-1}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),Readable.prototype.destroy=L.destroy,Readable.prototype._undestroy=L.undestroy,Readable.prototype._destroy=function(t,n){this.push(null),n(t)},Readable.prototype.push=function(t,n){var i,o=this._readableState;return o.objectMode?i=!0:"string"==typeof t&&((n=n||o.defaultEncoding)!==o.encoding&&(t=_.from(t,n),n=""),i=!0),readableAddChunk(this,t,n,!1,i)},Readable.prototype.unshift=function(t){return readableAddChunk(this,t,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(t){return A||(A=i(120).StringDecoder),this._readableState.decoder=new A(t),this._readableState.encoding=t,this},Readable.prototype.read=function(t){O("read",t),t=parseInt(t,10);var n=this._readableState,i=t;if(0!==t&&(n.emittedReadable=!1),0===t&&n.needReadable&&(n.length>=n.highWaterMark||n.ended))return O("read: emitReadable",n.length,n.ended),0===n.length&&n.ended?endReadable(this):emitReadable(this),null;if(0===(t=howMuchToRead(t,n))&&n.ended)return 0===n.length&&endReadable(this),null;var o,a=n.needReadable;return O("need readable",a),(0===n.length||n.length-t<n.highWaterMark)&&O("length less than watermark",a=!0),n.ended||n.reading?O("reading or ended",a=!1):a&&(O("do read"),n.reading=!0,n.sync=!0,0===n.length&&(n.needReadable=!0),this._read(n.highWaterMark),n.sync=!1,n.reading||(t=howMuchToRead(i,n))),null===(o=t>0?fromList(t,n):null)?(n.needReadable=!0,t=0):n.length-=t,0===n.length&&(n.ended||(n.needReadable=!0),i!==t&&n.ended&&endReadable(this)),null!==o&&this.emit("data",o),o},Readable.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(t,n){var i=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,O("pipe count=%d opts=%j",s.pipesCount,n);var g=n&&!1===n.end||t===o.stdout||t===o.stderr?unpipe:onend;function onend(){O("onend"),t.end()}s.endEmitted?a.nextTick(g):i.once("end",g),t.on("unpipe",(function onunpipe(n,o){O("onunpipe"),n===i&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,function cleanup(){O("cleanup"),t.removeListener("close",onclose),t.removeListener("finish",onfinish),t.removeListener("drain",_),t.removeListener("error",onerror),t.removeListener("unpipe",onunpipe),i.removeListener("end",onend),i.removeListener("end",unpipe),i.removeListener("data",ondata),S=!0,!s.awaitDrain||t._writableState&&!t._writableState.needDrain||_()}())}));var _=function pipeOnDrain(t){return function(){var n=t._readableState;O("pipeOnDrain",n.awaitDrain),n.awaitDrain&&n.awaitDrain--,0===n.awaitDrain&&EElistenerCount(t,"data")&&(n.flowing=!0,flow(t))}}(i);t.on("drain",_);var S=!1,M=!1;function ondata(n){O("ondata"),M=!1,!1!==t.write(n)||M||((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==indexOf(s.pipes,t))&&!S&&(O("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,M=!0),i.pause())}function onerror(n){O("onerror",n),unpipe(),t.removeListener("error",onerror),0===EElistenerCount(t,"error")&&t.emit("error",n)}function onclose(){t.removeListener("finish",onfinish),unpipe()}function onfinish(){O("onfinish"),t.removeListener("close",onclose),unpipe()}function unpipe(){O("unpipe"),i.unpipe(t)}return i.on("data",ondata),function prependListener(t,n,i){if("function"==typeof t.prependListener)return t.prependListener(n,i);t._events&&t._events[n]?m(t._events[n])?t._events[n].unshift(i):t._events[n]=[i,t._events[n]]:t.on(n,i)}(t,"error",onerror),t.once("close",onclose),t.once("finish",onfinish),t.emit("pipe",i),s.flowing||(O("pipe resume"),i.resume()),t},Readable.prototype.unpipe=function(t){var n=this._readableState,i={hasUnpiped:!1};if(0===n.pipesCount)return this;if(1===n.pipesCount)return t&&t!==n.pipes||(t||(t=n.pipes),n.pipes=null,n.pipesCount=0,n.flowing=!1,t&&t.emit("unpipe",this,i)),this;if(!t){var o=n.pipes,a=n.pipesCount;n.pipes=null,n.pipesCount=0,n.flowing=!1;for(var s=0;s<a;s++)o[s].emit("unpipe",this,i);return this}var m=indexOf(n.pipes,t);return-1===m||(n.pipes.splice(m,1),n.pipesCount-=1,1===n.pipesCount&&(n.pipes=n.pipes[0]),t.emit("unpipe",this,i)),this},Readable.prototype.on=function(t,n){var i=g.prototype.on.call(this,t,n);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var o=this._readableState;o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.emittedReadable=!1,o.reading?o.length&&emitReadable(this):a.nextTick(nReadingNextTick,this))}return i},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var t=this._readableState;return t.flowing||(O("resume"),t.flowing=!0,function resume(t,n){n.resumeScheduled||(n.resumeScheduled=!0,a.nextTick(resume_,t,n))}(this,t)),this},Readable.prototype.pause=function(){return O("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(O("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(t){var n=this,i=this._readableState,o=!1;for(var a in t.on("end",(function(){if(O("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&n.push(t)}n.push(null)})),t.on("data",(function(a){O("wrapped data"),i.decoder&&(a=i.decoder.write(a)),i.objectMode&&null==a||(i.objectMode||a&&a.length)&&(n.push(a)||(o=!0,t.pause()))})),t)void 0===this[a]&&"function"==typeof t[a]&&(this[a]=function(n){return function(){return t[n].apply(t,arguments)}}(a));for(var s=0;s<R.length;s++)t.on(R[s],this.emit.bind(this,R[s]));return this._read=function(n){O("wrapped _read",n),o&&(o=!1,t.resume())},this},Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Readable._fromList=fromList}).call(this,i(33),i(25))},function(t,n){},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=_interopRequireDefault(i(388)),a=_interopRequireDefault(i(92)),s=_interopRequireDefault(i(121));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}n.default=(0,s.default)((function eachOfLimit(t,n,i,s){return(0,o.default)(n)(t,(0,a.default)(i),s)}),4),t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function once(t){function wrapper(...n){if(null!==t){var i=t;t=null,i.apply(this,n)}}return Object.assign(wrapper,t),wrapper},t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function onlyOnce(t){return function(...n){if(null===t)throw new Error("Callback was already called.");var i=t;t=null,i.apply(this,n)}},t.exports=n.default},function(t,n,i){"use strict";t.exports=Transform;var o=i(84),a=Object.create(i(118));function afterTransform(t,n){var i=this._transformState;i.transforming=!1;var o=i.writecb;if(!o)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=n&&this.push(n),o(t);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function Transform(t){if(!(this instanceof Transform))return new Transform(t);o.call(this,t),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",prefinish)}function prefinish(){var t=this;"function"==typeof this._flush?this._flush((function(n,i){done(t,n,i)})):done(this,null,null)}function done(t,n,i){if(n)return t.emit("error",n);if(null!=i&&t.push(i),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}a.inherits=i(45),a.inherits(Transform,o),Transform.prototype.push=function(t,n){return this._transformState.needTransform=!1,o.prototype.push.call(this,t,n)},Transform.prototype._transform=function(t,n,i){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(t,n,i){var o=this._transformState;if(o.writecb=i,o.writechunk=t,o.writeencoding=n,!o.transforming){var a=this._readableState;(o.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},Transform.prototype._read=function(t){var n=this._transformState;null!==n.writechunk&&n.writecb&&!n.transforming?(n.transforming=!0,this._transform(n.writechunk,n.writeencoding,n.afterTransform)):n.needTransform=!0},Transform.prototype._destroy=function(t,n){var i=this;o.prototype._destroy.call(this,t,(function(t){n(t),i.emit("close")}))}},function(t,n,i){"use strict";(function(n){var o=i(399);function compare(t,n){if(t===n)return 0;for(var i=t.length,o=n.length,a=0,s=Math.min(i,o);a<s;++a)if(t[a]!==n[a]){i=t[a],o=n[a];break}return i<o?-1:o<i?1:0}function isBuffer(t){return n.Buffer&&"function"==typeof n.Buffer.isBuffer?n.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var a=i(72),s=Object.prototype.hasOwnProperty,m=Array.prototype.slice,g="foo"===function foo(){}.name;function pToString(t){return Object.prototype.toString.call(t)}function isView(t){return!isBuffer(t)&&"function"==typeof n.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer)))}var _=t.exports=ok,S=/\s*function\s+([^\(\s]*)\s*/;function getName(t){if(a.isFunction(t)){if(g)return t.name;var n=t.toString().match(S);return n&&n[1]}}function truncate(t,n){return"string"==typeof t?t.length<n?t:t.slice(0,n):t}function inspect(t){if(g||!a.isFunction(t))return a.inspect(t);var n=getName(t);return"[Function"+(n?": "+n:"")+"]"}function fail(t,n,i,o,a){throw new _.AssertionError({message:i,actual:t,expected:n,operator:o,stackStartFunction:a})}function ok(t,n){t||fail(t,!0,n,"==",_.ok)}function _deepEqual(t,n,i,o){if(t===n)return!0;if(isBuffer(t)&&isBuffer(n))return 0===compare(t,n);if(a.isDate(t)&&a.isDate(n))return t.getTime()===n.getTime();if(a.isRegExp(t)&&a.isRegExp(n))return t.source===n.source&&t.global===n.global&&t.multiline===n.multiline&&t.lastIndex===n.lastIndex&&t.ignoreCase===n.ignoreCase;if(null!==t&&"object"==typeof t||null!==n&&"object"==typeof n){if(isView(t)&&isView(n)&&pToString(t)===pToString(n)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===compare(new Uint8Array(t.buffer),new Uint8Array(n.buffer));if(isBuffer(t)!==isBuffer(n))return!1;var s=(o=o||{actual:[],expected:[]}).actual.indexOf(t);return-1!==s&&s===o.expected.indexOf(n)||(o.actual.push(t),o.expected.push(n),function objEquiv(t,n,i,o){if(null==t||null==n)return!1;if(a.isPrimitive(t)||a.isPrimitive(n))return t===n;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(n))return!1;var s=isArguments(t),g=isArguments(n);if(s&&!g||!s&&g)return!1;if(s)return _deepEqual(t=m.call(t),n=m.call(n),i);var _,S,T=M(t),O=M(n);if(T.length!==O.length)return!1;for(T.sort(),O.sort(),S=T.length-1;S>=0;S--)if(T[S]!==O[S])return!1;for(S=T.length-1;S>=0;S--)if(!_deepEqual(t[_=T[S]],n[_],i,o))return!1;return!0}(t,n,i,o))}return i?t===n:t==n}function isArguments(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function expectedException(t,n){if(!t||!n)return!1;if("[object RegExp]"==Object.prototype.toString.call(n))return n.test(t);try{if(t instanceof n)return!0}catch(t){}return!Error.isPrototypeOf(n)&&!0===n.call({},t)}function _throws(t,n,i,o){var s;if("function"!=typeof n)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(o=i,i=null),s=function _tryBlock(t){var n;try{t()}catch(t){n=t}return n}(n),o=(i&&i.name?" ("+i.name+").":".")+(o?" "+o:"."),t&&!s&&fail(s,i,"Missing expected exception"+o);var m="string"==typeof o,g=!t&&s&&!i;if((!t&&a.isError(s)&&m&&expectedException(s,i)||g)&&fail(s,i,"Got unwanted exception"+o),t&&s&&i&&!expectedException(s,i)||!t&&s)throw s}_.AssertionError=function AssertionError(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=function getMessage(t){return truncate(inspect(t.actual),128)+" "+t.operator+" "+truncate(inspect(t.expected),128)}(this),this.generatedMessage=!0);var n=t.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,n);else{var i=new Error;if(i.stack){var o=i.stack,a=getName(n),s=o.indexOf("\n"+a);if(s>=0){var m=o.indexOf("\n",s+1);o=o.substring(m+1)}this.stack=o}}},a.inherits(_.AssertionError,Error),_.fail=fail,_.ok=ok,_.equal=function equal(t,n,i){t!=n&&fail(t,n,i,"==",_.equal)},_.notEqual=function notEqual(t,n,i){t==n&&fail(t,n,i,"!=",_.notEqual)},_.deepEqual=function deepEqual(t,n,i){_deepEqual(t,n,!1)||fail(t,n,i,"deepEqual",_.deepEqual)},_.deepStrictEqual=function deepStrictEqual(t,n,i){_deepEqual(t,n,!0)||fail(t,n,i,"deepStrictEqual",_.deepStrictEqual)},_.notDeepEqual=function notDeepEqual(t,n,i){_deepEqual(t,n,!1)&&fail(t,n,i,"notDeepEqual",_.notDeepEqual)},_.notDeepStrictEqual=function notDeepStrictEqual(t,n,i){_deepEqual(t,n,!0)&&fail(t,n,i,"notDeepStrictEqual",notDeepStrictEqual)},_.strictEqual=function strictEqual(t,n,i){t!==n&&fail(t,n,i,"===",_.strictEqual)},_.notStrictEqual=function notStrictEqual(t,n,i){t===n&&fail(t,n,i,"!==",_.notStrictEqual)},_.throws=function(t,n,i){_throws(!0,t,n,i)},_.doesNotThrow=function(t,n,i){_throws(!1,t,n,i)},_.ifError=function(t){if(t)throw t},_.strict=o((function strict(t,n){t||fail(t,!0,n,"==",strict)}),_,{equal:_.strictEqual,deepEqual:_.deepStrictEqual,notEqual:_.notStrictEqual,notDeepEqual:_.notDeepStrictEqual}),_.strict.strict=_.strict;var M=Object.keys||function(t){var n=[];for(var i in t)s.call(t,i)&&n.push(i);return n}}).call(this,i(33))},function(t,n,i){"use strict";t.exports=function adler32(t,n,i,o){for(var a=65535&t|0,s=t>>>16&65535|0,m=0;0!==i;){i-=m=i>2e3?2e3:i;do{s=s+(a=a+n[o++]|0)|0}while(--m);a%=65521,s%=65521}return a|s<<16|0}},function(t,n,i){"use strict";var o=function makeTable(){for(var t,n=[],i=0;i<256;i++){t=i;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;n[i]=t}return n}();t.exports=function crc32(t,n,i,a){var s=o,m=a+i;t^=-1;for(var g=a;g<m;g++)t=t>>>8^s[255&(t^n[g])];return-1^t}},function(t,n,i){"use strict";(function(n,o){var a;t.exports=Readable,Readable.ReadableState=ReadableState,i(119).EventEmitter;var s,m=function EElistenerCount(t,n){return t.listeners(n).length},g=i(234),_=i(31).Buffer,S=n.Uint8Array||function(){},M=i(408);s=M&&M.debuglog?M.debuglog("stream"):function debug(){};var T,O,A,P=i(409),L=i(235),R=i(236).getHighWaterMark,N=i(93).codes,I=N.ERR_INVALID_ARG_TYPE,j=N.ERR_STREAM_PUSH_AFTER_EOF,V=N.ERR_METHOD_NOT_IMPLEMENTED,U=N.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i(45)(Readable,g);var G=L.errorOrDestroy,z=["error","close","destroy","pause","resume"];function ReadableState(t,n,o){a=a||i(94),t=t||{},"boolean"!=typeof o&&(o=n instanceof a),this.objectMode=!!t.objectMode,o&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=R(this,t,"readableHighWaterMark",o),this.buffer=new P,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(T||(T=i(120).StringDecoder),this.decoder=new T(t.encoding),this.encoding=t.encoding)}function Readable(t){if(a=a||i(94),!(this instanceof Readable))return new Readable(t);var n=this instanceof a;this._readableState=new ReadableState(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),g.call(this)}function readableAddChunk(t,n,i,o,a){s("readableAddChunk",n);var m,g=t._readableState;if(null===n)g.reading=!1,function onEofChunk(t,n){if(s("onEofChunk"),!n.ended){if(n.decoder){var i=n.decoder.end();i&&i.length&&(n.buffer.push(i),n.length+=n.objectMode?1:i.length)}n.ended=!0,n.sync?emitReadable(t):(n.needReadable=!1,n.emittedReadable||(n.emittedReadable=!0,emitReadable_(t)))}}(t,g);else if(a||(m=function chunkInvalid(t,n){var i;return function _isUint8Array(t){return _.isBuffer(t)||t instanceof S}(n)||"string"==typeof n||void 0===n||t.objectMode||(i=new I("chunk",["string","Buffer","Uint8Array"],n)),i}(g,n)),m)G(t,m);else if(g.objectMode||n&&n.length>0)if("string"==typeof n||g.objectMode||Object.getPrototypeOf(n)===_.prototype||(n=function _uint8ArrayToBuffer(t){return _.from(t)}(n)),o)g.endEmitted?G(t,new U):addChunk(t,g,n,!0);else if(g.ended)G(t,new j);else{if(g.destroyed)return!1;g.reading=!1,g.decoder&&!i?(n=g.decoder.write(n),g.objectMode||0!==n.length?addChunk(t,g,n,!1):maybeReadMore(t,g)):addChunk(t,g,n,!1)}else o||(g.reading=!1,maybeReadMore(t,g));return!g.ended&&(g.length<g.highWaterMark||0===g.length)}function addChunk(t,n,i,o){n.flowing&&0===n.length&&!n.sync?(n.awaitDrain=0,t.emit("data",i)):(n.length+=n.objectMode?1:i.length,o?n.buffer.unshift(i):n.buffer.push(i),n.needReadable&&emitReadable(t)),maybeReadMore(t,n)}function howMuchToRead(t,n){return t<=0||0===n.length&&n.ended?0:n.objectMode?1:t!=t?n.flowing&&n.length?n.buffer.head.data.length:n.length:(t>n.highWaterMark&&(n.highWaterMark=function computeNewHighWaterMark(t){return t>=1073741824?t=1073741824:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=n.length?t:n.ended?n.length:(n.needReadable=!0,0))}function emitReadable(t){var n=t._readableState;s("emitReadable",n.needReadable,n.emittedReadable),n.needReadable=!1,n.emittedReadable||(s("emitReadable",n.flowing),n.emittedReadable=!0,o.nextTick(emitReadable_,t))}function emitReadable_(t){var n=t._readableState;s("emitReadable_",n.destroyed,n.length,n.ended),n.destroyed||!n.length&&!n.ended||(t.emit("readable"),n.emittedReadable=!1),n.needReadable=!n.flowing&&!n.ended&&n.length<=n.highWaterMark,flow(t)}function maybeReadMore(t,n){n.readingMore||(n.readingMore=!0,o.nextTick(maybeReadMore_,t,n))}function maybeReadMore_(t,n){for(;!n.reading&&!n.ended&&(n.length<n.highWaterMark||n.flowing&&0===n.length);){var i=n.length;if(s("maybeReadMore read 0"),t.read(0),i===n.length)break}n.readingMore=!1}function updateReadableListening(t){var n=t._readableState;n.readableListening=t.listenerCount("readable")>0,n.resumeScheduled&&!n.paused?n.flowing=!0:t.listenerCount("data")>0&&t.resume()}function nReadingNextTick(t){s("readable nexttick read 0"),t.read(0)}function resume_(t,n){s("resume",n.reading),n.reading||t.read(0),n.resumeScheduled=!1,t.emit("resume"),flow(t),n.flowing&&!n.reading&&t.read(0)}function flow(t){var n=t._readableState;for(s("flow",n.flowing);n.flowing&&null!==t.read(););}function fromList(t,n){return 0===n.length?null:(n.objectMode?i=n.buffer.shift():!t||t>=n.length?(i=n.decoder?n.buffer.join(""):1===n.buffer.length?n.buffer.first():n.buffer.concat(n.length),n.buffer.clear()):i=n.buffer.consume(t,n.decoder),i);var i}function endReadable(t){var n=t._readableState;s("endReadable",n.endEmitted),n.endEmitted||(n.ended=!0,o.nextTick(endReadableNT,n,t))}function endReadableNT(t,n){if(s("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&0===t.length&&(t.endEmitted=!0,n.readable=!1,n.emit("end"),t.autoDestroy)){var i=n._writableState;(!i||i.autoDestroy&&i.finished)&&n.destroy()}}function indexOf(t,n){for(var i=0,o=t.length;i<o;i++)if(t[i]===n)return i;return-1}Object.defineProperty(Readable.prototype,"destroyed",{enumerable:!1,get:function get(){return void 0!==this._readableState&&this._readableState.destroyed},set:function set(t){this._readableState&&(this._readableState.destroyed=t)}}),Readable.prototype.destroy=L.destroy,Readable.prototype._undestroy=L.undestroy,Readable.prototype._destroy=function(t,n){n(t)},Readable.prototype.push=function(t,n){var i,o=this._readableState;return o.objectMode?i=!0:"string"==typeof t&&((n=n||o.defaultEncoding)!==o.encoding&&(t=_.from(t,n),n=""),i=!0),readableAddChunk(this,t,n,!1,i)},Readable.prototype.unshift=function(t){return readableAddChunk(this,t,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(t){T||(T=i(120).StringDecoder);var n=new T(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var o=this._readableState.buffer.head,a="";null!==o;)a+=n.write(o.data),o=o.next;return this._readableState.buffer.clear(),""!==a&&this._readableState.buffer.push(a),this._readableState.length=a.length,this},Readable.prototype.read=function(t){s("read",t),t=parseInt(t,10);var n=this._readableState,i=t;if(0!==t&&(n.emittedReadable=!1),0===t&&n.needReadable&&((0!==n.highWaterMark?n.length>=n.highWaterMark:n.length>0)||n.ended))return s("read: emitReadable",n.length,n.ended),0===n.length&&n.ended?endReadable(this):emitReadable(this),null;if(0===(t=howMuchToRead(t,n))&&n.ended)return 0===n.length&&endReadable(this),null;var o,a=n.needReadable;return s("need readable",a),(0===n.length||n.length-t<n.highWaterMark)&&s("length less than watermark",a=!0),n.ended||n.reading?s("reading or ended",a=!1):a&&(s("do read"),n.reading=!0,n.sync=!0,0===n.length&&(n.needReadable=!0),this._read(n.highWaterMark),n.sync=!1,n.reading||(t=howMuchToRead(i,n))),null===(o=t>0?fromList(t,n):null)?(n.needReadable=n.length<=n.highWaterMark,t=0):(n.length-=t,n.awaitDrain=0),0===n.length&&(n.ended||(n.needReadable=!0),i!==t&&n.ended&&endReadable(this)),null!==o&&this.emit("data",o),o},Readable.prototype._read=function(t){G(this,new V("_read()"))},Readable.prototype.pipe=function(t,n){var i=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=t;break;case 1:a.pipes=[a.pipes,t];break;default:a.pipes.push(t)}a.pipesCount+=1,s("pipe count=%d opts=%j",a.pipesCount,n);var g=n&&!1===n.end||t===o.stdout||t===o.stderr?unpipe:onend;function onend(){s("onend"),t.end()}a.endEmitted?o.nextTick(g):i.once("end",g),t.on("unpipe",(function onunpipe(n,o){s("onunpipe"),n===i&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,function cleanup(){s("cleanup"),t.removeListener("close",onclose),t.removeListener("finish",onfinish),t.removeListener("drain",_),t.removeListener("error",onerror),t.removeListener("unpipe",onunpipe),i.removeListener("end",onend),i.removeListener("end",unpipe),i.removeListener("data",ondata),S=!0,!a.awaitDrain||t._writableState&&!t._writableState.needDrain||_()}())}));var _=function pipeOnDrain(t){return function pipeOnDrainFunctionResult(){var n=t._readableState;s("pipeOnDrain",n.awaitDrain),n.awaitDrain&&n.awaitDrain--,0===n.awaitDrain&&m(t,"data")&&(n.flowing=!0,flow(t))}}(i);t.on("drain",_);var S=!1;function ondata(n){s("ondata");var o=t.write(n);s("dest.write",o),!1===o&&((1===a.pipesCount&&a.pipes===t||a.pipesCount>1&&-1!==indexOf(a.pipes,t))&&!S&&(s("false write response, pause",a.awaitDrain),a.awaitDrain++),i.pause())}function onerror(n){s("onerror",n),unpipe(),t.removeListener("error",onerror),0===m(t,"error")&&G(t,n)}function onclose(){t.removeListener("finish",onfinish),unpipe()}function onfinish(){s("onfinish"),t.removeListener("close",onclose),unpipe()}function unpipe(){s("unpipe"),i.unpipe(t)}return i.on("data",ondata),function prependListener(t,n,i){if("function"==typeof t.prependListener)return t.prependListener(n,i);t._events&&t._events[n]?Array.isArray(t._events[n])?t._events[n].unshift(i):t._events[n]=[i,t._events[n]]:t.on(n,i)}(t,"error",onerror),t.once("close",onclose),t.once("finish",onfinish),t.emit("pipe",i),a.flowing||(s("pipe resume"),i.resume()),t},Readable.prototype.unpipe=function(t){var n=this._readableState,i={hasUnpiped:!1};if(0===n.pipesCount)return this;if(1===n.pipesCount)return t&&t!==n.pipes||(t||(t=n.pipes),n.pipes=null,n.pipesCount=0,n.flowing=!1,t&&t.emit("unpipe",this,i)),this;if(!t){var o=n.pipes,a=n.pipesCount;n.pipes=null,n.pipesCount=0,n.flowing=!1;for(var s=0;s<a;s++)o[s].emit("unpipe",this,{hasUnpiped:!1});return this}var m=indexOf(n.pipes,t);return-1===m||(n.pipes.splice(m,1),n.pipesCount-=1,1===n.pipesCount&&(n.pipes=n.pipes[0]),t.emit("unpipe",this,i)),this},Readable.prototype.on=function(t,n){var i=g.prototype.on.call(this,t,n),a=this._readableState;return"data"===t?(a.readableListening=this.listenerCount("readable")>0,!1!==a.flowing&&this.resume()):"readable"===t&&(a.endEmitted||a.readableListening||(a.readableListening=a.needReadable=!0,a.flowing=!1,a.emittedReadable=!1,s("on readable",a.length,a.reading),a.length?emitReadable(this):a.reading||o.nextTick(nReadingNextTick,this))),i},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.removeListener=function(t,n){var i=g.prototype.removeListener.call(this,t,n);return"readable"===t&&o.nextTick(updateReadableListening,this),i},Readable.prototype.removeAllListeners=function(t){var n=g.prototype.removeAllListeners.apply(this,arguments);return"readable"!==t&&void 0!==t||o.nextTick(updateReadableListening,this),n},Readable.prototype.resume=function(){var t=this._readableState;return t.flowing||(s("resume"),t.flowing=!t.readableListening,function resume(t,n){n.resumeScheduled||(n.resumeScheduled=!0,o.nextTick(resume_,t,n))}(this,t)),t.paused=!1,this},Readable.prototype.pause=function(){return s("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(s("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},Readable.prototype.wrap=function(t){var n=this,i=this._readableState,o=!1;for(var a in t.on("end",(function(){if(s("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&n.push(t)}n.push(null)})),t.on("data",(function(a){s("wrapped data"),i.decoder&&(a=i.decoder.write(a)),i.objectMode&&null==a||(i.objectMode||a&&a.length)&&(n.push(a)||(o=!0,t.pause()))})),t)void 0===this[a]&&"function"==typeof t[a]&&(this[a]=function methodWrap(n){return function methodWrapReturnFunction(){return t[n].apply(t,arguments)}}(a));for(var m=0;m<z.length;m++)t.on(z[m],this.emit.bind(this,z[m]));return this._read=function(n){s("wrapped _read",n),o&&(o=!1,t.resume())},this},"function"==typeof Symbol&&(Readable.prototype[Symbol.asyncIterator]=function(){return void 0===O&&(O=i(411)),O(this)}),Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function get(){return this._readableState.highWaterMark}}),Object.defineProperty(Readable.prototype,"readableBuffer",{enumerable:!1,get:function get(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Readable.prototype,"readableFlowing",{enumerable:!1,get:function get(){return this._readableState.flowing},set:function set(t){this._readableState&&(this._readableState.flowing=t)}}),Readable._fromList=fromList,Object.defineProperty(Readable.prototype,"readableLength",{enumerable:!1,get:function get(){return this._readableState.length}}),"function"==typeof Symbol&&(Readable.from=function(t,n){return void 0===A&&(A=i(412)),A(Readable,t,n)})}).call(this,i(33),i(25))},function(t,n,i){t.exports=i(119).EventEmitter},function(t,n,i){"use strict";(function(n){function emitErrorAndCloseNT(t,n){emitErrorNT(t,n),emitCloseNT(t)}function emitCloseNT(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function emitErrorNT(t,n){t.emit("error",n)}t.exports={destroy:function destroy(t,i){var o=this,a=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return a||s?(i?i(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,n.nextTick(emitErrorNT,this,t)):n.nextTick(emitErrorNT,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!i&&t?o._writableState?o._writableState.errorEmitted?n.nextTick(emitCloseNT,o):(o._writableState.errorEmitted=!0,n.nextTick(emitErrorAndCloseNT,o,t)):n.nextTick(emitErrorAndCloseNT,o,t):i?(n.nextTick(emitCloseNT,o),i(t)):n.nextTick(emitCloseNT,o)})),this)},undestroy:function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function errorOrDestroy(t,n){var i=t._readableState,o=t._writableState;i&&i.autoDestroy||o&&o.autoDestroy?t.destroy(n):t.emit("error",n)}}}).call(this,i(25))},function(t,n,i){"use strict";var o=i(93).codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function getHighWaterMark(t,n,i,a){var s=function highWaterMarkFrom(t,n,i){return null!=t.highWaterMark?t.highWaterMark:n?t[i]:null}(n,a,i);if(null!=s){if(!isFinite(s)||Math.floor(s)!==s||s<0)throw new o(a?i:"highWaterMark",s);return Math.floor(s)}return t.objectMode?16:16384}}},function(t,n,i){"use strict";(function(n,o){function CorkedRequest(t){var n=this;this.next=null,this.entry=null,this.finish=function(){!function onCorkedFinish(t,n,i){var o=t.entry;for(t.entry=null;o;){var a=o.callback;n.pendingcb--,a(i),o=o.next}n.corkedRequestsFree.next=t}(n,t)}}var a;t.exports=Writable,Writable.WritableState=WritableState;var s,m={deprecate:i(221)},g=i(234),_=i(31).Buffer,S=n.Uint8Array||function(){},M=i(235),T=i(236).getHighWaterMark,O=i(93).codes,A=O.ERR_INVALID_ARG_TYPE,P=O.ERR_METHOD_NOT_IMPLEMENTED,L=O.ERR_MULTIPLE_CALLBACK,R=O.ERR_STREAM_CANNOT_PIPE,N=O.ERR_STREAM_DESTROYED,I=O.ERR_STREAM_NULL_VALUES,j=O.ERR_STREAM_WRITE_AFTER_END,V=O.ERR_UNKNOWN_ENCODING,U=M.errorOrDestroy;function nop(){}function WritableState(t,n,s){a=a||i(94),t=t||{},"boolean"!=typeof s&&(s=n instanceof a),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=T(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var m=!1===t.decodeStrings;this.decodeStrings=!m,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function onwrite(t,n){var i=t._writableState,a=i.sync,s=i.writecb;if("function"!=typeof s)throw new L;if(function onwriteStateUpdate(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),n)!function onwriteError(t,n,i,a,s){--n.pendingcb,i?(o.nextTick(s,a),o.nextTick(finishMaybe,t,n),t._writableState.errorEmitted=!0,U(t,a)):(s(a),t._writableState.errorEmitted=!0,U(t,a),finishMaybe(t,n))}(t,i,a,n,s);else{var m=needFinish(i)||t.destroyed;m||i.corked||i.bufferProcessing||!i.bufferedRequest||clearBuffer(t,i),a?o.nextTick(afterWrite,t,i,m,s):afterWrite(t,i,m,s)}}(n,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(t){var n=this instanceof(a=a||i(94));if(!n&&!s.call(Writable,this))return new Writable(t);this._writableState=new WritableState(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),g.call(this)}function doWrite(t,n,i,o,a,s,m){n.writelen=o,n.writecb=m,n.writing=!0,n.sync=!0,n.destroyed?n.onwrite(new N("write")):i?t._writev(a,n.onwrite):t._write(a,s,n.onwrite),n.sync=!1}function afterWrite(t,n,i,o){i||function onwriteDrain(t,n){0===n.length&&n.needDrain&&(n.needDrain=!1,t.emit("drain"))}(t,n),n.pendingcb--,o(),finishMaybe(t,n)}function clearBuffer(t,n){n.bufferProcessing=!0;var i=n.bufferedRequest;if(t._writev&&i&&i.next){var o=n.bufferedRequestCount,a=new Array(o),s=n.corkedRequestsFree;s.entry=i;for(var m=0,g=!0;i;)a[m]=i,i.isBuf||(g=!1),i=i.next,m+=1;a.allBuffers=g,doWrite(t,n,!0,n.length,a,"",s.finish),n.pendingcb++,n.lastBufferedRequest=null,s.next?(n.corkedRequestsFree=s.next,s.next=null):n.corkedRequestsFree=new CorkedRequest(n),n.bufferedRequestCount=0}else{for(;i;){var _=i.chunk,S=i.encoding,M=i.callback;if(doWrite(t,n,!1,n.objectMode?1:_.length,_,S,M),i=i.next,n.bufferedRequestCount--,n.writing)break}null===i&&(n.lastBufferedRequest=null)}n.bufferedRequest=i,n.bufferProcessing=!1}function needFinish(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function callFinal(t,n){t._final((function(i){n.pendingcb--,i&&U(t,i),n.prefinished=!0,t.emit("prefinish"),finishMaybe(t,n)}))}function finishMaybe(t,n){var i=needFinish(n);if(i&&(function prefinish(t,n){n.prefinished||n.finalCalled||("function"!=typeof t._final||n.destroyed?(n.prefinished=!0,t.emit("prefinish")):(n.pendingcb++,n.finalCalled=!0,o.nextTick(callFinal,t,n)))}(t,n),0===n.pendingcb&&(n.finished=!0,t.emit("finish"),n.autoDestroy))){var a=t._readableState;(!a||a.autoDestroy&&a.endEmitted)&&t.destroy()}return i}i(45)(Writable,g),WritableState.prototype.getBuffer=function getBuffer(){for(var t=this.bufferedRequest,n=[];t;)n.push(t),t=t.next;return n},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:m.deprecate((function writableStateBufferGetter(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function value(t){return!!s.call(this,t)||this===Writable&&t&&t._writableState instanceof WritableState}})):s=function realHasInstance(t){return t instanceof this},Writable.prototype.pipe=function(){U(this,new R)},Writable.prototype.write=function(t,n,i){var a=this._writableState,s=!1,m=!a.objectMode&&function _isUint8Array(t){return _.isBuffer(t)||t instanceof S}(t);return m&&!_.isBuffer(t)&&(t=function _uint8ArrayToBuffer(t){return _.from(t)}(t)),"function"==typeof n&&(i=n,n=null),m?n="buffer":n||(n=a.defaultEncoding),"function"!=typeof i&&(i=nop),a.ending?function writeAfterEnd(t,n){var i=new j;U(t,i),o.nextTick(n,i)}(this,i):(m||function validChunk(t,n,i,a){var s;return null===i?s=new I:"string"==typeof i||n.objectMode||(s=new A("chunk",["string","Buffer"],i)),!s||(U(t,s),o.nextTick(a,s),!1)}(this,a,t,i))&&(a.pendingcb++,s=function writeOrBuffer(t,n,i,o,a,s){if(!i){var m=function decodeChunk(t,n,i){return t.objectMode||!1===t.decodeStrings||"string"!=typeof n||(n=_.from(n,i)),n}(n,o,a);o!==m&&(i=!0,a="buffer",o=m)}var g=n.objectMode?1:o.length;n.length+=g;var S=n.length<n.highWaterMark;if(S||(n.needDrain=!0),n.writing||n.corked){var M=n.lastBufferedRequest;n.lastBufferedRequest={chunk:o,encoding:a,isBuf:i,callback:s,next:null},M?M.next=n.lastBufferedRequest:n.bufferedRequest=n.lastBufferedRequest,n.bufferedRequestCount+=1}else doWrite(t,n,!1,g,o,a,s);return S}(this,a,m,t,n,i)),s},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.bufferProcessing||!t.bufferedRequest||clearBuffer(this,t))},Writable.prototype.setDefaultEncoding=function setDefaultEncoding(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new V(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(Writable.prototype,"writableBuffer",{enumerable:!1,get:function get(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function get(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(t,n,i){i(new P("_write()"))},Writable.prototype._writev=null,Writable.prototype.end=function(t,n,i){var a=this._writableState;return"function"==typeof t?(i=t,t=null,n=null):"function"==typeof n&&(i=n,n=null),null!=t&&this.write(t,n),a.corked&&(a.corked=1,this.uncork()),a.ending||function endWritable(t,n,i){n.ending=!0,finishMaybe(t,n),i&&(n.finished?o.nextTick(i):t.once("finish",i)),n.ended=!0,t.writable=!1}(this,a,i),this},Object.defineProperty(Writable.prototype,"writableLength",{enumerable:!1,get:function get(){return this._writableState.length}}),Object.defineProperty(Writable.prototype,"destroyed",{enumerable:!1,get:function get(){return void 0!==this._writableState&&this._writableState.destroyed},set:function set(t){this._writableState&&(this._writableState.destroyed=t)}}),Writable.prototype.destroy=M.destroy,Writable.prototype._undestroy=M.undestroy,Writable.prototype._destroy=function(t,n){n(t)}}).call(this,i(33),i(25))},function(t,n,i){"use strict";t.exports=Transform;var o=i(93).codes,a=o.ERR_METHOD_NOT_IMPLEMENTED,s=o.ERR_MULTIPLE_CALLBACK,m=o.ERR_TRANSFORM_ALREADY_TRANSFORMING,g=o.ERR_TRANSFORM_WITH_LENGTH_0,_=i(94);function afterTransform(t,n){var i=this._transformState;i.transforming=!1;var o=i.writecb;if(null===o)return this.emit("error",new s);i.writechunk=null,i.writecb=null,null!=n&&this.push(n),o(t);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function Transform(t){if(!(this instanceof Transform))return new Transform(t);_.call(this,t),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",prefinish)}function prefinish(){var t=this;"function"!=typeof this._flush||this._readableState.destroyed?done(this,null,null):this._flush((function(n,i){done(t,n,i)}))}function done(t,n,i){if(n)return t.emit("error",n);if(null!=i&&t.push(i),t._writableState.length)throw new g;if(t._transformState.transforming)throw new m;return t.push(null)}i(45)(Transform,_),Transform.prototype.push=function(t,n){return this._transformState.needTransform=!1,_.prototype.push.call(this,t,n)},Transform.prototype._transform=function(t,n,i){i(new a("_transform()"))},Transform.prototype._write=function(t,n,i){var o=this._transformState;if(o.writecb=i,o.writechunk=t,o.writeencoding=n,!o.transforming){var a=this._readableState;(o.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},Transform.prototype._read=function(t){var n=this._transformState;null===n.writechunk||n.transforming?n.needTransform=!0:(n.transforming=!0,this._transform(n.writechunk,n.writeencoding,n.afterTransform))},Transform.prototype._destroy=function(t,n){_.prototype._destroy.call(this,t,(function(t){n(t)}))}},function(t,n,i){(function(t){var o=i(419),a=i(241),s=i(421),m=i(422),g=i(242),_=n;_.request=function(n,i){n="string"==typeof n?g.parse(n):s(n);var a=-1===t.location.protocol.search(/^https?:$/)?"http:":"",m=n.protocol||a,_=n.hostname||n.host,S=n.port,M=n.path||"/";_&&-1!==_.indexOf(":")&&(_="["+_+"]"),n.url=(_?m+"//"+_:"")+(S?":"+S:"")+M,n.method=(n.method||"GET").toUpperCase(),n.headers=n.headers||{};var T=new o(n);return i&&T.on("response",i),T},_.get=function get(t,n){var i=_.request(t,n);return i.end(),i},_.ClientRequest=o,_.IncomingMessage=a.IncomingMessage,_.Agent=function(){},_.Agent.defaultMaxSockets=4,_.globalAgent=new _.Agent,_.STATUS_CODES=m,_.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,i(33))},function(t,n,i){(function(t){n.fetch=isFunction(t.fetch)&&isFunction(t.ReadableStream),n.writableStream=isFunction(t.WritableStream),n.abortController=isFunction(t.AbortController),n.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),n.blobConstructor=!0}catch(t){}var i;function getXHR(){if(void 0!==i)return i;if(t.XMLHttpRequest){i=new t.XMLHttpRequest;try{i.open("GET",t.XDomainRequest?"/":"https://example.com")}catch(t){i=null}}else i=null;return i}function checkTypeSupport(t){var n=getXHR();if(!n)return!1;try{return n.responseType=t,n.responseType===t}catch(t){}return!1}var o=void 0!==t.ArrayBuffer,a=o&&isFunction(t.ArrayBuffer.prototype.slice);function isFunction(t){return"function"==typeof t}n.arraybuffer=n.fetch||o&&checkTypeSupport("arraybuffer"),n.msstream=!n.fetch&&a&&checkTypeSupport("ms-stream"),n.mozchunkedarraybuffer=!n.fetch&&o&&checkTypeSupport("moz-chunked-arraybuffer"),n.overrideMimeType=n.fetch||!!getXHR()&&isFunction(getXHR().overrideMimeType),n.vbArray=isFunction(t.VBArray),i=null}).call(this,i(33))},function(t,n,i){(function(t,o,a){var s=i(240),m=i(45),g=i(122),_=n.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},S=n.IncomingMessage=function(n,i,m,_){var S=this;if(g.Readable.call(S),S._mode=m,S.headers={},S.rawHeaders=[],S.trailers={},S.rawTrailers=[],S.on("end",(function(){t.nextTick((function(){S.emit("close")}))})),"fetch"===m){if(S._fetchResponse=i,S.url=i.url,S.statusCode=i.status,S.statusMessage=i.statusText,i.headers.forEach((function(t,n){S.headers[n.toLowerCase()]=t,S.rawHeaders.push(n,t)})),s.writableStream){var M=new WritableStream({write:function(t){return new Promise((function(n,i){S._destroyed?i():S.push(new o(t))?n():S._resumeFetch=n}))},close:function(){a.clearTimeout(_),S._destroyed||S.push(null)},abort:function(t){S._destroyed||S.emit("error",t)}});try{return void i.body.pipeTo(M).catch((function(t){a.clearTimeout(_),S._destroyed||S.emit("error",t)}))}catch(t){}}var T=i.body.getReader();!function read(){T.read().then((function(t){if(!S._destroyed){if(t.done)return a.clearTimeout(_),void S.push(null);S.push(new o(t.value)),read()}})).catch((function(t){a.clearTimeout(_),S._destroyed||S.emit("error",t)}))}()}else if(S._xhr=n,S._pos=0,S.url=n.responseURL,S.statusCode=n.status,S.statusMessage=n.statusText,n.getAllResponseHeaders().split(/\r?\n/).forEach((function(t){var n=t.match(/^([^:]+):\s*(.*)/);if(n){var i=n[1].toLowerCase();"set-cookie"===i?(void 0===S.headers[i]&&(S.headers[i]=[]),S.headers[i].push(n[2])):void 0!==S.headers[i]?S.headers[i]+=", "+n[2]:S.headers[i]=n[2],S.rawHeaders.push(n[1],n[2])}})),S._charset="x-user-defined",!s.overrideMimeType){var O=S.rawHeaders["mime-type"];if(O){var A=O.match(/;\s*charset=([^;])(;|$)/);A&&(S._charset=A[1].toLowerCase())}S._charset||(S._charset="utf-8")}};m(S,g.Readable),S.prototype._read=function(){var t=this._resumeFetch;t&&(this._resumeFetch=null,t())},S.prototype._onXHRProgress=function(){var t=this,n=t._xhr,i=null;switch(t._mode){case"text:vbarray":if(n.readyState!==_.DONE)break;try{i=new a.VBArray(n.responseBody).toArray()}catch(t){}if(null!==i){t.push(new o(i));break}case"text":try{i=n.responseText}catch(n){t._mode="text:vbarray";break}if(i.length>t._pos){var s=i.substr(t._pos);if("x-user-defined"===t._charset){for(var m=new o(s.length),g=0;g<s.length;g++)m[g]=255&s.charCodeAt(g);t.push(m)}else t.push(s,t._charset);t._pos=i.length}break;case"arraybuffer":if(n.readyState!==_.DONE||!n.response)break;i=n.response,t.push(new o(new Uint8Array(i)));break;case"moz-chunked-arraybuffer":if(i=n.response,n.readyState!==_.LOADING||!i)break;t.push(new o(new Uint8Array(i)));break;case"ms-stream":if(i=n.response,n.readyState!==_.LOADING)break;var S=new a.MSStreamReader;S.onprogress=function(){S.result.byteLength>t._pos&&(t.push(new o(new Uint8Array(S.result.slice(t._pos)))),t._pos=S.result.byteLength)},S.onload=function(){t.push(null)},S.readAsArrayBuffer(i)}t._xhr.readyState===_.DONE&&"ms-stream"!==t._mode&&t.push(null)}}).call(this,i(25),i(31).Buffer,i(33))},function(t,n,i){"use strict";var o=i(423),a=i(424);function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}n.parse=urlParse,n.resolve=function urlResolve(t,n){return urlParse(t,!1,!0).resolve(n)},n.resolveObject=function urlResolveObject(t,n){return t?urlParse(t,!1,!0).resolveObject(n):n},n.format=function urlFormat(t){return a.isString(t)&&(t=urlParse(t)),t instanceof Url?t.format():Url.prototype.format.call(t)},n.Url=Url;var s=/^([a-z0-9.+-]+:)/i,m=/:[0-9]*$/,g=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,_=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),S=["'"].concat(_),M=["%","/","?",";","#"].concat(S),T=["/","?","#"],O=/^[+a-z0-9A-Z_-]{0,63}$/,A=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,P={javascript:!0,"javascript:":!0},L={javascript:!0,"javascript:":!0},R={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},N=i(425);function urlParse(t,n,i){if(t&&a.isObject(t)&&t instanceof Url)return t;var o=new Url;return o.parse(t,n,i),o}Url.prototype.parse=function(t,n,i){if(!a.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var m=t.indexOf("?"),_=-1!==m&&m<t.indexOf("#")?"?":"#",I=t.split(_);I[0]=I[0].replace(/\\/g,"/");var j=t=I.join(_);if(j=j.trim(),!i&&1===t.split("#").length){var V=g.exec(j);if(V)return this.path=j,this.href=j,this.pathname=V[1],V[2]?(this.search=V[2],this.query=n?N.parse(this.search.substr(1)):this.search.substr(1)):n&&(this.search="",this.query={}),this}var U=s.exec(j);if(U){var G=(U=U[0]).toLowerCase();this.protocol=G,j=j.substr(U.length)}if(i||U||j.match(/^\/\/[^@\/]+@[^@\/]+/)){var z="//"===j.substr(0,2);!z||U&&L[U]||(j=j.substr(2),this.slashes=!0)}if(!L[U]&&(z||U&&!R[U])){for(var H,q,Z=-1,X=0;X<T.length;X++)-1!==(Q=j.indexOf(T[X]))&&(-1===Z||Q<Z)&&(Z=Q);for(-1!==(q=-1===Z?j.lastIndexOf("@"):j.lastIndexOf("@",Z))&&(H=j.slice(0,q),j=j.slice(q+1),this.auth=decodeURIComponent(H)),Z=-1,X=0;X<M.length;X++){var Q;-1!==(Q=j.indexOf(M[X]))&&(-1===Z||Q<Z)&&(Z=Q)}-1===Z&&(Z=j.length),this.host=j.slice(0,Z),j=j.slice(Z),this.parseHost(),this.hostname=this.hostname||"";var Y="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!Y)for(var J=this.hostname.split(/\./),K=(X=0,J.length);X<K;X++){var $=J[X];if($&&!$.match(O)){for(var ee="",te=0,ne=$.length;te<ne;te++)$.charCodeAt(te)>127?ee+="x":ee+=$[te];if(!ee.match(O)){var re=J.slice(0,X),ie=J.slice(X+1),oe=$.match(A);oe&&(re.push(oe[1]),ie.unshift(oe[2])),ie.length&&(j="/"+ie.join(".")+j),this.hostname=re.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),Y||(this.hostname=o.toASCII(this.hostname));var ae=this.port?":"+this.port:"",se=this.hostname||"";this.host=se+ae,this.href+=this.host,Y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==j[0]&&(j="/"+j))}if(!P[G])for(X=0,K=S.length;X<K;X++){var ce=S[X];if(-1!==j.indexOf(ce)){var ue=encodeURIComponent(ce);ue===ce&&(ue=escape(ce)),j=j.split(ce).join(ue)}}var le=j.indexOf("#");-1!==le&&(this.hash=j.substr(le),j=j.slice(0,le));var he=j.indexOf("?");if(-1!==he?(this.search=j.substr(he),this.query=j.substr(he+1),n&&(this.query=N.parse(this.query)),j=j.slice(0,he)):n&&(this.search="",this.query={}),j&&(this.pathname=j),R[G]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){ae=this.pathname||"";var de=this.search||"";this.path=ae+de}return this.href=this.format(),this},Url.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var n=this.protocol||"",i=this.pathname||"",o=this.hash||"",s=!1,m="";this.host?s=t+this.host:this.hostname&&(s=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&a.isObject(this.query)&&Object.keys(this.query).length&&(m=N.stringify(this.query));var g=this.search||m&&"?"+m||"";return n&&":"!==n.substr(-1)&&(n+=":"),this.slashes||(!n||R[n])&&!1!==s?(s="//"+(s||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):s||(s=""),o&&"#"!==o.charAt(0)&&(o="#"+o),g&&"?"!==g.charAt(0)&&(g="?"+g),n+s+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(g=g.replace("#","%23"))+o},Url.prototype.resolve=function(t){return this.resolveObject(urlParse(t,!1,!0)).format()},Url.prototype.resolveObject=function(t){if(a.isString(t)){var n=new Url;n.parse(t,!1,!0),t=n}for(var i=new Url,o=Object.keys(this),s=0;s<o.length;s++){var m=o[s];i[m]=this[m]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var g=Object.keys(t),_=0;_<g.length;_++){var S=g[_];"protocol"!==S&&(i[S]=t[S])}return R[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!R[t.protocol]){for(var M=Object.keys(t),T=0;T<M.length;T++){var O=M[T];i[O]=t[O]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||L[t.protocol])i.pathname=t.pathname;else{for(var A=(t.pathname||"").split("/");A.length&&!(t.host=A.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==A[0]&&A.unshift(""),A.length<2&&A.unshift(""),i.pathname=A.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var P=i.pathname||"",N=i.search||"";i.path=P+N}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var I=i.pathname&&"/"===i.pathname.charAt(0),j=t.host||t.pathname&&"/"===t.pathname.charAt(0),V=j||I||i.host&&t.pathname,U=V,G=i.pathname&&i.pathname.split("/")||[],z=(A=t.pathname&&t.pathname.split("/")||[],i.protocol&&!R[i.protocol]);if(z&&(i.hostname="",i.port=null,i.host&&(""===G[0]?G[0]=i.host:G.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===A[0]?A[0]=t.host:A.unshift(t.host)),t.host=null),V=V&&(""===A[0]||""===G[0])),j)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,G=A;else if(A.length)G||(G=[]),G.pop(),G=G.concat(A),i.search=t.search,i.query=t.query;else if(!a.isNullOrUndefined(t.search))return z&&(i.hostname=i.host=G.shift(),(Q=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=Q.shift(),i.host=i.hostname=Q.shift())),i.search=t.search,i.query=t.query,a.isNull(i.pathname)&&a.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!G.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var H=G.slice(-1)[0],q=(i.host||t.host||G.length>1)&&("."===H||".."===H)||""===H,Z=0,X=G.length;X>=0;X--)"."===(H=G[X])?G.splice(X,1):".."===H?(G.splice(X,1),Z++):Z&&(G.splice(X,1),Z--);if(!V&&!U)for(;Z--;Z)G.unshift("..");!V||""===G[0]||G[0]&&"/"===G[0].charAt(0)||G.unshift(""),q&&"/"!==G.join("/").substr(-1)&&G.push("");var Q,Y=""===G[0]||G[0]&&"/"===G[0].charAt(0);return z&&(i.hostname=i.host=Y?"":G.length?G.shift():"",(Q=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=Q.shift(),i.host=i.hostname=Q.shift())),(V=V||i.host&&G.length)&&!Y&&G.unshift(""),G.length?i.pathname=G.join("/"):(i.pathname=null,i.path=null),a.isNull(i.pathname)&&a.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},Url.prototype.parseHost=function(){var t=this.host,n=m.exec(t);n&&(":"!==(n=n[0])&&(this.port=n.substr(1)),t=t.substr(0,t.length-n.length)),t&&(this.hostname=t)}},function(t,n){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,n,i){"use strict";const isStream=t=>null!==t&&"object"==typeof t&&"function"==typeof t.pipe;isStream.writable=t=>isStream(t)&&!1!==t.writable&&"function"==typeof t._write&&"object"==typeof t._writableState,isStream.readable=t=>isStream(t)&&!1!==t.readable&&"function"==typeof t._read&&"object"==typeof t._readableState,isStream.duplex=t=>isStream.writable(t)&&isStream.readable(t),isStream.transform=t=>isStream.duplex(t)&&"function"==typeof t._transform&&"object"==typeof t._transformState,t.exports=isStream},function(t,n,i){"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&function _setPrototypeOf(t,n){return(Object.setPrototypeOf||function _setPrototypeOf(t,n){return t.__proto__=n,t})(t,n)}(t,n)}function _createSuper(t){var n=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var i,o=_getPrototypeOf(t);if(n){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):n}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=i(27).LEVEL,a=i(184),s=i(430),m=i(141)("winston:create-logger");function isLevelEnabledFunctionName(t){return"is"+t.charAt(0).toUpperCase()+t.slice(1)+"Enabled"}t.exports=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.levels=t.levels||a.npm.levels;var n=function(t){_inherits(DerivedLogger,t);var n=_createSuper(DerivedLogger);function DerivedLogger(t){return _classCallCheck(this,DerivedLogger),n.call(this,t)}return DerivedLogger}(s),i=new n(t);return Object.keys(t.levels).forEach((function(t){m('Define prototype method for "%s"',t),"log"!==t?(n.prototype[t]=function(){for(var n=this||i,a=arguments.length,s=new Array(a),m=0;m<a;m++)s[m]=arguments[m];if(1===s.length){var g=s[0],_=g&&g.message&&g||{message:g};return _.level=_[o]=t,n._addDefaultMeta(_),n.write(_),this||i}return 0===s.length?(n.log(t,""),n):n.log.apply(n,[t].concat(s))},n.prototype[isLevelEnabledFunctionName(t)]=function(){return(this||i).isLevelEnabled(t)}):console.warn('Level "log" not defined: conflicts with the method "log". Use a different level name.')})),i}},function(t,n,i){"use strict";(function(n){function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=i(91),a=i(185),s=i(141)("winston:exception"),m=i(247),g=i(248),_=i(249);t.exports=function(){function ExceptionHandler(t){if(function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,ExceptionHandler),!t)throw new Error("Logger is required to handle exceptions");this.logger=t,this.handlers=new Map}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(ExceptionHandler,[{key:"handle",value:function handle(){for(var t=this,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];o.forEach((function(n){if(Array.isArray(n))return n.forEach((function(n){return t._addHandler(n)}));t._addHandler(n)})),this.catcher||(this.catcher=this._uncaughtException.bind(this),n.on("uncaughtException",this.catcher))}},{key:"unhandle",value:function unhandle(){var t=this;this.catcher&&(n.removeListener("uncaughtException",this.catcher),this.catcher=!1,Array.from(this.handlers.values()).forEach((function(n){return t.logger.unpipe(n)})))}},{key:"getAllInfo",value:function getAllInfo(t){var n=t.message;return n||"string"!=typeof t||(n=t),{error:t,level:"error",message:["uncaughtException: ".concat(n||"(no error message)"),t.stack||"  No stack trace"].join("\n"),stack:t.stack,exception:!0,date:(new Date).toString(),process:this.getProcessInfo(),os:this.getOsInfo(),trace:this.getTrace(t)}}},{key:"getProcessInfo",value:function getProcessInfo(){return{pid:n.pid,uid:n.getuid?n.getuid():null,gid:n.getgid?n.getgid():null,cwd:n.cwd(),execPath:n.execPath,version:n.version,argv:n.argv,memoryUsage:n.memoryUsage()}}},{key:"getOsInfo",value:function getOsInfo(){return{loadavg:o.loadavg(),uptime:o.uptime()}}},{key:"getTrace",value:function getTrace(t){return(t?g.parse(t):g.get()).map((function(t){return{column:t.getColumnNumber(),file:t.getFileName(),function:t.getFunctionName(),line:t.getLineNumber(),method:t.getMethodName(),native:t.isNative()}}))}},{key:"_addHandler",value:function _addHandler(t){if(!this.handlers.has(t)){t.handleExceptions=!0;var n=new _(t);this.handlers.set(t,n),this.logger.pipe(n)}}},{key:"_uncaughtException",value:function _uncaughtException(t){var i,o=this.getAllInfo(t),g=this._getExceptionHandlers(),_="function"==typeof this.logger.exitOnError?this.logger.exitOnError(t):this.logger.exitOnError;function gracefulExit(){s("doExit",_),s("process._exiting",n._exiting),_&&!n._exiting&&(i&&clearTimeout(i),n.exit(1))}if(!g.length&&_&&(console.warn("winston: exitOnError cannot be true with no exception handlers."),console.warn("winston: not exiting process."),_=!1),!g||0===g.length)return n.nextTick(gracefulExit);a(g,(function(t,n){var i=m(n),o=t.transport||t;function onDone(t){return function(){s(t),i()}}o._ending=!0,o.once("finish",onDone("finished")),o.once("error",onDone("error"))}),(function(){return _&&gracefulExit()})),this.logger.log(o),_&&(i=setTimeout(gracefulExit,3e3))}},{key:"_getExceptionHandlers",value:function _getExceptionHandlers(){return this.logger.transports.filter((function(t){return(t.transport||t).handleExceptions}))}}]),ExceptionHandler}()}).call(this,i(25))},function(t,n,i){"use strict";var o=i(433);t.exports=function one(t){var n,i=0;function onetime(){return i||(i=1,n=t.apply(this,arguments),t=null),n}return onetime.displayName=o(t),onetime}},function(t,n){function CallSite(t){for(var n in t)this[n]=t[n]}n.get=function(t){var i=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var o={},a=Error.prepareStackTrace;Error.prepareStackTrace=function(t,n){return n},Error.captureStackTrace(o,t||n.get);var s=o.stack;return Error.prepareStackTrace=a,Error.stackTraceLimit=i,s},n.parse=function(t){if(!t.stack)return[];var n=this;return t.stack.split("\n").slice(1).map((function(t){if(t.match(/^\s*[-]{4,}$/))return n._createParsedCallSite({fileName:t,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var i=t.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(i){var o=null,a=null,s=null,m=null,g=null,_="native"===i[5];if(i[1]){var S=(s=i[1]).lastIndexOf(".");if("."==s[S-1]&&S--,S>0){o=s.substr(0,S),a=s.substr(S+1);var M=o.indexOf(".Module");M>0&&(s=s.substr(M+1),o=o.substr(0,M))}m=null}a&&(m=o,g=a),"<anonymous>"===a&&(g=null,s=null);var T={fileName:i[2]||null,lineNumber:parseInt(i[3],10)||null,functionName:s,typeName:m,methodName:g,columnNumber:parseInt(i[4],10)||null,native:_};return n._createParsedCallSite(T)}})).filter((function(t){return!!t}))},["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"].forEach((function(t){CallSite.prototype[t]=null,CallSite.prototype["get"+t[0].toUpperCase()+t.substr(1)]=function(){return this[t]}})),["topLevel","eval","native","constructor"].forEach((function(t){CallSite.prototype[t]=!1,CallSite.prototype["is"+t[0].toUpperCase()+t.substr(1)]=function(){return this[t]}})),n._createParsedCallSite=function(t){return new CallSite(t)}},function(t,n,i){"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,n){return t.__proto__=n,t})(t,n)}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):n}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=i(123).Writable;t.exports=function(t){!function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_setPrototypeOf(t,n)}(ExceptionStream,t);var n=function _createSuper(t){var n=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var i,o=_getPrototypeOf(t);if(n){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}(ExceptionStream);function ExceptionStream(t){var i;if(function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,ExceptionStream),i=n.call(this,{objectMode:!0}),!t)throw new Error("ExceptionStream requires a TransportStream instance.");return i.handleExceptions=!0,i.transport=t,i}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(ExceptionStream,[{key:"_write",value:function _write(t,n,i){return t.exception?this.transport.log(t,i):(i(),!0)}}]),ExceptionStream}(o)},function(t,n,i){"use strict";(function(n){function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=i(91),a=i(185),s=i(141)("winston:rejection"),m=i(247),g=i(248),_=i(249);t.exports=function(){function RejectionHandler(t){if(function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,RejectionHandler),!t)throw new Error("Logger is required to handle rejections");this.logger=t,this.handlers=new Map}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(RejectionHandler,[{key:"handle",value:function handle(){for(var t=this,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];o.forEach((function(n){if(Array.isArray(n))return n.forEach((function(n){return t._addHandler(n)}));t._addHandler(n)})),this.catcher||(this.catcher=this._unhandledRejection.bind(this),n.on("unhandledRejection",this.catcher))}},{key:"unhandle",value:function unhandle(){var t=this;this.catcher&&(n.removeListener("unhandledRejection",this.catcher),this.catcher=!1,Array.from(this.handlers.values()).forEach((function(n){return t.logger.unpipe(n)})))}},{key:"getAllInfo",value:function getAllInfo(t){var n=t.message;return n||"string"!=typeof t||(n=t),{error:t,level:"error",message:["unhandledRejection: ".concat(n||"(no error message)"),t.stack||"  No stack trace"].join("\n"),stack:t.stack,exception:!0,date:(new Date).toString(),process:this.getProcessInfo(),os:this.getOsInfo(),trace:this.getTrace(t)}}},{key:"getProcessInfo",value:function getProcessInfo(){return{pid:n.pid,uid:n.getuid?n.getuid():null,gid:n.getgid?n.getgid():null,cwd:n.cwd(),execPath:n.execPath,version:n.version,argv:n.argv,memoryUsage:n.memoryUsage()}}},{key:"getOsInfo",value:function getOsInfo(){return{loadavg:o.loadavg(),uptime:o.uptime()}}},{key:"getTrace",value:function getTrace(t){return(t?g.parse(t):g.get()).map((function(t){return{column:t.getColumnNumber(),file:t.getFileName(),function:t.getFunctionName(),line:t.getLineNumber(),method:t.getMethodName(),native:t.isNative()}}))}},{key:"_addHandler",value:function _addHandler(t){if(!this.handlers.has(t)){t.handleRejections=!0;var n=new _(t);this.handlers.set(t,n),this.logger.pipe(n)}}},{key:"_unhandledRejection",value:function _unhandledRejection(t){var i,o=this.getAllInfo(t),g=this._getRejectionHandlers(),_="function"==typeof this.logger.exitOnError?this.logger.exitOnError(t):this.logger.exitOnError;function gracefulExit(){s("doExit",_),s("process._exiting",n._exiting),_&&!n._exiting&&(i&&clearTimeout(i),n.exit(1))}if(!g.length&&_&&(console.warn("winston: exitOnError cannot be true with no rejection handlers."),console.warn("winston: not exiting process."),_=!1),!g||0===g.length)return n.nextTick(gracefulExit);a(g,(function(t,n){var i=m(n),o=t.transport||t;function onDone(t){return function(){s(t),i()}}o._ending=!0,o.once("finish",onDone("finished")),o.once("error",onDone("error"))}),(function(){return _&&gracefulExit()})),this.logger.log(o),_&&(i=setTimeout(gracefulExit,3e3))}},{key:"_getRejectionHandlers",value:function _getRejectionHandlers(){return this.logger.transports.filter((function(t){return(t.transport||t).handleRejections}))}}]),RejectionHandler}()}).call(this,i(25))},function(t,n,i){"use strict";(function(t){var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__rest||function(t,n){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&n.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(t);a<o.length;a++)n.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(t,o[a])&&(i[o[a]]=t[o[a]])}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.BrowserConsole=void 0;var m=i(215),g=i(79),_=i(252),S={debug:"log",error:"error",info:"info",warn:"warn"},M=function(n){function BrowserConsole(t){var i=n.call(this,t)||this;return t&&t.level&&_.Level.hasOwnProperty(t.level)?i.level=t.level:i.level=m.level,i}return a(BrowserConsole,n),BrowserConsole.prototype.log=function(n,i){var o=this;t((function(){o.emit("logged",n)}));var a=_.Level[n.level];if(this.level&&a<=_.Level[this.level]){var m=n.message,g=n.level,M=s(n,["message","level"]),T=S[g],O=JSON.parse(JSON.stringify(M));0===Object.keys(O).length?console[T](m):console[T](m,O)}i()},BrowserConsole}(g);n.BrowserConsole=M}).call(this,i(78).setImmediate)},function(t,n,i){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.Level=void 0,(o=n.Level||(n.Level={}))[o.error=0]="error",o[o.warn=1]="warn",o[o.info=2]="info",o[o.debug=4]="debug"},function(t,n,i){(function(i){var o,a;void 0===(a="function"==typeof(o=function(){"use strict";function c(t,n,i){var o=new XMLHttpRequest;o.open("GET",t),o.responseType="blob",o.onload=function(){a(o.response,n,i)},o.onerror=function(){console.error("could not download file")},o.send()}function d(t){var n=new XMLHttpRequest;n.open("HEAD",t,!1);try{n.send()}catch(t){}return 200<=n.status&&299>=n.status}function e(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(i){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof i&&i.global===i?i:void 0,o=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(t,i,o){var a=n.URL||n.webkitURL,s=document.createElement("a");i=i||t.name||"download",s.download=i,s.rel="noopener","string"==typeof t?(s.href=t,s.origin===location.origin?e(s):d(s.href)?c(t,i,o):e(s,s.target="_blank")):(s.href=a.createObjectURL(t),setTimeout((function(){a.revokeObjectURL(s.href)}),4e4),setTimeout((function(){e(s)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,n,i){if(n=n||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function b(t,b){return void 0===b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,i),n);else if(d(t))c(t,n,i);else{var o=document.createElement("a");o.href=t,o.target="_blank",setTimeout((function(){e(o)}))}}:function(t,i,a,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof t)return c(t,i,a);var m="application/octet-stream"===t.type,g=/constructor/i.test(n.HTMLElement)||n.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||m&&g||o)&&"undefined"!=typeof FileReader){var S=new FileReader;S.onloadend=function(){var t=S.result;t=_?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=t:location=t,s=null},S.readAsDataURL(t)}else{var M=n.URL||n.webkitURL,T=M.createObjectURL(t);s?s.location=T:location.href=T,s=null,setTimeout((function(){M.revokeObjectURL(T)}),4e4)}});n.saveAs=a.saveAs=a,t.exports=a})?o.apply(n,[]):o)||(t.exports=a)}).call(this,i(33))},function(t,n){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var o=new Uint8Array(16);t.exports=function whatwgRNG(){return i(o),o}}else{var a=new Array(16);t.exports=function mathRNG(){for(var t,n=0;n<16;n++)0==(3&n)&&(t=4294967296*Math.random()),a[n]=t>>>((3&n)<<3)&255;return a}}},function(t,n){for(var i=[],o=0;o<256;++o)i[o]=(o+256).toString(16).substr(1);t.exports=function bytesToUuid(t,n){var o=n||0,a=i;return[a[t[o++]],a[t[o++]],a[t[o++]],a[t[o++]],"-",a[t[o++]],a[t[o++]],"-",a[t[o++]],a[t[o++]],"-",a[t[o++]],a[t[o++]],"-",a[t[o++]],a[t[o++]],a[t[o++]],a[t[o++]],a[t[o++]],a[t[o++]]].join("")}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.IphoneUtils=void 0;var o=new Map([["6s",{height:667,width:375,devicePixelRatio:3,renderer:"Apple A9 GPU"}],["6p",{height:368,width:207,devicePixelRatio:3,renderer:"Apple A8 GPU"}],["6",{height:667,width:375,devicePixelRatio:2,renderer:"Apple A8 GPU"}]]);(n.IphoneUtils||(n.IphoneUtils={})).isIphoneModel=function isIphoneModel(t){var n,i,a=document.createElement("canvas");if(a){var s=a.getContext("webgl")||a.getContext("experimental-webgl");s&&(n=s.getExtension("WEBGL_debug_renderer_info"))&&(i=s.getParameter(n.UNMASKED_RENDERER_WEBGL))}if(!n||!i)return!1;var m=o.get(t);return window.screen.height/window.screen.width==m.height/m.width&&window.devicePixelRatio===m.devicePixelRatio&&i===m.renderer}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GifTexture=n.GifLoader=void 0;var o=i(450);Object.defineProperty(n,"GifLoader",{enumerable:!0,get:function(){return o.GifLoader}});var a=i(258);Object.defineProperty(n,"GifTexture",{enumerable:!0,get:function(){return a.GifTexture}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.GifTexture=void 0;var s=i(0),m=function(t){function GifTexture(n,i,o,a,m,g,_,S){var M=this,T=document.createElement("canvas");return(M=t.call(this,T,n,i,o,a,m,g,_,S)||this).image=T,M.context=M.image.getContext("2d"),M.clock=new s.Clock,M}return a(GifTexture,t),GifTexture.prototype.setReader=function(t){this.reader=t;var n=this.reader.frameInfo(0);this.image.width=n.width,this.image.height=n.height,this.totalNFrames=this.reader.numFrames();var i=n.delay;this.gifTotalTime=i*this.reader.numFrames()/100},GifTexture.prototype.draw=function(t){if(this.reader&&this.lastDrawFrameNumber!==t){this.lastDrawFrameNumber=t;var n=this.reader.frameInfo(t);0===t?this.context.clearRect(0,0,this.image.width,this.image.height):this.previousFrameInfo&&2===this.previousFrameInfo.disposal&&this.context.clearRect(this.previousFrameInfo.x,this.previousFrameInfo.y,this.previousFrameInfo.width,this.previousFrameInfo.height);var i=this.context.getImageData(0,0,this.image.width,this.image.height);this.reader.decodeAndBlitFrameRGBA(t,i.data),this.context.putImageData(i,0,0),this.needsUpdate=!0,this.previousFrameInfo=n}},GifTexture.prototype.render=function(){var t=this;this.clock.start(),function _render(n){if(t.isPlaying){var i=t.clock.getElapsedTime(),o=Math.floor(i/t.gifTotalTime*t.totalNFrames);i>t.gifTotalTime||o>t.totalNFrames-1?(t.clock.start(),t.draw(0)):t.draw(o),requestAnimationFrame(_render)}}()},GifTexture.prototype.play=function(){this.isPlaying||(this.isPlaying=!0,this.render())},GifTexture.prototype.stop=function(){this.isPlaying=!1,this.previousFrameInfo=void 0,this.draw(0)},GifTexture.prototype.dispose=function(){t.prototype.dispose.call(this),this.stop()},GifTexture}(s.CanvasTexture);n.GifTexture=m},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImageOptimizeService=void 0,function(t){t.GetImage=function GetImage(t,i){if(!function isImage(t){return n.some((function(n){return t.includes(n)}))}(t))return t;var o=encodeURIComponent(t);return"https://image-optimiser.byondxr.com/resize?image={{image_url}}&width={{image_width}}".replace("{{image_url}}",o).replace("{{image_width}}",i+"")};var n=["jpeg","jpg","png"]}(n.ImageOptimizeService||(n.ImageOptimizeService={}))},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RenderManager=void 0;var o=i(17),a=i(0),s=i(18),m=i(82),g=function(){function RenderManager(t){this.fps=60,this.delta=0,this.clock=new a.Clock,this.interval=1/this.fps,this.toRenderElements=new Map,this.elementsToUnregister=new Array,this.subscriptions=Array(),this.shouldRender=!0,this.appManager=t}return RenderManager.prototype.init=function(){this._should_render(),this.registerEvents()},RenderManager.prototype.registerEvents=function(){var t=this;window.addEventListener("resize",this.resizeFunc.bind(this)),this.subscriptions.push(this.appManager.eventManager.pipe(s.filter((function(t){return t.eventType.name===(new m.EventTypes.CameraMoveEvent).name||t.eventType===m.EventTypes.CameraMoveEvent||t.eventType.name===(new m.EventTypes.CameraZoomEvent).name||t.eventType===m.EventTypes.CameraZoomEvent}))).subscribe((function(n){t.shouldRender=!0})))},RenderManager.prototype.resizeFunc=function(){this.shouldRender=!0},RenderManager.prototype._should_render=function(){var t=this;!function shouldRender(n){t.shouldRenderElements(),t.executeUnregister(),t.validFPS()&&t.shouldRender&&(t.appManager.eventManager.next({origin:t,eventType:new m.EventTypes.ShouldRenderEvent,message:{time:n}}),t.shouldRender=!1),requestAnimationFrame(shouldRender)}()},RenderManager.prototype.registerRenderElement=function(t){if(this.toRenderElements.has(t)){var n=this.toRenderElements.get(t);this.toRenderElements.set(t,n+1)}else this.toRenderElements.set(t,1)},RenderManager.prototype.unregisterRenderElement=function(t){this.elementsToUnregister.push(t)},RenderManager.prototype.executeUnregister=function(){var t=this;this.elementsToUnregister.forEach((function(n){if(t.toRenderElements.has(n)){var i=t.toRenderElements.get(n);i<=1?t.toRenderElements.delete(n):t.toRenderElements.set(n,i-1)}})),this.elementsToUnregister=[]},RenderManager.prototype.setFPS=function(t){this.fps=t||60,this.interval=1/this.fps},RenderManager.prototype.validFPS=function(){return this.delta+=this.clock.getDelta(),this.delta>this.interval&&(this.delta=this.delta%this.interval,!0)},RenderManager.prototype.shouldRenderElements=function(){for(var t=Array.from(this.toRenderElements.keys()),n=0;n<t.length;n++){var i=t[n];if(i.obj){var s=o.Utils.SetBoxFromObj(new a.Box3,i.obj);this.appManager.currentExperience.cameraControlsRegistry.cameraControls.isObjectVisible(s)&&(this.shouldRender=!0)}}},RenderManager}();n.RenderManager=g},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.DollyCameraControls=n.DollyOptions=void 0;var g=i(0),_=i(136),S=i(18),M=i(17),T=i(10),O=i(145),A=i(71),P=function DollyOptions(){this.max_x=1/0,this.min_x=-1/0,this.max_y=1/0,this.min_y=-1/0,this.max_z=1/0,this.min_z=-1/0,this.x_enabled=!0,this.y_enabled=!0,this.z_enabled=!0,this.position=new g.Vector3(0,0,0),this.screenSpacePanning=!1,this.enable_damping=!0,this.damping_factor=.25};n.DollyOptions=P;var L=function(t){function DollyCameraControls(n,i){void 0===i&&(i=new P);var o=t.call(this,n)||this;return o.mousePosition=new g.Vector2,o.moveSpeedY=.01,o.moveSpeedX=.005,o.zoomSpeed=.001,o.zoomSpeedMobile=.01,o.panOffset=new g.Vector3(0,0,0),o.dolly=new g.Group,o.dollyOptions=i,o}return a(DollyCameraControls,t),DollyCameraControls.prototype.init=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this,n)];case 1:return i.sent(),this.camera.name="DollyCamera",this.dolly.name="dolly",this.dolly.add(this.camera),this.appManager.currentExperience.scene.add(this.dolly),this.setCameraOptions(this.dollyOptions),[2]}}))}))},DollyCameraControls.prototype.setCameraRotation=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,M.Utils.setRotation(this.dolly,t,n)];case 1:return i.sent(),[2]}}))}))},DollyCameraControls.prototype.setCameraAttr=function(t){t.dolly_camera&&this.setCameraOptions(t.dolly_camera)},DollyCameraControls.prototype.setCameraOptions=function(t){this.dollyOptions=t,void 0!==this.dollyOptions.rotation&&this.setCameraRotation(this.dollyOptions.rotation),void 0!==this.dollyOptions.position&&this.camera.position.set(+t.position.x,+t.position.y,+t.position.z),void 0===this.dollyOptions.x_enabled&&(this.dollyOptions.x_enabled=!0),void 0===this.dollyOptions.y_enabled&&(this.dollyOptions.y_enabled=!0),void 0===this.dollyOptions.z_enabled&&(this.dollyOptions.z_enabled=!0),void 0===this.dollyOptions.enable_damping&&(this.dollyOptions.enable_damping=!0),void 0===this.dollyOptions.damping_factor&&(this.dollyOptions.damping_factor=.25),this.dollyOptions.movementSpeedX&&(this.moveSpeedX=this.dollyOptions.movementSpeedX),this.dollyOptions.movementSpeedY&&(this.moveSpeedY=this.dollyOptions.movementSpeedY),this.dollyOptions.movementSpeedZ&&(this.zoomSpeed=this.dollyOptions.movementSpeedZ),this.dollyOptions.movementSpeedMobileZ&&(this.zoomSpeedMobile=this.dollyOptions.movementSpeedMobileZ),this.dollyOptions.gyro&&(this.gyroManager=new O.GyroscopeManager(this.appManager,this.dollyOptions.gyro),this.gyroManager.init())},DollyCameraControls.prototype.addListeners=function(){var n=this;t.prototype.addListeners.call(this);var i=this.appManager.eventManager.pipe(S.filter((function(t){return t.eventType.name===(new T.MouseSwipeEvent).name||t.eventType===T.MouseSwipeEvent}))).subscribe((function(t){n.onSwipe(t.message)}));if(this.subscribtions.push(i),this.dollyOptions.z_enabled){var o=this.appManager.eventManager.pipe(S.filter((function(t){return t.eventType.name===(new T.MouseWheelEvent).name||t.eventType===T.MouseWheelEvent}))).subscribe((function(t){n.onZoom(-t.message.delta*n.zoomSpeed)}));this.subscribtions.push(o)}if(this.dollyOptions.z_enabled){var a=this.appManager.eventManager.pipe(S.filter((function(t){return t.eventType.name===(new T.PinchEvent).name||t.eventType===T.PinchEvent}))).subscribe((function(t){n.onZoom(t.message.delta*n.zoomSpeedMobile)}));this.subscribtions.push(a)}this.subscribtions.push(this.appManager.eventManager.pipe(S.filter((function(t){return t.eventType.name===(new T.GyroMotionEvent).name||t.eventType===T.GyroMotionEvent}))).subscribe((function(t){t.message.gyroManager===n.gyroManager&&("x"===t.message.motionAxis&&n.applyMotion(new g.Vector3(n.camera.position.x+n.dollyOptions.gyro.motion.x_axis.distance*t.message.motionDirection,n.camera.position.y,n.camera.position.z),n.dollyOptions.gyro.motion.x_axis.motion_duration),"z"===t.message.motionAxis&&n.applyMotion(new g.Vector3(n.camera.position.x,n.camera.position.y,n.camera.position.z+n.dollyOptions.gyro.motion.z_axis.distance*t.message.motionDirection),n.dollyOptions.gyro.motion.z_axis.motion_duration))})))},DollyCameraControls.prototype.onSwipe=function(t){this.IsCameraFreezed||(this.dollyOptions.x_enabled&&this.panX(t.x),this.dollyOptions.y_enabled&&this.panY(t.y),this.onCameraMoveFunc(),this.checkPosition())},DollyCameraControls.prototype.onZoom=function(t){this.IsCameraFreezed||(this.panZ(t),this.onCameraZoomFunc(),this.checkPosition())},DollyCameraControls.prototype.panX=function(t){this.panOffset.x+=t*this.moveSpeedX},DollyCameraControls.prototype.panY=function(t){this.panOffset.y-=t*this.moveSpeedY},DollyCameraControls.prototype.panZ=function(t){this.panOffset.z+=t},DollyCameraControls.prototype.applyMotion=function(t,n){var i=this.camera.position;t.setX(Math.max(this.dollyOptions.min_x,Math.min(this.dollyOptions.max_x,t.x))),t.setY(Math.max(this.dollyOptions.min_y,Math.min(this.dollyOptions.max_y,t.y))),t.setZ(Math.max(this.dollyOptions.min_z,Math.min(this.dollyOptions.max_z,t.z)));var o=this;!function animate(t){requestAnimationFrame(animate),A.update(t)}(),new A.Tween(i).to(t,n).onUpdate((function(t){this.onCameraMoveFunc(),o.camera.position.set(t.x,t.y,t.z)})).onComplete((function(){o.camera.position.copy(t)})).start()},DollyCameraControls.prototype.checkPosition=function(){void 0!==+this.dollyOptions.max_x&&this.dolly.position.x>+this.dollyOptions.max_x&&(this.dolly.position.x=+this.dollyOptions.max_x),void 0!==+this.dollyOptions.min_x&&this.dolly.position.x<+this.dollyOptions.min_x&&(this.dolly.position.x=+this.dollyOptions.min_x),void 0!==+this.dollyOptions.max_y&&this.dolly.position.y>+this.dollyOptions.max_y&&(this.dolly.position.y=+this.dollyOptions.max_y),void 0!==+this.dollyOptions.min_y&&this.dolly.position.y<+this.dollyOptions.min_y&&(this.dolly.position.y=+this.dollyOptions.min_y),void 0!==+this.dollyOptions.max_z&&this.dolly.position.z>+this.dollyOptions.max_z&&(this.dolly.position.z=+this.dollyOptions.max_z),void 0!==+this.dollyOptions.min_z&&this.dolly.position.z<+this.dollyOptions.min_z&&(this.dolly.position.z=+this.dollyOptions.min_z)},DollyCameraControls.prototype.updateDamping=function(){this.dolly.position.add(this.panOffset),!this.dollyOptions.enable_damping||Math.abs(this.panOffset.x)<1e-5&&Math.abs(this.panOffset.y)<1e-5&&Math.abs(this.panOffset.z)<1e-5?this.panOffset.set(0,0,0):(this.panOffset.multiplyScalar(1-this.dollyOptions.damping_factor),this.onCameraMoveFunc())},DollyCameraControls.prototype.changeCamPosition=function(t,n,i,o){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(a){switch(a.label){case 0:return[4,M.Utils.setPosition(this.dolly,t,n,i,o)];case 1:return a.sent(),[2]}}))}))},DollyCameraControls.prototype.changeCamRotation=function(t,n,i,o){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){var a;return m(this,(function(s){switch(s.label){case 0:return a=this.GetLookAtQuaternion(this.dolly,t,n),[4,M.Utils.setQuaternion(this.dolly,a,i,o)];case 1:return s.sent(),[2]}}))}))},DollyCameraControls.prototype.handleAccelerator=function(){var t=this.gyroManager.getGyroCoordinates();this.onSwipe(new g.Vector2(-100*t.z,0)),this.onZoom(t.x/10)},DollyCameraControls.prototype._render=function(t){this.enabled&&(this.updateDamping(),this.gyroManager&&this.gyroPresent&&this.handleGyro(),this.cubeCamera&&this.cubeCamera.update(this.appManager.currentExperience.renderer,this.appManager.currentExperience.scene),this.appManager.currentExperience.renderer.render(this.appManager.currentExperience.scene,this.camera),this.appManager.currentExperience.cssRenderer.render(this.appManager.currentExperience.scene,this.camera),this.appManager.renderEventManager.next(t))},DollyCameraControls.prototype.destroy=function(){t.prototype.destroy.call(this),this.dolly&&this.dolly.parent&&this.dolly.parent.remove(this.dolly)},DollyCameraControls}(_.CameraControlsImpl);n.DollyCameraControls=L},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MaterialUtils=void 0;var o=i(0);(n.MaterialUtils||(n.MaterialUtils={})).ChangeMaterialMaps=function ChangeMaterialMaps(t,n){t instanceof o.MeshBasicMaterial&&n instanceof o.MeshBasicMaterial&&(t.map=n.map,t.aoMap=n.aoMap,t.envMap=n.envMap,t.alphaMap=n.alphaMap,t.specularMap=n.specularMap,t.specularMap=n.specularMap),t instanceof o.MeshStandardMaterial&&n instanceof o.MeshStandardMaterial&&(t.map=n.map,t.aoMap=n.aoMap,t.envMap=n.envMap,t.bumpMap=n.bumpMap,t.alphaMap=n.alphaMap,t.lightMap=n.lightMap,t.normalMap=n.normalMap,t.roughnessMap=n.roughnessMap,t.metalnessMap=n.metalnessMap,t.emissiveMap=n.emissiveMap,t.roughnessMap=n.roughnessMap,t.displacementMap=n.displacementMap),t instanceof o.MeshPhongMaterial&&n instanceof o.MeshPhongMaterial&&(t.specularMap=n.specularMap),t.needsUpdate=!0}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.InstagremConnector=void 0;var s,m=i(142);(s=n.InstagremConnector||(n.InstagremConnector={})).getImagesByHashTag=function getImagesByHashTag(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return n="https://www.instagram.com/explore/tags/{{hash_tag}}/?__a=1".replace("{{hash_tag}}",t),[4,m.Networking.get(n,{dataType:"json"})];case 1:return[2,i.sent().graphql.hashtag.edge_hashtag_to_media.edges.map((function(t){return{picture:t.node.display_url,thumbnail:t.node.thumbnail_src}}))]}}))}))},s.getImagesByUser=function getImagesByUser(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return n="https://www.instagram.com/{{username}}/?__a=1".replace("{{username}}",t),[4,m.Networking.get(n,{dataType:"json"})];case 1:return[2,i.sent().graphql.hashtag.edge_hashtag_to_media.edges.map((function(t){return{picture:t.node.display_url,thumbnail:t.node.thumbnail_src}}))]}}))}))}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Subscription=void 0;var o=function(){function Subscription(t,n){this.handler=t,this.isOnce=n,this.isExecuted=!1}return Subscription.prototype.execute=function(t,n,i){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var o=this.handler;t?setTimeout((function(){o.apply(n,i)}),1):o.apply(n,i)}},Subscription}();n.Subscription=o},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.IsVRSupported=n.VRBtn=void 0,i(266);var s=i(189),m=i(125),g=i(56),_=i(146),S=i(124),M=function(){function VRBtn(t){this.enabled=!1,this.button=document.createElement("button"),this.appManager=t,this.button.textContent="ENTER VR",this.button.className="XRBtn"}return VRBtn.prototype.init=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.enabled?[2]:[4,this.getDevice()];case 1:return t.sent(),this.button.onclick=this.enterVR.bind(this),window.addEventListener("vrdisplaypresentchange",this.onVrDisplayPresentChange.bind(this)),document.body.appendChild(this.button),this.enabled=!0,[2]}}))}))},VRBtn.prototype.getDevice=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,navigator.getVRDisplays()];case 1:return(t=n.sent())&&t.length>0&&(this.device=t[0]),[2]}}))}))},VRBtn.prototype.enterVR=function(){var t,n=this.appManager.cameraControlsRegistry.cameraControls;if(n instanceof g.Controls.CameraControls.DollyCameraControls.DollyCameraControls){var i=Object.assign(Object.create(Object.getPrototypeOf(n.dollyOptions)),n.dollyOptions);t=new g.Controls.CameraControls.VRDollyCameraControls(this.appManager,i)}else n instanceof _.OrbitCameraControls?(i=Object.assign(Object.create(Object.getPrototypeOf(n.orbitOptions)),n.orbitOptions),t=new S.VROrbitCameraControls(this.appManager,i)):t=new g.Controls.CameraControls.VRCameraControls(this.appManager);t.init(void 0,this.device),this.appManager.cameraControlsRegistry.Unregister(),this.appManager.cameraControlsRegistry.Register(t),t.enable(),this.device.requestPresent([{source:this.appManager.currentExperience.renderer.domElement}])},VRBtn.prototype.onVrDisplayPresentChange=function(t){this.device.isPresenting?this.onSessionStarted(t):this.onSessionEnded()},VRBtn.prototype.onSessionStarted=function(t){this.device.requestPresent([{source:this.appManager.currentExperience.renderer.domElement}]);var n=new s.VRControls(this.appManager,this.appManager.currentExperience.userInteractionControlsRegistry.userInteractionControls);this.appManager.currentExperience.userInteractionControlsRegistry.Unregister(),this.appManager.currentExperience.userInteractionControlsRegistry.Register(n),this.appManager.currentExperience.userInteractionControlsRegistry.Init(),this.appManager.currentExperience.userInteractionControlsRegistry.Enable()},VRBtn.prototype.onSessionEnded=function(){var t=new m.MouseControls(this.appManager,this.appManager.currentExperience.userInteractionControlsRegistry.userInteractionControls);this.appManager.currentExperience.userInteractionControlsRegistry.Unregister(),this.appManager.currentExperience.userInteractionControlsRegistry.Register(t),this.appManager.currentExperience.userInteractionControlsRegistry.Init(),this.appManager.currentExperience.userInteractionControlsRegistry.Enable(),this.appManager.currentExperience.handleCurrentZoneCamera(!0)},VRBtn}();n.VRBtn=M,n.IsVRSupported=function IsVRSupported(){return"getVRDisplays"in navigator}},function(t,n,i){var o=i(469);"string"==typeof o&&(o=[[t.i,o,""]]);i(97)(o,{hmr:!0,transform:void 0,insertInto:void 0}),o.locals&&(t.exports=o.locals)},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.VRCameraControls=void 0;var g=i(136),_=i(98),S=function(t){function VRCameraControls(n,i){void 0===i&&(i=new _.OrbitControlsOptions);var o=t.call(this,n)||this;return o.frameOfReferenceType="eye-level",o.isVR=!0,o.options=i,o}return a(VRCameraControls,t),VRCameraControls.prototype.init=function(n,i,o){return s(this,void 0,void 0,(function(){return m(this,(function(a){switch(a.label){case 0:return[4,t.prototype.init.call(this,n)];case 1:return a.sent(),i&&(this.vrDisplay=i),this.camera.name="VRCamera",this.appManager.currentExperience.scene.add(this.camera),this.frameOfReferenceType=o||this.frameOfReferenceType,this.appManager.currentExperience.renderer.vr.setFrameOfReferenceType(this.frameOfReferenceType),[2]}}))}))},VRCameraControls.prototype.enable=function(){this.enabled||(t.prototype.enable.call(this),this.appManager.currentExperience.renderer.xr.enabled=!0)},VRCameraControls.prototype.disable=function(){this.enabled&&(t.prototype.disable.call(this),this.appManager.currentExperience.renderer.xr.enabled=!1,this.appManager.container.appendChild(this.appManager.currentExperience.renderer.domElement),this.appManager.container.appendChild(this.appManager.currentExperience.cssRenderer.domElement))},VRCameraControls.prototype.setCameraOptions=function(t){},VRCameraControls.prototype.setCameraAttr=function(t){},VRCameraControls.prototype._render=function(t){this.enabled&&(this.cubeCamera&&this.cubeCamera.update(this.appManager.currentExperience.renderer,this.appManager.currentExperience.scene),this.appManager.currentExperience.renderer.render(this.appManager.currentExperience.scene,this.camera),this.appManager.renderEventManager.next(t))},VRCameraControls}(g.CameraControlsImpl);n.VRCameraControls=S},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.XRManager=void 0;var s=i(193),m=i(265);(n.XRManager||(n.XRManager={})).Enable=function Enable(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return s.IsXRSupported()?new s.XRBtn(t).init():m.IsVRSupported()&&new m.VRBtn(t).init(),[2]}))}))}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ARUtils=void 0,function(t){function _getZoneMarker(t,n){var i;return t.forEach((function(t){t.marker.zone===n&&(i=t)})),i}t.getZoneMarker=function getZoneMarker(t,n){if(t){var i=t.activation_config.markers;if(i&&t.dependencies.assets)return _getZoneMarker(i,n)}},t.getZoneMarkerImage=function getZoneMarkerImage(t,n){if(t){var i=t.activation_config.markers;if(i){var o=t.dependencies.assets;if(o){var a=_getZoneMarker(i,n);if(a&&a.marker&&a.marker.asset)return function _getMarkerImageUrl(t,n){var i;return t.forEach((function(t){t.byond_id===n&&(i=t.endpoint)})),i}(o,a.marker.asset)}}}},t.getMarkerImage=function getMarkerImage(t,n){return o(this,void 0,void 0,(function(){var i,o,s;return a(this,(function(a){return t?(i=.1+(1-n)/2*.8,o=document.createElement("canvas"),s=o.getContext("2d"),o.width=o.height=512,s.fillStyle="white",s.fillRect(0,0,o.width,o.height),s.fillStyle="black",s.fillRect(.1*o.width,.1*o.height,.8*o.width,.8*o.height),s.fillStyle="white",s.fillRect(i*o.width,i*o.height,o.width*(1-2*i),o.height*(1-2*i)),[2,new Promise((function(n,a){var m=document.createElement("img");m.crossOrigin="Anonymous",m.addEventListener("load",(function(){s.drawImage(m,i*o.width,i*o.height,o.width*(1-2*i),o.height*(1-2*i));var t=o.toDataURL();n(t)})),m.src=t}))]):[2]}))}))}}(n.ARUtils||(n.ARUtils={}))},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Debug=void 0;var o,a,s=i(471);o=n.Debug||(n.Debug={}),a=function(){function UIStats(t){this.isDisposed=!1,this.appManager=t,this.stats=new s,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this._render()}return UIStats.prototype._render=function(){var t=this,n=this.appManager.renderEventManager.subscribe((function(i){t.isDisposed?n.unsubscribe():t.stats.update()}))},UIStats.prototype.Dispose=function(){this.stats.dom.remove(),delete this.stats,this.stats=void 0,this.isDisposed=!0},UIStats}(),o.UIStats=a},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.InjectModule=void 0,window.moduleMap=new Map;var s=new(function(){function InjectModuleManager(){}return InjectModuleManager.prototype.injectModuleFile=function(t){return o(this,void 0,void 0,(function(){var n,i;return a(this,(function(o){switch(o.label){case 0:return window.moduleMap.has(t)?[2,window.moduleMap.get(t)]:((n=document.createElement("script")).src=t,n.type="module",[4,new Promise((function(t,i){n.onerror=function(t){i(t)},n.onload=function(){var n=Object.assign({},window.ByondInjectedModule);t(n)},document.head.appendChild(n)}))]);case 1:return i=o.sent(),n.remove(),window.moduleMap.set(t,i),[2,i]}}))}))},InjectModuleManager.prototype.onScriptLoad=function(){},InjectModuleManager}());n.InjectModule=s.injectModuleFile},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.JsZipUtils=void 0,function(t){function createStandardXHR(){try{return new window.XMLHttpRequest}catch(t){}}t.getBinaryContent=function getBinaryContent(t){return new Promise((function(n,i){try{var o=window.ActiveXObject?createStandardXHR()||function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}():createStandardXHR();o.open("GET",t,!0),"responseType"in o&&(o.responseType="arraybuffer"),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.onreadystatechange=function(a){var s,m;if(4===o.readyState)if(200===o.status||0===o.status){s=null,m=null;try{s=function _getBinaryFromXHR(t){return t.response||t.responseText}(o)}catch(t){m=new Error(t)}m?i(m):n(s)}else i(new Error("Ajax error for "+t+" : "+this.status+" "+this.statusText))},o.send()}catch(t){i(t)}}))}}(n.JsZipUtils||(n.JsZipUtils={}))},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ElementControlesManager=void 0;var s=i(274),m=i(18),g=function(){function ElementControlesManager(t){var n=this;this.subs=[],this.appManager=t,this.transformControls=new s.TransformControls(t,this.onItemChangeStart.bind(this),this.onItemChangeEnd.bind(this));var i=this.appManager.historyManager;this.subs.push(i.historyEventManager.pipe(m.filter((function(t){return"undo"===t.historyMode||"redo"===t.historyMode}))).subscribe((function(t){return o(n,void 0,void 0,(function(){return a(this,(function(n){return"transform"===t.type?this.transformControls.update():this.unsetObject(),[2]}))}))})))}return ElementControlesManager.prototype.onItemChangeStart=function(){var t=this;this.transformControls.elements&&0!==this.transformControls.elements.length&&this.transformControls.elements.forEach((function(n){n&&!n.destroyed&&t.appManager.editorEventManager.next({originId:n.getMetadata().byond_id,editStart:!0,type:"transform"})}))},ElementControlesManager.prototype.onItemChangeEnd=function(){var t=this;this.transformControls.elements&&0!==this.transformControls.elements.length&&this.transformControls.elements.forEach((function(n){n&&!n.destroyed&&t.appManager.editorEventManager.next({originId:n.getMetadata().byond_id,type:"transform"})}))},ElementControlesManager.prototype.setObject=function(t){this.unsetObject(),this.transformControls.attach(t)},ElementControlesManager.prototype.unsetObject=function(){this.transformControls.detach()},ElementControlesManager.prototype.destroy=function(){this.subs.forEach((function(t){t.unsubscribe()})),this.transformControls=void 0},ElementControlesManager}();n.ElementControlesManager=g},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransformControls=void 0;var s=i(0),m=i(56),g=i(18),_=function(){function TransformControls(t,n,i){this.elements=new Array,this.objects=new Map,this.initialScales=new Map,this.initialPositions=new Map,this.initialMaxVectors=new Map,this.initialMinVectors=new Map,this.subscriptions=[],this.mousePos=new s.Vector2,this.isMouseDown=!1,this.handlersOffsetFactor=1/8,this.appManager=t,this.raycaster=new s.Raycaster,this.scaleMouseMoveFunc=this.onScale.bind(this),this.posMouseMoveFunc=this.onPosition.bind(this),this.updateMousePosFunc=this.updateMousePos.bind(this),this.onItemChangeStart=n,this.onItemChangeEnd=i,this.addListeners()}return TransformControls.prototype.setHandlersOffsetFactor=function(t){this.handlersOffsetFactor=t},TransformControls.prototype.addListeners=function(){var t=this;this.appManager.eventManager.pipe(g.filter((function(t){return t.eventType.name===(new m.Core.EventManager.EventTypes.MouseUpEvent).name||t.eventType===m.Core.EventManager.EventTypes.MouseUpEvent||t.eventType.name===(new m.Core.EventManager.EventTypes.LongTouchEndedEvent).name||t.eventType===m.Core.EventManager.EventTypes.LongTouchEndedEvent}))).subscribe((function(n){t.isMouseDown=!1})),this.appManager.eventManager.pipe(g.filter((function(t){return t.eventType.name===(new m.Core.EventManager.EventTypes.MouseDownEvent).name||t.eventType===m.Core.EventManager.EventTypes.MouseDownEvent}))).subscribe((function(n){t.isMouseDown=!0})),this.appManager.currentExperience.cssRenderer.domElement.addEventListener("mousemove",this.updateMousePosFunc),this.appManager.currentExperience.cssRenderer.domElement.addEventListener("touchmove",this.updateMousePosFunc)},TransformControls.prototype.attach=function(t){var n=this;this.elements=t,this.drawBoundingBoxes();var i=this.appManager.eventManager.pipe(g.filter((function(t){return t.eventType.name===(new m.Core.EventManager.EventTypes.CameraZoomEvent).name||t.eventType===m.Core.EventManager.EventTypes.CameraZoomEvent}))).subscribe((function(t){return o(n,void 0,void 0,(function(){return a(this,(function(t){return this.deleteHandles(),this.drawBoundingBoxes(),[2]}))}))})),s=this.appManager.eventManager.pipe(g.filter((function(t){return t.eventType.name===(new m.Core.EventManager.EventTypes.MouseUpEvent).name||t.eventType===m.Core.EventManager.EventTypes.MouseUpEvent||t.eventType.name===(new m.Core.EventManager.EventTypes.LongTouchEndedEvent).name||t.eventType===m.Core.EventManager.EventTypes.LongTouchEndedEvent}))).subscribe((function(t){t.message&&n.onMouseUp(new MouseEvent("keyup",{clientX:t.message.x,clientY:t.message.y}))})),_=this.appManager.eventManager.pipe(g.filter((function(t){return t.eventType.name===(new m.Core.EventManager.EventTypes.MouseDownEvent).name||t.eventType===m.Core.EventManager.EventTypes.MouseDownEvent}))).subscribe((function(t){t.message&&n.onMouseDown(new MouseEvent("keydown",{clientX:t.message.x,clientY:t.message.y}))}));this.subscriptions.push(_),this.subscriptions.push(s),this.subscriptions.push(i),this.isMouseDown&&this.onMouseDown(new MouseEvent("keydown",{clientX:this.mousePos.x,clientY:this.mousePos.y}))},TransformControls.prototype.getMaxVector=function(){if(!this.elements||this.elements.length<=0)return new s.Vector3(0,0,0);for(var t=this.elements[0].getMaxVector().x,n=this.elements[0].getMaxVector().y,i=this.elements[0].getMaxVector().z,o=1;o<this.elements.length;o++)this.elements[o].getMaxVector().x>t&&(t=this.elements[o].getMaxVector().x),this.elements[o].getMaxVector().y>n&&(n=this.elements[o].getMaxVector().y),this.elements[o].getMaxVector().z>i&&(i=this.elements[o].getMaxVector().z);return new s.Vector3(t,n,i)},TransformControls.prototype.getMinVector=function(){if(!this.elements||0===this.elements.length)return new s.Vector3(0,0,0);for(var t=this.elements[0].getMinVector().x,n=this.elements[0].getMinVector().y,i=this.elements[0].getMinVector().z,o=1;o<this.elements.length;o++)this.elements[o].getMinVector().x<t&&(t=this.elements[o].getMinVector().x),this.elements[o].getMinVector().y<n&&(n=this.elements[o].getMinVector().y),this.elements[o].getMinVector().z<i&&(i=this.elements[o].getMinVector().z);return new s.Vector3(t,n,i)},TransformControls.prototype.drawBoundingBoxes=function(){var t=this;this.elements.forEach((function(n){var i=new s.Object3D;i.name=n.obj.name+" TransformControls",i.renderOrder=1/0;var o=n.getMaxVector(),a=n.getMinVector(),m=o.x-a.x,g=o.y-a.y,_=10526880,S=8224125;0===t.elements.indexOf(n)&&(_=65280,S=30464);var M=new s.LineBasicMaterial({color:_}),T=new s.Geometry;T.vertices.push(new s.Vector3(a.x,a.y,a.z+.1)),T.vertices.push(new s.Vector3(a.x,o.y,a.z+.1)),T.vertices.push(new s.Vector3(o.x,o.y,a.z+.1)),T.vertices.push(new s.Vector3(o.x,a.y,a.z+.1)),T.vertices.push(new s.Vector3(a.x,a.y,a.z+.1));var O=new s.Line(T,M);i.add(O);var A=t.getScaleFromFov(.2).x;i.add(t.createControlSquare(a.x-A,a.x+A,a.y-A,a.y+A,a.z+.1,S)),i.add(t.createControlSquare(a.x-A,a.x+A,a.y+g/2-A,a.y+g/2+A,a.z+.1,S)),i.add(t.createControlSquare(a.x-A,a.x+A,o.y-A,o.y+A,a.z+.1,S)),i.add(t.createControlSquare(a.x+m/2-A,a.x+m/2+A,o.y-A,o.y+A,a.z+.1,S)),i.add(t.createControlSquare(o.x-A,o.x+A,o.y-A,o.y+A,a.z+.1,S)),i.add(t.createControlSquare(o.x-A,o.x+A,a.y+g/2-A,a.y+g/2+A,a.z+.1,S)),i.add(t.createControlSquare(o.x-A,o.x+A,a.y-A,a.y+A,a.z+.1,S)),i.add(t.createControlSquare(a.x+m/2-A,a.x+m/2+A,a.y-A,a.y+A,a.z+.1,S)),O.renderOrder=1/0,t.objects.set(n,i),t.appManager.currentExperience.scene.add(i)}))},TransformControls.prototype.getScaleFromFov=function(t){var n=this.appManager.cameraControlsRegistry.cameraControls.camera,i=n.getWorldPosition(new s.Vector3).z,o=n.fov*Math.PI/180,a=2*Math.tan(o/2)*i*(t/100)*(window.innerWidth/window.innerHeight)*(window.devicePixelRatio||1);return new s.Vector3(a,a,a)},TransformControls.prototype.createControlSquare=function(t,n,i,o,a,m){var g=new s.Geometry;g.vertices.push(new s.Vector3(t,i,a)),g.vertices.push(new s.Vector3(t,o,a)),g.vertices.push(new s.Vector3(n,i,a)),g.vertices.push(new s.Vector3(n,o,a)),g.faces.push(new s.Face3(0,1,2)),g.faces.push(new s.Face3(1,2,3));var _=new s.MeshBasicMaterial({color:m,side:s.DoubleSide}),S=new s.Mesh(g,_);return S.renderOrder=1/0,S},TransformControls.prototype.onMouseDown=function(t){var n=this;if(!this.initialTouchPosition&&this.elements&&0!==this.elements.length){if(this.onItemChangeStart&&this.onItemChangeStart(),this.initialTouchPosition=this.getElementZPositionFromTouch(t,this.elements[0]),this.elements.forEach((function(t){n.initialScales.set(t,t.obj.scale.clone()),n.initialPositions.set(t,t.obj.position.clone()),n.initialMaxVectors.set(t,t.getMaxVector().clone()),n.initialMinVectors.set(t,t.getMinVector().clone())})),this.scaleXEnabled=!1,this.scaleYEnabled=!1,this.posEnabled=!1,this.isDragging(this.initialTouchPosition,!0),!this.scaleXEnabled&&!this.scaleYEnabled)return this.posEnabled?(this.appManager.cameraControlsRegistry.cameraControls.freezeCamera(!0),this.appManager.currentExperience.cssRenderer.domElement.addEventListener("mousemove",this.posMouseMoveFunc),void this.appManager.currentExperience.cssRenderer.domElement.addEventListener("touchmove",this.posMouseMoveFunc)):void(this.initialTouchPosition=void 0);this.appManager.cameraControlsRegistry.cameraControls.freezeCamera(!0),this.appManager.currentExperience.cssRenderer.domElement.addEventListener("mousemove",this.scaleMouseMoveFunc),this.appManager.currentExperience.cssRenderer.domElement.addEventListener("touchmove",this.scaleMouseMoveFunc)}},TransformControls.prototype.isDragging=function(t,n){if(void 0===n&&(n=!1),!t||!this.elements)return!1;for(var i=0;i<this.elements.length;i++){var o=this.elements[i].getMaxVector().x-this.elements[i].getMinVector().x,a=this.elements[i].getMaxVector().y-this.elements[i].getMinVector().y,s=Math.abs(t.x-this.elements[i].getMaxVector().x),m=Math.abs(t.x-this.elements[i].getMinVector().x),g=Math.abs(t.y-this.elements[i].getMaxVector().y),_=Math.abs(t.y-this.elements[i].getMinVector().y);if(s<o*this.handlersOffsetFactor||m<o*this.handlersOffsetFactor){if(!n)return!0;this.scaleXEnabled=!0}if(g<a*this.handlersOffsetFactor||_<a*this.handlersOffsetFactor){if(!n)return!0;this.scaleYEnabled=!0}if(t.x<this.elements[i].getMaxVector().x&&t.x>this.elements[i].getMinVector().x&&t.y<this.elements[i].getMaxVector().y&&t.y>this.elements[i].getMinVector().y){if(!n)return!0;this.posEnabled=!0}}return!!n&&(this.posEnabled||this.scaleXEnabled||this.scaleYEnabled)},TransformControls.prototype.onMouseUp=function(t){this.initialTouchPosition=void 0,this.appManager.cameraControlsRegistry.cameraControls.freezeCamera(!1),this.removeMoveListeners()},TransformControls.prototype.removeMoveListeners=function(){this.appManager.currentExperience.cssRenderer.domElement.removeEventListener("mousemove",this.scaleMouseMoveFunc),this.appManager.currentExperience.cssRenderer.domElement.removeEventListener("touchmove",this.scaleMouseMoveFunc),this.appManager.currentExperience.cssRenderer.domElement.removeEventListener("mousemove",this.posMouseMoveFunc),this.appManager.currentExperience.cssRenderer.domElement.removeEventListener("touchmove",this.posMouseMoveFunc),this.onItemChangeEnd&&this.onItemChangeEnd()},TransformControls.prototype.removeListeners=function(){this.removeMoveListeners(),this.subscriptions.forEach((function(t){t.unsubscribe()}))},TransformControls.prototype.getElementZPositionFromTouch=function(t,n){var i=new s.Vector2;t instanceof MouseEvent?(i.x=t.clientX,i.y=t.clientY):t instanceof TouchEvent&&(i.x=t.touches[0].pageX,i.y=t.touches[0].pageY);var o=new s.Vector3;o=n.obj.getWorldPosition(o);var a=new s.Plane(new s.Vector3(0,0,1),o.z),m=new s.Vector3(i.x/window.innerWidth*2-1,-i.y/window.innerHeight*2+1,.5);this.raycaster.setFromCamera(m,this.appManager.currentExperience.cameraControlsRegistry.cameraControls.camera);var g=new s.Vector3;return this.raycaster.ray.intersectPlane(a,g)},TransformControls.prototype.updateMousePos=function(t){t instanceof MouseEvent?(this.mousePos.x=t.clientX,this.mousePos.y=t.clientY):t instanceof TouchEvent&&(this.mousePos.x=t.touches[0].pageX,this.mousePos.y=t.touches[0].pageY)},TransformControls.prototype.onPosition=function(t){var n=this;this.initialTouchPosition&&(this.elements.forEach((function(i){var o=n.getElementZPositionFromTouch(t,i),a=o.y-n.initialTouchPosition.y,s=o.x-n.initialTouchPosition.x;i.obj.position.setY(n.initialPositions.get(i).y+a),i.obj.position.setX(n.initialPositions.get(i).x+s)})),this.deleteHandles(),this.drawBoundingBoxes(),this.appManager.eventManager.next(new m.Core.EventManager.EventMessageImpl.EventMessage(this.elements,new m.Core.EventManager.EventTypes.PropertieChangedEvent,"position")))},TransformControls.prototype.onScale=function(t){var n=this;this.initialTouchPosition&&(this.elements.forEach((function(i){var o=n.getElementZPositionFromTouch(t,i),a=o.y-n.initialTouchPosition.y,s=o.x-n.initialTouchPosition.x;Math.abs(n.initialTouchPosition.x-n.initialMinVectors.get(i).x)<Math.abs(n.initialTouchPosition.x-n.initialMaxVectors.get(i).x)&&(s=-s),Math.abs(n.initialTouchPosition.y-n.initialMinVectors.get(i).y)<Math.abs(n.initialTouchPosition.y-n.initialMaxVectors.get(i).y)&&(a=-a);var m=0;if(n.scaleXEnabled&&(m=s),n.scaleYEnabled&&(a>0&&a>m||m<=0&&a<m)&&(m=a),n.scaleXEnabled){var g=n.initialMaxVectors.get(i).x-n.initialMinVectors.get(i).x,_=(g+m)/g,S=m;Math.abs(n.initialTouchPosition.x-n.initialMinVectors.get(i).x)<Math.abs(n.initialTouchPosition.x-n.initialMaxVectors.get(i).x)&&(S=-m),i.obj.scale.setX(n.initialScales.get(i).x*_),i.obj.position.setX(n.initialPositions.get(i).x+S/2)}if(n.scaleYEnabled){var M=n.initialMaxVectors.get(i).y-n.initialMinVectors.get(i).y,T=(M+m)/M,O=m;Math.abs(n.initialTouchPosition.y-n.initialMinVectors.get(i).y)<Math.abs(n.initialTouchPosition.y-n.initialMaxVectors.get(i).y)&&(O=-m),i.obj.scale.set(i.obj.scale.x,n.initialScales.get(i).y*T,i.obj.scale.z),i.obj.position.setY(n.initialPositions.get(i).y+O/2)}})),this.deleteHandles(),this.drawBoundingBoxes(),this.appManager.eventManager.next(new m.Core.EventManager.EventMessageImpl.EventMessage(this.elements,new m.Core.EventManager.EventTypes.PropertieChangedEvent,"scale")))},TransformControls.prototype.deleteHandles=function(){var t=this;this.elements&&(this.elements.forEach((function(n){var i=t.objects.get(n);i.children&&i.children.slice().forEach((function(t){i.remove(t)})),t.appManager.currentExperience.scene.remove(i)})),this.objects=new Map)},TransformControls.prototype.detach=function(){this.appManager.cameraControlsRegistry.cameraControls.freezeCamera(!1),this.removeListeners(),this.deleteHandles(),this.elements=void 0},TransformControls.prototype.update=function(){if(this.elements&&0!==this.elements.length){var t=this.elements;this.detach(),this.attach(t)}},TransformControls.prototype.setMode=function(t){},TransformControls}();n.TransformControls=_},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MouseEventManager=void 0;var o,a=i(0),s=i(10),m=function(){function MouseEventManager(t){this.swiptThreshold=100,this.longPressThreshold=500,this.dbTapMaxInterval=500,this.appManager=t,this.domElement=t.currentExperience.cssRenderer.domElement,o=this,this.domElement.addEventListener("mousedown",o.onMouseDown),this.domElement.addEventListener("touchstart",o.onTouchStart),this.domElement.addEventListener("mouseup",o.onMouseUp),this.domElement.addEventListener("touchend",o.onTouchEnd),this.domElement.addEventListener("mousemove",o.onMouseMove),this.domElement.addEventListener("touchmove",o.onTouchMove),this.domElement.addEventListener("wheel",o.onMouseWheel),this.domElement.addEventListener("dblclick",o.onDbClick)}return MouseEventManager.prototype.destroy=function(){this.domElement.removeEventListener("mousedown",o.onMouseDown),this.domElement.removeEventListener("touchstart",o.onTouchStart),this.domElement.removeEventListener("mouseup",o.onMouseUp),this.domElement.removeEventListener("touchend",o.onTouchEnd),this.domElement.removeEventListener("mousemove",o.onMouseMove),this.domElement.removeEventListener("touchmove",o.onTouchMove),this.domElement.removeEventListener("wheel",o.onMouseWheel)},MouseEventManager.prototype.onMouseDown=function(t){t.preventDefault(),o.touchTime=(new Date).getTime(),o.mousePosition=new a.Vector2(t.pageX,t.pageY),o.appManager.eventManager.next({origin:null,eventType:new s.MouseDownEvent,message:new a.Vector2(t.pageX,t.pageY)}),o.mouseIsDown=!0},MouseEventManager.prototype.onTouchStart=function(t){if(t.preventDefault(),o.touchTime=(new Date).getTime(),o.mousePosition=new a.Vector2(t.touches[0].pageX,t.touches[0].pageY),o.appManager.eventManager.next({origin:null,eventType:new s.MouseDownEvent,message:new a.Vector2(t.touches[0].pageX,t.touches[0].pageY)}),o.mouseIsDown=!0,2===t.touches.length){o.pintchStarted=!0,o.rotateStarted=!0,o.initialRotate1=new a.Vector2(t.touches[0].pageX,t.touches[0].pageY),o.initialRotate2=new a.Vector2(t.touches[1].pageX,t.touches[1].pageY);var n=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;o.pinchDistance=Math.sqrt(Math.pow(i,2)+Math.pow(n,2)),o.rotateDistance=0}},MouseEventManager.prototype.onMouseUp=function(t){t.preventDefault();var n=o.IsLongPress();o.appManager.eventManager.next({origin:null,eventType:n?new s.LongTouchEndedEvent:new s.MouseUpEvent,message:o.mousePosition}),o.mouseIsDown=!1,o.mousePosition=void 0},MouseEventManager.prototype.onTouchEnd=function(t){switch(t.preventDefault(),t.touches.length){case 0:o.IsDbTap()?o.onDbClick(t):o.IsLongPress()?o.appManager.eventManager.next({origin:null,eventType:new s.LongTouchEndedEvent,message:o.mousePosition}):o.appManager.eventManager.next({origin:null,eventType:new s.MouseUpEvent,message:o.mousePosition}),o.pintchStarted||(o.lastTouchUpTime=(new Date).getTime()),o.touchTime=(new Date).getTime(),o.pintchStarted=!1}o.mouseIsDown=!1,o.mousePosition=void 0,o.rotateStarted=!1,o.pinchDistance=void 0,o.initialRotate1=void 0,o.initialRotate2=void 0,o.rotatePreviousAngle=void 0,o.rotateDistance=void 0},MouseEventManager.prototype.IsLongPress=function(){return(new Date).getTime()-o.touchTime>o.longPressThreshold},MouseEventManager.prototype.IsSwipe=function(){return(new Date).getTime()-o.touchTime>o.swiptThreshold},MouseEventManager.prototype.IsDbTap=function(){return!o.pintchStarted&&(new Date).getTime()-o.lastTouchUpTime<o.dbTapMaxInterval},MouseEventManager.prototype.onMouseMove=function(t){if(t.preventDefault(),o.mouseIsDown&&o.mousePosition&&o.IsSwipe()){var n=o.mousePosition.x-t.pageX,i=o.mousePosition.y-t.pageY;o.mousePosition=new a.Vector2(t.pageX,t.pageY),o.appManager.eventManager.next({origin:null,eventType:new s.MouseSwipeEvent,message:new a.Vector2(n,i)})}},MouseEventManager.prototype.onTouchMove=function(t){if(t.preventDefault(),o.mouseIsDown&&o.mousePosition&&o.IsSwipe()){var n=o.mousePosition.x-t.touches[0].pageX,i=o.mousePosition.y-t.touches[0].pageY;if(o.mousePosition=new a.Vector2(t.touches[0].pageX,t.touches[0].pageY),o.appManager.eventManager.next({origin:null,eventType:new s.MouseSwipeEvent,message:new a.Vector2(n,i)}),2===t.touches.length){var m,g,_,S,M=t.touches[0].pageX-t.touches[1].pageX,T=t.touches[0].pageY-t.touches[1].pageY,O=Math.sqrt(Math.pow(T,2)+Math.pow(M,2));if(o.appManager.eventManager.next({origin:null,eventType:new s.PinchEvent,message:{delta:o.pinchDistance-O}}),o.pinchDistance=O,!o.initialRotate1||!o.initialRotate2)return;m=o.getMidpoint(o.initialRotate1.x,o.initialRotate2.x,o.initialRotate1.y,o.initialRotate2.y);var A=o.getMidpoint(t.touches[0].pageX,t.touches[1].pageX,t.touches[0].pageY,t.touches[1].pageY);g=m.x-A.x,_=m.y-A.y,S=o.getRightMostInput(t.touches[0].pageX,t.touches[0].pageY,t.touches[1].pageX,t.touches[1].pageY);var P=o.getAngle(m.x,m.y,S.x+g,S.y+_);if(o.rotatePreviousAngle){var L=o.getAngularDistance(o.rotatePreviousAngle,P);o.rotateDistance=o.rotateDistance+L,o.appManager.eventManager.next({origin:null,eventType:new s.RotateEvent,message:{delta:P-o.rotatePreviousAngle}}),o.rotatePreviousAngle=P}else o.rotatePreviousAngle=P,o.rotateDistance=0}}},MouseEventManager.prototype.onDbClick=function(t){var n;n=t instanceof TouchEvent?o.mousePosition:new a.Vector2(t.pageX,t.pageY),o.appManager.eventManager.next({origin:null,eventType:new s.MouseDoubleClickEvent,message:n})},MouseEventManager.prototype.onMouseWheel=function(t){t.preventDefault(),o.appManager.eventManager.next({origin:null,eventType:new s.MouseWheelEvent,message:{delta:t.wheelDelta}})},MouseEventManager.prototype.getMidpoint=function(t,n,i,o){return{x:(t+n)/2,y:(i+o)/2}},MouseEventManager.prototype.getRightMostInput=function(t,n,i,o){return t>i?{x:t,y:n}:{x:i,y:o}},MouseEventManager.prototype.getAngle=function(t,n,i,o){var a=Math.atan2(o-n,i-t)*(180/Math.PI);return 360-(a<0?360+a:a)},MouseEventManager.prototype.getAngularDistance=function(t,n){var i=(n-t)%360,o=i<0?1:-1;return(i=Math.abs(i))>180?o*(360-i):o*i},MouseEventManager}();n.MouseEventManager=m},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VRControllerEventManager=void 0;var o=i(10),a=i(0),s=function(){function VRControllerEventManager(t){this.stats=new Map,this.appManger=t,this.gamepads=navigator.getGamepads(),this.cloneGamepads(),this.loop()}return VRControllerEventManager.prototype.updateGamepads=function(){this.gamepads=navigator.getGamepads()},VRControllerEventManager.prototype.checkGamepads=function(){for(var t=0;t<this.gamepads.length;t++)this.checkGamepad(t);this.cloneGamepads()},VRControllerEventManager.prototype.cloneGamepads=function(){var t=this;Object.keys(this.gamepads).forEach((function(n){if(t.gamepads[n]){var i=[];t.gamepads[n].buttons.forEach((function(t){i.push({pressed:t.pressed,touched:t.touched,value:t.value})})),t.stats.set(+n,{axes:t.gamepads[n].axes,buttons:i})}else t.stats.delete(+n)}))},VRControllerEventManager.prototype.checkGamepad=function(t){var n=this.gamepads[t];if(n)for(var i=n.buttons,o=0;o<i.length;o++)this.checkButton(t,o)},VRControllerEventManager.prototype.checkButton=function(t,n){if(this.stats.has(t)&&this.stats.get(t).buttons){var i=this.stats.get(t).buttons[n],o=this.gamepads[t].buttons[n];i.touched===o.touched||i.pressed===o.pressed?o.touched&&!o.pressed?this.onButtonTouchSwipe(t,n):o.pressed&&this.onButtonPressSwipe(t,n):o.pressed?this.onButtonDown(t,n):this.onButtonUp(t,n)}},VRControllerEventManager.prototype.onButtonUp=function(t,n){var i=this.gamepads[t].id;this.appManger.eventManager.next({origin:null,eventType:new o.GamepadUpEvent,message:{gamepadId:i,buttonIndex:n,gamepadIndex:t}})},VRControllerEventManager.prototype.onButtonTouchSwipe=function(t,n){var i=this.gamepads[t].id,s=this.stats.get(t).axes,m=this.gamepads[t].axes;if(s!==m&&s&&(0!==s[0]||0!==s[1])){var g=new a.Vector2(m[0]-s[0],m[1]-s[1]);this.appManger.eventManager.next({origin:null,eventType:new o.GamepadSwipeEvent,message:{delta:g,gamepadId:i,buttonIndex:n,gamepadIndex:t}})}},VRControllerEventManager.prototype.onButtonPressSwipe=function(t,n){var i=this.gamepads[t].id,s=this.stats.get(t).axes,m=this.gamepads[t].axes;if(s!==m){var g=new a.Vector2(m[0]-s[0],m[1]-s[1]);this.appManger.eventManager.next({origin:null,eventType:new o.GamepadPressSwipeEvent,message:{delta:g,gamepadId:i,buttonIndex:n,gamepadIndex:t}})}},VRControllerEventManager.prototype.onButtonDown=function(t,n){var i=this.gamepads[t].id;this.appManger.eventManager.next({origin:null,eventType:new o.GamepadDownEvent,message:{gamepadId:i,buttonIndex:n,gamepadIndex:t}})},VRControllerEventManager.prototype.loop=function(){var t=this;this.appManger.renderEventManager.subscribe((function(){t.checkGamepads()}))},VRControllerEventManager}();n.VRControllerEventManager=s},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RenderManager=n.TransitionManager=n.ScaleControls=n.RotationControls=n.Metadata=n.LODManager=n.HistoryManager=n.ElementsEventsCustumAttribute=n.CustomAttributes=n.ByondInteractiveElement=n.ByondBaseElementFactory=n.ByondBaseElement=n.ARPattern=n.ARMarkerManager=n.AnimationManagerInstance=n.Shaders=n.Registrys=n.Materials=n.EventManager=void 0;var o=i(82);n.EventManager=o;var a=i(481);n.Materials=a;var s=i(482);n.Registrys=s;var m=i(492);n.Shaders=m;var g=i(285);Object.defineProperty(n,"AnimationManagerInstance",{enumerable:!0,get:function(){return g.AnimationManagerInstance}});var _=i(286);Object.defineProperty(n,"ARMarkerManager",{enumerable:!0,get:function(){return _.ARMarkerManager}});var S=i(287);Object.defineProperty(n,"ARPattern",{enumerable:!0,get:function(){return S.ARPattern}});var M=i(100);Object.defineProperty(n,"ByondBaseElement",{enumerable:!0,get:function(){return M.ByondBaseElement}});var T=i(51);n.ByondBaseElementFactory=T;var O=i(46);n.ByondInteractiveElement=O;var A=i(22);Object.defineProperty(n,"CustomAttributes",{enumerable:!0,get:function(){return A.CustomAttributes}});var P=i(493);n.ElementsEventsCustumAttribute=P;var L=i(288);Object.defineProperty(n,"HistoryManager",{enumerable:!0,get:function(){return L.HistoryManager}});var R=i(289);n.LODManager=R;var N=i(32);Object.defineProperty(n,"Metadata",{enumerable:!0,get:function(){return N.Metadata}});var I=i(494);Object.defineProperty(n,"RotationControls",{enumerable:!0,get:function(){return I.RotationControls}});var j=i(532);Object.defineProperty(n,"ScaleControls",{enumerable:!0,get:function(){return j.ScaleControls}});var V=i(303);Object.defineProperty(n,"TransitionManager",{enumerable:!0,get:function(){return V.TransitionManager}});var U=i(260);Object.defineProperty(n,"RenderManager",{enumerable:!0,get:function(){return U.RenderManager}})},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CameraControlsRegistryImpl=void 0;var s=i(50),m=i(186),g=i(10),_=i(279),S=function(){function CameraControlsRegistryImpl(){this.vrButtonText="Enter VR",this.cameraFactories=new Array}return CameraControlsRegistryImpl.prototype.GetCamera=function(t,n,i){this.appManager=i;var o=new Array;return this.cameraFactories.forEach((function(i){i.predicate(t,n)&&o.push(i.create(t))})),0===o.length&&o.push(new m.TouchCameraControls(i)),o},CameraControlsRegistryImpl.prototype.RegisterElement=function(t){this.cameraFactories.push(t)},CameraControlsRegistryImpl.prototype.UnregisterElement=function(t){var n=this.cameraFactories.indexOf(t);n>-1&&this.cameraFactories.splice(n)},CameraControlsRegistryImpl.prototype.Unregister=function(){this.cameraControls&&this.cameraControls.destroy(),this.cameraControls=void 0},CameraControlsRegistryImpl.prototype.Register=function(t){this.cameraControls?s.Log.Error("[CameraControlsRegistry Register] camera controls already registered, please unregister first"):(this.cameraControls=t,this.appManager.eventManager.next({origin:this,eventType:new g.CameraChangedEvent}))},CameraControlsRegistryImpl.prototype.Init=function(t,n,i){return o(this,void 0,void 0,(function(){return a(this,(function(o){switch(o.label){case 0:return this.cameraControls||(this.cameraControls=new m.TouchCameraControls(t)),[4,this.cameraControls.init(n,i)];case 1:return o.sent(),t.currentExperience.transitionsRegistry.transitionInstance||t.currentExperience.transitionsRegistry.Register(new _.TransitionEfffects.RadialZoomBlurTransition(t)),[2]}}))}))},CameraControlsRegistryImpl.prototype.Enable=function(){this.cameraControls.enable(),this.cameraControls.onResize()},CameraControlsRegistryImpl.prototype.Disable=function(){this.cameraControls.disable()},CameraControlsRegistryImpl.prototype.updateCameraProjectionMatrix=function(){this.cameraControls.camera.updateProjectionMatrix()},CameraControlsRegistryImpl}();n.CameraControlsRegistryImpl=S},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ColorAdjustmentEffect=n.EffectImpl=n.TransitionEfffects=n.ZoomBlurEffect=n.TAAEffect=n.OutlineEffect=void 0;var o=i(483);n.OutlineEffect=o;var a=i(486);Object.defineProperty(n,"TAAEffect",{enumerable:!0,get:function(){return a.TAAEffect}});var s=i(280);Object.defineProperty(n,"ZoomBlurEffect",{enumerable:!0,get:function(){return s.ZoomBlurEffect}});var m=i(487);n.TransitionEfffects=m;var g=i(126);n.EffectImpl=g;var _=i(490);n.ColorAdjustmentEffect=_},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoomBlurEffect=void 0;var g=i(0),_=i(71),S=i(150),M=i(67),T=i(281),O=function(t){function ZoomBlurEffect(n){return t.call(this,n)||this}return a(ZoomBlurEffect,t),ZoomBlurEffect.prototype.init=function(){t.prototype.init.call(this);var n=this.appManager.cameraControlsRegistry;this.pass1=new S.RenderPass(this.appManager.currentExperience.scene,n.cameraControls.camera),this.shader=new g.ShaderMaterial({uniforms:{tDiffuse:{value:null},strength:{value:0},center:{value:new g.Vector2(.5*window.innerWidth,.5*window.innerHeight)},resolution:{value:new g.Vector2(window.innerWidth,window.innerHeight)}},vertexShader:T.ZoomShader.vertexShader,fragmentShader:T.ZoomShader.fragmentShader}),this.zBlurPass=new M.ShaderPass(this.shader),this.composer.addPass(this.pass1),this.composer.addPass(this.zBlurPass)},ZoomBlurEffect.prototype.start=function(){t.prototype.start.call(this),this.zBlurPass.renderToScreen=!0,this.zBlurPass.enabled=!0},ZoomBlurEffect.prototype.update=function(t){this.zBlurPass.uniforms.strength.value=t},ZoomBlurEffect.prototype.animate=function(t,n){return s(this,void 0,void 0,(function(){var i=this;return m(this,(function(o){return[2,new Promise((function(o,a){var s=i,m={value:i.zBlurPass.uniforms.strength.value};new _.Tween(m).to({value:t},1e3*n).onUpdate((function(t){s.update(t.value)})).onComplete((function(){o()})).start()}))]}))}))},ZoomBlurEffect.prototype.stop=function(){t.prototype.stop.call(this),this.zBlurPass.renderToScreen=!1,this.zBlurPass.enabled=!1},ZoomBlurEffect.prototype.destroy=function(){t.prototype.destroy.call(this),delete this.zBlurPass,this.zBlurPass=void 0,this.shader&&(this.shader.uniforms.tDiffuse.value&&(this.shader.uniforms.tDiffuse.value.dispose(),this.shader.uniforms.tDiffuse.value=void 0),this.shader.dispose()),delete this.shader,this.shader=void 0,delete this.pass1,this.pass1=void 0},ZoomBlurEffect}(i(126).EffectImpl);n.ZoomBlurEffect=O},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ZoomShader=void 0;var o=i(0);n.ZoomShader={uniforms:{tDiffuse:{value:null},strength:{type:"f",value:.5},center:{type:"v2",value:new o.Vector2(.5*window.innerWidth,.5*window.innerHeight)},resolution:{type:"v2",value:new o.Vector2(window.innerWidth,window.innerHeight)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 center;","uniform float strength;","uniform vec2 resolution;","varying vec2 vUv;","float random(vec3 scale,float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}","void main(){","vec4 color=vec4(0.0);","float total=0.0;","vec2 toCenter=center-vUv*resolution;","float offset=random(vec3(12.9898,78.233,151.7182),0.0);","for(float t=0.0;t<=40.0;t++){","float percent=(t+offset)/40.0;","float weight=4.0*(percent-percent*percent);","vec4 sample_vec=texture2D(tDiffuse,vUv+toCenter*percent*strength/resolution);","sample_vec.rgb*=sample_vec.a;","color+=sample_vec*weight;","total+=weight;","}","gl_FragColor=color/total;","gl_FragColor.rgb/=gl_FragColor.a+0.00001;","}"].join("\n")}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ElementsRegistryImpl=void 0;var s=function(){function ElementsRegistryImpl(){this.elementFactories=new Array}return ElementsRegistryImpl.prototype.GetElement=function(t,n){return o(this,void 0,void 0,(function(){var i;return a(this,(function(o){return i=new Array,this.elementFactories.forEach((function(o){o.predicate(t)&&i.push(o.create(t,n))})),[2,Promise.all(i)]}))}))},ElementsRegistryImpl.prototype.RegisterElement=function(t){this.elementFactories.push(t)},ElementsRegistryImpl.prototype.UnregisterElement=function(t){var n=this.elementFactories.indexOf(t);n>-1&&this.elementFactories.splice(n)},ElementsRegistryImpl}();n.ElementsRegistryImpl=s},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransitionsRegistry=void 0;var s=i(34),m=i(10),g=i(50),_=function(){function TransitionsRegistry(t){this.appManager=t}return TransitionsRegistry.prototype.Unregister=function(){this.transitionInstance=void 0},TransitionsRegistry.prototype.Register=function(t){this.transitionInstance?g.Log.Error("[TransitionsRegistry Register] transition already registered, please unregister first"):this.transitionInstance=t},TransitionsRegistry.prototype.Transition=function(t,n,i,_){return o(this,void 0,void 0,(function(){return a(this,(function(o){switch(o.label){case 0:return this.transitionInstance?(this.appManager.eventManager.next(new s.EventMessage(this,new m.TransitionStartedEvent)),[4,this.transitionInstance.transition(t,n,i,_)]):(g.Log.Error("[TransitionsRegistry Transition] transition is not registered, please register a transition first"),[2]);case 1:return o.sent(),this.appManager.eventManager.next(new s.EventMessage(this,new m.TransitionEndedEvent)),[2]}}))}))},TransitionsRegistry}();n.TransitionsRegistry=_},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserInteractionControlsRegistry=void 0;var o=i(125),a=i(50),s=function(){function UserInteractionControlsRegistry(t){this.appManager=t}return UserInteractionControlsRegistry.prototype.Unregister=function(){this.userInteractionControls&&this.userInteractionControls.destroy(),this.userInteractionControls=void 0},UserInteractionControlsRegistry.prototype.Register=function(t){this.userInteractionControls?a.Log.Error("[UserInteractionControlsRegistry Register] interaction controls already registered, please unregister first"):this.userInteractionControls=t},UserInteractionControlsRegistry.prototype.Init=function(){this.userInteractionControls||(this.userInteractionControls=new o.MouseControls(this.appManager)),this.userInteractionControls.init()},UserInteractionControlsRegistry.prototype.Enable=function(){this.userInteractionControls.enable()},UserInteractionControlsRegistry.prototype.Disable=function(){this.userInteractionControls.disable()},UserInteractionControlsRegistry.prototype.AddObject=function(t,n){this.userInteractionControls.AddObject(t,n)},UserInteractionControlsRegistry.prototype.RemoveObject=function(t){this.userInteractionControls.RemoveObject(t)},UserInteractionControlsRegistry.prototype.Reset=function(){this.userInteractionControls.reset()},UserInteractionControlsRegistry}();n.UserInteractionControlsRegistry=s},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AnimationManagerInstance=void 0;var o=i(0),a=i(50),s=function(){function AnimationManagerInstance(t){this.mixersMap=new Map,this.enabled=!1,this.appManager=t}return AnimationManagerInstance.prototype.addMixer=function(t){this.mixersMap.has(t)&&a.Log.Error("mixer already exists for this mesh");var n=new o.AnimationMixer(t);return this.mixersMap.set(t,n),n},AnimationManagerInstance.prototype.removeMixer=function(t){this.mixersMap.delete(t)},AnimationManagerInstance.prototype.setEnable=function(t){this.enabled!==t&&(this.enabled=t,this.enabled&&this.render())},AnimationManagerInstance.prototype.render=function(){var t=this,n=0,i=this.appManager.renderEventManager.subscribe((function(o){if(t.enabled){var a=Array.from(t.mixersMap.keys()),s=(o-n)/1e3;a.forEach((function(n){var i=t.mixersMap.get(n);isNaN(i.time)&&i.setTime(0),i.update(s)})),n=o}else i.unsubscribe()}))},AnimationManagerInstance}();n.AnimationManagerInstance=s},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ARMarkerManager=void 0;var s,m=i(287),g=i(34),_=i(10),S=function(){function ARMarkerManager(t,n,i){this.onRenderFcts=[],this.markerIsOn=!1,this.enabled=!1,this.stopTracking=!1,this.appManager=t,this.domElement=n,this.camera=i,s=this}return ARMarkerManager.prototype.setMarker=function(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return[4,m.ARPattern.encodeImageURL(t)];case 1:return n=i.sent(),this.markerControls=new THREEx.ArMarkerControls(this.arToolkitContext,this.camera,{type:"pattern",patternUrl:m.ARPattern.ObjectToURL(n),changeMatrixMode:"cameraTransformMatrix"}),[2]}}))}))},ARMarkerManager.prototype.StopTracking=function(){this.stopTracking=!0},ARMarkerManager.prototype.StartTracking=function(){this.stopTracking=!1},ARMarkerManager.prototype.onMarker=function(){this.markerIsOn||(this.markerIsOn=!0,this.appManager.eventManager.next(new g.EventMessage(this,new _.ARMarkerDetected)))},ARMarkerManager.prototype.offMarker=function(){this.markerIsOn&&(this.markerIsOn=!1,this.appManager.eventManager.next(new g.EventMessage(this,new _.ARMarkerUndetected)))},ARMarkerManager.prototype.setEnabled=function(t){this.enabled!==t&&(this.enabled=t,this.enabled?this.enable():this.disable())},ARMarkerManager.prototype.enable=function(){var t=this;this.arToolkitSource=new THREEx.ArToolkitSource({sourceType:"webcam"}),this.arToolkitSource.init((function(){return t.onResize()})),this.arToolkitContext=new THREEx.ArToolkitContext({cameraParametersUrl:"https://webxr-apps.byondxr.com/assets/ar_assets/camera_para.dat",detectionMode:"mono",patternRatio:.5}),this.arToolkitContext.init((function(){t.camera.projectionMatrix.copy(t.arToolkitContext.getProjectionMatrix())})),this.onRenderFcts.push((function(){!1!==t.arToolkitSource.ready&&(t.camera.visible?t.onMarker():t.offMarker())})),window.addEventListener("resize",this.onResize,!1),window.addEventListener("orientationchange",this.onResize,!1),this.render(),this.appManager.eventManager.next(new g.EventMessage(this,new _.ARModeStarted))},ARMarkerManager.prototype.disable=function(){this.onRenderFcts=[],window.removeEventListener("resize",this.onResize,!1),window.removeEventListener("orientationchange",this.onResize,!1),this.arToolkitSource.domElement.srcObject.getTracks().forEach((function(t){t.stop()})),this.appManager.eventManager.next(new g.EventMessage(this,new _.ARModeEnded))},ARMarkerManager.prototype.render=function(){var t=this,n=this.appManager.renderEventManager.subscribe((function(i){if(t.enabled)if(t.arToolkitContext.update(t.arToolkitSource.domElement),t.stopTracking)n.unsubscribe();else{var o=0;o=o||i-1e3/60;var a=Math.min(200,i-o);o=i,t.onRenderFcts.forEach((function(t){t(a/1e3,i/1e3)}))}else n.unsubscribe()}))},ARMarkerManager.prototype.onResize=function(){s.arToolkitSource.onResizeElement(),s.arToolkitSource.copyElementSizeTo(s.domElement),null!==s.arToolkitContext.arController&&s.arToolkitSource.copyElementSizeTo(s.arToolkitContext.arController.canvas)},ARMarkerManager.prototype.Destroy=function(){this.setEnabled(!1),this.onRenderFcts=void 0,this.arToolkitSource=void 0,this.arToolkitContext=void 0,this.domElement=void 0,this.camera=void 0,this.markerControls=void 0},ARMarkerManager}();n.ARMarkerManager=S},function(t,n,i){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.ARPattern=void 0,(o=n.ARPattern||(n.ARPattern={})).encodeImageURL=function encodeImageURL(t){var n=this;return new Promise((function(i,o){var a=new Image;a.crossOrigin="Anonymous",a.onload=function(){var t=n.encodeImage(a);i(t)},a.onerror=function(t){o(t)},a.src=t}))},o.encodeImage=function encodeImage(t){var n=document.createElement("canvas"),i=n.getContext("2d");n.width=16,n.height=16;for(var o="",a=0;a>-2*Math.PI;a-=Math.PI/2){i.save(),i.clearRect(0,0,n.width,n.height),i.translate(n.width/2,n.height/2),i.rotate(a),i.drawImage(t,-n.width/2,-n.height/2,n.width,n.height),i.restore();var s=i.getImageData(0,0,n.width,n.height);0!==a&&(o+="\n");for(var m=2;m>=0;m--)for(var g=0;g<s.height;g++){for(var _=0;_<s.width;_++){0!==_&&(o+=" ");var S=g*s.width*4+4*_+m,M=s.data[S];o+=String(M).padStart(3)}o+="\n"}}return o},o.triggerDownload=function triggerDownload(t){var n=window.document.createElement("a");n.href=window.URL.createObjectURL(new Blob([t],{type:"text/plain"})),n.download="pattern-marker.patt",document.body.appendChild(n),n.click(),document.body.removeChild(n)},o.buildFullMarker=function buildFullMarker(t,n){return new Promise((function(i,o){var a=.1+(1-n)/2*.8,s=document.createElement("canvas"),m=s.getContext("2d");s.width=s.height=512,m.fillStyle="white",m.fillRect(0,0,s.width,s.height),m.fillStyle="black",m.fillRect(.1*s.width,.1*s.height,.8*s.width,.8*s.height),m.fillStyle="white",m.fillRect(a*s.width,a*s.height,s.width*(1-2*a),s.height*(1-2*a));var g=document.createElement("img");g.addEventListener("load",(function(){m.drawImage(g,a*s.width,a*s.height,s.width*(1-2*a),s.height*(1-2*a));var t=s.toDataURL();i(t)})),g.src=t}))},o.ObjectToURL=function ObjectToURL(t){return window.URL.createObjectURL(new Blob([t],{type:"text/plain"}))}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.HistoryManager=void 0;var s=i(18),m=i(34),g=function(){function HistoryManager(t){var n=this;this.undos=new Array,this.redos=new Array,this.historyEventManager=(new m.HistoryEventManager).subject,this.appManager=t,this.historyEventManager.pipe(s.filter((function(t){return"action"===t.historyMode||"redo"===t.historyMode}))).subscribe((function(t){return o(n,void 0,void 0,(function(){return a(this,(function(n){return this.onAction(t),[2]}))}))})),this.historyEventManager.pipe(s.filter((function(t){return"undo"===t.historyMode}))).subscribe((function(t){return o(n,void 0,void 0,(function(){return a(this,(function(n){return this.onUndo(t),[2]}))}))}))}return HistoryManager.prototype.onAction=function(t){this.undos.length>99&&this.undos.pop(),this.undos.unshift(t),"action"===t.historyMode&&(this.redos=[])},HistoryManager.prototype.Undo=function(){var t=this.undos.shift();t&&this.appManager.editorEventManager.next({originId:t.originId,type:t.type,value:t.oldValue,editStart:"delete"===t.type,actionType:"undo"})},HistoryManager.prototype.onUndo=function(t){this.redos.length>99&&this.redos.pop(),this.redos.unshift(t)},HistoryManager.prototype.Redo=function(){var t=this.redos.shift();t&&this.appManager.editorEventManager.next({originId:t.originId,type:t.type,value:t.oldValue,editStart:"delete"===t.type,actionType:"redo"})},HistoryManager}();n.HistoryManager=g},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LodManager=void 0;var o=i(0),a=i(99),s=function(){function LodManager(t,n){var i=this;this.lod=0,this.lodManagerOptions=t,this.element=n,this.lodManagerOptions&&this.lodManagerOptions.lods&&this.lodManagerOptions.lods.length>1&&(this.boundingBox=a.Utils.SetBoxFromObj(new o.Box3,this.element.obj),this.subscription=this.element.appManager.renderEventManager.subscribe((function(){i.calcLod()})))}return LodManager.prototype.calcLod=function(){this.element.appManager.currentExperience.cameraControlsRegistry.cameraControls.isObjectVisible(this.boundingBox)?this.calcDistance():this.changeLod(0)},LodManager.prototype.calcDistance=function(){if(this.element.obj){var t=this.element.appManager.currentExperience.cameraControlsRegistry.cameraControls.calcDistanceFromCamera(this.element.obj);0!==this.lod&&t>this.lodManagerOptions.lods[this.lod].distance?this.changeLod(this.lod-1):this.lodManagerOptions.lods[this.lod+1]&&t<this.lodManagerOptions.lods[this.lod+1].distance&&this.changeLod(this.lod+1)}},LodManager.prototype.changeLod=function(t){this.lod!==t&&(this.lod=t,this.currentLodOption=this.lodManagerOptions.lods[t],this.element.changeLod(this.currentLodOption))},LodManager.prototype.destroy=function(){this.subscription.unsubscribe(),this.subscription=void 0,this.boundingBox=void 0},LodManager}();n.LodManager=s},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TextElement=n.ZoneManager=n.ZoneLight=n.Screens=n.ObjModel=n.LightElement=n.Hotspots=n.Grid=n.Galleries=n.ExperienceManager=n.CssElement=n.CanvasElements=n.Backgrounds=void 0;var o=i(152);n.Backgrounds=o;var a=i(503);n.CanvasElements=a;var s=i(294);Object.defineProperty(n,"CssElement",{enumerable:!0,get:function(){return s.CssElement}});var m=i(505);n.ExperienceManager=m;var g=i(515);n.Galleries=g;var _=i(517);n.Grid=_;var S=i(309);n.Hotspots=S;var M=i(311);n.LightElement=M;var T=i(526);n.ObjModel=T;var O=i(527);n.Screens=O;var A=i(314);Object.defineProperty(n,"ZoneLight",{enumerable:!0,get:function(){return A.ZoneLight}});var P=i(530);n.ZoneManager=P;var L=i(531);Object.defineProperty(n,"TextElement",{enumerable:!0,get:function(){return L.TextElement}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EquirectangularBackgroundVideo=void 0;var g=i(0),_=i(127),S=i(10),M=i(147),T=i(22),O=function(t){function EquirectangularBackgroundVideo(n,i){return t.call(this,n,i)||this}return a(EquirectangularBackgroundVideo,t),EquirectangularBackgroundVideo.prototype.activateElement=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(n){return t.video.IsMuted&&t.video.Unmute(),[2]}))}))},EquirectangularBackgroundVideo.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o=this;return m(this,(function(a){switch(a.label){case 0:return[4,t.prototype.init.call(this)];case 1:return a.sent(),n=!0,i=!0,"no"===this.appManager.currentExperience.currentZone.getCustomAttribute(T.CustomAttributes.BackgroundVideoAutoplay)&&(n=!1),"no"===this.appManager.currentExperience.currentZone.getCustomAttribute(T.CustomAttributes.BackgroundVideoLoop)&&(i=!1),[2,new Promise((function(t,a){return s(o,void 0,void 0,(function(){var o,s,_,T=this;return m(this,(function(m){switch(m.label){case 0:return o={url:this.getMetadata().bg,loop:i,preload:!0,autoplay:n,minFilter:g.NearestFilter,muted:!0},this.video=new M.Video(o),s=this,this.video.OnStateChanged.subscribe((function(n,i){switch(i){case M.VideoStatus.Ended:T.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(T);break;case M.VideoStatus.Ready:T.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(T),T.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(T);break;case M.VideoStatus.Playing:T.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(T);break;case M.VideoStatus.Paused:case M.VideoStatus.Stoped:case M.VideoStatus.Unloaded:T.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(T)}s.setState(new S.LoadedEvent),t()})),[4,this.video.Load()];case 1:return(_=m.sent())?(this.material.map=_,this.material.needsUpdate=!0):(this.setState(new S.ErrEvent),a()),[2]}}))}))}))]}}))}))},EquirectangularBackgroundVideo.prototype.destroy=function(){t.prototype.destroy.call(this),this.video.Dispose()},EquirectangularBackgroundVideo.prototype.getMetadata=function(){return this.metadata},EquirectangularBackgroundVideo}(_.EquirectangularBackground);n.EquirectangularBackgroundVideo=O},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EquirectangularBackgroundImage=void 0;var g=i(77),_=i(0),S=i(127),M=i(10),T=i(22),O=function(t){function EquirectangularBackgroundImage(n,i){return t.call(this,n,i)||this}return a(EquirectangularBackgroundImage,t),EquirectangularBackgroundImage.prototype.init=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this)];case 1:return i.sent(),this.media=new g.Image(this.appManager,{url:this.getMetadata().bg,minFilter:_.NearestFilter,generateMipmaps:!1,optimizerWidth:this.getCustomAttribute(T.CustomAttributes.OptimizationWidth,!0)}),[4,this.media.Load()];case 2:return(n=i.sent())?(this.material.map=n,this.material.needsUpdate=!0,this.setState(new M.LoadedEvent)):this.setState(new M.ErrEvent),[2]}}))}))},EquirectangularBackgroundImage.prototype.getMetadata=function(){return this.metadata},EquirectangularBackgroundImage.prototype.destroy=function(){t.prototype.destroy.call(this),this.media.Dispose()},EquirectangularBackgroundImage}(S.EquirectangularBackground);n.EquirectangularBackgroundImage=O},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CanvasInteractiveElement=void 0;var g=i(0),_=i(10),S=i(83),M=function(t){function CanvasInteractiveElement(n,i,o,a,s,m){void 0===a&&(a=!0);var _=t.call(this,n,i,o)||this;return _.material=new g.MeshBasicMaterial({transparent:!0,alphaTest:0}),_.isTransparent=a,_.width=s||_.width,_.height=m||_.height,_.canvas=document.createElement("canvas"),_.canvas.width=_.width,_.canvas.height=_.height,_.context=_.canvas.getContext("2d"),_}return a(CanvasInteractiveElement,t),CanvasInteractiveElement.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return this.geometry=new g.PlaneGeometry(this.width,this.height,.1),[4,t.prototype.init.call(this)];case 1:return n.sent(),[4,this.updateTexture()];case 2:return n.sent(),this.setState(new _.LoadedEvent),[2]}}))}))},CanvasInteractiveElement.prototype.getMetadata=function(){return this.metadata},CanvasInteractiveElement.prototype.updateTexture=function(){return s(this,void 0,void 0,(function(){var t;return m(this,(function(n){return(t=this.getTextureFromCanvas()).needsUpdate=!0,this.material instanceof S.ChromakeyMaterial?this.material.updateTexture(t):(this.material.map=t,this.material.needsUpdate=!0),[2]}))}))},CanvasInteractiveElement.prototype.getTextureFromCanvas=function(){return this.clear(),this.context.fill(),new g.Texture(this.canvas)},CanvasInteractiveElement.prototype.clear=function(){this.context&&this.context.clearRect(0,0,this.width,this.height)},CanvasInteractiveElement.prototype.roundedRect=function(t,n,i,o,a,s,m,g,_){return void 0===s&&(s=5),_&&(this.context.lineWidth=_,n+=_,i+=_,o-=2*_,a-=2*_),t.save(),t.beginPath(),t.moveTo(n+s,i),t.lineTo(n+o-s,i),t.quadraticCurveTo(n+o,i,n+o,i+s),t.lineTo(n+o,i+a-s),t.quadraticCurveTo(n+o,i+a,n+o-s,i+a),t.lineTo(n+s,i+a),t.quadraticCurveTo(n,i+a,n,i+a-s),t.lineTo(n,i+s),t.quadraticCurveTo(n,i,n+s,i),t.closePath(),g&&(t.strokeStyle=g,t.stroke()),m&&(t.fillStyle=m,t.fill()),t},CanvasInteractiveElement.prototype.destroy=function(){t.prototype.destroy.call(this),this.context=void 0,this.canvas.remove(),this.canvas=void 0},CanvasInteractiveElement}(i(46).ByondInteractiveElement);n.CanvasInteractiveElement=M},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CssElement=void 0;var g=i(0),_=i(295),S=i(46),M=i(73),T=function(t){function CssElement(n,i,o){var a=t.call(this,n,i,o)||this;return a.material=new g.MeshBasicMaterial({transparent:!0,alphaTest:0,visible:!1}),a}return a(CssElement,t),CssElement.prototype.init=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return n=this.getMetadata(),this.html=document.createElement("div"),this.html.style.opacity="0",this.html.innerHTML=n.html,this.html.style.width=n.width+"px",this.html.style.height=n.height+"px",this.html.firstChild.style.width="100%",this.html.firstChild.style.height="100%",n.css&&(this.css=document.createElement("style"),this.css.type="text/css",this.css.innerHTML=n.css,document.head.appendChild(this.css)),this.cssObject=new _.CSS3DObject(this.html),this.geometry=new g.PlaneBufferGeometry(n.width,n.height),this.material=new g.MeshBasicMaterial({transparent:!0,alphaTest:0,opacity:0,visible:!1}),this.obj=new g.Mesh(this.geometry,this.material),this.obj.add(this.cssObject),[4,t.prototype.init.call(this)];case 1:return i.sent(),[2]}}))}))},CssElement.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return this.visible===t?[2]:[4,this.setAlpha(t?1:0,n)];case 1:return i.sent(),this.visible=t,[2]}}))}))},CssElement.prototype.setAlpha=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return this.cssObject.visible=!0,[4,M.JsUtils.setHtmlOpacity(this.html,t,n)];case 1:return i.sent(),this.cssObject.visible=t>0,[2]}}))}))},CssElement.prototype.getMetadata=function(){return this.metadata},CssElement.prototype.destroy=function(){t.prototype.destroy.call(this),this.html.remove(),this.css&&this.css.remove()},CssElement}(S.ByondInteractiveElement);n.CssElement=T},function(t,n,i){"use strict";i.r(n),i.d(n,"CSS3DObject",(function(){return CSS3DObject})),i.d(n,"CSS3DSprite",(function(){return CSS3DSprite})),i.d(n,"CSS3DRenderer",(function(){return CSS3DRenderer}));var o=i(0),CSS3DObject=function(t){o.Object3D.call(this),this.element=t||document.createElement("div"),this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))};CSS3DObject.prototype=Object.assign(Object.create(o.Object3D.prototype),{constructor:CSS3DObject,copy:function(t,n){return o.Object3D.prototype.copy.call(this,t,n),this.element=t.element.cloneNode(!0),this}});var CSS3DSprite=function(t){CSS3DObject.call(this,t)};CSS3DSprite.prototype=Object.create(CSS3DObject.prototype),CSS3DSprite.prototype.constructor=CSS3DSprite;var CSS3DRenderer=function(){var t,n,i,a,s=this,m=new o.Matrix4,g={camera:{fov:0,style:""},objects:new WeakMap},_=document.createElement("div");_.style.overflow="hidden",this.domElement=_;var S=document.createElement("div");S.style.WebkitTransformStyle="preserve-3d",S.style.transformStyle="preserve-3d",S.style.pointerEvents="none",_.appendChild(S);var M=/Trident/i.test(navigator.userAgent);function epsilon(t){return Math.abs(t)<1e-10?0:t}function getCameraCSSMatrix(t){var n=t.elements;return"matrix3d("+epsilon(n[0])+","+epsilon(-n[1])+","+epsilon(n[2])+","+epsilon(n[3])+","+epsilon(n[4])+","+epsilon(-n[5])+","+epsilon(n[6])+","+epsilon(n[7])+","+epsilon(n[8])+","+epsilon(-n[9])+","+epsilon(n[10])+","+epsilon(n[11])+","+epsilon(n[12])+","+epsilon(-n[13])+","+epsilon(n[14])+","+epsilon(n[15])+")"}function getObjectCSSMatrix(t,n){var o=t.elements,s="matrix3d("+epsilon(o[0])+","+epsilon(o[1])+","+epsilon(o[2])+","+epsilon(o[3])+","+epsilon(-o[4])+","+epsilon(-o[5])+","+epsilon(-o[6])+","+epsilon(-o[7])+","+epsilon(o[8])+","+epsilon(o[9])+","+epsilon(o[10])+","+epsilon(o[11])+","+epsilon(o[12])+","+epsilon(o[13])+","+epsilon(o[14])+","+epsilon(o[15])+")";return M?"translate(-50%,-50%)translate("+i+"px,"+a+"px)"+n+s:"translate(-50%,-50%)"+s}this.getSize=function(){return{width:t,height:n}},this.setSize=function(o,s){i=(t=o)/2,a=(n=s)/2,_.style.width=o+"px",_.style.height=s+"px",S.style.width=o+"px",S.style.height=s+"px"};var T,O,A=(T=new o.Vector3,O=new o.Vector3,function(t,n){return T.setFromMatrixPosition(t.matrixWorld),O.setFromMatrixPosition(n.matrixWorld),T.distanceToSquared(O)});this.render=function(t,n){var o=n.projectionMatrix.elements[5]*a;if(g.camera.fov!==o&&(n.isPerspectiveCamera?(_.style.WebkitPerspective=o+"px",_.style.perspective=o+"px"):(_.style.WebkitPerspective="",_.style.perspective=""),g.camera.fov=o),!0===t.autoUpdate&&t.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),n.isOrthographicCamera)var T=-(n.right+n.left)/2,O=(n.top+n.bottom)/2;var P=n.isOrthographicCamera?"scale("+o+")translate("+epsilon(T)+"px,"+epsilon(O)+"px)"+getCameraCSSMatrix(n.matrixWorldInverse):"translateZ("+o+"px)"+getCameraCSSMatrix(n.matrixWorldInverse),L=P+"translate("+i+"px,"+a+"px)";g.camera.style===L||M||(S.style.WebkitTransform=L,S.style.transform=L,g.camera.style=L),function renderObject(t,n,i,o){if(t instanceof CSS3DObject){var a;t.onBeforeRender(s,n,i),t instanceof CSS3DSprite?(m.copy(i.matrixWorldInverse),m.transpose(),m.copyPosition(t.matrixWorld),m.scale(t.scale),m.elements[3]=0,m.elements[7]=0,m.elements[11]=0,m.elements[15]=1,a=getObjectCSSMatrix(m,o)):a=getObjectCSSMatrix(t.matrixWorld,o);var _=t.element,T=g.objects.get(t);if(void 0===T||T.style!==a){_.style.WebkitTransform=a,_.style.transform=a;var O={style:a};M&&(O.distanceToCameraSquared=A(i,t)),g.objects.set(t,O)}_.style.display=t.visible?"":"none",_.parentNode!==S&&S.appendChild(_),t.onAfterRender(s,n,i)}for(var P=0,L=t.children.length;P<L;P++)renderObject(t.children[P],n,i,o)}(t,t,n,P),M&&function zOrder(t){for(var n=function filterAndFlatten(t){var n=[];return t.traverse((function(t){t instanceof CSS3DObject&&n.push(t)})),n}(t).sort((function(t,n){return g.objects.get(t).distanceToCameraSquared-g.objects.get(n).distanceToCameraSquared})),i=n.length,o=0,a=n.length;o<a;o++)n[o].element.style.zIndex=i-o}(t)}}},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneManager=void 0;var g=i(10),_=i(128),S=i(50),M=i(22),T=i(56),O=i(34),A=function(t){function ZoneManager(n,i,o){return t.call(this,n,i,o)||this}return a(ZoneManager,t),ZoneManager.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i=this;return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.init.call(this)];case 1:return o.sent(),n=this,[4,this.createElements()];case 2:return n.elementsList=o.sent(),[4,Promise.all(this.elementsList.map((function(t){return s(i,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t.init()];case 1:return i.sent(),[3,3];case 2:return n=i.sent(),S.Log.Error("can't init element err: "+n),[3,3];case 3:return[2]}}))}))})))];case 3:return o.sent(),this.elementsList?[4,Promise.all(this.elementsList.map((function(t){return s(i,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t.setVisible(!0,1)];case 1:return i.sent(),[3,3];case 2:return n=i.sent(),S.Log.Error("can't setVisible element err: "+n),[3,3];case 3:return[2]}}))}))})))]:[3,5];case 4:o.sent(),o.label=5;case 5:return this.elementsList&&this.elementsList.map((function(t){return s(i,void 0,void 0,(function(){return m(this,(function(n){try{t.setEnabled(!0)}catch(t){S.Log.Error("can't setEnabled element err: "+t)}return[2]}))}))})),[4,this.applyEffects()];case 6:return o.sent(),this.afterInit(),this.appManager.cameraControlsRegistry.updateCameraProjectionMatrix(),this.setState(new g.LoadedEvent),this.appManager.eventManager.next(new O.EventMessage(this,new g.ZoneLoadedEvent),!0),[2]}}))}))},ZoneManager.prototype.applyEffects=function(){return s(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return(t=this.getCustomAttribute(M.CustomAttributes.Effects))?t[M.CustomAttributes.Values.Effects.ColorAdjustmentEffect]?[4,this.addColorAdjustmentEffect(t[M.CustomAttributes.Values.Effects.ColorAdjustmentEffect])]:[3,2]:[2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},ZoneManager.prototype.addColorAdjustmentEffect=function(t){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){return(n=new T.Effects.ColorAdjustmentEffect.ColorAdjustmentEffect(this.appManager,t)).init(),n.start(),this.effects.push(n),[2]}))}))},ZoneManager.prototype.addEditorItems=function(){t.prototype.addEditorItems.call(this)},ZoneManager}(_.ZoneManagerImpl);n.ZoneManager=A},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ARMarkerZoneManager=void 0;var g=i(128),_=i(10),S=i(286),M=i(269),T=i(298),O=i(73),A=i(299),P=i(18),L=i(50),R=["./ext/three.min.js","./ext/ar.min.js"],N=!1,I=function(t){function ARMarkerZoneManager(n,i,o){var a=t.call(this,n,i,o)||this;return a.pinnedMarker=!1,a.iteractionShowed=!1,a}return a(ARMarkerZoneManager,t),ARMarkerZoneManager.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o,a,g,P,I,j=this;return m(this,(function(V){switch(V.label){case 0:return N?[3,2]:(n=[],R.forEach((function(t){n.push(O.JsUtils.injectJsFile(t))})),[4,Promise.all(n)]);case 1:V.sent(),N=!0,V.label=2;case 2:return i=this.appManager.cameraControlsRegistry,this.arManager=new S.ARMarkerManager(this.appManager,this.appManager.currentExperience.renderer.domElement,i.cameraControls.camera),this.arManager.setEnabled(!0),this.cameraBtn=new T.CameraBtn,this.overlay=new A.AROverlay,this.cameraBtn.Enable(),this.cameraBtn.OnButtonClicked.subscribe((function(t,n){j.captureCanvas()})),[4,t.prototype.init.call(this)];case 3:return V.sent(),o=this,[4,this.createElements()];case 4:return o.elementsList=V.sent(),[4,Promise.all(this.elementsList.map((function(t){return s(j,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.init()];case 1:return n.sent(),[2]}}))}))})))];case 5:return V.sent(),a=this.appManager.currentExperience.getMetadata().configuration,g=M.ARUtils.getZoneMarkerImage(a,this.getMetadata().byond_id),(P=M.ARUtils.getZoneMarker(a,this.getMetadata().byond_id))&&P.pinned&&(this.pinnedMarker=!0),g?this.arManager.setMarker(g):L.Log.Error("can't launch an AR zone without an AR marker"),this.registerEvents(),this.registerInteractions(),this.afterInit(),i.updateCameraProjectionMatrix(),[4,M.ARUtils.getMarkerImage(g,.5)];case 6:return I=V.sent(),this.overlay.showInstructions(!0,I),this.setState(new _.LoadedEvent),[2]}}))}))},ARMarkerZoneManager.prototype.captureCanvas=function(){return s(this,void 0,void 0,(function(){var t,n,i,o,a,s,g,_,S;return m(this,(function(m){switch(m.label){case 0:return t=this.appManager.currentExperience.renderer.domElement,n=this.arManager.arToolkitContext.arController.canvas,i=2*n.width,o=2*n.height,[4,O.JsUtils.loadImage(t.toDataURL())];case 1:return a=m.sent(),[4,O.JsUtils.loadImage(n.toDataURL())];case 2:return s=m.sent(),[4,O.JsUtils.resizeImage(a,i,o)];case 3:return a=m.sent(),[4,O.JsUtils.resizeImage(s,i,o)];case 4:return s=m.sent(),(g=document.createElement("canvas")).width=i,g.height=o,(_=g.getContext("2d")).drawImage(s,0,0),_.drawImage(a,0,0),S=g.toDataURL("image/png"),O.JsUtils.SaveAsDataUrl(S,"capture.png"),g.remove(),[2]}}))}))},ARMarkerZoneManager.prototype.registerEvents=function(){var t=this,n=this.appManager.eventManager.pipe(P.filter((function(t){return t.eventType.name===(new _.ARMarkerDetected).name||t.eventType===_.ARMarkerDetected}))).subscribe((function(n){t.onMarker()})),i=this.appManager.eventManager.pipe(P.filter((function(t){return t.eventType.name===(new _.ARMarkerUndetected).name||t.eventType===_.ARMarkerUndetected}))).subscribe((function(n){t.offMarker()}));this.subscriptions.push(n),this.subscriptions.push(i)},ARMarkerZoneManager.prototype.registerInteractions=function(){var t=this,n=this.appManager.eventManager.pipe(P.filter((function(t){return t.eventType.name===(new _.PinchEvent).name||t.eventType===_.PinchEvent||t.eventType.name===(new _.MouseWheelEvent).name||t.eventType===_.MouseWheelEvent}))).subscribe((function(n){t.onPinch(n.message.delta)})),i=this.appManager.eventManager.pipe(P.filter((function(t){return t.eventType.name===(new _.MouseSwipeEvent).name||t.eventType===_.MouseSwipeEvent}))).subscribe((function(n){t.onSwipe(n.message)}));this.subscriptions.push(n),this.subscriptions.push(i)},ARMarkerZoneManager.prototype.onPinch=function(t){if(0!==t){var n=-.001*t;this.obj.scale.x<5e-4&&n<0||this.obj.scale.addScalar(n)}},ARMarkerZoneManager.prototype.onSwipe=function(t){this.obj.rotateZ(-.01*t.x),this.obj.rotateX(-.01*t.y)},ARMarkerZoneManager.prototype.onMarker=function(){var t=this;this.iteractionShowed||(this.overlay.showInteractions(!0),this.iteractionShowed=!0),Promise.all(this.elementsList.map((function(n){return s(t,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,n.setVisible(!0,.1)];case 1:return t.sent(),[2]}}))}))}))).then((function(){t.elementsList.map((function(n){return s(t,void 0,void 0,(function(){return m(this,(function(t){return n.setEnabled(!0),[2]}))}))}))})),this.pinnedMarker&&this.arManager.StopTracking()},ARMarkerZoneManager.prototype.offMarker=function(){var t=this;this.elementsList.map((function(n){return s(t,void 0,void 0,(function(){return m(this,(function(t){return n.setEnabled(!1),[2]}))}))})),this.elementsList.map((function(n){return s(t,void 0,void 0,(function(){return m(this,(function(t){return n.setVisible(!1,.1),[2]}))}))}))},ARMarkerZoneManager.prototype.destroy=function(){t.prototype.destroy.call(this),this.arManager.Destroy(),this.cameraBtn.Destroy(),this.setEnabled(!1)},ARMarkerZoneManager}(g.ZoneManagerImpl);n.ARMarkerZoneManager=I},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CameraBtn=void 0;var o=i(187);i(507);var a=i(509),s=function(){function CameraBtn(){this.enabled=!1,this._OnButtonClicked=new o.EventDispatcher,this.container=document.createElement("div"),this.container.id="camera_btn",document.body.appendChild(this.container),this.container.innerHTML=a,this.Button=this.container.getElementsByClassName("camera_btn")[0],this.Button.style.display="none"}return CameraBtn.prototype.Enable=function(){this.enabled||(this.enabled=!0,this.Button.addEventListener("click",this.onClickVRButton.bind(null,this)),this.Button.style.display="")},CameraBtn.prototype.Disable=function(){this.enabled&&(this.enabled=!1,this.Button.style.display="none")},CameraBtn.prototype.Destroy=function(){this.Disable(),this.Button.remove(),this._OnButtonClicked.clear(),this._OnButtonClicked=void 0},Object.defineProperty(CameraBtn.prototype,"OnButtonClicked",{get:function(){return this._OnButtonClicked.asEvent()},enumerable:!1,configurable:!0}),CameraBtn.prototype.onClickVRButton=function(t,n){t._OnButtonClicked.dispatch(n,this)},CameraBtn}();n.CameraBtn=s},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AROverlay=void 0,i(510);var o=i(512),a=function(){function AROverlay(){var t=this;this.enabled=!1,this.container=document.createElement("div"),this.container.id="ar_overlay",document.body.appendChild(this.container),this.container.innerHTML=o,this.interactions=this.container.getElementsByClassName("interactions")[0],this.instructions=this.container.getElementsByClassName("instructions")[0],this.interactions.style.display="none",this.instructions.style.display="none",this.interactions.getElementsByClassName("btn")[0].onclick=function(){t.showInteractions(!1)}}return AROverlay.prototype.showInstructions=function(t,n){this.instructions.style.display=t?"inline-block":"none",t&&(this.showInteractions(!1),this.setInstructionsImage(n))},AROverlay.prototype.showInteractions=function(t){this.interactions.style.display=t?"inline-block":"none",t&&this.showInstructions(!1)},AROverlay.prototype.setInstructionsImage=function(t){this.instructions.getElementsByTagName("img")[0].src=t},AROverlay}();n.AROverlay=a},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ARZoneManager=void 0;var g=i(128),_=i(34),S=i(10),M=i(18),T=i(0),O=i(50),A=i(301),P=i(46),L=i(56),R=function(t){function ARZoneManager(n,i,o){var a=t.call(this,n,i,o)||this;return a.onDeviceOrientationChangeFunc=a.onDeviceOrientationChange.bind(a),a.placeSceneFunc=a.placeScene.bind(a),a.onSwipeFunc=a.onSwipe.bind(a),a}return a(ARZoneManager,t),ARZoneManager.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o=this;return m(this,(function(a){switch(a.label){case 0:return[4,this.initXRModule()];case 1:return a.sent(),this.setVisible(!0),n=A.ARModuleManager.getProp(),window.scene=n.scene,[4,t.prototype.init.call(this)];case 2:return a.sent(),n.camera.add(this.obj),i=this,[4,this.createElements()];case 3:return i.elementsList=a.sent(),[4,Promise.all(this.elementsList.map((function(t){return s(o,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t.init()];case 1:return i.sent(),[3,3];case 2:return n=i.sent(),O.Log.Error("can't init element err: "+n),[3,3];case 3:return[2]}}))}))})))];case 4:return a.sent(),[4,this.setSceneAlpha()];case 5:return a.sent(),this.resetZone(),this.afterInit(),this.setState(new S.LoadedEvent),[2]}}))}))},ARZoneManager.prototype.setSceneAlpha=function(){return s(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return this.elementsList?[4,Promise.all(this.elementsList.map((function(n){return s(t,void 0,void 0,(function(){var t;return m(this,(function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),n instanceof P.ByondInteractiveElement?[4,n.setAlpha(.3,0)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,n.setVisible(!1,0)];case 3:i.sent(),i.label=4;case 4:return[3,6];case 5:return t=i.sent(),O.Log.Error("can't setVisible element err: "+t),[3,6];case 6:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},ARZoneManager.prototype.resetZone=function(){t.prototype.resetZone.call(this),A.ARModuleManager.resetCamera(),A.ARModuleManager.getProp().camera.add(this.obj);var n=this.getCustomAttribute(L.Core.CustomAttributes.PreviewTransform);if(n&&n.scale){var i=n.scale;this.obj.scale.set(i.x,i.y,i.z)}else this.obj.scale.set(1,1,1);if(n&&n.rotation){var o=n.rotation;this.obj.rotation.set(o.x,o.y,o.z)}else this.obj.rotation.set(0,0,0);if(n&&n.position){var a=n.position;this.obj.position.set(a.x,a.y,a.z)}else this.obj.position.set(0,0,0);this.removePlaceZoneListeners(),this.addPlaceZoneListeners(),this.unRegisterInteractions()},ARZoneManager.prototype.setEnabled=function(t){this.enabled!==t&&(this.enabled=t)},ARZoneManager.prototype.addPlaceZoneListeners=function(){var t=this;["touchstart","mousedown"].forEach((function(n){window.addEventListener(n,t.placeSceneFunc)}))},ARZoneManager.prototype.removePlaceZoneListeners=function(){var t=this;["touchstart","mousedown"].forEach((function(n){window.removeEventListener(n,t.placeSceneFunc)}))},ARZoneManager.prototype.setCameraheight=function(t){A.ARModuleManager.getProp().camera.position.setX(t)},ARZoneManager.prototype.placeScene=function(t){return s(this,void 0,void 0,(function(){var n,i,o,a,g,M=this;return m(this,(function(P){switch(P.label){case 0:return!this.enabled||this.destroyed?[2]:(n=new T.Vector2,t instanceof MouseEvent?(n.x=t.clientX/window.innerWidth*2-1,n.y=-t.clientY/window.innerHeight*2+1):(n.x=t.touches[0].clientX/window.innerWidth*2-1,n.y=-t.touches[0].clientY/window.innerHeight*2+1),(i=A.ARModuleManager.checkIntersectWithSurface(n,this.appManager.debugMode))?(this.appManager.eventManager.next(new _.EventMessage(this,new S.ARObjectPlacedEvent)),this.removePlaceZoneListeners(),this.registerInteractions(),(o=A.ARModuleManager.getProp()).scene.add(this.obj),this.obj.position.set(i.x,0,i.z),this.obj.scale.set(1,1,1),a=o.camera,g=new T.Vector3(a.position.x,this.obj.position.y,a.position.z),this.obj.lookAt(g),this.elementsList?[4,Promise.all(this.elementsList.map((function(t){return s(M,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t.setVisible(!0,.3)];case 1:return i.sent(),[3,3];case 2:return n=i.sent(),O.Log.Error("can't setVisible element err: "+n),[3,3];case 3:return[2]}}))}))})))]:[3,2]):[2]);case 1:P.sent(),P.label=2;case 2:return this.elementsList&&this.elementsList.map((function(t){return s(M,void 0,void 0,(function(){return m(this,(function(n){try{t.setEnabled(!0)}catch(t){O.Log.Error("can't setEnabled element err: "+t)}return[2]}))}))})),[2]}}))}))},ARZoneManager.prototype.setVisible=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return A.ARModuleManager.getCanvas().style.display=n?"block":"none",[4,t.prototype.setVisible.call(this,n,i)];case 1:return o.sent(),[2]}}))}))},ARZoneManager.prototype.setGammaFactor=function(t){var n=A.ARModuleManager.getProp();t?(n.renderer.outputEncoding=T.GammaEncoding,n.renderer.gammaFactor=t):(n.renderer.outputEncoding=T.LinearEncoding,n.renderer.gammaFactor=1)},ARZoneManager.prototype.initXRModule=function(){return s(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,A.ARModuleManager.initXRModule(this.appManager.debugMode,this.getCustomAttribute(L.Core.CustomAttributes.ApiKey))];case 1:return t.sent(),this.onDeviceOrientationChange(window.orientation),window.addEventListener("orientationchange",this.onDeviceOrientationChangeFunc),window.addEventListener("resize",this.onDeviceOrientationChangeFunc),[2]}}))}))},ARZoneManager.prototype.registerInteractions=function(){var t=this;this.onPinchSub=this.appManager.eventManager.pipe(M.filter((function(t){return t.eventType.name===(new S.PinchEvent).name||t.eventType===S.PinchEvent||t.eventType.name===(new S.MouseWheelEvent).name||t.eventType===S.MouseWheelEvent}))).subscribe((function(n){t.onPinch(n.message.delta)})),this.onRotateSub=this.appManager.eventManager.pipe(M.filter((function(t){return t.eventType.name===(new S.RotateEvent).name||t.eventType===S.RotateEvent}))).subscribe((function(n){t.onRotate(n.message)})),["touchmove","mousemove"].forEach((function(n){t.appManager.currentExperience.cssRenderer.domElement.addEventListener(n,t.onSwipeFunc)}))},ARZoneManager.prototype.unRegisterInteractions=function(){var t=this;this.onPinchSub&&this.onPinchSub.unsubscribe(),this.onRotateSub&&this.onRotateSub.unsubscribe(),["touchmove","mousemove"].forEach((function(n){t.appManager.currentExperience.cssRenderer.domElement.removeEventListener(n,t.onSwipeFunc)}))},ARZoneManager.prototype.onPinch=function(t){if(this.enabled&&0!==t){var n=-.01*t;this.obj.scale.x<.2&&n<0||this.obj.scale.addScalar(n)}},ARZoneManager.prototype.onSwipe=function(t){if(this.enabled){var n=new T.Vector2;if(t instanceof MouseEvent)n.x=t.clientX/window.innerWidth*2-1,n.y=-t.clientY/window.innerHeight*2+1;else{if(t.touches.length>1)return;n.x=t.touches[0].clientX/window.innerWidth*2-1,n.y=-t.touches[0].clientY/window.innerHeight*2+1}var i=A.ARModuleManager.checkIntersectWithSurface(n,this.appManager.debugMode);i&&this.obj.position.set(i.x,0,i.z)}},ARZoneManager.prototype.onRotate=function(t){},ARZoneManager.prototype.destroy=function(){var n=this;this.unRegisterInteractions(),window.removeEventListener("orientationchange",this.onDeviceOrientationChangeFunc),window.removeEventListener("resize",this.onDeviceOrientationChangeFunc),["touchstart","mousedown"].forEach((function(t){window.removeEventListener(t,n.placeSceneFunc)})),this.setVisible(!1),A.ARModuleManager.Pause(),t.prototype.destroy.call(this)},ARZoneManager.prototype.onDeviceOrientationChange=function(t){var n=this,i=window.innerWidth,o=window.innerHeight;if((0===t||180===t)&&i>o||(90===t||-90===t)&&o>i)window.requestAnimationFrame((function(){return n.onDeviceOrientationChange(t)}));else{var a=A.ARModuleManager.getCanvas();a.width=i,a.height=o}},ARZoneManager}(g.ZoneManagerImpl);n.ARZoneManager=R},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ARModuleManager=void 0;var s,m=i(73),g=i(0),_=!1,S=new g.Mesh(new g.PlaneGeometry(100,100,1,1),new g.MeshBasicMaterial({color:16776960,transparent:!0,opacity:0,side:g.DoubleSide}));S.name="surface";var M=new g.Raycaster;function onModuleStart(){window.dispatchEvent(new CustomEvent("XRModuleStarted"))}!function(t){function getProp(){return XR.Threejs.xrScene()}function getCanvas(){return s||((s=document.createElement("canvas")).id="xrcanvas",s.classList.add("xrcanvas"),s.style.zIndex="-1",document.body.appendChild(s),s)}function resetCamera(){var t=getProp();XR.XrController.updateCameraProjectionMatrix({origin:t.camera.position,facing:t.camera.quaternion})}function waitForXRModuleInjected(){return o(this,void 0,void 0,(function(){return a(this,(function(t){return window.XR?[2]:[2,new Promise((function(t,n){window.addEventListener("xrloaded",(function(){t()}))}))]}))}))}t.getProp=getProp,t.getCanvas=getCanvas,t.initXRModule=function initXRModule(t,n){return void 0===t&&(t=!1),o(this,void 0,void 0,(function(){var i,s;return a(this,(function(g){switch(g.label){case 0:return _?[3,3]:(n||(n="5FqRI0OQD1kVi3HU6luO9xohPbWHntYPFEe4HMjby33lLw2NjbgK1NvoZ3nvhqDXUxnnVA"),_=!0,[4,m.JsUtils.injectJsFile("https://apps.8thwall.com/xrweb?appKey="+n,"application/javascript")]);case 1:return g.sent(),[4,waitForXRModuleInjected()];case 2:g.sent(),XR.addCameraPipelineModules([XR.GlTextureRenderer.pipelineModule(),XR.Threejs.pipelineModule(),XR.XrController.pipelineModule(),T]),g.label=3;case 3:return i=function waitForXRModuleStart(){return o(this,void 0,void 0,(function(){return a(this,(function(t){return[2,new Promise((function(t,n){window.addEventListener("XRModuleStarted",(function resolveFunc(){window.removeEventListener("XRModuleStarted",resolveFunc),t()}))}))]}))}))}(),XR.isPaused()?XR.resume():XR.run({canvas:getCanvas()}),[4,i];case 4:return g.sent(),s=getProp(),S.rotateX(-Math.PI/2),S.position.set(0,0,0),t?S.material.opacity=.3:S.visible=!1,S.renderOrder=-999999,s.scene.name="ARModuleScene",s.camera.name="ARModuleCamera",s.scene.add(S),resetCamera(),[2]}}))}))},t.resetCamera=resetCamera,t.Pause=function Pause(){XR.pause()},t.checkIntersectWithSurface=function checkIntersectWithSurface(t,n){n||(S.visible=!0);var i=getProp();M.setFromCamera(t,i.camera);var o=M.intersectObject(S);if(n||(S.visible=!1),1===o.length&&o[0].object===S)return{x:o[0].point.x,z:o[0].point.z}}}(n.ARModuleManager||(n.ARModuleManager={}));var T={name:"ByondXRZone",onStart:onModuleStart.bind(this),onResume:onModuleStart.bind(this)}},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.BaseExperienceManager=void 0;var g=i(100),_=i(303),S=i(0),M=i(268),T=i(56),O=i(275),A=i(276),P=i(283),L=i(284),R=i(295),N=i(71),I=i(273),j=i(514),V=i(34),U=i(82),G=function(t){function BaseExperienceManager(n,i,o){var a=t.call(this,null,i,o)||this;return a.metadata=a.deserialize(n),a.backgroundManager=new _.TransitionManager(a),a.prefetchManager=new j.PrefetchManager(a),a}return a(BaseExperienceManager,t),BaseExperienceManager.prototype.init=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return this.appManager.eventManager.next(new V.EventMessage(this,new U.EventTypes.ExperienceLoadingEvent),!0),this.renderer=this.appManager.options.renderer||new S.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),this.appManager.options.vr&&M.XRManager.Enable(this.appManager),this.appManager.options.editor&&(this.editor=new T.UIElements.EditorManager(this.appManager)),this.cssRenderer=new R.CSS3DRenderer,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=S.PCFSoftShadowMap,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.appManager.container.offsetWidth,this.appManager.container.offsetHeight),this.cssRenderer.setSize(this.appManager.container.offsetWidth,+this.appManager.container.offsetHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0",this.renderer.domElement.style.outline="none",this.cssRenderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.top="0",this.cssRenderer.domElement.style.outline="none",this.mouseEventManager=new O.MouseEventManager(this.appManager),this.appManager.options.vr&&(this.vrControllerEventManager=new A.VRControllerEventManager(this.appManager)),this.appManager.container.appendChild(this.renderer.domElement),this.appManager.container.appendChild(this.cssRenderer.domElement),this.appManager.options.scene?this.scene=this.appManager.options.scene:(this.scene=new S.Scene,this.scene.name="scene"),this.animateTween(),this.transitionsRegistry=new P.TransitionsRegistry(this.appManager),[4,(n=this.appManager.cameraControlsRegistry).Init(this.appManager)];case 1:return i.sent(),this.cameraControlsRegistry=n,this.userInteractionControlsRegistry=new L.UserInteractionControlsRegistry(this.appManager),[4,this.prefetchManager.prefetch()];case 2:return i.sent(),[4,t.prototype.init.call(this)];case 3:return i.sent(),this.ambientLight=new S.AmbientLight(16777215),this.ambientLight.name="DefaultAmbientLight",this.scene.add(this.ambientLight),this.appManager.options.userControlers&&this.userInteractionControlsRegistry.Register(this.appManager.options.userControlers),[4,this.userInteractionControlsRegistry.Init()];case 4:return i.sent(),this.userInteractionControlsRegistry.Enable(),[2]}}))}))},BaseExperienceManager.prototype.afterExperienceInit=function(){this.elementControlesManager=new I.ElementControlesManager(this.appManager)},BaseExperienceManager.prototype.animateTween=function(){!function _animateTween(t){requestAnimationFrame(_animateTween),N.update(t)}()},BaseExperienceManager.prototype.handleCurrentZoneCamera=function(t){return void 0===t&&(t=!1),s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},BaseExperienceManager.prototype.getMetadata=function(){return this.metadata},BaseExperienceManager.prototype.destroy=function(){t.prototype.destroy.call(this),this.elementControlesManager.destroy(),this.currentZone.destroy(),this.cameraControlsRegistry.cameraControls.destroy(),this.userInteractionControlsRegistry.userInteractionControls.destroy(),this.prefetchManager.destroy()},BaseExperienceManager}(g.ByondBaseElement);n.BaseExperienceManager=G},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransitionManager=void 0;var s=function(){function TransitionManager(t){this.transitionTime=.5,this.parent=t,this.appManager=t.appManager}return TransitionManager.prototype.change=function(t,n){return o(this,void 0,void 0,(function(){var i,o;return a(this,(function(a){switch(a.label){case 0:return[4,this.appManager.elementsRegistry.GetElement(t,this.parent)];case 1:return[4,(i=a.sent()[0]).init()];case 2:return a.sent(),[4,this.appManager.currentExperience.transitionsRegistry.Transition(this.currentBackground,i,this.transitionTime,n)];case 3:return a.sent(),this.currentBackground&&this.currentBackground.destroy(),delete this.currentBackground,o=i.obj.scale,i.obj.scale.set(1.5*o.x,1.5*o.y,1.5*o.z),this.currentBackground=i,[2]}}))}))},TransitionManager}();n.TransitionManager=s},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.GalleryNavigationButton=void 0;var g=i(0),_=i(102),S=function(t){function GalleryNavigationButton(n,i,o,a,s,m){void 0===s&&(s=new g.Vector3(1,1,1));var S=this,M=new _.ScreenMetadata;return M.scale=new g.Vector3(.15*M.scale.x,.15*M.scale.y,.15*M.scale.z),M.position=o,M.rotation=a,M.picture="https://webxr-apps.byondxr.com/assets/images/gallery/gallery_navigation_button.png",(S=t.call(this,M,i,m)||this).galleryBtnManager=i,S.pageIndex=n,S.activeAlpha=.8,S.unactiveAlpha=.6,S}return a(GalleryNavigationButton,t),GalleryNavigationButton.prototype.onHover=function(){this.active||this.setAlpha(this.activeAlpha)},GalleryNavigationButton.prototype.onUnHover=function(){this.active||this.setAlpha(this.unactiveAlpha)},GalleryNavigationButton.prototype.setActive=function(t){this.active=t,this.setAlpha(t?this.activeAlpha:this.unactiveAlpha)},GalleryNavigationButton.prototype.activateElement=function(){return s(this,void 0,void 0,(function(){return m(this,(function(t){return this.galleryBtnManager.animateToPage(this),[2]}))}))},GalleryNavigationButton.prototype.deactivateElement=function(){return s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},GalleryNavigationButton.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},GalleryNavigationButton}(i(85).ScreenImage);n.GalleryNavigationButton=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.GalleryNavigationButtons=void 0;var g=i(0),_=i(32),S=i(46),M=i(304),T=i(197),O=function(t){function GalleryNavigationButtonsMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(GalleryNavigationButtonsMetadata,t),Object.defineProperty(GalleryNavigationButtonsMetadata.prototype,"ElementName",{get:function(){return"galleryNavigationButtons"},enumerable:!1,configurable:!0}),GalleryNavigationButtonsMetadata}(_.Metadata.Element3DMetadata),A=function(t){function GalleryNavigationButtons(n,i,o){var a=this,s=new O,m=n.nRow*n.grid.cellSize.y;s.position=new g.Vector3(0,-m/2-.5,0),s.rotation=new g.Euler(0,Math.PI,0),(a=t.call(this,s,n,o)||this).gallery=n,a.obj=new g.Group,a.nOfPaged=i,a.row=new T.Row(a.obj,a.nOfPaged,new g.Vector3(0,0,0),new g.Vector3(1,.6,.1)),a.row.init(),a.buttons=new Array;for(var _=0;_<a.nOfPaged;_++)a.buttons.push(new M.GalleryNavigationButton(_,a,new g.Vector3(0,0,0),new g.Euler(0,0,0)));return a}return a(GalleryNavigationButtons,t),GalleryNavigationButtons.prototype.animateToPage=function(t){this.gallery.animateToPage(t.pageIndex),this.buttons.forEach((function(n){n===t?n.setActive(!0):n.setActive(!1)}))},GalleryNavigationButtons.prototype.init=function(){return s(this,void 0,void 0,(function(){var n=this;return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this)];case 1:return i.sent(),[4,Promise.all(this.buttons.map((function(t){return t.init()})))];case 2:return i.sent(),[4,Promise.all(this.row.getCells().map((function(t,i){return n.initAndAttachBtnToCell(n.buttons[i],t)})))];case 3:return i.sent(),[2]}}))}))},GalleryNavigationButtons.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i;return m(this,(function(o){switch(o.label){case 0:return i=t?.6:0,[4,Promise.all(this.buttons.map((function(t){return t.setAlpha(i,n)})))];case 1:return o.sent(),this.buttons[this.gallery.currentPage].setActive(!0),[2]}}))}))},GalleryNavigationButtons.prototype.setEnabled=function(t){this.buttons.map((function(n){return n.setEnabled(t)}))},GalleryNavigationButtons.prototype.initAndAttachBtnToCell=function(t,n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.init()];case 1:return i.sent(),n.setContainedChild(t.obj),[4,n.enable()];case 2:return i.sent(),[2]}}))}))},GalleryNavigationButtons}(S.ByondInteractiveElement);n.GalleryNavigationButtons=A},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Cell=void 0;var g=i(0),_=i(153),S=i(17),M=function(t){function Cell(n,i,o,a){void 0===a&&(a=.05);var s=t.call(this,n,i,o)||this;return s.accuracy=.95,s.padding=a,s}return a(Cell,t),Cell.prototype.init=function(){this.geometry=new g.BoxGeometry(this.cellSize.x,this.cellSize.y,this.cellSize.z),this.obj=new g.Mesh(this.geometry,this.material),this.obj.name="cell",this.obj.position.set(this.initialPosition.x,this.initialPosition.y,this.initialPosition.z),this.parent instanceof _.GridBaseElement?this.parent.obj.add(this.obj):this.parent.add(this.obj),this.boxHelper=new g.BoxHelper(this.obj,new g.Color("blue")),this.boxHelper.name="cell box helper",this.wireframe&&(this.wireframe=!0)},Cell.prototype.enable=function(){return s(this,void 0,void 0,(function(){var n=this;return m(this,(function(i){switch(i.label){case 0:return t.prototype.enable.call(this),this.OnPropertieChanged.clear(),this.OnPropertieChanged.subscribe((function(t,i){n.RecheckProp()})),this.gridChild?(this.gridChild.OnPropertieChanged.clear(),this.gridChild.OnPropertieChanged.subscribe((function(t,i){n.RecheckProp()})),[4,this.RecheckProp()]):[3,2];case 1:i.sent(),i.label=2;case 2:return[4,this.RecheckProp()];case 3:return i.sent(),this.enabled=!0,[4,this.obj.geometry.computeBoundingBox()];case 4:return i.sent(),[2]}}))}))},Cell.prototype.disable=function(){t.prototype.disable.call(this),this.gridChild&&this.gridChild.OnPropertieChanged.clear(),this.enabled=!1},Object.defineProperty(Cell.prototype,"hasChild",{get:function(){return!!this.containedObj},enumerable:!1,configurable:!0}),Cell.prototype.setContainedChild=function(t){this.containedObj=t,this.initialPosition?this.setPosition(this.initialPosition):this.setPosition(this.gridChild.obj.position),this.obj.add(this.containedObj),this.containedObj.position.set(0,0,0)},Cell.prototype.RecheckProp=function(){return s(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return[4,S.Utils.sleep(1)];case 1:return n.sent(),this.isValidCell&&this.containedObj?(t=this.containedObj.scale.clone().multiplyScalar(1/this.accuracy),this.containedObj.scale.set(t.x,t.y,t.z),this.RecheckProp()):(this.checkLarger(),this.boxHelper.update()),[2]}}))}))},Cell.prototype.checkLarger=function(){if(!this.isValidCell&&this.containedObj){var t=this.containedObj.scale.clone().multiplyScalar(this.accuracy);this.containedObj.scale.set(t.x,t.y,t.z),this.checkLarger()}},Object.defineProperty(Cell.prototype,"wireframe",{set:function(t){if(this._wireframe=t,this.material.visible=t,t)return this.parent instanceof _.GridBaseElement?this.parent.obj.add(this.boxHelper):this.parent.add(this.boxHelper),void this.boxHelper.update();this.parent instanceof _.GridBaseElement?this.parent.obj.remove(this.boxHelper):this.parent.remove(this.boxHelper)},enumerable:!1,configurable:!0}),Cell.prototype.destroy=function(){t.prototype.destroy.call(this),this._OnPropertieChanged.clear()},Object.defineProperty(Cell.prototype,"isValidCell",{get:function(){if(!this.containedObj)return!0;var t=new g.Mesh(this.obj.geometry.clone(),this.obj.material),n=new g.Mesh(this.containedObj.geometry.clone(),this.containedObj.material),i=this.containedObj.scale;n.scale.set(i.x*(1+this.padding),i.y*(1+this.padding),i.z*(1+this.padding));var o=S.Utils.SetBoxFromObj(new g.Box3,t),a=S.Utils.SetBoxFromObj(new g.Box3,n);return o.containsBox(a)},enumerable:!1,configurable:!0}),Cell}(_.GridBaseElement);n.Cell=M},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Grid=void 0;var g=i(0),_=i(153),S=i(308),M=function(t){function Grid(n,i,o,a,s,m,_,S){void 0===_&&(_=.05),void 0===S&&(S=new g.Vector2(.5,.5));var M=t.call(this,n,s,m)||this;return M.tables=new Array,M.colSize=+i,M.rowSize=+o,M.depthSize=+a,M.padding=+_,M.margin=new g.Vector2(+S.x,+S.y),M}return a(Grid,t),Grid.prototype.init=function(){this.geometry=new g.BoxGeometry(this.cellSize.x*this.colSize,this.cellSize.y*this.rowSize,this.cellSize.z*this.depthSize),this.obj=new g.Mesh(this.geometry,this.material),this.obj.name="grid",this.obj.position.set(this.initialPosition.x,this.initialPosition.y,this.initialPosition.z),this.parent instanceof _.GridBaseElement?this.parent.obj.add(this.obj):this.parent.add(this.obj);for(var t=-this.cellSize.z*this.depthSize/2+this.cellSize.z/2,n=0;n<this.depthSize;n++){var i=new g.Vector3(0,0,t),o=new S.Table(this,this.colSize,this.rowSize,i,this.cellSize,this.padding,this.margin);o.init(),t+=this.cellSize.z,this.tables.push(o)}this.RecheckProp()},Grid.prototype.getCells=function(){var t=new Array;return this.tables.forEach((function(n){t=t.concat(n.getCells())})),t},Grid.prototype.getRows=function(){var t=new Array;return this.tables.forEach((function(n){t=t.concat(n.getRows())})),t},Grid.prototype.getTables=function(){return this.tables},Grid.prototype.enable=function(){return s(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return t=[],this.tables.forEach((function(n){return t.push(n.enable())})),[4,Promise.all(t)];case 1:return n.sent(),[2]}}))}))},Grid.prototype.disable=function(){this.tables.forEach((function(t){return t.disable()}))},Object.defineProperty(Grid.prototype,"wireframe",{set:function(t){this._wireframe=t,this.tables.forEach((function(n){n.wireframe=t}))},enumerable:!1,configurable:!0}),Grid.prototype.RecheckProp=function(){this.tables.forEach((function(t){return t.RecheckProp()}))},Grid}(_.GridBaseElement);n.Grid=M},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Table=void 0;var g=i(0),_=i(197),S=i(153),M=function(t){function Table(n,i,o,a,s,m,_){void 0===m&&(m=.05),void 0===_&&(_=new g.Vector2(.5,.5));var S=t.call(this,n,a,s)||this;return S.rows=new Array,S.colSize=i,S.rowSize=o,S.padding=m,S.margin=_,S}return a(Table,t),Table.prototype.init=function(){this.geometry=new g.BoxGeometry(this.cellSize.x*this.colSize,this.cellSize.y*this.rowSize,this.cellSize.z),this.obj=new g.Mesh(this.geometry,this.material),this.obj.name="table",this.obj.position.set(this.initialPosition.x,this.initialPosition.y,this.initialPosition.z),this.parent instanceof S.GridBaseElement?this.parent.obj.add(this.obj):this.parent.add(this.obj);for(var t=this.cellSize.y*this.rowSize/2+this.cellSize.y/2,n=0;n<this.rowSize;n++){var i=new g.Vector3(0,t,0),o=new _.Row(this,this.colSize,i,this.cellSize,this.padding,this.margin);o.init(),t-=this.cellSize.y+this.margin.y,this.rows.push(o)}this.RecheckProp()},Table.prototype.getCells=function(){var t=new Array;return this.rows.forEach((function(n){t=t.concat(n.getCells())})),t},Table.prototype.getRows=function(){return this.rows},Table.prototype.enable=function(){return s(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return t=[],this.rows.forEach((function(n){return t.push(n.enable())})),[4,Promise.all(t)];case 1:return n.sent(),[2]}}))}))},Table.prototype.disable=function(){this.rows.forEach((function(t){return t.disable()}))},Object.defineProperty(Table.prototype,"wireframe",{set:function(t){this._wireframe=t,this.rows.forEach((function(n){n.wireframe=t}))},enumerable:!1,configurable:!0}),Table.prototype.RecheckProp=function(){this.rows.forEach((function(t){t.RecheckProp()}))},Table}(S.GridBaseElement);n.Table=M},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HotspotVideo=n.HotspotTeleport=n.HotspotNavigation=n.HotspotImage=n.HotspotGeneric=void 0;var o=i(129);n.HotspotGeneric=o;var a=i(518);Object.defineProperty(n,"HotspotImage",{enumerable:!0,get:function(){return a.HotspotImage}});var s=i(519);Object.defineProperty(n,"HotspotNavigation",{enumerable:!0,get:function(){return s.HotspotNavigation}});var m=i(520);Object.defineProperty(n,"HotspotTeleport",{enumerable:!0,get:function(){return m.HotspotTeleport}});var g=i(521);Object.defineProperty(n,"HotspotVideo",{enumerable:!0,get:function(){return g.HotspotVideo}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenTeleport=void 0;var g=i(101),_=i(17),S=i(0),M=i(22),T=function(t){function ScreenTeleport(){return null!==t&&t.apply(this,arguments)||this}return a(ScreenTeleport,t),ScreenTeleport.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),this.duration=this.getMetadata().camera_movement_duration||.5,[2]}}))}))},ScreenTeleport.prototype.activateElement=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.activateElement.call(this,n)];case 1:return i.sent(),[4,n.activateTeleportAnimation(n.duration)];case 2:return i.sent(),[2]}}))}))},ScreenTeleport.prototype.activateTeleportAnimation=function(t){return s(this,void 0,void 0,(function(){var n,i,o,a,s,g,T,O,A,P,L;return m(this,(function(m){switch(m.label){case 0:return n=this.getMetadata().position.clone(),i=this.getCustomAttribute(M.CustomAttributes.TeleportOffset),o=this.appManager.cameraControlsRegistry,i?(a=new S.Vector3(+(i.x||0),+(i.y||0),+(i.z||0)),n.add(a)):this.appManager.currentExperience.currentZone.getCustomAttribute(M.CustomAttributes.UserHeight)&&n.setY(n.y+this.appManager.currentExperience.currentZone.getCustomAttribute(M.CustomAttributes.UserHeight)),s=this.getMetadata().camera_look_at,(g=_.Utils.getItemById(this.appManager,s))?[3,2]:[4,o.cameraControls.animateCamera(n,void 0,!1,t)];case 1:return m.sent(),[2];case 2:if(T=_.Utils.SetBoxFromObj(new S.Box3,g.obj),O=new S.Vector3,T.getCenter(O),A=this.getCustomAttribute("$$look_at_adjustment"))switch(A){case"top":P=T.max.y,O.setY(P);break;case"bottom":L=T.min.y,O.setY(L)}return[4,o.cameraControls.animateCamera(n,O,!1,t)];case 3:return m.sent(),[2]}}))}))},ScreenTeleport}(g.ScreenImpl);n.ScreenTeleport=T},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TargetLightElementImpl=n.SpotLight=n.PointLight=n.LightElementImpl=n.HemisphericLight=n.DirectionalLight=void 0;var o=i(522);Object.defineProperty(n,"DirectionalLight",{enumerable:!0,get:function(){return o.DirectionalLight}});var a=i(523);Object.defineProperty(n,"HemisphericLight",{enumerable:!0,get:function(){return a.HemisphericLight}});var s=i(157);Object.defineProperty(n,"LightElementImpl",{enumerable:!0,get:function(){return s.LightElementImpl}});var m=i(524);Object.defineProperty(n,"PointLight",{enumerable:!0,get:function(){return m.PointLight}});var g=i(525);Object.defineProperty(n,"SpotLight",{enumerable:!0,get:function(){return g.SpotLight}});var _=i(202);Object.defineProperty(n,"TargetLightElementImpl",{enumerable:!0,get:function(){return _.TargetLightElementImpl}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.MeshNavigationScreen=n.MeshVideoScreen=n.MeshImageScreen=void 0;var g=i(0),_=i(85),S=i(201),M=i(200),T=function(t){function MeshImageScreen(n,i,o,a){var s=t.call(this,i,o,a)||this;return s.obj=n,s.geometry=s.obj.geometry,s.obj.material=s.obj.material.clone(),s.material=s.obj.material,s}return a(MeshImageScreen,t),MeshImageScreen.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},MeshImageScreen.prototype.touch=function(){},MeshImageScreen.prototype.activateElement=function(t,n){return s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},MeshImageScreen.prototype.loadImage=function(n,i,o){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.loadImage.call(this,n,!0,o)];case 1:return[2,i.sent()]}}))}))},MeshImageScreen}(_.ScreenImage);n.MeshImageScreen=T;var O=function(t){function MeshVideoScreen(n,i,o,a){var s=t.call(this,i,o,a)||this;return s.material=new g.MeshStandardMaterial({transparent:!0,alphaTest:0}),s.obj=n,s.geometry=s.obj.geometry,s.obj.material=s.material,s}return a(MeshVideoScreen,t),MeshVideoScreen.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),this.getMetadata().auto_play&&this.activateElement(this),[2]}}))}))},MeshVideoScreen.prototype.activateElement=function(n,i){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.activateElement.call(this,n,!0)];case 1:return i.sent(),[2]}}))}))},MeshVideoScreen.prototype.initVideo=function(n){t.prototype.initVideo.call(this,!0)},MeshVideoScreen.prototype.OnVideoEnded=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(n){return t.prototype.OnVideoEnded.call(this,!0),[2]}))}))},MeshVideoScreen.prototype.applyAnimateScreenToFov=function(){return s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},MeshVideoScreen}(S.ScreenVideo);n.MeshVideoScreen=O;var A=function(t){function MeshNavigationScreen(n,i,o,a){var s=t.call(this,i,o,a)||this;return s.material=new g.MeshStandardMaterial({transparent:!0,alphaTest:0}),s.obj=n,s.geometry=s.obj.geometry,s.obj.material=s.material,s}return a(MeshNavigationScreen,t),MeshNavigationScreen.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},MeshNavigationScreen}(M.ScreenNavigation);n.MeshNavigationScreen=A},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ObJModel=void 0;var g=i(0),_=i(71),S=i(143),M=i(18),T=i(149),O=i(312),A=i(34),P=i(46),L=i(17),R=i(10),N=i(289),I=i(22),j=i(262),V=function(t){function ObJModel(n,i,o){var a=t.call(this,n,i,o)||this;return a.childElements=new Array,a.meshes=new Array,a.opacityMap=new Map,a.tranperantMap=new Map,a.rotationEffects=[],a.modelBaseDir=S.v1()+"/",a}return a(ObJModel,t),ObJModel.prototype.init=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return[4,this.loadModel()];case 1:return i.sent(),[4,t.prototype.init.call(this)];case 2:return i.sent(),this.registerEvents(),(n=this.getCustomAttribute(I.CustomAttributes.LOD))&&(this.lodManager=new N.LodManager(n,this)),[2]}}))}))},ObJModel.prototype.loadModel=function(){return s(this,void 0,void 0,(function(){var t,n,i,o,a,s=this;return m(this,(function(m){switch(m.label){case 0:return t=this.getMetadata().source,[4,T.ModelsUtils.LoadModelFromUrl(this.appManager,t,this.modelBaseDir)];case 1:return n=m.sent(),i=n.obj,o=n.animationMixer,this.obj=i,o&&(this.animationMixer=o,this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this)),this.getCustomAttribute(I.CustomAttributes.CenterPivot)&&this.setCenterPivot(),this.registerModel(),[4,this.setVisible(!1)];case 2:return m.sent(),a=[],this.getMetadata().data&&this.getMetadata().data.forEach((function(t){a.push(s.initScreen(t))})),[4,Promise.all(a)];case 3:return m.sent(),[2]}}))}))},ObJModel.prototype.setCenterPivot=function(){var t=this.obj,n=new g.Group;n.name="center_pivot_obj";var i=new g.Group;i.name="new_obj_parent",this.parent.obj.add(i),i.add(n),n.add(this.obj),this.obj=i;var o=L.Utils.SetBoxFromObj(new g.Box3,this.obj),a=new g.Vector3;a=o.getCenter(a),a=t.worldToLocal(a),n.position.set(-a.x,-a.y,-a.z)},ObJModel.prototype.registerModel=function(){this.registerMeshes(),this.registerMaterials()},ObJModel.prototype.registerMeshes=function(){var t=this;this.meshes=new Array,this.obj.traverse((function(n){var i,o;n instanceof g.Mesh&&(t.meshes.push(n),n.castShadow=null===(i=t.metadata)||void 0===i?void 0:i.is_cast_shadow,n.receiveShadow=null===(o=t.metadata)||void 0===o?void 0:o.is_receive_shadow)}))},ObJModel.prototype.registerMaterials=function(){var t=this;this.opacityMap.clear(),this.tranperantMap.clear();var n=this.getCustomAttribute("$$set_double_sided_material"),i=this.getCustomAttribute("$$metalness"),o=this.getCustomAttribute("$$roughness");this.meshes.forEach((function(a){(Array.isArray(a.material)?a.material:[a.material]).forEach((function(a){if(a instanceof g.Material){t.opacityMap.set(a,a.opacity),t.tranperantMap.set(a,!!a.transparent),n&&(a.side=g.DoubleSide);try{(i||0===i)&&(a.metalness=i),(o||0===o)&&(a.roughness=o)}catch(t){}}}))}))},ObJModel.prototype.registerEvents=function(){var t=this,n=this.appManager.eventManager.pipe(M.filter((function(n){return(n.origin===t||t.childElements.includes(n.origin))&&(n.eventType.name===(new R.FocusEvent).name||n.eventType===R.FocusEvent)}))).subscribe((function(n){t.onHover()})),i=this.appManager.eventManager.pipe(M.filter((function(n){return(n.origin===t||t.childElements.includes(n.origin))&&(n.eventType.name===(new R.UnfocusEvent).name||n.eventType===R.UnfocusEvent)}))).subscribe((function(n){t.onUnHover()})),o=this,a=this.appManager.eventManager.pipe(M.filter((function(n){return(n.eventType.name===(new R.TouchEvent).name||n.eventType===R.TouchEvent)&&n.origin===t}))).subscribe((function(n){var i;n.message&&n.message.Mesh&&(i=t.getChildScreen(n.message.Mesh)),i?(i instanceof O.MeshImageScreen||i instanceof O.MeshVideoScreen||i instanceof O.MeshNavigationScreen)&&i.activateElement(i):t.activateElement(o)}));this.subscriptions.push(a),this.subscriptions.push(i),this.subscriptions.push(n)},ObJModel.prototype.getChildScreen=function(t){var n=this.childElements.filter((function(n){return n.obj===t}));if(n&&n.length)return n[0]},ObJModel.prototype.initScreen=function(t){return s(this,void 0,void 0,(function(){var n=this;return m(this,(function(i){return[2,new Promise((function(i,o){n.obj.traverse((function(a){if(t.position=a.position.clone(),t.rotation=a.rotation.clone(),t.scale=a.scale.clone(),a instanceof g.Mesh&&a.name===t.mesh){var s;switch(t.type){case"photo":s=new O.MeshImageScreen(a,t,n);break;case"video":s=new O.MeshVideoScreen(a,t,n);break;case"navigation":s=new O.MeshNavigationScreen(a,t,n);break;default:s=new O.MeshImageScreen(a,t,n)}n.childElements.push(s),s.init().then((function(){i()})).catch((function(t){o(t)}))}}))}))]}))}))},ObJModel.prototype.setEnabled=function(t){var n=this;this.childElements.forEach((function(n){n.setEnabled(t)})),this.meshes.forEach((function(i){t?n.appManager.currentExperience.userInteractionControlsRegistry.AddObject(i,n):n.appManager.currentExperience.userInteractionControlsRegistry.RemoveObject(i)})),this.enabled=t},ObJModel.prototype.setAlpha=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i,o=this;return m(this,(function(a){switch(a.label){case 0:return this.obj.visible=!0,i=[],this.meshes.forEach((function(a){a.visible=!0,(Array.isArray(a.material)?a.material:[a.material]).forEach((function(a){a.transparent=!0;var s=t;if(o.opacityMap.has(a)){var m=o.opacityMap.get(a);m<t&&(s=m)}i.push(L.Utils.setAlpha(a,s,n))}))})),[4,Promise.all(i)];case 1:return a.sent(),this.meshes.forEach((function(n){n.visible=t>0})),this.obj.visible=t>0,this.meshes.forEach((function(t){o.isScreenChildMesh(t)||(Array.isArray(t.material)?t.material:[t.material]).forEach((function(t){t.transparent=o.tranperantMap.get(t)||!1}))})),this.appManager.eventManager.next(new A.EventMessage(self,new R.PropertieChangedEvent,"opacity")),[2]}}))}))},ObJModel.prototype.isScreenChildMesh=function(t){return this.childElements.some((function(n){return n.obj===t}))},ObJModel.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i;return m(this,(function(o){switch(o.label){case 0:return i=0,t&&(i=1),this.visible=t,this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this),[4,this.setAlpha(i,n)];case 1:return o.sent(),this.animationMixer||this.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(this),[2]}}))}))},ObJModel.prototype.onHover=function(){var t=this.getMetadata().on_hover;if(t&&t.type&&"string"!=typeof t.value)switch(t.type){case"rotation":this.startRotationEffect(t.value)}},ObJModel.prototype.onUnHover=function(){var t=this.getMetadata().on_hover;if(t&&t.type&&"string"!=typeof t.value)switch(t.type){case"rotation":this.stopRotationEffect()}},ObJModel.prototype.startRotationEffect=function(t){var n=this,i=new _.Tween({value:this.obj.rotation.x}),o={value:this.obj.rotation.x+Math.PI},a=this;if(t.x&&(this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this),i.to(o,1e3*t.x).onUpdate((function(t){a.obj.rotation.x=t.value})).start().onComplete((function(){n.animationMixer||n.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(n);var t=a.rotationEffects.indexOf(i);t>-1&&a.rotationEffects.splice(t)})),this.rotationEffects.push(i)),t.y){var s=new _.Tween({value:this.obj.rotation.y}),m={value:this.obj.rotation.y+Math.PI};this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this),s.to(m,1e3*t.y).onUpdate((function(t){a.obj.rotation.y=t.value})).start().onComplete((function(){n.animationMixer||n.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(n);var t=a.rotationEffects.indexOf(s);t>-1&&a.rotationEffects.splice(t)})),this.rotationEffects.push(s)}if(t.z){var g=new _.Tween({value:this.obj.rotation.z}),S={value:this.obj.rotation.z+Math.PI};this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this),g.to(S,1e3*t.z).onUpdate((function(t){a.obj.rotation.z=t.value})).start().onComplete((function(){n.animationMixer||n.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(n);var t=a.rotationEffects.indexOf(g);t>-1&&a.rotationEffects.splice(t)})),this.rotationEffects.push(g)}},ObJModel.prototype.stopRotationEffect=function(){var t=this;this.rotationEffects.forEach((function(n){t.animationMixer||t.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(t),n.stop()})),this.rotationEffects=[]},ObJModel.prototype.getMetadata=function(){return this.metadata},ObJModel.prototype.destroy=function(){this.appManager.animationManager.removeMixer(this.obj),this.animationMixer=void 0,this.lodManager&&(this.lodManager.destroy(),this.loadModel=void 0),this.opacityMap.clear(),this.opacityMap=void 0,t.prototype.destroy.call(this),this.meshes=void 0},ObJModel.prototype.changeLod=function(t){return s(this,void 0,void 0,(function(){var n,i,o=this;return m(this,(function(a){switch(a.label){case 0:return n=t.url,[4,T.ModelsUtils.LoadModelFromUrl(this.appManager,n,this.modelBaseDir)];case 1:return i=a.sent(),this.lodManager.currentLodOption!==t||i.obj.traverse((function(t){t instanceof g.Mesh&&t.name&&o.changeMeshByName(t.name,o.obj,t.geometry,t.material)})),[2]}}))}))},ObJModel.prototype.changeMeshByName=function(t,n,i,o){n.traverse((function(n){n.name===t&&n instanceof g.Mesh&&(n.geometry=i,n.material instanceof g.Material&&o instanceof g.Material&&(j.MaterialUtils.ChangeMaterialMaps(n.material,o),n.material.needsUpdate=!0))}))},ObJModel}(P.ByondInteractiveElement);n.ObJModel=V},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneLight=void 0;var g=i(0),_=function(t){function ZoneLight(n,i,o){return t.call(this,n,i,o)||this}return a(ZoneLight,t),ZoneLight.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o;return m(this,(function(a){switch(a.label){case 0:return this.appManager.currentExperience.ambientLight.visible=!1,n=this.getMetadata(),i=n.color,o=n.intensity,this.obj=new g.AmbientLight(i,o),[4,t.prototype.init.call(this)];case 1:return a.sent(),[2]}}))}))},ZoneLight.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},ZoneLight.prototype.getMetadata=function(){return this.metadata},ZoneLight.prototype.destroy=function(){t.prototype.destroy.call(this),this.appManager.currentExperience.ambientLight.visible=!0},ZoneLight}(i(100).ByondBaseElement);n.ZoneLight=_},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneMetadata=n.ObjModelMetadata=n.MeshScreenMetadata=void 0;var m=i(36),g=i(32),_=function(t){function MeshScreenMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(MeshScreenMetadata,t),Object.defineProperty(MeshScreenMetadata.prototype,"ElementName",{get:function(){return"meshScreen"},enumerable:!1,configurable:!0}),MeshScreenMetadata}(i(102).ScreenMetadata);n.MeshScreenMetadata=_;var S=function(t){function ObjModelMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ObjModelMetadata,t),Object.defineProperty(ObjModelMetadata.prototype,"ElementName",{get:function(){return"objModel"},enumerable:!1,configurable:!0}),s([m.Type((function(){return _}))],ObjModelMetadata.prototype,"data",void 0),ObjModelMetadata}(g.Metadata.Element3DMetadata);n.ObjModelMetadata=S;var M=function(t){function ZoneMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ZoneMetadata,t),s([m.Type((function(){return S}))],ZoneMetadata.prototype,"obj_models",void 0),ZoneMetadata}(g.Metadata.ZoneMetadata);n.ZoneMetadata=M,g.Metadata.ZoneMetadata=Object.assign(M,g.Metadata.ZoneMetadata)},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ChatMessage=n.Chat=void 0,i(572);var g=i(0),_=i(574),S=function(t){function Chat(n,i,o,a,s,m){void 0===a&&(a=!0),void 0===s&&(s=700),void 0===m&&(m=1400);var _=this;return n.scale=new g.Vector3(.01*n.scale.x,.01*n.scale.y,.01*n.scale.z),(_=t.call(this,n,i,o,!1,s,m)||this).messages=new Array,_}return a(Chat,t),Chat.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},Chat.prototype.addNewMessage=function(t,n){this.messages.unshift(n),this.updateTexture()},Chat.prototype.getTextureFromCanvas=function(){var t=this;this.clear();var n=0;this.messages.forEach((function(i){n+=t.writeMessageOnCanvas(i,n)+1})),(new Image).src=this.canvas.toDataURL("image/png");var i=new g.Texture(this.canvas);return i.needsUpdate=!0,i},Chat.prototype.writeMessageOnCanvas=function(t,n){var i=this,o=_((t.name?t.name+": ":"")+t.content,{width:60}).split(/\n/);switch(this.context.beginPath(),t.type){case"host":this.context.strokeStyle="#ededed",this.context.fillStyle="#e64b4b";break;case"notification":this.context.strokeStyle="#ededed",this.context.fillStyle="#4297cc";break;case"me":case"other":this.context.strokeStyle="#929292",this.context.fillStyle="#ededed";break;default:this.context.fillStyle="#ededed",this.context.strokeStyle="#929292"}var a=o.length,s=35*a,m=this.height-35*n-s,g=s;return this.context.rect(0,m,this.width,g),this.context.fill(),this.context.lineWidth=3,this.context.strokeRect(0,m,this.width,g),o.forEach((function(n,o){switch(i.context.beginPath(),i.context.font="24px "+(i.chatFontCanvasStyle||"sans-serif"),t.type){case"host":case"notification":i.context.fillStyle="#ededed";break;default:i.context.fillStyle="#2e2a30"}i.context.textAlign="left",i.context.textBaseline="middle",i.context.fillText(n,0,m+35*(o+.5))})),a},Chat}(i(293).CanvasInteractiveElement);n.Chat=S;n.ChatMessage=function ChatMessage(){}},function(t,n,i){(function(t,n){var i;!function(i){!function(o){var a="object"==typeof n?n:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),s=makeExporter(i);function makeExporter(t,n){return function(i,o){"function"!=typeof t[i]&&Object.defineProperty(t,i,{configurable:!0,writable:!0,value:o}),n&&n(i,o)}}void 0===a.Reflect?a.Reflect=i:s=makeExporter(a.Reflect,s),function(n){var i=Object.prototype.hasOwnProperty,o="function"==typeof Symbol,a=o&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=o&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",m="function"==typeof Object.create,g={__proto__:[]}instanceof Array,_=!m&&!g,S={create:m?function(){return MakeDictionary(Object.create(null))}:g?function(){return MakeDictionary({__proto__:null})}:function(){return MakeDictionary({})},has:_?function(t,n){return i.call(t,n)}:function(t,n){return n in t},get:_?function(t,n){return i.call(t,n)?t[n]:void 0}:function(t,n){return t[n]}},M=Object.getPrototypeOf(Function),T="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,O=T||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function CreateMapPolyfill(){var t={},n=[],i=function(){function MapIterator(t,n,i){this._index=0,this._keys=t,this._values=n,this._selector=i}return MapIterator.prototype["@@iterator"]=function(){return this},MapIterator.prototype[s]=function(){return this},MapIterator.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var i=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=n,this._values=n):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},MapIterator.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=n,this._values=n),t},MapIterator.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=n,this._values=n),{value:t,done:!0}},MapIterator}();return function(){function Map(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(Map.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Map.prototype.has=function(t){return this._find(t,!1)>=0},Map.prototype.get=function(t){var n=this._find(t,!1);return n>=0?this._values[n]:void 0},Map.prototype.set=function(t,n){var i=this._find(t,!0);return this._values[i]=n,this},Map.prototype.delete=function(n){var i=this._find(n,!1);if(i>=0){for(var o=this._keys.length,a=i+1;a<o;a++)this._keys[a-1]=this._keys[a],this._values[a-1]=this._values[a];return this._keys.length--,this._values.length--,n===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},Map.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},Map.prototype.keys=function(){return new i(this._keys,this._values,getKey)},Map.prototype.values=function(){return new i(this._keys,this._values,getValue)},Map.prototype.entries=function(){return new i(this._keys,this._values,getEntry)},Map.prototype["@@iterator"]=function(){return this.entries()},Map.prototype[s]=function(){return this.entries()},Map.prototype._find=function(t,n){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&n&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},Map}();function getKey(t,n){return t}function getValue(t,n){return n}function getEntry(t,n){return[t,n]}}():Map,A=T||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function CreateSetPolyfill(){return function(){function Set(){this._map=new O}return Object.defineProperty(Set.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Set.prototype.has=function(t){return this._map.has(t)},Set.prototype.add=function(t){return this._map.set(t,t),this},Set.prototype.delete=function(t){return this._map.delete(t)},Set.prototype.clear=function(){this._map.clear()},Set.prototype.keys=function(){return this._map.keys()},Set.prototype.values=function(){return this._map.values()},Set.prototype.entries=function(){return this._map.entries()},Set.prototype["@@iterator"]=function(){return this.keys()},Set.prototype[s]=function(){return this.keys()},Set}()}():Set,P=new(T||"function"!=typeof WeakMap?function CreateWeakMapPolyfill(){var t=S.create(),n=CreateUniqueKey();return function(){function WeakMap(){this._key=CreateUniqueKey()}return WeakMap.prototype.has=function(t){var n=GetOrCreateWeakMapTable(t,!1);return void 0!==n&&S.has(n,this._key)},WeakMap.prototype.get=function(t){var n=GetOrCreateWeakMapTable(t,!1);return void 0!==n?S.get(n,this._key):void 0},WeakMap.prototype.set=function(t,n){return GetOrCreateWeakMapTable(t,!0)[this._key]=n,this},WeakMap.prototype.delete=function(t){var n=GetOrCreateWeakMapTable(t,!1);return void 0!==n&&delete n[this._key]},WeakMap.prototype.clear=function(){this._key=CreateUniqueKey()},WeakMap}();function CreateUniqueKey(){var n;do{n="@@WeakMap@@"+CreateUUID()}while(S.has(t,n));return t[n]=!0,n}function GetOrCreateWeakMapTable(t,o){if(!i.call(t,n)){if(!o)return;Object.defineProperty(t,n,{value:S.create()})}return t[n]}function FillRandomBytes(t,n){for(var i=0;i<n;++i)t[i]=255*Math.random()|0;return t}function CreateUUID(){var t=function GenRandomBytes(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):FillRandomBytes(new Uint8Array(t),t):FillRandomBytes(new Array(t),t)}(16);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",i=0;i<16;++i){var o=t[i];4!==i&&6!==i&&8!==i||(n+="-"),o<16&&(n+="0"),n+=o.toString(16).toLowerCase()}return n}}():WeakMap);function GetOrCreateMetadataMap(t,n,i){var o=P.get(t);if(IsUndefined(o)){if(!i)return;o=new O,P.set(t,o)}var a=o.get(n);if(IsUndefined(a)){if(!i)return;a=new O,o.set(n,a)}return a}function OrdinaryHasOwnMetadata(t,n,i){var o=GetOrCreateMetadataMap(n,i,!1);return!IsUndefined(o)&&function ToBoolean(t){return!!t}(o.has(t))}function OrdinaryGetOwnMetadata(t,n,i){var o=GetOrCreateMetadataMap(n,i,!1);if(!IsUndefined(o))return o.get(t)}function OrdinaryDefineOwnMetadata(t,n,i,o){GetOrCreateMetadataMap(i,o,!0).set(t,n)}function OrdinaryOwnMetadataKeys(t,n){var i=[],o=GetOrCreateMetadataMap(t,n,!1);if(IsUndefined(o))return i;for(var a=function GetIterator(t){var n=GetMethod(t,s);if(!IsCallable(n))throw new TypeError;var i=n.call(t);if(!IsObject(i))throw new TypeError;return i}(o.keys()),m=0;;){var g=IteratorStep(a);if(!g)return i.length=m,i;var _=g.value;try{i[m]=_}catch(t){try{IteratorClose(a)}finally{throw t}}m++}}function Type(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function IsUndefined(t){return void 0===t}function IsNull(t){return null===t}function IsObject(t){return"object"==typeof t?null!==t:"function"==typeof t}function ToPropertyKey(t){var n=function ToPrimitive(t,n){switch(Type(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var i=3===n?"string":5===n?"number":"default",o=GetMethod(t,a);if(void 0!==o){var s=o.call(t,i);if(IsObject(s))throw new TypeError;return s}return function OrdinaryToPrimitive(t,n){if("string"===n){var i=t.toString;if(IsCallable(i)&&!IsObject(a=i.call(t)))return a;if(IsCallable(o=t.valueOf)&&!IsObject(a=o.call(t)))return a}else{var o;if(IsCallable(o=t.valueOf)&&!IsObject(a=o.call(t)))return a;var a,s=t.toString;if(IsCallable(s)&&!IsObject(a=s.call(t)))return a}throw new TypeError}(t,"default"===i?"number":i)}(t,3);return function IsSymbol(t){return"symbol"==typeof t}(n)?n:function ToString(t){return""+t}(n)}function IsArray(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function IsCallable(t){return"function"==typeof t}function IsConstructor(t){return"function"==typeof t}function GetMethod(t,n){var i=t[n];if(null!=i){if(!IsCallable(i))throw new TypeError;return i}}function IteratorStep(t){var n=t.next();return!n.done&&n}function IteratorClose(t){var n=t.return;n&&n.call(t)}function OrdinaryGetPrototypeOf(t){var n=Object.getPrototypeOf(t);if("function"!=typeof t||t===M)return n;if(n!==M)return n;var i=t.prototype,o=i&&Object.getPrototypeOf(i);if(null==o||o===Object.prototype)return n;var a=o.constructor;return"function"!=typeof a||a===t?n:a}function MakeDictionary(t){return t.__=void 0,delete t.__,t}n("decorate",(function decorate(t,n,i,o){if(IsUndefined(i)){if(!IsArray(t))throw new TypeError;if(!IsConstructor(n))throw new TypeError;return function DecorateConstructor(t,n){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(n);if(!IsUndefined(o)&&!IsNull(o)){if(!IsConstructor(o))throw new TypeError;n=o}}return n}(t,n)}if(!IsArray(t))throw new TypeError;if(!IsObject(n))throw new TypeError;if(!IsObject(o)&&!IsUndefined(o)&&!IsNull(o))throw new TypeError;return IsNull(o)&&(o=void 0),function DecorateProperty(t,n,i,o){for(var a=t.length-1;a>=0;--a){var s=(0,t[a])(n,i,o);if(!IsUndefined(s)&&!IsNull(s)){if(!IsObject(s))throw new TypeError;o=s}}return o}(t,n,i=ToPropertyKey(i),o)})),n("metadata",(function metadata(t,n){return function decorator(i,o){if(!IsObject(i))throw new TypeError;if(!IsUndefined(o)&&!function IsPropertyKey(t){switch(Type(t)){case 3:case 4:return!0;default:return!1}}(o))throw new TypeError;OrdinaryDefineOwnMetadata(t,n,i,o)}})),n("defineMetadata",(function defineMetadata(t,n,i,o){if(!IsObject(i))throw new TypeError;return IsUndefined(o)||(o=ToPropertyKey(o)),OrdinaryDefineOwnMetadata(t,n,i,o)})),n("hasMetadata",(function hasMetadata(t,n,i){if(!IsObject(n))throw new TypeError;return IsUndefined(i)||(i=ToPropertyKey(i)),function OrdinaryHasMetadata(t,n,i){if(OrdinaryHasOwnMetadata(t,n,i))return!0;var o=OrdinaryGetPrototypeOf(n);return!IsNull(o)&&OrdinaryHasMetadata(t,o,i)}(t,n,i)})),n("hasOwnMetadata",(function hasOwnMetadata(t,n,i){if(!IsObject(n))throw new TypeError;return IsUndefined(i)||(i=ToPropertyKey(i)),OrdinaryHasOwnMetadata(t,n,i)})),n("getMetadata",(function getMetadata(t,n,i){if(!IsObject(n))throw new TypeError;return IsUndefined(i)||(i=ToPropertyKey(i)),function OrdinaryGetMetadata(t,n,i){if(OrdinaryHasOwnMetadata(t,n,i))return OrdinaryGetOwnMetadata(t,n,i);var o=OrdinaryGetPrototypeOf(n);return IsNull(o)?void 0:OrdinaryGetMetadata(t,o,i)}(t,n,i)})),n("getOwnMetadata",(function getOwnMetadata(t,n,i){if(!IsObject(n))throw new TypeError;return IsUndefined(i)||(i=ToPropertyKey(i)),OrdinaryGetOwnMetadata(t,n,i)})),n("getMetadataKeys",(function getMetadataKeys(t,n){if(!IsObject(t))throw new TypeError;return IsUndefined(n)||(n=ToPropertyKey(n)),function OrdinaryMetadataKeys(t,n){var i=OrdinaryOwnMetadataKeys(t,n),o=OrdinaryGetPrototypeOf(t);if(null===o)return i;var a=OrdinaryMetadataKeys(o,n);if(a.length<=0)return i;if(i.length<=0)return a;for(var s=new A,m=[],g=0,_=i;g<_.length;g++){var S=_[g];s.has(S)||(s.add(S),m.push(S))}for(var M=0,T=a;M<T.length;M++)S=T[M],s.has(S)||(s.add(S),m.push(S));return m}(t,n)})),n("getOwnMetadataKeys",(function getOwnMetadataKeys(t,n){if(!IsObject(t))throw new TypeError;return IsUndefined(n)||(n=ToPropertyKey(n)),OrdinaryOwnMetadataKeys(t,n)})),n("deleteMetadata",(function deleteMetadata(t,n,i){if(!IsObject(n))throw new TypeError;IsUndefined(i)||(i=ToPropertyKey(i));var o=GetOrCreateMetadataMap(n,i,!1);if(IsUndefined(o))return!1;if(!o.delete(t))return!1;if(o.size>0)return!0;var a=P.get(n);return a.delete(i),a.size>0||P.delete(n),!0}))}(s)}()}(i||(i={}))}).call(this,i(25),i(33))},function(t,n,i){"use strict";n.byteLength=function byteLength(t){var n=getLens(t),i=n[0],o=n[1];return 3*(i+o)/4-o},n.toByteArray=function toByteArray(t){var n,i,o=getLens(t),m=o[0],g=o[1],_=new s(function _byteLength(t,n,i){return 3*(n+i)/4-i}(0,m,g)),S=0,M=g>0?m-4:m;for(i=0;i<M;i+=4)n=a[t.charCodeAt(i)]<<18|a[t.charCodeAt(i+1)]<<12|a[t.charCodeAt(i+2)]<<6|a[t.charCodeAt(i+3)],_[S++]=n>>16&255,_[S++]=n>>8&255,_[S++]=255&n;return 2===g&&(n=a[t.charCodeAt(i)]<<2|a[t.charCodeAt(i+1)]>>4,_[S++]=255&n),1===g&&(n=a[t.charCodeAt(i)]<<10|a[t.charCodeAt(i+1)]<<4|a[t.charCodeAt(i+2)]>>2,_[S++]=n>>8&255,_[S++]=255&n),_},n.fromByteArray=function fromByteArray(t){for(var n,i=t.length,a=i%3,s=[],m=0,g=i-a;m<g;m+=16383)s.push(encodeChunk(t,m,m+16383>g?g:m+16383));return 1===a?(n=t[i-1],s.push(o[n>>2]+o[n<<4&63]+"==")):2===a&&(n=(t[i-2]<<8)+t[i-1],s.push(o[n>>10]+o[n>>4&63]+o[n<<2&63]+"=")),s.join("")};for(var o=[],a=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,_=m.length;g<_;++g)o[g]=m[g],a[m.charCodeAt(g)]=g;function getLens(t){var n=t.length;if(n%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=n),[i,i===n?0:4-i%4]}function encodeChunk(t,n,i){for(var a,s,m=[],g=n;g<i;g+=3)a=(t[g]<<16&16711680)+(t[g+1]<<8&65280)+(255&t[g+2]),m.push(o[(s=a)>>18&63]+o[s>>12&63]+o[s>>6&63]+o[63&s]);return m.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},function(t,n){n.read=function(t,n,i,o,a){var s,m,g=8*a-o-1,_=(1<<g)-1,S=_>>1,M=-7,T=i?a-1:0,O=i?-1:1,A=t[n+T];for(T+=O,s=A&(1<<-M)-1,A>>=-M,M+=g;M>0;s=256*s+t[n+T],T+=O,M-=8);for(m=s&(1<<-M)-1,s>>=-M,M+=o;M>0;m=256*m+t[n+T],T+=O,M-=8);if(0===s)s=1-S;else{if(s===_)return m?NaN:1/0*(A?-1:1);m+=Math.pow(2,o),s-=S}return(A?-1:1)*m*Math.pow(2,s-o)},n.write=function(t,n,i,o,a,s){var m,g,_,S=8*s-a-1,M=(1<<S)-1,T=M>>1,O=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,A=o?0:s-1,P=o?1:-1,L=n<0||0===n&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(g=isNaN(n)?1:0,m=M):(m=Math.floor(Math.log(n)/Math.LN2),n*(_=Math.pow(2,-m))<1&&(m--,_*=2),(n+=m+T>=1?O/_:O*Math.pow(2,1-T))*_>=2&&(m++,_/=2),m+T>=M?(g=0,m=M):m+T>=1?(g=(n*_-1)*Math.pow(2,a),m+=T):(g=n*Math.pow(2,T-1)*Math.pow(2,a),m=0));a>=8;t[i+A]=255&g,A+=P,g/=256,a-=8);for(m=m<<a|g,S+=a;S>0;t[i+A]=255&m,A+=P,m/=256,S-=8);t[i+A-P]|=128*L}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(206),a=function(){function MetadataStorage(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return MetadataStorage.prototype.addTypeMetadata=function(t){this._typeMetadatas.has(t.target)||this._typeMetadatas.set(t.target,new Map),this._typeMetadatas.get(t.target).set(t.propertyName,t)},MetadataStorage.prototype.addTransformMetadata=function(t){this._transformMetadatas.has(t.target)||this._transformMetadatas.set(t.target,new Map),this._transformMetadatas.get(t.target).has(t.propertyName)||this._transformMetadatas.get(t.target).set(t.propertyName,[]),this._transformMetadatas.get(t.target).get(t.propertyName).push(t)},MetadataStorage.prototype.addExposeMetadata=function(t){this._exposeMetadatas.has(t.target)||this._exposeMetadatas.set(t.target,new Map),this._exposeMetadatas.get(t.target).set(t.propertyName,t)},MetadataStorage.prototype.addExcludeMetadata=function(t){this._excludeMetadatas.has(t.target)||this._excludeMetadatas.set(t.target,new Map),this._excludeMetadatas.get(t.target).set(t.propertyName,t)},MetadataStorage.prototype.findTransformMetadatas=function(t,n,i){return this.findMetadatas(this._transformMetadatas,t,n).filter((function(t){return!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?i===o.TransformationType.CLASS_TO_CLASS||i===o.TransformationType.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||i===o.TransformationType.CLASS_TO_PLAIN)}))},MetadataStorage.prototype.findExcludeMetadata=function(t,n){return this.findMetadata(this._excludeMetadatas,t,n)},MetadataStorage.prototype.findExposeMetadata=function(t,n){return this.findMetadata(this._exposeMetadatas,t,n)},MetadataStorage.prototype.findExposeMetadataByCustomName=function(t,n){return this.getExposedMetadatas(t).find((function(t){return t.options&&t.options.name===n}))},MetadataStorage.prototype.findTypeMetadata=function(t,n){return this.findMetadata(this._typeMetadatas,t,n)},MetadataStorage.prototype.getStrategy=function(t){var n=this._excludeMetadatas.get(t),i=n&&n.get(void 0),o=this._exposeMetadatas.get(t),a=o&&o.get(void 0);return i&&a||!i&&!a?"none":i?"excludeAll":"exposeAll"},MetadataStorage.prototype.getExposedMetadatas=function(t){return this.getMetadata(this._exposeMetadatas,t)},MetadataStorage.prototype.getExcludedMetadatas=function(t){return this.getMetadata(this._excludeMetadatas,t)},MetadataStorage.prototype.getExposedProperties=function(t,n){return this.getExposedMetadatas(t).filter((function(t){return!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?n===o.TransformationType.CLASS_TO_CLASS||n===o.TransformationType.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||n===o.TransformationType.CLASS_TO_PLAIN)})).map((function(t){return t.propertyName}))},MetadataStorage.prototype.getExcludedProperties=function(t,n){return this.getExcludedMetadatas(t).filter((function(t){return!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?n===o.TransformationType.CLASS_TO_CLASS||n===o.TransformationType.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||n===o.TransformationType.CLASS_TO_PLAIN)})).map((function(t){return t.propertyName}))},MetadataStorage.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},MetadataStorage.prototype.getMetadata=function(t,n){var i,o=t.get(n);o&&(i=Array.from(o.values()).filter((function(t){return void 0!==t.propertyName})));for(var a=[],s=0,m=this.getAncestors(n);s<m.length;s++){var g=m[s],_=t.get(g);if(_){var S=Array.from(_.values()).filter((function(t){return void 0!==t.propertyName}));a.push.apply(a,S)}}return a.concat(i||[])},MetadataStorage.prototype.findMetadata=function(t,n,i){var o=t.get(n);if(o){var a=o.get(i);if(a)return a}for(var s=0,m=this.getAncestors(n);s<m.length;s++){var g=m[s],_=t.get(g);if(_){var S=_.get(i);if(S)return S}}},MetadataStorage.prototype.findMetadatas=function(t,n,i){var o,a=t.get(n);a&&(o=a.get(i));for(var s=[],m=0,g=this.getAncestors(n);m<g.length;m++){var _=g[m],S=t.get(_);S&&S.has(i)&&s.push.apply(s,S.get(i))}return s.reverse().concat((o||[]).reverse())},MetadataStorage.prototype.getAncestors=function(t){if(!t)return[];if(!this._ancestorsMap.has(t)){for(var n=[],i=Object.getPrototypeOf(t.prototype.constructor);void 0!==i.prototype;i=Object.getPrototypeOf(i.prototype.constructor))n.push(i);this._ancestorsMap.set(t,n)}return this._ancestorsMap.get(t)},MetadataStorage}();n.MetadataStorage=a},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(176),a=i(208),s=i(322),m=i(323),g=i(324),_=i(325);n.Transform=function Transform(t,n){return function(i,o){var s=new _.TransformMetadata(i.constructor,o,t,n);a.defaultMetadataStorage.addTransformMetadata(s)}},n.Type=function Type(t,n){return function(i,o){var m=Reflect.getMetadata("design:type",i,o),g=new s.TypeMetadata(i.constructor,o,m,t,n);a.defaultMetadataStorage.addTypeMetadata(g)}},n.Expose=function Expose(t){return function(n,i){var o=new m.ExposeMetadata(n instanceof Function?n:n.constructor,i,t||{});a.defaultMetadataStorage.addExposeMetadata(o)}},n.Exclude=function Exclude(t){return function(n,i){var o=new g.ExcludeMetadata(n instanceof Function?n:n.constructor,i,t||{});a.defaultMetadataStorage.addExcludeMetadata(o)}},n.TransformClassToPlain=function TransformClassToPlain(t){return function(n,i,a){var s=new o.ClassTransformer,m=a.value;a.value=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=m.apply(this,n),a=!!o&&("object"==typeof o||"function"==typeof o)&&"function"==typeof o.then;return a?o.then((function(n){return s.classToPlain(n,t)})):s.classToPlain(o,t)}}},n.TransformClassToClass=function TransformClassToClass(t){return function(n,i,a){var s=new o.ClassTransformer,m=a.value;a.value=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=m.apply(this,n),a=!!o&&("object"==typeof o||"function"==typeof o)&&"function"==typeof o.then;return a?o.then((function(n){return s.classToClass(n,t)})):s.classToClass(o,t)}}},n.TransformPlainToClass=function TransformPlainToClass(t,n){return function(i,a,s){var m=new o.ClassTransformer,g=s.value;s.value=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var a=g.apply(this,i),s=!!a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then;return s?a.then((function(i){return m.plainToClass(t,i,n)})):m.plainToClass(t,a,n)}}}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.TypeMetadata=function TypeMetadata(t,n,i,o,a){this.target=t,this.propertyName=n,this.reflectedType=i,this.typeFunction=o,this.options=a}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ExposeMetadata=function ExposeMetadata(t,n,i){this.target=t,this.propertyName=n,this.options=i}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ExcludeMetadata=function ExcludeMetadata(t,n,i){this.target=t,this.propertyName=n,this.options=i}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.TransformMetadata=function TransformMetadata(t,n,i,o){this.target=t,this.propertyName=n,this.transformFn=i,this.options=o}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VRControllerEventManager=n.MouseEventManager=n.UserInteractionControls=n.CameraControls=void 0;var o=i(327);n.CameraControls=o;var a=i(478);n.UserInteractionControls=a;var s=i(275);Object.defineProperty(n,"MouseEventManager",{enumerable:!0,get:function(){return s.MouseEventManager}});var m=i(276);Object.defineProperty(n,"VRControllerEventManager",{enumerable:!0,get:function(){return m.VRControllerEventManager}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VROrbitCameraControls=n.VRDollyCameraControls=n.VRCameraControls=n.TouchCameraControls=n.OrbitCameraControls=n.OrbitBasedCameraControls=n.DollyCameraControls=n.CameraControlsImpl=void 0;var o=i(136);n.CameraControlsImpl=o;var a=i(261);n.DollyCameraControls=a;var s=i(98);n.OrbitBasedCameraControls=s;var m=i(146);Object.defineProperty(n,"OrbitCameraControls",{enumerable:!0,get:function(){return m.OrbitCameraControls}});var g=i(186);Object.defineProperty(n,"TouchCameraControls",{enumerable:!0,get:function(){return g.TouchCameraControls}});var _=i(267);Object.defineProperty(n,"VRCameraControls",{enumerable:!0,get:function(){return _.VRCameraControls}});var S=i(192);Object.defineProperty(n,"VRDollyCameraControls",{enumerable:!0,get:function(){return S.VRDollyCameraControls}});var M=i(124);Object.defineProperty(n,"VROrbitCameraControls",{enumerable:!0,get:function(){return M.VROrbitCameraControls}})},function(t,n,i){"use strict";var o=i(209).forEach,a=i(329),s=i(330),m=i(331),g=i(332),_=i(333),S=i(210),M=i(334),T=i(336),O=i(337),A=i(338);function isCollection(t){return Array.isArray(t)||void 0!==t.length}function toArray(t){if(Array.isArray(t))return t;var n=[];return o(t,(function(t){n.push(t)})),n}function isElement(t){return t&&1===t.nodeType}function getOption(t,n,i){var o=t[n];return null==o&&void 0!==i?i:o}t.exports=function(t){var n;if((t=t||{}).idHandler)n={get:function(n){return t.idHandler.get(n,!0)},set:t.idHandler.set};else{var i=m(),P=g({idGenerator:i,stateHandler:T});n=P}var L=t.reporter;L||(L=_(!1===L));var R=getOption(t,"batchProcessor",M({reporter:L})),N={};N.callOnAdd=!!getOption(t,"callOnAdd",!0),N.debug=!!getOption(t,"debug",!1);var I,j=s(n),V=a({stateHandler:T}),U=getOption(t,"strategy","object"),G=getOption(t,"important",!1),z={reporter:L,batchProcessor:R,stateHandler:T,idHandler:n,important:G};if("scroll"===U&&(S.isLegacyOpera()?(L.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),U="object"):S.isIE(9)&&(L.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),U="object")),"scroll"===U)I=A(z);else{if("object"!==U)throw new Error("Invalid strategy name: "+U);I=O(z)}var H={};return{listenTo:function listenTo(t,i,a){function onResizeCallback(t){var n=j.get(t);o(n,(function callListenerProxy(n){n(t)}))}function addListener(t,n,i){j.add(n,i),t&&i(n)}if(a||(a=i,i=t,t={}),!i)throw new Error("At least one element required.");if(!a)throw new Error("Listener required.");if(isElement(i))i=[i];else{if(!isCollection(i))return L.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");i=toArray(i)}var s=0,m=getOption(t,"callOnAdd",N.callOnAdd),g=getOption(t,"onReady",(function noop(){})),_=getOption(t,"debug",N.debug);o(i,(function attachListenerToElement(t){T.getState(t)||(T.initState(t),n.set(t));var S=n.get(t);if(_&&L.log("Attaching listener to element",S,t),!V.isDetectable(t))return _&&L.log(S,"Not detectable."),V.isBusy(t)?(_&&L.log(S,"System busy making it detectable"),addListener(m,t,a),H[S]=H[S]||[],void H[S].push((function onReady(){++s===i.length&&g()}))):(_&&L.log(S,"Making detectable..."),V.markBusy(t,!0),I.makeDetectable({debug:_,important:G},t,(function onElementDetectable(t){if(_&&L.log(S,"onElementDetectable"),T.getState(t)){V.markAsDetectable(t),V.markBusy(t,!1),I.addListener(t,onResizeCallback),addListener(m,t,a);var n=T.getState(t);if(n&&n.startSize){var M=t.offsetWidth,O=t.offsetHeight;n.startSize.width===M&&n.startSize.height===O||onResizeCallback(t)}H[S]&&o(H[S],(function(t){t()}))}else _&&L.log(S,"Element uninstalled before being detectable.");delete H[S],++s===i.length&&g()})));_&&L.log(S,"Already detecable, adding listener."),addListener(m,t,a),s++})),s===i.length&&g()},removeListener:j.removeListener,removeAllListeners:j.removeAllListeners,uninstall:function uninstall(t){if(!t)return L.error("At least one element is required.");if(isElement(t))t=[t];else{if(!isCollection(t))return L.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");t=toArray(t)}o(t,(function(t){j.removeAllListeners(t),I.uninstall(t),T.cleanState(t)}))},initDocument:function initDocument(t){I.initDocument&&I.initDocument(t)}}}},function(t,n,i){"use strict";t.exports=function(t){var n=t.stateHandler.getState;return{isDetectable:function isDetectable(t){var i=n(t);return i&&!!i.isDetectable},markAsDetectable:function markAsDetectable(t){n(t).isDetectable=!0},isBusy:function isBusy(t){return!!n(t).busy},markBusy:function markBusy(t,i){n(t).busy=!!i}}}},function(t,n,i){"use strict";t.exports=function(t){var n={};function getListeners(i){var o=t.get(i);return void 0===o?[]:n[o]||[]}return{get:getListeners,add:function addListener(i,o){var a=t.get(i);n[a]||(n[a]=[]),n[a].push(o)},removeListener:function removeListener(t,n){for(var i=getListeners(t),o=0,a=i.length;o<a;++o)if(i[o]===n){i.splice(o,1);break}},removeAllListeners:function removeAllListeners(t){var n=getListeners(t);n&&(n.length=0)}}}},function(t,n,i){"use strict";t.exports=function(){var t=1;return{generate:function generate(){return t++}}}},function(t,n,i){"use strict";t.exports=function(t){var n=t.idGenerator,i=t.stateHandler.getState;return{get:function getId(t){var n=i(t);return n&&void 0!==n.id?n.id:null},set:function setId(t){var o=i(t);if(!o)throw new Error("setId required the element to have a resize detection state.");var a=n.generate();return o.id=a,a}}}},function(t,n,i){"use strict";t.exports=function(t){function noop(){}var n={log:noop,warn:noop,error:noop};if(!t&&window.console){var attachFunction=function(t,n){t[n]=function reporterProxy(){var t=console[n];if(t.apply)t.apply(console,arguments);else for(var i=0;i<arguments.length;i++)t(arguments[i])}};attachFunction(n,"log"),attachFunction(n,"warn"),attachFunction(n,"error")}return n}},function(t,n,i){"use strict";var o=i(335);function Batch(){var t={},n=0,i=0,o=0;return{add:function add(a,s){s||(s=a,a=0),a>i?i=a:a<o&&(o=a),t[a]||(t[a]=[]),t[a].push(s),n++},process:function process(){for(var n=o;n<=i;n++)for(var a=t[n],s=0;s<a.length;s++)(0,a[s])()},size:function getSize(){return n}}}t.exports=function batchProcessorMaker(t){var n=(t=t||{}).reporter,i=o.getOption(t,"async",!0),a=o.getOption(t,"auto",!0);a&&!i&&(n&&n.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),i=!0);var s,m=Batch(),g=!1;function processBatch(){for(g=!0;m.size();){var t=m;m=Batch(),t.process()}g=!1}function processBatchAsync(){s=function requestFrame(t){return setTimeout(t,0)}(processBatch)}return{add:function addFunction(t,n){!g&&a&&i&&0===m.size()&&processBatchAsync(),m.add(t,n)},force:function forceProcessBatch(t){g||(void 0===t&&(t=i),s&&(function cancelFrame(t){clearTimeout(t)}(s),s=null),t?processBatchAsync():processBatch())}}}},function(t,n,i){"use strict";(t.exports={}).getOption=function getOption(t,n,i){var o=t[n];return null==o&&void 0!==i?i:o}},function(t,n,i){"use strict";function getState(t){return t._erd}t.exports={initState:function initState(t){return t._erd={},getState(t)},getState,cleanState:function cleanState(t){delete t._erd}}},function(t,n,i){"use strict";var o=i(210);t.exports=function(t){var n=(t=t||{}).reporter,i=t.batchProcessor,a=t.stateHandler.getState;if(!n)throw new Error("Missing required dependency: reporter.");function buildCssTextString(n){var i=t.important?" !important; ":"; ";return(n.join(i)+i).trim()}function getObject(t){return a(t).object}return{makeDetectable:function makeDetectable(t,s,m){m||(m=s,s=t,t=null),(t=t||{}).debug,o.isIE(8)?m(s):function injectObject(s,m){var g=buildCssTextString(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),_=!1,S=window.getComputedStyle(s),M=s.offsetWidth,T=s.offsetHeight;function mutateDom(){function alterPositionStyles(){if("static"===S.position){s.style.setProperty("position","relative",t.important?"important":"");var removeRelativeStyles=function(n,i,o,a){var s=o[a];"auto"!==s&&"0"!==function getNumericalValue(t){return t.replace(/[^-\d\.]/g,"")}(s)&&(n.warn("An element that is positioned static has style."+a+"="+s+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+a+" will be set to 0. Element: ",i),i.style.setProperty(a,"0",t.important?"important":""))};removeRelativeStyles(n,s,S,"top"),removeRelativeStyles(n,s,S,"right"),removeRelativeStyles(n,s,S,"bottom"),removeRelativeStyles(n,s,S,"left")}}""!==S.position&&(alterPositionStyles(),_=!0);var i=document.createElement("object");i.style.cssText=g,i.tabIndex=-1,i.type="text/html",i.setAttribute("aria-hidden","true"),i.onload=function onObjectLoad(){_||alterPositionStyles(),function getDocument(t,n){if(!t.contentDocument){var i=a(t);return i.checkForObjectDocumentTimeoutId&&window.clearTimeout(i.checkForObjectDocumentTimeoutId),void(i.checkForObjectDocumentTimeoutId=setTimeout((function checkForObjectDocument(){i.checkForObjectDocumentTimeoutId=0,getDocument(t,n)}),100))}n(t.contentDocument)}(this,(function onObjectDocumentReady(t){m(s)}))},o.isIE()||(i.data="about:blank"),a(s)&&(s.appendChild(i),a(s).object=i,o.isIE()&&(i.data="about:blank"))}a(s).startSize={width:M,height:T},i?i.add(mutateDom):mutateDom()}(s,m)},addListener:function addListener(t,n){function listenerProxy(){n(t)}if(o.isIE(8))a(t).object={proxy:listenerProxy},t.attachEvent("onresize",listenerProxy);else{var i=getObject(t);if(!i)throw new Error("Element is not detectable by this strategy.");i.contentDocument.defaultView.addEventListener("resize",listenerProxy)}},uninstall:function uninstall(t){if(a(t)){var n=getObject(t);n&&(o.isIE(8)?t.detachEvent("onresize",n.proxy):t.removeChild(n),a(t).checkForObjectDocumentTimeoutId&&window.clearTimeout(a(t).checkForObjectDocumentTimeoutId),delete a(t).object)}}}}},function(t,n,i){"use strict";var o=i(209).forEach;t.exports=function(t){var n=(t=t||{}).reporter,i=t.batchProcessor,a=t.stateHandler.getState,s=(t.stateHandler.hasState,t.idHandler);if(!i)throw new Error("Missing required dependency: batchProcessor");if(!n)throw new Error("Missing required dependency: reporter.");var m=function getScrollbarSizes(){var t=document.createElement("div");t.style.cssText=buildCssTextString(["position: absolute","width: 1000px","height: 1000px","visibility: hidden","margin: 0","padding: 0"]);var n=document.createElement("div");n.style.cssText=buildCssTextString(["position: absolute","width: 500px","height: 500px","overflow: scroll","visibility: none","top: -1500px","left: -1500px","visibility: hidden","margin: 0","padding: 0"]),n.appendChild(t),document.body.insertBefore(n,document.body.firstChild);var i=500-n.clientWidth,o=500-n.clientHeight;return document.body.removeChild(n),{width:i,height:o}}();function initDocument(t){!function injectScrollStyle(t,n,i){if(!t.getElementById(n)){var o=i+"_animation",a=i+"_animation_active",s="/* Created by the element-resize-detector library. */\n";s+="."+i+" > div::-webkit-scrollbar { "+buildCssTextString(["display: none"])+" }\n\n",s+="."+a+" { "+buildCssTextString(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+o,"animation-name: "+o])+" }\n",s+="@-webkit-keyframes "+o+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }\n",function injectStyle(i,o){o=o||function(n){t.head.appendChild(n)};var a=t.createElement("style");a.innerHTML=i,a.id=n,o(a)}(s+="@keyframes "+o+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }")}}(t,"erd_scroll_detection_scrollbar_style","erd_scroll_detection_container")}function buildCssTextString(n){var i=t.important?" !important; ":"; ";return(n.join(i)+i).trim()}function addEvent(t,i,o){if(t.addEventListener)t.addEventListener(i,o);else{if(!t.attachEvent)return n.error("[scroll] Don't know how to add event listeners.");t.attachEvent("on"+i,o)}}function removeEvent(t,i,o){if(t.removeEventListener)t.removeEventListener(i,o);else{if(!t.detachEvent)return n.error("[scroll] Don't know how to remove event listeners.");t.detachEvent("on"+i,o)}}function getExpandElement(t){return a(t).container.childNodes[0].childNodes[0].childNodes[0]}function getShrinkElement(t){return a(t).container.childNodes[0].childNodes[0].childNodes[1]}return initDocument(window.document),{makeDetectable:function makeDetectable(t,g,_){function debug(){if(t.debug){var i=Array.prototype.slice.call(arguments);if(i.unshift(s.get(g),"Scroll: "),n.log.apply)n.log.apply(null,i);else for(var o=0;o<i.length;o++)n.log(i[o])}}function isUnrendered(t){var n=a(t).container.childNodes[0],i=window.getComputedStyle(n);return!i.width||-1===i.width.indexOf("px")}function getStyle(){var t=window.getComputedStyle(g),n={};return n.position=t.position,n.width=g.offsetWidth,n.height=g.offsetHeight,n.top=t.top,n.right=t.right,n.bottom=t.bottom,n.left=t.left,n.widthCSS=t.width,n.heightCSS=t.height,n}function storeStyle(){if(debug("storeStyle invoked."),a(g)){var t=getStyle();a(g).style=t}else debug("Aborting because element has been uninstalled")}function storeCurrentSize(t,n,i){a(t).lastWidth=n,a(t).lastHeight=i}function getWidthOffset(){return 2*m.width+1}function getHeightOffset(){return 2*m.height+1}function getExpandWidth(t){return t+10+getWidthOffset()}function getExpandHeight(t){return t+10+getHeightOffset()}function positionScrollbars(t,n,i){var o=getExpandElement(t),a=getShrinkElement(t),s=getExpandWidth(n),m=getExpandHeight(i),g=function getShrinkWidth(t){return 2*t+getWidthOffset()}(n),_=function getShrinkHeight(t){return 2*t+getHeightOffset()}(i);o.scrollLeft=s,o.scrollTop=m,a.scrollLeft=g,a.scrollTop=_}function injectContainerElement(){var t=a(g).container;if(!t){(t=document.createElement("div")).className="erd_scroll_detection_container",t.style.cssText=buildCssTextString(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),a(g).container=t,function addAnimationClass(t){t.className+=" erd_scroll_detection_container_animation_active"}(t),g.appendChild(t);var onAnimationStart=function(){a(g).onRendered&&a(g).onRendered()};addEvent(t,"animationstart",onAnimationStart),a(g).onAnimationStart=onAnimationStart}return t}function injectScrollElements(){if(debug("Injecting elements"),a(g)){!function alterPositionStyles(){var i=a(g).style;if("static"===i.position){g.style.setProperty("position","relative",t.important?"important":"");var removeRelativeStyles=function(t,n,i,o){var a=i[o];"auto"!==a&&"0"!==function getNumericalValue(t){return t.replace(/[^-\d\.]/g,"")}(a)&&(t.warn("An element that is positioned static has style."+o+"="+a+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+o+" will be set to 0. Element: ",n),n.style[o]=0)};removeRelativeStyles(n,g,i,"top"),removeRelativeStyles(n,g,i,"right"),removeRelativeStyles(n,g,i,"bottom"),removeRelativeStyles(n,g,i,"left")}}();var i=a(g).container;i||(i=injectContainerElement());var o=m.width,s=m.height,_=buildCssTextString(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),S=buildCssTextString(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(function getLeftTopBottomRightCssText(t,n,i,o){return["left: "+(t=t?t+"px":"0"),"top: "+(n=n?n+"px":"0"),"right: "+(o=o?o+"px":"0"),"bottom: "+(i=i?i+"px":"0")]}(-(1+o),-(1+s),-s,-o))),M=buildCssTextString(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),T=buildCssTextString(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),O=buildCssTextString(["position: absolute","left: 0","top: 0"]),A=buildCssTextString(["position: absolute","width: 200%","height: 200%"]),P=document.createElement("div"),L=document.createElement("div"),R=document.createElement("div"),N=document.createElement("div"),I=document.createElement("div"),j=document.createElement("div");P.dir="ltr",P.style.cssText=_,P.className="erd_scroll_detection_container",L.className="erd_scroll_detection_container",L.style.cssText=S,R.style.cssText=M,N.style.cssText=O,I.style.cssText=T,j.style.cssText=A,R.appendChild(N),I.appendChild(j),L.appendChild(R),L.appendChild(I),P.appendChild(L),i.appendChild(P),addEvent(R,"scroll",onExpandScroll),addEvent(I,"scroll",onShrinkScroll),a(g).onExpandScroll=onExpandScroll,a(g).onShrinkScroll=onShrinkScroll}else debug("Aborting because element has been uninstalled");function onExpandScroll(){a(g).onExpand&&a(g).onExpand()}function onShrinkScroll(){a(g).onShrink&&a(g).onShrink()}}function registerListenersAndPositionElements(){function updateChildSizes(n,i,o){var a=function getExpandChildElement(t){return getExpandElement(t).childNodes[0]}(n),s=getExpandWidth(i),m=getExpandHeight(o);a.style.setProperty("width",s+"px",t.important?"important":""),a.style.setProperty("height",m+"px",t.important?"important":"")}function updateDetectorElements(o){var m=g.offsetWidth,_=g.offsetHeight,S=m!==a(g).lastWidth||_!==a(g).lastHeight;debug("Storing current size",m,_),storeCurrentSize(g,m,_),i.add(0,(function performUpdateChildSizes(){if(S)if(a(g))if(areElementsInjected()){if(t.debug){var i=g.offsetWidth,o=g.offsetHeight;i===m&&o===_||n.warn(s.get(g),"Scroll: Size changed before updating detector elements.")}updateChildSizes(g,m,_)}else debug("Aborting because element container has not been initialized");else debug("Aborting because element has been uninstalled")})),i.add(1,(function updateScrollbars(){a(g)?areElementsInjected()?positionScrollbars(g,m,_):debug("Aborting because element container has not been initialized"):debug("Aborting because element has been uninstalled")})),S&&o&&i.add(2,(function(){a(g)?areElementsInjected()?o():debug("Aborting because element container has not been initialized"):debug("Aborting because element has been uninstalled")}))}function areElementsInjected(){return!!a(g).container}function notifyListenersIfNeeded(){debug("notifyListenersIfNeeded invoked");var t=a(g);return function isFirstNotify(){return void 0===a(g).lastNotifiedWidth}()&&t.lastWidth===t.startSize.width&&t.lastHeight===t.startSize.height?debug("Not notifying: Size is the same as the start size, and there has been no notification yet."):t.lastWidth===t.lastNotifiedWidth&&t.lastHeight===t.lastNotifiedHeight?debug("Not notifying: Size already notified"):(debug("Current size not notified, notifying..."),t.lastNotifiedWidth=t.lastWidth,t.lastNotifiedHeight=t.lastHeight,void o(a(g).listeners,(function(t){t(g)})))}function handleScroll(){debug("Scroll detected."),isUnrendered(g)?debug("Scroll event fired while unrendered. Ignoring..."):updateDetectorElements(notifyListenersIfNeeded)}if(debug("registerListenersAndPositionElements invoked."),a(g)){a(g).onRendered=function handleRender(){if(debug("startanimation triggered."),isUnrendered(g))debug("Ignoring since element is still unrendered...");else{debug("Element rendered.");var t=getExpandElement(g),n=getShrinkElement(g);0!==t.scrollLeft&&0!==t.scrollTop&&0!==n.scrollLeft&&0!==n.scrollTop||(debug("Scrollbars out of sync. Updating detector elements..."),updateDetectorElements(notifyListenersIfNeeded))}},a(g).onExpand=handleScroll,a(g).onShrink=handleScroll;var m=a(g).style;updateChildSizes(g,m.width,m.height)}else debug("Aborting because element has been uninstalled")}function finalizeDomMutation(){if(debug("finalizeDomMutation invoked."),a(g)){var t=a(g).style;storeCurrentSize(g,t.width,t.height),positionScrollbars(g,t.width,t.height)}else debug("Aborting because element has been uninstalled")}function ready(){_(g)}function install(){debug("Installing..."),function initListeners(){a(g).listeners=[]}(),function storeStartSize(){var t=getStyle();a(g).startSize={width:t.width,height:t.height},debug("Element start size",a(g).startSize)}(),i.add(0,storeStyle),i.add(1,injectScrollElements),i.add(2,registerListenersAndPositionElements),i.add(3,finalizeDomMutation),i.add(4,ready)}_||(_=g,g=t,t=null),t=t||{},debug("Making detectable..."),function isDetached(t){return!function isInDocument(t){return t===t.ownerDocument.body||t.ownerDocument.body.contains(t)}(t)||null===window.getComputedStyle(t)}(g)?(debug("Element is detached"),injectContainerElement(),debug("Waiting until element is attached..."),a(g).onRendered=function(){debug("Element is now attached"),install()}):install()},addListener:function addListener(t,n){if(!a(t).listeners.push)throw new Error("Cannot add listener to an element that is not detectable.");a(t).listeners.push(n)},uninstall:function uninstall(t){var n=a(t);n&&(n.onExpandScroll&&removeEvent(getExpandElement(t),"scroll",n.onExpandScroll),n.onShrinkScroll&&removeEvent(getShrinkElement(t),"scroll",n.onShrinkScroll),n.onAnimationStart&&removeEvent(n.container,"animationstart",n.onAnimationStart),n.container&&t.removeChild(n.container))},initDocument}}},function(t,n,i){"use strict";i.r(n),i.d(n,"GLTFExporter",(function(){return GLTFExporter}));var o=i(0),a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s={};s[o.NearestFilter]=9728,s[o.NearestMipmapNearestFilter]=9984,s[o.NearestMipmapLinearFilter]=9986,s[o.LinearFilter]=9729,s[o.LinearMipmapNearestFilter]=9985,s[o.LinearMipmapLinearFilter]=9987,s[o.ClampToEdgeWrapping]=33071,s[o.RepeatWrapping]=10497,s[o.MirroredRepeatWrapping]=33648;var m={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},GLTFExporter=function(){};GLTFExporter.prototype={constructor:GLTFExporter,parse:function(t,n,i){(i=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i)).animations.length>0&&(i.trs=!0);var g,_={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},S=0,M=[],T=[],O=new Map,A=[],P={},L={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},R=new Map,N=0;function getUID(t){return R.has(t)||R.set(t,N++),R.get(t)}function equalArray(t,n){return t.length===n.length&&t.every((function(t,i){return t===n[i]}))}function getPaddedBufferSize(t){return 4*Math.ceil(t/4)}function getPaddedArrayBuffer(t,n){n=n||0;var i=getPaddedBufferSize(t.byteLength);if(i!==t.byteLength){var o=new Uint8Array(i);if(o.set(new Uint8Array(t)),0!==n)for(var a=t.byteLength;a<i;a++)o[a]=n;return o.buffer}return t}function serializeUserData(t,n){if(0!==Object.keys(t.userData).length)try{var o=JSON.parse(JSON.stringify(t.userData));if(i.includeCustomExtensions&&o.gltfExtensions){for(var a in void 0===n.extensions&&(n.extensions={}),o.gltfExtensions)n.extensions[a]=o.gltfExtensions[a],P[a]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(n.extras=o)}catch(n){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+n.message)}}function applyTextureTransform(t,n){var i=!1,o={};0===n.offset.x&&0===n.offset.y||(o.offset=n.offset.toArray(),i=!0),0!==n.rotation&&(o.rotation=n.rotation,i=!0),1===n.repeat.x&&1===n.repeat.y||(o.scale=n.repeat.toArray(),i=!0),i&&(t.extensions=t.extensions||{},t.extensions.KHR_texture_transform=o,P.KHR_texture_transform=!0)}function processBuffer(t){return _.buffers||(_.buffers=[{byteLength:0}]),M.push(t),0}function processAccessor(t,n,o,a){var s;if(t.array.constructor===Float32Array)s=5126;else if(t.array.constructor===Uint32Array)s=5125;else if(t.array.constructor===Uint16Array)s=5123;else{if(t.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");s=5121}if(void 0===o&&(o=0),void 0===a&&(a=t.count),i.truncateDrawRange&&void 0!==n&&null===n.index){var m=o+a,g=n.drawRange.count===1/0?t.count:n.drawRange.start+n.drawRange.count;o=Math.max(o,n.drawRange.start),(a=Math.min(m,g)-o)<0&&(a=0)}if(0===a)return null;var M,T=function getMinMax(t,n,i){for(var o={min:new Array(t.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(t.itemSize).fill(Number.NEGATIVE_INFINITY)},a=n;a<n+i;a++)for(var s=0;s<t.itemSize;s++){var m;t.itemSize>4?m=t.array[a*t.itemSize+s]:0===s?m=t.getX(a):1===s?m=t.getY(a):2===s?m=t.getZ(a):3===s&&(m=t.getW(a)),o.min[s]=Math.min(o.min[s],m),o.max[s]=Math.max(o.max[s],m)}return o}(t,o,a);void 0!==n&&(M=t===n.index?34963:34962);var O=function processBufferView(t,n,i,o,a){var s;_.bufferViews||(_.bufferViews=[]),s=5121===n?1:5123===n?2:4;for(var m=getPaddedBufferSize(o*t.itemSize*s),g=new DataView(new ArrayBuffer(m)),M=0,T=i;T<i+o;T++)for(var O=0;O<t.itemSize;O++){var A;t.itemSize>4?A=t.array[T*t.itemSize+O]:0===O?A=t.getX(T):1===O?A=t.getY(T):2===O?A=t.getZ(T):3===O&&(A=t.getW(T)),5126===n?g.setFloat32(M,A,!0):5125===n?g.setUint32(M,A,!0):5123===n?g.setUint16(M,A,!0):5121===n&&g.setUint8(M,A),M+=s}var P={buffer:processBuffer(g.buffer),byteOffset:S,byteLength:m};return void 0!==a&&(P.target=a),34962===a&&(P.byteStride=t.itemSize*s),S+=m,_.bufferViews.push(P),{id:_.bufferViews.length-1,byteLength:0}}(t,s,o,a,M),A={bufferView:O.id,byteOffset:O.byteOffset,componentType:s,count:a,max:T.max,min:T.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[t.itemSize]};return!0===t.normalized&&(A.normalized=!0),_.accessors||(_.accessors=[]),_.accessors.push(A),_.accessors.length-1}function processImage(t,n,a){L.images.has(t)||L.images.set(t,{});var s=L.images.get(t),m=n===o.RGBAFormat?"image/png":"image/jpeg",M=m+":flipY/"+a.toString();if(void 0!==s[M])return s[M];_.images||(_.images=[]);var O={mimeType:m};if(i.embedImages){var A=g=g||document.createElement("canvas");A.width=Math.min(t.width,i.maxTextureSize),A.height=Math.min(t.height,i.maxTextureSize);var P=A.getContext("2d");if(!0===a&&(P.translate(0,A.height),P.scale(1,-1)),"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap)P.drawImage(t,0,0,A.width,A.height);else{n!==o.RGBAFormat&&n!==o.RGBFormat&&console.error("GLTFExporter: Only RGB and RGBA formats are supported."),(t.width>i.maxTextureSize||t.height>i.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);let a=t.data;if(n===o.RGBFormat){a=new Uint8ClampedArray(t.height*t.width*4);for(var R=0,N=0;R<a.length;R+=4,N+=3)a[R+0]=t.data[N+0],a[R+1]=t.data[N+1],a[R+2]=t.data[N+2],a[R+3]=255}P.putImageData(new ImageData(a,t.width,t.height),0,0)}!0===i.binary?T.push(new Promise((function(t){A.toBlob((function(n){(function processBufferViewImage(t){return _.bufferViews||(_.bufferViews=[]),new Promise((function(n){var i=new window.FileReader;i.readAsArrayBuffer(t),i.onloadend=function(){var t=getPaddedArrayBuffer(i.result),o={buffer:processBuffer(t),byteOffset:S,byteLength:t.byteLength};S+=t.byteLength,_.bufferViews.push(o),n(_.bufferViews.length-1)}}))})(n).then((function(n){O.bufferView=n,t()}))}),m)}))):O.uri=A.toDataURL(m)}else O.uri=t.src;_.images.push(O);var I=_.images.length-1;return s[M]=I,I}function processSampler(t){_.samplers||(_.samplers=[]);var n={magFilter:s[t.magFilter],minFilter:s[t.minFilter],wrapS:s[t.wrapS],wrapT:s[t.wrapT]};return _.samplers.push(n),_.samplers.length-1}function processTexture(t){if(L.textures.has(t))return L.textures.get(t);_.textures||(_.textures=[]);var n={sampler:processSampler(t),source:processImage(t.image,t.format,t.flipY)};t.name&&(n.name=t.name),_.textures.push(n);var i=_.textures.length-1;return L.textures.set(t,i),i}function processMaterial(t){if(L.materials.has(t))return L.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;_.materials||(_.materials=[]);var n={pbrMetallicRoughness:{}};t.isMeshBasicMaterial?(n.extensions={KHR_materials_unlit:{}},P.KHR_materials_unlit=!0):t.isGLTFSpecularGlossinessMaterial?(n.extensions={KHR_materials_pbrSpecularGlossiness:{}},P.KHR_materials_pbrSpecularGlossiness=!0):t.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var i=t.color.toArray().concat([t.opacity]);if(equalArray(i,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=i),t.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=t.metalness,n.pbrMetallicRoughness.roughnessFactor=t.roughness):t.isMeshBasicMaterial?(n.pbrMetallicRoughness.metallicFactor=0,n.pbrMetallicRoughness.roughnessFactor=.9):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),t.isGLTFSpecularGlossinessMaterial){n.pbrMetallicRoughness.baseColorFactor&&(n.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor=n.pbrMetallicRoughness.baseColorFactor);var a=[1,1,1];t.specular.toArray(a,0),n.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor=a,n.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor=t.glossiness}if(t.metalnessMap||t.roughnessMap)if(t.metalnessMap===t.roughnessMap){var s={index:processTexture(t.metalnessMap)};applyTextureTransform(s,t.metalnessMap),n.pbrMetallicRoughness.metallicRoughnessTexture=s}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(t.map){var m={index:processTexture(t.map)};applyTextureTransform(m,t.map),t.isGLTFSpecularGlossinessMaterial&&(n.extensions.KHR_materials_pbrSpecularGlossiness.diffuseTexture=m),n.pbrMetallicRoughness.baseColorTexture=m}if(t.isGLTFSpecularGlossinessMaterial&&t.specularMap){var g={index:processTexture(t.specularMap)};applyTextureTransform(g,t.specularMap),n.extensions.KHR_materials_pbrSpecularGlossiness.specularGlossinessTexture=g}if(t.emissive){var S=t.emissive.clone().multiplyScalar(t.emissiveIntensity).toArray();if(equalArray(S,[0,0,0])||(n.emissiveFactor=S),t.emissiveMap){var M={index:processTexture(t.emissiveMap)};applyTextureTransform(M,t.emissiveMap),n.emissiveTexture=M}}if(t.normalMap){var T={index:processTexture(t.normalMap)};t.normalScale&&-1!==t.normalScale.x&&(t.normalScale.x!==t.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),T.scale=t.normalScale.x),applyTextureTransform(T,t.normalMap),n.normalTexture=T}if(t.aoMap){var O={index:processTexture(t.aoMap),texCoord:1};1!==t.aoMapIntensity&&(O.strength=t.aoMapIntensity),applyTextureTransform(O,t.aoMap),n.occlusionTexture=O}t.transparent?n.alphaMode="BLEND":t.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=t.alphaTest),t.side===o.DoubleSide&&(n.doubleSided=!0),""!==t.name&&(n.name=t.name),serializeUserData(t,n),_.materials.push(n);var A=_.materials.length-1;return L.materials.set(t,A),A}function processAnimation(t,n){_.animations||(_.animations=[]);for(var i=(t=GLTFExporter.Utils.mergeMorphTargetTracks(t.clone(),n)).tracks,a=[],s=[],g=0;g<i.length;++g){var S=i[g],M=o.PropertyBinding.parseTrackName(S.name),T=o.PropertyBinding.findNode(n,M.nodeName),A=m[M.propertyName];if("bones"===M.objectName&&(T=!0===T.isSkinnedMesh?T.skeleton.getBoneByName(M.objectIndex):void 0),!T||!A)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',S.name),null;var P,L=S.values.length/S.times.length;A===m.morphTargetInfluences&&(L/=T.morphTargetInfluences.length),!0===S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(P="CUBICSPLINE",L/=3):P=S.getInterpolation()===o.InterpolateDiscrete?"STEP":"LINEAR",s.push({input:processAccessor(new o.BufferAttribute(S.times,1)),output:processAccessor(new o.BufferAttribute(S.values,L)),interpolation:P}),a.push({sampler:s.length-1,target:{node:O.get(T),path:A}})}return _.animations.push({name:t.name||"clip_"+_.animations.length,samplers:s,channels:a}),_.animations.length-1}function processSkin(t){var n=_.nodes[O.get(t)],i=t.skeleton;if(void 0===i)return null;var a=t.skeleton.bones[0];if(void 0===a)return null;for(var s=[],m=new Float32Array(16*i.bones.length),g=new o.Matrix4,S=0;S<i.bones.length;++S)s.push(O.get(i.bones[S])),g.copy(i.boneInverses[S]),g.multiply(t.bindMatrix).toArray(m,16*S);return void 0===_.skins&&(_.skins=[]),_.skins.push({inverseBindMatrices:processAccessor(new o.BufferAttribute(m,16)),joints:s,skeleton:O.get(a)}),n.skin=_.skins.length-1}function processLight(t){var n={};t.name&&(n.name=t.name),n.color=t.color.toArray(),n.intensity=t.intensity,t.isDirectionalLight?n.type="directional":t.isPointLight?(n.type="point",t.distance>0&&(n.range=t.distance)):t.isSpotLight&&(n.type="spot",t.distance>0&&(n.range=t.distance),n.spot={},n.spot.innerConeAngle=(t.penumbra-1)*t.angle*-1,n.spot.outerConeAngle=t.angle),void 0!==t.decay&&2!==t.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!t.target||t.target.parent===t&&0===t.target.position.x&&0===t.target.position.y&&-1===t.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var i=_.extensions.KHR_lights_punctual.lights;return i.push(n),i.length-1}function processNode(t){_.nodes||(_.nodes=[]);var n={};if(i.trs){var s=t.quaternion.toArray(),m=t.position.toArray(),g=t.scale.toArray();equalArray(s,[0,0,0,1])||(n.rotation=s),equalArray(m,[0,0,0])||(n.translation=m),equalArray(g,[1,1,1])||(n.scale=g)}else t.matrixAutoUpdate&&t.updateMatrix(),!1===function isIdentityMatrix(t){return equalArray(t.elements,a)}(t.matrix)&&(n.matrix=t.matrix.elements);if(""!==t.name&&(n.name=String(t.name)),serializeUserData(t,n),t.isMesh||t.isLine||t.isPoints){var S=function processMesh(t){var n=[t.geometry.uuid];if(Array.isArray(t.material))for(var i=0,a=t.material.length;i<a;i++)n.push(t.material[i].uuid);else n.push(t.material.uuid);var s=n.join(":");if(L.meshes.has(s))return L.meshes.get(s);var m,g=t.geometry;m=t.isLineSegments?1:t.isLineLoop?2:t.isLine?3:t.isPoints?0:t.material.wireframe?1:4,g.isBufferGeometry||(console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use BufferGeometry instead."),g=(new o.BufferGeometry).setFromObject(t));var S={},M={},T=[],O=[],A={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},P=g.getAttribute("normal");void 0===P||function isNormalizedNormalAttribute(t){if(L.attributesNormalized.has(t))return!1;for(var n=new o.Vector3,i=0,a=t.count;i<a;i++)if(Math.abs(n.fromBufferAttribute(t,i).length()-1)>5e-4)return!1;return!0}(P)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),g.setAttribute("normal",function createNormalizedNormalAttribute(t){if(L.attributesNormalized.has(t))return L.attributesNormalized.get(t);for(var n=t.clone(),i=new o.Vector3,a=0,s=n.count;a<s;a++)i.fromBufferAttribute(n,a),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),n.setXYZ(a,i.x,i.y,i.z);return L.attributesNormalized.set(t,n),n}(P)));var R=null;for(var N in g.attributes)if("morph"!==N.substr(0,5)){var I=g.attributes[N];if(N=A[N]||N.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(N)||(N="_"+N),L.attributes.has(getUID(I)))M[N]=L.attributes.get(getUID(I));else{R=null;var j=I.array;"JOINTS_0"!==N||j instanceof Uint16Array||j instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),R=new o.BufferAttribute(new Uint16Array(j),I.itemSize,I.normalized));var V=processAccessor(R||I,g);null!==V&&(M[N]=V,L.attributes.set(getUID(I),V))}}if(void 0!==P&&g.setAttribute("normal",P),0===Object.keys(M).length)return null;if(void 0!==t.morphTargetInfluences&&t.morphTargetInfluences.length>0){var U=[],G=[],z={};if(void 0!==t.morphTargetDictionary)for(var H in t.morphTargetDictionary)z[t.morphTargetDictionary[H]]=H;for(i=0;i<t.morphTargetInfluences.length;++i){var q={},Z=!1;for(var N in g.morphAttributes)if("position"===N||"normal"===N){I=g.morphAttributes[N][i];var X=N.toUpperCase(),Q=g.attributes[N];if(L.attributes.has(getUID(I)))q[X]=L.attributes.get(getUID(I));else{var Y=I.clone();if(!g.morphTargetsRelative)for(var J=0,K=I.count;J<K;J++)Y.setXYZ(J,I.getX(J)-Q.getX(J),I.getY(J)-Q.getY(J),I.getZ(J)-Q.getZ(J));q[X]=processAccessor(Y,g),L.attributes.set(getUID(Q),q[X])}}else Z||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),Z=!0);O.push(q),U.push(t.morphTargetInfluences[i]),void 0!==t.morphTargetDictionary&&G.push(z[i])}S.weights=U,G.length>0&&(S.extras={},S.extras.targetNames=G)}var $=Array.isArray(t.material);if($&&0===g.groups.length)return null;for(var ee=$?t.material:[t.material],te=$?g.groups:[{materialIndex:0,start:void 0,count:void 0}],ne=(i=0,te.length);i<ne;i++){var re={mode:m,attributes:M};if(serializeUserData(g,re),O.length>0&&(re.targets=O),null!==g.index){var ie=getUID(g.index);void 0===te[i].start&&void 0===te[i].count||(ie+=":"+te[i].start+":"+te[i].count),L.attributes.has(ie)?re.indices=L.attributes.get(ie):(re.indices=processAccessor(g.index,g,te[i].start,te[i].count),L.attributes.set(ie,re.indices)),null===re.indices&&delete re.indices}var oe=processMaterial(ee[te[i].materialIndex]);null!==oe&&(re.material=oe),T.push(re)}S.primitives=T,_.meshes||(_.meshes=[]),_.meshes.push(S);var ae=_.meshes.length-1;return L.meshes.set(s,ae),ae}(t);null!==S&&(n.mesh=S)}else if(t.isCamera)n.camera=function processCamera(t){_.cameras||(_.cameras=[]);var n=t.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:2*t.right,ymag:2*t.top,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:i.perspective={aspectRatio:t.aspect,yfov:o.MathUtils.degToRad(t.fov),zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},""!==t.name&&(i.name=t.type),_.cameras.push(i),_.cameras.length-1}(t);else if(t.isDirectionalLight||t.isPointLight||t.isSpotLight)P.KHR_lights_punctual||(_.extensions=_.extensions||{},_.extensions.KHR_lights_punctual={lights:[]},P.KHR_lights_punctual=!0),n.extensions=n.extensions||{},n.extensions.KHR_lights_punctual={light:processLight(t)};else if(t.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",t),null;if(t.isSkinnedMesh&&A.push(t),t.children.length>0){for(var M=[],T=0,R=t.children.length;T<R;T++){var N=t.children[T];if(N.visible||!1===i.onlyVisible){var I=processNode(N);null!==I&&M.push(I)}}M.length>0&&(n.children=M)}_.nodes.push(n);var j=_.nodes.length-1;return O.set(t,j),j}function processScene(t){_.scenes||(_.scenes=[],_.scene=0);var n={};""!==t.name&&(n.name=t.name),_.scenes.push(n);for(var o=[],a=0,s=t.children.length;a<s;a++){var m=t.children[a];if(m.visible||!1===i.onlyVisible){var g=processNode(m);null!==g&&o.push(g)}}o.length>0&&(n.nodes=o),serializeUserData(t,n)}!function processInput(t){t=t instanceof Array?t:[t];for(var n=[],a=0;a<t.length;a++)t[a]instanceof o.Scene?processScene(t[a]):n.push(t[a]);for(n.length>0&&function processObjects(t){var n=new o.Scene;n.name="AuxScene";for(var i=0;i<t.length;i++)n.children.push(t[i]);processScene(n)}(n),a=0;a<A.length;++a)processSkin(A[a]);for(a=0;a<i.animations.length;++a)processAnimation(i.animations[a],t[0])}(t),Promise.all(T).then((function(){var t,o=new Blob(M,{type:"application/octet-stream"}),a=Object.keys(P);(a.length>0&&(_.extensionsUsed=a),_.buffers&&_.buffers.length>0&&(_.buffers[0].byteLength=o.size),!0===i.binary)?((t=new window.FileReader).readAsArrayBuffer(o),t.onloadend=function(){var i=getPaddedArrayBuffer(t.result),o=new DataView(new ArrayBuffer(8));o.setUint32(0,i.byteLength,!0),o.setUint32(4,5130562,!0);var a=getPaddedArrayBuffer(function stringToArrayBuffer(t){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(t).buffer;for(var n=new Uint8Array(new ArrayBuffer(t.length)),i=0,o=t.length;i<o;i++){var a=t.charCodeAt(i);n[i]=a>255?32:a}return n.buffer}(JSON.stringify(_)),32),s=new DataView(new ArrayBuffer(8));s.setUint32(0,a.byteLength,!0),s.setUint32(4,1313821514,!0);var m=new ArrayBuffer(12),g=new DataView(m);g.setUint32(0,1179937895,!0),g.setUint32(4,2,!0);var S=12+s.byteLength+a.byteLength+o.byteLength+i.byteLength;g.setUint32(8,S,!0);var M=new Blob([m,s,a,o,i],{type:"application/octet-stream"}),T=new window.FileReader;T.readAsArrayBuffer(M),T.onloadend=function(){n(T.result)}}):_.buffers&&_.buffers.length>0?((t=new window.FileReader).readAsDataURL(o),t.onloadend=function(){var i=t.result;_.buffers[0].uri=i,n(_)}):n(_)}))}},GLTFExporter.Utils={insertKeyframe:function(t,n){var i,o=t.getValueSize(),a=new t.TimeBufferType(t.times.length+1),s=new t.ValueBufferType(t.values.length+o),m=t.createInterpolant(new t.ValueBufferType(o));if(0===t.times.length){a[0]=n;for(var g=0;g<o;g++)s[g]=0;i=0}else if(n<t.times[0]){if(Math.abs(t.times[0]-n)<.001)return 0;a[0]=n,a.set(t.times,1),s.set(m.evaluate(n),0),s.set(t.values,o),i=0}else if(n>t.times[t.times.length-1]){if(Math.abs(t.times[t.times.length-1]-n)<.001)return t.times.length-1;a[a.length-1]=n,a.set(t.times,0),s.set(t.values,0),s.set(m.evaluate(n),t.values.length),i=a.length-1}else for(g=0;g<t.times.length;g++){if(Math.abs(t.times[g]-n)<.001)return g;if(t.times[g]<n&&t.times[g+1]>n){a.set(t.times.slice(0,g+1),0),a[g+1]=n,a.set(t.times.slice(g+1),g+2),s.set(t.values.slice(0,(g+1)*o),0),s.set(m.evaluate(n),(g+1)*o),s.set(t.values.slice((g+1)*o),(g+2)*o),i=g+1;break}}return t.times=a,t.values=s,i},mergeMorphTargetTracks:function(t,n){for(var i=[],a={},s=t.tracks,m=0;m<s.length;++m){var g=s[m],_=o.PropertyBinding.parseTrackName(g.name),S=o.PropertyBinding.findNode(n,_.nodeName);if("morphTargetInfluences"===_.propertyName&&void 0!==_.propertyIndex){if(g.createInterpolant!==g.InterpolantFactoryMethodDiscrete&&g.createInterpolant!==g.InterpolantFactoryMethodLinear){if(g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(g=g.clone()).setInterpolation(o.InterpolateLinear)}var M,T=S.morphTargetInfluences.length,O=S.morphTargetDictionary[_.propertyIndex];if(void 0===O)throw new Error("THREE.GLTFExporter: Morph target name not found: "+_.propertyIndex);if(void 0!==a[S.uuid]){var A=g.createInterpolant(new g.ValueBufferType(1));for(M=a[S.uuid],R=0;R<M.times.length;R++)M.values[R*T+O]=A.evaluate(M.times[R]);for(R=0;R<g.times.length;R++){var P=this.insertKeyframe(M,g.times[R]);M.values[P*T+O]=g.values[R]}}else{for(var L=new((M=g.clone()).ValueBufferType)(T*M.times.length),R=0;R<M.times.length;R++)L[R*T+O]=M.values[R];M.name=(_.nodeName||"")+".morphTargetInfluences",M.values=L,a[S.uuid]=M,i.push(M)}}else i.push(g)}return t.tracks=i,t}}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.OBJExporter=void 0;var s=i(0),m=i(212),g=function(){function OBJExporter(){}return OBJExporter.prototype.parse=function(t){return o(this,void 0,void 0,(function(){function toDataURL(t,n,i){return o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,new Promise((function(o,a){if(t.startsWith("blob"))i(function getBase64Image(t){t.setAttribute("crossOrigin","anonymous");var n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),n.toDataURL().split("base64,")[1]}(n)),o();else{var s=new XMLHttpRequest;s.onerror=function(){i(void 0),s.abort(),o()},s.onload=function(){var t=new FileReader;t.onloadend=function(){event.loaded&&s.response?(i(t.result.split("base64,")[1]),o()):a("error")},t.readAsDataURL(s.response)},s.open("GET",t),s.responseType="blob",s.send()}}))]}))}))}var n,i,g,_,S,M,T,O,A,P,L,R,N,I,j,V,U,G,z;return a(this,(function(H){switch(H.label){case 0:n="",i=new Map,g=0,_=0,S=0,M=new s.Vector3,T=new s.Vector3,O=new s.Vector2,n+="mtllib "+(A="objmaterial")+".mtl\n",P=0,L=0,R=0,I=[],j=new m,t.traverse((function(t){t instanceof s.Mesh&&function parseMesh(t){o(this,void 0,void 0,(function(){var o,m,A,j,V,U,G,z,H,q;return a(this,(function(a){if(o=0,m=0,A=0,j=t.geometry,V=t.material,U=new s.Matrix3,j instanceof s.Geometry&&(j=(new s.BufferGeometry).setFromObject(t)),j instanceof s.BufferGeometry){if(G=j.getAttribute("position"),z=j.getAttribute("normal"),H=j.getAttribute("uv"),q=j.getIndex(),n+="o "+t.name+"\n",void 0!==G)for(P=0,R=G.count;P<R;P++,o++)M.x=G.getX(P),M.y=G.getY(P),M.z=G.getZ(P),M.applyMatrix4(t.matrixWorld),n+="v "+M.x+" "+M.y+" "+M.z+"\n";if(void 0!==H)for(P=0,R=H.count;P<R;P++,A++)O.x=H.getX(P),O.y=H.getY(P),n+="vt "+O.x+" "+O.y+"\n";if(void 0!==z)for(U.getNormalMatrix(t.matrixWorld),P=0,R=z.count;P<R;P++,m++)T.x=z.getX(P),T.y=z.getY(P),T.z=z.getZ(P),T.applyMatrix3(U),n+="vn "+T.x+" "+T.y+" "+T.z+"\n";if(""!==V.name?n+="usemtl "+V.name+"\n":n+="usemtl material"+V.id+"\n",i.set(V.id,V),null!==q)for(P=0,R=q.count;P<R;P+=3){for(N=0;N<3;N++)L=q.getX(P+N)+1,I[N]=g+L+(z||H?"/"+(H?_+L:"")+(z?"/"+(S+L):""):"");n+="f "+I.join(" ")+"\n"}else for(P=0,R=G.count;P<R;P+=3){for(N=0;N<3;N++)L=P+N+1,I[N]=g+L+(z||H?"/"+(H?_+L:"")+(z?"/"+(S+L):""):"");n+="f "+I.join(" ")+"\n"}g+=o,_+=A,S+=m}else console.warn("OBJExporter.parseMesh(): geometry type unsupported",t);return[2]}))}))}(t)})),V="",U=Array.from(i.keys()),G=function(t){var n,o,m;return a(this,(function(a){switch(a.label){case 0:return n=U[t],(o=i.get(n))&&(o.name||o.id)?[3,1]:[3,3];case 1:return""!==o.name?V+="newmtl "+o.name+" \n":V+="newmtl material"+o.id+" \n",V+="Ns 10.0000\n",V+="Ni 1.5000\n",V+="d 1.0000\n",V+="Tr 0.0000\n",V+="Tf 1.0000 1.0000 1.0000\n",V+="illum 2\n",o.color&&(V+="Ka "+o.color.r+" "+o.color.g+" "+o.color.b+" \n",V+="Kd "+o.color.r+" "+o.color.g+" "+o.color.b+" \n"),V+="Ks 0.0000 0.0000 0.0000\n",V+="Ke 0.0000 0.0000 0.0000\n",o.map&&o.map instanceof s.Texture&&o.map.image.currentSrc?(m=o.map.image.currentSrc.slice(o.map.image.currentSrc.lastIndexOf("/"),o.map.image.currentSrc.length),[4,toDataURL(o.map.image.currentSrc,o.map.image,(function(t){m.endsWith(".png")||m.endsWith(".jpg")||(m+=".png"),t&&j.file(m,t,{base64:!0})}))]):[3,3];case 2:a.sent(),V+="map_Ka "+m+"\n",V+="map_Kd "+m+"\n",a.label=3;case 3:return[2]}}))},z=0,H.label=1;case 1:return z<U.length?[5,G(z)]:[3,4];case 2:H.sent(),H.label=3;case 3:return z++,[3,1];case 4:return j.file("scene.obj",n),j.file(A+".mtl",V),console.error(j),[2,j]}}))}))},OBJExporter}();n.OBJExporter=g},function(t,n,i){"use strict";var o=i(177).Colorizer;t.exports=function(t){return o.addColors(t.colors||t),t}},function(t,n,i){var o={};t.exports=o,o.themes={};var a=i(72),s=o.styles=i(345),m=Object.defineProperties,g=new RegExp(/[\r\n]+/g);o.supportsColor=i(346).supportsColor,void 0===o.enabled&&(o.enabled=!1!==o.supportsColor()),o.enable=function(){o.enabled=!0},o.disable=function(){o.enabled=!1},o.stripColors=o.strip=function(t){return(""+t).replace(/\x1B\[\d+m/g,"")},o.stylize=function stylize(t,n){if(!o.enabled)return t+"";var i=s[n];return!i&&n in o?o[n](t):i.open+t+i.close};var _=/[|\\{}()[\]^$+*?.]/g;function build(t){var n=function builder(){return applyStyle.apply(builder,arguments)};return n._styles=t,n.__proto__=T,n}var S,M=(S={},s.grey=s.gray,Object.keys(s).forEach((function(t){s[t].closeRe=new RegExp(function(t){if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(_,"\\$&")}(s[t].close),"g"),S[t]={get:function(){return build(this._styles.concat(t))}}})),S),T=m((function colors(){}),M);function applyStyle(){var t=Array.prototype.slice.call(arguments),n=t.map((function(t){return null!=t&&t.constructor===String?t:a.inspect(t)})).join(" ");if(!o.enabled||!n)return n;for(var i=-1!=n.indexOf("\n"),m=this._styles,_=m.length;_--;){var S=s[m[_]];n=S.open+n.replace(S.closeRe,S.open)+S.close,i&&(n=n.replace(g,(function(t){return S.close+t+S.open})))}return n}o.setTheme=function(t){if("string"!=typeof t)for(var n in t)!function(n){o[n]=function(i){if("object"==typeof t[n]){var a=i;for(var s in t[n])a=o[t[n][s]](a);return a}return o[t[n]](i)}}(n);else console.log("colors.setTheme now only accepts an object, not a string.  If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));")};var O=function sequencer(t,n){var i=n.split("");return(i=i.map(t)).join("")};for(var A in o.trap=i(348),o.zalgo=i(349),o.maps={},o.maps.america=i(350)(o),o.maps.zebra=i(351)(o),o.maps.rainbow=i(352)(o),o.maps.random=i(353)(o),o.maps)!function(t){o[t]=function(n){return O(o.maps[t],n)}}(A);m(o,function init(){var t={};return Object.keys(M).forEach((function(n){t[n]={get:function(){return build([n])}}})),t}())},function(t,n){t.exports=function isBuffer(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,n){"function"==typeof Object.create?t.exports=function inherits(t,n){t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function inherits(t,n){t.super_=n;var TempCtor=function(){};TempCtor.prototype=n.prototype,t.prototype=new TempCtor,t.prototype.constructor=t}},function(t,n){var i={};t.exports=i;var o={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(o).forEach((function(t){var n=o[t],a=i[t]=[];a.open="["+n[0]+"m",a.close="["+n[1]+"m"}))},function(t,n,i){"use strict";(function(n){var o=i(91),a=i(347),s=n.env,m=void 0;function getSupportLevel(t){return function translateLevel(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(function supportsColor(t){if(!1===m)return 0;if(a("color=16m")||a("color=full")||a("color=truecolor"))return 3;if(a("color=256"))return 2;if(t&&!t.isTTY&&!0!==m)return 0;var i=m?1:0;if("win32"===n.platform){var g=o.release().split(".");return Number(n.versions.node.split(".")[0])>=8&&Number(g[0])>=10&&Number(g[2])>=10586?Number(g[2])>=14931?3:2:1}if("CI"in s)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some((function(t){return t in s}))||"codeship"===s.CI_NAME?1:i;if("TEAMCITY_VERSION"in s)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(s.TEAMCITY_VERSION)?1:0;if("TERM_PROGRAM"in s){var _=parseInt((s.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(s.TERM_PROGRAM){case"iTerm.app":return _>=3?3:2;case"Hyper":return 3;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(s.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(s.TERM)||"COLORTERM"in s?1:(s.TERM,i)}(t))}a("no-color")||a("no-colors")||a("color=false")?m=!1:(a("color")||a("colors")||a("color=true")||a("color=always"))&&(m=!0),"FORCE_COLOR"in s&&(m=0===s.FORCE_COLOR.length||0!==parseInt(s.FORCE_COLOR,10)),t.exports={supportsColor:getSupportLevel,stdout:getSupportLevel(n.stdout),stderr:getSupportLevel(n.stderr)}}).call(this,i(25))},function(t,n,i){"use strict";(function(n){t.exports=function(t,i){var o=(i=i||n.argv).indexOf("--"),a=/^-{1,2}/.test(t)?"":"--",s=i.indexOf(a+t);return-1!==s&&(-1===o||s<o)}}).call(this,i(25))},function(t,n){t.exports=function runTheTrap(t,n){var i="";t=(t=t||"Run the trap, drop the bass").split("");var o={a:["@","Ą","Ⱥ","Ʌ","Δ","Λ","Д"],b:["ß","Ɓ","Ƀ","ɮ","β","฿"],c:["©","Ȼ","Ͼ"],d:["Ð","Ɗ","Ԁ","ԁ","Ԃ","ԃ"],e:["Ë","ĕ","Ǝ","ɘ","Σ","ξ","Ҽ","੬"],f:["Ӻ"],g:["ɢ"],h:["Ħ","ƕ","Ң","Һ","Ӈ","Ԋ"],i:["༏"],j:["Ĵ"],k:["ĸ","Ҡ","Ӄ","Ԟ"],l:["Ĺ"],m:["ʍ","Ӎ","ӎ","Ԡ","ԡ","൩"],n:["Ñ","ŋ","Ɲ","Ͷ","Π","Ҋ"],o:["Ø","õ","ø","Ǿ","ʘ","Ѻ","ם","۝","๏"],p:["Ƿ","Ҏ"],q:["্"],r:["®","Ʀ","Ȑ","Ɍ","ʀ","Я"],s:["§","Ϟ","ϟ","Ϩ"],t:["Ł","Ŧ","ͳ"],u:["Ʊ","Ս"],v:["ט"],w:["Ш","Ѡ","Ѽ","൰"],x:["Ҳ","Ӿ","Ӽ","ӽ"],y:["¥","Ұ","Ӌ"],z:["Ƶ","ɀ"]};return t.forEach((function(t){t=t.toLowerCase();var n=o[t]||[" "],a=Math.floor(Math.random()*n.length);i+=void 0!==o[t]?o[t][a]:t})),i}},function(t,n){t.exports=function zalgo(t,n){t=t||"   he is here   ";var i={up:["̍","̎","̄","̅","̿","̑","̆","̐","͒","͗","͑","̇","̈","̊","͂","̓","̈","͊","͋","͌","̃","̂","̌","͐","̀","́","̋","̏","̒","̓","̔","̽","̉","ͣ","ͤ","ͥ","ͦ","ͧ","ͨ","ͩ","ͪ","ͫ","ͬ","ͭ","ͮ","ͯ","̾","͛","͆","̚"],down:["̖","̗","̘","̙","̜","̝","̞","̟","̠","̤","̥","̦","̩","̪","̫","̬","̭","̮","̯","̰","̱","̲","̳","̹","̺","̻","̼","ͅ","͇","͈","͉","͍","͎","͓","͔","͕","͖","͙","͚","̣"],mid:["̕","̛","̀","́","͘","̡","̢","̧","̨","̴","̵","̶","͜","͝","͞","͟","͠","͢","̸","̷","͡"," ҉"]},o=[].concat(i.up,i.down,i.mid);function randomNumber(t){return Math.floor(Math.random()*t)}function isChar(t){var n=!1;return o.filter((function(i){n=i===t})),n}return function heComes(t,n){var o,a,s="";for(a in(n=n||{}).up=void 0===n.up||n.up,n.mid=void 0===n.mid||n.mid,n.down=void 0===n.down||n.down,n.size=void 0!==n.size?n.size:"maxi",t=t.split(""))if(!isChar(a)){switch(s+=t[a],o={up:0,down:0,mid:0},n.size){case"mini":o.up=randomNumber(8),o.mid=randomNumber(2),o.down=randomNumber(8);break;case"maxi":o.up=randomNumber(16)+3,o.mid=randomNumber(4)+1,o.down=randomNumber(64)+3;break;default:o.up=randomNumber(8)+1,o.mid=randomNumber(6)/2,o.down=randomNumber(8)+1}var m=["up","mid","down"];for(var g in m)for(var _=m[g],S=0;S<=o[_];S++)n[_]&&(s+=i[_][randomNumber(i[_].length)])}return s}(t,n)}},function(t,n){t.exports=function(t){return function(n,i,o){if(" "===n)return n;switch(i%3){case 0:return t.red(n);case 1:return t.white(n);case 2:return t.blue(n)}}}},function(t,n){t.exports=function(t){return function(n,i,o){return i%2==0?n:t.inverse(n)}}},function(t,n){t.exports=function(t){var n=["red","yellow","green","blue","magenta"];return function(i,o,a){return" "===i?i:t[n[o++%n.length]](i)}}},function(t,n){t.exports=function(t){var n=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta","brightYellow","brightRed","brightGreen","brightBlue","brightWhite","brightCyan","brightMagenta"];return function(i,o,a){return" "===i?i:t[n[Math.round(Math.random()*(n.length-2))]](i)}}},function(t,n,i){"use strict";Object.defineProperty(n,"cli",{value:i(355)}),Object.defineProperty(n,"npm",{value:i(356)}),Object.defineProperty(n,"syslog",{value:i(357)})},function(t,n,i){"use strict";n.levels={error:0,warn:1,help:2,data:3,info:4,debug:5,prompt:6,verbose:7,input:8,silly:9},n.colors={error:"red",warn:"yellow",help:"cyan",data:"grey",info:"green",debug:"blue",prompt:"grey",verbose:"cyan",input:"grey",silly:"magenta"}},function(t,n,i){"use strict";n.levels={error:0,warn:1,info:2,http:3,verbose:4,debug:5,silly:6},n.colors={error:"red",warn:"yellow",info:"green",http:"green",verbose:"cyan",debug:"blue",silly:"magenta"}},function(t,n,i){"use strict";n.levels={emerg:0,alert:1,crit:2,error:3,warning:4,notice:5,info:6,debug:7},n.colors={emerg:"red",alert:"yellow",crit:"red",error:"red",warning:"red",notice:"yellow",info:"green",debug:"blue"}},function(t,n,i){"use strict";var o=i(57);t.exports=o((function(t){return t.message="\t".concat(t.message),t}))},function(t,n,i){"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=i(177).Colorizer,a=i(218).Padder,s=i(27),m=s.configs,g=s.MESSAGE,_=function(){function CliFormat(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,CliFormat),t.levels||(t.levels=m.npm.levels),this.colorizer=new o(t),this.padder=new a(t),this.options=t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(CliFormat,[{key:"transform",value:function transform(t,n){return this.colorizer.transform(this.padder.transform(t,n),n),t[g]="".concat(t.level,":").concat(t.message),t}}]),CliFormat}();t.exports=function(t){return new _(t)},t.exports.Format=_},function(t,n,i){"use strict";var o=i(57);function cascade(t){if(t.every(isValidFormat))return function(n){for(var i=n,o=0;o<t.length;o++)if(!(i=t[o].transform(i,t[o].options)))return!1;return i}}function isValidFormat(t){if("function"!=typeof t.transform)throw new Error(["No transform function found on format. Did you create a format instance?","const myFormat = format(formatFn);","const instance = myFormat();"].join("\n"));return!0}t.exports=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=o(cascade(n)),s=a();return s.Format=a.Format,s},t.exports.cascade=cascade},function(t,n,i){"use strict";(function(n){var o=i(57),a=i(27).MESSAGE,s=i(138);function replacer(t,i){return i instanceof n?i.toString("base64"):"bigint"==typeof i?i.toString():i}t.exports=o((function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t[a]=(n.stable?s.stableStringify:s)(t,n.replacer||replacer,n.space),t}))}).call(this,i(31).Buffer)},function(t,n,i){"use strict";var o=i(57);t.exports=o((function(t,n){return n.message?(t.message="[".concat(n.label,"] ").concat(t.message),t):(t.label=n.label,t)}))},function(t,n,i){"use strict";var o=i(57),a=i(27).MESSAGE,s=i(138);t.exports=o((function(t){var n={};return t.message&&(n["@message"]=t.message,delete t.message),t.timestamp&&(n["@timestamp"]=t.timestamp,delete t.timestamp),n["@fields"]=t,t[a]=s(n),t}))},function(t,n,i){"use strict";var o=i(57);function fillExcept(t,n,i){var o=n.reduce((function(n,i){return n[i]=t[i],delete t[i],n}),{}),a=Object.keys(t).reduce((function(n,i){return n[i]=t[i],delete t[i],n}),{});return Object.assign(t,o,function _defineProperty(t,n,i){return n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}({},i,a)),t}function fillWith(t,n,i){return t[i]=n.reduce((function(n,i){return n[i]=t[i],delete t[i],n}),{}),t}t.exports=o((function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="metadata";n.key&&(i=n.key);var o=[];return n.fillExcept||n.fillWith||(o.push("level"),o.push("message")),n.fillExcept&&(o=n.fillExcept),o.length>0?fillExcept(t,o,i):n.fillWith?fillWith(t,n.fillWith,i):t}))},function(t,n,i){"use strict";var o=i(72).inspect,a=i(57),s=i(27),m=s.LEVEL,g=s.MESSAGE,_=s.SPLAT;t.exports=a((function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Object.assign({},t);return delete i[m],delete i[g],delete i[_],t[g]=o(i,!1,n.depth||null,n.colorize),t}))},function(t,n,i){"use strict";function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=i(27).MESSAGE,a=function(){function Printf(t){!function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,Printf),this.template=t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Printf,[{key:"transform",value:function transform(t){return t[o]=this.template(t),t}}]),Printf}();t.exports=function(t){return new a(t)},t.exports.Printf=t.exports.Format=a},function(t,n,i){"use strict";var o=i(57),a=i(27).MESSAGE,s=i(138);t.exports=o((function(t){var n=s(Object.assign({},t,{level:void 0,message:void 0,splat:void 0})),i=t.padding&&t.padding[t.level]||"";return t[a]="{}"!==n?"".concat(t.level,":").concat(i," ").concat(t.message," ").concat(n):"".concat(t.level,":").concat(i," ").concat(t.message),t}))},function(t,n,i){"use strict";function _arrayLikeToArray(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,o=new Array(n);i<n;i++)o[i]=t[i];return o}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=i(72),a=i(27).SPLAT,s=/%[scdjifoO%]/g,m=/%%/g,g=function(){function Splatter(t){!function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,Splatter),this.options=t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Splatter,[{key:"_splat",value:function _splat(t,n){var i=t.message,s=t[a]||t.splat||[],g=i.match(m),_=g&&g.length||0,S=n.length-_-s.length,M=S<0?s.splice(S,-1*S):[],T=M.length;if(T)for(var O=0;O<T;O++)Object.assign(t,M[O]);return t.message=o.format.apply(o,[i].concat(function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function _unsupportedIterableToArray(t,n){if(t){if("string"==typeof t)return _arrayLikeToArray(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,n):void 0}}(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(s))),t}},{key:"transform",value:function transform(t){var n=t.message,i=t[a]||t.splat;if(!i||!i.length)return t;var o=n&&n.match&&n.match(s);if(!o&&(i||i.length)){var m=i.length>1?i.splice(0):i,g=m.length;if(g)for(var _=0;_<g;_++)Object.assign(t,m[_]);return t}return o?this._splat(t,o):t}}]),Splatter}();t.exports=function(t){return new g(t)}},function(t,n,i){"use strict";var o=i(370),a=i(57);t.exports=a((function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.format&&(t.timestamp="function"==typeof n.format?n.format():o.format(new Date,n.format)),t.timestamp||(t.timestamp=(new Date).toISOString()),n.alias&&(t[n.alias]=t.timestamp),t}))},function(t,n,i){"use strict";i.r(n),i.d(n,"assign",(function(){return assign})),i.d(n,"format",(function(){return format})),i.d(n,"parse",(function(){return parse})),i.d(n,"defaultI18n",(function(){return S})),i.d(n,"setGlobalDateI18n",(function(){return setGlobalDateI18n})),i.d(n,"setGlobalDateMasks",(function(){return setGlobalDateMasks}));var o=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|Z|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,a="[^\\s]+",s=/\[([^]*?)\]/gm;function shorten(t,n){for(var i=[],o=0,a=t.length;o<a;o++)i.push(t[o].substr(0,n));return i}var monthUpdate=function(t){return function(n,i){var o=i[t].map((function(t){return t.toLowerCase()})).indexOf(n.toLowerCase());return o>-1?o:null}};function assign(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];for(var o=0,a=n;o<a.length;o++){var s=a[o];for(var m in s)t[m]=s[m]}return t}var m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=["January","February","March","April","May","June","July","August","September","October","November","December"],_=shorten(g,3),S={dayNamesShort:shorten(m,3),dayNames:m,monthNamesShort:_,monthNames:g,amPm:["am","pm"],DoFn:function(t){return t+["th","st","nd","rd"][t%10>3?0:(t-t%10!=10?1:0)*t%10]}},M=assign({},S),setGlobalDateI18n=function(t){return M=assign(M,t)},regexEscape=function(t){return t.replace(/[|\\{()[^$+*?.-]/g,"\\$&")},pad=function(t,n){for(void 0===n&&(n=2),t=String(t);t.length<n;)t="0"+t;return t},T={D:function(t){return String(t.getDate())},DD:function(t){return pad(t.getDate())},Do:function(t,n){return n.DoFn(t.getDate())},d:function(t){return String(t.getDay())},dd:function(t){return pad(t.getDay())},ddd:function(t,n){return n.dayNamesShort[t.getDay()]},dddd:function(t,n){return n.dayNames[t.getDay()]},M:function(t){return String(t.getMonth()+1)},MM:function(t){return pad(t.getMonth()+1)},MMM:function(t,n){return n.monthNamesShort[t.getMonth()]},MMMM:function(t,n){return n.monthNames[t.getMonth()]},YY:function(t){return pad(String(t.getFullYear()),4).substr(2)},YYYY:function(t){return pad(t.getFullYear(),4)},h:function(t){return String(t.getHours()%12||12)},hh:function(t){return pad(t.getHours()%12||12)},H:function(t){return String(t.getHours())},HH:function(t){return pad(t.getHours())},m:function(t){return String(t.getMinutes())},mm:function(t){return pad(t.getMinutes())},s:function(t){return String(t.getSeconds())},ss:function(t){return pad(t.getSeconds())},S:function(t){return String(Math.round(t.getMilliseconds()/100))},SS:function(t){return pad(Math.round(t.getMilliseconds()/10),2)},SSS:function(t){return pad(t.getMilliseconds(),3)},a:function(t,n){return t.getHours()<12?n.amPm[0]:n.amPm[1]},A:function(t,n){return t.getHours()<12?n.amPm[0].toUpperCase():n.amPm[1].toUpperCase()},ZZ:function(t){var n=t.getTimezoneOffset();return(n>0?"-":"+")+pad(100*Math.floor(Math.abs(n)/60)+Math.abs(n)%60,4)},Z:function(t){var n=t.getTimezoneOffset();return(n>0?"-":"+")+pad(Math.floor(Math.abs(n)/60),2)+":"+pad(Math.abs(n)%60,2)}},monthParse=function(t){return+t-1},O=[null,"[1-9]\\d?"],A=[null,a],P=["isPm",a,function(t,n){var i=t.toLowerCase();return i===n.amPm[0]?0:i===n.amPm[1]?1:null}],L=["timezoneOffset","[^\\s]*?[\\+\\-]\\d\\d:?\\d\\d|[^\\s]*?Z?",function(t){var n=(t+"").match(/([+-]|\d\d)/gi);if(n){var i=60*+n[1]+parseInt(n[2],10);return"+"===n[0]?i:-i}return 0}],R={D:["day","[1-9]\\d?"],DD:["day","\\d\\d"],Do:["day","[1-9]\\d?"+a,function(t){return parseInt(t,10)}],M:["month","[1-9]\\d?",monthParse],MM:["month","\\d\\d",monthParse],YY:["year","\\d\\d",function(t){var n=+(""+(new Date).getFullYear()).substr(0,2);return+(""+(+t>68?n-1:n)+t)}],h:["hour","[1-9]\\d?",void 0,"isPm"],hh:["hour","\\d\\d",void 0,"isPm"],H:["hour","[1-9]\\d?"],HH:["hour","\\d\\d"],m:["minute","[1-9]\\d?"],mm:["minute","\\d\\d"],s:["second","[1-9]\\d?"],ss:["second","\\d\\d"],YYYY:["year","\\d{4}"],S:["millisecond","\\d",function(t){return 100*+t}],SS:["millisecond","\\d\\d",function(t){return 10*+t}],SSS:["millisecond","\\d{3}"],d:O,dd:O,ddd:A,dddd:A,MMM:["month",a,monthUpdate("monthNamesShort")],MMMM:["month",a,monthUpdate("monthNames")],a:P,A:P,ZZ:L,Z:L},N={default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",isoDate:"YYYY-MM-DD",isoDateTime:"YYYY-MM-DDTHH:mm:ssZ",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},setGlobalDateMasks=function(t){return assign(N,t)},format=function(t,n,i){if(void 0===n&&(n=N.default),void 0===i&&(i={}),"number"==typeof t&&(t=new Date(t)),"[object Date]"!==Object.prototype.toString.call(t)||isNaN(t.getTime()))throw new Error("Invalid Date pass to format");var a=[];n=(n=N[n]||n).replace(s,(function(t,n){return a.push(n),"@@@"}));var m=assign(assign({},M),i);return(n=n.replace(o,(function(n){return T[n](t,m)}))).replace(/@@@/g,(function(){return a.shift()}))};function parse(t,n,i){if(void 0===i&&(i={}),"string"!=typeof n)throw new Error("Invalid format in fecha parse");if(n=N[n]||n,t.length>1e3)return null;var a={year:(new Date).getFullYear(),month:0,day:1,hour:0,minute:0,second:0,millisecond:0,isPm:null,timezoneOffset:null},m=[],g=[],_=n.replace(s,(function(t,n){return g.push(regexEscape(n)),"@@@"})),S={},T={};_=regexEscape(_).replace(o,(function(t){var n=R[t],i=n[0],o=n[1],a=n[3];if(S[i])throw new Error("Invalid format. "+i+" specified twice in format");return S[i]=!0,a&&(T[a]=!0),m.push(n),"("+o+")"})),Object.keys(T).forEach((function(t){if(!S[t])throw new Error("Invalid format. "+t+" is required in specified format")})),_=_.replace(/@@@/g,(function(){return g.shift()}));var O=t.match(new RegExp(_,"i"));if(!O)return null;for(var A=assign(assign({},M),i),P=1;P<O.length;P++){var L=m[P-1],I=L[0],j=L[2],V=j?j(O[P],A):+O[P];if(null==V)return null;a[I]=V}1===a.isPm&&null!=a.hour&&12!=+a.hour?a.hour=+a.hour+12:0===a.isPm&&12==+a.hour&&(a.hour=0);for(var U=new Date(a.year,a.month,a.day,a.hour,a.minute,a.second,a.millisecond),G=[["month","getMonth"],["day","getDate"],["hour","getHours"],["minute","getMinutes"],["second","getSeconds"]],z=(P=0,G.length);P<z;P++)if(S[G[P][0]]&&a[G[P][0]]!==U[G[P][1]]())return null;return null==a.timezoneOffset?U:new Date(Date.UTC(a.year,a.month,a.day,a.hour,a.minute-a.timezoneOffset,a.second,a.millisecond))}var I={format,parse,defaultI18n:S,setGlobalDateI18n,setGlobalDateMasks};n.default=I},function(t,n,i){"use strict";var o=i(217),a=i(57),s=i(27).MESSAGE;t.exports=a((function(t,n){return!1!==n.level&&(t.level=o.strip(t.level)),!1!==n.message&&(t.message=o.strip(t.message)),!1!==n.raw&&t[s]&&(t[s]=o.strip(t[s])),t}))},function(t){t.exports=JSON.parse('{"name":"winston","description":"A logger for just about everything.","version":"3.3.3","author":"Charlie Robbins <charlie.robbins@gmail.com>","maintainers":["Jarrett Cruger <jcrugzz@gmail.com>","Chris Alderson <chrisalderson@protonmail.com>","David Hyde <dabh@stanford.edu>"],"repository":{"type":"git","url":"https://github.com/winstonjs/winston.git"},"keywords":["winston","logger","logging","logs","sysadmin","bunyan","pino","loglevel","tools","json","stream"],"dependencies":{"async":"^3.1.0","@dabh/diagnostics":"^2.0.2","is-stream":"^2.0.0","logform":"^2.2.0","one-time":"^1.0.0","readable-stream":"^3.4.0","stack-trace":"0.0.x","triple-beam":"^1.3.0","winston-transport":"^4.4.0"},"devDependencies":{"@babel/cli":"^7.10.3","@babel/core":"^7.10.3","@babel/preset-env":"^7.10.3","@types/node":"^14.0.13","abstract-winston-transport":"^0.5.1","assume":"^2.2.0","colors":"^1.4.0","cross-spawn-async":"^2.2.5","eslint-config-populist":"^4.2.0","hock":"^1.4.1","mocha":"^8.0.1","nyc":"^15.1.0","rimraf":"^3.0.2","split2":"^3.1.1","std-mocks":"^1.0.1","through2":"^3.0.1","winston-compat":"^0.1.5"},"main":"./lib/winston","browser":"./dist/winston","types":"./index.d.ts","scripts":{"lint":"populist lib/*.js lib/winston/*.js lib/winston/**/*.js","pretest":"npm run lint","test":"nyc --reporter=text --reporter lcov npm run test:mocha","test:mocha":"mocha test/*.test.js test/**/*.test.js --exit","build":"./node_modules/.bin/rimraf dist && babel lib -d dist","prepublishOnly":"npm run build"},"engines":{"node":">= 6.4.0"},"license":"MIT"}')},function(t,n,i){"use strict";Object.defineProperty(n,"Console",{configurable:!0,enumerable:!0,get:function get(){return i(374)}}),Object.defineProperty(n,"File",{configurable:!0,enumerable:!0,get:function get(){return i(381)}}),Object.defineProperty(n,"Http",{configurable:!0,enumerable:!0,get:function get(){return i(418)}}),Object.defineProperty(n,"Stream",{configurable:!0,enumerable:!0,get:function get(){return i(429)}})},function(t,n,i){"use strict";(function(n){function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,n){return t.__proto__=n,t})(t,n)}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):n}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=i(91),a=i(27),s=a.LEVEL,m=a.MESSAGE,g=i(79);t.exports=function(t){!function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_setPrototypeOf(t,n)}(Console,t);var i=function _createSuper(t){var n=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var i,o=_getPrototypeOf(t);if(n){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}(Console);function Console(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,Console),(t=i.call(this,n)).name=n.name||"console",t.stderrLevels=t._stringArrayToSet(n.stderrLevels),t.consoleWarnLevels=t._stringArrayToSet(n.consoleWarnLevels),t.eol=n.eol||o.EOL,t.setMaxListeners(30),t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Console,[{key:"log",value:function log(t,i){var o=this;return n((function(){return o.emit("logged",t)})),this.stderrLevels[t[s]]?(console._stderr?console._stderr.write("".concat(t[m]).concat(this.eol)):console.error(t[m]),void(i&&i())):this.consoleWarnLevels[t[s]]?(console._stderr?console._stderr.write("".concat(t[m]).concat(this.eol)):console.warn(t[m]),void(i&&i())):(console._stdout?console._stdout.write("".concat(t[m]).concat(this.eol)):console.log(t[m]),void(i&&i()))}},{key:"_stringArrayToSet",value:function _stringArrayToSet(t,n){if(!t)return{};if(n=n||"Cannot make set from type other than Array of string elements",!Array.isArray(t))throw new Error(n);return t.reduce((function(t,i){if("string"!=typeof i)throw new Error(n);return t[i]=!0,t}),{})}}]),Console}(g)}).call(this,i(78).setImmediate)},function(t,n,i){(function(t,n){!function(t,i){"use strict";if(!t.setImmediate){var o,a=1,s={},m=!1,g=t.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(t);_=_&&_.setTimeout?_:t,"[object process]"==={}.toString.call(t.process)?function installNextTickImplementation(){o=function(t){n.nextTick((function(){runIfPresent(t)}))}}():function canUsePostMessage(){if(t.postMessage&&!t.importScripts){var n=!0,i=t.onmessage;return t.onmessage=function(){n=!1},t.postMessage("","*"),t.onmessage=i,n}}()?function installPostMessageImplementation(){var n="setImmediate$"+Math.random()+"$",onGlobalMessage=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(n)&&runIfPresent(+i.data.slice(n.length))};t.addEventListener?t.addEventListener("message",onGlobalMessage,!1):t.attachEvent("onmessage",onGlobalMessage),o=function(i){t.postMessage(n+i,"*")}}():t.MessageChannel?function installMessageChannelImplementation(){var t=new MessageChannel;t.port1.onmessage=function(t){runIfPresent(t.data)},o=function(n){t.port2.postMessage(n)}}():g&&"onreadystatechange"in g.createElement("script")?function installReadyStateChangeImplementation(){var t=g.documentElement;o=function(n){var i=g.createElement("script");i.onreadystatechange=function(){runIfPresent(n),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}():function installSetTimeoutImplementation(){o=function(t){setTimeout(runIfPresent,0,t)}}(),_.setImmediate=function setImmediate(t){"function"!=typeof t&&(t=new Function(""+t));for(var n=new Array(arguments.length-1),i=0;i<n.length;i++)n[i]=arguments[i+1];var m={callback:t,args:n};return s[a]=m,o(a),a++},_.clearImmediate=clearImmediate}function clearImmediate(t){delete s[t]}function runIfPresent(t){if(m)setTimeout(runIfPresent,0,t);else{var n=s[t];if(n){m=!0;try{!function run(t){var n=t.callback,i=t.args;switch(i.length){case 0:n();break;case 1:n(i[0]);break;case 2:n(i[0],i[1]);break;case 3:n(i[0],i[1],i[2]);break;default:n.apply(void 0,i)}}(n)}finally{clearImmediate(t),m=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(33),i(25))},function(t,n){},function(t,n,i){"use strict";var o=i(179).Buffer,a=i(378);t.exports=function(){function BufferList(){!function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function push(t){var n={data:t,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length},BufferList.prototype.unshift=function unshift(t){var n={data:t,next:this.head};0===this.length&&(this.tail=n),this.head=n,++this.length},BufferList.prototype.shift=function shift(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},BufferList.prototype.clear=function clear(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function join(t){if(0===this.length)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=t+n.data;return i},BufferList.prototype.concat=function concat(t){if(0===this.length)return o.alloc(0);if(1===this.length)return this.head.data;for(var n,i,a=o.allocUnsafe(t>>>0),s=this.head,m=0;s;)n=a,i=m,s.data.copy(n,i),m+=s.data.length,s=s.next;return a},BufferList}(),a&&a.inspect&&a.inspect.custom&&(t.exports.prototype[a.inspect.custom]=function(){var t=a.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,n){},function(t,n,i){var o=i(31),a=o.Buffer;function copyProps(t,n){for(var i in t)n[i]=t[i]}function SafeBuffer(t,n,i){return a(t,n,i)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?t.exports=o:(copyProps(o,n),n.Buffer=SafeBuffer),SafeBuffer.prototype=Object.create(a.prototype),copyProps(a,SafeBuffer),SafeBuffer.from=function(t,n,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return a(t,n,i)},SafeBuffer.alloc=function(t,n,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var o=a(t);return void 0!==n?"string"==typeof i?o.fill(n,i):o.fill(n):o.fill(0),o},SafeBuffer.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return a(t)},SafeBuffer.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return o.SlowBuffer(t)}},function(t,n,i){"use strict";var o=i(72),a=i(27).LEVEL,s=i(79),m=t.exports=function LegacyTransportStream(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(s.call(this,t),!t.transport||"function"!=typeof t.transport.log)throw new Error("Invalid transport, must be an object with a log method.");function transportError(t){this.emit("error",t,this.transport)}this.transport=t.transport,this.level=this.level||t.transport.level,this.handleExceptions=this.handleExceptions||t.transport.handleExceptions,this._deprecated(),this.transport.__winstonError||(this.transport.__winstonError=transportError.bind(this),this.transport.on("error",this.transport.__winstonError))};o.inherits(m,s),m.prototype._write=function _write(t,n,i){if(this.silent||!0===t.exception&&!this.handleExceptions)return i(null);(!this.level||this.levels[this.level]>=this.levels[t[a]])&&this.transport.log(t[a],t.message,t,this._nop),i(null)},m.prototype._writev=function _writev(t,n){for(var i=0;i<t.length;i++)this._accept(t[i])&&(this.transport.log(t[i].chunk[a],t[i].chunk.message,t[i].chunk,this._nop),t[i].callback());return n(null)},m.prototype._deprecated=function _deprecated(){console.error([this.transport.name+" is a legacy winston transport. Consider upgrading: ","- Upgrade docs: https://github.com/winstonjs/winston/blob/master/UPGRADE-3.0.md"].join("\n"))},m.prototype.close=function close(){this.transport.close&&this.transport.close(),this.transport.__winstonError&&(this.transport.removeListener("error",this.transport.__winstonError),this.transport.__winstonError=null)}},function(t,n,i){"use strict";(function(n,o){function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,n){return t.__proto__=n,t})(t,n)}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?_assertThisInitialized(t):n}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var a=i(225),s=i(180),m=i(382),g=i(392),_=i(27).MESSAGE,S=i(123),M=S.Stream,T=S.PassThrough,O=i(79),A=i(141)("winston:file"),P=i(91),L=i(417);t.exports=function(t){!function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_setPrototypeOf(t,n)}(File,t);var i=function _createSuper(t){var n=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var i,o=_getPrototypeOf(t);if(n){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}(File);function File(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};function throwIf(t){for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];o.slice(1).forEach((function(i){if(n[i])throw new Error("Cannot set ".concat(i," and ").concat(t," together"))}))}if(_classCallCheck(this,File),(t=i.call(this,n)).name=n.name||"file",t._stream=new T,t._stream.setMaxListeners(30),t._onError=t._onError.bind(_assertThisInitialized(t)),n.filename||n.dirname)throwIf("filename or dirname","stream"),t._basename=t.filename=n.filename?s.basename(n.filename):"winston.log",t.dirname=n.dirname||s.dirname(n.filename),t.options=n.options||{flags:"a"};else{if(!n.stream)throw new Error("Cannot log to file without filename or stream.");console.warn("options.stream will be removed in winston@4. Use winston.transports.Stream"),throwIf("stream","filename","maxsize"),t._dest=t._stream.pipe(t._setupStream(n.stream)),t.dirname=s.dirname(t._dest.path)}return t.maxsize=n.maxsize||null,t.rotationFormat=n.rotationFormat||!1,t.zippedArchive=n.zippedArchive||!1,t.maxFiles=n.maxFiles||null,t.eol=n.eol||P.EOL,t.tailable=n.tailable||!1,t._size=0,t._pendingSize=0,t._created=0,t._drain=!1,t._opening=!1,t._ending=!1,t.dirname&&t._createLogDirIfNotExist(t.dirname),t.open(),t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(File,[{key:"finishIfEnding",value:function finishIfEnding(){var t=this;this._ending&&(this._opening?this.once("open",(function(){t._stream.once("finish",(function(){return t.emit("finish")})),n((function(){return t._stream.end()}))})):(this._stream.once("finish",(function(){return t.emit("finish")})),n((function(){return t._stream.end()}))))}},{key:"log",value:function log(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(this.silent)return i(),!0;if(this._drain)this._stream.once("drain",(function(){n._drain=!1,n.log(t,i)}));else{if(!this._rotate){var a="".concat(t[_]).concat(this.eol),s=o.byteLength(a);this._pendingSize+=s,this._opening&&!this.rotatedWhileOpening&&this._needsNewFile(this._size+this._pendingSize)&&(this.rotatedWhileOpening=!0);var m=this._stream.write(a,logged.bind(this));return m?i():(this._drain=!0,this._stream.once("drain",(function(){n._drain=!1,i()}))),A("written",m,this._drain),this.finishIfEnding(),m}this._stream.once("rotate",(function(){n._rotate=!1,n.log(t,i)}))}function logged(){var n=this;this._size+=s,this._pendingSize-=s,A("logged %s %s",this._size,a),this.emit("logged",t),this._opening||this._needsNewFile()&&(this._rotate=!0,this._endStream((function(){return n._rotateFile()})))}}},{key:"query",value:function query(t,n){"function"==typeof t&&(n=t,t={}),t=function normalizeQuery(t){return(t=t||{}).rows=t.rows||t.limit||10,t.start=t.start||0,t.until=t.until||new Date,"object"!==_typeof(t.until)&&(t.until=new Date(t.until)),t.from=t.from||t.until-864e5,"object"!==_typeof(t.from)&&(t.from=new Date(t.from)),t.order=t.order||"desc",t}(t);var i=s.join(this.dirname,this.filename),o="",m=[],g=0,_=a.createReadStream(i,{encoding:"utf8"});function add(n,i){try{var o=JSON.parse(n);(function check(n){if(n&&"object"===_typeof(n)){var i=new Date(n.timestamp);if(!(t.from&&i<t.from||t.until&&i>t.until||t.level&&t.level!==n.level))return!0}})(o)&&function push(n){t.rows&&m.length>=t.rows&&"desc"!==t.order?_.readable&&_.destroy():(t.fields&&(n=t.fields.reduce((function(t,i){return t[i]=n[i],t}),{})),"desc"===t.order&&m.length>=t.rows&&m.shift(),m.push(n))}(o)}catch(t){i||_.emit("error",t)}}_.on("error",(function(t){if(_.readable&&_.destroy(),n)return"ENOENT"!==t.code?n(t):n(null,m)})),_.on("data",(function(n){for(var i=(n=(o+n).split(/\n+/)).length-1,a=0;a<i;a++)(!t.start||g>=t.start)&&add(n[a]),g++;o=n[i]})),_.on("close",(function(){o&&add(o,!0),"desc"===t.order&&(m=m.reverse()),n&&n(null,m)}))}},{key:"stream",value:function stream(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=s.join(this.dirname,this.filename),stream=new M,i={file:n,start:t.start};return stream.destroy=L(i,(function(t,n){if(t)return stream.emit("error",t);try{stream.emit("data",n),n=JSON.parse(n),stream.emit("log",n)}catch(t){stream.emit("error",t)}})),stream}},{key:"open",value:function open(){var t=this;this.filename&&(this._opening||(this._opening=!0,this.stat((function(n,i){if(n)return t.emit("error",n);A("stat done: %s { size: %s }",t.filename,i),t._size=i,t._dest=t._createStream(t._stream),t._opening=!1,t.once("open",(function(){t._stream.eventNames().includes("rotate")?t._stream.emit("rotate"):t._rotate=!1}))}))))}},{key:"stat",value:function stat(t){var n=this,i=this._getFile(),o=s.join(this.dirname,i);a.stat(o,(function(a,s){return a&&"ENOENT"===a.code?(A("ENOENT ok",o),n.filename=i,t(null,0)):a?(A("err ".concat(a.code," ").concat(o)),t(a)):!s||n._needsNewFile(s.size)?n._incFile((function(){return n.stat(t)})):(n.filename=i,void t(null,s.size))}))}},{key:"close",value:function close(t){var n=this;this._stream&&this._stream.end((function(){t&&t(),n.emit("flush"),n.emit("closed")}))}},{key:"_needsNewFile",value:function _needsNewFile(t){return t=t||this._size,this.maxsize&&t>=this.maxsize}},{key:"_onError",value:function _onError(t){this.emit("error",t)}},{key:"_setupStream",value:function _setupStream(t){return t.on("error",this._onError),t}},{key:"_cleanupStream",value:function _cleanupStream(t){return t.removeListener("error",this._onError),t}},{key:"_rotateFile",value:function _rotateFile(){var t=this;this._incFile((function(){return t.open()}))}},{key:"_endStream",value:function _endStream(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._dest?(this._stream.unpipe(this._dest),this._dest.end((function(){t._cleanupStream(t._dest),n()}))):n()}},{key:"_createStream",value:function _createStream(t){var n=this,i=s.join(this.dirname,this.filename);A("create stream start",i,this.options);var o=a.createWriteStream(i,this.options).on("error",(function(t){return A(t)})).on("close",(function(){return A("close",o.path,o.bytesWritten)})).on("open",(function(){A("file open ok",i),n.emit("open",i),t.pipe(o),n.rotatedWhileOpening&&(n._stream=new T,n._stream.setMaxListeners(30),n._rotateFile(),n.rotatedWhileOpening=!1,n._cleanupStream(o),t.end())}));if(A("create stream ok",i),this.zippedArchive){var m=g.createGzip();return m.pipe(o),m}return o}},{key:"_incFile",value:function _incFile(t){A("_incFile",this.filename);var n=s.extname(this._basename),i=s.basename(this._basename,n);this.tailable?this._checkMaxFilesTailable(n,i,t):(this._created+=1,this._checkMaxFilesIncrementing(n,i,t))}},{key:"_getFile",value:function _getFile(){var t=s.extname(this._basename),n=s.basename(this._basename,t),i=this.rotationFormat?this.rotationFormat():this._created,o=!this.tailable&&this._created?"".concat(n).concat(i).concat(t):"".concat(n).concat(t);return this.zippedArchive&&!this.tailable?"".concat(o,".gz"):o}},{key:"_checkMaxFilesIncrementing",value:function _checkMaxFilesIncrementing(t,i,o){if(!this.maxFiles||this._created<this.maxFiles)return n(o);var m=this._created-this.maxFiles,g=0!==m?m:"",_=this.zippedArchive?".gz":"",S="".concat(i).concat(g).concat(t).concat(_),M=s.join(this.dirname,S);a.unlink(M,o)}},{key:"_checkMaxFilesTailable",value:function _checkMaxFilesTailable(t,n,i){var o=this,g=[];if(this.maxFiles){for(var _=this.zippedArchive?".gz":"",S=this.maxFiles-1;S>1;S--)g.push(function(i,o){var m=this,g="".concat(n).concat(i-1).concat(t).concat(_),S=s.join(this.dirname,g);a.exists(S,(function(M){if(!M)return o(null);g="".concat(n).concat(i).concat(t).concat(_),a.rename(S,s.join(m.dirname,g),o)}))}.bind(this,S));m(g,(function(){a.rename(s.join(o.dirname,"".concat(n).concat(t)),s.join(o.dirname,"".concat(n,"1").concat(t).concat(_)),i)}))}}},{key:"_createLogDirIfNotExist",value:function _createLogDirIfNotExist(t){a.existsSync(t)||a.mkdirSync(t,{recursive:!0})}}]),File}(O)}).call(this,i(78).setImmediate,i(31).Buffer)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function series(t,n){return(0,o.default)(a.default,t,n)};var o=_interopRequireDefault(i(383)),a=_interopRequireDefault(i(387));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=_interopRequireDefault(i(181)),a=_interopRequireDefault(i(92)),s=_interopRequireDefault(i(121));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}n.default=(0,s.default)((t,n,i)=>{var s=(0,o.default)(n)?[]:{};t(n,(t,n,i)=>{(0,a.default)(t)((t,...o)=>{o.length<2&&([o]=o),s[n]=o,i(t)})},t=>i(t,s))},3),t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function asyncify(t){return(0,s.isAsync)(t)?function(...n){const i=n.pop();return handlePromise(t.apply(this,n),i)}:(0,o.default)((function(n,i){var o;try{o=t.apply(this,n)}catch(t){return i(t)}if(o&&"function"==typeof o.then)return handlePromise(o,i);i(null,o)}))};var o=_interopRequireDefault(i(385)),a=_interopRequireDefault(i(386)),s=i(92);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function handlePromise(t,n){return t.then(t=>{invokeCallback(n,null,t)},t=>{invokeCallback(n,t&&t.message?t:new Error(t))})}function invokeCallback(t,n,i){try{t(n,i)}catch(t){(0,a.default)(t=>{throw t},t)}}t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){return function(...n){var i=n.pop();return t.call(this,n,i)}},t.exports=n.default},function(t,n,i){"use strict";(function(t,i){Object.defineProperty(n,"__esModule",{value:!0}),n.fallback=fallback,n.wrap=wrap;var o,a=n.hasSetImmediate="function"==typeof t&&t,s=n.hasNextTick="object"==typeof i&&"function"==typeof i.nextTick;function fallback(t){setTimeout(t,0)}function wrap(t){return(n,...i)=>t(()=>n(...i))}o=a?t:s?i.nextTick:fallback,n.default=wrap(o)}).call(this,i(78).setImmediate,i(25))},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=_interopRequireDefault(i(226)),a=_interopRequireDefault(i(121));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}n.default=(0,a.default)((function eachOfSeries(t,n,i){return(0,o.default)(t,1,n,i)}),3),t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=_interopRequireDefault(i(227)),a=_interopRequireDefault(i(389)),s=_interopRequireDefault(i(228)),m=i(92),g=_interopRequireDefault(i(391)),_=_interopRequireDefault(i(182));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}n.default=t=>(n,i,S)=>{if(S=(0,o.default)(S),t<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!n)return S(null);if((0,m.isAsyncGenerator)(n))return(0,g.default)(n,t,i,S);if((0,m.isAsyncIterable)(n))return(0,g.default)(n[Symbol.asyncIterator](),t,i,S);var M=(0,a.default)(n),T=!1,O=!1,A=0,P=!1;function iterateeCallback(t,n){if(!O)if(A-=1,t)T=!0,S(t);else if(!1===t)T=!0,O=!0;else{if(n===_.default||T&&A<=0)return T=!0,S(null);P||replenish()}}function replenish(){for(P=!0;A<t&&!T;){var n=M();if(null===n)return T=!0,void(A<=0&&S(null));A+=1,i(n.value,n.key,(0,s.default)(iterateeCallback))}P=!1}replenish()},t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function createIterator(t){if((0,o.default)(t))return function createArrayIterator(t){var n=-1,i=t.length;return function next(){return++n<i?{value:t[n],key:n}:null}}(t);var n=(0,a.default)(t);return n?function createES2015Iterator(t){var n=-1;return function next(){var i=t.next();return i.done?null:(n++,{value:i.value,key:n})}}(n):function createObjectIterator(t){var n=t?Object.keys(t):[],i=-1,o=n.length;return function next(){var a=n[++i];return i<o?{value:t[a],key:a}:null}}(t)};var o=_interopRequireDefault(i(181)),a=_interopRequireDefault(i(390));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function asyncEachOfLimit(t,n,i,a){let s=!1,m=!1,g=!1,_=0,S=0;function replenish(){_>=n||g||s||(g=!0,t.next().then(({value:t,done:n})=>{if(!m&&!s){if(g=!1,n)return s=!0,void(_<=0&&a(null));_++,i(t,S,iterateeCallback),S++,replenish()}}).catch(handleError))}function iterateeCallback(t,n){if(_-=1,!m)return t?handleError(t):!1===t?(s=!0,void(m=!0)):n===o.default||s&&_<=0?(s=!0,a(null)):void replenish()}function handleError(t){m||(g=!1,s=!0,a(t))}replenish()};var o=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(i(182));t.exports=n.default},function(t,n,i){"use strict";(function(t){var o=i(31).Buffer,a=i(393).Transform,s=i(398),m=i(72),g=i(230).ok,_=i(31).kMaxLength,S="Cannot create final Buffer. It would be larger than 0x"+_.toString(16)+" bytes";s.Z_MIN_WINDOWBITS=8,s.Z_MAX_WINDOWBITS=15,s.Z_DEFAULT_WINDOWBITS=15,s.Z_MIN_CHUNK=64,s.Z_MAX_CHUNK=1/0,s.Z_DEFAULT_CHUNK=16384,s.Z_MIN_MEMLEVEL=1,s.Z_MAX_MEMLEVEL=9,s.Z_DEFAULT_MEMLEVEL=8,s.Z_MIN_LEVEL=-1,s.Z_MAX_LEVEL=9,s.Z_DEFAULT_LEVEL=s.Z_DEFAULT_COMPRESSION;for(var M=Object.keys(s),T=0;T<M.length;T++){var O=M[T];O.match(/^Z/)&&Object.defineProperty(n,O,{enumerable:!0,value:s[O],writable:!1})}for(var A={Z_OK:s.Z_OK,Z_STREAM_END:s.Z_STREAM_END,Z_NEED_DICT:s.Z_NEED_DICT,Z_ERRNO:s.Z_ERRNO,Z_STREAM_ERROR:s.Z_STREAM_ERROR,Z_DATA_ERROR:s.Z_DATA_ERROR,Z_MEM_ERROR:s.Z_MEM_ERROR,Z_BUF_ERROR:s.Z_BUF_ERROR,Z_VERSION_ERROR:s.Z_VERSION_ERROR},P=Object.keys(A),L=0;L<P.length;L++){var R=P[L];A[A[R]]=R}function zlibBuffer(t,n,i){var a=[],s=0;function flow(){for(var n;null!==(n=t.read());)a.push(n),s+=n.length;t.once("readable",flow)}function onEnd(){var n,m=null;s>=_?m=new RangeError(S):n=o.concat(a,s),a=[],t.close(),i(m,n)}t.on("error",(function onError(n){t.removeListener("end",onEnd),t.removeListener("readable",flow),i(n)})),t.on("end",onEnd),t.end(n),flow()}function zlibBufferSync(t,n){if("string"==typeof n&&(n=o.from(n)),!o.isBuffer(n))throw new TypeError("Not a string or buffer");var i=t._finishFlushFlag;return t._processChunk(n,i)}function Deflate(t){if(!(this instanceof Deflate))return new Deflate(t);Zlib.call(this,t,s.DEFLATE)}function Inflate(t){if(!(this instanceof Inflate))return new Inflate(t);Zlib.call(this,t,s.INFLATE)}function Gzip(t){if(!(this instanceof Gzip))return new Gzip(t);Zlib.call(this,t,s.GZIP)}function Gunzip(t){if(!(this instanceof Gunzip))return new Gunzip(t);Zlib.call(this,t,s.GUNZIP)}function DeflateRaw(t){if(!(this instanceof DeflateRaw))return new DeflateRaw(t);Zlib.call(this,t,s.DEFLATERAW)}function InflateRaw(t){if(!(this instanceof InflateRaw))return new InflateRaw(t);Zlib.call(this,t,s.INFLATERAW)}function Unzip(t){if(!(this instanceof Unzip))return new Unzip(t);Zlib.call(this,t,s.UNZIP)}function isValidFlushFlag(t){return t===s.Z_NO_FLUSH||t===s.Z_PARTIAL_FLUSH||t===s.Z_SYNC_FLUSH||t===s.Z_FULL_FLUSH||t===s.Z_FINISH||t===s.Z_BLOCK}function Zlib(t,i){var m=this;if(this._opts=t=t||{},this._chunkSize=t.chunkSize||n.Z_DEFAULT_CHUNK,a.call(this,t),t.flush&&!isValidFlushFlag(t.flush))throw new Error("Invalid flush flag: "+t.flush);if(t.finishFlush&&!isValidFlushFlag(t.finishFlush))throw new Error("Invalid flush flag: "+t.finishFlush);if(this._flushFlag=t.flush||s.Z_NO_FLUSH,this._finishFlushFlag=void 0!==t.finishFlush?t.finishFlush:s.Z_FINISH,t.chunkSize&&(t.chunkSize<n.Z_MIN_CHUNK||t.chunkSize>n.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+t.chunkSize);if(t.windowBits&&(t.windowBits<n.Z_MIN_WINDOWBITS||t.windowBits>n.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+t.windowBits);if(t.level&&(t.level<n.Z_MIN_LEVEL||t.level>n.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+t.level);if(t.memLevel&&(t.memLevel<n.Z_MIN_MEMLEVEL||t.memLevel>n.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+t.memLevel);if(t.strategy&&t.strategy!=n.Z_FILTERED&&t.strategy!=n.Z_HUFFMAN_ONLY&&t.strategy!=n.Z_RLE&&t.strategy!=n.Z_FIXED&&t.strategy!=n.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+t.strategy);if(t.dictionary&&!o.isBuffer(t.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new s.Zlib(i);var g=this;this._hadError=!1,this._handle.onerror=function(t,i){_close(g),g._hadError=!0;var o=new Error(t);o.errno=i,o.code=n.codes[i],g.emit("error",o)};var _=n.Z_DEFAULT_COMPRESSION;"number"==typeof t.level&&(_=t.level);var S=n.Z_DEFAULT_STRATEGY;"number"==typeof t.strategy&&(S=t.strategy),this._handle.init(t.windowBits||n.Z_DEFAULT_WINDOWBITS,_,t.memLevel||n.Z_DEFAULT_MEMLEVEL,S,t.dictionary),this._buffer=o.allocUnsafe(this._chunkSize),this._offset=0,this._level=_,this._strategy=S,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!m._handle},configurable:!0,enumerable:!0})}function _close(n,i){i&&t.nextTick(i),n._handle&&(n._handle.close(),n._handle=null)}function emitCloseNT(t){t.emit("close")}Object.defineProperty(n,"codes",{enumerable:!0,value:Object.freeze(A),writable:!1}),n.Deflate=Deflate,n.Inflate=Inflate,n.Gzip=Gzip,n.Gunzip=Gunzip,n.DeflateRaw=DeflateRaw,n.InflateRaw=InflateRaw,n.Unzip=Unzip,n.createDeflate=function(t){return new Deflate(t)},n.createInflate=function(t){return new Inflate(t)},n.createDeflateRaw=function(t){return new DeflateRaw(t)},n.createInflateRaw=function(t){return new InflateRaw(t)},n.createGzip=function(t){return new Gzip(t)},n.createGunzip=function(t){return new Gunzip(t)},n.createUnzip=function(t){return new Unzip(t)},n.deflate=function(t,n,i){return"function"==typeof n&&(i=n,n={}),zlibBuffer(new Deflate(n),t,i)},n.deflateSync=function(t,n){return zlibBufferSync(new Deflate(n),t)},n.gzip=function(t,n,i){return"function"==typeof n&&(i=n,n={}),zlibBuffer(new Gzip(n),t,i)},n.gzipSync=function(t,n){return zlibBufferSync(new Gzip(n),t)},n.deflateRaw=function(t,n,i){return"function"==typeof n&&(i=n,n={}),zlibBuffer(new DeflateRaw(n),t,i)},n.deflateRawSync=function(t,n){return zlibBufferSync(new DeflateRaw(n),t)},n.unzip=function(t,n,i){return"function"==typeof n&&(i=n,n={}),zlibBuffer(new Unzip(n),t,i)},n.unzipSync=function(t,n){return zlibBufferSync(new Unzip(n),t)},n.inflate=function(t,n,i){return"function"==typeof n&&(i=n,n={}),zlibBuffer(new Inflate(n),t,i)},n.inflateSync=function(t,n){return zlibBufferSync(new Inflate(n),t)},n.gunzip=function(t,n,i){return"function"==typeof n&&(i=n,n={}),zlibBuffer(new Gunzip(n),t,i)},n.gunzipSync=function(t,n){return zlibBufferSync(new Gunzip(n),t)},n.inflateRaw=function(t,n,i){return"function"==typeof n&&(i=n,n={}),zlibBuffer(new InflateRaw(n),t,i)},n.inflateRawSync=function(t,n){return zlibBufferSync(new InflateRaw(n),t)},m.inherits(Zlib,a),Zlib.prototype.params=function(i,o,a){if(i<n.Z_MIN_LEVEL||i>n.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+i);if(o!=n.Z_FILTERED&&o!=n.Z_HUFFMAN_ONLY&&o!=n.Z_RLE&&o!=n.Z_FIXED&&o!=n.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+o);if(this._level!==i||this._strategy!==o){var m=this;this.flush(s.Z_SYNC_FLUSH,(function(){g(m._handle,"zlib binding closed"),m._handle.params(i,o),m._hadError||(m._level=i,m._strategy=o,a&&a())}))}else t.nextTick(a)},Zlib.prototype.reset=function(){return g(this._handle,"zlib binding closed"),this._handle.reset()},Zlib.prototype._flush=function(t){this._transform(o.alloc(0),"",t)},Zlib.prototype.flush=function(n,i){var a=this,m=this._writableState;("function"==typeof n||void 0===n&&!i)&&(i=n,n=s.Z_FULL_FLUSH),m.ended?i&&t.nextTick(i):m.ending?i&&this.once("end",i):m.needDrain?i&&this.once("drain",(function(){return a.flush(n,i)})):(this._flushFlag=n,this.write(o.alloc(0),"",i))},Zlib.prototype.close=function(n){_close(this,n),t.nextTick(emitCloseNT,this)},Zlib.prototype._transform=function(t,n,i){var a,m=this._writableState,g=(m.ending||m.ended)&&(!t||m.length===t.length);return null===t||o.isBuffer(t)?this._handle?(g?a=this._finishFlushFlag:(a=this._flushFlag,t.length>=m.length&&(this._flushFlag=this._opts.flush||s.Z_NO_FLUSH)),void this._processChunk(t,a,i)):i(new Error("zlib binding closed")):i(new Error("invalid input"))},Zlib.prototype._processChunk=function(t,n,i){var a=t&&t.length,s=this._chunkSize-this._offset,m=0,M=this,T="function"==typeof i;if(!T){var O,A=[],P=0;this.on("error",(function(t){O=t})),g(this._handle,"zlib binding closed");do{var L=this._handle.writeSync(n,t,m,a,this._buffer,this._offset,s)}while(!this._hadError&&callback(L[0],L[1]));if(this._hadError)throw O;if(P>=_)throw _close(this),new RangeError(S);var R=o.concat(A,P);return _close(this),R}g(this._handle,"zlib binding closed");var N=this._handle.write(n,t,m,a,this._buffer,this._offset,s);function callback(_,S){if(this&&(this.buffer=null,this.callback=null),!M._hadError){var O=s-S;if(g(O>=0,"have should not go down"),O>0){var L=M._buffer.slice(M._offset,M._offset+O);M._offset+=O,T?M.push(L):(A.push(L),P+=L.length)}if((0===S||M._offset>=M._chunkSize)&&(s=M._chunkSize,M._offset=0,M._buffer=o.allocUnsafe(M._chunkSize)),0===S){if(m+=a-_,a=_,!T)return!0;var R=M._handle.write(n,t,m,a,M._buffer,M._offset,M._chunkSize);return R.callback=callback,void(R.buffer=t)}if(!T)return!1;i()}}N.buffer=t,N.callback=callback},m.inherits(Deflate,Zlib),m.inherits(Inflate,Zlib),m.inherits(Gzip,Zlib),m.inherits(Gunzip,Zlib),m.inherits(DeflateRaw,Zlib),m.inherits(InflateRaw,Zlib),m.inherits(Unzip,Zlib)}).call(this,i(25))},function(t,n,i){t.exports=Stream;var o=i(119).EventEmitter;function Stream(){o.call(this)}i(45)(Stream,o),Stream.Readable=i(122),Stream.Writable=i(220),Stream.Duplex=i(395),Stream.Transform=i(396),Stream.PassThrough=i(397),Stream.Stream=Stream,Stream.prototype.pipe=function(t,n){var i=this;function ondata(n){t.writable&&!1===t.write(n)&&i.pause&&i.pause()}function ondrain(){i.readable&&i.resume&&i.resume()}i.on("data",ondata),t.on("drain",ondrain),t._isStdio||n&&!1===n.end||(i.on("end",onend),i.on("close",onclose));var a=!1;function onend(){a||(a=!0,t.end())}function onclose(){a||(a=!0,"function"==typeof t.destroy&&t.destroy())}function onerror(t){if(cleanup(),0===o.listenerCount(this,"error"))throw t}function cleanup(){i.removeListener("data",ondata),t.removeListener("drain",ondrain),i.removeListener("end",onend),i.removeListener("close",onclose),i.removeListener("error",onerror),t.removeListener("error",onerror),i.removeListener("end",cleanup),i.removeListener("close",cleanup),t.removeListener("close",cleanup)}return i.on("error",onerror),t.on("error",onerror),i.on("end",cleanup),i.on("close",cleanup),t.on("close",cleanup),t.emit("pipe",i),t}},function(t,n,i){"use strict";t.exports=PassThrough;var o=i(229),a=Object.create(i(118));function PassThrough(t){if(!(this instanceof PassThrough))return new PassThrough(t);o.call(this,t)}a.inherits=i(45),a.inherits(PassThrough,o),PassThrough.prototype._transform=function(t,n,i){i(null,t)}},function(t,n,i){t.exports=i(84)},function(t,n,i){t.exports=i(122).Transform},function(t,n,i){t.exports=i(122).PassThrough},function(t,n,i){"use strict";(function(t,o){var a=i(230),s=i(400),m=i(401),g=i(404),_=i(407);for(var S in _)n[S]=_[S];function Zlib(t){if("number"!=typeof t||t<n.DEFLATE||t>n.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=t,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}n.NONE=0,n.DEFLATE=1,n.INFLATE=2,n.GZIP=3,n.GUNZIP=4,n.DEFLATERAW=5,n.INFLATERAW=6,n.UNZIP=7,Zlib.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,a(this.init_done,"close before init"),a(this.mode<=n.UNZIP),this.mode===n.DEFLATE||this.mode===n.GZIP||this.mode===n.DEFLATERAW?m.deflateEnd(this.strm):this.mode!==n.INFLATE&&this.mode!==n.GUNZIP&&this.mode!==n.INFLATERAW&&this.mode!==n.UNZIP||g.inflateEnd(this.strm),this.mode=n.NONE,this.dictionary=null)},Zlib.prototype.write=function(t,n,i,o,a,s,m){return this._write(!0,t,n,i,o,a,s,m)},Zlib.prototype.writeSync=function(t,n,i,o,a,s,m){return this._write(!1,t,n,i,o,a,s,m)},Zlib.prototype._write=function(i,s,m,g,_,S,M,T){if(a.equal(arguments.length,8),a(this.init_done,"write before init"),a(this.mode!==n.NONE,"already finalized"),a.equal(!1,this.write_in_progress,"write already in progress"),a.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,a.equal(!1,void 0===s,"must provide flush value"),this.write_in_progress=!0,s!==n.Z_NO_FLUSH&&s!==n.Z_PARTIAL_FLUSH&&s!==n.Z_SYNC_FLUSH&&s!==n.Z_FULL_FLUSH&&s!==n.Z_FINISH&&s!==n.Z_BLOCK)throw new Error("Invalid flush value");if(null==m&&(m=t.alloc(0),_=0,g=0),this.strm.avail_in=_,this.strm.input=m,this.strm.next_in=g,this.strm.avail_out=T,this.strm.output=S,this.strm.next_out=M,this.flush=s,!i)return this._process(),this._checkError()?this._afterSync():void 0;var O=this;return o.nextTick((function(){O._process(),O._after()})),this},Zlib.prototype._afterSync=function(){var t=this.strm.avail_out,n=this.strm.avail_in;return this.write_in_progress=!1,[n,t]},Zlib.prototype._process=function(){var t=null;switch(this.mode){case n.DEFLATE:case n.GZIP:case n.DEFLATERAW:this.err=m.deflate(this.strm,this.flush);break;case n.UNZIP:switch(this.strm.avail_in>0&&(t=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===t)break;if(31!==this.strm.input[t]){this.mode=n.INFLATE;break}if(this.gzip_id_bytes_read=1,t++,1===this.strm.avail_in)break;case 1:if(null===t)break;139===this.strm.input[t]?(this.gzip_id_bytes_read=2,this.mode=n.GUNZIP):this.mode=n.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case n.INFLATE:case n.GUNZIP:case n.INFLATERAW:for(this.err=g.inflate(this.strm,this.flush),this.err===n.Z_NEED_DICT&&this.dictionary&&(this.err=g.inflateSetDictionary(this.strm,this.dictionary),this.err===n.Z_OK?this.err=g.inflate(this.strm,this.flush):this.err===n.Z_DATA_ERROR&&(this.err=n.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===n.GUNZIP&&this.err===n.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=g.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},Zlib.prototype._checkError=function(){switch(this.err){case n.Z_OK:case n.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===n.Z_FINISH)return this._error("unexpected end of file"),!1;break;case n.Z_STREAM_END:break;case n.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},Zlib.prototype._after=function(){if(this._checkError()){var t=this.strm.avail_out,n=this.strm.avail_in;this.write_in_progress=!1,this.callback(n,t),this.pending_close&&this.close()}},Zlib.prototype._error=function(t){this.strm.msg&&(t=this.strm.msg),this.onerror(t,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},Zlib.prototype.init=function(t,i,o,s,m){a(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),a(t>=8&&t<=15,"invalid windowBits"),a(i>=-1&&i<=9,"invalid compression level"),a(o>=1&&o<=9,"invalid memlevel"),a(s===n.Z_FILTERED||s===n.Z_HUFFMAN_ONLY||s===n.Z_RLE||s===n.Z_FIXED||s===n.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(i,t,o,s,m),this._setDictionary()},Zlib.prototype.params=function(){throw new Error("deflateParams Not supported")},Zlib.prototype.reset=function(){this._reset(),this._setDictionary()},Zlib.prototype._init=function(t,i,o,a,_){switch(this.level=t,this.windowBits=i,this.memLevel=o,this.strategy=a,this.flush=n.Z_NO_FLUSH,this.err=n.Z_OK,this.mode!==n.GZIP&&this.mode!==n.GUNZIP||(this.windowBits+=16),this.mode===n.UNZIP&&(this.windowBits+=32),this.mode!==n.DEFLATERAW&&this.mode!==n.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new s,this.mode){case n.DEFLATE:case n.GZIP:case n.DEFLATERAW:this.err=m.deflateInit2(this.strm,this.level,n.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case n.INFLATE:case n.GUNZIP:case n.INFLATERAW:case n.UNZIP:this.err=g.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==n.Z_OK&&this._error("Init error"),this.dictionary=_,this.write_in_progress=!1,this.init_done=!0},Zlib.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=n.Z_OK,this.mode){case n.DEFLATE:case n.DEFLATERAW:this.err=m.deflateSetDictionary(this.strm,this.dictionary)}this.err!==n.Z_OK&&this._error("Failed to set dictionary")}},Zlib.prototype._reset=function(){switch(this.err=n.Z_OK,this.mode){case n.DEFLATE:case n.DEFLATERAW:case n.GZIP:this.err=m.deflateReset(this.strm);break;case n.INFLATE:case n.INFLATERAW:case n.GUNZIP:this.err=g.inflateReset(this.strm)}this.err!==n.Z_OK&&this._error("Failed to reset stream")},n.Zlib=Zlib}).call(this,i(31).Buffer,i(25))},function(t,n,i){"use strict";var o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function toObject(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function shouldUseNative(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var n={},i=0;i<10;i++)n["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(n).map((function(t){return n[t]})).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach((function(t){o[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(t){return!1}}()?Object.assign:function(t,n){for(var i,m,g=toObject(t),_=1;_<arguments.length;_++){for(var S in i=Object(arguments[_]))a.call(i,S)&&(g[S]=i[S]);if(o){m=o(i);for(var M=0;M<m.length;M++)s.call(i,m[M])&&(g[m[M]]=i[m[M]])}}return g}},function(t,n,i){"use strict";t.exports=function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,n,i){"use strict";var o,a=i(140),s=i(402),m=i(231),g=i(232),_=i(403);function err(t,n){return t.msg=_[n],n}function rank(t){return(t<<1)-(t>4?9:0)}function zero(t){for(var n=t.length;--n>=0;)t[n]=0}function flush_pending(t){var n=t.state,i=n.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(a.arraySet(t.output,n.pending_buf,n.pending_out,i,t.next_out),t.next_out+=i,n.pending_out+=i,t.total_out+=i,t.avail_out-=i,n.pending-=i,0===n.pending&&(n.pending_out=0))}function flush_block_only(t,n){s._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,n),t.block_start=t.strstart,flush_pending(t.strm)}function put_byte(t,n){t.pending_buf[t.pending++]=n}function putShortMSB(t,n){t.pending_buf[t.pending++]=n>>>8&255,t.pending_buf[t.pending++]=255&n}function longest_match(t,n){var i,o,a=t.max_chain_length,s=t.strstart,m=t.prev_length,g=t.nice_match,_=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,S=t.window,M=t.w_mask,T=t.prev,O=t.strstart+258,A=S[s+m-1],P=S[s+m];t.prev_length>=t.good_match&&(a>>=2),g>t.lookahead&&(g=t.lookahead);do{if(S[(i=n)+m]===P&&S[i+m-1]===A&&S[i]===S[s]&&S[++i]===S[s+1]){s+=2,i++;do{}while(S[++s]===S[++i]&&S[++s]===S[++i]&&S[++s]===S[++i]&&S[++s]===S[++i]&&S[++s]===S[++i]&&S[++s]===S[++i]&&S[++s]===S[++i]&&S[++s]===S[++i]&&s<O);if(o=258-(O-s),s=O-258,o>m){if(t.match_start=n,m=o,o>=g)break;A=S[s+m-1],P=S[s+m]}}}while((n=T[n&M])>_&&0!=--a);return m<=t.lookahead?m:t.lookahead}function fill_window(t){var n,i,o,s,_,S,M,T,O,A,P=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=P+(P-262)){a.arraySet(t.window,t.window,P,P,0),t.match_start-=P,t.strstart-=P,t.block_start-=P,n=i=t.hash_size;do{o=t.head[--n],t.head[n]=o>=P?o-P:0}while(--i);n=i=P;do{o=t.prev[--n],t.prev[n]=o>=P?o-P:0}while(--i);s+=P}if(0===t.strm.avail_in)break;if(S=t.strm,M=t.window,T=t.strstart+t.lookahead,O=s,A=void 0,(A=S.avail_in)>O&&(A=O),i=0===A?0:(S.avail_in-=A,a.arraySet(M,S.input,S.next_in,A,T),1===S.state.wrap?S.adler=m(S.adler,M,A,T):2===S.state.wrap&&(S.adler=g(S.adler,M,A,T)),S.next_in+=A,S.total_in+=A,A),t.lookahead+=i,t.lookahead+t.insert>=3)for(_=t.strstart-t.insert,t.ins_h=t.window[_],t.ins_h=(t.ins_h<<t.hash_shift^t.window[_+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[_+3-1])&t.hash_mask,t.prev[_&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=_,_++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)}function deflate_fast(t,n){for(var i,o;;){if(t.lookahead<262){if(fill_window(t),t.lookahead<262&&0===n)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-262&&(t.match_length=longest_match(t,i)),t.match_length>=3)if(o=s._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else o=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2}function deflate_slow(t,n){for(var i,o,a;;){if(t.lookahead<262){if(fill_window(t),t.lookahead<262&&0===n)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-262&&(t.match_length=longest_match(t,i),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){a=t.strstart+t.lookahead-3,o=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=a&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((o=s._tr_tally(t,0,t.window[t.strstart-1]))&&flush_block_only(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2}function Config(t,n,i,o,a){this.good_length=t,this.max_lazy=n,this.nice_length=i,this.max_chain=o,this.func=a}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(1146),this.dyn_dtree=new a.Buf16(122),this.bl_tree=new a.Buf16(78),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(16),this.heap=new a.Buf16(573),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(573),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(t){var n;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(n=t.state).pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap?42:113,t.adler=2===n.wrap?0:1,n.last_flush=0,s._tr_init(n),0):err(t,-2)}function deflateReset(t){var n=deflateResetKeep(t);return 0===n&&function lm_init(t){t.window_size=2*t.w_size,zero(t.head),t.max_lazy_match=o[t.level].max_lazy,t.good_match=o[t.level].good_length,t.nice_match=o[t.level].nice_length,t.max_chain_length=o[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0}(t.state),n}function deflateInit2(t,n,i,o,s,m){if(!t)return-2;var g=1;if(-1===n&&(n=6),o<0?(g=0,o=-o):o>15&&(g=2,o-=16),s<1||s>9||8!==i||o<8||o>15||n<0||n>9||m<0||m>4)return err(t,-2);8===o&&(o=9);var _=new DeflateState;return t.state=_,_.strm=t,_.wrap=g,_.gzhead=null,_.w_bits=o,_.w_size=1<<_.w_bits,_.w_mask=_.w_size-1,_.hash_bits=s+7,_.hash_size=1<<_.hash_bits,_.hash_mask=_.hash_size-1,_.hash_shift=~~((_.hash_bits+3-1)/3),_.window=new a.Buf8(2*_.w_size),_.head=new a.Buf16(_.hash_size),_.prev=new a.Buf16(_.w_size),_.lit_bufsize=1<<s+6,_.pending_buf_size=4*_.lit_bufsize,_.pending_buf=new a.Buf8(_.pending_buf_size),_.d_buf=1*_.lit_bufsize,_.l_buf=3*_.lit_bufsize,_.level=n,_.strategy=m,_.method=i,deflateReset(t)}o=[new Config(0,0,0,0,(function deflate_stored(t,n){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(fill_window(t),0===t.lookahead&&0===n)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var o=t.block_start+i;if((0===t.strstart||t.strstart>=o)&&(t.lookahead=t.strstart-o,t.strstart=o,flush_block_only(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(flush_block_only(t,!1),t.strm.avail_out),1)})),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],n.deflateInit=function deflateInit(t,n){return deflateInit2(t,n,8,15,8,0)},n.deflateInit2=deflateInit2,n.deflateReset=deflateReset,n.deflateResetKeep=deflateResetKeep,n.deflateSetHeader=function deflateSetHeader(t,n){return t&&t.state?2!==t.state.wrap?-2:(t.state.gzhead=n,0):-2},n.deflate=function deflate(t,n){var i,a,m,_;if(!t||!t.state||n>5||n<0)return t?err(t,-2):-2;if(a=t.state,!t.output||!t.input&&0!==t.avail_in||666===a.status&&4!==n)return err(t,0===t.avail_out?-5:-2);if(a.strm=t,i=a.last_flush,a.last_flush=n,42===a.status)if(2===a.wrap)t.adler=0,put_byte(a,31),put_byte(a,139),put_byte(a,8),a.gzhead?(put_byte(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),put_byte(a,255&a.gzhead.time),put_byte(a,a.gzhead.time>>8&255),put_byte(a,a.gzhead.time>>16&255),put_byte(a,a.gzhead.time>>24&255),put_byte(a,9===a.level?2:a.strategy>=2||a.level<2?4:0),put_byte(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(put_byte(a,255&a.gzhead.extra.length),put_byte(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=g(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,9===a.level?2:a.strategy>=2||a.level<2?4:0),put_byte(a,3),a.status=113);else{var S=8+(a.w_bits-8<<4)<<8;S|=(a.strategy>=2||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(S|=32),S+=31-S%31,a.status=113,putShortMSB(a,S),0!==a.strstart&&(putShortMSB(a,t.adler>>>16),putShortMSB(a,65535&t.adler)),t.adler=1}if(69===a.status)if(a.gzhead.extra){for(m=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>m&&(t.adler=g(t.adler,a.pending_buf,a.pending-m,m)),flush_pending(t),m=a.pending,a.pending!==a.pending_buf_size));)put_byte(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>m&&(t.adler=g(t.adler,a.pending_buf,a.pending-m,m)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){m=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>m&&(t.adler=g(t.adler,a.pending_buf,a.pending-m,m)),flush_pending(t),m=a.pending,a.pending===a.pending_buf_size)){_=1;break}_=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,put_byte(a,_)}while(0!==_);a.gzhead.hcrc&&a.pending>m&&(t.adler=g(t.adler,a.pending_buf,a.pending-m,m)),0===_&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){m=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>m&&(t.adler=g(t.adler,a.pending_buf,a.pending-m,m)),flush_pending(t),m=a.pending,a.pending===a.pending_buf_size)){_=1;break}_=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,put_byte(a,_)}while(0!==_);a.gzhead.hcrc&&a.pending>m&&(t.adler=g(t.adler,a.pending_buf,a.pending-m,m)),0===_&&(a.status=103)}else a.status=103;if(103===a.status&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&flush_pending(t),a.pending+2<=a.pending_buf_size&&(put_byte(a,255&t.adler),put_byte(a,t.adler>>8&255),t.adler=0,a.status=113)):a.status=113),0!==a.pending){if(flush_pending(t),0===t.avail_out)return a.last_flush=-1,0}else if(0===t.avail_in&&rank(n)<=rank(i)&&4!==n)return err(t,-5);if(666===a.status&&0!==t.avail_in)return err(t,-5);if(0!==t.avail_in||0!==a.lookahead||0!==n&&666!==a.status){var M=2===a.strategy?function deflate_huff(t,n){for(var i;;){if(0===t.lookahead&&(fill_window(t),0===t.lookahead)){if(0===n)return 1;break}if(t.match_length=0,i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2}(a,n):3===a.strategy?function deflate_rle(t,n){for(var i,o,a,m,g=t.window;;){if(t.lookahead<=258){if(fill_window(t),t.lookahead<=258&&0===n)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(o=g[a=t.strstart-1])===g[++a]&&o===g[++a]&&o===g[++a]){m=t.strstart+258;do{}while(o===g[++a]&&o===g[++a]&&o===g[++a]&&o===g[++a]&&o===g[++a]&&o===g[++a]&&o===g[++a]&&o===g[++a]&&a<m);t.match_length=258-(m-a),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=s._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2}(a,n):o[a.level].func(a,n);if(3!==M&&4!==M||(a.status=666),1===M||3===M)return 0===t.avail_out&&(a.last_flush=-1),0;if(2===M&&(1===n?s._tr_align(a):5!==n&&(s._tr_stored_block(a,0,0,!1),3===n&&(zero(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),flush_pending(t),0===t.avail_out))return a.last_flush=-1,0}return 4!==n?0:a.wrap<=0?1:(2===a.wrap?(put_byte(a,255&t.adler),put_byte(a,t.adler>>8&255),put_byte(a,t.adler>>16&255),put_byte(a,t.adler>>24&255),put_byte(a,255&t.total_in),put_byte(a,t.total_in>>8&255),put_byte(a,t.total_in>>16&255),put_byte(a,t.total_in>>24&255)):(putShortMSB(a,t.adler>>>16),putShortMSB(a,65535&t.adler)),flush_pending(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?0:1)},n.deflateEnd=function deflateEnd(t){var n;return t&&t.state?42!==(n=t.state.status)&&69!==n&&73!==n&&91!==n&&103!==n&&113!==n&&666!==n?err(t,-2):(t.state=null,113===n?err(t,-3):0):-2},n.deflateSetDictionary=function deflateSetDictionary(t,n){var i,o,s,g,_,S,M,T,O=n.length;if(!t||!t.state)return-2;if(2===(g=(i=t.state).wrap)||1===g&&42!==i.status||i.lookahead)return-2;for(1===g&&(t.adler=m(t.adler,n,O,0)),i.wrap=0,O>=i.w_size&&(0===g&&(zero(i.head),i.strstart=0,i.block_start=0,i.insert=0),T=new a.Buf8(i.w_size),a.arraySet(T,n,O-i.w_size,i.w_size,0),n=T,O=i.w_size),_=t.avail_in,S=t.next_in,M=t.input,t.avail_in=O,t.next_in=0,t.input=n,fill_window(i);i.lookahead>=3;){o=i.strstart,s=i.lookahead-2;do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[o+3-1])&i.hash_mask,i.prev[o&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=o,o++}while(--s);i.strstart=o,i.lookahead=2,fill_window(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=S,t.input=M,t.avail_in=_,i.wrap=g,0},n.deflateInfo="pako deflate (from Nodeca project)"},function(t,n,i){"use strict";var o=i(140);function zero(t){for(var n=t.length;--n>=0;)t[n]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],s=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],g=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],_=new Array(576);zero(_);var S=new Array(60);zero(S);var M=new Array(512);zero(M);var T=new Array(256);zero(T);var O=new Array(29);zero(O);var A,P,L,R=new Array(30);function StaticTreeDesc(t,n,i,o,a){this.static_tree=t,this.extra_bits=n,this.extra_base=i,this.elems=o,this.max_length=a,this.has_stree=t&&t.length}function TreeDesc(t,n){this.dyn_tree=t,this.max_code=0,this.stat_desc=n}function d_code(t){return t<256?M[t]:M[256+(t>>>7)]}function put_short(t,n){t.pending_buf[t.pending++]=255&n,t.pending_buf[t.pending++]=n>>>8&255}function send_bits(t,n,i){t.bi_valid>16-i?(t.bi_buf|=n<<t.bi_valid&65535,put_short(t,t.bi_buf),t.bi_buf=n>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=n<<t.bi_valid&65535,t.bi_valid+=i)}function send_code(t,n,i){send_bits(t,i[2*n],i[2*n+1])}function bi_reverse(t,n){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--n>0);return i>>>1}function gen_codes(t,n,i){var o,a,s=new Array(16),m=0;for(o=1;o<=15;o++)s[o]=m=m+i[o-1]<<1;for(a=0;a<=n;a++){var g=t[2*a+1];0!==g&&(t[2*a]=bi_reverse(s[g]++,g))}}function init_block(t){var n;for(n=0;n<286;n++)t.dyn_ltree[2*n]=0;for(n=0;n<30;n++)t.dyn_dtree[2*n]=0;for(n=0;n<19;n++)t.bl_tree[2*n]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function bi_windup(t){t.bi_valid>8?put_short(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function smaller(t,n,i,o){var a=2*n,s=2*i;return t[a]<t[s]||t[a]===t[s]&&o[n]<=o[i]}function pqdownheap(t,n,i){for(var o=t.heap[i],a=i<<1;a<=t.heap_len&&(a<t.heap_len&&smaller(n,t.heap[a+1],t.heap[a],t.depth)&&a++,!smaller(n,o,t.heap[a],t.depth));)t.heap[i]=t.heap[a],i=a,a<<=1;t.heap[i]=o}function compress_block(t,n,i){var o,m,g,_,S=0;if(0!==t.last_lit)do{o=t.pending_buf[t.d_buf+2*S]<<8|t.pending_buf[t.d_buf+2*S+1],m=t.pending_buf[t.l_buf+S],S++,0===o?send_code(t,m,n):(send_code(t,(g=T[m])+256+1,n),0!==(_=a[g])&&send_bits(t,m-=O[g],_),send_code(t,g=d_code(--o),i),0!==(_=s[g])&&send_bits(t,o-=R[g],_))}while(S<t.last_lit);send_code(t,256,n)}function build_tree(t,n){var i,o,a,s=n.dyn_tree,m=n.stat_desc.static_tree,g=n.stat_desc.has_stree,_=n.stat_desc.elems,S=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<_;i++)0!==s[2*i]?(t.heap[++t.heap_len]=S=i,t.depth[i]=0):s[2*i+1]=0;for(;t.heap_len<2;)s[2*(a=t.heap[++t.heap_len]=S<2?++S:0)]=1,t.depth[a]=0,t.opt_len--,g&&(t.static_len-=m[2*a+1]);for(n.max_code=S,i=t.heap_len>>1;i>=1;i--)pqdownheap(t,s,i);a=_;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pqdownheap(t,s,1),o=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=o,s[2*a]=s[2*i]+s[2*o],t.depth[a]=(t.depth[i]>=t.depth[o]?t.depth[i]:t.depth[o])+1,s[2*i+1]=s[2*o+1]=a,t.heap[1]=a++,pqdownheap(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function gen_bitlen(t,n){var i,o,a,s,m,g,_=n.dyn_tree,S=n.max_code,M=n.stat_desc.static_tree,T=n.stat_desc.has_stree,O=n.stat_desc.extra_bits,A=n.stat_desc.extra_base,P=n.stat_desc.max_length,L=0;for(s=0;s<=15;s++)t.bl_count[s]=0;for(_[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<573;i++)(s=_[2*_[2*(o=t.heap[i])+1]+1]+1)>P&&(s=P,L++),_[2*o+1]=s,o>S||(t.bl_count[s]++,m=0,o>=A&&(m=O[o-A]),g=_[2*o],t.opt_len+=g*(s+m),T&&(t.static_len+=g*(M[2*o+1]+m)));if(0!==L){do{for(s=P-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[P]--,L-=2}while(L>0);for(s=P;0!==s;s--)for(o=t.bl_count[s];0!==o;)(a=t.heap[--i])>S||(_[2*a+1]!==s&&(t.opt_len+=(s-_[2*a+1])*_[2*a],_[2*a+1]=s),o--)}}(t,n),gen_codes(s,S,t.bl_count)}function scan_tree(t,n,i){var o,a,s=-1,m=n[1],g=0,_=7,S=4;for(0===m&&(_=138,S=3),n[2*(i+1)+1]=65535,o=0;o<=i;o++)a=m,m=n[2*(o+1)+1],++g<_&&a===m||(g<S?t.bl_tree[2*a]+=g:0!==a?(a!==s&&t.bl_tree[2*a]++,t.bl_tree[32]++):g<=10?t.bl_tree[34]++:t.bl_tree[36]++,g=0,s=a,0===m?(_=138,S=3):a===m?(_=6,S=3):(_=7,S=4))}function send_tree(t,n,i){var o,a,s=-1,m=n[1],g=0,_=7,S=4;for(0===m&&(_=138,S=3),o=0;o<=i;o++)if(a=m,m=n[2*(o+1)+1],!(++g<_&&a===m)){if(g<S)do{send_code(t,a,t.bl_tree)}while(0!=--g);else 0!==a?(a!==s&&(send_code(t,a,t.bl_tree),g--),send_code(t,16,t.bl_tree),send_bits(t,g-3,2)):g<=10?(send_code(t,17,t.bl_tree),send_bits(t,g-3,3)):(send_code(t,18,t.bl_tree),send_bits(t,g-11,7));g=0,s=a,0===m?(_=138,S=3):a===m?(_=6,S=3):(_=7,S=4)}}zero(R);var N=!1;function _tr_stored_block(t,n,i,a){send_bits(t,0+(a?1:0),3),function copy_block(t,n,i,a){bi_windup(t),a&&(put_short(t,i),put_short(t,~i)),o.arraySet(t.pending_buf,t.window,n,i,t.pending),t.pending+=i}(t,n,i,!0)}n._tr_init=function _tr_init(t){N||(function tr_static_init(){var t,n,i,o,g,N=new Array(16);for(i=0,o=0;o<28;o++)for(O[o]=i,t=0;t<1<<a[o];t++)T[i++]=o;for(T[i-1]=o,g=0,o=0;o<16;o++)for(R[o]=g,t=0;t<1<<s[o];t++)M[g++]=o;for(g>>=7;o<30;o++)for(R[o]=g<<7,t=0;t<1<<s[o]-7;t++)M[256+g++]=o;for(n=0;n<=15;n++)N[n]=0;for(t=0;t<=143;)_[2*t+1]=8,t++,N[8]++;for(;t<=255;)_[2*t+1]=9,t++,N[9]++;for(;t<=279;)_[2*t+1]=7,t++,N[7]++;for(;t<=287;)_[2*t+1]=8,t++,N[8]++;for(gen_codes(_,287,N),t=0;t<30;t++)S[2*t+1]=5,S[2*t]=bi_reverse(t,5);A=new StaticTreeDesc(_,a,257,286,15),P=new StaticTreeDesc(S,s,0,30,15),L=new StaticTreeDesc(new Array(0),m,0,19,7)}(),N=!0),t.l_desc=new TreeDesc(t.dyn_ltree,A),t.d_desc=new TreeDesc(t.dyn_dtree,P),t.bl_desc=new TreeDesc(t.bl_tree,L),t.bi_buf=0,t.bi_valid=0,init_block(t)},n._tr_stored_block=_tr_stored_block,n._tr_flush_block=function _tr_flush_block(t,n,i,o){var a,s,m=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function detect_data_type(t){var n,i=4093624447;for(n=0;n<=31;n++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*n])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(n=32;n<256;n++)if(0!==t.dyn_ltree[2*n])return 1;return 0}(t)),build_tree(t,t.l_desc),build_tree(t,t.d_desc),m=function build_bl_tree(t){var n;for(scan_tree(t,t.dyn_ltree,t.l_desc.max_code),scan_tree(t,t.dyn_dtree,t.d_desc.max_code),build_tree(t,t.bl_desc),n=18;n>=3&&0===t.bl_tree[2*g[n]+1];n--);return t.opt_len+=3*(n+1)+5+5+4,n}(t),a=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=a&&(a=s)):a=s=i+5,i+4<=a&&-1!==n?_tr_stored_block(t,n,i,o):4===t.strategy||s===a?(send_bits(t,2+(o?1:0),3),compress_block(t,_,S)):(send_bits(t,4+(o?1:0),3),function send_all_trees(t,n,i,o){var a;for(send_bits(t,n-257,5),send_bits(t,i-1,5),send_bits(t,o-4,4),a=0;a<o;a++)send_bits(t,t.bl_tree[2*g[a]+1],3);send_tree(t,t.dyn_ltree,n-1),send_tree(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,m+1),compress_block(t,t.dyn_ltree,t.dyn_dtree)),init_block(t),o&&bi_windup(t)},n._tr_tally=function _tr_tally(t,n,i){return t.pending_buf[t.d_buf+2*t.last_lit]=n>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&n,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===n?t.dyn_ltree[2*i]++:(t.matches++,n--,t.dyn_ltree[2*(T[i]+256+1)]++,t.dyn_dtree[2*d_code(n)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function _tr_align(t){send_bits(t,2,3),send_code(t,256,_),function bi_flush(t){16===t.bi_valid?(put_short(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,n,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,n,i){"use strict";var o=i(140),a=i(231),s=i(232),m=i(405),g=i(406);function zswap32(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(t){var n;return t&&t.state?(n=t.state,t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=1&n.wrap),n.mode=1,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new o.Buf32(852),n.distcode=n.distdyn=new o.Buf32(592),n.sane=1,n.back=-1,0):-2}function inflateReset(t){var n;return t&&t.state?((n=t.state).wsize=0,n.whave=0,n.wnext=0,inflateResetKeep(t)):-2}function inflateReset2(t,n){var i,o;return t&&t.state?(o=t.state,n<0?(i=0,n=-n):(i=1+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?-2:(null!==o.window&&o.wbits!==n&&(o.window=null),o.wrap=i,o.wbits=n,inflateReset(t))):-2}function inflateInit2(t,n){var i,o;return t?(o=new InflateState,t.state=o,o.window=null,0!==(i=inflateReset2(t,n))&&(t.state=null),i):-2}var _,S,M=!0;function fixedtables(t){if(M){var n;for(_=new o.Buf32(512),S=new o.Buf32(32),n=0;n<144;)t.lens[n++]=8;for(;n<256;)t.lens[n++]=9;for(;n<280;)t.lens[n++]=7;for(;n<288;)t.lens[n++]=8;for(g(1,t.lens,0,288,_,0,t.work,{bits:9}),n=0;n<32;)t.lens[n++]=5;g(2,t.lens,0,32,S,0,t.work,{bits:5}),M=!1}t.lencode=_,t.lenbits=9,t.distcode=S,t.distbits=5}function updatewindow(t,n,i,a){var s,m=t.state;return null===m.window&&(m.wsize=1<<m.wbits,m.wnext=0,m.whave=0,m.window=new o.Buf8(m.wsize)),a>=m.wsize?(o.arraySet(m.window,n,i-m.wsize,m.wsize,0),m.wnext=0,m.whave=m.wsize):((s=m.wsize-m.wnext)>a&&(s=a),o.arraySet(m.window,n,i-a,s,m.wnext),(a-=s)?(o.arraySet(m.window,n,i-a,a,0),m.wnext=a,m.whave=m.wsize):(m.wnext+=s,m.wnext===m.wsize&&(m.wnext=0),m.whave<m.wsize&&(m.whave+=s))),0}n.inflateReset=inflateReset,n.inflateReset2=inflateReset2,n.inflateResetKeep=inflateResetKeep,n.inflateInit=function inflateInit(t){return inflateInit2(t,15)},n.inflateInit2=inflateInit2,n.inflate=function inflate(t,n){var i,_,S,M,T,O,A,P,L,R,N,I,j,V,U,G,z,H,q,Z,X,Q,Y,J,K=0,$=new o.Buf8(4),ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return-2;12===(i=t.state).mode&&(i.mode=13),T=t.next_out,S=t.output,A=t.avail_out,M=t.next_in,_=t.input,O=t.avail_in,P=i.hold,L=i.bits,R=O,N=A,Q=0;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;L<16;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if(2&i.wrap&&35615===P){i.check=0,$[0]=255&P,$[1]=P>>>8&255,i.check=s(i.check,$,2,0),P=0,L=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&P)<<8)+(P>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&P)){t.msg="unknown compression method",i.mode=30;break}if(L-=4,X=8+(15&(P>>>=4)),0===i.wbits)i.wbits=X;else if(X>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<X,t.adler=i.check=1,i.mode=512&P?10:12,P=0,L=0;break;case 2:for(;L<16;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if(i.flags=P,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=P>>8&1),512&i.flags&&($[0]=255&P,$[1]=P>>>8&255,i.check=s(i.check,$,2,0)),P=0,L=0,i.mode=3;case 3:for(;L<32;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}i.head&&(i.head.time=P),512&i.flags&&($[0]=255&P,$[1]=P>>>8&255,$[2]=P>>>16&255,$[3]=P>>>24&255,i.check=s(i.check,$,4,0)),P=0,L=0,i.mode=4;case 4:for(;L<16;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}i.head&&(i.head.xflags=255&P,i.head.os=P>>8),512&i.flags&&($[0]=255&P,$[1]=P>>>8&255,i.check=s(i.check,$,2,0)),P=0,L=0,i.mode=5;case 5:if(1024&i.flags){for(;L<16;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}i.length=P,i.head&&(i.head.extra_len=P),512&i.flags&&($[0]=255&P,$[1]=P>>>8&255,i.check=s(i.check,$,2,0)),P=0,L=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((I=i.length)>O&&(I=O),I&&(i.head&&(X=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),o.arraySet(i.head.extra,_,M,I,X)),512&i.flags&&(i.check=s(i.check,_,I,M)),O-=I,M+=I,i.length-=I),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===O)break e;I=0;do{X=_[M+I++],i.head&&X&&i.length<65536&&(i.head.name+=String.fromCharCode(X))}while(X&&I<O);if(512&i.flags&&(i.check=s(i.check,_,I,M)),O-=I,M+=I,X)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===O)break e;I=0;do{X=_[M+I++],i.head&&X&&i.length<65536&&(i.head.comment+=String.fromCharCode(X))}while(X&&I<O);if(512&i.flags&&(i.check=s(i.check,_,I,M)),O-=I,M+=I,X)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;L<16;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if(P!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}P=0,L=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;L<32;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}t.adler=i.check=zswap32(P),P=0,L=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=T,t.avail_out=A,t.next_in=M,t.avail_in=O,i.hold=P,i.bits=L,2;t.adler=i.check=1,i.mode=12;case 12:if(5===n||6===n)break e;case 13:if(i.last){P>>>=7&L,L-=7&L,i.mode=27;break}for(;L<3;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}switch(i.last=1&P,L-=1,3&(P>>>=1)){case 0:i.mode=14;break;case 1:if(fixedtables(i),i.mode=20,6===n){P>>>=2,L-=2;break e}break;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}P>>>=2,L-=2;break;case 14:for(P>>>=7&L,L-=7&L;L<32;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if((65535&P)!=(P>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&P,P=0,L=0,i.mode=15,6===n)break e;case 15:i.mode=16;case 16:if(I=i.length){if(I>O&&(I=O),I>A&&(I=A),0===I)break e;o.arraySet(S,_,M,I,T),O-=I,M+=I,A-=I,T+=I,i.length-=I;break}i.mode=12;break;case 17:for(;L<14;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if(i.nlen=257+(31&P),P>>>=5,L-=5,i.ndist=1+(31&P),P>>>=5,L-=5,i.ncode=4+(15&P),P>>>=4,L-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;L<3;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}i.lens[ee[i.have++]]=7&P,P>>>=3,L-=3}for(;i.have<19;)i.lens[ee[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Y={bits:i.lenbits},Q=g(0,i.lens,0,19,i.lencode,0,i.work,Y),i.lenbits=Y.bits,Q){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;G=(K=i.lencode[P&(1<<i.lenbits)-1])>>>16&255,z=65535&K,!((U=K>>>24)<=L);){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if(z<16)P>>>=U,L-=U,i.lens[i.have++]=z;else{if(16===z){for(J=U+2;L<J;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if(P>>>=U,L-=U,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}X=i.lens[i.have-1],I=3+(3&P),P>>>=2,L-=2}else if(17===z){for(J=U+3;L<J;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}L-=U,X=0,I=3+(7&(P>>>=U)),P>>>=3,L-=3}else{for(J=U+7;L<J;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}L-=U,X=0,I=11+(127&(P>>>=U)),P>>>=7,L-=7}if(i.have+I>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;I--;)i.lens[i.have++]=X}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,Y={bits:i.lenbits},Q=g(1,i.lens,0,i.nlen,i.lencode,0,i.work,Y),i.lenbits=Y.bits,Q){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,Y={bits:i.distbits},Q=g(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Y),i.distbits=Y.bits,Q){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===n)break e;case 20:i.mode=21;case 21:if(O>=6&&A>=258){t.next_out=T,t.avail_out=A,t.next_in=M,t.avail_in=O,i.hold=P,i.bits=L,m(t,N),T=t.next_out,S=t.output,A=t.avail_out,M=t.next_in,_=t.input,O=t.avail_in,P=i.hold,L=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;G=(K=i.lencode[P&(1<<i.lenbits)-1])>>>16&255,z=65535&K,!((U=K>>>24)<=L);){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if(G&&0==(240&G)){for(H=U,q=G,Z=z;G=(K=i.lencode[Z+((P&(1<<H+q)-1)>>H)])>>>16&255,z=65535&K,!(H+(U=K>>>24)<=L);){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}P>>>=H,L-=H,i.back+=H}if(P>>>=U,L-=U,i.back+=U,i.length=z,0===G){i.mode=26;break}if(32&G){i.back=-1,i.mode=12;break}if(64&G){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&G,i.mode=22;case 22:if(i.extra){for(J=i.extra;L<J;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}i.length+=P&(1<<i.extra)-1,P>>>=i.extra,L-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;G=(K=i.distcode[P&(1<<i.distbits)-1])>>>16&255,z=65535&K,!((U=K>>>24)<=L);){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if(0==(240&G)){for(H=U,q=G,Z=z;G=(K=i.distcode[Z+((P&(1<<H+q)-1)>>H)])>>>16&255,z=65535&K,!(H+(U=K>>>24)<=L);){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}P>>>=H,L-=H,i.back+=H}if(P>>>=U,L-=U,i.back+=U,64&G){t.msg="invalid distance code",i.mode=30;break}i.offset=z,i.extra=15&G,i.mode=24;case 24:if(i.extra){for(J=i.extra;L<J;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}i.offset+=P&(1<<i.extra)-1,P>>>=i.extra,L-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===A)break e;if(I=N-A,i.offset>I){if((I=i.offset-I)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}I>i.wnext?(I-=i.wnext,j=i.wsize-I):j=i.wnext-I,I>i.length&&(I=i.length),V=i.window}else V=S,j=T-i.offset,I=i.length;I>A&&(I=A),A-=I,i.length-=I;do{S[T++]=V[j++]}while(--I);0===i.length&&(i.mode=21);break;case 26:if(0===A)break e;S[T++]=i.length,A--,i.mode=21;break;case 27:if(i.wrap){for(;L<32;){if(0===O)break e;O--,P|=_[M++]<<L,L+=8}if(N-=A,t.total_out+=N,i.total+=N,N&&(t.adler=i.check=i.flags?s(i.check,S,N,T-N):a(i.check,S,N,T-N)),N=A,(i.flags?P:zswap32(P))!==i.check){t.msg="incorrect data check",i.mode=30;break}P=0,L=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;L<32;){if(0===O)break e;O--,P+=_[M++]<<L,L+=8}if(P!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}P=0,L=0}i.mode=29;case 29:Q=1;break e;case 30:Q=-3;break e;case 31:return-4;case 32:default:return-2}return t.next_out=T,t.avail_out=A,t.next_in=M,t.avail_in=O,i.hold=P,i.bits=L,(i.wsize||N!==t.avail_out&&i.mode<30&&(i.mode<27||4!==n))&&updatewindow(t,t.output,t.next_out,N-t.avail_out)?(i.mode=31,-4):(R-=t.avail_in,N-=t.avail_out,t.total_in+=R,t.total_out+=N,i.total+=N,i.wrap&&N&&(t.adler=i.check=i.flags?s(i.check,S,N,t.next_out-N):a(i.check,S,N,t.next_out-N)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0===R&&0===N||4===n)&&0===Q&&(Q=-5),Q)},n.inflateEnd=function inflateEnd(t){if(!t||!t.state)return-2;var n=t.state;return n.window&&(n.window=null),t.state=null,0},n.inflateGetHeader=function inflateGetHeader(t,n){var i;return t&&t.state?0==(2&(i=t.state).wrap)?-2:(i.head=n,n.done=!1,0):-2},n.inflateSetDictionary=function inflateSetDictionary(t,n){var i,o=n.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?-2:11===i.mode&&a(1,n,o,0)!==i.check?-3:updatewindow(t,n,o,o)?(i.mode=31,-4):(i.havedict=1,0):-2},n.inflateInfo="pako inflate (from Nodeca project)"},function(t,n,i){"use strict";t.exports=function inflate_fast(t,n){var i,o,a,s,m,g,_,S,M,T,O,A,P,L,R,N,I,j,V,U,G,z,H,q,Z;i=t.state,o=t.next_in,q=t.input,a=o+(t.avail_in-5),s=t.next_out,Z=t.output,m=s-(n-t.avail_out),g=s+(t.avail_out-257),_=i.dmax,S=i.wsize,M=i.whave,T=i.wnext,O=i.window,A=i.hold,P=i.bits,L=i.lencode,R=i.distcode,N=(1<<i.lenbits)-1,I=(1<<i.distbits)-1;e:do{P<15&&(A+=q[o++]<<P,P+=8,A+=q[o++]<<P,P+=8),j=L[A&N];t:for(;;){if(A>>>=V=j>>>24,P-=V,0==(V=j>>>16&255))Z[s++]=65535&j;else{if(!(16&V)){if(0==(64&V)){j=L[(65535&j)+(A&(1<<V)-1)];continue t}if(32&V){i.mode=12;break e}t.msg="invalid literal/length code",i.mode=30;break e}U=65535&j,(V&=15)&&(P<V&&(A+=q[o++]<<P,P+=8),U+=A&(1<<V)-1,A>>>=V,P-=V),P<15&&(A+=q[o++]<<P,P+=8,A+=q[o++]<<P,P+=8),j=R[A&I];n:for(;;){if(A>>>=V=j>>>24,P-=V,!(16&(V=j>>>16&255))){if(0==(64&V)){j=R[(65535&j)+(A&(1<<V)-1)];continue n}t.msg="invalid distance code",i.mode=30;break e}if(G=65535&j,P<(V&=15)&&(A+=q[o++]<<P,(P+=8)<V&&(A+=q[o++]<<P,P+=8)),(G+=A&(1<<V)-1)>_){t.msg="invalid distance too far back",i.mode=30;break e}if(A>>>=V,P-=V,G>(V=s-m)){if((V=G-V)>M&&i.sane){t.msg="invalid distance too far back",i.mode=30;break e}if(z=0,H=O,0===T){if(z+=S-V,V<U){U-=V;do{Z[s++]=O[z++]}while(--V);z=s-G,H=Z}}else if(T<V){if(z+=S+T-V,(V-=T)<U){U-=V;do{Z[s++]=O[z++]}while(--V);if(z=0,T<U){U-=V=T;do{Z[s++]=O[z++]}while(--V);z=s-G,H=Z}}}else if(z+=T-V,V<U){U-=V;do{Z[s++]=O[z++]}while(--V);z=s-G,H=Z}for(;U>2;)Z[s++]=H[z++],Z[s++]=H[z++],Z[s++]=H[z++],U-=3;U&&(Z[s++]=H[z++],U>1&&(Z[s++]=H[z++]))}else{z=s-G;do{Z[s++]=Z[z++],Z[s++]=Z[z++],Z[s++]=Z[z++],U-=3}while(U>2);U&&(Z[s++]=Z[z++],U>1&&(Z[s++]=Z[z++]))}break}}break}}while(o<a&&s<g);o-=U=P>>3,A&=(1<<(P-=U<<3))-1,t.next_in=o,t.next_out=s,t.avail_in=o<a?a-o+5:5-(o-a),t.avail_out=s<g?g-s+257:257-(s-g),i.hold=A,i.bits=P}},function(t,n,i){"use strict";var o=i(140),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function inflate_table(t,n,i,_,S,M,T,O){var A,P,L,R,N,I,j,V,U,G=O.bits,z=0,H=0,q=0,Z=0,X=0,Q=0,Y=0,J=0,K=0,$=0,ee=null,te=0,ne=new o.Buf16(16),re=new o.Buf16(16),ie=null,oe=0;for(z=0;z<=15;z++)ne[z]=0;for(H=0;H<_;H++)ne[n[i+H]]++;for(X=G,Z=15;Z>=1&&0===ne[Z];Z--);if(X>Z&&(X=Z),0===Z)return S[M++]=20971520,S[M++]=20971520,O.bits=1,0;for(q=1;q<Z&&0===ne[q];q++);for(X<q&&(X=q),J=1,z=1;z<=15;z++)if(J<<=1,(J-=ne[z])<0)return-1;if(J>0&&(0===t||1!==Z))return-1;for(re[1]=0,z=1;z<15;z++)re[z+1]=re[z]+ne[z];for(H=0;H<_;H++)0!==n[i+H]&&(T[re[n[i+H]]++]=H);if(0===t?(ee=ie=T,I=19):1===t?(ee=a,te-=257,ie=s,oe-=257,I=256):(ee=m,ie=g,I=-1),$=0,H=0,z=q,N=M,Q=X,Y=0,L=-1,R=(K=1<<X)-1,1===t&&K>852||2===t&&K>592)return 1;for(;;){j=z-Y,T[H]<I?(V=0,U=T[H]):T[H]>I?(V=ie[oe+T[H]],U=ee[te+T[H]]):(V=96,U=0),A=1<<z-Y,q=P=1<<Q;do{S[N+($>>Y)+(P-=A)]=j<<24|V<<16|U|0}while(0!==P);for(A=1<<z-1;$&A;)A>>=1;if(0!==A?($&=A-1,$+=A):$=0,H++,0==--ne[z]){if(z===Z)break;z=n[i+T[H]]}if(z>X&&($&R)!==L){for(0===Y&&(Y=X),N+=q,J=1<<(Q=z-Y);Q+Y<Z&&!((J-=ne[Q+Y])<=0);)Q++,J<<=1;if(K+=1<<Q,1===t&&K>852||2===t&&K>592)return 1;S[L=$&R]=X<<24|Q<<16|N-M|0}}return 0!==$&&(S[N+$]=z-Y<<24|64<<16|0),O.bits=X,0}},function(t,n,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,n){},function(t,n,i){"use strict";function ownKeys(t,n){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),i.push.apply(i,o)}return i}function _defineProperty(t,n,i){return n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=i(31).Buffer,a=i(410).inspect,s=a&&a.custom||"inspect";t.exports=function(){function BufferList(){!function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(BufferList,[{key:"push",value:function push(t){var n={data:t,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function unshift(t){var n={data:t,next:this.head};0===this.length&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function shift(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}}},{key:"clear",value:function clear(){this.head=this.tail=null,this.length=0}},{key:"join",value:function join(t){if(0===this.length)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=t+n.data;return i}},{key:"concat",value:function concat(t){if(0===this.length)return o.alloc(0);for(var n,i,a,s=o.allocUnsafe(t>>>0),m=this.head,g=0;m;)n=m.data,i=s,a=g,o.prototype.copy.call(n,i,a),g+=m.data.length,m=m.next;return s}},{key:"consume",value:function consume(t,n){var i;return t<this.head.data.length?(i=this.head.data.slice(0,t),this.head.data=this.head.data.slice(t)):i=t===this.head.data.length?this.shift():n?this._getString(t):this._getBuffer(t),i}},{key:"first",value:function first(){return this.head.data}},{key:"_getString",value:function _getString(t){var n=this.head,i=1,o=n.data;for(t-=o.length;n=n.next;){var a=n.data,s=t>a.length?a.length:t;if(s===a.length?o+=a:o+=a.slice(0,t),0==(t-=s)){s===a.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(s));break}++i}return this.length-=i,o}},{key:"_getBuffer",value:function _getBuffer(t){var n=o.allocUnsafe(t),i=this.head,a=1;for(i.data.copy(n),t-=i.data.length;i=i.next;){var s=i.data,m=t>s.length?s.length:t;if(s.copy(n,n.length-t,0,m),0==(t-=m)){m===s.length?(++a,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=s.slice(m));break}++a}return this.length-=a,n}},{key:s,value:function value(t,n){return a(this,function _objectSpread(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(i),!0).forEach((function(n){_defineProperty(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))}))}return t}({},n,{depth:0,customInspect:!1}))}}]),BufferList}()},function(t,n){},function(t,n,i){"use strict";(function(n){var o;function _defineProperty(t,n,i){return n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}var a=i(183),s=Symbol("lastResolve"),m=Symbol("lastReject"),g=Symbol("error"),_=Symbol("ended"),S=Symbol("lastPromise"),M=Symbol("handlePromise"),T=Symbol("stream");function createIterResult(t,n){return{value:t,done:n}}function readAndResolve(t){var n=t[s];if(null!==n){var i=t[T].read();null!==i&&(t[S]=null,t[s]=null,t[m]=null,n(createIterResult(i,!1)))}}function onReadable(t){n.nextTick(readAndResolve,t)}var O=Object.getPrototypeOf((function(){})),A=Object.setPrototypeOf((_defineProperty(o={get stream(){return this[T]},next:function next(){var t=this,i=this[g];if(null!==i)return Promise.reject(i);if(this[_])return Promise.resolve(createIterResult(void 0,!0));if(this[T].destroyed)return new Promise((function(i,o){n.nextTick((function(){t[g]?o(t[g]):i(createIterResult(void 0,!0))}))}));var o,a=this[S];if(a)o=new Promise(function wrapForNext(t,n){return function(i,o){t.then((function(){n[_]?i(createIterResult(void 0,!0)):n[M](i,o)}),o)}}(a,this));else{var s=this[T].read();if(null!==s)return Promise.resolve(createIterResult(s,!1));o=new Promise(this[M])}return this[S]=o,o}},Symbol.asyncIterator,(function(){return this})),_defineProperty(o,"return",(function _return(){var t=this;return new Promise((function(n,i){t[T].destroy(null,(function(t){t?i(t):n(createIterResult(void 0,!0))}))}))})),o),O);t.exports=function createReadableStreamAsyncIterator(t){var n,i=Object.create(A,(_defineProperty(n={},T,{value:t,writable:!0}),_defineProperty(n,s,{value:null,writable:!0}),_defineProperty(n,m,{value:null,writable:!0}),_defineProperty(n,g,{value:null,writable:!0}),_defineProperty(n,_,{value:t._readableState.endEmitted,writable:!0}),_defineProperty(n,M,{value:function value(t,n){var o=i[T].read();o?(i[S]=null,i[s]=null,i[m]=null,t(createIterResult(o,!1))):(i[s]=t,i[m]=n)},writable:!0}),n));return i[S]=null,a(t,(function(t){if(t&&"ERR_STREAM_PREMATURE_CLOSE"!==t.code){var n=i[m];return null!==n&&(i[S]=null,i[s]=null,i[m]=null,n(t)),void(i[g]=t)}var o=i[s];null!==o&&(i[S]=null,i[s]=null,i[m]=null,o(createIterResult(void 0,!0))),i[_]=!0})),t.on("readable",onReadable.bind(null,i)),i}}).call(this,i(25))},function(t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}},function(t,n,i){"use strict";t.exports=PassThrough;var o=i(238);function PassThrough(t){if(!(this instanceof PassThrough))return new PassThrough(t);o.call(this,t)}i(45)(PassThrough,o),PassThrough.prototype._transform=function(t,n,i){i(null,t)}},function(t,n,i){"use strict";var o,a=i(93).codes,s=a.ERR_MISSING_ARGS,m=a.ERR_STREAM_DESTROYED;function noop(t){if(t)throw t}function destroyer(t,n,a,s){s=function once(t){var n=!1;return function(){n||(n=!0,t.apply(void 0,arguments))}}(s);var g=!1;t.on("close",(function(){g=!0})),void 0===o&&(o=i(183)),o(t,{readable:n,writable:a},(function(t){if(t)return s(t);g=!0,s()}));var _=!1;return function(n){if(!g&&!_)return _=!0,function isRequest(t){return t.setHeader&&"function"==typeof t.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void s(n||new m("pipe"))}}function call(t){t()}function pipe(t,n){return t.pipe(n)}function popCallback(t){return t.length?"function"!=typeof t[t.length-1]?noop:t.pop():noop}t.exports=function pipeline(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o,a=popCallback(n);if(Array.isArray(n[0])&&(n=n[0]),n.length<2)throw new s("streams");var m=n.map((function(t,i){var s=i<n.length-1;return destroyer(t,s,i>0,(function(t){o||(o=t),t&&m.forEach(call),s||(m.forEach(call),a(o))}))}));return n.reduce(pipe)}},function(t,n,i){var o=i(416)((function prod(t,n){return(n=n||{}).namespace=t,n.prod=!0,n.dev=!1,n.force||prod.force?prod.yep(n):prod.nope(n)}));t.exports=o},function(t,n){var i=[],o=[],a=function devnull(){};function use(t){return!~i.indexOf(t)&&(i.push(t),!0)}function set(t){a=t}function enabled(t){for(var n=[],o=0;o<i.length;o++)if(i[o].async)n.push(i[o]);else if(i[o](t))return!0;return!!n.length&&new Promise((function pinky(i){Promise.all(n.map((function prebind(n){return n(t)}))).then((function resolved(t){i(t.some(Boolean))}))}))}function modify(t){return!~o.indexOf(t)&&(o.push(t),!0)}function write(){a.apply(a,arguments)}function process(t){for(var n=0;n<o.length;n++)t=o[n].apply(o[n],arguments);return t}function introduce(t,n){var i=Object.prototype.hasOwnProperty;for(var o in n)i.call(n,o)&&(t[o]=n[o]);return t}function nope(t){return t.enabled=!1,t.modify=modify,t.set=set,t.use=use,introduce((function diagnopes(){return!1}),t)}function yep(t){return t.enabled=!0,t.modify=modify,t.set=set,t.use=use,introduce((function diagnostics(){var n=Array.prototype.slice.call(arguments,0);return write.call(write,t,process(n,t)),!0}),t)}t.exports=function create(t){return t.introduce=introduce,t.enabled=enabled,t.process=process,t.modify=modify,t.write=write,t.nope=nope,t.yep=yep,t.set=set,t.use=use,t}},function(t,n,i){"use strict";(function(n){var o=i(225),a=i(120).StringDecoder,s=i(123).Stream;function noop(){}t.exports=function(t,i){var m=n.alloc(65536),g=new a("utf8"),_=new s,S="",M=0,T=0;return-1===t.start&&delete t.start,_.readable=!0,_.destroy=function(){_.destroyed=!0,_.emit("end"),_.emit("close")},o.open(t.file,"a+","0644",(function(n,a){if(n)return i?i(n):_.emit("error",n),void _.destroy();!function read(){if(!_.destroyed)return o.read(a,m,0,m.length,M,(function(n,o){if(n)return i?i(n):_.emit("error",n),void _.destroy();if(!o)return S&&((null==t.start||T>t.start)&&(i?i(null,S):_.emit("line",S)),T++,S=""),setTimeout(read,1e3);var a=g.write(m.slice(0,o));i||_.emit("data",a);for(var s=(a=(S+a).split(/\n+/)).length-1,O=0;O<s;O++)(null==t.start||T>t.start)&&(i?i(null,a[O]):_.emit("line",a[O])),T++;return S=a[s],M+=o,read()}));o.close(a,noop)}()})),i?_.destroy:_}}).call(this,i(31).Buffer)},function(t,n,i){"use strict";(function(n,o){function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(t,n){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(i),!0).forEach((function(n){_defineProperty(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))}))}return t}function _defineProperty(t,n,i){return n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,n){return t.__proto__=n,t})(t,n)}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):n}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var a=i(239),s=i(428),m=i(123).Stream,g=i(79);t.exports=function(t){!function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_setPrototypeOf(t,n)}(Http,t);var i=function _createSuper(t){var n=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var i,o=_getPrototypeOf(t);if(n){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}(Http);function Http(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,Http),(t=i.call(this,n)).options=n,t.name=n.name||"http",t.ssl=!!n.ssl,t.host=n.host||"localhost",t.port=n.port,t.auth=n.auth,t.path=n.path||"",t.agent=n.agent,t.headers=n.headers||{},t.headers["content-type"]="application/json",t.port||(t.port=t.ssl?443:80),t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Http,[{key:"log",value:function log(t,i){var o=this;this._request(t,(function(n,i){i&&200!==i.statusCode&&(n=new Error("Invalid HTTP Status Code: ".concat(i.statusCode))),n?o.emit("warn",n):o.emit("logged",t)})),i&&n(i)}},{key:"query",value:function query(t,n){"function"==typeof t&&(n=t,t={}),(t={method:"query",params:this.normalizeQuery(t)}).params.path&&(t.path=t.params.path,delete t.params.path),t.params.auth&&(t.auth=t.params.auth,delete t.params.auth),this._request(t,(function(t,i,o){if(i&&200!==i.statusCode&&(t=new Error("Invalid HTTP Status Code: ".concat(i.statusCode))),t)return n(t);if("string"==typeof o)try{o=JSON.parse(o)}catch(t){return n(t)}n(null,o)}))}},{key:"stream",value:function stream(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},stream=new m;(t={method:"stream",params:t}).params.path&&(t.path=t.params.path,delete t.params.path),t.params.auth&&(t.auth=t.params.auth,delete t.params.auth);var n="",i=this._request(t);return stream.destroy=function(){return i.destroy()},i.on("data",(function(t){for(var i=(t=(n+t).split(/\n+/)).length-1,o=0;o<i;o++)try{stream.emit("log",JSON.parse(t[o]))}catch(t){stream.emit("error",t)}n=t[i]})),i.on("error",(function(t){return stream.emit("error",t)})),stream}},{key:"_request",value:function _request(t,n){var i=(t=t||{}).auth||this.auth,m=t.path||this.path||"";delete t.auth,delete t.path;var g=Object.assign({},this.headers);i&&i.bearer&&(g.Authorization="Bearer ".concat(i.bearer));var _=(this.ssl?s:a).request(_objectSpread(_objectSpread({},this.options),{},{method:"POST",host:this.host,port:this.port,path:"/".concat(m.replace(/^\//,"")),headers:g,auth:i&&i.username&&i.password?"".concat(i.username,":").concat(i.password):"",agent:this.agent}));_.on("error",n),_.on("response",(function(t){return t.on("end",(function(){return n(null,t)})).resume()})),_.end(o.from(JSON.stringify(t),"utf8"))}}]),Http}(g)}).call(this,i(78).setImmediate,i(31).Buffer)},function(t,n,i){(function(n,o,a){var s=i(240),m=i(45),g=i(241),_=i(122),S=i(420),M=g.IncomingMessage,T=g.readyStates,O=t.exports=function(t){var i,o=this;_.Writable.call(o),o._opts=t,o._body=[],o._headers={},t.auth&&o.setHeader("Authorization","Basic "+new n(t.auth).toString("base64")),Object.keys(t.headers).forEach((function(n){o.setHeader(n,t.headers[n])}));var a=!0;if("disable-fetch"===t.mode||"requestTimeout"in t&&!s.abortController)a=!1,i=!0;else if("prefer-streaming"===t.mode)i=!1;else if("allow-wrong-content-type"===t.mode)i=!s.overrideMimeType;else{if(t.mode&&"default"!==t.mode&&"prefer-fast"!==t.mode)throw new Error("Invalid value for opts.mode");i=!0}o._mode=function decideMode(t,n){return s.fetch&&n?"fetch":s.mozchunkedarraybuffer?"moz-chunked-arraybuffer":s.msstream?"ms-stream":s.arraybuffer&&t?"arraybuffer":s.vbArray&&t?"text:vbarray":"text"}(i,a),o._fetchTimer=null,o.on("finish",(function(){o._onFinish()}))};m(O,_.Writable),O.prototype.setHeader=function(t,n){var i=t.toLowerCase();-1===A.indexOf(i)&&(this._headers[i]={name:t,value:n})},O.prototype.getHeader=function(t){var n=this._headers[t.toLowerCase()];return n?n.value:null},O.prototype.removeHeader=function(t){delete this._headers[t.toLowerCase()]},O.prototype._onFinish=function(){var t=this;if(!t._destroyed){var i=t._opts,m=t._headers,g=null;"GET"!==i.method&&"HEAD"!==i.method&&(g=s.arraybuffer?S(n.concat(t._body)):s.blobConstructor?new o.Blob(t._body.map((function(t){return S(t)})),{type:(m["content-type"]||{}).value||""}):n.concat(t._body).toString());var _=[];if(Object.keys(m).forEach((function(t){var n=m[t].name,i=m[t].value;Array.isArray(i)?i.forEach((function(t){_.push([n,t])})):_.push([n,i])})),"fetch"===t._mode){var M=null;if(s.abortController){var O=new AbortController;M=O.signal,t._fetchAbortController=O,"requestTimeout"in i&&0!==i.requestTimeout&&(t._fetchTimer=o.setTimeout((function(){t.emit("requestTimeout"),t._fetchAbortController&&t._fetchAbortController.abort()}),i.requestTimeout))}o.fetch(t._opts.url,{method:t._opts.method,headers:_,body:g||void 0,mode:"cors",credentials:i.withCredentials?"include":"same-origin",signal:M}).then((function(n){t._fetchResponse=n,t._connect()}),(function(n){o.clearTimeout(t._fetchTimer),t._destroyed||t.emit("error",n)}))}else{var A=t._xhr=new o.XMLHttpRequest;try{A.open(t._opts.method,t._opts.url,!0)}catch(n){return void a.nextTick((function(){t.emit("error",n)}))}"responseType"in A&&(A.responseType=t._mode.split(":")[0]),"withCredentials"in A&&(A.withCredentials=!!i.withCredentials),"text"===t._mode&&"overrideMimeType"in A&&A.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in i&&(A.timeout=i.requestTimeout,A.ontimeout=function(){t.emit("requestTimeout")}),_.forEach((function(t){A.setRequestHeader(t[0],t[1])})),t._response=null,A.onreadystatechange=function(){switch(A.readyState){case T.LOADING:case T.DONE:t._onXHRProgress()}},"moz-chunked-arraybuffer"===t._mode&&(A.onprogress=function(){t._onXHRProgress()}),A.onerror=function(){t._destroyed||t.emit("error",new Error("XHR error"))};try{A.send(g)}catch(n){return void a.nextTick((function(){t.emit("error",n)}))}}}},O.prototype._onXHRProgress=function(){(function statusValid(t){try{var n=t.status;return null!==n&&0!==n}catch(t){return!1}})(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},O.prototype._connect=function(){var t=this;t._destroyed||(t._response=new M(t._xhr,t._fetchResponse,t._mode,t._fetchTimer),t._response.on("error",(function(n){t.emit("error",n)})),t.emit("response",t._response))},O.prototype._write=function(t,n,i){this._body.push(t),i()},O.prototype.abort=O.prototype.destroy=function(){this._destroyed=!0,o.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},O.prototype.end=function(t,n,i){"function"==typeof t&&(i=t,t=void 0),_.Writable.prototype.end.call(this,t,n,i)},O.prototype.flushHeaders=function(){},O.prototype.setTimeout=function(){},O.prototype.setNoDelay=function(){},O.prototype.setSocketKeepAlive=function(){};var A=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]}).call(this,i(31).Buffer,i(33),i(25))},function(t,n,i){var o=i(31).Buffer;t.exports=function(t){if(t instanceof Uint8Array){if(0===t.byteOffset&&t.byteLength===t.buffer.byteLength)return t.buffer;if("function"==typeof t.buffer.slice)return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}if(o.isBuffer(t)){for(var n=new Uint8Array(t.length),i=t.length,a=0;a<i;a++)n[a]=t[a];return n.buffer}throw new Error("Argument must be a Buffer")}},function(t,n){t.exports=function extend(){for(var t={},n=0;n<arguments.length;n++){var o=arguments[n];for(var a in o)i.call(o,a)&&(t[a]=o[a])}return t};var i=Object.prototype.hasOwnProperty},function(t,n){t.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(t,n,i){(function(t,o){var a;!function(s){n&&n.nodeType,t&&t.nodeType;var m="object"==typeof o&&o;m.global!==m&&m.window!==m&&m.self;var g,_=2147483647,S=/^xn--/,M=/[^\x20-\x7E]/,T=/[\x2E\u3002\uFF0E\uFF61]/g,O={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},A=Math.floor,P=String.fromCharCode;function error(t){throw new RangeError(O[t])}function map(t,n){for(var i=t.length,o=[];i--;)o[i]=n(t[i]);return o}function mapDomain(t,n){var i=t.split("@"),o="";return i.length>1&&(o=i[0]+"@",t=i[1]),o+map((t=t.replace(T,".")).split("."),n).join(".")}function ucs2decode(t){for(var n,i,o=[],a=0,s=t.length;a<s;)(n=t.charCodeAt(a++))>=55296&&n<=56319&&a<s?56320==(64512&(i=t.charCodeAt(a++)))?o.push(((1023&n)<<10)+(1023&i)+65536):(o.push(n),a--):o.push(n);return o}function ucs2encode(t){return map(t,(function(t){var n="";return t>65535&&(n+=P((t-=65536)>>>10&1023|55296),t=56320|1023&t),n+P(t)})).join("")}function digitToBasic(t,n){return t+22+75*(t<26)-((0!=n)<<5)}function adapt(t,n,i){var o=0;for(t=i?A(t/700):t>>1,t+=A(t/n);t>455;o+=36)t=A(t/35);return A(o+36*t/(t+38))}function decode(t){var n,i,o,a,s,m,g,S,M,T,O,P=[],L=t.length,R=0,N=128,I=72;for((i=t.lastIndexOf("-"))<0&&(i=0),o=0;o<i;++o)t.charCodeAt(o)>=128&&error("not-basic"),P.push(t.charCodeAt(o));for(a=i>0?i+1:0;a<L;){for(s=R,m=1,g=36;a>=L&&error("invalid-input"),((S=(O=t.charCodeAt(a++))-48<10?O-22:O-65<26?O-65:O-97<26?O-97:36)>=36||S>A((_-R)/m))&&error("overflow"),R+=S*m,!(S<(M=g<=I?1:g>=I+26?26:g-I));g+=36)m>A(_/(T=36-M))&&error("overflow"),m*=T;I=adapt(R-s,n=P.length+1,0==s),A(R/n)>_-N&&error("overflow"),N+=A(R/n),R%=n,P.splice(R++,0,N)}return ucs2encode(P)}function encode(t){var n,i,o,a,s,m,g,S,M,T,O,L,R,N,I,j=[];for(L=(t=ucs2decode(t)).length,n=128,i=0,s=72,m=0;m<L;++m)(O=t[m])<128&&j.push(P(O));for(o=a=j.length,a&&j.push("-");o<L;){for(g=_,m=0;m<L;++m)(O=t[m])>=n&&O<g&&(g=O);for(g-n>A((_-i)/(R=o+1))&&error("overflow"),i+=(g-n)*R,n=g,m=0;m<L;++m)if((O=t[m])<n&&++i>_&&error("overflow"),O==n){for(S=i,M=36;!(S<(T=M<=s?1:M>=s+26?26:M-s));M+=36)I=S-T,N=36-T,j.push(P(digitToBasic(T+I%N,0))),S=A(I/N);j.push(P(digitToBasic(S,0))),s=adapt(i,R,o==a),i=0,++o}++i,++n}return j.join("")}g={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode,encode,toASCII:function toASCII(t){return mapDomain(t,(function(t){return M.test(t)?"xn--"+encode(t):t}))},toUnicode:function toUnicode(t){return mapDomain(t,(function(t){return S.test(t)?decode(t.slice(4).toLowerCase()):t}))}},void 0===(a=function(){return g}.call(n,i,n,t))||(t.exports=a)}()}).call(this,i(243)(t),i(33))},function(t,n,i){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,n,i){"use strict";n.decode=n.parse=i(426),n.encode=n.stringify=i(427)},function(t,n,i){"use strict";function hasOwnProperty(t,n){return Object.prototype.hasOwnProperty.call(t,n)}t.exports=function(t,n,i,a){n=n||"&",i=i||"=";var s={};if("string"!=typeof t||0===t.length)return s;var m=/\+/g;t=t.split(n);var g=1e3;a&&"number"==typeof a.maxKeys&&(g=a.maxKeys);var _=t.length;g>0&&_>g&&(_=g);for(var S=0;S<_;++S){var M,T,O,A,P=t[S].replace(m,"%20"),L=P.indexOf(i);L>=0?(M=P.substr(0,L),T=P.substr(L+1)):(M=P,T=""),O=decodeURIComponent(M),A=decodeURIComponent(T),hasOwnProperty(s,O)?o(s[O])?s[O].push(A):s[O]=[s[O],A]:s[O]=A}return s};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,n,i){"use strict";var stringifyPrimitive=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,n,i,s){return n=n||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?map(a(t),(function(a){var s=encodeURIComponent(stringifyPrimitive(a))+i;return o(t[a])?map(t[a],(function(t){return s+encodeURIComponent(stringifyPrimitive(t))})).join(n):s+encodeURIComponent(stringifyPrimitive(t[a]))})).join(n):s?encodeURIComponent(stringifyPrimitive(s))+i+encodeURIComponent(stringifyPrimitive(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function map(t,n){if(t.map)return t.map(n);for(var i=[],o=0;o<t.length;o++)i.push(n(t[o],o));return i}var a=Object.keys||function(t){var n=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&n.push(i);return n}},function(t,n,i){var o=i(239),a=i(242),s=t.exports;for(var m in o)o.hasOwnProperty(m)&&(s[m]=o[m]);function validateParams(t){if("string"==typeof t&&(t=a.parse(t)),t.protocol||(t.protocol="https:"),"https:"!==t.protocol)throw new Error('Protocol "'+t.protocol+'" not supported. Expected "https:"');return t}s.request=function(t,n){return t=validateParams(t),o.request.call(this,t,n)},s.get=function(t,n){return t=validateParams(t),o.get.call(this,t,n)}},function(t,n,i){"use strict";(function(n){function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,n){return t.__proto__=n,t})(t,n)}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):n}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=i(244),a=i(27).MESSAGE,s=i(91),m=i(79);t.exports=function(t){!function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_setPrototypeOf(t,n)}(Stream,t);var i=function _createSuper(t){var n=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var i,o=_getPrototypeOf(t);if(n){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}(Stream);function Stream(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,Stream),t=i.call(this,n),!n.stream||!o(n.stream))throw new Error("options.stream is required.");return t._stream=n.stream,t._stream.setMaxListeners(1/0),t.isObjectMode=n.stream._writableState.objectMode,t.eol=n.eol||s.EOL,t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Stream,[{key:"log",value:function log(t,i){var o=this;if(n((function(){return o.emit("logged",t)})),this.isObjectMode)return this._stream.write(t),void(i&&i());this._stream.write("".concat(t[a]).concat(this.eol)),i&&i()}}]),Stream}(m)}).call(this,i(78).setImmediate)},function(t,n,i){"use strict";(function(n){function _defineProperty(t,n,i){return n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,n){return t.__proto__=n,t})(t,n)}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):n}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=i(123),a=o.Stream,s=o.Transform,m=i(185),g=i(27),_=g.LEVEL,S=g.SPLAT,M=i(244),T=i(246),O=i(250),A=i(434),P=i(435),L=i(219).warn,R=i(184),N=/%[scdjifoO%]/g,I=function(t){!function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_setPrototypeOf(t,n)}(Logger,t);var o=function _createSuper(t){var n=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var i,o=_getPrototypeOf(t);if(n){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}(Logger);function Logger(t){var n;return function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,Logger),(n=o.call(this,{objectMode:!0})).configure(t),n}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Logger,[{key:"child",value:function child(t){var n=this;return Object.create(n,{write:{value:function value(i){var o=Object.assign({},t,i);i instanceof Error&&(o.stack=i.stack,o.message=i.message),n.write(o)}}})}},{key:"configure",value:function configure(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.silent,a=n.format,s=n.defaultMeta,m=n.levels,g=n.level,_=void 0===g?"info":g,S=n.exitOnError,M=void 0===S||S,A=n.transports,P=n.colors,L=n.emitErrs,N=n.formatters,I=n.padLevels,j=n.rewriters,V=n.stripColors,U=n.exceptionHandlers,G=n.rejectionHandlers;if(this.transports.length&&this.clear(),this.silent=o,this.format=a||this.format||i(436)(),this.defaultMeta=s||null,this.levels=m||this.levels||R.npm.levels,this.level=_,this.exceptions=new T(this),this.rejections=new O(this),this.profilers={},this.exitOnError=M,A&&(A=Array.isArray(A)?A:[A]).forEach((function(n){return t.add(n)})),P||L||N||I||j||V)throw new Error(["{ colors, emitErrs, formatters, padLevels, rewriters, stripColors } were removed in winston@3.0.0.","Use a custom winston.format(function) instead.","See: https://github.com/winstonjs/winston/tree/master/UPGRADE-3.0.md"].join("\n"));U&&this.exceptions.handle(U),G&&this.rejections.handle(G)}},{key:"isLevelEnabled",value:function isLevelEnabled(t){var n=this,i=getLevelValue(this.levels,t);if(null===i)return!1;var o=getLevelValue(this.levels,this.level);return null!==o&&(this.transports&&0!==this.transports.length?-1!==this.transports.findIndex((function(t){var a=getLevelValue(n.levels,t.level);return null===a&&(a=o),a>=i})):o>=i)}},{key:"log",value:function log(t,n){for(var i,o,a=arguments.length,s=new Array(a>2?a-2:0),m=2;m<a;m++)s[m-2]=arguments[m];if(1===arguments.length)return t[_]=t.level,this._addDefaultMeta(t),this.write(t),this;if(2===arguments.length)return n&&"object"===_typeof(n)?(n[_]=n.level=t,this._addDefaultMeta(n),this.write(n),this):(this.write((_defineProperty(o={},_,t),_defineProperty(o,"level",t),_defineProperty(o,"message",n),o)),this);var g=s[0];if("object"===_typeof(g)&&null!==g){var M=n&&n.match&&n.match(N);if(!M){var T,O=Object.assign({},this.defaultMeta,g,(_defineProperty(T={},_,t),_defineProperty(T,S,s),_defineProperty(T,"level",t),_defineProperty(T,"message",n),T));return g.message&&(O.message="".concat(O.message," ").concat(g.message)),g.stack&&(O.stack=g.stack),this.write(O),this}}return this.write(Object.assign({},this.defaultMeta,(_defineProperty(i={},_,t),_defineProperty(i,S,s),_defineProperty(i,"level",t),_defineProperty(i,"message",n),i))),this}},{key:"_transform",value:function _transform(t,n,i){if(this.silent)return i();t[_]||(t[_]=t.level),this.levels[t[_]]||0===this.levels[t[_]]||console.error("[winston] Unknown logger level: %s",t[_]),this._readableState.pipes||console.error("[winston] Attempt to write logs with no transports %j",t);try{this.push(this.format.transform(t,this.format.options))}catch(t){throw t}finally{i()}}},{key:"_final",value:function _final(t){var i=this.transports.slice();m(i,(function(t,i){if(!t||t.finished)return n(i);t.once("finish",i),t.end()}),t)}},{key:"add",value:function add(t){var n=!M(t)||t.log.length>2?new A({transport:t}):t;if(!n._writableState||!n._writableState.objectMode)throw new Error("Transports must WritableStreams in objectMode. Set { objectMode: true }.");return this._onEvent("error",n),this._onEvent("warn",n),this.pipe(n),t.handleExceptions&&this.exceptions.handle(),t.handleRejections&&this.rejections.handle(),this}},{key:"remove",value:function remove(t){if(!t)return this;var n=t;return(!M(t)||t.log.length>2)&&(n=this.transports.filter((function(n){return n.transport===t}))[0]),n&&this.unpipe(n),this}},{key:"clear",value:function clear(){return this.unpipe(),this}},{key:"close",value:function close(){return this.clear(),this.emit("close"),this}},{key:"setLevels",value:function setLevels(){L.deprecated("setLevels")}},{key:"query",value:function query(t,n){"function"==typeof t&&(n=t,t={}),t=t||{};var i={},o=Object.assign({},t.query||{});m(this.transports.filter((function(t){return!!t.query})),(function addResults(n,a){!function queryTransport(n,i){t.query&&"function"==typeof n.formatQuery&&(t.query=n.formatQuery(o)),n.query(t,(function(o,a){if(o)return i(o);"function"==typeof n.formatResults&&(a=n.formatResults(a,t.format)),i(null,a)}))}(n,(function(t,o){a&&((o=t||o)&&(i[n.name]=o),a()),a=null}))}),(function(){return n(null,i)}))}},{key:"stream",value:function stream(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=new a,i=[];return n._streams=i,n.destroy=function(){for(var t=i.length;t--;)i[t].destroy()},this.transports.filter((function(t){return!!t.stream})).forEach((function(o){var a=o.stream(t);a&&(i.push(a),a.on("log",(function(t){t.transport=t.transport||[],t.transport.push(o.name),n.emit("log",t)})),a.on("error",(function(t){t.transport=t.transport||[],t.transport.push(o.name),n.emit("error",t)})))})),n}},{key:"startTimer",value:function startTimer(){return new P(this)}},{key:"profile",value:function profile(t){var n=Date.now();if(this.profilers[t]){var i=this.profilers[t];delete this.profilers[t];for(var o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];"function"==typeof a[a.length-2]&&(console.warn("Callback function no longer supported as of winston@3.0.0"),a.pop());var m="object"===_typeof(a[a.length-1])?a.pop():{};return m.level=m.level||"info",m.durationMs=n-i,m.message=m.message||t,this.write(m)}return this.profilers[t]=n,this}},{key:"handleExceptions",value:function handleExceptions(){var t;console.warn("Deprecated: .handleExceptions() will be removed in winston@4. Use .exceptions.handle()"),(t=this.exceptions).handle.apply(t,arguments)}},{key:"unhandleExceptions",value:function unhandleExceptions(){var t;console.warn("Deprecated: .unhandleExceptions() will be removed in winston@4. Use .exceptions.unhandle()"),(t=this.exceptions).unhandle.apply(t,arguments)}},{key:"cli",value:function cli(){throw new Error(["Logger.cli() was removed in winston@3.0.0","Use a custom winston.formats.cli() instead.","See: https://github.com/winstonjs/winston/tree/master/UPGRADE-3.0.md"].join("\n"))}},{key:"_onEvent",value:function _onEvent(t,n){n["__winston"+t]||(n["__winston"+t]=function transportEvent(i){"error"!==t||this.transports.includes(n)||this.add(n),this.emit(t,i,n)}.bind(this),n.on(t,n["__winston"+t]))}},{key:"_addDefaultMeta",value:function _addDefaultMeta(t){this.defaultMeta&&Object.assign(t,this.defaultMeta)}}]),Logger}(s);function getLevelValue(t,n){var i=t[n];return i||0===i?i:null}Object.defineProperty(I.prototype,"transports",{configurable:!1,enumerable:!0,get:function get(){var t=this._readableState.pipes;return Array.isArray(t)?t:[t].filter(Boolean)}}),t.exports=I}).call(this,i(78).setImmediate)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=_interopRequireDefault(i(181)),a=_interopRequireDefault(i(182)),s=_interopRequireDefault(i(226)),m=_interopRequireDefault(i(227)),g=_interopRequireDefault(i(228)),_=_interopRequireDefault(i(92)),S=_interopRequireDefault(i(121));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function eachOfArrayLike(t,n,i){i=(0,m.default)(i);var o=0,s=0,{length:_}=t,S=!1;function iteratorCallback(t,n){!1===t&&(S=!0),!0!==S&&(t?i(t):++s!==_&&n!==a.default||i(null))}for(0===_&&i(null);o<_;o++)n(t[o],o,(0,g.default)(iteratorCallback))}function eachOfGeneric(t,n,i){return(0,s.default)(t,1/0,n,i)}n.default=(0,S.default)((function eachOf(t,n,i){return((0,o.default)(t)?eachOfArrayLike:eachOfGeneric)(t,(0,_.default)(n),i)}),3),t.exports=n.default},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function _withoutIndex(t){return(n,i,o)=>t(n,o)},t.exports=n.default},function(t,n,i){"use strict";var o=Object.prototype.toString;t.exports=function name(t){if("string"==typeof t.displayName&&t.constructor.name)return t.displayName;if("string"==typeof t.name&&t.name)return t.name;if("object"==typeof t&&t.constructor&&"string"==typeof t.constructor.name)return t.constructor.name;var n=t.toString(),i=o.call(t).slice(8,-1);return(n="Function"===i?n.substring(n.indexOf("(")+1,n.indexOf(")")):i)||"anonymous"}},function(t,n,i){"use strict";const o=i(72),{LEVEL:a}=i(27),s=i(79),m=t.exports=function LegacyTransportStream(t={}){if(s.call(this,t),!t.transport||"function"!=typeof t.transport.log)throw new Error("Invalid transport, must be an object with a log method.");this.transport=t.transport,this.level=this.level||t.transport.level,this.handleExceptions=this.handleExceptions||t.transport.handleExceptions,this._deprecated(),this.transport.__winstonError||(this.transport.__winstonError=function transportError(t){this.emit("error",t,this.transport)}.bind(this),this.transport.on("error",this.transport.__winstonError))};o.inherits(m,s),m.prototype._write=function _write(t,n,i){if(this.silent||!0===t.exception&&!this.handleExceptions)return i(null);(!this.level||this.levels[this.level]>=this.levels[t[a]])&&this.transport.log(t[a],t.message,t,this._nop),i(null)},m.prototype._writev=function _writev(t,n){for(let n=0;n<t.length;n++)this._accept(t[n])&&(this.transport.log(t[n].chunk[a],t[n].chunk.message,t[n].chunk,this._nop),t[n].callback());return n(null)},m.prototype._deprecated=function _deprecated(){console.error([this.transport.name+" is a legacy winston transport. Consider upgrading: ","- Upgrade docs: https://github.com/winstonjs/winston/blob/master/UPGRADE-3.0.md"].join("\n"))},m.prototype.close=function close(){this.transport.close&&this.transport.close(),this.transport.__winstonError&&(this.transport.removeListener("error",this.transport.__winstonError),this.transport.__winstonError=null)}},function(t,n,i){"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}t.exports=function(){function Profiler(t){if(function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,Profiler),!t)throw new Error("Logger is required for profiling.");this.logger=t,this.start=Date.now()}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Profiler,[{key:"done",value:function done(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];"function"==typeof n[n.length-1]&&(console.warn("Callback function no longer supported as of winston@3.0.0"),n.pop());var o="object"===_typeof(n[n.length-1])?n.pop():{};return o.level=o.level||"info",o.durationMs=Date.now()-this.start,this.logger.write(o)}}]),Profiler}()},function(t,n,i){"use strict";(function(n){const o=i(437),{MESSAGE:a}=i(27),s=i(138);function replacer(t,i){return i instanceof n?i.toString("base64"):"bigint"==typeof i?i.toString():i}t.exports=o((t,n={})=>(t[a]=(n.stable?s.stableStringify:s)(t,n.replacer||replacer,n.space),t))}).call(this,i(31).Buffer)},function(t,n,i){"use strict";class InvalidFormatError extends Error{constructor(t){super(`Format functions must be synchronous taking a two arguments: (info, opts)\nFound: ${t.toString().split("\n")[0]}\n`),Error.captureStackTrace(this,InvalidFormatError)}}t.exports=t=>{if(t.length>2)throw new InvalidFormatError(t);function Format(t={}){this.options=t}function createFormatWrap(t){return new Format(t)}return Format.prototype.transform=t,createFormatWrap.Format=Format,createFormatWrap}},function(t,n,i){"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=i(245);t.exports=function(){function Container(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Container),this.loggers=new Map,this.options=t}return function _createClass(t,n,i){n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i)}(Container,[{key:"add",value:function add(t,n){var i=this;if(!this.loggers.has(t)){var a=(n=Object.assign({},n||this.options)).transports||this.options.transports;n.transports=a?a.slice():[];var s=o(n);s.on("close",(function(){return i._delete(t)})),this.loggers.set(t,s)}return this.loggers.get(t)}},{key:"get",value:function get(t,n){return this.add(t,n)}},{key:"has",value:function has(t){return!!this.loggers.has(t)}},{key:"close",value:function close(t){var n=this;if(t)return this._removeLogger(t);this.loggers.forEach((function(t,i){return n._removeLogger(i)}))}},{key:"_removeLogger",value:function _removeLogger(t){this.loggers.has(t)&&(this.loggers.get(t).close(),this._delete(t))}},{key:"_delete",value:function _delete(t){this.loggers.delete(t)}}]),Container}()},function(t,n){!function(t){function p(t){var n=t.code,i=t.name;Object.defineProperty(this,"code",{set:function(t){n=t},get:function(){return n}}),Object.defineProperty(this,"name",{set:function(t){i=t},get:function(){return i}})}function w(t,n){var i=n;for("/"!=n[0]&&(i=t+"/"+n),t=i.split("/"),n=[],i=0;i<t.length;++i){var o=t[i];if(".."===o){if(!n.length)throw Error("Invalid path");n.pop()}else"."!==o&&""!==o&&n.push(o)}return"/"+n.join("/")}function x(t){var n=null;this.size=t.size||0,this.name=t.name||"",this.type=t.type||"",this.lastModifiedDate=t.lastModifiedDate||null,Object.defineProperty(this,"blob_",{enumerable:!0,get:function(){return n},set:function(t){n=t,this.size=n.size,this.name=n.name,this.type=n.type,this.lastModifiedDate=n.lastModifiedDate}.bind(this)})}function C(t){if(!t)throw Error("Expected fileEntry argument to write.");var n=0,o=t.file_?t.file_.blob_:null;Object.defineProperty(this,"position",{get:function(){return n}}),Object.defineProperty(this,"length",{get:function(){return o?o.size:0}}),this.seek=function(t){(n=t)>this.length&&(n=this.length),0>n&&(n+=this.length),0>n&&(n=0)},this.truncate=function(t){o=o?t<this.length?o.slice(0,t):new Blob([o,new Uint8Array(t-this.length)],{type:o.type}):new Blob([]),n=0,this.write(o)},this.write=function(a){if(!a)throw Error("Expected blob argument to write.");if(this.onwritestart&&this.onwritestart(),o){var s=o.slice(0,n),m=o.slice(n+a.size),g=n-s.size;0>g&&(g=0),o=new Blob([s,new Uint8Array(g),a,m],{type:o.type})}else o=new Blob([a],{type:a.type});s=function(s){t.file_.blob_=s,t.file_.lastModifiedDate=a.lastModifiedDate||new Date,_.put(t,function(s){i||(t.file_.blob_=o,t.file_.lastModifiedDate=a.lastModifiedDate||null),n+=a.size,this.onwriteend&&this.onwriteend()}.bind(this),this.onerror)}.bind(this),i?s(o):D(o,s)}}function E(t){var n=!1;this.readEntries=function(i,o){if(!i)throw Error("Expected successCallback argument.");n?i([]):_.getAllEntries(t.fullPath,(function(t){n=!0,i(t)}),o)}}function y(t,n){this.modificationTime_=t||null,this.size_=n||0}function u(){}function k(t){this.file_=null,Object.defineProperty(this,"isFile",{enumerable:!0,get:function(){return!0}}),Object.defineProperty(this,"isDirectory",{enumerable:!0,get:function(){return!1}}),t&&(this.file_=t.file_,this.name=t.name,this.fullPath=t.fullPath,this.filesystem=t.filesystem,"string"==typeof this.file_.blob_&&(this.file_.blob_=B(this.file_.blob_)))}function h(t){Object.defineProperty(this,"isFile",{enumerable:!0,get:function(){return!1}}),Object.defineProperty(this,"isDirectory",{enumerable:!0,get:function(){return!0}}),t&&(this.name=t.name,this.fullPath=t.fullPath,this.filesystem=t.filesystem)}function F(n,i){g=n==t.TEMPORARY?"Temporary":"Persistent",this.name=(location.protocol+location.host).replace(/:/g,"_")+":"+g,this.root=new h,this.root.fullPath="/",this.root.filesystem=this,this.root.name=""}function l(t){switch(t.target.errorCode){case 12:console.log("Error - Attempt to open db with a lower version than the current one.");break;default:console.log("errorCode: "+t.target.errorCode)}console.log(t,t.code,t.message)}if(!t.requestFileSystem&&!t.webkitRequestFileSystem){var n=t.indexedDB||t.mozIndexedDB||t.msIndexedDB;if(n){var i=!0;new function(){n.deleteDatabase("blob-support").onsuccess=function(){var t=n.open("blob-support",1);t.onerror=function(){i=!1},t.onsuccess=function(){var o=t.result;try{var a=new Blob(["test"],{type:"text/plain"});o.transaction("store","readwrite").objectStore("store").put(a,"key"),i=!0}catch(t){i=!1}finally{o.close(),n.deleteDatabase("blob-support")}},t.onupgradeneeded=function(){t.result.createObjectStore("store")}}};var B=function(t){if(-1==t.indexOf(";base64,")){var n=t.split(",");return t=n[0].split(":")[1],n=decodeURIComponent(n[1]),new Blob([n],{type:t})}n=t.split(";base64,"),t=n[0].split(":")[1];for(var i=(n=window.atob(n[1])).length,o=new Uint8Array(i),a=0;a<i;++a)o[a]=n.charCodeAt(a);return new Blob([o],{type:t})},D=function(t,n){var i=new FileReader;i.readAsDataURL(t),i.onloadend=function(){n(i.result)}};t.PERSISTENT||(t.TEMPORARY=0,t.PERSISTENT=1),void 0===t.FileError&&(window.FileError=function(){},FileError.prototype.prototype=Error.prototype),FileError.INVALID_MODIFICATION_ERR||(FileError.INVALID_MODIFICATION_ERR=9,FileError.NOT_FOUND_ERR=1),p.prototype=FileError.prototype,p.prototype.toString=Error.prototype.toString;var o=new p({code:FileError.INVALID_MODIFICATION_ERR,name:"INVALID_MODIFICATION_ERR"}),a=new p({code:1e3,name:"Not implemented"}),s=new p({code:FileError.NOT_FOUND_ERR,name:"Not found"}),m=null,g="temporary",_={db:null},S=String.fromCharCode(48);x.prototype.constructor=x,y.prototype={get modificationTime(){return this.modificationTime_},get size(){return this.size_}},u.prototype={name:null,fullPath:null,filesystem:null,copyTo:function(){throw a},getMetadata:function(t,n){if(!t)throw Error("Expected successCallback argument.");try{this.isFile?t(new y(this.file_.lastModifiedDate,this.file_.size)):n(new p({code:1001,name:"getMetadata() not implemented for DirectoryEntry"}))}catch(t){n&&n(t)}},getParent:function(){throw a},moveTo:function(){throw a},remove:function(t,n){if(!t)throw Error("Expected successCallback argument.");_.delete(this.fullPath,(function(){t()}),n)},toURL:function(){return"filesystem:"+location.protocol+"//"+location.host+"/"+g.toLowerCase()+this.fullPath}},k.prototype=new u,k.prototype.constructor=k,k.prototype.createWriter=function(t){t(new C(this))},k.prototype.file=function(t,n){if(!t)throw Error("Expected successCallback argument.");if(null==this.file_){if(!n)throw s;n(s)}else(n=null==this.file_.blob_?this.file_:this.file_.blob_).lastModifiedDate=this.file_.lastModifiedDate,t(n)},h.prototype=new u,h.prototype.constructor=h,h.prototype.createReader=function(){return new E(this)},h.prototype.getDirectory=function(t,n,i,a){t=w(this.fullPath,t),_.get(t,(function(g){n||(n={}),!0===n.create&&!0===n.exclusive&&g?a&&a(o):!0!==n.create||g?!0===n.create&&g?g.isDirectory?i(new h(g)):a&&a(o):n.create&&!1!==n.create||g?n.create&&!1!==n.create||!g||!g.isFile?i(new h(g)):a&&a(o):"/"==t?((g=new h).name="",g.fullPath="/",g.filesystem=m,i(g)):a&&a(s):((g=new h).name=t.split("/").pop(),g.fullPath=t,g.filesystem=m,_.put(g,i,a))}),a)},h.prototype.getFile=function(t,n,i,a){t=w(this.fullPath,t),_.get(t,(function(g){n||(n={}),!0===n.create&&!0===n.exclusive&&g?a&&a(o):!0!==n.create||g?!0===n.create&&g?g.isFile?i(new k(g)):a&&a(o):n.create&&!1!==n.create||g?n.create&&!1!==n.create||!g||!g.isDirectory?i(new k(g)):a&&a(o):a&&a(s):((g=new k).name=t.split("/").pop(),g.fullPath=t,g.filesystem=m,g.file_=new x({size:0,name:g.name,lastModifiedDate:new Date}),_.put(g,i,a))}),a)},h.prototype.removeRecursively=function(t,n){if(!t)throw Error("Expected successCallback argument.");this.remove(t,n)},_.open=function(t,i,o){var a=this;(t=n.open(t.replace(":","_"))).onerror=o||l,t.onupgradeneeded=function(t){a.db=t.target.result,a.db.onerror=l,a.db.objectStoreNames.contains("entries")||a.db.createObjectStore("entries")},t.onsuccess=function(t){a.db=t.target.result,a.db.onerror=l,i(t)},t.onblocked=o||l},_.close=function(){this.db.close(),this.db=null},_.drop=function(t,i){if(this.db){var o=n.deleteDatabase(this.db.name);o.onsuccess=function(n){t(n)},o.onerror=i||l,_.close()}},_.get=function(t,n,i){if(this.db){var o=this.db.transaction(["entries"],"readonly");t=IDBKeyRange.bound(t,t+S,!1,!0);var a=o.objectStore("entries").get(t);o.onabort=i||l,o.oncomplete=function(t){n(a.result)}}},_.getAllEntries=function(t,n,i){if(this.db){var o=[],a=null;"/"!=t&&(a=IDBKeyRange.bound(t+"/",t+S,!1,!0));var s=this.db.transaction(["entries"],"readonly");s.onabort=i||l,s.oncomplete=function(i){o=o.filter((function(n){var i=n.fullPath.split("/").length,o=t.split("/").length;if("/"==t&&i<o+1||"/"!=t&&i==o+1)return n})),n(o)},s.objectStore("entries").openCursor(a).onsuccess=function(t){if(t=t.target.result){var n=t.value;o.push(n.isFile?new k(n):new h(n)),t.continue()}}}},_.delete=function(t,n,i){if(this.db){var o=this.db.transaction(["entries"],"readwrite");o.oncomplete=n,o.onabort=i||l,t=IDBKeyRange.bound(t,t+S,!1,!0),o.objectStore("entries").delete(t)}},_.put=function(t,n,i){if(this.db){var o=this.db.transaction(["entries"],"readwrite");o.onabort=i||l,o.oncomplete=function(i){n(t)},o.objectStore("entries").put(t,t.fullPath)}},t.addEventListener("beforeunload",(function(t){_.db&&_.db.close()}),!1),t.requestFileSystem=function(n,i,a,s){n!=t.TEMPORARY&&n!=t.PERSISTENT&&s?s(o):(m=new F(n,i),_.open(m.name,(function(t){a(m)}),s))},t.resolveLocalFileSystemURL=function(t,n,i){var o="filesystem:"+location.protocol+"//"+location.host+"/"+g.toLowerCase();"/"===(t=t.replace(o,"")).substr(-1)&&(t=t.slice(0,-1)),t?_.get(t,(function(t){if(t){if(t.isFile)return n(new k(t));if(t.isDirectory)return n(new h(t))}else i&&i(s)}),i):n(m.root)},t===window&&t.RUNNING_TESTS&&(t.Entry=u,t.FileEntry=k,t.DirectoryEntry=h,t.resolveToFullPath_=w,t.Metadata=y,t.Base64ToBlob=B)}}}(self)},function(t,n,i){(function(t,o){var a;(function(){"use strict";var s={function:!0,object:!0},m=s[typeof window]&&window||this,g=s[typeof n]&&n,_=s[typeof t]&&t&&!t.nodeType&&t,S=g&&_&&"object"==typeof o&&o;!S||S.global!==S&&S.window!==S&&S.self!==S||(m=S);var M=Math.pow(2,53)-1,T=/\bOpera/,O=Object.prototype,A=O.hasOwnProperty,P=O.toString;function capitalize(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function format(t){return t=trim(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:capitalize(t)}function forOwn(t,n){for(var i in t)A.call(t,i)&&n(t[i],i,t)}function getClassOf(t){return null==t?capitalize(t):P.call(t).slice(8,-1)}function qualify(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function reduce(t,n){var i=null;return function each(t,n){var i=-1,o=t?t.length:0;if("number"==typeof o&&o>-1&&o<=M)for(;++i<o;)n(t[i],i,t);else forOwn(t,n)}(t,(function(o,a){i=n(i,o,a,t)})),i}function trim(t){return String(t).replace(/^ +| +$/g,"")}var L=function parse(t){var n=m,i=t&&"object"==typeof t&&"String"!=getClassOf(t);i&&(n=t,t=null);var o=n.navigator||{},a=o.userAgent||"";t||(t=a);var s,g,_=i?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(P.toString()),S=i?"Object":"ScriptBridgingProxyObject",M=i?"Object":"Environment",O=i&&n.java?"JavaPackage":getClassOf(n.java),A=i?"Object":"RuntimeObject",L=/\bJava/.test(O)&&n.java,R=L&&getClassOf(n.environment)==M,N=L?"a":"α",I=L?"b":"β",j=n.document||{},V=n.operamini||n.opera,U=T.test(U=i&&V?V["[[Class]]"]:getClassOf(V))?U:V=null,G=t,z=[],H=null,q=t==a,Z=q&&V&&"function"==typeof V.version&&V.version(),X=function getLayout(n){return reduce(n,(function(n,i){return n||RegExp("\\b"+(i.pattern||qualify(i))+"\\b","i").exec(t)&&(i.label||i)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),Q=function getName(n){return reduce(n,(function(n,i){return n||RegExp("\\b"+(i.pattern||qualify(i))+"\\b","i").exec(t)&&(i.label||i)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Y=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),J=function getManufacturer(n){return reduce(n,(function(n,i,o){return n||(i[Y]||i[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Y)]||RegExp("\\b"+qualify(o)+"(?:\\b|\\w*\\d)","i").exec(t))&&o}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),K=function getOS(n){return reduce(n,(function(n,i){var o=i.pattern||qualify(i);return!n&&(n=RegExp("\\b"+o+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(n=function cleanupOS(t,n,i){var o={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return n&&i&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(o=o[/[\d.]+$/.exec(t)])&&(t="Windows "+o),t=String(t),n&&i&&(t=t.replace(RegExp(n,"i"),i)),format(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(n,o,i.label||i)),n}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(n){return reduce(n,(function(n,i){var o=i.pattern||qualify(i);return!n&&(n=RegExp("\\b"+o+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+o+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+o+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((n=String(i.label&&!RegExp(o,"i").test(i.label)?i.label:n).split("/"))[1]&&!/[\d.]+/.test(n[0])&&(n[0]+=" "+n[1]),i=i.label||i,n=format(n[0].replace(RegExp(o,"i"),i).replace(RegExp("; *(?:"+i+"[_-])?","i")," ").replace(RegExp("("+i+")[-_.]?(\\w)","i"),"$1 $2"))),n}))}function getVersion(n){return reduce(n,(function(n,i){return n||(RegExp(i+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(X&&(X=[X]),/\bAndroid\b/.test(K)&&!Y&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(Y=trim(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),J&&!Y?Y=getProduct([J]):J&&Y&&(Y=Y.replace(RegExp("^("+qualify(J)+")[-_.\\s]","i"),J+" ").replace(RegExp("^("+qualify(J)+")[-_.]?(\\w)","i"),J+" $2")),(s=/\bGoogle TV\b/.exec(Y))&&(Y=s[0]),/\bSimulator\b/i.test(t)&&(Y=(Y?Y+" ":"")+"Simulator"),"Opera Mini"==Q&&/\bOPiOS\b/.test(t)&&z.push("running in Turbo/Uncompressed mode"),"IE"==Q&&/\blike iPhone OS\b/.test(t)?(J=(s=parse(t.replace(/like iPhone OS/,""))).manufacturer,Y=s.product):/^iP/.test(Y)?(Q||(Q="Safari"),K="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==Q&&/^Linux\b/i.test(K)?K="Kubuntu":J&&"Google"!=J&&(/Chrome/.test(Q)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(Y))||/\bAndroid\b/.test(K)&&/^Chrome/.test(Q)&&/\bVersion\//i.test(t)?(Q="Android Browser",K=/\bAndroid\b/.test(K)?K:"Android"):"Silk"==Q?(/\bMobi/i.test(t)||(K="Android",z.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&z.unshift("accelerated")):"UC Browser"==Q&&/\bUCWEB\b/.test(t)?z.push("speed mode"):"PaleMoon"==Q&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?z.push("identifying as Firefox "+s[1]):"Firefox"==Q&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(K||(K="Firefox OS"),Y||(Y=s[1])):!Q||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(Q))?(Q&&!Y&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(Q=null),(s=Y||J||K)&&(Y||J||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(K))&&(Q=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(K)?K:s)+" Browser")):"Electron"==Q&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&z.push("Chromium "+s),Z||(Z=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(Q),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==X&&parseFloat(Z)>3?"WebKit":/\bOpera\b/.test(Q)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(X)&&"WebKit"||!X&&/\bMSIE\b/i.test(t)&&("Mac OS"==K?"Tasman":"Trident")||"WebKit"==X&&/\bPlayStation\b(?! Vita\b)/i.test(Q)&&"NetFront")&&(X=[s]),"IE"==Q&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(Q+=" Mobile",K="Windows Phone "+(/\+$/.test(s)?s:s+".x"),z.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(Q="IE Mobile",K="Windows Phone 8.x",z.unshift("desktop mode"),Z||(Z=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=Q&&"Trident"==X&&(s=/\brv:([\d.]+)/.exec(t))&&(Q&&z.push("identifying as "+Q+(Z?" "+Z:"")),Q="IE",Z=s[1]),q){if(function isHostType(t,n){var i=null!=t?typeof t[n]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(i)||"object"==i&&!t[n])}(n,"global"))if(L&&(G=(s=L.lang.System).getProperty("os.arch"),K=K||s.getProperty("os.name")+" "+s.getProperty("os.version")),R){try{Z=n.require("ringo/engine").version.join("."),Q="RingoJS"}catch(t){(s=n.system)&&s.global.system==n.system&&(Q="Narwhal",K||(K=s[0].os||null))}Q||(Q="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(s=n.process)&&("object"==typeof s.versions&&("string"==typeof s.versions.electron?(z.push("Node "+s.versions.node),Q="Electron",Z=s.versions.electron):"string"==typeof s.versions.nw&&(z.push("Chromium "+Z,"Node "+s.versions.node),Q="NW.js",Z=s.versions.nw)),Q||(Q="Node.js",G=s.arch,K=s.platform,Z=(Z=/[\d.]+/.exec(s.version))?Z[0]:null));else getClassOf(s=n.runtime)==S?(Q="Adobe AIR",K=s.flash.system.Capabilities.os):getClassOf(s=n.phantom)==A?(Q="PhantomJS",Z=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof j.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(Z=[Z,j.documentMode],(s=+s[1]+4)!=Z[1]&&(z.push("IE "+Z[1]+" mode"),X&&(X[1]=""),Z[1]=s),Z="IE"==Q?String(Z[1].toFixed(1)):Z[0]):"number"==typeof j.documentMode&&/^(?:Chrome|Firefox)\b/.test(Q)&&(z.push("masking as "+Q+" "+Z),Q="IE",Z="11.0",X=["Trident"],K="Windows");K=K&&format(K)}if(Z&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(Z)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(q&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(H=/b/i.test(s)?"beta":"alpha",Z=Z.replace(RegExp(s+"\\+?$"),"")+("beta"==H?I:N)+(/\d+\+?/.exec(s)||"")),"Fennec"==Q||"Firefox"==Q&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(K))Q="Firefox Mobile";else if("Maxthon"==Q&&Z)Z=Z.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Y))"Xbox 360"==Y&&(K=null),"Xbox 360"==Y&&/\bIEMobile\b/.test(t)&&z.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(Q)&&(!Q||Y||/Browser|Mobi/.test(Q))||"Windows CE"!=K&&!/Mobi/i.test(t))if("IE"==Q&&q)try{null===n.external&&z.unshift("platform preview")}catch(t){z.unshift("embedded")}else(/\bBlackBerry\b/.test(Y)||/\bBB10\b/.test(t))&&(s=(RegExp(Y.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||Z)?(K=((s=[s,/BB10/.test(t)])[1]?(Y=null,J="BlackBerry"):"Device Software")+" "+s[0],Z=null):this!=forOwn&&"Wii"!=Y&&(q&&V||/Opera/.test(Q)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==Q&&/\bOS X (?:\d+\.){2,}/.test(K)||"IE"==Q&&(K&&!/^Win/.test(K)&&Z>5.5||/\bWindows XP\b/.test(K)&&Z>8||8==Z&&!/\bTrident\b/.test(t)))&&!T.test(s=parse.call(forOwn,t.replace(T,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),T.test(Q)?(/\bIE\b/.test(s)&&"Mac OS"==K&&(K=null),s="identify"+s):(s="mask"+s,Q=U?format(U.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(K=null),q||(Z=null)),X=["Presto"],z.push(s));else Q+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==Q&&"+"==s[1].slice(-1)?(Q="WebKit Nightly",H="alpha",Z=s[1].slice(0,-1)):Z!=s[1]&&Z!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(Z=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==X&&(X=["Blink"]),q&&(_||s[1])?(X&&(X[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=X?"27":"28")):(X&&(X[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),X&&(X[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==Q&&(!Z||parseInt(Z)>45)?Z=s:"Chrome"==Q&&/\bHeadlessChrome/i.test(t)&&z.unshift("headless")),"Opera"==Q&&(s=/\bzbov|zvav$/.exec(K))?(Q+=" ",z.unshift("desktop mode"),"zvav"==s?(Q+="Mini",Z=null):Q+="Mobile",K=K.replace(RegExp(" *"+s+"$"),"")):"Safari"==Q&&/\bChrome\b/.exec(X&&X[1])?(z.unshift("desktop mode"),Q="Chrome Mobile",Z=null,/\bOS X\b/.test(K)?(J="Apple",K="iOS 4.3+"):K=null):/\bSRWare Iron\b/.test(Q)&&!Z&&(Z=getVersion("Chrome")),Z&&0==Z.indexOf(s=/[\d.]+$/.exec(K))&&t.indexOf("/"+s+"-")>-1&&(K=trim(K.replace(s,""))),K&&-1!=K.indexOf(Q)&&!RegExp(Q+" OS").test(K)&&(K=K.replace(RegExp(" *"+qualify(Q)+" *"),"")),X&&!/\b(?:Avant|Nook)\b/.test(Q)&&(/Browser|Lunascape|Maxthon/.test(Q)||"Safari"!=Q&&/^iOS/.test(K)&&/\bSafari\b/.test(X[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(Q)&&X[1])&&(s=X[X.length-1])&&z.push(s),z.length&&(z=["("+z.join("; ")+")"]),J&&Y&&Y.indexOf(J)<0&&z.push("on "+J),Y&&z.push((/^on /.test(z[z.length-1])?"":"on ")+Y),K&&(s=/ ([\d.+]+)$/.exec(K),g=s&&"/"==K.charAt(K.length-s[0].length-1),K={architecture:32,family:s&&!g?K.replace(s[0],""):K,version:s?s[1]:null,toString:function(){var t=this.version;return this.family+(t&&!g?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(G))&&!/\bi686\b/i.test(G)?(K&&(K.architecture=64,K.family=K.family.replace(RegExp(" *"+s),"")),Q&&(/\bWOW64\b/i.test(t)||q&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&z.unshift("32-bit")):K&&/^OS X/.test(K.family)&&"Chrome"==Q&&parseFloat(Z)>=39&&(K.architecture=64),t||(t=null);var $={};return $.description=t,$.layout=X&&X[0],$.manufacturer=J,$.name=Q,$.prerelease=H,$.product=Y,$.ua=t,$.version=Q&&Z,$.os=K||{architecture:null,family:null,version:null,toString:function(){return"null"}},$.parse=parse,$.toString=function toStringPlatform(){return this.description||""},$.version&&z.unshift(Z),$.name&&z.unshift(Q),K&&Q&&(K!=String(K).split(" ")[0]||K!=Q.split(" ")[0]&&!Y)&&z.push(Y?"("+K+")":"on "+K),z.length&&($.description=z.join(" ")),$}();m.platform=L,void 0===(a=function(){return L}.call(n,i,n,t))||(t.exports=a)}).call(this)}).call(this,i(243)(t),i(33))},function(t,n,i){var o,a,s=i(254),m=i(255),g=0,_=0;t.exports=function v1(t,n,i){var S=n&&i||0,M=n||[],T=(t=t||{}).node||o,O=void 0!==t.clockseq?t.clockseq:a;if(null==T||null==O){var A=s();null==T&&(T=o=[1|A[0],A[1],A[2],A[3],A[4],A[5]]),null==O&&(O=a=16383&(A[6]<<8|A[7]))}var P=void 0!==t.msecs?t.msecs:(new Date).getTime(),L=void 0!==t.nsecs?t.nsecs:_+1,R=P-g+(L-_)/1e4;if(R<0&&void 0===t.clockseq&&(O=O+1&16383),(R<0||P>g)&&void 0===t.nsecs&&(L=0),L>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=P,_=L,a=O;var N=(1e4*(268435455&(P+=122192928e5))+L)%4294967296;M[S++]=N>>>24&255,M[S++]=N>>>16&255,M[S++]=N>>>8&255,M[S++]=255&N;var I=P/4294967296*1e4&268435455;M[S++]=I>>>8&255,M[S++]=255&I,M[S++]=I>>>24&15|16,M[S++]=I>>>16&255,M[S++]=O>>>8|128,M[S++]=255&O;for(var j=0;j<6;++j)M[S+j]=T[j];return n||m(M)}},function(t,n,i){var o=i(254),a=i(255);t.exports=function v4(t,n,i){var s=n&&i||0;"string"==typeof t&&(n="binary"===t?new Array(16):null,t=null);var m=(t=t||{}).random||(t.rng||o)();if(m[6]=15&m[6]|64,m[8]=63&m[8]|128,n)for(var g=0;g<16;++g)n[s+g]=m[g];return n||a(m)}},function(t,n,i){var o=i(444);"string"==typeof o&&(o=[[t.i,o,""]]);i(97)(o,{hmr:!0,transform:void 0,insertInto:void 0}),o.locals&&(t.exports=o.locals)},function(t,n,i){(t.exports=i(96)(!1)).push([t.i,".noty_layout_mixin, #noty_layout__top, #noty_layout__topLeft, #noty_layout__topCenter, #noty_layout__topRight, #noty_layout__bottom, #noty_layout__bottomLeft, #noty_layout__bottomCenter, #noty_layout__bottomRight, #noty_layout__center, #noty_layout__centerLeft, #noty_layout__centerRight {\n  position: fixed;\n  margin: 0;\n  padding: 0;\n  z-index: 9999999;\n  -webkit-transform: translateZ(0) scale(1, 1);\n          transform: translateZ(0) scale(1, 1);\n  -webkit-backface-visibility: hidden;\n          backface-visibility: hidden;\n  -webkit-font-smoothing: subpixel-antialiased;\n  filter: blur(0);\n  -webkit-filter: blur(0);\n  max-width: 90%; }\n\n#noty_layout__top {\n  top: 0;\n  left: 5%;\n  width: 90%; }\n\n#noty_layout__topLeft {\n  top: 20px;\n  left: 20px;\n  width: 325px; }\n\n#noty_layout__topCenter {\n  top: 5%;\n  left: 50%;\n  width: 325px;\n  -webkit-transform: translate(-webkit-calc(-50% - .5px)) translateZ(0) scale(1, 1);\n          transform: translate(calc(-50% - .5px)) translateZ(0) scale(1, 1); }\n\n#noty_layout__topRight {\n  top: 20px;\n  right: 20px;\n  width: 325px; }\n\n#noty_layout__bottom {\n  bottom: 0;\n  left: 5%;\n  width: 90%; }\n\n#noty_layout__bottomLeft {\n  bottom: 20px;\n  left: 20px;\n  width: 325px; }\n\n#noty_layout__bottomCenter {\n  bottom: 5%;\n  left: 50%;\n  width: 325px;\n  -webkit-transform: translate(-webkit-calc(-50% - .5px)) translateZ(0) scale(1, 1);\n          transform: translate(calc(-50% - .5px)) translateZ(0) scale(1, 1); }\n\n#noty_layout__bottomRight {\n  bottom: 20px;\n  right: 20px;\n  width: 325px; }\n\n#noty_layout__center {\n  top: 50%;\n  left: 50%;\n  width: 325px;\n  -webkit-transform: translate(-webkit-calc(-50% - .5px), -webkit-calc(-50% - .5px)) translateZ(0) scale(1, 1);\n          transform: translate(calc(-50% - .5px), calc(-50% - .5px)) translateZ(0) scale(1, 1); }\n\n#noty_layout__centerLeft {\n  top: 50%;\n  left: 20px;\n  width: 325px;\n  -webkit-transform: translate(0, -webkit-calc(-50% - .5px)) translateZ(0) scale(1, 1);\n          transform: translate(0, calc(-50% - .5px)) translateZ(0) scale(1, 1); }\n\n#noty_layout__centerRight {\n  top: 50%;\n  right: 20px;\n  width: 325px;\n  -webkit-transform: translate(0, -webkit-calc(-50% - .5px)) translateZ(0) scale(1, 1);\n          transform: translate(0, calc(-50% - .5px)) translateZ(0) scale(1, 1); }\n\n.noty_progressbar {\n  display: none; }\n\n.noty_has_timeout.noty_has_progressbar .noty_progressbar {\n  display: block;\n  position: absolute;\n  left: 0;\n  bottom: 0;\n  height: 3px;\n  width: 100%;\n  background-color: #646464;\n  opacity: 0.2;\n  filter: alpha(opacity=10); }\n\n.noty_bar {\n  -webkit-backface-visibility: hidden;\n  -webkit-transform: translate(0, 0) translateZ(0) scale(1, 1);\n  -ms-transform: translate(0, 0) scale(1, 1);\n      transform: translate(0, 0) scale(1, 1);\n  -webkit-font-smoothing: subpixel-antialiased;\n  overflow: hidden; }\n\n.noty_effects_open {\n  opacity: 0;\n  -webkit-transform: translate(50%);\n      -ms-transform: translate(50%);\n          transform: translate(50%);\n  -webkit-animation: noty_anim_in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n          animation: noty_anim_in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n  -webkit-animation-fill-mode: forwards;\n          animation-fill-mode: forwards; }\n\n.noty_effects_close {\n  -webkit-animation: noty_anim_out 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n          animation: noty_anim_out 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n  -webkit-animation-fill-mode: forwards;\n          animation-fill-mode: forwards; }\n\n.noty_fix_effects_height {\n  -webkit-animation: noty_anim_height 75ms ease-out;\n          animation: noty_anim_height 75ms ease-out; }\n\n.noty_close_with_click {\n  cursor: pointer; }\n\n.noty_close_button {\n  position: absolute;\n  top: 2px;\n  right: 2px;\n  font-weight: bold;\n  width: 20px;\n  height: 20px;\n  text-align: center;\n  line-height: 20px;\n  background-color: rgba(0, 0, 0, 0.05);\n  border-radius: 2px;\n  cursor: pointer;\n  -webkit-transition: all .2s ease-out;\n  transition: all .2s ease-out; }\n\n.noty_close_button:hover {\n  background-color: rgba(0, 0, 0, 0.1); }\n\n.noty_modal {\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  background-color: #000;\n  z-index: 10000;\n  opacity: .3;\n  left: 0;\n  top: 0; }\n\n.noty_modal.noty_modal_open {\n  opacity: 0;\n  -webkit-animation: noty_modal_in .3s ease-out;\n          animation: noty_modal_in .3s ease-out; }\n\n.noty_modal.noty_modal_close {\n  -webkit-animation: noty_modal_out .3s ease-out;\n          animation: noty_modal_out .3s ease-out;\n  -webkit-animation-fill-mode: forwards;\n          animation-fill-mode: forwards; }\n\n@-webkit-keyframes noty_modal_in {\n  100% {\n    opacity: .3; } }\n\n@keyframes noty_modal_in {\n  100% {\n    opacity: .3; } }\n\n@-webkit-keyframes noty_modal_out {\n  100% {\n    opacity: 0; } }\n\n@keyframes noty_modal_out {\n  100% {\n    opacity: 0; } }\n\n@keyframes noty_modal_out {\n  100% {\n    opacity: 0; } }\n\n@-webkit-keyframes noty_anim_in {\n  100% {\n    -webkit-transform: translate(0);\n            transform: translate(0);\n    opacity: 1; } }\n\n@keyframes noty_anim_in {\n  100% {\n    -webkit-transform: translate(0);\n            transform: translate(0);\n    opacity: 1; } }\n\n@-webkit-keyframes noty_anim_out {\n  100% {\n    -webkit-transform: translate(50%);\n            transform: translate(50%);\n    opacity: 0; } }\n\n@keyframes noty_anim_out {\n  100% {\n    -webkit-transform: translate(50%);\n            transform: translate(50%);\n    opacity: 0; } }\n\n@-webkit-keyframes noty_anim_height {\n  100% {\n    height: 0; } }\n\n@keyframes noty_anim_height {\n  100% {\n    height: 0; } }",""])},function(t,n){t.exports=function(t){var n="undefined"!=typeof window&&window.location;if(!n)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=n.protocol+"//"+n.host,o=i+n.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,n){var a,s=n.trim().replace(/^"(.*)"$/,(function(t,n){return n})).replace(/^'(.*)'$/,(function(t,n){return n}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(s)?t:(a=0===s.indexOf("//")?s:0===s.indexOf("/")?i+s:o+s.replace(/^\.\//,""),"url("+JSON.stringify(a)+")")}))}},function(t,n,i){var o=i(447);"string"==typeof o&&(o=[[t.i,o,""]]);i(97)(o,{hmr:!0,transform:void 0,insertInto:void 0}),o.locals&&(t.exports=o.locals)},function(t,n,i){(t.exports=i(96)(!1)).push([t.i,".noty_theme__mint.noty_bar {\n  margin: 4px 0;\n  overflow: hidden;\n  border-radius: 2px;\n  position: relative; }\n  .noty_theme__mint.noty_bar .noty_body {\n    padding: 10px;\n    font-size: 14px; }\n  .noty_theme__mint.noty_bar .noty_buttons {\n    padding: 10px; }\n\n.noty_theme__mint.noty_type__alert,\n.noty_theme__mint.noty_type__notification {\n  background-color: #fff;\n  border-bottom: 1px solid #D1D1D1;\n  color: #2F2F2F; }\n\n.noty_theme__mint.noty_type__warning {\n  background-color: #FFAE42;\n  border-bottom: 1px solid #E89F3C;\n  color: #fff; }\n\n.noty_theme__mint.noty_type__error {\n  background-color: #DE636F;\n  border-bottom: 1px solid #CA5A65;\n  color: #fff; }\n\n.noty_theme__mint.noty_type__info,\n.noty_theme__mint.noty_type__information {\n  background-color: #7F7EFF;\n  border-bottom: 1px solid #7473E8;\n  color: #fff; }\n\n.noty_theme__mint.noty_type__success {\n  background-color: #AFC765;\n  border-bottom: 1px solid #A0B55C;\n  color: #fff; }\n",""])},function(t,n,i){!function webpackUniversalModuleDefinition(n,i){t.exports=i()}(0,(function(){return function(t){var n={};function __webpack_require__(i){if(n[i])return n[i].exports;var o=n[i]={i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}return __webpack_require__.m=t,__webpack_require__.c=n,__webpack_require__.i=function(t){return t},__webpack_require__.d=function(t,n,i){__webpack_require__.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},__webpack_require__.n=function(t){var n=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(n,"a",n),n},__webpack_require__.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=6)}([function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.css=n.deepExtend=n.animationEndEvents=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n.inArray=function inArray(t,n,i){var o=void 0;if(i){for(o in n)if(n.hasOwnProperty(o)&&n[o]===t)return!0}else for(o in n)if(n.hasOwnProperty(o)&&n[o]===t)return!0;return!1},n.stopPropagation=function stopPropagation(t){void 0!==(t=t||window.event).stopPropagation?t.stopPropagation():t.cancelBubble=!0},n.generateID=function generateID(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n="noty_"+t+"_";return n+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=16*Math.random()|0;return("x"===t?n:3&n|8).toString(16)}))},n.outerHeight=function outerHeight(t){var n=t.offsetHeight,i=window.getComputedStyle(t);return n+(parseInt(i.marginTop)+parseInt(i.marginBottom))},n.addListener=addListener,n.hasClass=hasClass,n.addClass=function addClass(t,n){var i=classList(t),o=i+n;hasClass(i,n)||(t.className=o.substring(1))},n.removeClass=function removeClass(t,n){var i=classList(t),o=void 0;hasClass(t,n)&&(o=i.replace(" "+n+" "," "),t.className=o.substring(1,o.length-1))},n.remove=remove,n.classList=classList,n.visibilityChangeFlow=function visibilityChangeFlow(){var t=void 0,n=void 0;function handleVisibilityChange(){a.PageHidden?function stopAll(){setTimeout((function(){Object.keys(a.Store).forEach((function(t){a.Store.hasOwnProperty(t)&&a.Store[t].options.visibilityControl&&a.Store[t].stop()}))}),100)}():function resumeAll(){setTimeout((function(){Object.keys(a.Store).forEach((function(t){a.Store.hasOwnProperty(t)&&a.Store[t].options.visibilityControl&&a.Store[t].resume()})),a.queueRenderAll()}),100)}()}void 0!==document.hidden?(t="hidden",n="visibilitychange"):void 0!==document.msHidden?(t="msHidden",n="msvisibilitychange"):void 0!==document.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange"),n&&addListener(document,n,(function onVisibilityChange(){a.PageHidden=document[t],handleVisibilityChange()})),addListener(window,"blur",(function onBlur(){a.PageHidden=!0,handleVisibilityChange()})),addListener(window,"focus",(function onFocus(){a.PageHidden=!1,handleVisibilityChange()}))},n.createAudioElements=function createAudioElements(t){if(t.hasSound){var n=document.createElement("audio");t.options.sounds.sources.forEach((function(t){var i=document.createElement("source");i.src=t,i.type="audio/"+function getExtension(t){return t.match(/\.([^.]+)$/)[1]}(t),n.appendChild(i)})),t.barDom?t.barDom.appendChild(n):document.querySelector("body").appendChild(n),n.volume=t.options.sounds.volume,t.soundPlayed||(n.play(),t.soundPlayed=!0),n.onended=function(){remove(n)}}};var a=function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n.default=t,n}(i(1));function addListener(t,n,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n=n.split(" ");for(var a=0;a<n.length;a++)document.addEventListener?t.addEventListener(n[a],i,o):document.attachEvent&&t.attachEvent("on"+n[a],i)}function hasClass(t,n){return("string"==typeof t?t:classList(t)).indexOf(" "+n+" ")>=0}function remove(t){t.parentNode&&t.parentNode.removeChild(t)}function classList(t){return(" "+(t&&t.className||"")+" ").replace(/\s+/gi," ")}n.animationEndEvents="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",n.deepExtend=function deepExtend(t){t=t||{};for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var a in i)i.hasOwnProperty(a)&&(Array.isArray(i[a])?t[a]=i[a]:"object"===o(i[a])&&null!==i[a]?t[a]=deepExtend(t[a],i[a]):t[a]=i[a])}return t},n.css=function(){var t=["Webkit","O","Moz","ms"],n={};function applyCss(i,o,a){o=function getStyleProp(i){return i=function camelCase(t){return t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(t,n){return n.toUpperCase()}))}(i),n[i]||(n[i]=function getVendorProp(n){var i=document.body.style;if(n in i)return n;for(var o=t.length,a=n.charAt(0).toUpperCase()+n.slice(1),s=void 0;o--;)if((s=t[o]+a)in i)return s;return n}(i))}(o),i.style[o]=a}return function(t,n){var i=arguments,o=void 0,a=void 0;if(2===i.length)for(o in n)n.hasOwnProperty(o)&&void 0!==(a=n[o])&&n.hasOwnProperty(o)&&applyCss(t,o,a);else applyCss(t,i[1],i[2])}}()},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Defaults=n.Store=n.Queues=n.DefaultMaxVisible=n.docTitle=n.DocModalCount=n.PageHidden=void 0,n.getQueueCounts=function getQueueCounts(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global",n=0,i=g;return _.hasOwnProperty(t)&&(i=_[t].maxVisible,Object.keys(S).forEach((function(i){S[i].options.queue!==t||S[i].closed||n++}))),{current:n,maxVisible:i}},n.addToQueue=function addToQueue(t){_.hasOwnProperty(t.options.queue)||(_[t.options.queue]={maxVisible:g,queue:[]}),_[t.options.queue].queue.push(t)},n.removeFromQueue=function removeFromQueue(t){if(_.hasOwnProperty(t.options.queue)){var n=[];Object.keys(_[t.options.queue].queue).forEach((function(i){_[t.options.queue].queue[i].id!==t.id&&n.push(_[t.options.queue].queue[i])})),_[t.options.queue].queue=n}},n.queueRender=queueRender,n.queueRenderAll=function queueRenderAll(){Object.keys(_).forEach((function(t){queueRender(t)}))},n.ghostFix=function ghostFix(t){var n=o.generateID("ghost"),i=document.createElement("div");i.setAttribute("id",n),o.css(i,{height:o.outerHeight(t.barDom)+"px"}),t.barDom.insertAdjacentHTML("afterend",i.outerHTML),o.remove(t.barDom),i=document.getElementById(n),o.addClass(i,"noty_fix_effects_height"),o.addListener(i,o.animationEndEvents,(function(){o.remove(i)}))},n.build=function build(t){!function findOrCreateContainer(t){if(t.options.container)t.layoutDom=document.querySelector(t.options.container);else{var n="noty_layout__"+t.options.layout;t.layoutDom=document.querySelector("div#"+n),t.layoutDom||(t.layoutDom=document.createElement("div"),t.layoutDom.setAttribute("id",n),t.layoutDom.setAttribute("role","alert"),t.layoutDom.setAttribute("aria-live","polite"),o.addClass(t.layoutDom,"noty_layout"),document.querySelector("body").appendChild(t.layoutDom))}}(t);var n='<div class="noty_body">'+t.options.text+"</div>"+function buildButtons(t){if(hasButtons(t)){var n=document.createElement("div");return o.addClass(n,"noty_buttons"),Object.keys(t.options.buttons).forEach((function(i){n.appendChild(t.options.buttons[i].dom)})),t.options.buttons.forEach((function(t){n.appendChild(t.dom)})),n.outerHTML}return""}(t)+'<div class="noty_progressbar"></div>';t.barDom=document.createElement("div"),t.barDom.setAttribute("id",t.id),o.addClass(t.barDom,"noty_bar noty_type__"+t.options.type+" noty_theme__"+t.options.theme),t.barDom.innerHTML=n,fire(t,"onTemplate")},n.hasButtons=hasButtons,n.handleModal=function handleModal(t){t.options.modal&&(0===a&&function createModal(){var t=document.querySelector("body"),n=document.createElement("div");o.addClass(n,"noty_modal"),t.insertBefore(n,t.firstChild),o.addClass(n,"noty_modal_open"),o.addListener(n,o.animationEndEvents,(function(){o.removeClass(n,"noty_modal_open")}))}(),n.DocModalCount=a+=1)},n.handleModalClose=function handleModalClose(t){if(t.options.modal&&a>0&&(n.DocModalCount=a-=1,a<=0)){var i=document.querySelector(".noty_modal");i&&(o.removeClass(i,"noty_modal_open"),o.addClass(i,"noty_modal_close"),o.addListener(i,o.animationEndEvents,(function(){o.remove(i)})))}},n.queueClose=queueClose,n.dequeueClose=dequeueClose,n.fire=fire,n.openFlow=function openFlow(t){fire(t,"afterShow"),queueClose(t),o.addListener(t.barDom,"mouseenter",(function(){dequeueClose(t)})),o.addListener(t.barDom,"mouseleave",(function(){queueClose(t)}))},n.closeFlow=function closeFlow(t){delete S[t.id],t.closing=!1,fire(t,"afterClose"),o.remove(t.barDom),0!==t.layoutDom.querySelectorAll(".noty_bar").length||t.options.container||o.remove(t.layoutDom),(o.inArray("docVisible",t.options.titleCount.conditions)||o.inArray("docHidden",t.options.titleCount.conditions))&&m.decrement(),queueRender(t.options.queue)};var o=function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n.default=t,n}(i(0));n.PageHidden=!1;var a=n.DocModalCount=0,s={originalTitle:null,count:0,changed:!1,timer:-1},m=n.docTitle={increment:function increment(){s.count++,m._update()},decrement:function decrement(){s.count--,s.count<=0?m._clear():m._update()},_update:function _update(){var t=document.title;s.changed?document.title="("+s.count+") "+s.originalTitle:(s.originalTitle=t,document.title="("+s.count+") "+t,s.changed=!0)},_clear:function _clear(){s.changed&&(s.count=0,document.title=s.originalTitle,s.changed=!1)}},g=n.DefaultMaxVisible=5,_=n.Queues={global:{maxVisible:g,queue:[]}},S=n.Store={};function queueRender(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global";if(_.hasOwnProperty(t)){var n=_[t].queue.shift();n&&n.show()}}function hasButtons(t){return!(!t.options.buttons||!Object.keys(t.options.buttons).length)}function queueClose(t){t.options.timeout&&(t.options.progressBar&&t.progressDom&&o.css(t.progressDom,{transition:"width "+t.options.timeout+"ms linear",width:"0%"}),clearTimeout(t.closeTimer),t.closeTimer=setTimeout((function(){t.close()}),t.options.timeout))}function dequeueClose(t){t.options.timeout&&t.closeTimer&&(clearTimeout(t.closeTimer),t.closeTimer=-1,t.options.progressBar&&t.progressDom&&o.css(t.progressDom,{transition:"width 0ms linear",width:"100%"}))}function fire(t,n){t.listeners.hasOwnProperty(n)&&t.listeners[n].forEach((function(n){"function"==typeof n&&n.apply(t)}))}n.Defaults={type:"alert",layout:"topRight",theme:"mint",text:"",timeout:!1,progressBar:!0,closeWith:["click"],animation:{open:"noty_effects_open",close:"noty_effects_close"},id:!1,force:!1,killer:!1,queue:"global",container:!1,buttons:[],callbacks:{beforeShow:null,onShow:null,afterShow:null,onClose:null,afterClose:null,onClick:null,onHover:null,onTemplate:null},sounds:{sources:[],volume:1,conditions:[]},titleCount:{conditions:[]},modal:!1,visibilityControl:!1}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NotyButton=void 0;var o=function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n.default=t,n}(i(0));function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}n.NotyButton=function NotyButton(t,n,i){var a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return _classCallCheck(this,NotyButton),this.dom=document.createElement("button"),this.dom.innerHTML=t,this.id=s.id=s.id||o.generateID("button"),this.cb=i,Object.keys(s).forEach((function(t){a.dom.setAttribute(t,s[t])})),o.addClass(this.dom,n||"noty_btn"),this}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,i){return n&&defineProperties(t.prototype,n),i&&defineProperties(t,i),t}}();function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}n.Push=function(){function Push(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/service-worker.js";return _classCallCheck(this,Push),this.subData={},this.workerPath=t,this.listeners={onPermissionGranted:[],onPermissionDenied:[],onSubscriptionSuccess:[],onSubscriptionCancel:[],onWorkerError:[],onWorkerSuccess:[],onWorkerNotSupported:[]},this}return o(Push,[{key:"on",value:function on(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return"function"==typeof n&&this.listeners.hasOwnProperty(t)&&this.listeners[t].push(n),this}},{key:"fire",value:function fire(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.listeners.hasOwnProperty(t)&&this.listeners[t].forEach((function(t){"function"==typeof t&&t.apply(n,i)}))}},{key:"create",value:function create(){console.log("NOT IMPLEMENTED YET")}},{key:"isSupported",value:function isSupported(){var t=!1;try{t=window.Notification||window.webkitNotifications||navigator.mozNotification||window.external&&void 0!==window.external.msIsSiteMode()}catch(t){}return t}},{key:"getPermissionStatus",value:function getPermissionStatus(){var t="default";if(window.Notification&&window.Notification.permissionLevel)t=window.Notification.permissionLevel;else if(window.webkitNotifications&&window.webkitNotifications.checkPermission)switch(window.webkitNotifications.checkPermission()){case 1:t="default";break;case 0:t="granted";break;default:t="denied"}else window.Notification&&window.Notification.permission?t=window.Notification.permission:navigator.mozNotification?t="granted":window.external&&void 0!==window.external.msIsSiteMode()&&(t=window.external.msIsSiteMode()?"granted":"default");return t.toString().toLowerCase()}},{key:"getEndpoint",value:function getEndpoint(t){var n=t.endpoint,i=t.subscriptionId;return i&&-1===n.indexOf(i)&&(n+="/"+i),n}},{key:"isSWRegistered",value:function isSWRegistered(){try{return"activated"===navigator.serviceWorker.controller.state}catch(t){return!1}}},{key:"unregisterWorker",value:function unregisterWorker(){var t=this;"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then((function(n){var i=!0,o=!1,a=void 0;try{for(var s,m=n[Symbol.iterator]();!(i=(s=m.next()).done);i=!0)s.value.unregister(),t.fire("onSubscriptionCancel")}catch(t){o=!0,a=t}finally{try{!i&&m.return&&m.return()}finally{if(o)throw a}}}))}},{key:"requestSubscription",value:function requestSubscription(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this,o=this.getPermissionStatus(),a=function cb(o){"granted"===o?(t.fire("onPermissionGranted"),"serviceWorker"in navigator?navigator.serviceWorker.register(t.workerPath).then((function(){navigator.serviceWorker.ready.then((function(t){i.fire("onWorkerSuccess"),t.pushManager.subscribe({userVisibleOnly:n}).then((function(t){var n=t.getKey("p256dh"),o=t.getKey("auth");i.subData={endpoint:i.getEndpoint(t),p256dh:n?window.btoa(String.fromCharCode.apply(null,new Uint8Array(n))):null,auth:o?window.btoa(String.fromCharCode.apply(null,new Uint8Array(o))):null},i.fire("onSubscriptionSuccess",[i.subData])})).catch((function(t){i.fire("onWorkerError",[t])}))}))})):i.fire("onWorkerNotSupported")):"denied"===o&&(t.fire("onPermissionDenied"),t.unregisterWorker())};"default"===o?window.Notification&&window.Notification.requestPermission?window.Notification.requestPermission(a):window.webkitNotifications&&window.webkitNotifications.checkPermission&&window.webkitNotifications.requestPermission(a):a(o)}}]),Push}()},function(t,n,i){(function(n,o){var a;a=function(){"use strict";function isFunction(t){return"function"==typeof t}var t=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},a=0,s=void 0,m=void 0,g=function asap(t,n){A[a]=t,A[a+1]=n,2===(a+=2)&&(m?m(flush):P())},_="undefined"!=typeof window?window:void 0,S=_||{},M=S.MutationObserver||S.WebKitMutationObserver,T="undefined"==typeof self&&void 0!==n&&"[object process]"==={}.toString.call(n),O="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function useSetTimeout(){var t=setTimeout;return function(){return t(flush,1)}}var A=new Array(1e3);function flush(){for(var t=0;t<a;t+=2)(0,A[t])(A[t+1]),A[t]=void 0,A[t+1]=void 0;a=0}var P=void 0;function then(t,n){var i=arguments,o=this,a=new this.constructor(noop);void 0===a[L]&&makePromise(a);var s,m=o._state;return m?(s=i[m-1],g((function(){return invokeCallback(m,a,s,o._result)}))):subscribe(o,a,t,n),a}function resolve$1(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var n=new this(noop);return resolve(n,t),n}P=T?function useNextTick(){return function(){return n.nextTick(flush)}}():M?function useMutationObserver(){var t=0,n=new M(flush),i=document.createTextNode("");return n.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():O?function useMessageChannel(){var t=new MessageChannel;return t.port1.onmessage=flush,function(){return t.port2.postMessage(0)}}():void 0===_?function attemptVertx(){try{var t=i(9);return s=t.runOnLoop||t.runOnContext,function useVertxTimer(){return void 0!==s?function(){s(flush)}:useSetTimeout()}()}catch(t){return useSetTimeout()}}():useSetTimeout();var L=Math.random().toString(36).substring(16);function noop(){}var R=new ErrorObject;function getThen(t){try{return t.then}catch(t){return R.error=t,R}}function handleMaybeThenable(t,n,i){n.constructor===t.constructor&&i===then&&n.constructor.resolve===resolve$1?function handleOwnThenable(t,n){1===n._state?fulfill(t,n._result):2===n._state?reject(t,n._result):subscribe(n,void 0,(function(n){return resolve(t,n)}),(function(n){return reject(t,n)}))}(t,n):i===R?(reject(t,R.error),R.error=null):void 0===i?fulfill(t,n):isFunction(i)?function handleForeignThenable(t,n,i){g((function(t){var o=!1,a=function tryThen(t,n,i,o){try{t.call(n,i,o)}catch(t){return t}}(i,n,(function(i){o||(o=!0,n!==i?resolve(t,i):fulfill(t,i))}),(function(n){o||(o=!0,reject(t,n))}),t._label);!o&&a&&(o=!0,reject(t,a))}),t)}(t,n,i):fulfill(t,n)}function resolve(t,n){t===n?reject(t,function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}()):function objectOrFunction(t){var n=typeof t;return null!==t&&("object"===n||"function"===n)}(n)?handleMaybeThenable(t,n,getThen(n)):fulfill(t,n)}function publishRejection(t){t._onerror&&t._onerror(t._result),publish(t)}function fulfill(t,n){void 0===t._state&&(t._result=n,t._state=1,0!==t._subscribers.length&&g(publish,t))}function reject(t,n){void 0===t._state&&(t._state=2,t._result=n,g(publishRejection,t))}function subscribe(t,n,i,o){var a=t._subscribers,s=a.length;t._onerror=null,a[s]=n,a[s+1]=i,a[s+2]=o,0===s&&t._state&&g(publish,t)}function publish(t){var n=t._subscribers,i=t._state;if(0!==n.length){for(var o=void 0,a=void 0,s=t._result,m=0;m<n.length;m+=3)o=n[m],a=n[m+i],o?invokeCallback(i,o,a,s):a(s);t._subscribers.length=0}}function ErrorObject(){this.error=null}var N=new ErrorObject;function invokeCallback(t,n,i,o){var a=isFunction(i),s=void 0,m=void 0,g=void 0,_=void 0;if(a){if((s=function tryCatch(t,n){try{return t(n)}catch(t){return N.error=t,N}}(i,o))===N?(_=!0,m=s.error,s.error=null):g=!0,n===s)return void reject(n,function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}())}else s=o,g=!0;void 0!==n._state||(a&&g?resolve(n,s):_?reject(n,m):1===t?fulfill(n,s):2===t&&reject(n,s))}var I=0;function makePromise(t){t[L]=I++,t._state=void 0,t._result=void 0,t._subscribers=[]}function Enumerator$1(n,i){this._instanceConstructor=n,this.promise=new n(noop),this.promise[L]||makePromise(this.promise),t(i)?(this.length=i.length,this._remaining=i.length,this._result=new Array(this.length),0===this.length?fulfill(this.promise,this._result):(this.length=this.length||0,this._enumerate(i),0===this._remaining&&fulfill(this.promise,this._result))):reject(this.promise,function validationError(){return new Error("Array Methods must be provided an Array")}())}function Promise$2(t){this[L]=function nextId(){return I++}(),this._result=this._state=void 0,this._subscribers=[],noop!==t&&("function"!=typeof t&&function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof Promise$2?function initializePromise(t,n){try{n((function resolvePromise(n){resolve(t,n)}),(function rejectPromise(n){reject(t,n)}))}catch(n){reject(t,n)}}(this,t):function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return Enumerator$1.prototype._enumerate=function(t){for(var n=0;void 0===this._state&&n<t.length;n++)this._eachEntry(t[n],n)},Enumerator$1.prototype._eachEntry=function(t,n){var i=this._instanceConstructor,o=i.resolve;if(o===resolve$1){var a=getThen(t);if(a===then&&void 0!==t._state)this._settledAt(t._state,n,t._result);else if("function"!=typeof a)this._remaining--,this._result[n]=t;else if(i===Promise$2){var s=new i(noop);handleMaybeThenable(s,t,a),this._willSettleAt(s,n)}else this._willSettleAt(new i((function(n){return n(t)})),n)}else this._willSettleAt(o(t),n)},Enumerator$1.prototype._settledAt=function(t,n,i){var o=this.promise;void 0===o._state&&(this._remaining--,2===t?reject(o,i):this._result[n]=i),0===this._remaining&&fulfill(o,this._result)},Enumerator$1.prototype._willSettleAt=function(t,n){var i=this;subscribe(t,void 0,(function(t){return i._settledAt(1,n,t)}),(function(t){return i._settledAt(2,n,t)}))},Promise$2.all=function all$1(t){return new Enumerator$1(this,t).promise},Promise$2.race=function race$1(n){var i=this;return t(n)?new i((function(t,o){for(var a=n.length,s=0;s<a;s++)i.resolve(n[s]).then(t,o)})):new i((function(t,n){return n(new TypeError("You must pass an array to race."))}))},Promise$2.resolve=resolve$1,Promise$2.reject=function reject$1(t){var n=new this(noop);return reject(n,t),n},Promise$2._setScheduler=function setScheduler(t){m=t},Promise$2._setAsap=function setAsap(t){g=t},Promise$2._asap=g,Promise$2.prototype={constructor:Promise$2,then,catch:function _catch(t){return this.then(null,t)}},Promise$2.polyfill=function polyfill$1(){var t=void 0;if(void 0!==o)t=o;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;if(n){var i=null;try{i=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===i&&!n.cast)return}t.Promise=Promise$2},Promise$2.Promise=Promise$2,Promise$2},t.exports=a()}).call(n,i(7),i(8))},function(t,n){},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,i){return n&&defineProperties(t.prototype,n),i&&defineProperties(t,i),t}}();i(5);var a=function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}(i(4)),s=_interopRequireWildcard(i(0)),m=_interopRequireWildcard(i(1)),g=i(2),_=i(3);function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n.default=t,n}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var S=function(){function Noty(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,Noty),this.options=s.deepExtend({},m.Defaults,t),m.Store[this.options.id]?m.Store[this.options.id]:(this.id=this.options.id||s.generateID("bar"),this.closeTimer=-1,this.barDom=null,this.layoutDom=null,this.progressDom=null,this.showing=!1,this.shown=!1,this.closed=!1,this.closing=!1,this.killable=this.options.timeout||this.options.closeWith.length>0,this.hasSound=this.options.sounds.sources.length>0,this.soundPlayed=!1,this.listeners={beforeShow:[],onShow:[],afterShow:[],onClose:[],afterClose:[],onClick:[],onHover:[],onTemplate:[]},this.promises={show:null,close:null},this.on("beforeShow",this.options.callbacks.beforeShow),this.on("onShow",this.options.callbacks.onShow),this.on("afterShow",this.options.callbacks.afterShow),this.on("onClose",this.options.callbacks.onClose),this.on("afterClose",this.options.callbacks.afterClose),this.on("onClick",this.options.callbacks.onClick),this.on("onHover",this.options.callbacks.onHover),this.on("onTemplate",this.options.callbacks.onTemplate),this)}return o(Noty,[{key:"on",value:function on(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return"function"==typeof n&&this.listeners.hasOwnProperty(t)&&this.listeners[t].push(n),this}},{key:"show",value:function show(){var t=this;if(this.showing||this.shown)return this;!0===this.options.killer?Noty.closeAll():"string"==typeof this.options.killer&&Noty.closeAll(this.options.killer);var n=m.getQueueCounts(this.options.queue);if(n.current>=n.maxVisible||m.PageHidden&&this.options.visibilityControl)return m.addToQueue(this),m.PageHidden&&this.hasSound&&s.inArray("docHidden",this.options.sounds.conditions)&&s.createAudioElements(this),m.PageHidden&&s.inArray("docHidden",this.options.titleCount.conditions)&&m.docTitle.increment(),this;if(m.Store[this.id]=this,m.fire(this,"beforeShow"),this.showing=!0,this.closing)return this.showing=!1,this;if(m.build(this),m.handleModal(this),this.options.force?this.layoutDom.insertBefore(this.barDom,this.layoutDom.firstChild):this.layoutDom.appendChild(this.barDom),this.hasSound&&!this.soundPlayed&&s.inArray("docVisible",this.options.sounds.conditions)&&s.createAudioElements(this),s.inArray("docVisible",this.options.titleCount.conditions)&&m.docTitle.increment(),this.shown=!0,this.closed=!1,m.hasButtons(this)&&Object.keys(this.options.buttons).forEach((function(n){var i=t.barDom.querySelector("#"+t.options.buttons[n].id);s.addListener(i,"click",(function(i){s.stopPropagation(i),t.options.buttons[n].cb(t)}))})),this.progressDom=this.barDom.querySelector(".noty_progressbar"),s.inArray("click",this.options.closeWith)&&(s.addClass(this.barDom,"noty_close_with_click"),s.addListener(this.barDom,"click",(function(n){s.stopPropagation(n),m.fire(t,"onClick"),t.close()}),!1)),s.addListener(this.barDom,"mouseenter",(function(){m.fire(t,"onHover")}),!1),this.options.timeout&&s.addClass(this.barDom,"noty_has_timeout"),this.options.progressBar&&s.addClass(this.barDom,"noty_has_progressbar"),s.inArray("button",this.options.closeWith)){s.addClass(this.barDom,"noty_close_with_button");var i=document.createElement("div");s.addClass(i,"noty_close_button"),i.innerHTML="×",this.barDom.appendChild(i),s.addListener(i,"click",(function(n){s.stopPropagation(n),t.close()}),!1)}return m.fire(this,"onShow"),null===this.options.animation.open?this.promises.show=new a.default((function(t){t()})):"function"==typeof this.options.animation.open?this.promises.show=new a.default(this.options.animation.open.bind(this)):(s.addClass(this.barDom,this.options.animation.open),this.promises.show=new a.default((function(n){s.addListener(t.barDom,s.animationEndEvents,(function(){s.removeClass(t.barDom,t.options.animation.open),n()}))}))),this.promises.show.then((function(){var n=t;setTimeout((function(){m.openFlow(n)}),100)})),this}},{key:"stop",value:function stop(){return m.dequeueClose(this),this}},{key:"resume",value:function resume(){return m.queueClose(this),this}},{key:"setTimeout",value:function(t){function setTimeout(n){return t.apply(this,arguments)}return setTimeout.toString=function(){return t.toString()},setTimeout}((function(t){if(this.stop(),this.options.timeout=t,this.barDom){this.options.timeout?s.addClass(this.barDom,"noty_has_timeout"):s.removeClass(this.barDom,"noty_has_timeout");var n=this;setTimeout((function(){n.resume()}),100)}return this}))},{key:"setText",value:function setText(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.barDom&&(this.barDom.querySelector(".noty_body").innerHTML=t),n&&(this.options.text=t),this}},{key:"setType",value:function setType(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.barDom){var o=s.classList(this.barDom).split(" ");o.forEach((function(t){"noty_type__"===t.substring(0,11)&&s.removeClass(n.barDom,t)})),s.addClass(this.barDom,"noty_type__"+t)}return i&&(this.options.type=t),this}},{key:"setTheme",value:function setTheme(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.barDom){var o=s.classList(this.barDom).split(" ");o.forEach((function(t){"noty_theme__"===t.substring(0,12)&&s.removeClass(n.barDom,t)})),s.addClass(this.barDom,"noty_theme__"+t)}return i&&(this.options.theme=t),this}},{key:"close",value:function close(){var t=this;return this.closed?this:this.shown?(m.fire(this,"onClose"),this.closing=!0,null===this.options.animation.close||!1===this.options.animation.close?this.promises.close=new a.default((function(t){t()})):"function"==typeof this.options.animation.close?this.promises.close=new a.default(this.options.animation.close.bind(this)):(s.addClass(this.barDom,this.options.animation.close),this.promises.close=new a.default((function(n){s.addListener(t.barDom,s.animationEndEvents,(function(){t.options.force?s.remove(t.barDom):m.ghostFix(t),n()}))}))),this.promises.close.then((function(){m.closeFlow(t),m.handleModalClose(t)})),this.closed=!0,this):(m.removeFromQueue(this),this)}}],[{key:"closeAll",value:function closeAll(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object.keys(m.Store).forEach((function(n){t?m.Store[n].options.queue===t&&m.Store[n].killable&&m.Store[n].close():m.Store[n].killable&&m.Store[n].close()})),this}},{key:"clearQueue",value:function clearQueue(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global";return m.Queues.hasOwnProperty(t)&&(m.Queues[t].queue=[]),this}},{key:"overrideDefaults",value:function overrideDefaults(t){return m.Defaults=s.deepExtend({},m.Defaults,t),this}},{key:"setMaxVisible",value:function setMaxVisible(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.DefaultMaxVisible,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"global";return m.Queues.hasOwnProperty(n)||(m.Queues[n]={maxVisible:t,queue:[]}),m.Queues[n].maxVisible=t,this}},{key:"button",value:function button(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new g.NotyButton(t,n,i,o)}},{key:"version",value:function version(){return"3.2.0-beta"}},{key:"Push",value:function Push(t){return new _.Push(t)}},{key:"Queues",get:function get(){return m.Queues}},{key:"PageHidden",get:function get(){return m.PageHidden}}]),Noty}();n.default=S,"undefined"!=typeof window&&s.visibilityChangeFlow(),t.exports=n.default},function(t,n){var i,o,a=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(i===setTimeout)return setTimeout(t,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(n){try{return i.call(null,t,0)}catch(n){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){i=defaultSetTimout}try{o="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){o=defaultClearTimeout}}();var s,m=[],g=!1,_=-1;function cleanUpNextTick(){g&&s&&(g=!1,s.length?m=s.concat(m):_=-1,m.length&&drainQueue())}function drainQueue(){if(!g){var t=runTimeout(cleanUpNextTick);g=!0;for(var n=m.length;n;){for(s=m,m=[];++_<n;)s&&s[_].run();_=-1,n=m.length}s=null,g=!1,function runClearTimeout(t){if(o===clearTimeout)return clearTimeout(t);if((o===defaultClearTimeout||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(n){try{return o.call(null,t)}catch(n){return o.call(this,t)}}}(t)}}function Item(t,n){this.fun=t,this.array=n}function noop(){}a.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)n[i-1]=arguments[i];m.push(new Item(t,n)),1!==m.length||g||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=noop,a.addListener=noop,a.once=noop,a.off=noop,a.removeListener=noop,a.removeAllListeners=noop,a.emit=noop,a.prependListener=noop,a.prependOnceListener=noop,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,n){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,n){}])}))},function(t,n){t.exports='<div>\n    <div style="text-align: center"><b>$$title</b></div>\n    <br>\n    <div>$$msg</div>\n</div>'},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GifLoader=void 0;var o=i(0),a=i(258),s=i(451),m=function(){function GifLoader(t){this.manager=t}return GifLoader.prototype.load=function(t,n,i,m){var g=new a.GifTexture,_=new o.FileLoader(this.manager);return _.setPath(this.path),_.setResponseType("arraybuffer"),_.setPath(this.path),_.load(t,(function(t){var i=new Uint8Array(t),o=new s.GifReader(i);g.setReader(o),n&&n(g,o)}),i,m),g},GifLoader.prototype.setPath=function(t){return this.path=t,this},GifLoader}();n.GifLoader=m},function(t,i){t.exports=n},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.OrbitControls=void 0;var s=function(t){function OrbitControls(n,i,o){return o||i.addEventListener("contextmenu",onContextMenu,!0),t.call(this,n,i)||this}return a(OrbitControls,t),OrbitControls.prototype.dispose=function(){t.prototype.dispose.call(this),this.domElement.removeEventListener("contextmenu",onContextMenu,!1)},OrbitControls}(i(453).OrbitControls);function onContextMenu(t){t.stopImmediatePropagation()}n.OrbitControls=s},function(t,n,i){"use strict";i.r(n),i.d(n,"OrbitControls",(function(){return OrbitControls})),i.d(n,"MapControls",(function(){return MapControls}));var o=i(0),OrbitControls=function(t,n){var i,a,s,m,g,_;void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=n,this.enabled=!0,this.target=new o.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:o.MOUSE.ROTATE,MIDDLE:o.MOUSE.DOLLY,RIGHT:o.MOUSE.PAN},this.touches={ONE:o.TOUCH.ROTATE,TWO:o.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return R.phi},this.getAzimuthalAngle=function(){return R.theta},this.saveState=function(){S.target0.copy(S.target),S.position0.copy(S.object.position),S.zoom0=S.object.zoom},this.reset=function(){S.target.copy(S.target0),S.object.position.copy(S.position0),S.object.zoom=S.zoom0,S.object.updateProjectionMatrix(),S.dispatchEvent(M),S.update(),P=A.NONE},this.update=(i=new o.Vector3,a=(new o.Quaternion).setFromUnitVectors(t.up,new o.Vector3(0,1,0)),s=a.clone().invert(),m=new o.Vector3,g=new o.Quaternion,_=2*Math.PI,function update(){var t=S.object.position;i.copy(t).sub(S.target),i.applyQuaternion(a),R.setFromVector3(i),S.autoRotate&&P===A.NONE&&rotateLeft(function getAutoRotationAngle(){return 2*Math.PI/60/60*S.autoRotateSpeed}()),S.enableDamping?(R.theta+=N.theta*S.dampingFactor,R.phi+=N.phi*S.dampingFactor):(R.theta+=N.theta,R.phi+=N.phi);var n=S.minAzimuthAngle,o=S.maxAzimuthAngle;return isFinite(n)&&isFinite(o)&&(n<-Math.PI?n+=_:n>Math.PI&&(n-=_),o<-Math.PI?o+=_:o>Math.PI&&(o-=_),R.theta=n<=o?Math.max(n,Math.min(o,R.theta)):R.theta>(n+o)/2?Math.max(n,R.theta):Math.min(o,R.theta)),R.phi=Math.max(S.minPolarAngle,Math.min(S.maxPolarAngle,R.phi)),R.makeSafe(),R.radius*=I,R.radius=Math.max(S.minDistance,Math.min(S.maxDistance,R.radius)),!0===S.enableDamping?S.target.addScaledVector(j,S.dampingFactor):S.target.add(j),i.setFromSpherical(R),i.applyQuaternion(s),t.copy(S.target).add(i),S.object.lookAt(S.target),!0===S.enableDamping?(N.theta*=1-S.dampingFactor,N.phi*=1-S.dampingFactor,j.multiplyScalar(1-S.dampingFactor)):(N.set(0,0,0),j.set(0,0,0)),I=1,!!(V||m.distanceToSquared(S.object.position)>L||8*(1-g.dot(S.object.quaternion))>L)&&(S.dispatchEvent(M),m.copy(S.object.position),g.copy(S.object.quaternion),V=!1,!0)}),this.dispose=function(){S.domElement.removeEventListener("contextmenu",onContextMenu,!1),S.domElement.removeEventListener("pointerdown",onPointerDown,!1),S.domElement.removeEventListener("wheel",onMouseWheel,!1),S.domElement.removeEventListener("touchstart",onTouchStart,!1),S.domElement.removeEventListener("touchend",onTouchEnd,!1),S.domElement.removeEventListener("touchmove",onTouchMove,!1),S.domElement.ownerDocument.removeEventListener("pointermove",onPointerMove,!1),S.domElement.ownerDocument.removeEventListener("pointerup",onPointerUp,!1),S.domElement.removeEventListener("keydown",onKeyDown,!1)};var S=this,M={type:"change"},T={type:"start"},O={type:"end"},A={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},P=A.NONE,L=1e-6,R=new o.Spherical,N=new o.Spherical,I=1,j=new o.Vector3,V=!1,U=new o.Vector2,G=new o.Vector2,z=new o.Vector2,H=new o.Vector2,q=new o.Vector2,Z=new o.Vector2,X=new o.Vector2,Q=new o.Vector2,Y=new o.Vector2;function getZoomScale(){return Math.pow(.95,S.zoomSpeed)}function rotateLeft(t){N.theta-=t}function rotateUp(t){N.phi-=t}var J,K=(J=new o.Vector3,function panLeft(t,n){J.setFromMatrixColumn(n,0),J.multiplyScalar(-t),j.add(J)}),$=function(){var t=new o.Vector3;return function panUp(n,i){!0===S.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(S.object.up,t)),t.multiplyScalar(n),j.add(t)}}(),ee=function(){var t=new o.Vector3;return function pan(n,i){var o=S.domElement;if(S.object.isPerspectiveCamera){var a=S.object.position;t.copy(a).sub(S.target);var s=t.length();s*=Math.tan(S.object.fov/2*Math.PI/180),K(2*n*s/o.clientHeight,S.object.matrix),$(2*i*s/o.clientHeight,S.object.matrix)}else S.object.isOrthographicCamera?(K(n*(S.object.right-S.object.left)/S.object.zoom/o.clientWidth,S.object.matrix),$(i*(S.object.top-S.object.bottom)/S.object.zoom/o.clientHeight,S.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),S.enablePan=!1)}}();function dollyOut(t){S.object.isPerspectiveCamera?I/=t:S.object.isOrthographicCamera?(S.object.zoom=Math.max(S.minZoom,Math.min(S.maxZoom,S.object.zoom*t)),S.object.updateProjectionMatrix(),V=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),S.enableZoom=!1)}function dollyIn(t){S.object.isPerspectiveCamera?I*=t:S.object.isOrthographicCamera?(S.object.zoom=Math.max(S.minZoom,Math.min(S.maxZoom,S.object.zoom/t)),S.object.updateProjectionMatrix(),V=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),S.enableZoom=!1)}function handleMouseDownRotate(t){U.set(t.clientX,t.clientY)}function handleMouseDownPan(t){H.set(t.clientX,t.clientY)}function handleTouchStartRotate(t){if(1==t.touches.length)U.set(t.touches[0].pageX,t.touches[0].pageY);else{var n=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);U.set(n,i)}}function handleTouchStartPan(t){if(1==t.touches.length)H.set(t.touches[0].pageX,t.touches[0].pageY);else{var n=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);H.set(n,i)}}function handleTouchStartDolly(t){var n=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,o=Math.sqrt(n*n+i*i);X.set(0,o)}function handleTouchMoveRotate(t){if(1==t.touches.length)G.set(t.touches[0].pageX,t.touches[0].pageY);else{var n=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);G.set(n,i)}z.subVectors(G,U).multiplyScalar(S.rotateSpeed);var o=S.domElement;rotateLeft(2*Math.PI*z.x/o.clientHeight),rotateUp(2*Math.PI*z.y/o.clientHeight),U.copy(G)}function handleTouchMovePan(t){if(1==t.touches.length)q.set(t.touches[0].pageX,t.touches[0].pageY);else{var n=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);q.set(n,i)}Z.subVectors(q,H).multiplyScalar(S.panSpeed),ee(Z.x,Z.y),H.copy(q)}function handleTouchMoveDolly(t){var n=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,o=Math.sqrt(n*n+i*i);Q.set(0,o),Y.set(0,Math.pow(Q.y/X.y,S.zoomSpeed)),dollyOut(Y.y),X.copy(Q)}function onPointerDown(t){if(!1!==S.enabled)switch(t.pointerType){case"mouse":case"pen":!function onMouseDown(t){var n;switch(t.preventDefault(),S.domElement.focus?S.domElement.focus():window.focus(),t.button){case 0:n=S.mouseButtons.LEFT;break;case 1:n=S.mouseButtons.MIDDLE;break;case 2:n=S.mouseButtons.RIGHT;break;default:n=-1}switch(n){case o.MOUSE.DOLLY:if(!1===S.enableZoom)return;!function handleMouseDownDolly(t){X.set(t.clientX,t.clientY)}(t),P=A.DOLLY;break;case o.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===S.enablePan)return;handleMouseDownPan(t),P=A.PAN}else{if(!1===S.enableRotate)return;handleMouseDownRotate(t),P=A.ROTATE}break;case o.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===S.enableRotate)return;handleMouseDownRotate(t),P=A.ROTATE}else{if(!1===S.enablePan)return;handleMouseDownPan(t),P=A.PAN}break;default:P=A.NONE}P!==A.NONE&&(S.domElement.ownerDocument.addEventListener("pointermove",onPointerMove,!1),S.domElement.ownerDocument.addEventListener("pointerup",onPointerUp,!1),S.dispatchEvent(T))}(t)}}function onPointerMove(t){if(!1!==S.enabled)switch(t.pointerType){case"mouse":case"pen":!function onMouseMove(t){if(!1!==S.enabled)switch(t.preventDefault(),P){case A.ROTATE:if(!1===S.enableRotate)return;!function handleMouseMoveRotate(t){G.set(t.clientX,t.clientY),z.subVectors(G,U).multiplyScalar(S.rotateSpeed);var n=S.domElement;rotateLeft(2*Math.PI*z.x/n.clientHeight),rotateUp(2*Math.PI*z.y/n.clientHeight),U.copy(G),S.update()}(t);break;case A.DOLLY:if(!1===S.enableZoom)return;!function handleMouseMoveDolly(t){Q.set(t.clientX,t.clientY),Y.subVectors(Q,X),Y.y>0?dollyOut(getZoomScale()):Y.y<0&&dollyIn(getZoomScale()),X.copy(Q),S.update()}(t);break;case A.PAN:if(!1===S.enablePan)return;!function handleMouseMovePan(t){q.set(t.clientX,t.clientY),Z.subVectors(q,H).multiplyScalar(S.panSpeed),ee(Z.x,Z.y),H.copy(q),S.update()}(t)}}(t)}}function onPointerUp(t){switch(t.pointerType){case"mouse":case"pen":!function onMouseUp(t){S.domElement.ownerDocument.removeEventListener("pointermove",onPointerMove,!1),S.domElement.ownerDocument.removeEventListener("pointerup",onPointerUp,!1),!1!==S.enabled&&(S.dispatchEvent(O),P=A.NONE)}()}}function onMouseWheel(t){!1===S.enabled||!1===S.enableZoom||P!==A.NONE&&P!==A.ROTATE||(t.preventDefault(),t.stopPropagation(),S.dispatchEvent(T),function handleMouseWheel(t){t.deltaY<0?dollyIn(getZoomScale()):t.deltaY>0&&dollyOut(getZoomScale()),S.update()}(t),S.dispatchEvent(O))}function onKeyDown(t){!1!==S.enabled&&!1!==S.enableKeys&&!1!==S.enablePan&&function handleKeyDown(t){var n=!1;switch(t.keyCode){case S.keys.UP:ee(0,S.keyPanSpeed),n=!0;break;case S.keys.BOTTOM:ee(0,-S.keyPanSpeed),n=!0;break;case S.keys.LEFT:ee(S.keyPanSpeed,0),n=!0;break;case S.keys.RIGHT:ee(-S.keyPanSpeed,0),n=!0}n&&(t.preventDefault(),S.update())}(t)}function onTouchStart(t){if(!1!==S.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(S.touches.ONE){case o.TOUCH.ROTATE:if(!1===S.enableRotate)return;handleTouchStartRotate(t),P=A.TOUCH_ROTATE;break;case o.TOUCH.PAN:if(!1===S.enablePan)return;handleTouchStartPan(t),P=A.TOUCH_PAN;break;default:P=A.NONE}break;case 2:switch(S.touches.TWO){case o.TOUCH.DOLLY_PAN:if(!1===S.enableZoom&&!1===S.enablePan)return;!function handleTouchStartDollyPan(t){S.enableZoom&&handleTouchStartDolly(t),S.enablePan&&handleTouchStartPan(t)}(t),P=A.TOUCH_DOLLY_PAN;break;case o.TOUCH.DOLLY_ROTATE:if(!1===S.enableZoom&&!1===S.enableRotate)return;!function handleTouchStartDollyRotate(t){S.enableZoom&&handleTouchStartDolly(t),S.enableRotate&&handleTouchStartRotate(t)}(t),P=A.TOUCH_DOLLY_ROTATE;break;default:P=A.NONE}break;default:P=A.NONE}P!==A.NONE&&S.dispatchEvent(T)}}function onTouchMove(t){if(!1!==S.enabled)switch(t.preventDefault(),t.stopPropagation(),P){case A.TOUCH_ROTATE:if(!1===S.enableRotate)return;handleTouchMoveRotate(t),S.update();break;case A.TOUCH_PAN:if(!1===S.enablePan)return;handleTouchMovePan(t),S.update();break;case A.TOUCH_DOLLY_PAN:if(!1===S.enableZoom&&!1===S.enablePan)return;!function handleTouchMoveDollyPan(t){S.enableZoom&&handleTouchMoveDolly(t),S.enablePan&&handleTouchMovePan(t)}(t),S.update();break;case A.TOUCH_DOLLY_ROTATE:if(!1===S.enableZoom&&!1===S.enableRotate)return;!function handleTouchMoveDollyRotate(t){S.enableZoom&&handleTouchMoveDolly(t),S.enableRotate&&handleTouchMoveRotate(t)}(t),S.update();break;default:P=A.NONE}}function onTouchEnd(t){!1!==S.enabled&&(S.dispatchEvent(O),P=A.NONE)}function onContextMenu(t){!1!==S.enabled&&t.preventDefault()}S.domElement.addEventListener("contextmenu",onContextMenu,!1),S.domElement.addEventListener("pointerdown",onPointerDown,!1),S.domElement.addEventListener("wheel",onMouseWheel,!1),S.domElement.addEventListener("touchstart",onTouchStart,!1),S.domElement.addEventListener("touchend",onTouchEnd,!1),S.domElement.addEventListener("touchmove",onTouchMove,!1),S.domElement.addEventListener("keydown",onKeyDown,!1),this.update()};OrbitControls.prototype=Object.create(o.EventDispatcher.prototype),OrbitControls.prototype.constructor=OrbitControls;var MapControls=function(t,n){OrbitControls.call(this,t,n),this.screenSpacePanning=!1,this.mouseButtons.LEFT=o.MOUSE.PAN,this.mouseButtons.RIGHT=o.MOUSE.ROTATE,this.touches.ONE=o.TOUCH.PAN,this.touches.TWO=o.TOUCH.DOLLY_ROTATE};MapControls.prototype=Object.create(o.EventDispatcher.prototype),MapControls.prototype.constructor=MapControls},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GoogleAnalytics=void 0;var o=i(18),a=i(73),s=i(10),m=function(){function GoogleAnalytics(t){this.appManager=t}return GoogleAnalytics.prototype.config=function(t){if(t){this.id=t;var n="https://www.googletagmanager.com/gtag/js?id="+t;a.JsUtils.injectJsFile(n),window.dataLayer=window.dataLayer||[],this.gtag=function(){window.dataLayer.push(arguments)},this.gtag("js",new Date),this.addListeners()}},GoogleAnalytics.prototype.addListeners=function(){var t=this;this.appManager.eventManager.pipe(o.filter((function(t){return t.eventType.name===(new s.ZoneChangeEndedEvent).name||t.eventType===s.ZoneChangeEndedEvent}))).subscribe((function(n){var i=n.message.to;t.SendPageView(t.appManager,i)})),this.appManager.eventManager.pipe(o.filter((function(t){return t.eventType.name===(new s.AnalyticsSendActionEvent).name||t.eventType===s.AnalyticsSendActionEvent}))).subscribe((function(n){var i=n.message.action,o=n.message.label,a=n.message.category,s=n.message.gtag;t.SendCustomAction(i,o,a,s)}))},GoogleAnalytics.prototype.SendPageView=function(t,n){if(!window.disable_analytics&&this.id){var i=t.currentExperience.getMetadata().hash;this.gtag("config",this.id,{page_path:i+"/"+n}),this.gtag("event","page_view",{send_to:this.id}),this.gtag("config","UA-128174406-4",{page_path:i+"/"+n})}},GoogleAnalytics.prototype.SendCustomAction=function(t,n,i,o){if(!window.disable_analytics&&o){var a={event_category:i,event_label:n};console.log(a,t,o),this.gtag("config",o),this.gtag("event",t,a)}},GoogleAnalytics}();n.GoogleAnalytics=m},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.vertexShader=n.fragmentShader=n.ScreenShot=void 0;var o=i(213);Object.defineProperty(n,"ScreenShot",{enumerable:!0,get:function(){return o.ScreenShot}});var a=i(214);Object.defineProperty(n,"fragmentShader",{enumerable:!0,get:function(){return a.fragmentShader}}),Object.defineProperty(n,"vertexShader",{enumerable:!0,get:function(){return a.vertexShader}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.InstagremConnector=void 0;var o=i(263);Object.defineProperty(n,"InstagremConnector",{enumerable:!0,get:function(){return o.InstagremConnector}})},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Video=void 0;var s=i(0),m=i(187),g=i(17),_=i(188),S=i(50),M=i(147),T=function(){function Video(t){this.State=M.VideoStatus.Unloaded,this._OnStateChanged=new m.EventDispatcher,this._OnTimeUpdate=new m.EventDispatcher,this.videoOptions=t}return Video.prototype.Load=function(t){return g.Utils.isVideo(this.videoOptions.url)?this.LoadVideo(t):void 0},Video.prototype.getWidth=function(){return this.Video.videoWidth},Video.prototype.getHeight=function(){return this.Video.videoHeight},Video.prototype.LoadVideo=function(t){return o(this,void 0,void 0,(function(){function _onPlay(){this.setState(M.VideoStatus.Playing)}function _onPause(){this.setState(M.VideoStatus.Paused)}function _onEnded(){this.setState(M.VideoStatus.Ended)}function _canPlay(){this.setState(M.VideoStatus.Ready)}function _timeUpdate(){this.Video&&this._OnTimeUpdate.dispatch(this,this.Video.currentTime)}var t,n,o,m,T,O,A,P,L,R,N,I;return a(this,(function(a){switch(a.label){case 0:return t=this,this.setState(M.VideoStatus.Loading),n=document.createElement("video"),[4,Promise.resolve().then((function(){return i(466)}))];case 1:if((o=a.sent()).isSupported()&&g.Utils.isHLS(t.videoOptions.url)&&!n.canPlayType("application/vnd.apple.mpegurl")?((m=new o).loadSource(t.videoOptions.url),m.attachMedia(n)):n.src=t.videoOptions.url,n.crossOrigin="Anonymous",(T=document.createAttribute("crossOrigin")).value="anonymous",n.setAttributeNode(T),n.muted=t.videoOptions.muted||!1,t.videoOptions.muted&&((O=document.createAttribute("muted")).value="true",n.setAttributeNode(O)),n.preload=t.videoOptions.preload?"true":"none",t.videoOptions.preload&&((A=document.createAttribute("preload")).value="true",n.setAttributeNode(A)),n.loop=t.videoOptions.loop||!1,t.videoOptions.loop&&((P=document.createAttribute("loop")).value="true",n.setAttributeNode(P)),n.autoplay=t.videoOptions.autoplay||!1,t.videoOptions.autoplay&&((L=document.createAttribute("playsinline")).value="true",n.setAttributeNode(L),(R=document.createAttribute("webkit-playsinline")).value="true",n.setAttributeNode(R),(N=document.createAttribute("autoplay")).value="true",n.setAttributeNode(N)),n.addEventListener("play",_onPlay.bind(this)),n.addEventListener("pause",_onPause.bind(this)),n.addEventListener("ended",_onEnded.bind(this)),n.addEventListener("canplay",_canPlay.bind(this)),n.addEventListener("timeupdate",_timeUpdate.bind(this)),t.Video=n,(I=new s.VideoTexture(n)).minFilter=this.videoOptions.minFilter||s.LinearFilter,this.videoOptions.magFilter&&(I.magFilter=this.videoOptions.magFilter),I.format=s.RGBFormat,t.Texture=I,_.MediaUtils.getAssetsElement().appendChild(n),this.videoOptions.autoplay)try{n.load(),n.play().catch((function(t){}))}catch(t){S.Log.Error(t)}return[2,I]}}))}))},Object.defineProperty(Video.prototype,"OnTimeUpdate",{get:function(){return this._OnTimeUpdate.asEvent()},enumerable:!1,configurable:!0}),Object.defineProperty(Video.prototype,"OnStateChanged",{get:function(){return this._OnStateChanged.asEvent()},enumerable:!1,configurable:!0}),Video.prototype.setState=function(t){this.State!==t&&(this.State=t,this._OnStateChanged.dispatch(this,t))},Video.prototype.CurrentTime=function(){return this.Video.currentTime},Object.defineProperty(Video.prototype,"volume",{get:function(){return this.Video.volume},set:function(t){this.Video.volume=t},enumerable:!1,configurable:!0}),Object.defineProperty(Video.prototype,"Duration",{get:function(){return this.Video.duration},enumerable:!1,configurable:!0}),Video.prototype.Seek=function(t){this.Video.currentTime=t},Object.defineProperty(Video.prototype,"IsPlaying",{get:function(){return!!(this.Video&&this.Video.currentTime>0&&!this.Video.paused&&!this.Video.ended&&this.Video.readyState>2)},enumerable:!1,configurable:!0}),Video.prototype.Play=function(){this.Video.play().catch((function(t){}))},Video.prototype.Pause=function(){this.Video.pause()},Video.prototype.Stop=function(){this.Seek(0),this.Video.pause()},Object.defineProperty(Video.prototype,"IsMuted",{get:function(){return this.Video.muted},enumerable:!1,configurable:!0}),Video.prototype.Mute=function(){this.muteVol=this.volume,this.Video.muted=!0},Video.prototype.Unmute=function(){this.Video.muted=!1,this.muteVol&&(this.volume=this.muteVol)},Video.prototype.Dispose=function(){if(this.setState(M.VideoStatus.Unloaded),this.Video){this.Video.pause();try{this.Video.src=""}catch(t){}this.Video.remove(),this.Video=void 0}this.Texture&&(this.Texture.dispose(),this.Texture=void 0),this._OnStateChanged.clear()},Video}();n.Video=T},function(t,n,i){"use strict";var o=this&&this.__spreadArrays||function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;var o=Array(t),a=0;for(n=0;n<i;n++)for(var s=arguments[n],m=0,g=s.length;m<g;m++,a++)o[a]=s[m];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.DispatcherWrapper=n.EventListBase=n.DispatcherBase=void 0;var a=i(459),s=i(264),m=function(){function DispatcherBase(){this._wrap=new _(this),this._subscriptions=new Array}return Object.defineProperty(DispatcherBase.prototype,"count",{get:function(){return this._subscriptions.length},enumerable:!1,configurable:!0}),DispatcherBase.prototype.subscribe=function(t){var n=this;return t&&this._subscriptions.push(new s.Subscription(t,!1)),function(){n.unsubscribe(t)}},DispatcherBase.prototype.sub=function(t){return this.subscribe(t)},DispatcherBase.prototype.one=function(t){var n=this;return t&&this._subscriptions.push(new s.Subscription(t,!0)),function(){n.unsubscribe(t)}},DispatcherBase.prototype.has=function(t){return!!t&&this._subscriptions.some((function(n){return n.handler==t}))},DispatcherBase.prototype.unsubscribe=function(t){if(t)for(var n=0;n<this._subscriptions.length;n++)if(this._subscriptions[n].handler==t){this._subscriptions.splice(n,1);break}},DispatcherBase.prototype.unsub=function(t){this.unsubscribe(t)},DispatcherBase.prototype._dispatch=function(t,n,i){for(var s=this,_loop_1=function(o){var g=new a.EventManagement((function(){return s.unsub(o.handler)})),_=Array.prototype.slice.call(i);if(_.push(g),o.execute(t,n,_),m.cleanup(o),!t&&g.propagationStopped)return"break"},m=this,g=0,_=o(this._subscriptions);g<_.length&&"break"!==_loop_1(_[g]);g++);},DispatcherBase.prototype.cleanup=function(t){if(t.isOnce&&t.isExecuted){var n=this._subscriptions.indexOf(t);n>-1&&this._subscriptions.splice(n,1)}},DispatcherBase.prototype.asEvent=function(){return this._wrap},DispatcherBase.prototype.clear=function(){this._subscriptions.splice(0,this._subscriptions.length)},DispatcherBase}();n.DispatcherBase=m;var g=function(){function EventListBase(){this._events={}}return EventListBase.prototype.get=function(t){var n=this._events[t];return n||(n=this.createDispatcher(),this._events[t]=n,n)},EventListBase.prototype.remove=function(t){delete this._events[t]},EventListBase}();n.EventListBase=g;var _=function(){function DispatcherWrapper(t){this._subscribe=function(n){return t.subscribe(n)},this._unsubscribe=function(n){return t.unsubscribe(n)},this._one=function(n){return t.one(n)},this._has=function(n){return t.has(n)},this._clear=function(){return t.clear()},this._count=function(){return t.count}}return Object.defineProperty(DispatcherWrapper.prototype,"count",{get:function(){return this._count()},enumerable:!1,configurable:!0}),DispatcherWrapper.prototype.subscribe=function(t){return this._subscribe(t)},DispatcherWrapper.prototype.sub=function(t){return this.subscribe(t)},DispatcherWrapper.prototype.unsubscribe=function(t){this._unsubscribe(t)},DispatcherWrapper.prototype.unsub=function(t){this.unsubscribe(t)},DispatcherWrapper.prototype.one=function(t){return this._one(t)},DispatcherWrapper.prototype.has=function(t){return this._has(t)},DispatcherWrapper.prototype.clear=function(){this._clear()},DispatcherWrapper}();n.DispatcherWrapper=_},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventManagement=void 0;var o=function(){function EventManagement(t){this.unsub=t,this.propagationStopped=!1}return EventManagement.prototype.stopPropagation=function(){this.propagationStopped=!0},EventManagement}();n.EventManagement=o},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NonUniformEventList=n.EventList=n.EventHandlingBase=n.EventDispatcher=void 0;var o=i(461);Object.defineProperty(n,"EventDispatcher",{enumerable:!0,get:function(){return o.EventDispatcher}}),Object.defineProperty(n,"EventHandlingBase",{enumerable:!0,get:function(){return o.EventHandlingBase}}),Object.defineProperty(n,"EventList",{enumerable:!0,get:function(){return o.EventList}}),Object.defineProperty(n,"NonUniformEventList",{enumerable:!0,get:function(){return o.NonUniformEventList}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.EventHandlingBase=n.EventList=n.NonUniformEventList=n.EventDispatcher=void 0;var s=i(148),m=function(t){function EventDispatcher(){return t.call(this)||this}return a(EventDispatcher,t),EventDispatcher.prototype.dispatch=function(t,n){this._dispatch(!1,this,arguments)},EventDispatcher.prototype.dispatchAsync=function(t,n){this._dispatch(!0,this,arguments)},EventDispatcher.prototype.asEvent=function(){return t.prototype.asEvent.call(this)},EventDispatcher}(s.DispatcherBase);n.EventDispatcher=m;var g=function(){function NonUniformEventList(){this._events={}}return NonUniformEventList.prototype.get=function(t){if(this._events[t])return this._events[t];var n=this.createDispatcher();return this._events[t]=n,n},NonUniformEventList.prototype.remove=function(t){delete this._events[t]},NonUniformEventList.prototype.createDispatcher=function(){return new m},NonUniformEventList}();n.NonUniformEventList=g;var _=function(t){function EventList(){return t.call(this)||this}return a(EventList,t),EventList.prototype.createDispatcher=function(){return new m},EventList}(s.EventListBase);n.EventList=_;var S=function(){function EventHandlingBase(){this._events=new _}return Object.defineProperty(EventHandlingBase.prototype,"events",{get:function(){return this._events},enumerable:!1,configurable:!0}),EventHandlingBase.prototype.subscribe=function(t,n){this._events.get(t).subscribe(n)},EventHandlingBase.prototype.sub=function(t,n){this.subscribe(t,n)},EventHandlingBase.prototype.unsubscribe=function(t,n){this._events.get(t).unsubscribe(n)},EventHandlingBase.prototype.unsub=function(t,n){this.unsubscribe(t,n)},EventHandlingBase.prototype.one=function(t,n){this._events.get(t).one(n)},EventHandlingBase.prototype.has=function(t,n){return this._events.get(t).has(n)},EventHandlingBase}();n.EventHandlingBase=S},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NonUniformSimpleEventList=n.SimpleEventList=n.SimpleEventHandlingBase=n.SimpleEventDispatcher=void 0;var o=i(463);Object.defineProperty(n,"SimpleEventDispatcher",{enumerable:!0,get:function(){return o.SimpleEventDispatcher}}),Object.defineProperty(n,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return o.SimpleEventHandlingBase}}),Object.defineProperty(n,"SimpleEventList",{enumerable:!0,get:function(){return o.SimpleEventList}}),Object.defineProperty(n,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return o.NonUniformSimpleEventList}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.SimpleEventHandlingBase=n.SimpleEventList=n.NonUniformSimpleEventList=n.SimpleEventDispatcher=void 0;var s=i(148),m=function(t){function SimpleEventDispatcher(){return t.call(this)||this}return a(SimpleEventDispatcher,t),SimpleEventDispatcher.prototype.dispatch=function(t){this._dispatch(!1,this,arguments)},SimpleEventDispatcher.prototype.dispatchAsync=function(t){this._dispatch(!0,this,arguments)},SimpleEventDispatcher.prototype.asEvent=function(){return t.prototype.asEvent.call(this)},SimpleEventDispatcher}(s.DispatcherBase);n.SimpleEventDispatcher=m;var g=function(){function NonUniformSimpleEventList(){this._events={}}return NonUniformSimpleEventList.prototype.get=function(t){if(this._events[t])return this._events[t];var n=this.createDispatcher();return this._events[t]=n,n},NonUniformSimpleEventList.prototype.remove=function(t){delete this._events[t]},NonUniformSimpleEventList.prototype.createDispatcher=function(){return new m},NonUniformSimpleEventList}();n.NonUniformSimpleEventList=g;var _=function(t){function SimpleEventList(){return t.call(this)||this}return a(SimpleEventList,t),SimpleEventList.prototype.createDispatcher=function(){return new m},SimpleEventList}(s.EventListBase);n.SimpleEventList=_;var S=function(){function SimpleEventHandlingBase(){this._events=new _}return Object.defineProperty(SimpleEventHandlingBase.prototype,"events",{get:function(){return this._events},enumerable:!1,configurable:!0}),SimpleEventHandlingBase.prototype.subscribe=function(t,n){this._events.get(t).subscribe(n)},SimpleEventHandlingBase.prototype.sub=function(t,n){this.subscribe(t,n)},SimpleEventHandlingBase.prototype.one=function(t,n){this._events.get(t).one(n)},SimpleEventHandlingBase.prototype.has=function(t,n){return this._events.get(t).has(n)},SimpleEventHandlingBase.prototype.unsubscribe=function(t,n){this._events.get(t).unsubscribe(n)},SimpleEventHandlingBase.prototype.unsub=function(t,n){this.unsubscribe(t,n)},SimpleEventHandlingBase}();n.SimpleEventHandlingBase=S},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SignalList=n.SignalHandlingBase=n.SignalDispatcher=void 0;var o=i(465);Object.defineProperty(n,"SignalDispatcher",{enumerable:!0,get:function(){return o.SignalDispatcher}}),Object.defineProperty(n,"SignalHandlingBase",{enumerable:!0,get:function(){return o.SignalHandlingBase}}),Object.defineProperty(n,"SignalList",{enumerable:!0,get:function(){return o.SignalList}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.SignalHandlingBase=n.SignalList=n.SignalDispatcher=void 0;var s=i(148),m=function(t){function SignalDispatcher(){return t.call(this)||this}return a(SignalDispatcher,t),SignalDispatcher.prototype.dispatch=function(){this._dispatch(!1,this,arguments)},SignalDispatcher.prototype.dispatchAsync=function(){this._dispatch(!0,this,arguments)},SignalDispatcher.prototype.asEvent=function(){return t.prototype.asEvent.call(this)},SignalDispatcher}(s.DispatcherBase);n.SignalDispatcher=m;var g=function(t){function SignalList(){return t.call(this)||this}return a(SignalList,t),SignalList.prototype.createDispatcher=function(){return new m},SignalList}(s.EventListBase);n.SignalList=g;var _=function(){function SignalHandlingBase(){this._events=new g}return Object.defineProperty(SignalHandlingBase.prototype,"events",{get:function(){return this._events},enumerable:!1,configurable:!0}),SignalHandlingBase.prototype.one=function(t,n){this._events.get(t).one(n)},SignalHandlingBase.prototype.has=function(t,n){return this._events.get(t).has(n)},SignalHandlingBase.prototype.subscribe=function(t,n){this._events.get(t).subscribe(n)},SignalHandlingBase.prototype.sub=function(t,n){this.subscribe(t,n)},SignalHandlingBase.prototype.unsubscribe=function(t,n){this._events.get(t).unsubscribe(n)},SignalHandlingBase.prototype.unsub=function(t,n){this.unsubscribe(t,n)},SignalHandlingBase}();n.SignalHandlingBase=_},function(t,n){t.exports=i},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Level=n.BrowserConsole=void 0;var o=i(251);Object.defineProperty(n,"BrowserConsole",{enumerable:!0,get:function(){return o.BrowserConsole}});var a=i(252);Object.defineProperty(n,"Level",{enumerable:!0,get:function(){return a.Level}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.XRManager=n.XRBtn=n.IsXRSupported=n.VRBtn=n.IsVRSupported=void 0;var o=i(265);Object.defineProperty(n,"IsVRSupported",{enumerable:!0,get:function(){return o.IsVRSupported}}),Object.defineProperty(n,"VRBtn",{enumerable:!0,get:function(){return o.VRBtn}});var a=i(193);Object.defineProperty(n,"IsXRSupported",{enumerable:!0,get:function(){return a.IsXRSupported}}),Object.defineProperty(n,"XRBtn",{enumerable:!0,get:function(){return a.XRBtn}});var s=i(268);Object.defineProperty(n,"XRManager",{enumerable:!0,get:function(){return s.XRManager}})},function(t,n,i){(t.exports=i(96)(!1)).push([t.i,".XRBtn {\n  position: absolute;\n  bottom: 20px;\n  padding: 12px 6px;\n  border: 1px solid #fff;\n  border-radius: 4px;\n  background: rgba(0, 0, 0, 0.1);\n  color: #fff;\n  font: normal 13px sans-serif;\n  text-align: center;\n  opacity: 0.5;\n  outline: none;\n  z-index: 999;\n  cursor: pointer;\n  left: calc(50% - 50px);\n  width: 100px;\n}\n.XRBtn :hover {\n  opacity: 1;\n}\n",""])},function(t,n,i){"use strict";var o,a=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},s=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CameraUtils=void 0,function(t){function checkCamera(){return a(this,void 0,void 0,(function(){return s(this,(function(t){return[2,new Promise((function(t,n){navigator[o]({audio:!1,video:{optional:[{minWidth:320},{minWidth:640},{minWidth:800},{minWidth:900},{minWidth:1024}]}},(function(n){(function dealWithStream(t){return a(this,void 0,void 0,(function(){return s(this,(function(n){return[2,new Promise((function(n,i){var o=document.createElement("video");o.addEventListener("resize",(function(){var t={width:o.videoWidth,heigh:o.videoHeight};o.remove(),n(t)})),o.src=window.URL.createObjectURL(t),o.play()}))]}))}))})(n).then((function(n){t(n)}))}),(function(t){n(t)}))}))]}))}))}t.getMaxResolution=function getMaxResolution(){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return function setGumPrefix(){navigator.getUserMedia?o="getUserMedia":navigator.webkitGetUserMedia?o="webkitGetUserMedia":navigator.mozGetUserMedia?o="mozGetUserMedia":navigator.msGetUserMedia&&(o="msGetUserMedia")}(),o?[3,1]:[2,{width:0,heigh:0}];case 1:return[4,checkCamera()];case 2:return[2,t.sent()]}}))}))}}(n.CameraUtils||(n.CameraUtils={}))},function(t,n,i){var o;t.exports=((o=function(){function e(t){return n.appendChild(t.dom),t}function u(i){for(var o=0;o<n.children.length;o++)n.children[o].style.display=o===i?"block":"none";t=i}var t=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(i){i.preventDefault(),u(++t%n.children.length)}),!1);var i=(performance||Date).now(),a=i,s=0,m=e(new o.Panel("FPS","#0ff","#002")),g=e(new o.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var _=e(new o.Panel("MB","#f08","#201"));return u(0),{REVISION:16,dom:n,addPanel:e,showPanel:u,begin:function(){i=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(g.update(t-i,200),t>a+1e3&&(m.update(1e3*s/(t-a),100),a=t,s=0,_)){var n=performance.memory;_.update(n.usedJSHeapSize/1048576,n.jsHeapSizeLimit/1048576)}return t},update:function(){i=this.end()},domElement:n,setMode:u}}).Panel=function(t,n,i){var o=1/0,a=0,s=Math.round,m=s(window.devicePixelRatio||1),g=80*m,_=48*m,S=3*m,M=2*m,T=3*m,O=15*m,A=74*m,P=30*m,L=document.createElement("canvas");L.width=g,L.height=_,L.style.cssText="width:80px;height:48px";var R=L.getContext("2d");return R.font="bold "+9*m+"px Helvetica,Arial,sans-serif",R.textBaseline="top",R.fillStyle=i,R.fillRect(0,0,g,_),R.fillStyle=n,R.fillText(t,S,M),R.fillRect(T,O,A,P),R.fillStyle=i,R.globalAlpha=.9,R.fillRect(T,O,A,P),{dom:L,update:function(_,N){o=Math.min(o,_),a=Math.max(a,_),R.fillStyle=i,R.globalAlpha=1,R.fillRect(0,0,g,O),R.fillStyle=n,R.fillText(s(_)+" "+t+" ("+s(o)+"-"+s(a)+")",S,M),R.drawImage(L,T+m,O,A-m,P,T,O,A-m,P),R.fillRect(T+A-m,O,m,P),R.fillStyle=i,R.globalAlpha=.9,R.fillRect(T+A-m,O,m,s((1-_/N)*P))}}},o)},function(t,n,i){"use strict";i.r(n),i.d(n,"GLTFLoader",(function(){return a}));var o=i(0),a=function(){function GLTFLoader(t){o.Loader.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new GLTFMaterialsClearcoatExtension(t)})),this.register((function(t){return new GLTFTextureBasisUExtension(t)})),this.register((function(t){return new GLTFTextureWebPExtension(t)})),this.register((function(t){return new GLTFMaterialsTransmissionExtension(t)})),this.register((function(t){return new GLTFLightsExtension(t)})),this.register((function(t){return new GLTFMeshoptCompression(t)}))}function GLTFRegistry(){var t={};return{get:function(n){return t[n]},add:function(n,i){t[n]=i},remove:function(n){delete t[n]},removeAll:function(){t={}}}}GLTFLoader.prototype=Object.assign(Object.create(o.Loader.prototype),{constructor:GLTFLoader,load:function(t,n,i,a){var s,m=this;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:o.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);var _onError=function(n){a?a(n):console.error(n),m.manager.itemError(t),m.manager.itemEnd(t)},g=new o.FileLoader(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(t,(function(i){try{m.parse(i,s,(function(i){n(i),m.manager.itemEnd(t)}),_onError)}catch(t){_onError(t)}}),i,_onError)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},setKTX2Loader:function(t){return this.ktx2Loader=t,this},setMeshoptDecoder:function(t){return this.meshoptDecoder=t,this},register:function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this},unregister:function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this},parse:function(i,a,s,m){var g,_={},S={};if("string"==typeof i)g=i;else if(o.LoaderUtils.decodeText(new Uint8Array(i,0,4))===n){try{_[t.KHR_BINARY_GLTF]=new GLTFBinaryExtension(i)}catch(t){return void(m&&m(t))}g=_[t.KHR_BINARY_GLTF].content}else g=o.LoaderUtils.decodeText(new Uint8Array(i));var M=JSON.parse(g);if(void 0===M.asset||M.asset.version[0]<2)m&&m(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var T=new GLTFParser(M,{path:a||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});T.fileLoader.setRequestHeader(this.requestHeader);for(var O=0;O<this.pluginCallbacks.length;O++){var A=this.pluginCallbacks[O](T);S[A.name]=A,_[A.name]=!0}if(M.extensionsUsed)for(O=0;O<M.extensionsUsed.length;++O){var P=M.extensionsUsed[O],L=M.extensionsRequired||[];switch(P){case t.KHR_MATERIALS_UNLIT:_[P]=new GLTFMaterialsUnlitExtension;break;case t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:_[P]=new GLTFMaterialsPbrSpecularGlossinessExtension;break;case t.KHR_DRACO_MESH_COMPRESSION:_[P]=new GLTFDracoMeshCompressionExtension(M,this.dracoLoader);break;case t.MSFT_TEXTURE_DDS:_[P]=new GLTFTextureDDSExtension(this.ddsLoader);break;case t.KHR_TEXTURE_TRANSFORM:_[P]=new GLTFTextureTransformExtension;break;case t.KHR_MESH_QUANTIZATION:_[P]=new GLTFMeshQuantizationExtension;break;default:L.indexOf(P)>=0&&void 0===S[P]&&console.warn('THREE.GLTFLoader: Unknown extension "'+P+'".')}}T.setExtensions(_),T.setPlugins(S),T.parse(s,m)}}});var t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function GLTFTextureDDSExtension(n){if(!n)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=t.MSFT_TEXTURE_DDS,this.ddsLoader=n}function GLTFLightsExtension(n){this.parser=n,this.name=t.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function GLTFMaterialsUnlitExtension(){this.name=t.KHR_MATERIALS_UNLIT}function GLTFMaterialsClearcoatExtension(n){this.parser=n,this.name=t.KHR_MATERIALS_CLEARCOAT}function GLTFMaterialsTransmissionExtension(n){this.parser=n,this.name=t.KHR_MATERIALS_TRANSMISSION}function GLTFTextureBasisUExtension(n){this.parser=n,this.name=t.KHR_TEXTURE_BASISU}function GLTFTextureWebPExtension(n){this.parser=n,this.name=t.EXT_TEXTURE_WEBP,this.isSupported=null}function GLTFMeshoptCompression(n){this.name=t.EXT_MESHOPT_COMPRESSION,this.parser=n}GLTFLightsExtension.prototype._markDefs=function(){for(var t=this.parser,n=this.parser.json.nodes||[],i=0,o=n.length;i<o;i++){var a=n[i];a.extensions&&a.extensions[this.name]&&void 0!==a.extensions[this.name].light&&t._addNodeRef(this.cache,a.extensions[this.name].light)}},GLTFLightsExtension.prototype._loadLight=function(t){var n=this.parser,i="light:"+t,a=n.cache.get(i);if(a)return a;var s,m=n.json,g=((m.extensions&&m.extensions[this.name]||{}).lights||[])[t],_=new o.Color(16777215);void 0!==g.color&&_.fromArray(g.color);var S=void 0!==g.range?g.range:0;switch(g.type){case"directional":(s=new o.DirectionalLight(_)).target.position.set(0,0,-1),s.add(s.target);break;case"point":(s=new o.PointLight(_)).distance=S;break;case"spot":(s=new o.SpotLight(_)).distance=S,g.spot=g.spot||{},g.spot.innerConeAngle=void 0!==g.spot.innerConeAngle?g.spot.innerConeAngle:0,g.spot.outerConeAngle=void 0!==g.spot.outerConeAngle?g.spot.outerConeAngle:Math.PI/4,s.angle=g.spot.outerConeAngle,s.penumbra=1-g.spot.innerConeAngle/g.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+g.type)}return s.position.set(0,0,0),s.decay=2,void 0!==g.intensity&&(s.intensity=g.intensity),s.name=n.createUniqueName(g.name||"light_"+t),a=Promise.resolve(s),n.cache.add(i,a),a},GLTFLightsExtension.prototype.createNodeAttachment=function(t){var n=this,i=this.parser,o=i.json.nodes[t],a=(o.extensions&&o.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(t){return i._getNodeRef(n.cache,a,t)}))},GLTFMaterialsUnlitExtension.prototype.getMaterialType=function(){return o.MeshBasicMaterial},GLTFMaterialsUnlitExtension.prototype.extendParams=function(t,n,i){var a=[];t.color=new o.Color(1,1,1),t.opacity=1;var s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){var m=s.baseColorFactor;t.color.fromArray(m),t.opacity=m[3]}void 0!==s.baseColorTexture&&a.push(i.assignTexture(t,"map",s.baseColorTexture))}return Promise.all(a)},GLTFMaterialsClearcoatExtension.prototype.getMaterialType=function(t){var n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?o.MeshPhysicalMaterial:null},GLTFMaterialsClearcoatExtension.prototype.extendMaterialParams=function(t,n){var i=this.parser,a=i.json.materials[t];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();var s=[],m=a.extensions[this.name];if(void 0!==m.clearcoatFactor&&(n.clearcoat=m.clearcoatFactor),void 0!==m.clearcoatTexture&&s.push(i.assignTexture(n,"clearcoatMap",m.clearcoatTexture)),void 0!==m.clearcoatRoughnessFactor&&(n.clearcoatRoughness=m.clearcoatRoughnessFactor),void 0!==m.clearcoatRoughnessTexture&&s.push(i.assignTexture(n,"clearcoatRoughnessMap",m.clearcoatRoughnessTexture)),void 0!==m.clearcoatNormalTexture&&(s.push(i.assignTexture(n,"clearcoatNormalMap",m.clearcoatNormalTexture)),void 0!==m.clearcoatNormalTexture.scale)){var g=m.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new o.Vector2(g,g)}return Promise.all(s)},GLTFMaterialsTransmissionExtension.prototype.getMaterialType=function(t){var n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?o.MeshPhysicalMaterial:null},GLTFMaterialsTransmissionExtension.prototype.extendMaterialParams=function(t,n){var i=this.parser,o=i.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();var a=[],s=o.extensions[this.name];return void 0!==s.transmissionFactor&&(n.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&a.push(i.assignTexture(n,"transmissionMap",s.transmissionTexture)),Promise.all(a)},GLTFTextureBasisUExtension.prototype.loadTexture=function(t){var n=this.parser,i=n.json,o=i.textures[t];if(!o.extensions||!o.extensions[this.name])return null;var a=o.extensions[this.name],s=i.images[a.source],m=n.options.ktx2Loader;if(!m){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(t,s,m)},GLTFTextureWebPExtension.prototype.loadTexture=function(t){var n=this.name,i=this.parser,o=i.json,a=o.textures[t];if(!a.extensions||!a.extensions[n])return null;var s=a.extensions[n],m=o.images[s.source],g=m.uri?i.options.manager.getHandler(m.uri):i.textureLoader;return this.detectSupport().then((function(a){if(a)return i.loadTextureImage(t,m,g);if(o.extensionsRequired&&o.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)}))},GLTFTextureWebPExtension.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(t){var n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){t(1===n.height)}}))),this.isSupported},GLTFMeshoptCompression.prototype.loadBufferView=function(t){var n=this.parser.json,i=n.bufferViews[t];if(i.extensions&&i.extensions[this.name]){var o=i.extensions[this.name],a=this.parser.getDependency("buffer",o.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([a,s.ready]).then((function(t){var n=o.byteOffset||0,i=o.byteLength||0,a=o.count,m=o.byteStride,g=new ArrayBuffer(a*m),_=new Uint8Array(t[0],n,i);return s.decodeGltfBuffer(new Uint8Array(g),a,m,_,o.mode,o.filter),g}))}return null};var n="glTF";function GLTFBinaryExtension(i){this.name=t.KHR_BINARY_GLTF,this.content=null,this.body=null;var a=new DataView(i,0,12);if(this.header={magic:o.LoaderUtils.decodeText(new Uint8Array(i.slice(0,4))),version:a.getUint32(4,!0),length:a.getUint32(8,!0)},this.header.magic!==n)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var s=new DataView(i,12),m=0;m<s.byteLength;){var g=s.getUint32(m,!0);m+=4;var _=s.getUint32(m,!0);if(m+=4,1313821514===_){var S=new Uint8Array(i,12+m,g);this.content=o.LoaderUtils.decodeText(S)}else if(5130562===_){var M=12+m;this.body=i.slice(M,M+g)}m+=g}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function GLTFDracoMeshCompressionExtension(n,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=t.KHR_DRACO_MESH_COMPRESSION,this.json=n,this.dracoLoader=i,this.dracoLoader.preload()}function GLTFTextureTransformExtension(){this.name=t.KHR_TEXTURE_TRANSFORM}function GLTFMeshStandardSGMaterial(t){o.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var n=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),m=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),g={specular:{value:(new o.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=g,this.onBeforeCompile=function(t){for(var o in g)t.uniforms[o]=g[o];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",m)},Object.defineProperties(this,{specular:{get:function(){return g.specular.value},set:function(t){g.specular.value=t}},specularMap:{get:function(){return g.specularMap.value},set:function(t){g.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return g.glossiness.value},set:function(t){g.glossiness.value=t}},glossinessMap:{get:function(){return g.glossinessMap.value},set:function(t){g.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function GLTFMaterialsPbrSpecularGlossinessExtension(){return{name:t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return GLTFMeshStandardSGMaterial},extendParams:function(t,n,i){var a=n.extensions[this.name];t.color=new o.Color(1,1,1),t.opacity=1;var s=[];if(Array.isArray(a.diffuseFactor)){var m=a.diffuseFactor;t.color.fromArray(m),t.opacity=m[3]}if(void 0!==a.diffuseTexture&&s.push(i.assignTexture(t,"map",a.diffuseTexture)),t.emissive=new o.Color(0,0,0),t.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,t.specular=new o.Color(1,1,1),Array.isArray(a.specularFactor)&&t.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var g=a.specularGlossinessTexture;s.push(i.assignTexture(t,"glossinessMap",g)),s.push(i.assignTexture(t,"specularMap",g))}return Promise.all(s)},createMaterial:function(t){var n=new GLTFMeshStandardSGMaterial(t);return n.fog=!0,n.color=t.color,n.map=void 0===t.map?null:t.map,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=void 0===t.aoMap?null:t.aoMap,n.aoMapIntensity=1,n.emissive=t.emissive,n.emissiveIntensity=1,n.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,n.bumpMap=void 0===t.bumpMap?null:t.bumpMap,n.bumpScale=1,n.normalMap=void 0===t.normalMap?null:t.normalMap,n.normalMapType=o.TangentSpaceNormalMap,t.normalScale&&(n.normalScale=t.normalScale),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=void 0===t.specularMap?null:t.specularMap,n.specular=t.specular,n.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,n.glossiness=t.glossiness,n.alphaMap=null,n.envMap=void 0===t.envMap?null:t.envMap,n.envMapIntensity=1,n.refractionRatio=.98,n}}}function GLTFMeshQuantizationExtension(){this.name=t.KHR_MESH_QUANTIZATION}function GLTFCubicSplineInterpolant(t,n,i,a){o.Interpolant.call(this,t,n,i,a)}GLTFDracoMeshCompressionExtension.prototype.decodePrimitive=function(t,n){var o=this.json,a=this.dracoLoader,s=t.extensions[this.name].bufferView,m=t.extensions[this.name].attributes,_={},S={},M={};for(var T in m){var O=g[T]||T.toLowerCase();_[O]=m[T]}for(T in t.attributes)if(O=g[T]||T.toLowerCase(),void 0!==m[T]){var A=o.accessors[t.attributes[T]],P=i[A.componentType];M[O]=P,S[O]=!0===A.normalized}return n.getDependency("bufferView",s).then((function(t){return new Promise((function(n){a.decodeDracoFile(t,(function(t){for(var i in t.attributes){var o=t.attributes[i],a=S[i];void 0!==a&&(o.normalized=a)}n(t)}),_,M)}))}))},GLTFTextureTransformExtension.prototype.extendTexture=function(t,n){return t=t.clone(),void 0!==n.offset&&t.offset.fromArray(n.offset),void 0!==n.rotation&&(t.rotation=n.rotation),void 0!==n.scale&&t.repeat.fromArray(n.scale),void 0!==n.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},GLTFMeshStandardSGMaterial.prototype=Object.create(o.MeshStandardMaterial.prototype),GLTFMeshStandardSGMaterial.prototype.constructor=GLTFMeshStandardSGMaterial,GLTFMeshStandardSGMaterial.prototype.copy=function(t){return o.MeshStandardMaterial.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},GLTFCubicSplineInterpolant.prototype=Object.create(o.Interpolant.prototype),GLTFCubicSplineInterpolant.prototype.constructor=GLTFCubicSplineInterpolant,GLTFCubicSplineInterpolant.prototype.copySampleValue_=function(t){for(var n=this.resultBuffer,i=this.sampleValues,o=this.valueSize,a=t*o*3+o,s=0;s!==o;s++)n[s]=i[a+s];return n},GLTFCubicSplineInterpolant.prototype.beforeStart_=GLTFCubicSplineInterpolant.prototype.copySampleValue_,GLTFCubicSplineInterpolant.prototype.afterEnd_=GLTFCubicSplineInterpolant.prototype.copySampleValue_,GLTFCubicSplineInterpolant.prototype.interpolate_=function(t,n,i,o){for(var a=this.resultBuffer,s=this.sampleValues,m=this.valueSize,g=2*m,_=3*m,S=o-n,M=(i-n)/S,T=M*M,O=T*M,A=t*_,P=A-_,L=-2*O+3*T,R=O-T,N=1-L,I=R-T+M,j=0;j!==m;j++){var V=s[P+j+m],U=s[P+j+g]*S,G=s[A+j+m],z=s[A+j]*S;a[j]=N*V+I*U+L*G+R*z}return a};var i={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},a={9728:o.NearestFilter,9729:o.LinearFilter,9984:o.NearestMipmapNearestFilter,9985:o.LinearMipmapNearestFilter,9986:o.NearestMipmapLinearFilter,9987:o.LinearMipmapLinearFilter},s={33071:o.ClampToEdgeWrapping,33648:o.MirroredRepeatWrapping,10497:o.RepeatWrapping},m={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},g={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},_={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},S={CUBICSPLINE:void 0,LINEAR:o.InterpolateLinear,STEP:o.InterpolateDiscrete};function resolveURL(t,n){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(n)&&/^\//.test(t)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:n+t)}function addUnknownExtensionsToUserData(t,n,i){for(var o in i.extensions)void 0===t[o]&&(n.userData.gltfExtensions=n.userData.gltfExtensions||{},n.userData.gltfExtensions[o]=i.extensions[o])}function assignExtrasToUserData(t,n){void 0!==n.extras&&("object"==typeof n.extras?Object.assign(t.userData,n.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+n.extras))}function updateMorphTargets(t,n){if(t.updateMorphTargets(),void 0!==n.weights)for(var i=0,o=n.weights.length;i<o;i++)t.morphTargetInfluences[i]=n.weights[i];if(n.extras&&Array.isArray(n.extras.targetNames)){var a=n.extras.targetNames;if(t.morphTargetInfluences.length===a.length)for(t.morphTargetDictionary={},i=0,o=a.length;i<o;i++)t.morphTargetDictionary[a[i]]=i;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createAttributesKey(t){for(var n="",i=Object.keys(t).sort(),o=0,a=i.length;o<a;o++)n+=i[o]+":"+t[i[o]]+";";return n}function GLTFParser(t,n){this.json=t||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new o.ImageBitmapLoader(this.options.manager):this.textureLoader=new o.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new o.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function addPrimitiveAttributes(t,n,i){var a=n.attributes,s=[];function assignAttributeAccessor(n,o){return i.getDependency("accessor",n).then((function(n){t.setAttribute(o,n)}))}for(var m in a){var _=g[m]||m.toLowerCase();_ in t.attributes||s.push(assignAttributeAccessor(a[m],_))}if(void 0!==n.indices&&!t.index){var S=i.getDependency("accessor",n.indices).then((function(n){t.setIndex(n)}));s.push(S)}return assignExtrasToUserData(t,n),function computeBounds(t,n,i){var a=n.attributes,s=new o.Box3;if(void 0!==a.POSITION){var m=(A=i.json.accessors[a.POSITION]).min,g=A.max;if(void 0!==m&&void 0!==g){s.set(new o.Vector3(m[0],m[1],m[2]),new o.Vector3(g[0],g[1],g[2]));var _=n.targets;if(void 0!==_){for(var S=new o.Vector3,M=new o.Vector3,T=0,O=_.length;T<O;T++){var A,P=_[T];if(void 0!==P.POSITION)m=(A=i.json.accessors[P.POSITION]).min,g=A.max,void 0!==m&&void 0!==g?(M.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),M.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),M.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),S.max(M)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}s.expandByVector(S)}t.boundingBox=s;var L=new o.Sphere;s.getCenter(L.center),L.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=L}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,n,i),Promise.all(s).then((function(){return void 0!==n.targets?function addMorphTargets(t,n,i){for(var o=!1,a=!1,s=0,m=n.length;s<m&&(void 0!==(S=n[s]).POSITION&&(o=!0),void 0!==S.NORMAL&&(a=!0),!o||!a);s++);if(!o&&!a)return Promise.resolve(t);var g=[],_=[];for(s=0,m=n.length;s<m;s++){var S=n[s];if(o){var M=void 0!==S.POSITION?i.getDependency("accessor",S.POSITION):t.attributes.position;g.push(M)}a&&(M=void 0!==S.NORMAL?i.getDependency("accessor",S.NORMAL):t.attributes.normal,_.push(M))}return Promise.all([Promise.all(g),Promise.all(_)]).then((function(n){var i=n[0],s=n[1];return o&&(t.morphAttributes.position=i),a&&(t.morphAttributes.normal=s),t.morphTargetsRelative=!0,t}))}(t,n.targets,i):t}))}function toTrianglesDrawMode(t,n){var i=t.getIndex();if(null===i){var a=[],s=t.getAttribute("position");if(void 0===s)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var m=0;m<s.count;m++)a.push(m);t.setIndex(a),i=t.getIndex()}var g=i.count-2,_=[];if(n===o.TriangleFanDrawMode)for(m=1;m<=g;m++)_.push(i.getX(0)),_.push(i.getX(m)),_.push(i.getX(m+1));else for(m=0;m<g;m++)m%2==0?(_.push(i.getX(m)),_.push(i.getX(m+1)),_.push(i.getX(m+2))):(_.push(i.getX(m+2)),_.push(i.getX(m+1)),_.push(i.getX(m)));_.length/3!==g&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var S=t.clone();return S.setIndex(_),S}return GLTFParser.prototype.setExtensions=function(t){this.extensions=t},GLTFParser.prototype.setPlugins=function(t){this.plugins=t},GLTFParser.prototype.parse=function(t,n){var i=this,o=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(n){var s={scene:n[0][o.scene||0],scenes:n[0],animations:n[1],cameras:n[2],asset:o.asset,parser:i,userData:{}};addUnknownExtensionsToUserData(a,s,o),assignExtrasToUserData(s,o),t(s)})).catch(n)},GLTFParser.prototype._markDefs=function(){for(var t=this.json.nodes||[],n=this.json.skins||[],i=this.json.meshes||[],o=0,a=n.length;o<a;o++)for(var s=n[o].joints,m=0,g=s.length;m<g;m++)t[s[m]].isBone=!0;for(var _=0,S=t.length;_<S;_++){var M=t[_];void 0!==M.mesh&&(this._addNodeRef(this.meshCache,M.mesh),void 0!==M.skin&&(i[M.mesh].isSkinnedMesh=!0)),void 0!==M.camera&&this._addNodeRef(this.cameraCache,M.camera)}},GLTFParser.prototype._addNodeRef=function(t,n){void 0!==n&&(void 0===t.refs[n]&&(t.refs[n]=t.uses[n]=0),t.refs[n]++)},GLTFParser.prototype._getNodeRef=function(t,n,i){if(t.refs[n]<=1)return i;var o=i.clone();return o.name+="_instance_"+t.uses[n]++,o},GLTFParser.prototype._invokeOne=function(t){var n=Object.values(this.plugins);n.push(this);for(var i=0;i<n.length;i++){var o=t(n[i]);if(o)return o}},GLTFParser.prototype._invokeAll=function(t){var n=Object.values(this.plugins);n.unshift(this);for(var i=[],o=0;o<n.length;o++){var a=t(n[o]);a&&i.push(a)}return i},GLTFParser.prototype.getDependency=function(t,n){var i=t+":"+n,o=this.cache.get(i);if(!o){switch(t){case"scene":o=this.loadScene(n);break;case"node":o=this.loadNode(n);break;case"mesh":o=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(n)}));break;case"accessor":o=this.loadAccessor(n);break;case"bufferView":o=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(n)}));break;case"buffer":o=this.loadBuffer(n);break;case"material":o=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(n)}));break;case"texture":o=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(n)}));break;case"skin":o=this.loadSkin(n);break;case"animation":o=this.loadAnimation(n);break;case"camera":o=this.loadCamera(n);break;default:throw new Error("Unknown type: "+t)}this.cache.add(i,o)}return o},GLTFParser.prototype.getDependencies=function(t){var n=this.cache.get(t);if(!n){var i=this,o=this.json[t+("mesh"===t?"es":"s")]||[];n=Promise.all(o.map((function(n,o){return i.getDependency(t,o)}))),this.cache.add(t,n)}return n},GLTFParser.prototype.loadBuffer=function(n){var i=this.json.buffers[n],o=this.fileLoader;if(i.type&&"arraybuffer"!==i.type)throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(void 0===i.uri&&0===n)return Promise.resolve(this.extensions[t.KHR_BINARY_GLTF].body);var a=this.options;return new Promise((function(t,n){o.load(resolveURL(i.uri,a.path),t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))}))}))},GLTFParser.prototype.loadBufferView=function(t){var n=this.json.bufferViews[t];return this.getDependency("buffer",n.buffer).then((function(t){var i=n.byteLength||0,o=n.byteOffset||0;return t.slice(o,o+i)}))},GLTFParser.prototype.loadAccessor=function(t){var n=this,a=this.json,s=this.json.accessors[t];if(void 0===s.bufferView&&void 0===s.sparse)return Promise.resolve(null);var g=[];return void 0!==s.bufferView?g.push(this.getDependency("bufferView",s.bufferView)):g.push(null),void 0!==s.sparse&&(g.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),g.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(g).then((function(t){var g,_,S=t[0],M=m[s.type],T=i[s.componentType],O=T.BYTES_PER_ELEMENT,A=O*M,P=s.byteOffset||0,L=void 0!==s.bufferView?a.bufferViews[s.bufferView].byteStride:void 0,R=!0===s.normalized;if(L&&L!==A){var N=Math.floor(P/L),I="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+N+":"+s.count,j=n.cache.get(I);j||(g=new T(S,N*L,s.count*L/O),j=new o.InterleavedBuffer(g,L/O),n.cache.add(I,j)),_=new o.InterleavedBufferAttribute(j,M,P%L/O,R)}else g=null===S?new T(s.count*M):new T(S,P,s.count*M),_=new o.BufferAttribute(g,M,R);if(void 0!==s.sparse){var V=m.SCALAR,U=i[s.sparse.indices.componentType],G=s.sparse.indices.byteOffset||0,z=s.sparse.values.byteOffset||0,H=new U(t[1],G,s.sparse.count*V),q=new T(t[2],z,s.sparse.count*M);null!==S&&(_=new o.BufferAttribute(_.array.slice(),_.itemSize,_.normalized));for(var Z=0,X=H.length;Z<X;Z++){var Q=H[Z];if(_.setX(Q,q[Z*M]),M>=2&&_.setY(Q,q[Z*M+1]),M>=3&&_.setZ(Q,q[Z*M+2]),M>=4&&_.setW(Q,q[Z*M+3]),M>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return _}))},GLTFParser.prototype.loadTexture=function(n){var i,o,a=this.json,s=this.options,m=a.textures[n],g=m.extensions||{};return(i=g[t.MSFT_TEXTURE_DDS]?a.images[g[t.MSFT_TEXTURE_DDS].source]:a.images[m.source]).uri&&(o=s.manager.getHandler(i.uri)),o||(o=g[t.MSFT_TEXTURE_DDS]?this.extensions[t.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(n,i,o)},GLTFParser.prototype.loadTextureImage=function(t,n,i){var m=this,g=this.json,_=this.options,S=g.textures[t],M=self.URL||self.webkitURL,T=n.uri,O=!1,A=!0;return"image/jpeg"===n.mimeType&&(A=!1),void 0!==n.bufferView&&(T=m.getDependency("bufferView",n.bufferView).then((function(t){if("image/png"===n.mimeType){var i=new DataView(t,25,1).getUint8(0,!1);A=6===i||4===i||3===i}O=!0;var o=new Blob([t],{type:n.mimeType});return T=M.createObjectURL(o)}))),Promise.resolve(T).then((function(t){return new Promise((function(n,a){var s=n;!0===i.isImageBitmapLoader&&(s=function(t){n(new o.CanvasTexture(t))}),i.load(resolveURL(t,_.path),s,void 0,a)}))})).then((function(n){!0===O&&M.revokeObjectURL(T),n.flipY=!1,S.name&&(n.name=S.name),A||(n.format=o.RGBFormat);var i=(g.samplers||{})[S.sampler]||{};return n.magFilter=a[i.magFilter]||o.LinearFilter,n.minFilter=a[i.minFilter]||o.LinearMipmapLinearFilter,n.wrapS=s[i.wrapS]||o.RepeatWrapping,n.wrapT=s[i.wrapT]||o.RepeatWrapping,m.associations.set(n,{type:"textures",index:t}),n}))},GLTFParser.prototype.assignTexture=function(n,i,o){var a=this;return this.getDependency("texture",o.index).then((function(s){if(void 0===o.texCoord||0==o.texCoord||"aoMap"===i&&1==o.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+o.texCoord+" for texture "+i+" not yet supported."),a.extensions[t.KHR_TEXTURE_TRANSFORM]){var m=void 0!==o.extensions?o.extensions[t.KHR_TEXTURE_TRANSFORM]:void 0;if(m){var g=a.associations.get(s);s=a.extensions[t.KHR_TEXTURE_TRANSFORM].extendTexture(s,m),a.associations.set(s,g)}}n[i]=s}))},GLTFParser.prototype.assignFinalMaterial=function(t){var n=t.geometry,i=t.material,a=void 0!==n.attributes.tangent,s=void 0!==n.attributes.color,m=void 0===n.attributes.normal,g=!0===t.isSkinnedMesh,_=Object.keys(n.morphAttributes).length>0,S=_&&void 0!==n.morphAttributes.normal;if(t.isPoints){var M="PointsMaterial:"+i.uuid,T=this.cache.get(M);T||(T=new o.PointsMaterial,o.Material.prototype.copy.call(T,i),T.color.copy(i.color),T.map=i.map,T.sizeAttenuation=!1,this.cache.add(M,T)),i=T}else if(t.isLine){M="LineBasicMaterial:"+i.uuid;var O=this.cache.get(M);O||(O=new o.LineBasicMaterial,o.Material.prototype.copy.call(O,i),O.color.copy(i.color),this.cache.add(M,O)),i=O}if(a||s||m||g||_){M="ClonedMaterial:"+i.uuid+":",i.isGLTFSpecularGlossinessMaterial&&(M+="specular-glossiness:"),g&&(M+="skinning:"),a&&(M+="vertex-tangents:"),s&&(M+="vertex-colors:"),m&&(M+="flat-shading:"),_&&(M+="morph-targets:"),S&&(M+="morph-normals:");var A=this.cache.get(M);A||(A=i.clone(),g&&(A.skinning=!0),a&&(A.vertexTangents=!0),s&&(A.vertexColors=!0),m&&(A.flatShading=!0),_&&(A.morphTargets=!0),S&&(A.morphNormals=!0),this.cache.add(M,A),this.associations.set(A,this.associations.get(i))),i=A}i.aoMap&&void 0===n.attributes.uv2&&void 0!==n.attributes.uv&&n.setAttribute("uv2",n.attributes.uv),i.normalScale&&!a&&(i.normalScale.y=-i.normalScale.y),i.clearcoatNormalScale&&!a&&(i.clearcoatNormalScale.y=-i.clearcoatNormalScale.y),t.material=i},GLTFParser.prototype.getMaterialType=function(){return o.MeshStandardMaterial},GLTFParser.prototype.loadMaterial=function(n){var i,a=this,s=this.json,m=this.extensions,g=s.materials[n],_={},S=g.extensions||{},M=[];if(S[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var T=m[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=T.getMaterialType(),M.push(T.extendParams(_,g,a))}else if(S[t.KHR_MATERIALS_UNLIT]){var O=m[t.KHR_MATERIALS_UNLIT];i=O.getMaterialType(),M.push(O.extendParams(_,g,a))}else{var A=g.pbrMetallicRoughness||{};if(_.color=new o.Color(1,1,1),_.opacity=1,Array.isArray(A.baseColorFactor)){var P=A.baseColorFactor;_.color.fromArray(P),_.opacity=P[3]}void 0!==A.baseColorTexture&&M.push(a.assignTexture(_,"map",A.baseColorTexture)),_.metalness=void 0!==A.metallicFactor?A.metallicFactor:1,_.roughness=void 0!==A.roughnessFactor?A.roughnessFactor:1,void 0!==A.metallicRoughnessTexture&&(M.push(a.assignTexture(_,"metalnessMap",A.metallicRoughnessTexture)),M.push(a.assignTexture(_,"roughnessMap",A.metallicRoughnessTexture))),i=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(n)})),M.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(n,_)}))))}!0===g.doubleSided&&(_.side=o.DoubleSide);var L=g.alphaMode||"OPAQUE";return"BLEND"===L?(_.transparent=!0,_.depthWrite=!1):(_.transparent=!1,"MASK"===L&&(_.alphaTest=void 0!==g.alphaCutoff?g.alphaCutoff:.5)),void 0!==g.normalTexture&&i!==o.MeshBasicMaterial&&(M.push(a.assignTexture(_,"normalMap",g.normalTexture)),_.normalScale=new o.Vector2(1,1),void 0!==g.normalTexture.scale&&_.normalScale.set(g.normalTexture.scale,g.normalTexture.scale)),void 0!==g.occlusionTexture&&i!==o.MeshBasicMaterial&&(M.push(a.assignTexture(_,"aoMap",g.occlusionTexture)),void 0!==g.occlusionTexture.strength&&(_.aoMapIntensity=g.occlusionTexture.strength)),void 0!==g.emissiveFactor&&i!==o.MeshBasicMaterial&&(_.emissive=(new o.Color).fromArray(g.emissiveFactor)),void 0!==g.emissiveTexture&&i!==o.MeshBasicMaterial&&M.push(a.assignTexture(_,"emissiveMap",g.emissiveTexture)),Promise.all(M).then((function(){var s;return s=i===GLTFMeshStandardSGMaterial?m[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(_):new i(_),g.name&&(s.name=g.name),s.map&&(s.map.encoding=o.sRGBEncoding),s.emissiveMap&&(s.emissiveMap.encoding=o.sRGBEncoding),assignExtrasToUserData(s,g),a.associations.set(s,{type:"materials",index:n}),g.extensions&&addUnknownExtensionsToUserData(m,s,g),s}))},GLTFParser.prototype.createUniqueName=function(t){for(var n=o.PropertyBinding.sanitizeNodeName(t||""),i=n,a=1;this.nodeNamesUsed[i];++a)i=n+"_"+a;return this.nodeNamesUsed[i]=!0,i},GLTFParser.prototype.loadGeometries=function(n){var i=this,a=this.extensions,s=this.primitiveCache;function createDracoPrimitive(n){return a[t.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(n,i).then((function(t){return addPrimitiveAttributes(t,n,i)}))}for(var m,g,_=[],S=0,M=n.length;S<M;S++){var T,O=n[S],A=(void 0,(g=(m=O).extensions&&m.extensions[t.KHR_DRACO_MESH_COMPRESSION])?"draco:"+g.bufferView+":"+g.indices+":"+createAttributesKey(g.attributes):m.indices+":"+createAttributesKey(m.attributes)+":"+m.mode),P=s[A];P?_.push(P.promise):(T=O.extensions&&O.extensions[t.KHR_DRACO_MESH_COMPRESSION]?createDracoPrimitive(O):addPrimitiveAttributes(new o.BufferGeometry,O,i),s[A]={primitive:O,promise:T},_.push(T))}return Promise.all(_)},GLTFParser.prototype.loadMesh=function(t){for(var n,i=this,a=this.json,s=this.extensions,m=a.meshes[t],g=m.primitives,_=[],S=0,M=g.length;S<M;S++){var T=void 0===g[S].material?(void 0===(n=this.cache).DefaultMaterial&&(n.DefaultMaterial=new o.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:o.FrontSide})),n.DefaultMaterial):this.getDependency("material",g[S].material);_.push(T)}return _.push(i.loadGeometries(g)),Promise.all(_).then((function(n){for(var a=n.slice(0,n.length-1),_=n[n.length-1],S=[],M=0,T=_.length;M<T;M++){var O,A=_[M],P=g[M],L=a[M];if(4===P.mode||5===P.mode||6===P.mode||void 0===P.mode)!0!==(O=!0===m.isSkinnedMesh?new o.SkinnedMesh(A,L):new o.Mesh(A,L)).isSkinnedMesh||O.geometry.attributes.skinWeight.normalized||O.normalizeSkinWeights(),5===P.mode?O.geometry=toTrianglesDrawMode(O.geometry,o.TriangleStripDrawMode):6===P.mode&&(O.geometry=toTrianglesDrawMode(O.geometry,o.TriangleFanDrawMode));else if(1===P.mode)O=new o.LineSegments(A,L);else if(3===P.mode)O=new o.Line(A,L);else if(2===P.mode)O=new o.LineLoop(A,L);else{if(0!==P.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+P.mode);O=new o.Points(A,L)}Object.keys(O.geometry.morphAttributes).length>0&&updateMorphTargets(O,m),O.name=i.createUniqueName(m.name||"mesh_"+t),assignExtrasToUserData(O,m),P.extensions&&addUnknownExtensionsToUserData(s,O,P),i.assignFinalMaterial(O),S.push(O)}if(1===S.length)return S[0];var R=new o.Group;for(M=0,T=S.length;M<T;M++)R.add(S[M]);return R}))},GLTFParser.prototype.loadCamera=function(t){var n,i=this.json.cameras[t],a=i[i.type];if(a)return"perspective"===i.type?n=new o.PerspectiveCamera(o.MathUtils.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===i.type&&(n=new o.OrthographicCamera(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),i.name&&(n.name=this.createUniqueName(i.name)),assignExtrasToUserData(n,i),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")},GLTFParser.prototype.loadSkin=function(t){var n=this.json.skins[t],i={joints:n.joints};return void 0===n.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",n.inverseBindMatrices).then((function(t){return i.inverseBindMatrices=t,i}))},GLTFParser.prototype.loadAnimation=function(t){for(var n=this.json.animations[t],i=[],a=[],s=[],m=[],g=[],M=0,T=n.channels.length;M<T;M++){var O=n.channels[M],A=n.samplers[O.sampler],P=O.target,L=void 0!==P.node?P.node:P.id,R=void 0!==n.parameters?n.parameters[A.input]:A.input,N=void 0!==n.parameters?n.parameters[A.output]:A.output;i.push(this.getDependency("node",L)),a.push(this.getDependency("accessor",R)),s.push(this.getDependency("accessor",N)),m.push(A),g.push(P)}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(s),Promise.all(m),Promise.all(g)]).then((function(i){for(var a=i[0],s=i[1],m=i[2],g=i[3],M=i[4],T=[],O=0,A=a.length;O<A;O++){var P=a[O],L=s[O],R=m[O],N=g[O],I=M[O];if(void 0!==P){var j;switch(P.updateMatrix(),P.matrixAutoUpdate=!0,_[I.path]){case _.weights:j=o.NumberKeyframeTrack;break;case _.rotation:j=o.QuaternionKeyframeTrack;break;case _.position:case _.scale:default:j=o.VectorKeyframeTrack}var V=P.name?P.name:P.uuid,U=void 0!==N.interpolation?S[N.interpolation]:o.InterpolateLinear,G=[];_[I.path]===_.weights?P.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&G.push(t.name?t.name:t.uuid)})):G.push(V);var z=R.array;if(R.normalized){var H;if(z.constructor===Int8Array)H=1/127;else if(z.constructor===Uint8Array)H=1/255;else if(z.constructor==Int16Array)H=1/32767;else{if(z.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");H=1/65535}for(var q=new Float32Array(z.length),Z=0,X=z.length;Z<X;Z++)q[Z]=z[Z]*H;z=q}for(Z=0,X=G.length;Z<X;Z++){var Q=new j(G[Z]+"."+_[I.path],L.array,z,U);"CUBICSPLINE"===N.interpolation&&(Q.createInterpolant=function InterpolantFactoryMethodGLTFCubicSpline(t){return new GLTFCubicSplineInterpolant(this.times,this.values,this.getValueSize()/3,t)},Q.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),T.push(Q)}}}var Y=n.name?n.name:"animation_"+t;return new o.AnimationClip(Y,void 0,T)}))},GLTFParser.prototype.loadNode=function(t){var n,i=this.json,a=this.extensions,s=this,m=i.nodes[t],g=m.name?s.createUniqueName(m.name):"";return(n=[],void 0!==m.mesh&&n.push(s.getDependency("mesh",m.mesh).then((function(t){var n=s._getNodeRef(s.meshCache,m.mesh,t);return void 0!==m.weights&&n.traverse((function(t){if(t.isMesh)for(var n=0,i=m.weights.length;n<i;n++)t.morphTargetInfluences[n]=m.weights[n]})),n}))),void 0!==m.camera&&n.push(s.getDependency("camera",m.camera).then((function(t){return s._getNodeRef(s.cameraCache,m.camera,t)}))),s._invokeAll((function(n){return n.createNodeAttachment&&n.createNodeAttachment(t)})).forEach((function(t){n.push(t)})),Promise.all(n)).then((function(n){var i;if((i=!0===m.isBone?new o.Bone:n.length>1?new o.Group:1===n.length?n[0]:new o.Object3D)!==n[0])for(var _=0,S=n.length;_<S;_++)i.add(n[_]);if(m.name&&(i.userData.name=m.name,i.name=g),assignExtrasToUserData(i,m),m.extensions&&addUnknownExtensionsToUserData(a,i,m),void 0!==m.matrix){var M=new o.Matrix4;M.fromArray(m.matrix),i.applyMatrix4(M)}else void 0!==m.translation&&i.position.fromArray(m.translation),void 0!==m.rotation&&i.quaternion.fromArray(m.rotation),void 0!==m.scale&&i.scale.fromArray(m.scale);return s.associations.set(i,{type:"nodes",index:t}),i}))},GLTFParser.prototype.loadScene=function(){function buildNodeHierachy(t,n,i,a){var s=i.nodes[t];return a.getDependency("node",t).then((function(t){return void 0===s.skin?t:a.getDependency("skin",s.skin).then((function(t){for(var i=[],o=0,s=(n=t).joints.length;o<s;o++)i.push(a.getDependency("node",n.joints[o]));return Promise.all(i)})).then((function(i){return t.traverse((function(t){if(t.isMesh){for(var a=[],s=[],m=0,g=i.length;m<g;m++){var _=i[m];if(_){a.push(_);var S=new o.Matrix4;void 0!==n.inverseBindMatrices&&S.fromArray(n.inverseBindMatrices.array,16*m),s.push(S)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[m])}t.bind(new o.Skeleton(a,s),t.matrixWorld)}})),t}));var n})).then((function(t){n.add(t);var o=[];if(s.children)for(var m=s.children,g=0,_=m.length;g<_;g++){var S=m[g];o.push(buildNodeHierachy(S,t,i,a))}return Promise.all(o)}))}return function loadScene(t){var n=this.json,i=this.extensions,a=this.json.scenes[t],s=new o.Group;a.name&&(s.name=this.createUniqueName(a.name)),assignExtrasToUserData(s,a),a.extensions&&addUnknownExtensionsToUserData(i,s,a);for(var m=a.nodes||[],g=[],_=0,S=m.length;_<S;_++)g.push(buildNodeHierachy(m[_],s,n,this));return Promise.all(g).then((function(){return s}))}}(),GLTFLoader}()},function(t,n,i){"use strict";i.r(n),i.d(n,"OBJLoader",(function(){return a}));var o=i(0),a=function(){var t=/^[og]\s*(.+)?/,n=/^mtllib /,i=/^usemtl /,a=/^usemap /,s=new o.Vector3,m=new o.Vector3,g=new o.Vector3,_=new o.Vector3,S=new o.Vector3;function ParserState(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,n){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==n);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==n,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,n){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var o={index:this.materials.length,name:t||"",mtllib:Array.isArray(n)&&n.length>0?n[n.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var n={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return n.clone=this.clone.bind(n),n}};return this.materials.push(o),o},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var n=this.currentMaterial();if(n&&-1===n.groupEnd&&(n.groupEnd=this.geometry.vertices.length/3,n.groupCount=n.groupEnd-n.groupStart,n.inherited=!1),t&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),n}},i&&i.name&&"function"==typeof i.clone){var o=i.clone(0);o.inherited=!0,this.object.materials.push(o)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,n){var i=parseInt(t,10);return 3*(i>=0?i-1:i+n/3)},parseNormalIndex:function(t,n){var i=parseInt(t,10);return 3*(i>=0?i-1:i+n/3)},parseUVIndex:function(t,n){var i=parseInt(t,10);return 2*(i>=0?i-1:i+n/2)},addVertex:function(t,n,i){var o=this.vertices,a=this.object.geometry.vertices;a.push(o[t+0],o[t+1],o[t+2]),a.push(o[n+0],o[n+1],o[n+2]),a.push(o[i+0],o[i+1],o[i+2])},addVertexPoint:function(t){var n=this.vertices;this.object.geometry.vertices.push(n[t+0],n[t+1],n[t+2])},addVertexLine:function(t){var n=this.vertices;this.object.geometry.vertices.push(n[t+0],n[t+1],n[t+2])},addNormal:function(t,n,i){var o=this.normals,a=this.object.geometry.normals;a.push(o[t+0],o[t+1],o[t+2]),a.push(o[n+0],o[n+1],o[n+2]),a.push(o[i+0],o[i+1],o[i+2])},addFaceNormal:function(t,n,i){var o=this.vertices,a=this.object.geometry.normals;s.fromArray(o,t),m.fromArray(o,n),g.fromArray(o,i),S.subVectors(g,m),_.subVectors(s,m),S.cross(_),S.normalize(),a.push(S.x,S.y,S.z),a.push(S.x,S.y,S.z),a.push(S.x,S.y,S.z)},addColor:function(t,n,i){var o=this.colors,a=this.object.geometry.colors;void 0!==o[t]&&a.push(o[t+0],o[t+1],o[t+2]),void 0!==o[n]&&a.push(o[n+0],o[n+1],o[n+2]),void 0!==o[i]&&a.push(o[i+0],o[i+1],o[i+2])},addUV:function(t,n,i){var o=this.uvs,a=this.object.geometry.uvs;a.push(o[t+0],o[t+1]),a.push(o[n+0],o[n+1]),a.push(o[i+0],o[i+1])},addDefaultUV:function(){var t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){var n=this.uvs;this.object.geometry.uvs.push(n[t+0],n[t+1])},addFace:function(t,n,i,o,a,s,m,g,_){var S=this.vertices.length,M=this.parseVertexIndex(t,S),T=this.parseVertexIndex(n,S),O=this.parseVertexIndex(i,S);if(this.addVertex(M,T,O),this.addColor(M,T,O),void 0!==m&&""!==m){var A=this.normals.length;M=this.parseNormalIndex(m,A),T=this.parseNormalIndex(g,A),O=this.parseNormalIndex(_,A),this.addNormal(M,T,O)}else this.addFaceNormal(M,T,O);if(void 0!==o&&""!==o){var P=this.uvs.length;M=this.parseUVIndex(o,P),T=this.parseUVIndex(a,P),O=this.parseUVIndex(s,P),this.addUV(M,T,O),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";for(var n=this.vertices.length,i=0,o=t.length;i<o;i++){var a=this.parseVertexIndex(t[i],n);this.addVertexPoint(a),this.addColor(a)}},addLineGeometry:function(t,n){this.object.geometry.type="Line";for(var i=this.vertices.length,o=this.uvs.length,a=0,s=t.length;a<s;a++)this.addVertexLine(this.parseVertexIndex(t[a],i));var m=0;for(s=n.length;m<s;m++)this.addUVLine(this.parseUVIndex(n[m],o))}};return t.startObject("",!1),t}function OBJLoader(t){o.Loader.call(this,t),this.materials=null}return OBJLoader.prototype=Object.assign(Object.create(o.Loader.prototype),{constructor:OBJLoader,load:function(t,n,i,a){var s=this,m=new o.FileLoader(this.manager);m.setPath(this.path),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(t,(function(i){try{n(s.parse(i))}catch(n){a?a(n):console.error(n),s.manager.itemError(t)}}),i,a)},setMaterials:function(t){return this.materials=t,this},parse:function(s){var m=new ParserState;-1!==s.indexOf("\r\n")&&(s=s.replace(/\r\n/g,"\n")),-1!==s.indexOf("\\\n")&&(s=s.replace(/\\\n/g,""));for(var g=s.split("\n"),_="",S="",M=[],T="function"==typeof"".trimLeft,O=0,A=g.length;O<A;O++)if(_=g[O],0!==(_=T?_.trimLeft():_.trim()).length&&"#"!==(S=_.charAt(0)))if("v"===S){var P=_.split(/\s+/);switch(P[0]){case"v":m.vertices.push(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])),P.length>=7?m.colors.push(parseFloat(P[4]),parseFloat(P[5]),parseFloat(P[6])):m.colors.push(void 0,void 0,void 0);break;case"vn":m.normals.push(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3]));break;case"vt":m.uvs.push(parseFloat(P[1]),parseFloat(P[2]))}}else if("f"===S){for(var L=_.substr(1).trim().split(/\s+/),R=[],N=0,I=L.length;N<I;N++){var j=L[N];if(j.length>0){var V=j.split("/");R.push(V)}}var U=R[0];for(N=1,I=R.length-1;N<I;N++){var G=R[N],z=R[N+1];m.addFace(U[0],G[0],z[0],U[1],G[1],z[1],U[2],G[2],z[2])}}else if("l"===S){var H=_.substring(1).trim().split(" "),q=[],Z=[];if(-1===_.indexOf("/"))q=H;else for(var X=0,Q=H.length;X<Q;X++){var Y=H[X].split("/");""!==Y[0]&&q.push(Y[0]),""!==Y[1]&&Z.push(Y[1])}m.addLineGeometry(q,Z)}else if("p"===S){var J=_.substr(1).trim().split(" ");m.addPointGeometry(J)}else if(null!==(M=t.exec(_))){var K=(" "+M[0].substr(1).trim()).substr(1);m.startObject(K)}else if(i.test(_))m.object.startMaterial(_.substring(7).trim(),m.materialLibraries);else if(n.test(_))m.materialLibraries.push(_.substring(7).trim());else if(a.test(_))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===S){if((M=_.split(" ")).length>1){var $=M[1].trim().toLowerCase();m.object.smooth="0"!==$&&"off"!==$}else m.object.smooth=!0;(de=m.object.currentMaterial())&&(de.smooth=m.object.smooth)}else{if("\0"===_)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+_+'"')}m.finalize();var ee=new o.Group;if(ee.materialLibraries=[].concat(m.materialLibraries),!0==!(1===m.objects.length&&0===m.objects[0].geometry.vertices.length))for(O=0,A=m.objects.length;O<A;O++){var te=m.objects[O],ne=te.geometry,re=te.materials,ie="Line"===ne.type,oe="Points"===ne.type,ae=!1;if(0!==ne.vertices.length){(ge=new o.BufferGeometry).setAttribute("position",new o.Float32BufferAttribute(ne.vertices,3)),ne.normals.length>0&&ge.setAttribute("normal",new o.Float32BufferAttribute(ne.normals,3)),ne.colors.length>0&&(ae=!0,ge.setAttribute("color",new o.Float32BufferAttribute(ne.colors,3))),!0===ne.hasUVIndices&&ge.setAttribute("uv",new o.Float32BufferAttribute(ne.uvs,2));for(var se,ce=[],ue=0,le=re.length;ue<le;ue++){var he=(me=re[ue]).name+"_"+me.smooth+"_"+ae,de=m.materials[he];if(null!==this.materials)if(de=this.materials.create(me.name),!ie||!de||de instanceof o.LineBasicMaterial){if(oe&&de&&!(de instanceof o.PointsMaterial)){var pe=new o.PointsMaterial({size:10,sizeAttenuation:!1});o.Material.prototype.copy.call(pe,de),pe.color.copy(de.color),pe.map=de.map,de=pe}}else{var fe=new o.LineBasicMaterial;o.Material.prototype.copy.call(fe,de),fe.color.copy(de.color),de=fe}void 0===de&&((de=ie?new o.LineBasicMaterial:oe?new o.PointsMaterial({size:1,sizeAttenuation:!1}):new o.MeshPhongMaterial).name=me.name,de.flatShading=!me.smooth,de.vertexColors=ae,m.materials[he]=de),ce.push(de)}if(ce.length>1){for(ue=0,le=re.length;ue<le;ue++){var me=re[ue];ge.addGroup(me.groupStart,me.groupCount,ue)}se=ie?new o.LineSegments(ge,ce):oe?new o.Points(ge,ce):new o.Mesh(ge,ce)}else se=ie?new o.LineSegments(ge,ce[0]):oe?new o.Points(ge,ce[0]):new o.Mesh(ge,ce[0]);se.name=te.name,ee.add(se)}}else if(m.vertices.length>0){var ge;de=new o.PointsMaterial({size:1,sizeAttenuation:!1}),(ge=new o.BufferGeometry).setAttribute("position",new o.Float32BufferAttribute(m.vertices,3)),m.colors.length>0&&void 0!==m.colors[0]&&(ge.setAttribute("color",new o.Float32BufferAttribute(m.colors,3)),de.vertexColors=!0);var ye=new o.Points(ge,de);ee.add(ye)}return ee}}),OBJLoader}()},function(t,n,i){"use strict";i.r(n),i.d(n,"MTLLoader",(function(){return MTLLoader}));var o=i(0),MTLLoader=function(t){o.Loader.call(this,t)};MTLLoader.prototype=Object.assign(Object.create(o.Loader.prototype),{constructor:MTLLoader,load:function(t,n,i,a){var s=this,m=""===this.path?o.LoaderUtils.extractUrlBase(t):this.path,g=new o.FileLoader(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(t,(function(i){try{n(s.parse(i,m))}catch(n){a?a(n):console.error(n),s.manager.itemError(t)}}),i,a)},setMaterialOptions:function(t){return this.materialOptions=t,this},parse:function(t,n){for(var i=t.split("\n"),o={},a=/\s+/,s={},m=0;m<i.length;m++){var g=i[m];if(0!==(g=g.trim()).length&&"#"!==g.charAt(0)){var _=g.indexOf(" "),S=_>=0?g.substring(0,_):g;S=S.toLowerCase();var M=_>=0?g.substring(_+1):"";if(M=M.trim(),"newmtl"===S)o={name:M},s[M]=o;else if("ka"===S||"kd"===S||"ks"===S||"ke"===S){var T=M.split(a,3);o[S]=[parseFloat(T[0]),parseFloat(T[1]),parseFloat(T[2])]}else o[S]=M}}var O=new MTLLoader.MaterialCreator(this.resourcePath||n,this.materialOptions);return O.setCrossOrigin(this.crossOrigin),O.setManager(this.manager),O.setMaterials(s),O}}),MTLLoader.MaterialCreator=function(t,n){this.baseUrl=t||"",this.options=n,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:o.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:o.RepeatWrapping},MTLLoader.MaterialCreator.prototype={constructor:MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(t){return this.crossOrigin=t,this},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var n={};for(var i in t){var o=t[i],a={};for(var s in n[i]=a,o){var m=!0,g=o[s],_=s.toLowerCase();switch(_){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(g=[g[0]/255,g[1]/255,g[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===g[0]&&0===g[1]&&0===g[2]&&(m=!1)}m&&(a[_]=g)}}return n},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var n in this.materialsInfo)this.materialsArray[t]=this.create(n),this.nameLookup[n]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var n=this,i=this.materialsInfo[t],a={name:t,side:this.side};function setMapForType(t,i){if(!a[t]){var o=n.getTextureParams(i,a),s=n.loadTexture(function resolveURL(t,n){return"string"!=typeof n||""===n?"":/^https?:\/\//i.test(n)?n:t+n}(n.baseUrl,o.url));s.repeat.copy(o.scale),s.offset.copy(o.offset),s.wrapS=n.wrap,s.wrapT=n.wrap,a[t]=s}}for(var s in i){var m,g=i[s];if(""!==g)switch(s.toLowerCase()){case"kd":a.color=(new o.Color).fromArray(g);break;case"ks":a.specular=(new o.Color).fromArray(g);break;case"ke":a.emissive=(new o.Color).fromArray(g);break;case"map_kd":setMapForType("map",g);break;case"map_ks":setMapForType("specularMap",g);break;case"map_ke":setMapForType("emissiveMap",g);break;case"norm":setMapForType("normalMap",g);break;case"map_bump":case"bump":setMapForType("bumpMap",g);break;case"map_d":setMapForType("alphaMap",g),a.transparent=!0;break;case"ns":a.shininess=parseFloat(g);break;case"d":(m=parseFloat(g))<1&&(a.opacity=m,a.transparent=!0);break;case"tr":m=parseFloat(g),this.options&&this.options.invertTrProperty&&(m=1-m),m>0&&(a.opacity=1-m,a.transparent=!0)}}return this.materials[t]=new o.MeshPhongMaterial(a),this.materials[t]},getTextureParams:function(t,n){var i,a={scale:new o.Vector2(1,1),offset:new o.Vector2(0,0)},s=t.split(/\s+/);return(i=s.indexOf("-bm"))>=0&&(n.bumpScale=parseFloat(s[i+1]),s.splice(i,2)),(i=s.indexOf("-s"))>=0&&(a.scale.set(parseFloat(s[i+1]),parseFloat(s[i+2])),s.splice(i,4)),(i=s.indexOf("-o"))>=0&&(a.offset.set(parseFloat(s[i+1]),parseFloat(s[i+2])),s.splice(i,4)),a.url=s.join(" ").trim(),a},loadTexture:function(t,n,i,a,s){var m,g=void 0!==this.manager?this.manager:o.DefaultLoadingManager,_=g.getHandler(t);return null===_&&(_=new o.TextureLoader(g)),_.setCrossOrigin&&_.setCrossOrigin(this.crossOrigin),m=_.load(t,i,a,s),void 0!==n&&(m.mapping=n),m}}},function(t,n,i){"use strict";i.r(n),i.d(n,"DRACOLoader",(function(){return DRACOLoader}));var o=i(0),DRACOLoader=function(t){o.Loader.call(this,t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};DRACOLoader.prototype=Object.assign(Object.create(o.Loader.prototype),{constructor:DRACOLoader,setDecoderPath:function(t){return this.decoderPath=t,this},setDecoderConfig:function(t){return this.decoderConfig=t,this},setWorkerLimit:function(t){return this.workerLimit=t,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(t,n,i,a){var s=new o.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,t=>{var i={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,i).then(n).catch(a)},i,a)},decodeDracoFile:function(t,n,i,o){var a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(t,a).then(n)},decodeGeometry:function(t,n){for(var i in n.attributeTypes){var o=n.attributeTypes[i];void 0!==o.BYTES_PER_ELEMENT&&(n.attributeTypes[i]=o.name)}var a,s=JSON.stringify(n);if(DRACOLoader.taskCache.has(t)){var m=DRACOLoader.taskCache.get(t);if(m.key===s)return m.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var g=this.workerNextTaskID++,_=t.byteLength,S=this._getWorker(g,_).then(i=>(a=i,new Promise((i,o)=>{a._callbacks[g]={resolve:i,reject:o},a.postMessage({type:"decode",id:g,taskConfig:n,buffer:t},[t])}))).then(t=>this._createGeometry(t.geometry));return S.catch(()=>!0).then(()=>{a&&g&&this._releaseTask(a,g)}),DRACOLoader.taskCache.set(t,{key:s,promise:S}),S},_createGeometry:function(t){var n=new o.BufferGeometry;t.index&&n.setIndex(new o.BufferAttribute(t.index.array,1));for(var i=0;i<t.attributes.length;i++){var a=t.attributes[i],s=a.name,m=a.array,g=a.itemSize;n.setAttribute(s,new o.BufferAttribute(m,g))}return n},_loadLibrary:function(t,n){var i=new o.FileLoader(this.manager);return i.setPath(this.decoderPath),i.setResponseType(n),i.setWithCredentials(this.withCredentials),new Promise((n,o)=>{i.load(t,n,void 0,o)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(n=>{var i=n[0];t||(this.decoderConfig.wasmBinary=n[1]);var o=DRACOLoader.DRACOWorker.toString(),a=["/* draco decoder */",i,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending},_getWorker:function(t,n){return this._initDecoder().then(()=>{var i;return this.workerPool.length<this.workerLimit?((i=new Worker(this.workerSourceURL))._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(t){var n=t.data;switch(n.type){case"decode":i._callbacks[n.id].resolve(n);break;case"error":i._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(i)):this.workerPool.sort((function(t,n){return t._taskLoad>n._taskLoad?-1:1})),(i=this.workerPool[this.workerPool.length-1])._taskCosts[t]=n,i._taskLoad+=n,i})},_releaseTask:function(t,n){t._taskLoad-=t._taskCosts[n],delete t._callbacks[n],delete t._taskCosts[n]},debug:function(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))},dispose:function(){for(var t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}),DRACOLoader.DRACOWorker=function(){var t,n;function decodeAttribute(t,n,i,o,a,s){var m=s.num_components(),g=i.num_points()*m,_=g*a.BYTES_PER_ELEMENT,S=function getDracoDataType(t,n){switch(n){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,a),M=t._malloc(_);n.GetAttributeDataArrayForAllPoints(i,s,S,_,M);var T=new a(t.HEAPF32.buffer,M,g).slice();return t._free(M),{name:o,array:T,itemSize:m}}onmessage=function(i){var o=i.data;switch(o.type){case"init":t=o.decoderConfig,n=new Promise((function(n){t.onModuleLoaded=function(t){n({draco:t})},DracoDecoderModule(t)}));break;case"decode":var a=o.buffer,s=o.taskConfig;n.then(t=>{var n=t.draco,i=new n.Decoder,m=new n.DecoderBuffer;m.Init(new Int8Array(a),a.byteLength);try{var g=function decodeGeometry(t,n,i,o){var a,s,m=o.attributeIDs,g=o.attributeTypes,_=n.GetEncodedGeometryType(i);if(_===t.TRIANGULAR_MESH)a=new t.Mesh,s=n.DecodeBufferToMesh(i,a);else{if(_!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new t.PointCloud,s=n.DecodeBufferToPointCloud(i,a)}if(!s.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var S={index:null,attributes:[]};for(var M in m){var T,O,A=self[g[M]];if(o.useUniqueIDs)O=m[M],T=n.GetAttributeByUniqueId(a,O);else{if(-1===(O=n.GetAttributeId(a,t[m[M]])))continue;T=n.GetAttribute(a,O)}S.attributes.push(decodeAttribute(t,n,a,M,A,T))}return _===t.TRIANGULAR_MESH&&(S.index=function decodeIndex(t,n,i){var o=3*i.num_faces(),a=4*o,s=t._malloc(a);n.GetTrianglesUInt32Array(i,a,s);var m=new Uint32Array(t.HEAPF32.buffer,s,o).slice();return t._free(s),{array:m,itemSize:1}}(t,n,a)),t.destroy(a),S}(n,i,m,s),_=g.attributes.map(t=>t.array.buffer);g.index&&_.push(g.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:g},_)}catch(t){console.error(t),self.postMessage({type:"error",id:o.id,error:t.message})}finally{n.destroy(m),n.destroy(i)}})}}},DRACOLoader.taskCache=new WeakMap,DRACOLoader.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},DRACOLoader.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},DRACOLoader.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},DRACOLoader.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.RGBA=void 0;var s=function(t){function RGBA(n,i,o,a){var s=t.call(this,n,i,o)||this;return s._a=1,s._a=a,s}return a(RGBA,t),Object.defineProperty(RGBA.prototype,"Alpha",{get:function(){return this._a},enumerable:!1,configurable:!0}),RGBA}(i(0).Color);n.RGBA=s},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Subscription=n.filter=void 0;var o=i(18);Object.defineProperty(n,"filter",{enumerable:!0,get:function(){return o.filter}});var a=i(130);Object.defineProperty(n,"Subscription",{enumerable:!0,get:function(){return a.Subscription}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VRControls=n.UserInteractionControlsImpl=n.TransformControls=n.MouseControls=n.InteractableActions=n.ElementControlesManager=n.DollyMouseControls=n.Cursor3D=void 0;var o=i(479);Object.defineProperty(n,"Cursor3D",{enumerable:!0,get:function(){return o.Cursor3D}});var a=i(480);Object.defineProperty(n,"DollyMouseControls",{enumerable:!0,get:function(){return a.DollyMouseControls}});var s=i(273);Object.defineProperty(n,"ElementControlesManager",{enumerable:!0,get:function(){return s.ElementControlesManager}});var m=i(191);n.InteractableActions=m;var g=i(125);Object.defineProperty(n,"MouseControls",{enumerable:!0,get:function(){return g.MouseControls}});var _=i(274);Object.defineProperty(n,"TransformControls",{enumerable:!0,get:function(){return _.TransformControls}});var S=i(190);n.UserInteractionControlsImpl=S;var M=i(189);Object.defineProperty(n,"VRControls",{enumerable:!0,get:function(){return M.VRControls}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Cursor3D=n.Gaze=void 0;var o=i(71),a=i(0),s=function(){function Gaze(t,n,i){this.innerRadiusStart=4e-4,this.outerRadiusStart=.003,this.innerRadiusEnd=.02,this.outerRadiusEnd=.024,this.hoverAnimTime=.15,this.innerRadiusTimer=.028,this.outerRadiusTimer=.04,this.phiSegmentsTimer=3,this.thetaSegmentsTimer=32,this.thetaStartTimer=Math.PI/2,this.selectionTime=1,this.parent=t,this.gazeColor=n,this.selectionTime=i,this.createGaze(),this.createTimer()}return Gaze.prototype.createTimer=function(){this.geometryTimer=new a.RingGeometry(this.innerRadiusTimer,this.outerRadiusTimer,this.thetaSegmentsTimer,this.phiSegmentsTimer,this.thetaStartTimer,Math.PI/2),this.materialTimer=new a.MeshBasicMaterial({color:this.gazeColor,side:a.FrontSide,transparent:!0,depthWrite:!1,depthTest:!1}),this.timerObj=new a.Mesh(this.geometryTimer,this.materialTimer),this.timerObj.renderOrder=9999,this.timerObj.visible=!1,this.timerObj.name="timer",this.parent.add(this.timerObj)},Gaze.prototype.createGaze=function(){this.geometryStart=new a.RingGeometry(this.innerRadiusStart,this.outerRadiusStart,32,3,0,2*Math.PI),this.geometryEnd=new a.RingGeometry(this.innerRadiusEnd,this.outerRadiusEnd,32,3,0,2*Math.PI),this.geometryStart.morphTargets.push({name:"target",vertices:this.geometryEnd.vertices}),this.gazeMaterial=new a.MeshBasicMaterial({color:this.gazeColor,side:a.FrontSide,morphTargets:!0,transparent:!0,depthWrite:!1,depthTest:!1}),this.gazeObj=new a.Mesh(this.geometryStart,this.gazeMaterial),this.gazeObj.renderOrder=9999,this.gazeObj.name="gaze",this.parent.add(this.gazeObj)},Gaze.prototype.enable=function(){this.enabled||(this.gazeObj.visible=!0)},Gaze.prototype.disable=function(){this.enabled&&(this.gazeObj.visible=!1)},Gaze.prototype.startAnimation=function(){this.animateGaze(1),this.timerObj.visible=!0,this.animateTimer()},Gaze.prototype.stopAnimation=function(){this.animateGaze(0,this.hoverAnimTime/2),this.animateTimer(0,0),this.timerObj.visible=!1},Gaze.prototype.animateTimer=function(t,n){void 0===t&&(t=this.selectionTime),void 0===n&&(n=1);var i=this,a={value:n};this.timerTween&&this.timerTween.stop(),this.timerTween=new o.Tween({value:0}).to(a,1e3*t).onUpdate((function(t){i.updateVertices(i.timerObj.geometry,t.value)})).onComplete((function(){i.updateVertices(i.timerObj.geometry,0)})).start()},Gaze.prototype.updateVertices=function(t,n){for(var i=n*(2*Math.PI),o=t.vertices,a=this.innerRadiusTimer,s=(this.outerRadiusTimer-this.innerRadiusTimer)/this.phiSegmentsTimer,m=0,g=0;g<=this.phiSegmentsTimer;g++){for(var _=0;_<=this.thetaSegmentsTimer;_++){var S=o[m],M=this.thetaStartTimer+_/this.thetaSegmentsTimer*i;S.x=a*Math.cos(M),S.y=a*Math.sin(M),m++}a+=s}t.verticesNeedUpdate=!0},Gaze.prototype.animateGaze=function(t,n){void 0===n&&(n=this.hoverAnimTime);var i=this,a={value:t};this.gazeTween&&this.gazeTween.stop(),this.gazeTween=new o.Tween({value:this.gazeObj.morphTargetInfluences[0]}).to(a,1e3*this.hoverAnimTime).onUpdate((function(t){i.gazeObj.morphTargetInfluences[0]=t.value})).start()},Gaze.prototype.destroy=function(){this.gazeMaterial.dispose(),this.geometryStart.dispose(),this.geometryStart=void 0,this.gazeMaterial=void 0,this.gazeObj=void 0},Gaze}();n.Gaze=s;var m=function(){function Cursor3D(t,n){this.enabled=!1,this.colorStart=new a.Color(65526),this.colorEnd=new a.Color(65526),this.deafultZPosition=-500,this.deafultScale=new a.Vector3(500,500,500),this.defaultHoverScale=1.2,this.camera=t,this.selectionTime=n}return Cursor3D.prototype.init=function(){this.parentContainer=new a.Object3D,this.parentContainer.renderOrder=9999,this.parentContainer.name="Cursor3D",this.parentContainer.position.set(0,0,-500),this.parentContainer.scale.set(500,500,500),this.camera.add(this.parentContainer),this.gaze=new s(this.parentContainer,this.colorStart,this.selectionTime)},Cursor3D.prototype.updateCursorPosition=function(t){if(t){var n=new a.Vector3(0,0,0).distanceTo(t);this.parentContainer.position.set(0,0,-n);var i=n*this.defaultHoverScale;this.parentContainer.scale.set(i,i,i)}else this.parentContainer.position.set(0,0,this.deafultZPosition),this.parentContainer.scale.set(this.deafultScale.x,this.deafultScale.y,this.deafultScale.z)},Cursor3D.prototype.startAnimation=function(){this.gaze.startAnimation()},Cursor3D.prototype.stopAnimation=function(){this.gaze.stopAnimation()},Cursor3D.prototype.enable=function(){this.enabled||(this.gaze.enable(),this.enabled=!0)},Cursor3D.prototype.disable=function(){this.enabled&&(this.gaze.disable(),this.enabled=!1)},Cursor3D.prototype.destroy=function(){this.disable(),this.camera.remove(this.parentContainer),this.parentContainer=void 0,this.gaze.destroy()},Cursor3D}();n.Cursor3D=m},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.DollyMouseControls=void 0;var s=i(125),m=i(0),g=function(t){function DollyMouseControls(){return null!==t&&t.apply(this,arguments)||this}return a(DollyMouseControls,t),DollyMouseControls.prototype.detectCollision=function(t,n){var i=t.appManager.currentExperience.renderer?t.appManager.currentExperience.renderer.domElement:void 0,o=t.appManager.cameraControlsRegistry;if(i&&n&&t.targetList&&o.cameraControls){var a;window.TouchEvent&&n instanceof TouchEvent?a=new m.Vector2(n.changedTouches[0].clientX,n.changedTouches[0].clientY):n instanceof MouseEvent&&(a=new m.Vector2(n.clientX,n.clientY));var s=t.GetIntersectsFromController(t.raycaster,o.cameraControls.camera,i,a,Array.from(t.targetList.keys()));if(s.length>0){var g=(s=this.orderHitsByRenderOrder(s))[0].object;if(!g)return;return g===t.focusedElement||(t.focusedElement?(t.triggerUnfocus(t,t.focusedElement),t.focusedElement=g,t.triggerFocus(t,t.focusedElement,s[0].point)):(t.focusedElement=g,t.triggerFocus(t,t.focusedElement,s[0].point))),t.getHitInfoFromIntersection(t,s[0])}t.focusedElement&&t.triggerUnfocus(t,t.focusedElement),t.focusedElement=void 0}},DollyMouseControls.prototype.orderHitsByRenderOrder=function(t){return t.sort((function(t,n){return n.object.renderOrder-t.object.renderOrder}))},DollyMouseControls}(s.MouseControls);n.DollyMouseControls=g},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ChromakeyMaterial=void 0;var o=i(83);n.ChromakeyMaterial=o},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserInteractionControlsRegistry=n.TransitionsRegistry=n.ElementsRegistryImpl=n.CameraControlsRegistryImpl=void 0;var o=i(278);Object.defineProperty(n,"CameraControlsRegistryImpl",{enumerable:!0,get:function(){return o.CameraControlsRegistryImpl}});var a=i(282);Object.defineProperty(n,"ElementsRegistryImpl",{enumerable:!0,get:function(){return a.ElementsRegistryImpl}});var s=i(283);Object.defineProperty(n,"TransitionsRegistry",{enumerable:!0,get:function(){return s.TransitionsRegistry}});var m=i(284);Object.defineProperty(n,"UserInteractionControlsRegistry",{enumerable:!0,get:function(){return m.UserInteractionControlsRegistry}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.OutlineEffect=n.OutlineEffectOptions=n.OutlinePass=void 0;var s=i(0),m=i(150),g=i(484),_=i(67),S=i(485),M=i(126),T=function(t){function OutlinePass(){return null!==t&&t.apply(this,arguments)||this}return a(OutlinePass,t),OutlinePass}(S.OutlinePass);n.OutlinePass=T;var O=function OutlineEffectOptions(){this.edgeStrength=10,this.edgeGlow=1,this.edgeThickness=4,this.pulsePeriod=1,this.visibleEdgeColor="#ffffff",this.hiddenEdgeColor="#ffffff"};n.OutlineEffectOptions=O;var A=function(t){function OutlineEffect(n,i){void 0===i&&(i=new O);var o=t.call(this,n)||this;return o.objectList=new Array,o.options=i,o}return a(OutlineEffect,t),OutlineEffect.prototype.attachObject=function(t){this.objectList.push(t.obj),this.outlinePass.selectedObjects=this.objectList},OutlineEffect.prototype.dettachObject=function(t){this.objectList=this.objectList.filter((function(n){return n!==t.obj})),this.outlinePass.selectedObjects=this.objectList},OutlineEffect.prototype.init=function(){t.prototype.init.call(this);var n=this.appManager.currentExperience.scene,i=this.appManager.cameraControlsRegistry.cameraControls.camera;this.renderPass=new m.RenderPass(n,i),this.composer.addPass(this.renderPass),this.outlinePass=new T(new s.Vector2(window.innerWidth,window.innerHeight),n,i),this.composer.addPass(this.outlinePass),this.outlinePass.edgeStrength=this.options.edgeStrength,this.outlinePass.edgeGlow=this.options.edgeGlow,this.outlinePass.edgeThickness=this.options.edgeThickness,this.outlinePass.pulsePeriod=this.options.pulsePeriod,this.outlinePass.visibleEdgeColor.set(this.options.visibleEdgeColor),this.outlinePass.hiddenEdgeColor.set(this.options.hiddenEdgeColor),this.options.patternTexture&&(this.outlinePass.patternTexture.wrapS=s.RepeatWrapping,this.outlinePass.patternTexture.wrapT=s.RepeatWrapping,this.outlinePass.patternTexture=this.options.patternTexture,this.outlinePass.usePatternTexture=!0),this.effectFXAA=new _.ShaderPass(g.FXAAShader),this.effectFXAA.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight),this.composer.addPass(this.effectFXAA)},OutlineEffect.prototype.start=function(){t.prototype.start.call(this),this.effectFXAA.renderToScreen=!0},OutlineEffect.prototype.stop=function(){t.prototype.stop.call(this),this.effectFXAA.renderToScreen=!1},OutlineEffect.prototype.onResize=function(){t.prototype.onResize.call(this),this.effectFXAA.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight)},OutlineEffect.prototype.destroy=function(){t.prototype.destroy.call(this),delete this.effectFXAA,this.effectFXAA=void 0,delete this.renderPass,this.renderPass=void 0,delete this.outlinePass,this.outlinePass=void 0},OutlineEffect}(M.EffectImpl);n.OutlineEffect=A},function(t,n,i){"use strict";i.r(n),i.d(n,"FXAAShader",(function(){return o}));var o={uniforms:{tDiffuse:{value:null},resolution:{value:new(i(0).Vector2)(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")}},function(t,n,i){"use strict";i.r(n),i.d(n,"OutlinePass",(function(){return OutlinePass}));var o=i(0),a=i(30),s=i(70),OutlinePass=function(t,n,i,m){this.renderScene=n,this.renderCamera=i,this.selectedObjects=void 0!==m?m:[],this.visibleEdgeColor=new o.Color(1,1,1),this.hiddenEdgeColor=new o.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,a.a.call(this),this.resolution=void 0!==t?new o.Vector2(t.x,t.y):new o.Vector2(256,256);var g={minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBAFormat},_=Math.round(this.resolution.x/this.downSampleRatio),S=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new o.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=o.DoubleSide,this.renderTargetMaskBuffer=new o.WebGLRenderTarget(this.resolution.x,this.resolution.y,g),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new o.MeshDepthMaterial,this.depthMaterial.side=o.DoubleSide,this.depthMaterial.depthPacking=o.RGBADepthPacking,this.depthMaterial.blending=o.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=o.DoubleSide,this.prepareMaskMaterial.fragmentShader=function replaceDepthToViewZ(t,n){var i=n.isPerspectiveCamera?"perspective":"orthographic";return t.replace(/DEPTH_TO_VIEW_Z/g,i+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new o.WebGLRenderTarget(this.resolution.x,this.resolution.y,g),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new o.WebGLRenderTarget(_,S,g),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new o.WebGLRenderTarget(_,S,g),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new o.WebGLRenderTarget(Math.round(_/2),Math.round(S/2),g),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new o.WebGLRenderTarget(_,S,g),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new o.WebGLRenderTarget(Math.round(_/2),Math.round(S/2),g),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(_,S),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(_/2),Math.round(S/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===s.CopyShader&&console.error("THREE.OutlinePass relies on CopyShader");var M=s.CopyShader;this.copyUniforms=o.UniformsUtils.clone(M.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new o.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:M.vertexShader,fragmentShader:M.fragmentShader,blending:o.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new o.Color,this.oldClearAlpha=1,this.fsQuad=new a.a.FullScreenQuad(null),this.tempPulseColor1=new o.Color,this.tempPulseColor2=new o.Color,this.textureMatrix=new o.Matrix4};OutlinePass.prototype=Object.assign(Object.create(a.a.prototype),{constructor:OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(t,n){this.renderTargetMaskBuffer.setSize(t,n);var i=Math.round(t/this.downSampleRatio),o=Math.round(n/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,o),this.renderTargetBlurBuffer1.setSize(i,o),this.renderTargetEdgeBuffer1.setSize(i,o),this.separableBlurMaterial1.uniforms.texSize.value.set(i,o),i=Math.round(i/2),o=Math.round(o/2),this.renderTargetBlurBuffer2.setSize(i,o),this.renderTargetEdgeBuffer2.setSize(i,o),this.separableBlurMaterial2.uniforms.texSize.value.set(i,o)},changeVisibilityOfSelectedObjects:function(t){var n=this._visibilityCache;function gatherSelectedMeshesCallBack(i){i.isMesh&&(!0===t?i.visible=n.get(i):(n.set(i,i.visible),i.visible=t))}for(var i=0;i<this.selectedObjects.length;i++)this.selectedObjects[i].traverse(gatherSelectedMeshesCallBack)},changeVisibilityOfNonSelectedObjects:function(t){var n=this._visibilityCache,i=[];function gatherSelectedMeshesCallBack(t){t.isMesh&&i.push(t)}for(var o=0;o<this.selectedObjects.length;o++)this.selectedObjects[o].traverse(gatherSelectedMeshesCallBack);this.renderScene.traverse((function VisibilityChangeCallBack(o){if(o.isMesh||o.isSprite){for(var a=!1,s=0;s<i.length;s++)if(i[s].id===o.id){a=!0;break}if(!1===a){var m=o.visible;!1!==t&&!0!==n.get(o)||(o.visible=t),n.set(o,m)}}else(o.isPoints||o.isLine)&&(!0===t?o.visible=n.get(o):(n.set(o,o.visible),o.visible=t))}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(t,n,i,o,a){if(this.selectedObjects.length>0){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();var s=t.autoClear;t.autoClear=!1,a&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var m=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=m,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var g=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(g),this.tempPulseColor2.multiplyScalar(g)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,a&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(i),this.fsQuad.render(t),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=s}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=i.texture,t.setRenderTarget(null),this.fsQuad.render(t))},getPrepareMaskMaterial:function(){return new o.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new o.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new o.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new o.Vector2(.5,.5)},visibleEdgeColor:{value:new o.Vector3(1,1,1)},hiddenEdgeColor:{value:new o.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(t){return new o.ShaderMaterial({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new o.Vector2(.5,.5)},direction:{value:new o.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new o.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:o.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),OutlinePass.BlurDirectionX=new o.Vector2(1,0),OutlinePass.BlurDirectionY=new o.Vector2(0,1)},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.TAAEffect=void 0;var s=i(126),m=i(70),g=i(586),_=i(150),S=i(67),M=function(t){function TAAEffect(){return null!==t&&t.apply(this,arguments)||this}return a(TAAEffect,t),TAAEffect.prototype.init=function(n){t.prototype.init.call(this);var i=this.appManager.cameraControlsRegistry;n=n||i.cameraControls.camera;var o=this.appManager.currentExperience.scene;this.taaRenderPass=new g.TAARenderPass(o,n,void 0,void 0),this.taaRenderPass.unbiased=!1,this.composer.addPass(this.taaRenderPass),this.renderPass=new _.RenderPass(o,n),this.renderPass.enabled=!1,this.composer.addPass(this.renderPass),this.copyPass=new S.ShaderPass(m.CopyShader),this.copyPass.renderToScreen=!0,this.composer.addPass(this.copyPass)},TAAEffect.prototype.start=function(n){void 0===n&&(n=0),t.prototype.start.call(this),this.taaRenderPass.sampleLevel=n,this.taaRenderPass.accumulate=!0},TAAEffect.prototype.stop=function(){t.prototype.stop.call(this),this.taaRenderPass.accumulate=!1},TAAEffect.prototype.onResize=function(){t.prototype.onResize.call(this);var n=window.innerWidth,i=window.innerHeight,o=this.appManager.currentExperience.renderer.getPixelRatio(),a=Math.floor(n/o)||1,s=Math.floor(i/o)||1;this.composer.setSize(a,s)},TAAEffect}(s.EffectImpl);n.TAAEffect=M},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TransitionEfffectImpl=n.RadialZoomBlurTransition=n.CrossFadeTransition=void 0;var o=i(488);Object.defineProperty(n,"CrossFadeTransition",{enumerable:!0,get:function(){return o.CrossFadeTransition}});var a=i(489);Object.defineProperty(n,"RadialZoomBlurTransition",{enumerable:!0,get:function(){return a.RadialZoomBlurTransition}});var s=i(194);n.TransitionEfffectImpl=s},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CrossFadeTransition=void 0;var g=function(t){function CrossFadeTransition(){return null!==t&&t.apply(this,arguments)||this}return a(CrossFadeTransition,t),CrossFadeTransition.prototype.transition=function(t,n,i,o){return s(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,n.setVisible(!0,i)];case 1:return t.sent(),[2]}}))}))},CrossFadeTransition}(i(194).TransitionEfffectImpl);n.CrossFadeTransition=g},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.RadialZoomBlurTransition=void 0;var g=i(194),_=i(280),S=function(t){function RadialZoomBlurTransition(){return null!==t&&t.apply(this,arguments)||this}return a(RadialZoomBlurTransition,t),RadialZoomBlurTransition.prototype.transition=function(t,n,i,o){return s(this,void 0,void 0,(function(){var t,a,g,S=this;return m(this,(function(M){switch(M.label){case 0:return(t=new _.ZoomBlurEffect(this.appManager)).init(),t.start(),t.update(0),a=[this.animate(t,i)],g=function(){return s(S,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,n.setVisible(!0,i)];case 1:return t.sent(),[2]}}))}))},o&&(g=function(){return s(S,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,n.setVisible(!0,i)];case 1:return t.sent(),[4,o(i)];case 2:return t.sent(),[2]}}))}))}),a.push(g()),[4,Promise.all(a)];case 1:return M.sent(),[4,t.animate(0,i/2)];case 2:return M.sent(),t.destroy(),[2]}}))}))},RadialZoomBlurTransition.prototype.animate=function(t,n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.animate(.1,n/2)];case 1:return i.sent(),[4,t.animate(0,n/2)];case 2:return i.sent(),[2]}}))}))},RadialZoomBlurTransition}(g.TransitionEfffectImpl);n.RadialZoomBlurTransition=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.ColorAdjustmentEffect=void 0;var s=i(582),m=i(491),g=i(150),_=i(126),S=i(0),M=function(t){function ColorAdjustmentEffect(n,i){var o=t.call(this,n)||this;return o.colorAdjustmentEffectOptions=i,o}return a(ColorAdjustmentEffect,t),ColorAdjustmentEffect.prototype.init=function(){t.prototype.init.call(this),this.clock=new S.Clock,this.nodePass=new m.NodePass,this.frame=new s.NodeFrame(void 0),this.screen=new s.ScreenNode,this.hue=new s.FloatNode,this.sataturation=new s.FloatNode(1),this.vibrance=new s.FloatNode,this.brightness=new s.FloatNode(0),this.contrast=new s.FloatNode(1),this.hueNode=new s.ColorAdjustmentNode(this.screen,this.hue,s.ColorAdjustmentNode.HUE),this.satNode=new s.ColorAdjustmentNode(this.hueNode,this.sataturation,s.ColorAdjustmentNode.SATURATION),this.vibranceNode=new s.ColorAdjustmentNode(this.satNode,this.vibrance,s.ColorAdjustmentNode.VIBRANCE),this.brightnessNode=new s.ColorAdjustmentNode(this.vibranceNode,this.brightness,s.ColorAdjustmentNode.BRIGHTNESS),this.contrastNode=new s.ColorAdjustmentNode(this.brightnessNode,this.contrast,s.ColorAdjustmentNode.CONTRAST),this.nodePass.input=this.contrastNode;var n=this.appManager.cameraControlsRegistry;this.composer.addPass(new g.RenderPass(this.appManager.currentExperience.scene,n.cameraControls.camera)),this.composer.addPass(this.nodePass),this.nodePass.needsUpdate=!0,this.setColorAdjustmentEffectOptions()},ColorAdjustmentEffect.prototype.setColorAdjustmentEffectOptions=function(){var t=this.colorAdjustmentEffectOptions;t&&(t.hue&&(this.hue.value=+t.hue),t.sataturation&&(this.sataturation.value=+t.sataturation),t.vibrance&&(this.vibrance.value=+t.vibrance),t.brightness&&(this.brightness.value=+t.brightness),t.contrast&&(this.contrast.value=+t.contrast))},ColorAdjustmentEffect.prototype.start=function(){t.prototype.start.call(this),this.nodePass.renderToScreen=!0},ColorAdjustmentEffect.prototype.stop=function(){t.prototype.stop.call(this),this.nodePass.renderToScreen=!1},ColorAdjustmentEffect.prototype.render=function(){var t=this,n=this.appManager.renderEventManager.subscribe((function(i){if(t.enabled){var o=t.clock.getDelta();t.frame.update(o).updateNode(t.nodePass.material),t.composer.render()}else n.unsubscribe()}))},ColorAdjustmentEffect.prototype.addEditorItems=function(n,i){var o=this;t.prototype.addEditorItems.call(this,n,i);var a={hue:this.hue.value};this.appManager.currentExperience.editor.addNumberMenuItem(n,i,a,"hue",0,2*Math.PI,(function(t){o.hue.value=t}));var s={sataturation:this.sataturation.value};this.appManager.currentExperience.editor.addNumberMenuItem(n,i,s,"sataturation",0,2,(function(t){o.sataturation.value=t}));var m={vibrance:this.vibrance.value};this.appManager.currentExperience.editor.addNumberMenuItem(n,i,m,"vibrance",-1,1,(function(t){o.vibrance.value=t}));var g={brightness:this.brightness.value};this.appManager.currentExperience.editor.addNumberMenuItem(n,i,g,"brightness",0,.5,(function(t){o.brightness.value=t}));var _={contrast:this.contrast.value};this.appManager.currentExperience.editor.addNumberMenuItem(n,i,_,"contrast",0,2,(function(t){o.contrast.value=t}))},ColorAdjustmentEffect}(_.EffectImpl);n.ColorAdjustmentEffect=M},function(t,n,i){"use strict";i.r(n),i.d(n,"NodePass",(function(){return NodePass}));var o=i(0),a=i(67),s=i(21),m=i(113);function NodePass(){a.ShaderPass.call(this),this.name="",this.uuid=o.MathUtils.generateUUID(),this.userData={},this.textureID="renderTexture",this.input=new m.a,this.material=new s.a,this.needsUpdate=!0}NodePass.prototype=Object.create(a.ShaderPass.prototype),NodePass.prototype.constructor=NodePass,NodePass.prototype.render=function(){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.input,this.needsUpdate=!1),this.uniforms=this.material.uniforms,a.ShaderPass.prototype.render.apply(this,arguments)},NodePass.prototype.copy=function(t){return this.input=t.input,this},NodePass.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.passes&&(t.passes={}),!t.passes[this.uuid]){var n={};n.uuid=this.uuid,n.type="NodePass",t.passes[this.uuid]=n,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.input=this.input.toJSON(t).uuid}return t.pass=this.uuid,t}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ZoomShader=void 0;var o=i(281);Object.defineProperty(n,"ZoomShader",{enumerable:!0,get:function(){return o.ZoomShader}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.RotationControls=void 0;var s=i(85),m=i(151),g=function(t){function RotationControls(n,i){var o=new m.ScreenMetadata;return o.position=n.obj.position,o.picture="",t.call(this,o,n,i)||this}return a(RotationControls,t),RotationControls}(s.ScreenImage);n.RotationControls=g},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenFactory=void 0;var g=i(51),_=i(102),S=i(290),M=i(22),T=i(36),O=function(t){function ScreenFactory(n){return t.call(this,n)||this}return a(ScreenFactory,t),ScreenFactory.prototype.init=function(){},ScreenFactory.prototype.predicate=function(t){return t&&"screen"===t.ElementName&&this.checkValidScreen(t)},ScreenFactory.prototype.checkValidScreen=function(t){return!!(t.thumb||t.medium||t.picture)},ScreenFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){var o;return m(this,(function(a){switch(t instanceof _.ScreenMetadata||(t.ElementName&&delete t.ElementName,t=T.plainToClass(_.ScreenMetadata,t)),t.type){case"video":return[2,new S.Screens.ScreenVideo(t,n,i)];case"navigation":return[2,new S.Screens.ScreenNavigation(t,n,i)];case"open_url":return[2,new S.Screens.ScreenUrl(t,n,i)];case"photo":return"teleport"===t.grow_type?[2,new S.Screens.ScreenTeleport(t,n,i)]:(o=t.getCustomAttribute(M.CustomAttributes.Bullet))?[2,new S.Screens.ScreenBulletImage.ScreenBulletImage(o,t,n,i)]:[2,new S.Screens.ScreenImage(t,n,i)];default:return[2,new S.Screens.ScreenImage(t,n,i)]}return[2]}))}))},ScreenFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},ScreenFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},ScreenFactory}(g.ByondBaseElementFactoryImpl);n.ScreenFactory=O},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CubemapBackgroundImage=void 0;var g=i(0),_=i(497),S=i(77),M=i(195),T=i(10),O=i(188),A=i(22),P=i(180),L=function(t){function CubemapBackgroundImage(n,i){var o=t.call(this,n,i)||this;return o.obj=new _.MultiResCube(o.appManager,o),o.material=o.obj.materials,o}return a(CubemapBackgroundImage,t),CubemapBackgroundImage.prototype.init=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this)];case 1:return i.sent(),n=g.MathUtils.degToRad((this.getMetadata().background_rotation||0)+180),this.obj.rotateY(n),[4,this.loadPreview()];case 2:return i.sent(),this.loadCubemap(),[2]}}))}))},CubemapBackgroundImage.prototype.setAlpha=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return this.obj.materials.forEach((function(t){return t.transparent=!0})),[4,t.prototype.setAlpha.call(this,n,i)];case 1:return o.sent(),this.obj.materials.forEach((function(t){return t.transparent=!1})),[2]}}))}))},CubemapBackgroundImage.prototype.loadCubemap=function(){return s(this,void 0,void 0,(function(){var t,n;return m(this,(function(i){switch(i.label){case 0:switch(n=this.metadata.getCustomAttribute(A.CustomAttributes.Background),this.cubeType=n?n.cube_type:void 0,this.cubeType){case"face":return[3,1];case"vertical":return[3,2];case"cross":return[3,4]}return[3,4];case 1:return n.urls?t=this.getFaceTextures(n.urls):n&&(t=this.getFaceTexturesFromRelativePath(n.path,n.format)),[3,6];case 2:return[4,O.MediaUtils.getCubeTexturesFromVerticalImage(this.getMetadata().bg)];case 3:return t=i.sent(),[3,6];case 4:return[4,O.MediaUtils.getCubeTexturesFromCrossImage(this.getMetadata().bg)];case 5:return t=i.sent(),[3,6];case 6:return t?[4,this.obj.setTextures(t)]:[3,8];case 7:return i.sent(),this.setState(new T.LoadedEvent),[3,9];case 8:this.setState(new T.ErrEvent),i.label=9;case 9:return[2]}}))}))},CubemapBackgroundImage.prototype.loadPreview=function(){return s(this,void 0,void 0,(function(){var t,n,i,o;return m(this,(function(a){switch(a.label){case 0:if(t=this.metadata.getCustomAttribute(A.CustomAttributes.Background),!(n=t?t.preview:void 0)||!n.url)return[2];switch((i=n.url)===A.CustomAttributes.Values.EnvMap.FromSource&&(i=this.getPreviewRelativePath()),this.previceCubeType=n.cube_type,this.previceCubeType){case"face":return[3,1];case"vertical":return[3,2];case"cross":return[3,4]}return[3,4];case 1:return t.urls?o=this.getFaceTextures(t.urls):t&&(o=this.getFaceTexturesFromRelativePath(t.path,t.format)),[3,6];case 2:return[4,O.MediaUtils.getCubeTexturesFromVerticalImage(i)];case 3:return o=a.sent(),[3,6];case 4:return[4,O.MediaUtils.getCubeTexturesFromCrossImage(i)];case 5:return o=a.sent(),[3,6];case 6:return o?[4,this.obj.setTextures(o,!1)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[2]}}))}))},CubemapBackgroundImage.prototype.getFaceTexturesFromRelativePath=function(t,n){var i=this;if(void 0===n&&(n="jpg"),t===A.CustomAttributes.Values.EnvMap.FromSource){var o=this.getRelativePath();t=o+"/faces/"}var a=[],s=this.appManager.currentExperience.renderer.getMaxAnisotropy();return["px","nx","py","ny","pz","nz"].forEach((function(o){var m=t+o+"."+n;a.push((function(){return new S.Image(i.appManager,{url:m,magFilter:g.LinearFilter,minFilter:g.LinearFilter,anisotropy:s,optimizerWidth:i.getCustomAttribute(A.CustomAttributes.OptimizationWidth,!0)}).Load()}))})),a},CubemapBackgroundImage.prototype.getPreviewRelativePath=function(){var t=this.getMetadata().bg,n=P.extname(t);return this.getRelativePath()+"/preview"+n},CubemapBackgroundImage.prototype.getRelativePath=function(){var t=this.getMetadata().bg,n=P.basename(t).split(".")[0];return P.dirname(t)+"/"+n},CubemapBackgroundImage.prototype.getFaceTextures=function(t){var n=this;return["px","nx","py","ny","pz","nz"].map((function(i){return function(){return new S.Image(n.appManager,{url:t[i],minFilter:g.NearestFilter,generateMipmaps:!1,optimizerWidth:n.getCustomAttribute(A.CustomAttributes.OptimizationWidth,!0)}).Load()}}))},CubemapBackgroundImage.prototype.applyTextureToFace=function(t,n){return s(this,void 0,void 0,(function(){var i;return m(this,(function(o){switch(o.label){case 0:return[4,t];case 1:return i=o.sent(),this.material[n].map=i,this.material[n].needsUpdate=!0,[2]}}))}))},CubemapBackgroundImage.prototype.getMetadata=function(){return this.metadata},CubemapBackgroundImage.prototype.destroy=function(){this.obj&&this.obj.distroy(),t.prototype.destroy.call(this)},CubemapBackgroundImage}(M.CubemapBackground);n.CubemapBackgroundImage=L},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.MultiResCube=void 0;var g=i(498),_=i(99),S=function(t){function MultiResCube(n,i){var o=t.call(this)||this;return o.started=!1,o.resState={0:0,1:0,2:0,3:0,4:0,5:0},o.destroyed=!1,o.appManager=n,o.element=i,o.materials=o.children.map((function(t){return t.material})),o}return a(MultiResCube,t),MultiResCube.prototype.enableFaceResSwitch=function(t,n){this.resState[t]=n?0:-1},MultiResCube.prototype.setTextures=function(t,n){return void 0===n&&(n=!0),s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return n?this.hightResTextureFunctions=t:this.lowResTextureFunctions=t,this.lowResTextureFunctions?this.hightResTextureFunctions?[4,this.startHightLowSwitch()]:[3,2]:[3,5];case 1:return i.sent(),[3,4];case 2:return[4,this.setMaterials(this.lowResTextureFunctions)];case 3:i.sent(),i.label=4;case 4:return[3,7];case 5:return this.hightResTextureFunctions?[4,this.setMaterials(this.hightResTextureFunctions)]:[3,7];case 6:i.sent(),i.label=7;case 7:return[2]}}))}))},MultiResCube.prototype.startHightLowSwitch=function(){return s(this,void 0,void 0,(function(){return m(this,(function(t){return this.started||(this.started=!0,this.subscription=this.appManager.renderEventManager.subscribe(this.testRes.bind(this))),[2]}))}))},MultiResCube.prototype.testRes=function(){return s(this,void 0,void 0,(function(){var t,n,i=this;return m(this,(function(o){switch(o.label){case 0:return t=this.appManager.cameraControlsRegistry,n=t.cameraControls,[4,this.getBoxs()];case 1:return o.sent().forEach((function(t,o){var a=n.isObjectVisible(t);a&&0===i.resState[o]&&(i.setMaterial(i.hightResTextureFunctions[o],o),i.resState[o]=1),a||1!==i.resState[o]||(i.setMaterial(i.lowResTextureFunctions[o],o),i.resState[o]=0)})),[2]}}))}))},MultiResCube.prototype.setMaterials=function(t){return s(this,void 0,void 0,(function(){var n,i=this;return m(this,(function(o){switch(o.label){case 0:return n=[],t.forEach((function(t,o){n.push(i.setMaterial(t,o))})),[4,Promise.all(n)];case 1:return o.sent(),[2]}}))}))},MultiResCube.prototype.setMaterial=function(t,n,i){return void 0===i&&(i=!1),s(this,void 0,void 0,(function(){var o,a;return m(this,(function(s){switch(s.label){case 0:return i||this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this.appManager.currentExperience.currentZone),[4,t()];case 1:return o=s.sent(),this.destroyed?(i?_.Utils.emitRender(this.appManager,this.element):this.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(this.appManager.currentExperience.currentZone),[2]):((a=this.materials[n]).map&&(a.map.dispose(),a.map=null),a.map=o,a.needsUpdate=!0,i?_.Utils.emitRender(this.appManager,this.element):this.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(this.appManager.currentExperience.currentZone),[2])}}))}))},MultiResCube.prototype.setMaterialTransparency=function(t,n){this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this.appManager.currentExperience.currentZone),this.materials[t].transparent=n,this.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(this.appManager.currentExperience.currentZone)},MultiResCube.prototype.setMaterialVisibility=function(t,n){this.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(this.appManager.currentExperience.currentZone),this.materials[t].visible=n,this.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(this.appManager.currentExperience.currentZone)},MultiResCube.prototype.distroy=function(){this.subscription&&this.subscription.unsubscribe(),this.materials.forEach((function(t){t.map&&(t.map.dispose(),t.map=null)})),this.materials=void 0,this.hightResTextureFunctions=void 0,this.lowResTextureFunctions=void 0,this.destroyed=!0},MultiResCube}(g.CubeGroup);n.MultiResCube=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CubeGroup=void 0;var g=i(0),_=i(17),S=function(t){function CubeGroup(){var n=t.call(this)||this;n.faceSize=200,n.faceDistance=n.faceSize/2,n.childRenderOrder=-9999999;var i=new g.MeshBasicMaterial({transparent:!1,opacity:0,depthWrite:!1,depthTest:!1,side:g.FrontSide}),o=new g.PlaneBufferGeometry(n.faceSize,n.faceSize,4,4);i=i.clone();var a=new g.Mesh(o,i);a.name="px",a.position.set(-n.faceDistance,0,0),a.lookAt(0,0,0),n.add(a),i=i.clone();var s=new g.Mesh(o,i);s.name="nx",s.position.set(n.faceDistance,0,0),s.lookAt(0,0,0),n.add(s),i=i.clone();var m=new g.Mesh(o,i);m.name="py",m.position.set(0,n.faceDistance,0),m.lookAt(0,0,0),m.rotateZ(Math.PI),n.add(m),i=i.clone();var _=new g.Mesh(o,i);_.name="ny",_.position.set(0,-n.faceDistance,0),_.lookAt(0,0,0),_.rotateZ(Math.PI),n.add(_),i=i.clone();var S=new g.Mesh(o,i);S.name="pz",S.position.set(0,0,n.faceDistance),S.lookAt(0,0,0),n.add(S),i=i.clone();var M=new g.Mesh(o,i);return M.name="nz",M.position.set(0,0,-n.faceDistance),M.lookAt(0,0,0),n.add(M),n.children.forEach((function(t){return t.renderOrder=n.childRenderOrder})),n}return a(CubeGroup,t),CubeGroup.prototype.getBoxs=function(){return s(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return this._boxs?[2,this._boxs]:[4,_.Utils.sleep(1)];case 1:return t.sent(),this._boxs=this.children.map((function(t){return _.Utils.SetBoxFromObj(new g.Box3,t)})),[2,this._boxs]}}))}))},CubeGroup}(g.Group);n.CubeGroup=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CubemapBackgroundVideo=void 0;var g=i(0),_=i(195),S=i(10),M=i(149),T=i(22),O=i(147),A=function(t){function CubemapBackgroundVideo(n,i){var o=t.call(this,n,i)||this;return o.material=new g.MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1,depthTest:!1,side:g.FrontSide}),o}return a(CubemapBackgroundVideo,t),CubemapBackgroundVideo.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o,a,s=this;return m(this,(function(m){switch(m.label){case 0:return[4,M.ModelsUtils.LoadObjectJsonModel("https://webxr-apps.byondxr.com/assets/models/cube3x2.json")];case 1:return n=m.sent(),this.obj=n.children[0],[4,t.prototype.init.call(this)];case 2:return m.sent(),i=g.MathUtils.degToRad(this.getMetadata().background_rotation||0),this.obj.rotateY(-Math.PI/2+i),o=!0,a=!0,"no"===this.appManager.currentExperience.currentZone.getCustomAttribute(T.CustomAttributes.BackgroundVideoAutoplay)&&(o=!1),"no"===this.appManager.currentExperience.currentZone.getCustomAttribute(T.CustomAttributes.BackgroundVideoLoop)&&(a=!1),[2,new Promise((function(t,n){var i={url:s.getMetadata().bg,loop:a,preload:!0,autoplay:o,muted:!0,minFilter:g.NearestFilter};s.video=new O.Video(i);var m=s;s.video.OnStateChanged.subscribe((function(n,i){switch(i){case O.VideoStatus.Ended:s.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(s);break;case O.VideoStatus.Ready:s.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(s),s.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(s);break;case O.VideoStatus.Playing:s.appManager.cameraControlsRegistry.cameraControls.renderManager.registerRenderElement(s);break;case O.VideoStatus.Paused:case O.VideoStatus.Stoped:case O.VideoStatus.Unloaded:s.appManager.cameraControlsRegistry.cameraControls.renderManager.unregisterRenderElement(s)}m.setState(new S.LoadedEvent),t()}));var _=s.video.Load();_?(s.material.map=_,s.material.needsUpdate=!0):(s.setState(new S.ErrEvent),n())}))]}}))}))},CubemapBackgroundVideo.prototype.activateElement=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(n){return t.video.IsMuted&&t.video.Unmute(),[2]}))}))},CubemapBackgroundVideo.prototype.destroy=function(){t.prototype.destroy.call(this),this.video.Dispose()},CubemapBackgroundVideo.prototype.getMetadata=function(){return this.metadata},CubemapBackgroundVideo}(_.CubemapBackground);n.CubemapBackgroundVideo=A},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EquirectangularBackgroundVideoStereo=void 0;var g=i(0),_=i(127),S=i(291),M=function(t){function EquirectangularBackgroundVideoStereo(n,i){var o=t.call(this,n,i)||this;return o.leftObj=o.attachElement(new S.EquirectangularBackgroundVideo(n,o)),o.RightObj=o.attachElement(new S.EquirectangularBackgroundVideo(n,o)),o}return a(EquirectangularBackgroundVideoStereo,t),EquirectangularBackgroundVideoStereo.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[4,Promise.all([this.leftObj.init(),this.RightObj.init()])];case 2:return n.sent(),[4,Promise.all([this.leftObj.setRotation(new g.Euler(0,0,0)),this.leftObj.setScale(new g.Vector3(1,1,1)),this.RightObj.setRotation(new g.Euler(0,0,0)),this.RightObj.setScale(new g.Vector3(1,1,1))])];case 3:return n.sent(),this.leftObj.obj.name="EquirectangularBackgroundVideoStereoLeft",this.leftObj.material.map.offset=new g.Vector2(0,.5),this.leftObj.material.map.repeat=new g.Vector2(1,.5),this.leftObj.material.needsUpdate=!0,this.RightObj.obj.name="EquirectangularBackgroundVideoStereoRight",this.RightObj.material.map.offset=new g.Vector2(0,0),this.RightObj.material.map.repeat=new g.Vector2(1,.5),this.RightObj.material.needsUpdate=!0,this.RightObj.obj.layers.set(2),[2]}}))}))},EquirectangularBackgroundVideoStereo.prototype.setEnabled=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.setEnabled.call(this,n)];case 1:return i.sent(),[4,this.RightObj.setEnabled(n)];case 2:return i.sent(),[4,this.leftObj.setEnabled(n)];case 3:return i.sent(),[2]}}))}))},EquirectangularBackgroundVideoStereo.prototype.setVisible=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.setVisible.call(this,n,i)];case 1:return o.sent(),[4,this.RightObj.setVisible(n,i)];case 2:return o.sent(),[4,this.leftObj.setVisible(n,i)];case 3:return o.sent(),[2]}}))}))},EquirectangularBackgroundVideoStereo.prototype.setAlpha=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.setAlpha.call(this,n,i)];case 1:return o.sent(),[4,this.RightObj.setAlpha(n,i)];case 2:return o.sent(),[4,this.leftObj.setAlpha(n,i)];case 3:return o.sent(),[2]}}))}))},EquirectangularBackgroundVideoStereo.prototype.setColor=function(n,i){return void 0===n&&(n="#ffffff"),void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.setColor.call(this,n,i)];case 1:return o.sent(),[4,this.RightObj.setColor(n,i)];case 2:return o.sent(),[4,this.leftObj.setColor(n,i)];case 3:return o.sent(),[2]}}))}))},EquirectangularBackgroundVideoStereo.prototype.destroy=function(){t.prototype.destroy.call(this),this.leftObj.destroy(),this.RightObj.destroy()},EquirectangularBackgroundVideoStereo}(_.EquirectangularBackground);n.EquirectangularBackgroundVideoStereo=M},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EquirectangularBackgroundImageStereo=void 0;var g=i(0),_=i(127),S=i(292),M=function(t){function EquirectangularBackgroundImageStereo(n,i){var o=t.call(this,n,i)||this;return o.leftObj=o.attachElement(new S.EquirectangularBackgroundImage(n,o)),o.RightObj=o.attachElement(new S.EquirectangularBackgroundImage(n,o)),o}return a(EquirectangularBackgroundImageStereo,t),EquirectangularBackgroundImageStereo.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[4,Promise.all([this.leftObj.init(),this.RightObj.init()])];case 2:return n.sent(),[4,Promise.all([this.leftObj.setRotation(new g.Euler(0,0,0)),this.leftObj.setScale(new g.Vector3(1,1,1)),this.RightObj.setRotation(new g.Euler(0,0,0)),this.RightObj.setScale(new g.Vector3(1,1,1))])];case 3:return n.sent(),this.leftObj.obj.name="EquirectangularBackgroundImageStereoLeft",this.leftObj.material.map.offset=new g.Vector2(0,.5),this.leftObj.material.map.repeat=new g.Vector2(1,.5),this.leftObj.material.needsUpdate=!0,this.RightObj.obj.name="EquirectangularBackgroundImageStereoRight",this.RightObj.material.map.offset=new g.Vector2(0,0),this.RightObj.material.map.repeat=new g.Vector2(1,.5),this.RightObj.material.needsUpdate=!0,this.RightObj.obj.layers.set(2),[2]}}))}))},EquirectangularBackgroundImageStereo.prototype.setEnabled=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.setEnabled.call(this,n)];case 1:return i.sent(),[4,Promise.all([this.RightObj.setEnabled(n),this.leftObj.setEnabled(n)])];case 2:return i.sent(),[2]}}))}))},EquirectangularBackgroundImageStereo.prototype.setVisible=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.setVisible.call(this,n,i)];case 1:return o.sent(),[4,Promise.all([this.RightObj.setVisible(n,i),this.leftObj.setVisible(n,i)])];case 2:return o.sent(),[2]}}))}))},EquirectangularBackgroundImageStereo.prototype.setAlpha=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.setAlpha.call(this,n,i)];case 1:return o.sent(),[4,Promise.all([this.RightObj.setAlpha(n,i),this.leftObj.setAlpha(n,i)])];case 2:return o.sent(),[2]}}))}))},EquirectangularBackgroundImageStereo.prototype.setColor=function(n,i){return void 0===n&&(n="#ffffff"),void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.setColor.call(this,n,i)];case 1:return o.sent(),[4,Promise.all([this.RightObj.setColor(n,i),this.leftObj.setColor(n,i)])];case 2:return o.sent(),[2]}}))}))},EquirectangularBackgroundImageStereo}(_.EquirectangularBackground);n.EquirectangularBackgroundImageStereo=M},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransparentBackground=void 0;var g=i(196),_=i(0),S=i(22),M=i(73),T=function(t){function TransparentBackground(){var n=null!==t&&t.apply(this,arguments)||this;return n.material=new _.MeshBasicMaterial({visible:!1}),n}return a(TransparentBackground,t),TransparentBackground.prototype.init=function(){return s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this)];case 1:return i.sent(),this.obj.visible=!1,(n=this.metadata.getCustomAttribute(S.CustomAttributes.Background))&&n.css&&n.class?(this.backgroundinfo=n,[4,M.JsUtils.injectCssFile(this.backgroundinfo.css)]):[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},TransparentBackground.prototype.setVisible=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){return m(this,(function(n){return this.backgroundinfo?(t?this.appManager.currentExperience.renderer.domElement.classList.add(this.backgroundinfo.class):this.appManager.currentExperience.renderer.domElement.classList.remove(this.backgroundinfo.class),[2]):[2]}))}))},TransparentBackground.prototype.setEnabled=function(t){},TransparentBackground.prototype.destroy=function(){t.prototype.destroy.call(this),this.appManager.currentExperience.renderer.domElement.classList.remove(this.backgroundinfo.class)},TransparentBackground}(g.BackgroundImpl);n.TransparentBackground=T},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CanvasElementMetadata=n.CanvasInteractiveElement=void 0;var o=i(293);Object.defineProperty(n,"CanvasInteractiveElement",{enumerable:!0,get:function(){return o.CanvasInteractiveElement}});var a=i(504);Object.defineProperty(n,"CanvasElementMetadata",{enumerable:!0,get:function(){return a.CanvasElementMetadata}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.CanvasElementMetadata=void 0;var s=function(t){function CanvasElementMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(CanvasElementMetadata,t),Object.defineProperty(CanvasElementMetadata.prototype,"ElementName",{get:function(){return"canvasElement"},enumerable:!1,configurable:!0}),CanvasElementMetadata}(i(32).Metadata.Element3DMetadata);n.CanvasElementMetadata=s},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BaseExperienceManager=n.ExperienceManager=void 0;var o=i(506);Object.defineProperty(n,"ExperienceManager",{enumerable:!0,get:function(){return o.ExperienceManager}});var a=i(302);Object.defineProperty(n,"BaseExperienceManager",{enumerable:!0,get:function(){return a.BaseExperienceManager}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ExperienceManager=void 0;var g=i(56),_=i(296),S=i(10),M=i(34),T=i(128),O=i(297),A=i(300),P=i(513),L=i(50),R=i(144),N=i(302),I=i(18),j=i(36),V=i(0),U=i(82),G=function(t){function ExperienceManager(n,i,o){var a=t.call(this,n,i,o)||this;return a.subscriptions.push(a.appManager.eventManager.pipe(I.filter((function(t){return(t.eventType.name===(new S.NavigateEvent).name||t.eventType===S.NavigateEvent)&&t.message&&t.message.targetZone}))).subscribe((function(t){a.navigate(t.message.targetZone)}))),a}return a(ExperienceManager,t),ExperienceManager.prototype.init=function(){return s(this,void 0,void 0,(function(){var n,i,o;return m(this,(function(a){switch(a.label){case 0:return this.createTransitionLoader(this.getCustomAttribute(g.Core.CustomAttributes.EXPERIENCE_LOADER),this.getCustomAttribute(g.Core.CustomAttributes.EXPERIENCE_LOADER_OPACITY)),[4,t.prototype.init.call(this)];case 1:return a.sent(),n=this.getCustomAttribute(g.Core.CustomAttributes.UserHeight),i=this.getCustomAttribute(g.Core.CustomAttributes.FloorLevel)||0,n&&(this.cameraHeight=i+n,this.appManager.cameraControlsRegistry.cameraControls.setCameraHeight(this.cameraHeight)),(o=this.getCustomAttribute(g.Core.CustomAttributes.GAID))&&this.appManager.analytics.config(o),this.afterExperienceInit(),this.appManager.eventManager.next(new M.EventMessage(this,new U.EventTypes.ExperienceLoadedEvent),!0),[2]}}))}))},ExperienceManager.prototype.deserialize=function(t){return j.deserialize(g.Core.Metadata.ExperienceMetadata,t)},ExperienceManager.prototype.exportMetadata=function(t){var n=JSON.stringify(this.getMetadata()),i=j.deserialize(g.Core.Metadata.ExperienceMetadata,n),o=JSON.stringify(i,null,2);return t&&g.Utils.Utils.saveString(o,t),o},ExperienceManager.prototype.createTransitionLoader=function(t,n){if(t){var i=P+"";i=i.replace("{{src}}",t),this.transitionLoaderDiv=g.Utils.Utils.string2HtmlElement(i),n&&(this.transitionLoaderDiv.style.opacity=n),this.appManager.container.appendChild(this.transitionLoaderDiv)}},ExperienceManager.prototype.navigate=function(t){return s(this,void 0,void 0,(function(){var n,i,o,a,s;return m(this,(function(m){switch(m.label){case 0:if(n=[],this.appManager.eventManager.next(new M.EventMessage(this,new S.ZoneChangeStartedEvent,{from:this.currentZoneIndex,to:t}),!0),this.currentZone&&(this.currentZone.destroy(),this.userInteractionControlsRegistry.Reset()),g.Utils.MediaUtils.CleanCache(),this.metadata){if(!(i=this.getMetadata())||!i.locations||!i.locations)return console.warn("Warning: This experience does not exists"),R.Notify.Send("warning","This experience does not exists","warning"),[2];this.transitionLoaderDiv||this.createTransitionLoader(this.getCustomAttribute(g.Core.CustomAttributes.ZONE_LOADER),this.getCustomAttribute(g.Core.CustomAttributes.ZONE_LOADER_OPACITY)),o=i.locations[+t],this.currentZone&&delete this.currentZone,a=void 0,(s=o.getCustomAttribute(g.Core.CustomAttributes.ZoneType))&&s===g.Core.CustomAttributes.Values.ZoneType.AR?(a=new A.ARZoneManager(o,this),this.backgroundManager.currentBackground&&(this.backgroundManager.currentBackground.obj.visible=!1),this.currentZone=a,n.push(this.initAndEnableZone(this.currentZone))):o.zone_type&&"ar"===o.zone_type?(a=new O.ARMarkerZoneManager(o,this),this.backgroundManager.currentBackground&&(this.backgroundManager.currentBackground.obj.visible=!1),this.currentZone=a,n.push(this.initAndEnableZone(this.currentZone))):(a=new _.ZoneManager(o,this),this.currentZone=a,n.push(this.initAndEnableZone(this.currentZone)),n.push(this.changeBackgroundAndSetCamera(o)))}return n.length?[4,Promise.all(n)]:[3,2];case 1:m.sent(),m.label=2;case 2:return this.appManager.eventManager.next(new M.EventMessage(this,new S.ZoneChangeEndedEvent,{from:this.currentZoneIndex,to:t}),!0),this.currentZoneIndex=t,L.Log.Info("Zone Init Ended",{zone_index:this.currentZoneIndex},{memory:!0}),this.transitionLoaderDiv&&(this.transitionLoaderDiv.remove(),this.transitionLoaderDiv=void 0),[2]}}))}))},ExperienceManager.prototype.changeBackgroundAndSetCamera=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,this.backgroundManager.change(t,this.setCamera.bind(this))];case 1:return n.sent(),[2]}}))}))},ExperienceManager.prototype.setCamera=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,g.Utils.Utils.sleep(t/2)];case 1:return n.sent(),[4,this.setCameraLookAt(this.currentZone.getCustomAttribute(g.Core.CustomAttributes.CameraLookAt),0)];case 2:return n.sent(),this.currentZone.checkDefaultCameraZoom(),[4,this.handleCurrentZoneCamera()];case 3:return n.sent(),[2]}}))}))},ExperienceManager.prototype.handleCurrentZoneCamera=function(t){return void 0===t&&(t=!1),s(this,void 0,void 0,(function(){var n;return m(this,(function(i){switch(i.label){case 0:return n=this.currentZone.getCustomAttribute(T.CameraAttribute),[4,this.handleCameraAttribute(n,t)];case 1:return i.sent(),[2]}}))}))},ExperienceManager.prototype.handleCameraAttribute=function(t,n){var i;return void 0===n&&(n=!1),s(this,void 0,void 0,(function(){var o,a,s,_;return m(this,(function(m){switch(m.label){case 0:return o=this.appManager.cameraControlsRegistry,!n&&o.cameraControls.isVR&&(a=o.cameraControls.vrDisplay),[4,o.GetCamera(t,n,this.appManager)];case 1:return(s=m.sent())[0].constructor.name!==o.cameraControls.constructor.name?[3,3]:(_=null===(i=this.currentZone)||void 0===i?void 0:i.getCustomAttribute(g.Core.CustomAttributes.CameraLookAt),[4,o.cameraControls.setCameraAttr(t,!!_)]);case 2:return m.sent(),[3,5];case 3:return o.Unregister(),o.Register(s[0]),[4,o.Init(this.appManager,void 0,a)];case 4:m.sent(),m.label=5;case 5:return o.Enable(),[2]}}))}))},ExperienceManager.prototype.initAndEnableZone=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.init()];case 1:return n.sent(),t.setEnabled(!0),[2]}}))}))},ExperienceManager.prototype.setCameraLookAt=function(t,n){return void 0===n&&(n=0),s(this,void 0,void 0,(function(){var i,o,a,s,g;return m(this,(function(m){switch(m.label){case 0:return t?(i=this.appManager.cameraControlsRegistry.cameraControls).orbitOptions&&(o=this.currentZone.getElementMetadataByID(t))?[4,this.appManager.elementsRegistry.GetElement(o,this)]:[2]:[3,4];case 1:return(a=m.sent())&&a[0]?[4,(s=a[0]).init()]:[2];case 2:return m.sent(),g=new V.Vector3,g=s.obj.getWorldPosition(g),s.destroy(),i.orbitOptions.target=g,[4,i.animateCamera(i.camera.position,g,!1,n)];case 3:m.sent(),m.label=4;case 4:return[2]}}))}))},ExperienceManager.prototype.getMetadata=function(){return this.metadata},ExperienceManager}(N.BaseExperienceManager);n.ExperienceManager=G},function(t,n,i){var o=i(508);"string"==typeof o&&(o=[[t.i,o,""]]);i(97)(o,{hmr:!0,transform:void 0,insertInto:void 0}),o.locals&&(t.exports=o.locals)},function(t,n,i){(t.exports=i(96)(!1)).push([t.i,".camera_btn {\n  position: absolute;\n  background: url('https://webxr-apps.byondxr.com/assets/images/ar/camera.png') center no-repeat;\n  background-size: 100% 100%;\n  cursor: pointer;\n  text-align: center;\n  right: 10px;\n  bottom: 10px;\n  width: 80px;\n  height: 80px;\n  border: 0px;\n  z-index: 999;\n}\n.camera_btn:focus {\n  outline: none;\n}\n",""])},function(t,n){t.exports="<button class='camera_btn'>\n\n</button>"},function(t,n,i){var o=i(511);"string"==typeof o&&(o=[[t.i,o,""]]);i(97)(o,{hmr:!0,transform:void 0,insertInto:void 0}),o.locals&&(t.exports=o.locals)},function(t,n,i){(t.exports=i(96)(!1)).push([t.i,"#ar_overlay .interactions,\n#ar_overlay .instructions {\n  position: absolute;\n  width: 100%;\n  height: 15%;\n  min-height: 110px;\n  min-width: 360px;\n  text-align: center;\n  opacity: 0.75;\n  background-color: #000000;\n}\n#ar_overlay .instructions .text,\n#ar_overlay .instructions .icon {\n  height: 50%;\n  display: inline-block;\n}\n#ar_overlay .instructions .icon {\n  position: relative;\n  top: 50%;\n  transform: translateY(-50%);\n  margin: 0px;\n  width: auto;\n  margin-right: 10px;\n}\n#ar_overlay .instructions .icon img {\n  height: 100%;\n  width: auto;\n}\n#ar_overlay .instructions .text {\n  position: relative;\n  text-align: left;\n  margin: 0px;\n  vertical-align: middle;\n}\n#ar_overlay .instructions .text span {\n  display: block;\n  color: #ffffff;\n  font-size: 20px;\n  font-weight: 600;\n  line-height: 20px;\n  letter-spacing: 1px;\n  font-family: sans-serif;\n}\n#ar_overlay .interactions .icon img {\n  height: 100%;\n  width: 100%;\n}\n#ar_overlay .interactions .text span {\n  color: #ffffff;\n}\n#ar_overlay .interactions .swipe.text,\n#ar_overlay .interactions .pinch.text,\n#ar_overlay .interactions .swipe.icon,\n#ar_overlay .interactions .pinch.icon {\n  margin-top: 5px;\n  display: inline-block;\n  text-align: left;\n}\n#ar_overlay .interactions .swipe.text {\n  margin-right: 10px;\n}\n#ar_overlay .interactions .swipe.text,\n#ar_overlay .interactions .pinch.text {\n  width: 120px;\n  vertical-align: middle;\n}\n#ar_overlay .interactions .swipe.text span,\n#ar_overlay .interactions .pinch.text span {\n  width: 120px;\n  display: inline-block;\n  font-size: 15px;\n  font-weight: 600;\n  line-height: 15px;\n  letter-spacing: 1px;\n  font-family: sans-serif;\n}\n#ar_overlay .interactions .swipe.icon,\n#ar_overlay .interactions .pinch.icon {\n  width: 10%;\n  height: 30%;\n  vertical-align: middle;\n}\n#ar_overlay .interactions .btn {\n  background-color: #dd2027;\n  width: 136px;\n  color: #ffffff;\n  border-radius: 16px;\n  font-size: 25px;\n  line-height: 25px;\n  font-family: sans-serif;\n  padding: 10px;\n  text-align: center;\n  vertical-align: middle;\n  margin: auto;\n  margin-top: 8px;\n}\n",""])},function(t,n){t.exports='<div class="instructions">\n    <div class="icon">\n        <img />\n    </div>\n    <div class="text">\n        <span>AIM AT THE MARKER</span>\n        <span>HOLD THE CAMERA STILL</span>\n    </div>\n</div>\n<div class="interactions">\n    <div class=\'swipe icon\'>\n        <img src="https://webxr-apps.byondxr.com/assets/images/ar/one_finger.svg" />\n    </div>\n    <div class="swipe text">\n        <span>ONE FINGER</span>\n        <span>TO ROTATE</span>\n    </div>\n    <div class="pinch icon">\n        <img src="https://webxr-apps.byondxr.com/assets/images/ar/two_fingers.svg" />\n    </div>\n    <div class="pinch text">\n        <span>TWO FINGERS</span>\n        <span>TO SCALE</span>\n    </div>\n    <div class=\'btn\'>GOT IT</div>\n</div>'},function(t,n){t.exports='<img id="transition-loader-img" src={{src}} style="max-width: 100vw; height: 100vh; z-index: 9999999; position: absolute; left: 50vw; transform: translateX(-50%);">'},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.PrefetchManager=void 0;var s=i(22),m=i(149),g=i(143),_=function(){function PrefetchManager(t){this.cache=new Array,this.experienceManger=t,this.modelBaseDir=g.v1()+"/"}return PrefetchManager.prototype.prefetch=function(){return o(this,void 0,void 0,(function(){var t,n,i=this;return a(this,(function(o){switch(o.label){case 0:return(t=this.experienceManger.getCustomAttribute(s.CustomAttributes.PREFETCH))?(n=[],t.forEach((function(t){var o={sync:t.sync,type:t.type,url:t.url,promise:null};switch(t.type){case"fbx":o.promise=m.ModelsUtils.LoadFBXModel(i.experienceManger.appManager,t.url);break;case"glb":o.promise=m.ModelsUtils.LoadGltfModel(i.experienceManger.appManager,t.url);break;case"zip":o.promise=m.ModelsUtils.loadZipObj(i.experienceManger.appManager,i.modelBaseDir,t.url)}i.cache.push(o),t.sync&&n.push(o.promise)})),[4,Promise.all(n)]):[2];case 1:return o.sent(),[2]}}))}))},PrefetchManager.prototype.get=function(t,n){var i;return this.cache.forEach((function(o){o.type===n&&o.url===t&&(i=o.promise)})),i},PrefetchManager.prototype.destroy=function(){this.experienceManger=void 0,this.cache=[]},PrefetchManager}();n.PrefetchManager=_},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GridBasedGallery=n.LayeredGallery=n.GalleryImpl=n.GenericGalleryHelix=n.GalleryNavigationButtons=void 0;var o=i(516);n.GalleryNavigationButtons=o;var a=i(198);Object.defineProperty(n,"GenericGalleryHelix",{enumerable:!0,get:function(){return a.GenericGalleryHelix}});var s=i(154);Object.defineProperty(n,"GalleryImpl",{enumerable:!0,get:function(){return s.GalleryImpl}});var m=i(199);Object.defineProperty(n,"LayeredGallery",{enumerable:!0,get:function(){return m.LayeredGallery}});var g=i(156);Object.defineProperty(n,"GridBasedGallery",{enumerable:!0,get:function(){return g.GridBasedGallery}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GalleryNavigationButtons=n.GalleryNavigationButton=void 0;var o=i(304);Object.defineProperty(n,"GalleryNavigationButton",{enumerable:!0,get:function(){return o.GalleryNavigationButton}});var a=i(305);Object.defineProperty(n,"GalleryNavigationButtons",{enumerable:!0,get:function(){return a.GalleryNavigationButtons}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(306);Object.defineProperty(n,"Cell",{enumerable:!0,get:function(){return o.Cell}});var a=i(197);Object.defineProperty(n,"Row",{enumerable:!0,get:function(){return a.Row}});var s=i(308);Object.defineProperty(n,"Table",{enumerable:!0,get:function(){return s.Table}});var m=i(307);Object.defineProperty(n,"Grid",{enumerable:!0,get:function(){return m.Grid}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.HotspotImage=void 0;var g=i(129),_=function(t){function HotspotImage(){return null!==t&&t.apply(this,arguments)||this}return a(HotspotImage,t),HotspotImage.prototype.getPreviewImage=function(){return g.getHotspotPreviewImage(this.getMetadata())},HotspotImage.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},HotspotImage}(i(85).ScreenImage);n.HotspotImage=_},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.HotspotNavigation=void 0;var g=i(200),_=i(129),S=function(t){function HotspotNavigation(){return null!==t&&t.apply(this,arguments)||this}return a(HotspotNavigation,t),HotspotNavigation.prototype.getPreviewImage=function(){return _.getHotspotPreviewImage(this.getMetadata())},HotspotNavigation.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},HotspotNavigation}(g.ScreenNavigation);n.HotspotNavigation=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.HotspotTeleport=void 0;var g=i(310),_=i(129),S=function(t){function HotspotTeleport(){return null!==t&&t.apply(this,arguments)||this}return a(HotspotTeleport,t),HotspotTeleport.prototype.getPreviewImage=function(){return"invisible"===this.getMetadata().model_type&&(this.material.visible=!1),_.getHotspotPreviewImage(this.getMetadata())},HotspotTeleport.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},HotspotTeleport}(g.ScreenTeleport);n.HotspotTeleport=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.HotspotVideo=void 0;var g=i(129),_=function(t){function HotspotVideo(){return null!==t&&t.apply(this,arguments)||this}return a(HotspotVideo,t),HotspotVideo.prototype.getPreviewImage=function(){var t=this.getMetadata();return"invisible"===t.model_type&&(this.material.visible=!1),g.getHotspotPreviewImage(t)},HotspotVideo.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},HotspotVideo.prototype.play=function(n){"invisible"===this.getMetadata().model_type&&(this.material.visible=!0),t.prototype.play.call(this,n)},HotspotVideo.prototype.OnVideoEnded=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(i){return"invisible"===this.getMetadata().model_type&&(this.material.visible=!1),t.prototype.OnVideoEnded.call(this,n),[2]}))}))},HotspotVideo}(i(201).ScreenVideo);n.HotspotVideo=_},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.DirectionalLight=void 0;var s=i(0),m=function(t){function DirectionalLight(){return null!==t&&t.apply(this,arguments)||this}return a(DirectionalLight,t),DirectionalLight.prototype.setLight=function(){var t=this.getMetadata(),n=t.color,i=t.intensity;this.obj=new s.DirectionalLight(n,i)},DirectionalLight}(i(202).TargetLightElementImpl);n.DirectionalLight=m},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.HemisphericLight=void 0;var s=i(0),m=function(t){function HemisphericLight(){return null!==t&&t.apply(this,arguments)||this}return a(HemisphericLight,t),HemisphericLight.prototype.setLight=function(){var t=this.getMetadata(),n=t.color,i=t.ground_color,o=t.intensity;this.obj=new s.HemisphereLight(n,i,o)},HemisphericLight}(i(157).LightElementImpl);n.HemisphericLight=m},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.PointLight=void 0;var s=i(0),m=function(t){function PointLight(){return null!==t&&t.apply(this,arguments)||this}return a(PointLight,t),PointLight.prototype.setLight=function(){var t=this.getMetadata(),n=t.color,i=t.intensity,o=t.distance,a=t.decay;this.obj=new s.PointLight(n,i,o,a)},PointLight}(i(157).LightElementImpl);n.PointLight=m},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.SpotLight=void 0;var s=i(0),m=function(t){function SpotLight(){return null!==t&&t.apply(this,arguments)||this}return a(SpotLight,t),SpotLight.prototype.setLight=function(){var t=this.getMetadata(),n=t.color,i=t.intensity,o=t.distance,a=t.angle,m=t.decay;this.obj=new s.SpotLight(n,i,o,a,void 0,m)},SpotLight}(i(202).TargetLightElementImpl);n.SpotLight=m},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ObJModel=n.MeshVideoScreen=n.MeshNavigationScreen=n.MeshImageScreen=void 0;var o=i(312);Object.defineProperty(n,"MeshImageScreen",{enumerable:!0,get:function(){return o.MeshImageScreen}}),Object.defineProperty(n,"MeshNavigationScreen",{enumerable:!0,get:function(){return o.MeshNavigationScreen}}),Object.defineProperty(n,"MeshVideoScreen",{enumerable:!0,get:function(){return o.MeshVideoScreen}});var a=i(313);Object.defineProperty(n,"ObJModel",{enumerable:!0,get:function(){return a.ObJModel}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenVideo=n.ScreenUrl=n.ScreenTeleport=n.ScreenNavigation=n.ScreenImpl=n.ScreenImage=n.ScreenBulletImage=void 0;var o=i(528);n.ScreenBulletImage=o;var a=i(85);Object.defineProperty(n,"ScreenImage",{enumerable:!0,get:function(){return a.ScreenImage}});var s=i(101);Object.defineProperty(n,"ScreenImpl",{enumerable:!0,get:function(){return s.ScreenImpl}});var m=i(200);Object.defineProperty(n,"ScreenNavigation",{enumerable:!0,get:function(){return m.ScreenNavigation}});var g=i(310);Object.defineProperty(n,"ScreenTeleport",{enumerable:!0,get:function(){return g.ScreenTeleport}});var _=i(529);Object.defineProperty(n,"ScreenUrl",{enumerable:!0,get:function(){return _.ScreenUrl}});var S=i(201);Object.defineProperty(n,"ScreenVideo",{enumerable:!0,get:function(){return S.ScreenVideo}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenBulletImage=void 0;var g=i(85),_=i(0),S=i(77),M=i(83),T=i(17),O=i(18),A=i(10),P=i(22),L=function(t){function ScreenBulletImage(n,i,o,a){var s=t.call(this,i,o,a)||this;if(s.currentNBullet=0,s.bulletImages=[],s.lookAtCamera=!n.preserve_orientation,n.type&&"auto"===n.type)for(var m=n.bullets.length,g=1*(n.coverage||360),_=g/m,S=90-g/2,M=0;M<m;M++)n.bullets[M].angle_start=s.normalizeAngle(S),S+=_,n.bullets[M].angle_end=s.normalizeAngle(S);return n.bullets&&n.bullets.forEach((function(t){t.angle_end&&(t.angle_end=+t.angle_end),t.angle_start&&(t.angle_start=+t.angle_start)})),s.bulletOptions=n,s}return a(ScreenBulletImage,t),ScreenBulletImage.prototype.activateElement=function(t){return s(this,void 0,void 0,(function(){return m(this,(function(t){return[2]}))}))},ScreenBulletImage.prototype.normalizeAngle=function(t){return t>=0&&t<360?t:t<0?t+360:void 0},ScreenBulletImage.prototype.init=function(){return s(this,void 0,void 0,(function(){var n=this;return m(this,(function(i){switch(i.label){case 0:return[4,t.prototype.init.call(this)];case 1:return i.sent(),this.lookAtCamera?(this.calc_obj=this.obj.clone(),this.calc_obj.material=this.obj.material.clone(),this.calc_obj.material.opacity=0,this.calc_obj.name="dummy_of_"+this.calc_obj.name,this.calc_obj.scale.set(1,1,1),this.obj.parent.add(this.calc_obj),this.calc_obj.visible=!1):this.calc_obj=this.obj,this.subscriptions.push(this.appManager.eventManager.pipe(O.filter((function(t){return t.eventType.name===(new A.CameraMoveEvent).name||t.eventType===A.CameraMoveEvent}))).subscribe((function(t){if(n.calc(),n.lookAtCamera){var i=n.appManager.currentExperience.cameraControlsRegistry.cameraControls.camera;n.obj.lookAt(i.position)}}))),this.preloadImages(),[2]}}))}))},ScreenBulletImage.prototype.setVisible=function(n,i){return void 0===i&&(i=0),s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.setVisible.call(this,n,i)];case 1:return o.sent(),[2]}}))}))},ScreenBulletImage.prototype.preloadImages=function(){var t=this;this.bulletOptions.bullets.forEach((function(n){var i=n.url;t.bulletImages.push(t.preloadImage(i))}))},ScreenBulletImage.prototype.preloadImage=function(t){var n=this.appManager.currentExperience.renderer.outputEncoding?_.sRGBEncoding:_.LinearEncoding,i=new S.Image(this.appManager,{url:t,encoding:n,optimizerWidth:this.getCustomAttribute(P.CustomAttributes.OptimizationWidth,!0)});return{image:i,texture:i.Load()}},ScreenBulletImage.prototype.calc=function(){if(this.calc_obj){var t=this.appManager.currentExperience.cameraControlsRegistry.cameraControls.getAngleXFromCamera(this.calc_obj,!0),n=this.getNbullet(t);(n||0===n)&&this.loadBulletNImage(n)}},ScreenBulletImage.prototype.getNbullet=function(t){for(var n=0;n<this.bulletOptions.bullets.length;n++){var i=this.bulletOptions.bullets[n];if(t>i.angle_start&&t<=i.angle_end)return n}},ScreenBulletImage.prototype.loadBulletNImage=function(t){return s(this,void 0,void 0,(function(){var n,i,o;return m(this,(function(a){switch(a.label){case 0:return this.currentNBullet===t?[2]:(this.currentNBullet=t,n=this.bulletImages[t],this.image=n.image,[4,n.texture]);case 1:return i=a.sent(),this.destroyed||(i?(this.material instanceof M.ChromakeyMaterial||(this.material.map=i),this.material.transparent=!0,this.material.needsUpdate=!0,o=T.Utils.GetGeometryRatioFromTexture(i,3.3),this.geometry=new _.PlaneBufferGeometry(o.x,o.y),this.obj.geometry=this.geometry):this.obj.visible=!1),[2]}}))}))},ScreenBulletImage.prototype.destroy=function(){t.prototype.destroy.call(this),this.calc_obj&&this.calc_obj.parent.remove(this.calc_obj)},ScreenBulletImage}(g.ScreenImage);n.ScreenBulletImage=L},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenUrl=void 0;var g=i(277),_=i(99),S=function(t){function ScreenUrl(n,i,o){return t.call(this,n,i,o)||this}return a(ScreenUrl,t),ScreenUrl.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},ScreenUrl.prototype.activateElement=function(){return s(this,void 0,void 0,(function(){var t,n;return m(this,(function(i){return(t=this.getMetadata().open_url)?((n=this.getCustomAttribute(g.CustomAttributes.MobileUrl))&&_.DeviceUtils.IsMobile()&&(t=n),t.startsWith("http://")||t.startsWith("https://")||(t="http://"+t),window.open(t,"_blank"),[2]):[2]}))}))},ScreenUrl}(i(101).ScreenImpl);n.ScreenUrl=S},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneManagerImpl=n.ZoneManager=n.ARZoneManager=n.ARModuleManager=n.ARMarkerZoneManager=void 0;var o=i(297);Object.defineProperty(n,"ARMarkerZoneManager",{enumerable:!0,get:function(){return o.ARMarkerZoneManager}});var a=i(301);Object.defineProperty(n,"ARModuleManager",{enumerable:!0,get:function(){return a.ARModuleManager}});var s=i(300);Object.defineProperty(n,"ARZoneManager",{enumerable:!0,get:function(){return s.ARZoneManager}});var m=i(296);Object.defineProperty(n,"ZoneManager",{enumerable:!0,get:function(){return m.ZoneManager}});var g=i(128);Object.defineProperty(n,"ZoneManagerImpl",{enumerable:!0,get:function(){return g.ZoneManagerImpl}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TextElement=void 0;var g=function(t){function TextElement(n,i,o){return t.call(this,n,i,o)||this}return a(TextElement,t),TextElement.prototype.init=function(){return s(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.prototype.init.call(this)];case 1:return n.sent(),[2]}}))}))},Object.defineProperty(TextElement.prototype,"Text",{get:function(){return this.text},set:function(t){this.text=t},enumerable:!1,configurable:!0}),Object.defineProperty(TextElement.prototype,"Font",{get:function(){return this.font},set:function(t){this.font=t},enumerable:!1,configurable:!0}),Object.defineProperty(TextElement.prototype,"ForeColor",{get:function(){return this.foreColor},set:function(t){this.foreColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(TextElement.prototype,"BackgroundColor",{get:function(){return this.backgroundColor},set:function(t){this.backgroundColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(TextElement.prototype,"Bold",{get:function(){return this.bold},set:function(t){this.bold=t},enumerable:!1,configurable:!0}),TextElement.prototype.render=function(){},TextElement}(i(46).ByondInteractiveElement);n.TextElement=g},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.ScaleControls=void 0;var s=i(85),m=i(151),g=function(t){function ScaleControls(n,i){var o=new m.ScreenMetadata;return o.position=n.obj.position,o.picture="",t.call(this,o,n,i)||this}return a(ScaleControls,t),ScaleControls}(s.ScreenImage);n.ScaleControls=g},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneLightFactory=n.TransparentBackgroundFactory=n.ScreenGalleryFactory=n.ScreenFactory=n.ObjectModelFactory=n.LightFactory=n.HotspotFactory=n.GenericGalleryFactory=n.CssElementsGalleryFactory=n.CSSElementFactory=n.CameraControlsFactory=n.BackgroundVideoFactory=n.BackgroundImageFactory=void 0;var o=i(534);n.BackgroundImageFactory=o;var a=i(537);n.BackgroundVideoFactory=a;var s=i(540);n.CameraControlsFactory=s;var m=i(546);n.CSSElementFactory=m;var g=i(548);n.CssElementsGalleryFactory=g;var _=i(551);n.GenericGalleryFactory=_;var S=i(552);n.HotspotFactory=S;var M=i(555);n.LightFactory=M;var T=i(558);n.ObjectModelFactory=T;var O=i(151);n.ScreenFactory=O;var A=i(560);n.ScreenGalleryFactory=A;var P=i(563);n.TransparentBackgroundFactory=P;var L=i(566);n.ZoneLightFactory=L},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(535);Object.defineProperty(n,"BackgroundMetadata",{enumerable:!0,get:function(){return o.BackgroundMetadata}});var a=i(536);Object.defineProperty(n,"BackgroundImageFactory",{enumerable:!0,get:function(){return a.BackgroundImageFactory}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundMetadata=void 0;var s=function(t){function BackgroundMetadata(){var n=null!==t&&t.apply(this,arguments)||this;return n.is_stereoscopic=!1,n}return a(BackgroundMetadata,t),Object.defineProperty(BackgroundMetadata.prototype,"ElementName",{get:function(){return"background"},enumerable:!1,configurable:!0}),BackgroundMetadata}(i(32).Metadata.Element3DMetadata);n.BackgroundMetadata=s},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundImageFactory=void 0;var g=i(51),_=i(17),S=i(152),M=i(22),T=function(t){function BackgroundImageFactory(n){return t.call(this,n)||this}return a(BackgroundImageFactory,t),BackgroundImageFactory.prototype.init=function(){},BackgroundImageFactory.prototype.predicate=function(t){if(!t||"zone"!==t.ElementName||!_.Utils.isImage(t.bg))return!1;var n=t.getCustomAttribute(M.CustomAttributes.Background);if(!n)return!0;var i="equirectangular"===n.type;return"cubemap"===n.type||i},BackgroundImageFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){var i,o;return m(this,(function(a){switch(i=t.getCustomAttribute(M.CustomAttributes.Background),o=t.projection_type,i&&i.type&&(o=i.type),o){case"cubemap":case"cubemap_image":return[2,new S.CubemapBackgroundImage(t,n)];default:return t.is_stereoscopic?[2,new S.EquirectangularBackgroundImageStereo(t,n)]:[2,new S.EquirectangularBackgroundImage(t,n)]}return[2]}))}))},BackgroundImageFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},BackgroundImageFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},BackgroundImageFactory}(g.ByondBaseElementFactoryImpl);n.BackgroundImageFactory=T},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(538);Object.defineProperty(n,"BackgroundMetadata",{enumerable:!0,get:function(){return o.BackgroundMetadata}});var a=i(539);Object.defineProperty(n,"BackgroundVideoFactory",{enumerable:!0,get:function(){return a.BackgroundVideoFactory}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundMetadata=void 0;var s=function(t){function BackgroundMetadata(){var n=null!==t&&t.apply(this,arguments)||this;return n.is_stereoscopic=!1,n}return a(BackgroundMetadata,t),Object.defineProperty(BackgroundMetadata.prototype,"ElementName",{get:function(){return"background"},enumerable:!1,configurable:!0}),BackgroundMetadata}(i(32).Metadata.Element3DMetadata);n.BackgroundMetadata=s},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundVideoFactory=void 0;var g=i(51),_=i(17),S=i(22),M=i(152),T=function(t){function BackgroundVideoFactory(n){return t.call(this,n)||this}return a(BackgroundVideoFactory,t),BackgroundVideoFactory.prototype.init=function(){},BackgroundVideoFactory.prototype.predicate=function(t){if(!t||"zone"!==t.ElementName||!_.Utils.isVideo(t.bg))return!1;var n=t.getCustomAttribute(S.CustomAttributes.Background);if(!n)return!0;var i="equirectangular"===n.type;return"cubemap"===n.type||i},BackgroundVideoFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){return m(this,(function(i){switch(t.projection_type){case"cubemap_video":return[2,new M.CubemapBackgroundVideo(t,n)];default:return t.is_stereoscopic?[2,new M.EquirectangularBackgroundVideoStereo(t,n)]:[2,new M.EquirectangularBackgroundVideo(t,n)]}return[2]}))}))},BackgroundVideoFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},BackgroundVideoFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},BackgroundVideoFactory}(g.ByondBaseElementFactoryImpl);n.BackgroundVideoFactory=T},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TouchCameraControlsFactory=n.VROrbitCameraControlsFactory=n.VRDollyCameraControlsFactory=n.OrbitCameraControlsFactory=n.DollyCameraControlsFactory=n.BaseCameraControlsFactoryImpl=void 0;var o=i(103);Object.defineProperty(n,"BaseCameraControlsFactoryImpl",{enumerable:!0,get:function(){return o.BaseCameraControlsFactoryImpl}});var a=i(541);Object.defineProperty(n,"DollyCameraControlsFactory",{enumerable:!0,get:function(){return a.DollyCameraControlsFactory}});var s=i(542);Object.defineProperty(n,"OrbitCameraControlsFactory",{enumerable:!0,get:function(){return s.OrbitCameraControlsFactory}});var m=i(543);Object.defineProperty(n,"VRDollyCameraControlsFactory",{enumerable:!0,get:function(){return m.VRDollyCameraControlsFactory}});var g=i(544);Object.defineProperty(n,"VROrbitCameraControlsFactory",{enumerable:!0,get:function(){return g.VROrbitCameraControlsFactory}});var _=i(545);Object.defineProperty(n,"TouchCameraControlsFactory",{enumerable:!0,get:function(){return _.TouchCameraControlsFactory}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.DollyCameraControlsFactory=void 0;var s=i(103),m=i(56),g=function(t){function DollyCameraControlsFactory(n){return t.call(this,n)||this}return a(DollyCameraControlsFactory,t),DollyCameraControlsFactory.prototype.init=function(){},DollyCameraControlsFactory.prototype.predicate=function(t,n){var i=this.appManager.cameraControlsRegistry;if(t&&t.dolly_camera&&(n||!i.cameraControls.isVR))return!0},DollyCameraControlsFactory.prototype.create=function(t){return new m.Controls.CameraControls.DollyCameraControls.DollyCameraControls(this.appManager,t.dolly_camera)},DollyCameraControlsFactory.prototype.register=function(){this.appManager.cameraControlsRegistry.RegisterElement(this)},DollyCameraControlsFactory.prototype.unregister=function(){this.appManager.cameraControlsRegistry.UnregisterElement(this)},DollyCameraControlsFactory}(s.BaseCameraControlsFactoryImpl);n.DollyCameraControlsFactory=g},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.OrbitCameraControlsFactory=void 0;var s=i(103),m=i(146),g=function(t){function OrbitCameraControlsFactory(n){return t.call(this,n)||this}return a(OrbitCameraControlsFactory,t),OrbitCameraControlsFactory.prototype.init=function(){},OrbitCameraControlsFactory.prototype.predicate=function(t,n){var i=this.appManager.cameraControlsRegistry;if(t&&t.orbit_camera&&(n||!i.cameraControls.isVR))return!0},OrbitCameraControlsFactory.prototype.create=function(t){return new m.OrbitCameraControls(this.appManager,t.orbit_camera)},OrbitCameraControlsFactory.prototype.register=function(){this.appManager.cameraControlsRegistry.RegisterElement(this)},OrbitCameraControlsFactory.prototype.unregister=function(){this.appManager.cameraControlsRegistry.UnregisterElement(this)},OrbitCameraControlsFactory}(s.BaseCameraControlsFactoryImpl);n.OrbitCameraControlsFactory=g},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.VRDollyCameraControlsFactory=void 0;var s=i(103),m=i(192),g=function(t){function VRDollyCameraControlsFactory(n){return t.call(this,n)||this}return a(VRDollyCameraControlsFactory,t),VRDollyCameraControlsFactory.prototype.init=function(){},VRDollyCameraControlsFactory.prototype.predicate=function(t,n){var i=this.appManager.cameraControlsRegistry;if(t&&t.dolly_camera&&!n&&i.cameraControls.isVR)return!0},VRDollyCameraControlsFactory.prototype.create=function(t){return new m.VRDollyCameraControls(this.appManager,t.dolly_camera)},VRDollyCameraControlsFactory.prototype.register=function(){this.appManager.cameraControlsRegistry.RegisterElement(this)},VRDollyCameraControlsFactory.prototype.unregister=function(){this.appManager.cameraControlsRegistry.UnregisterElement(this)},VRDollyCameraControlsFactory}(s.BaseCameraControlsFactoryImpl);n.VRDollyCameraControlsFactory=g},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.VROrbitCameraControlsFactory=void 0;var s=i(103),m=i(124),g=function(t){function VROrbitCameraControlsFactory(n){return t.call(this,n)||this}return a(VROrbitCameraControlsFactory,t),VROrbitCameraControlsFactory.prototype.init=function(){},VROrbitCameraControlsFactory.prototype.predicate=function(t,n){var i=this.appManager.cameraControlsRegistry;if(t&&t.orbit_camera&&!n&&i.cameraControls.isVR)return!0},VROrbitCameraControlsFactory.prototype.create=function(t){return new m.VROrbitCameraControls(this.appManager,t.orbit_camera)},VROrbitCameraControlsFactory.prototype.register=function(){this.appManager.cameraControlsRegistry.RegisterElement(this)},VROrbitCameraControlsFactory.prototype.unregister=function(){this.appManager.cameraControlsRegistry.UnregisterElement(this)},VROrbitCameraControlsFactory}(s.BaseCameraControlsFactoryImpl);n.VROrbitCameraControlsFactory=g},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.TouchCameraControlsFactory=void 0;var s=i(103),m=i(186),g=function(t){function TouchCameraControlsFactory(n){return t.call(this,n)||this}return a(TouchCameraControlsFactory,t),TouchCameraControlsFactory.prototype.init=function(){},TouchCameraControlsFactory.prototype.predicate=function(t,n){var i=this.appManager.cameraControlsRegistry;if(t&&t.touch_camera&&(n||!i.cameraControls.isVR))return!0},TouchCameraControlsFactory.prototype.create=function(t){return new m.TouchCameraControls(this.appManager,t.touch_camera)},TouchCameraControlsFactory.prototype.register=function(){this.appManager.cameraControlsRegistry.RegisterElement(this)},TouchCameraControlsFactory.prototype.unregister=function(){this.appManager.cameraControlsRegistry.UnregisterElement(this)},TouchCameraControlsFactory}(s.BaseCameraControlsFactoryImpl);n.TouchCameraControlsFactory=g},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(547);Object.defineProperty(n,"CSSElementFactory",{enumerable:!0,get:function(){return o.CSSElementFactory}});var a=i(203);Object.defineProperty(n,"CssElementMetadata",{enumerable:!0,get:function(){return a.CssElementMetadata}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CSSElementFactory=void 0;var g=i(51),_=i(203),S=i(294),M=i(36),T=function(t){function CSSElementFactory(n){return t.call(this,n)||this}return a(CSSElementFactory,t),CSSElementFactory.prototype.init=function(){},CSSElementFactory.prototype.predicate=function(t){return t&&"cssElement"===t.ElementName&&this.checkValidElement(t)},CSSElementFactory.prototype.checkValidElement=function(t){return!!(t.height||t.width||t.html)},CSSElementFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){return m(this,(function(o){return t instanceof _.CssElementMetadata||(t.ElementName&&delete t.ElementName,t=M.plainToClass(_.CssElementMetadata,t)),[2,new S.CssElement(t,n,i)]}))}))},CSSElementFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},CSSElementFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},CSSElementFactory}(g.ByondBaseElementFactoryImpl);n.CSSElementFactory=T},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(549);Object.defineProperty(n,"CssElementGalleryElementMetadata",{enumerable:!0,get:function(){return o.CssElementGalleryElementMetadata}});var a=i(550);Object.defineProperty(n,"CssElementGalleryFactory",{enumerable:!0,get:function(){return a.CssElementGalleryFactory}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneMetadata=n.CssElementGalleryElementMetadata=void 0;var m=i(36),g=i(32),_=i(203),S=i(155),M=i(204),T=function(t){function CssElementGalleryElementMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(CssElementGalleryElementMetadata,t),Object.defineProperty(CssElementGalleryElementMetadata.prototype,"ElementName",{get:function(){return"cssElementGalleryElement"},enumerable:!1,configurable:!0}),s([m.Type((function(){return _.CssElementMetadata}))],CssElementGalleryElementMetadata.prototype,"data",void 0),CssElementGalleryElementMetadata}(S.BaseGalleryElementMetadata);n.CssElementGalleryElementMetadata=T;var O=function(t){function ZoneMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ZoneMetadata,t),s([m.Type((function(){return S.BaseGalleryElementMetadata}),{discriminator:{property:"gallery_element_type",subTypes:M.subTypes}})],ZoneMetadata.prototype,"screen_albums",void 0),ZoneMetadata}(g.Metadata.ZoneMetadata);n.ZoneMetadata=O,M.subTypes.push({name:"cssElementsGallery",value:T}),g.Metadata.ZoneMetadata=Object.assign(O,g.Metadata.ZoneMetadata)},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CssElementGalleryFactory=void 0;var g=i(156),_=i(199),S=i(198),M=function(t){function CssElementGalleryFactory(n){return t.call(this,n)||this}return a(CssElementGalleryFactory,t),CssElementGalleryFactory.prototype.init=function(){},CssElementGalleryFactory.prototype.predicate=function(t){return t&&"cssElementGalleryElement"===t.ElementName},CssElementGalleryFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){var o,a,s;return m(this,(function(m){return"helix"===(o=t.getCustomAttribute("$$type"))?[2,new S.GenericGalleryHelix(t,n,i)]:"layered"===o?[2,new _.LayeredGallery(t,n,i)]:(a=t.getCustomAttribute("rows"),s=t.getCustomAttribute("cols"),a||(a=2),s||(s=3),[2,new g.GridBasedGallery(t,n,i,a,s)])}))}))},CssElementGalleryFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},CssElementGalleryFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},CssElementGalleryFactory}(i(205).GenericGalleryFactory);n.CssElementGalleryFactory=M},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BaseGalleryElementMetadata=n.GenericGalleryFactory=n.subTypes=void 0;var o=i(204);Object.defineProperty(n,"subTypes",{enumerable:!0,get:function(){return o.subTypes}});var a=i(205);Object.defineProperty(n,"GenericGalleryFactory",{enumerable:!0,get:function(){return a.GenericGalleryFactory}});var s=i(155);Object.defineProperty(n,"BaseGalleryElementMetadata",{enumerable:!0,get:function(){return s.BaseGalleryElementMetadata}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(553);Object.defineProperty(n,"HotspotFactory",{enumerable:!0,get:function(){return o.HotspotFactory}});var a=i(554);Object.defineProperty(n,"HotspotMetadata",{enumerable:!0,get:function(){return a.HotspotMetadata}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.HotspotFactory=void 0;var g=i(51),_=i(309),S=function(t){function HotspotFactory(n){return t.call(this,n)||this}return a(HotspotFactory,t),HotspotFactory.prototype.predicate=function(t){return t&&"hotspot"===t.ElementName},HotspotFactory.prototype.init=function(){},HotspotFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){return m(this,(function(o){return"navigation"===t.type?[2,new _.HotspotNavigation(t,n,i)]:"video"===t.type?[2,new _.HotspotVideo(t,n,i)]:"teleport"===t.type?[2,new _.HotspotTeleport(t,n,i)]:[2,new _.HotspotImage(t,n,i)]}))}))},HotspotFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},HotspotFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},HotspotFactory}(g.ByondBaseElementFactoryImpl);n.HotspotFactory=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.HotspotMetadata=void 0;var m=i(36),g=i(32),_=function(t){function HotspotMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(HotspotMetadata,t),Object.defineProperty(HotspotMetadata.prototype,"ElementName",{get:function(){return"hotspot"},enumerable:!1,configurable:!0}),HotspotMetadata}(i(102).ScreenMetadata);n.HotspotMetadata=_;var S=function(t){function ZoneMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ZoneMetadata,t),s([m.Type((function(){return _}))],ZoneMetadata.prototype,"hotspots",void 0),ZoneMetadata}(g.Metadata.ZoneMetadata);g.Metadata.ZoneMetadata=Object.assign(S,g.Metadata.ZoneMetadata)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(556);Object.defineProperty(n,"LightElementMetadata",{enumerable:!0,get:function(){return o.LightElementMetadata}});var a=i(557);Object.defineProperty(n,"LightFactory",{enumerable:!0,get:function(){return a.LightFactory}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneMetadata=n.LightElementMetadata=void 0;var m=i(36),g=i(32),_=function(t){function LightElementMetadata(){var n=null!==t&&t.apply(this,arguments)||this;return n.active=!0,n.color="#ffffff",n.intensity=1,n.distance=1,n.decay=1,n.cast_shadows=!0,n.angle=Math.PI/3,n.ground_color="#ffffff",n}return a(LightElementMetadata,t),Object.defineProperty(LightElementMetadata.prototype,"ElementName",{get:function(){return"LightElement"},enumerable:!1,configurable:!0}),LightElementMetadata}(g.Metadata.Element3DMetadata);n.LightElementMetadata=_;var S=function(t){function ZoneMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ZoneMetadata,t),s([m.Type((function(){return _}))],ZoneMetadata.prototype,"lightings",void 0),ZoneMetadata}(g.Metadata.ZoneMetadata);n.ZoneMetadata=S,g.Metadata.ZoneMetadata=Object.assign(S,g.Metadata.ZoneMetadata)},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.LightFactory=void 0;var g=i(51),_=i(311),S=function(t){function LightFactory(n){return t.call(this,n)||this}return a(LightFactory,t),LightFactory.prototype.predicate=function(t){return t&&"LightElement"===t.ElementName&&t.active&&void 0!==t.type},LightFactory.prototype.init=function(){},LightFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){return m(this,(function(o){switch(t.type){case"directional":return[2,new _.DirectionalLight(t,n,i)];case"spot":return[2,new _.SpotLight(t,n,i)];case"hemispheric":return[2,new _.HemisphericLight(t,n,i)];case"point":return[2,new _.PointLight(t,n,i)]}return[2]}))}))},LightFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},LightFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},LightFactory}(g.ByondBaseElementFactoryImpl);n.LightFactory=S},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(315);Object.defineProperty(n,"ObjModelMetadata",{enumerable:!0,get:function(){return o.ObjModelMetadata}}),Object.defineProperty(n,"MeshScreenMetadata",{enumerable:!0,get:function(){return o.MeshScreenMetadata}});var a=i(559);Object.defineProperty(n,"ObjModelFactory",{enumerable:!0,get:function(){return a.ObjModelFactory}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ObjModelFactory=void 0;var g=i(51),_=i(313),S=i(315),M=i(36),T=function(t){function ObjModelFactory(n){return t.call(this,n)||this}return a(ObjModelFactory,t),ObjModelFactory.prototype.init=function(){},ObjModelFactory.prototype.predicate=function(t){return t&&"objModel"===t.ElementName},ObjModelFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){return m(this,(function(o){return t instanceof S.ObjModelMetadata||(t.ElementName&&delete t.ElementName,t=M.plainToClass(S.ObjModelMetadata,t)),[2,new _.ObJModel(t,n,i)]}))}))},ObjModelFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},ObjModelFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},ObjModelFactory}(g.ByondBaseElementFactoryImpl);n.ObjModelFactory=T},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(561);Object.defineProperty(n,"ScreenGalleryElementMetadata",{enumerable:!0,get:function(){return o.ScreenGalleryElementMetadata}});var a=i(562);Object.defineProperty(n,"ScreenGalleryFactory",{enumerable:!0,get:function(){return a.ScreenGalleryFactory}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneMetadata=n.ScreenGalleryElementMetadata=void 0;var m=i(36),g=i(32),_=i(155),S=i(102),M=i(204),T=function(t){function ScreenGalleryElementMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ScreenGalleryElementMetadata,t),Object.defineProperty(ScreenGalleryElementMetadata.prototype,"ElementName",{get:function(){return"screenGalleryElement"},enumerable:!1,configurable:!0}),s([m.Type((function(){return S.ScreenMetadata}))],ScreenGalleryElementMetadata.prototype,"data",void 0),ScreenGalleryElementMetadata}(_.BaseGalleryElementMetadata);n.ScreenGalleryElementMetadata=T;var O=function(t){function ZoneMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ZoneMetadata,t),s([m.Type((function(){return _.BaseGalleryElementMetadata}),{discriminator:{property:"gallery_element_type",subTypes:M.subTypes}})],ZoneMetadata.prototype,"walls",void 0),s([m.Type((function(){return _.BaseGalleryElementMetadata}),{discriminator:{property:"gallery_element_type",subTypes:M.subTypes}})],ZoneMetadata.prototype,"screen_albums",void 0),ZoneMetadata}(g.Metadata.ZoneMetadata);n.ZoneMetadata=O,M.subTypes.push({name:void 0,value:T}),M.subTypes.push({name:"",value:T}),g.Metadata.ZoneMetadata=Object.assign(O,g.Metadata.ZoneMetadata)},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ScreenGalleryFactory=void 0;var g=i(156),_=i(199),S=i(198),M=i(205),T=i(151),O=i(263),A=function(t){function ScreenGalleryFactory(n){return t.call(this,n)||this}return a(ScreenGalleryFactory,t),ScreenGalleryFactory.prototype.init=function(){},ScreenGalleryFactory.prototype.predicate=function(t){return t&&"screenGalleryElement"===t.ElementName},ScreenGalleryFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){var o,a,s,M,A,P,L;return m(this,(function(m){switch(m.label){case 0:return o=t.getCustomAttribute("$$type"),"instagram"!==t.data_provider?[3,2]:[4,O.InstagremConnector.getImagesByHashTag(t.indentifier)];case 1:if(!(a=m.sent()))return[2];t.data=[],a.forEach((function(n){var i=new T.ScreenMetadata;i.picture=n.picture,i.thumb=n.thumbnail,i.grow_type="",t.data.push(i)})),m.label=2;case 2:return"helix"===o?[2,new S.GenericGalleryHelix(t,n,i)]:"layered"===o?[2,new _.LayeredGallery(t,n,i)]:(s=t.getCustomAttribute("rows"),M=t.getCustomAttribute("cols"),A=t.getCustomAttribute("padding"),P=t.getCustomAttribute("cell_size"),L=t.getCustomAttribute("margin"),s||(s=2),M||(M=3),s||(s=2),M||(M=3),[2,new g.GridBasedGallery(t,n,i,s,M,void 0,A,L,P)])}}))}))},ScreenGalleryFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},ScreenGalleryFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},ScreenGalleryFactory}(M.GenericGalleryFactory);n.ScreenGalleryFactory=A},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(564);Object.defineProperty(n,"BackgroundMetadata",{enumerable:!0,get:function(){return o.BackgroundMetadata}});var a=i(565);Object.defineProperty(n,"TransparentBackgroundFactory",{enumerable:!0,get:function(){return a.TransparentBackgroundFactory}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundMetadata=void 0;var s=function(t){function BackgroundMetadata(){var n=null!==t&&t.apply(this,arguments)||this;return n.is_stereoscopic=!1,n}return a(BackgroundMetadata,t),Object.defineProperty(BackgroundMetadata.prototype,"ElementName",{get:function(){return"background"},enumerable:!1,configurable:!0}),BackgroundMetadata}(i(32).Metadata.Element3DMetadata);n.BackgroundMetadata=s},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransparentBackgroundFactory=n.TransparentBackgroundAttr=void 0;var g=i(51),_=i(152),S=i(22);n.TransparentBackgroundAttr="transparent";var M=function(t){function TransparentBackgroundFactory(n){return t.call(this,n)||this}return a(TransparentBackgroundFactory,t),TransparentBackgroundFactory.prototype.init=function(){},TransparentBackgroundFactory.prototype.predicate=function(t){if(!t||"zone"!==t.ElementName)return!1;var i=t.getCustomAttribute(S.CustomAttributes.Background);return i&&i.type===n.TransparentBackgroundAttr},TransparentBackgroundFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){return m(this,(function(o){return[2,new _.TransparentBackground(t,n,i)]}))}))},TransparentBackgroundFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},TransparentBackgroundFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},TransparentBackgroundFactory}(g.ByondBaseElementFactoryImpl);n.TransparentBackgroundFactory=M},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(567);Object.defineProperty(n,"ZoneLightFactory",{enumerable:!0,get:function(){return o.ZoneLightFactory}});var a=i(568);Object.defineProperty(n,"ZoneLightMetadata",{enumerable:!0,get:function(){return a.ZoneLightMetadata}})},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneLightFactory=void 0;var g=i(51),_=i(314),S=function(t){function ZoneLightFactory(n){return t.call(this,n)||this}return a(ZoneLightFactory,t),ZoneLightFactory.prototype.predicate=function(t){return t&&"ZoneLight"===t.ElementName},ZoneLightFactory.prototype.init=function(){},ZoneLightFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){return m(this,(function(o){return[2,new _.ZoneLight(t,n,i)]}))}))},ZoneLightFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},ZoneLightFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},ZoneLightFactory}(g.ByondBaseElementFactoryImpl);n.ZoneLightFactory=S},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__decorate||function(t,n,i,o){var a,s=arguments.length,m=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(t,n,i,o);else for(var g=t.length-1;g>=0;g--)(a=t[g])&&(m=(s<3?a(m):s>3?a(n,i,m):a(n,i))||m);return s>3&&m&&Object.defineProperty(n,i,m),m};Object.defineProperty(n,"__esModule",{value:!0}),n.ZoneMetadata=n.ZoneLightMetadata=void 0;var m=i(36),g=i(32),_=function(t){function ZoneLightMetadata(){var n=null!==t&&t.apply(this,arguments)||this;return n.active=!0,n.color="#ffffff",n.intensity=1,n}return a(ZoneLightMetadata,t),Object.defineProperty(ZoneLightMetadata.prototype,"ElementName",{get:function(){return"ZoneLight"},enumerable:!1,configurable:!0}),ZoneLightMetadata}(g.Metadata.BaseElementMetadata);n.ZoneLightMetadata=_;var S=function(t){function ZoneMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ZoneMetadata,t),s([m.Type((function(){return _}))],ZoneMetadata.prototype,"zone_lighting",void 0),ZoneMetadata}(g.Metadata.ZoneMetadata);n.ZoneMetadata=S,g.Metadata.ZoneMetadata=Object.assign(S,g.Metadata.ZoneMetadata)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EditorManager=n.Cursor2D=n.Chat=n.CameraBtn=n.AROverlay=void 0;var o=i(299);Object.defineProperty(n,"AROverlay",{enumerable:!0,get:function(){return o.AROverlay}});var a=i(298);Object.defineProperty(n,"CameraBtn",{enumerable:!0,get:function(){return a.CameraBtn}});var s=i(570);n.Chat=s;var m=i(577);Object.defineProperty(n,"Cursor2D",{enumerable:!0,get:function(){return m.Cursor2D}});var g=i(578);Object.defineProperty(n,"EditorManager",{enumerable:!0,get:function(){return g.EditorManager}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ChatElementMetadata=n.ChatElementFactory=n.Chat=n.AutoChat=void 0;var o=i(571);Object.defineProperty(n,"AutoChat",{enumerable:!0,get:function(){return o.AutoChat}});var a=i(316);n.Chat=a;var s=i(575);Object.defineProperty(n,"ChatElementFactory",{enumerable:!0,get:function(){return s.ChatElementFactory}});var m=i(576);Object.defineProperty(n,"ChatElementMetadata",{enumerable:!0,get:function(){return m.ChatElementMetadata}})},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AutoChat=void 0;var o=i(130),a=function(){function AutoChat(t){this.messages={other:[{content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididuntut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",name:"other",type:"other"}],me:[{content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et",name:"me",type:"me"}],host:[{content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et",name:"host",type:"host"}],notification:[{content:"Lorem ipsum dolor sit amet !!!",name:"",type:"notification"}]},this.chat=t}return AutoChat.prototype.start=function(){var t=this;this.sendRandomMsg();var n=o.interval(1e3*this.getRandomInteger(1,5));this.sub=n.subscribe((function(){t.sendRandomMsg()}))},AutoChat.prototype.stop=function(){this.sub.unsubscribe()},AutoChat.prototype.getRandomInteger=function(t,n){return Math.floor(Math.random()*(n+1))},AutoChat.prototype.sendRandomMsg=function(){var t,n=this.getRandomInteger(0,3);t=0===n?"other":1===n?"me":1===n?"host":"notification";var i=this.messages[t].length;if(!(i<=0)){var o=this.getRandomInteger(0,i-1),a=this.messages[t][o];this.chat.addNewMessage(this.chat,a)}},AutoChat}();n.AutoChat=a},function(t,n,i){var o=i(573);"string"==typeof o&&(o=[[t.i,o,""]]);i(97)(o,{hmr:!0,transform:void 0,insertInto:void 0}),o.locals&&(t.exports=o.locals)},function(t,n,i){(t.exports=i(96)(!1)).push([t.i,'.chat {\n  width: 650px;\n  height: 1000px;\n}\n.chat .content {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  position: relative;\n}\n.chat .content .contact-profile {\n  width: 100%;\n  height: 60px;\n  line-height: 60px;\n  background: #f5f5f5;\n}\n.chat .content .messages {\n  height: auto;\n  min-height: calc(100% - 93px);\n  max-height: calc(100% - 93px);\n  overflow-y: scroll;\n  overflow-x: hidden;\n}\n.chat .content .messages::-webkit-scrollbar {\n  width: 20px;\n  background: transparent;\n}\n.chat .content .messages::-webkit-scrollbar-thumb {\n  background-color: rgba(0, 0, 0, 0.3);\n}\n.chat .content .messages ul li {\n  display: inline-block;\n  clear: both;\n  margin: 15px 15px 5px 15px;\n  width: calc(100% - 25px);\n  font-size: 35px;\n}\n.chat .content .messages ul li:nth-last-child(1) {\n  margin-bottom: 20px;\n}\n.chat .content .messages ul li p {\n  display: inline-block;\n  padding: 10px 15px;\n  border-radius: 20px;\n  max-width: 650px;\n  line-height: 130%;\n}\n.chat .content .messages ul li.sent p {\n  background: #435f7a;\n  color: #f5f5f5;\n}\n.chat .content .messages ul li.guest p {\n  background: #f5f5f5;\n}\n.chat .content .messages ul li.admin p {\n  background: #4bff00;\n}\n.chat .content .messages ul li.notification {\n  text-align: center;\n}\n.chat .content .messages ul li.notification p {\n  background: #fff777;\n}\n.chat .content .message-input {\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  height: 70px;\n  z-index: 99;\n}\n.chat .content .message-input .wrap {\n  position: relative;\n}\n.chat .content .message-input .wrap input {\n  margin-left: 5px;\n  font-family: "proxima-nova", "Source Sans Pro", sans-serif;\n  float: left;\n  border: none;\n  width: calc(100% - 90px);\n  padding: 11px 32px 10px 8px;\n  font-size: 30px;\n  color: #32465a;\n}\n.chat .content .message-input .wrap input:focus {\n  outline: none;\n}\n.chat .content .message-input .wrap .attachment {\n  position: absolute;\n  right: 60px;\n  z-index: 4;\n  margin-top: 10px;\n  font-size: 1.1em;\n  color: #435f7a;\n  opacity: 0.5;\n  cursor: pointer;\n}\n.chat .content .message-input .wrap .attachment:hover {\n  opacity: 1;\n}\n.chat .content .message-input .wrap button {\n  border: none;\n  margin: 2px 12px;\n  width: 60px;\n  height: 60px;\n  cursor: pointer;\n  background: #32465a;\n  color: #f5f5f5;\n  font-size: 30px;\n  font-weight: 600px;\n}\n.chat .content .message-input .wrap button:hover {\n  background: #435f7a;\n}\n.chat .content .message-input .wrap button:focus {\n  outline: none;\n}\n',""])},function(t,n){function identity(t){return t}t.exports=function(t,n){if(null==t)return t;var i=(n=n||{}).width||50,o="string"==typeof n.indent?n.indent:"  ",a=n.newline||"\n"+o,s="function"==typeof n.escape?n.escape:identity,m=".{1,"+i+"}";!0!==n.cut&&(m+="([\\s​]+|$)|[^\\s​]+?([\\s​]+|$)");var g=new RegExp(m,"g"),_=o+(t.match(g)||[]).map((function(t){return"\n"===t.slice(-1)&&(t=t.slice(0,t.length-1)),s(t)})).join(a);return!0===n.trim&&(_=_.replace(/[ \t]*$/gm,"")),_}},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ChatElementFactory=void 0;var g=i(316),_=function(t){function ChatElementFactory(){return null!==t&&t.apply(this,arguments)||this}return a(ChatElementFactory,t),ChatElementFactory.prototype.init=function(){},ChatElementFactory.prototype.register=function(){this.appManager.elementsRegistry.RegisterElement(this)},ChatElementFactory.prototype.unregister=function(){this.appManager.elementsRegistry.UnregisterElement(this)},ChatElementFactory.prototype.predicate=function(t){return"Chat"===t.ElementName},ChatElementFactory.prototype.create=function(t,n,i){return s(this,void 0,void 0,(function(){return m(this,(function(o){return[2,new g.Chat(t,n,i)]}))}))},ChatElementFactory}(i(51).ByondBaseElementFactoryImpl);n.ChatElementFactory=_},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.ChatElementMetadata=void 0;var s=function(t){function ChatElementMetadata(){return null!==t&&t.apply(this,arguments)||this}return a(ChatElementMetadata,t),Object.defineProperty(ChatElementMetadata.prototype,"ElementName",{get:function(){return"chatElement"},enumerable:!1,configurable:!0}),ChatElementMetadata}(i(32).Metadata.Element3DMetadata);n.ChatElementMetadata=s},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Cursor2D=void 0;var s=i(0),m=i(77),g=function(){function Cursor2D(t,n){this.enabled=!1,this.colorStart=16777215,this.colorEnd=13421772,this.appManager=t,this.camera=n,this.geometry=new s.PlaneGeometry(.01,.01),this.material=new s.MeshBasicMaterial({color:this.colorStart,side:s.FrontSide,depthWrite:!0,depthTest:!1,transparent:!0,opacity:1,alphaTest:.5}),this.mesh=new s.Mesh(this.geometry,this.material),this.mesh.renderOrder=999,this.mesh.visible=!1,this.material.needsUpdate=!0,this.mesh.position.set(0,0,-1)}return Cursor2D.prototype.init=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return this.cursorImage=new m.Image(this.appManager,{url:"https://webxr-apps.byondxr.com/assets/images/user_interaction_controls/cursor.png"}),[4,this.cursorImage.Load()];case 1:return t=n.sent(),this.material.map=t,this.material.needsUpdate=!0,this.camera.add(this.mesh),[2]}}))}))},Cursor2D.prototype.startAnimation=function(){},Cursor2D.prototype.stopAnimation=function(){},Cursor2D.prototype.enable=function(){this.enabled||(this.mesh.visible=!0,this.enabled=!0)},Cursor2D.prototype.disable=function(){this.enabled&&(this.mesh.visible=!1,this.enabled=!1)},Cursor2D.prototype.destroy=function(){this.disable(),this.geometry.dispose(),this.geometry=void 0,this.material.dispose(),this.material=void 0,this.camera.remove(this.mesh),this.mesh=void 0,this.cursorImage.Dispose(),this.cursorImage=void 0},Cursor2D}();n.Cursor2D=g},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EditorManager=void 0;var o=i(18),a=i(10),s=i(579),m=function(){function EditorManager(t){this.subscriptions=Array(),this.subFolderMap=new Map,this.folderMap=new Map,this.appManager=t,this.init()}return EditorManager.prototype.init=function(){var t=this;this.appManager.eventManager.pipe(o.filter((function(t){return t.eventType.name===(new a.ZoneChangeEndedEvent).name||t.eventType===a.ZoneChangeEndedEvent}))).subscribe((function(n){t.buildMenu()})),this.appManager.eventManager.pipe(o.filter((function(t){return t.eventType.name===(new a.ZoneChangeStartedEvent).name||t.eventType===a.ZoneChangeStartedEvent}))).subscribe((function(n){t.clearMenu()}))},EditorManager.prototype.addBooleanMenuItem=function(t,n,i,o,a){this.getMenuFolder(t,n).add(i,o).onChange(a)},EditorManager.prototype.addNumberMenuItem=function(t,n,i,o,a,s,m){this.getMenuFolder(t,n).add(i,o,a,s).onChange(m)},EditorManager.prototype.getMenuFolder=function(t,n){if(this.subFolderMap.has(t)){var i=this.subFolderMap.get(t);if(i.has(n))return i.get(n);var o=this.folderMap.get(t),a=o.addFolder(n);return i.set(n,a),this.subFolderMap.set(t,i),this.folderMap.set(t,o),a}var s=this.GUI.addFolder(t);this.folderMap.set(t,s);var m=s.addFolder(n);return this.subFolderMap.set(t,new Map([[n,m]])),m},EditorManager.prototype.clearMenu=function(){this.GUI&&(this.GUI.destroy(),this.GUI=void 0),this.folderMap.clear(),this.subFolderMap.clear()},EditorManager.prototype.buildMenu=function(){this.GUI||(this.GUI=new s.GUI),this.appManager.currentExperience.currentZone.addEditorItems(),this.appManager.currentExperience.backgroundManager.currentBackground.addEditorItems(),this.appManager.currentExperience.currentZone.elementsList.forEach((function(t){t.addEditorItems()}))},EditorManager.prototype.destroy=function(){this.clearMenu(),this.subscriptions.forEach((function(t){t.unsubscribe()}))},EditorManager}();n.EditorManager=m},function(t,n,i){"use strict";function colorToString(t,n){var i=t.__state.conversionName.toString(),o=Math.round(t.r),a=Math.round(t.g),s=Math.round(t.b),m=t.a,g=Math.round(t.h),_=t.s.toFixed(1),S=t.v.toFixed(1);if(n||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var M=t.hex.toString(16);M.length<6;)M="0"+M;return"#"+M}return"CSS_RGB"===i?"rgb("+o+","+a+","+s+")":"CSS_RGBA"===i?"rgba("+o+","+a+","+s+","+m+")":"HEX"===i?"0x"+t.hex.toString(16):"RGB_ARRAY"===i?"["+o+","+a+","+s+"]":"RGBA_ARRAY"===i?"["+o+","+a+","+s+","+m+"]":"RGB_OBJ"===i?"{r:"+o+",g:"+a+",b:"+s+"}":"RGBA_OBJ"===i?"{r:"+o+",g:"+a+",b:"+s+",a:"+m+"}":"HSV_OBJ"===i?"{h:"+g+",s:"+_+",v:"+S+"}":"HSVA_OBJ"===i?"{h:"+g+",s:"+_+",v:"+S+",a:"+m+"}":"unknown format"}i.r(n),i.d(n,"color",(function(){return se})),i.d(n,"controllers",(function(){return ce})),i.d(n,"dom",(function(){return ue})),i.d(n,"gui",(function(){return le})),i.d(n,"GUI",(function(){return he}));var o=Array.prototype.forEach,a=Array.prototype.slice,s={BREAK:{},extend:function extend(t){return this.each(a.call(arguments,1),(function(n){(this.isObject(n)?Object.keys(n):[]).forEach(function(i){this.isUndefined(n[i])||(t[i]=n[i])}.bind(this))}),this),t},defaults:function defaults(t){return this.each(a.call(arguments,1),(function(n){(this.isObject(n)?Object.keys(n):[]).forEach(function(i){this.isUndefined(t[i])&&(t[i]=n[i])}.bind(this))}),this),t},compose:function compose(){var t=a.call(arguments);return function(){for(var n=a.call(arguments),i=t.length-1;i>=0;i--)n=[t[i].apply(this,n)];return n[0]}},each:function each(t,n,i){if(t)if(o&&t.forEach&&t.forEach===o)t.forEach(n,i);else if(t.length===t.length+0){var a,s=void 0;for(s=0,a=t.length;s<a;s++)if(s in t&&n.call(i,t[s],s)===this.BREAK)return}else for(var m in t)if(n.call(i,t[m],m)===this.BREAK)return},defer:function defer(t){setTimeout(t,0)},debounce:function debounce(t,n,i){var o=void 0;return function(){var a=this,s=arguments;function delayed(){o=null,i||t.apply(a,s)}var m=i||!o;clearTimeout(o),o=setTimeout(delayed,n),m&&t.apply(a,s)}},toArray:function toArray(t){return t.toArray?t.toArray():a.call(t)},isUndefined:function isUndefined(t){return void 0===t},isNull:function isNull(t){return null===t},isNaN:function(t){function isNaN(n){return t.apply(this,arguments)}return isNaN.toString=function(){return t.toString()},isNaN}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function isObject(t){return t===Object(t)},isNumber:function isNumber(t){return t===t+0},isString:function isString(t){return t===t+""},isBoolean:function isBoolean(t){return!1===t||!0===t},isFunction:function isFunction(t){return t instanceof Function}},m=[{litmus:s.isString,conversions:{THREE_CHAR_HEX:{read:function read(t){var n=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==n&&{space:"HEX",hex:parseInt("0x"+n[1].toString()+n[1].toString()+n[2].toString()+n[2].toString()+n[3].toString()+n[3].toString(),0)}},write:colorToString},SIX_CHAR_HEX:{read:function read(t){var n=t.match(/^#([A-F0-9]{6})$/i);return null!==n&&{space:"HEX",hex:parseInt("0x"+n[1].toString(),0)}},write:colorToString},CSS_RGB:{read:function read(t){var n=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==n&&{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3])}},write:colorToString},CSS_RGBA:{read:function read(t){var n=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==n&&{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3]),a:parseFloat(n[4])}},write:colorToString}}},{litmus:s.isNumber,conversions:{HEX:{read:function read(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function write(t){return t.hex}}}},{litmus:s.isArray,conversions:{RGB_ARRAY:{read:function read(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function write(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function read(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function write(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:s.isObject,conversions:{RGBA_OBJ:{read:function read(t){return!!(s.isNumber(t.r)&&s.isNumber(t.g)&&s.isNumber(t.b)&&s.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function write(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function read(t){return!!(s.isNumber(t.r)&&s.isNumber(t.g)&&s.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function write(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function read(t){return!!(s.isNumber(t.h)&&s.isNumber(t.s)&&s.isNumber(t.v)&&s.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function write(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function read(t){return!!(s.isNumber(t.h)&&s.isNumber(t.s)&&s.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function write(t){return{h:t.h,s:t.s,v:t.v}}}}}],g=void 0,_=void 0,S=function interpret(){_=!1;var t=arguments.length>1?s.toArray(arguments):arguments[0];return s.each(m,(function(n){if(n.litmus(t))return s.each(n.conversions,(function(n,i){if(g=n.read(t),!1===_&&!1!==g)return _=g,g.conversionName=i,g.conversion=n,s.BREAK})),s.BREAK})),_},M=void 0,T={hsv_to_rgb:function hsv_to_rgb(t,n,i){var o=Math.floor(t/60)%6,a=t/60-Math.floor(t/60),s=i*(1-n),m=i*(1-a*n),g=i*(1-(1-a)*n),_=[[i,g,s],[m,i,s],[s,i,g],[s,m,i],[g,s,i],[i,s,m]][o];return{r:255*_[0],g:255*_[1],b:255*_[2]}},rgb_to_hsv:function rgb_to_hsv(t,n,i){var o=Math.min(t,n,i),a=Math.max(t,n,i),s=a-o,m=void 0;return 0===a?{h:NaN,s:0,v:0}:(m=t===a?(n-i)/s:n===a?2+(i-t)/s:4+(t-n)/s,(m/=6)<0&&(m+=1),{h:360*m,s:s/a,v:a/255})},rgb_to_hex:function rgb_to_hex(t,n,i){var o=this.hex_with_component(0,2,t);return o=this.hex_with_component(o,1,n),this.hex_with_component(o,0,i)},component_from_hex:function component_from_hex(t,n){return t>>8*n&255},hex_with_component:function hex_with_component(t,n,i){return i<<(M=8*n)|t&~(255<<M)}},O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},A=function(){function defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,i){return n&&defineProperties(t.prototype,n),i&&defineProperties(t,i),t}}(),P=function get(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:get(a,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0},inherits=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},possibleConstructorReturn=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},L=function(){function Color(){if(classCallCheck(this,Color),this.__state=S.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return A(Color,[{key:"toString",value:function toString(){return colorToString(this)}},{key:"toHexString",value:function toHexString(){return colorToString(this,!0)}},{key:"toOriginal",value:function toOriginal(){return this.__state.conversion.write(this)}}]),Color}();function defineRGBComponent(t,n,i){Object.defineProperty(t,n,{get:function get$$1(){return"RGB"===this.__state.space||L.recalculateRGB(this,n,i),this.__state[n]},set:function set$$1(t){"RGB"!==this.__state.space&&(L.recalculateRGB(this,n,i),this.__state.space="RGB"),this.__state[n]=t}})}function defineHSVComponent(t,n){Object.defineProperty(t,n,{get:function get$$1(){return"HSV"===this.__state.space||L.recalculateHSV(this),this.__state[n]},set:function set$$1(t){"HSV"!==this.__state.space&&(L.recalculateHSV(this),this.__state.space="HSV"),this.__state[n]=t}})}L.recalculateRGB=function(t,n,i){if("HEX"===t.__state.space)t.__state[n]=T.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");s.extend(t.__state,T.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},L.recalculateHSV=function(t){var n=T.rgb_to_hsv(t.r,t.g,t.b);s.extend(t.__state,{s:n.s,v:n.v}),s.isNaN(n.h)?s.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=n.h},L.COMPONENTS=["r","g","b","h","s","v","hex","a"],defineRGBComponent(L.prototype,"r",2),defineRGBComponent(L.prototype,"g",1),defineRGBComponent(L.prototype,"b",0),defineHSVComponent(L.prototype,"h"),defineHSVComponent(L.prototype,"s"),defineHSVComponent(L.prototype,"v"),Object.defineProperty(L.prototype,"a",{get:function get$$1(){return this.__state.a},set:function set$$1(t){this.__state.a=t}}),Object.defineProperty(L.prototype,"hex",{get:function get$$1(){return"HEX"!==this.__state.space&&(this.__state.hex=T.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function set$$1(t){this.__state.space="HEX",this.__state.hex=t}});var R=function(){function Controller(t,n){classCallCheck(this,Controller),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return A(Controller,[{key:"onChange",value:function onChange(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function onFinishChange(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function setValue(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function getValue(){return this.object[this.property]}},{key:"updateDisplay",value:function updateDisplay(){return this}},{key:"isModified",value:function isModified(){return this.initialValue!==this.getValue()}}]),Controller}(),N={};s.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,n){s.each(t,(function(t){N[t]=n}))}));var I=/(\d+(\.\d+)?)px/;function cssValueToPixels(t){if("0"===t||s.isUndefined(t))return 0;var n=t.match(I);return s.isNull(n)?0:parseFloat(n[1])}var j={makeSelectable:function makeSelectable(t,n){void 0!==t&&void 0!==t.style&&(t.onselectstart=n?function(){return!1}:function(){},t.style.MozUserSelect=n?"auto":"none",t.style.KhtmlUserSelect=n?"auto":"none",t.unselectable=n?"on":"off")},makeFullscreen:function makeFullscreen(t,n,i){var o=i,a=n;s.isUndefined(a)&&(a=!0),s.isUndefined(o)&&(o=!0),t.style.position="absolute",a&&(t.style.left=0,t.style.right=0),o&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function fakeEvent(t,n,i,o){var a=i||{},m=N[n];if(!m)throw new Error("Event type "+n+" not supported.");var g=document.createEvent(m);switch(m){case"MouseEvents":var _=a.x||a.clientX||0,S=a.y||a.clientY||0;g.initMouseEvent(n,a.bubbles||!1,a.cancelable||!0,window,a.clickCount||1,0,0,_,S,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var M=g.initKeyboardEvent||g.initKeyEvent;s.defaults(a,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),M(n,a.bubbles||!1,a.cancelable,window,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode);break;default:g.initEvent(n,a.bubbles||!1,a.cancelable||!0)}s.defaults(g,o),t.dispatchEvent(g)},bind:function bind(t,n,i,o){var a=o||!1;return t.addEventListener?t.addEventListener(n,i,a):t.attachEvent&&t.attachEvent("on"+n,i),j},unbind:function unbind(t,n,i,o){var a=o||!1;return t.removeEventListener?t.removeEventListener(n,i,a):t.detachEvent&&t.detachEvent("on"+n,i),j},addClass:function addClass(t,n){if(void 0===t.className)t.className=n;else if(t.className!==n){var i=t.className.split(/ +/);-1===i.indexOf(n)&&(i.push(n),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return j},removeClass:function removeClass(t,n){if(n)if(t.className===n)t.removeAttribute("class");else{var i=t.className.split(/ +/),o=i.indexOf(n);-1!==o&&(i.splice(o,1),t.className=i.join(" "))}else t.className=void 0;return j},hasClass:function hasClass(t,n){return new RegExp("(?:^|\\s+)"+n+"(?:\\s+|$)").test(t.className)||!1},getWidth:function getWidth(t){var n=getComputedStyle(t);return cssValueToPixels(n["border-left-width"])+cssValueToPixels(n["border-right-width"])+cssValueToPixels(n["padding-left"])+cssValueToPixels(n["padding-right"])+cssValueToPixels(n.width)},getHeight:function getHeight(t){var n=getComputedStyle(t);return cssValueToPixels(n["border-top-width"])+cssValueToPixels(n["border-bottom-width"])+cssValueToPixels(n["padding-top"])+cssValueToPixels(n["padding-bottom"])+cssValueToPixels(n.height)},getOffset:function getOffset(t){var n=t,i={left:0,top:0};if(n.offsetParent)do{i.left+=n.offsetLeft,i.top+=n.offsetTop,n=n.offsetParent}while(n);return i},isActive:function isActive(t){return t===document.activeElement&&(t.type||t.href)}},V=function(t){function BooleanController(t,n){classCallCheck(this,BooleanController);var i=possibleConstructorReturn(this,(BooleanController.__proto__||Object.getPrototypeOf(BooleanController)).call(this,t,n)),o=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),j.bind(i.__checkbox,"change",(function onChange(){o.setValue(!o.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return inherits(BooleanController,t),A(BooleanController,[{key:"setValue",value:function setValue(t){var n=P(BooleanController.prototype.__proto__||Object.getPrototypeOf(BooleanController.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function updateDisplay(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),P(BooleanController.prototype.__proto__||Object.getPrototypeOf(BooleanController.prototype),"updateDisplay",this).call(this)}}]),BooleanController}(R),U=function(t){function OptionController(t,n,i){classCallCheck(this,OptionController);var o=possibleConstructorReturn(this,(OptionController.__proto__||Object.getPrototypeOf(OptionController)).call(this,t,n)),a=i,m=o;if(o.__select=document.createElement("select"),s.isArray(a)){var g={};s.each(a,(function(t){g[t]=t})),a=g}return s.each(a,(function(t,n){var i=document.createElement("option");i.innerHTML=n,i.setAttribute("value",t),m.__select.appendChild(i)})),o.updateDisplay(),j.bind(o.__select,"change",(function(){var t=this.options[this.selectedIndex].value;m.setValue(t)})),o.domElement.appendChild(o.__select),o}return inherits(OptionController,t),A(OptionController,[{key:"setValue",value:function setValue(t){var n=P(OptionController.prototype.__proto__||Object.getPrototypeOf(OptionController.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function updateDisplay(){return j.isActive(this.__select)?this:(this.__select.value=this.getValue(),P(OptionController.prototype.__proto__||Object.getPrototypeOf(OptionController.prototype),"updateDisplay",this).call(this))}}]),OptionController}(R),G=function(t){function StringController(t,n){classCallCheck(this,StringController);var i=possibleConstructorReturn(this,(StringController.__proto__||Object.getPrototypeOf(StringController)).call(this,t,n)),o=i;function onChange(){o.setValue(o.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),j.bind(i.__input,"keyup",onChange),j.bind(i.__input,"change",onChange),j.bind(i.__input,"blur",(function onBlur(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),j.bind(i.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return inherits(StringController,t),A(StringController,[{key:"updateDisplay",value:function updateDisplay(){return j.isActive(this.__input)||(this.__input.value=this.getValue()),P(StringController.prototype.__proto__||Object.getPrototypeOf(StringController.prototype),"updateDisplay",this).call(this)}}]),StringController}(R);function numDecimals(t){var n=t.toString();return n.indexOf(".")>-1?n.length-n.indexOf(".")-1:0}var z=function(t){function NumberController(t,n,i){classCallCheck(this,NumberController);var o=possibleConstructorReturn(this,(NumberController.__proto__||Object.getPrototypeOf(NumberController)).call(this,t,n)),a=i||{};return o.__min=a.min,o.__max=a.max,o.__step=a.step,s.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=numDecimals(o.__impliedStep),o}return inherits(NumberController,t),A(NumberController,[{key:"setValue",value:function setValue(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),P(NumberController.prototype.__proto__||Object.getPrototypeOf(NumberController.prototype),"setValue",this).call(this,n)}},{key:"min",value:function min(t){return this.__min=t,this}},{key:"max",value:function max(t){return this.__max=t,this}},{key:"step",value:function step(t){return this.__step=t,this.__impliedStep=t,this.__precision=numDecimals(t),this}}]),NumberController}(R),H=function(t){function NumberControllerBox(t,n,i){classCallCheck(this,NumberControllerBox);var o=possibleConstructorReturn(this,(NumberControllerBox.__proto__||Object.getPrototypeOf(NumberControllerBox)).call(this,t,n,i));o.__truncationSuspended=!1;var a=o,m=void 0;function onFinish(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function onMouseDrag(t){var n=m-t.clientY;a.setValue(a.getValue()+n*a.__impliedStep),m=t.clientY}function onMouseUp(){j.unbind(window,"mousemove",onMouseDrag),j.unbind(window,"mouseup",onMouseUp),onFinish()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),j.bind(o.__input,"change",(function onChange(){var t=parseFloat(a.__input.value);s.isNaN(t)||a.setValue(t)})),j.bind(o.__input,"blur",(function onBlur(){onFinish()})),j.bind(o.__input,"mousedown",(function onMouseDown(t){j.bind(window,"mousemove",onMouseDrag),j.bind(window,"mouseup",onMouseUp),m=t.clientY})),j.bind(o.__input,"keydown",(function(t){13===t.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,onFinish())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return inherits(NumberControllerBox,t),A(NumberControllerBox,[{key:"updateDisplay",value:function updateDisplay(){return this.__input.value=this.__truncationSuspended?this.getValue():function roundToDecimal(t,n){var i=Math.pow(10,n);return Math.round(t*i)/i}(this.getValue(),this.__precision),P(NumberControllerBox.prototype.__proto__||Object.getPrototypeOf(NumberControllerBox.prototype),"updateDisplay",this).call(this)}}]),NumberControllerBox}(z);function map(t,n,i,o,a){return o+(t-n)/(i-n)*(a-o)}var q=function(t){function NumberControllerSlider(t,n,i,o,a){classCallCheck(this,NumberControllerSlider);var s=possibleConstructorReturn(this,(NumberControllerSlider.__proto__||Object.getPrototypeOf(NumberControllerSlider)).call(this,t,n,{min:i,max:o,step:a})),m=s;function onMouseDrag(t){t.preventDefault();var n=m.__background.getBoundingClientRect();return m.setValue(map(t.clientX,n.left,n.right,m.__min,m.__max)),!1}function onMouseUp(){j.unbind(window,"mousemove",onMouseDrag),j.unbind(window,"mouseup",onMouseUp),m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())}function onTouchMove(t){var n=t.touches[0].clientX,i=m.__background.getBoundingClientRect();m.setValue(map(n,i.left,i.right,m.__min,m.__max))}function onTouchEnd(){j.unbind(window,"touchmove",onTouchMove),j.unbind(window,"touchend",onTouchEnd),m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),j.bind(s.__background,"mousedown",(function onMouseDown(t){document.activeElement.blur(),j.bind(window,"mousemove",onMouseDrag),j.bind(window,"mouseup",onMouseUp),onMouseDrag(t)})),j.bind(s.__background,"touchstart",(function onTouchStart(t){1===t.touches.length&&(j.bind(window,"touchmove",onTouchMove),j.bind(window,"touchend",onTouchEnd),onTouchMove(t))})),j.addClass(s.__background,"slider"),j.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return inherits(NumberControllerSlider,t),A(NumberControllerSlider,[{key:"updateDisplay",value:function updateDisplay(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",P(NumberControllerSlider.prototype.__proto__||Object.getPrototypeOf(NumberControllerSlider.prototype),"updateDisplay",this).call(this)}}]),NumberControllerSlider}(z),Z=function(t){function FunctionController(t,n,i){classCallCheck(this,FunctionController);var o=possibleConstructorReturn(this,(FunctionController.__proto__||Object.getPrototypeOf(FunctionController)).call(this,t,n)),a=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===i?"Fire":i,j.bind(o.__button,"click",(function(t){return t.preventDefault(),a.fire(),!1})),j.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return inherits(FunctionController,t),A(FunctionController,[{key:"fire",value:function fire(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),FunctionController}(R),X=function(t){function ColorController(t,n){classCallCheck(this,ColorController);var i=possibleConstructorReturn(this,(ColorController.__proto__||Object.getPrototypeOf(ColorController)).call(this,t,n));i.__color=new L(i.getValue()),i.__temp=new L(0);var o=i;i.domElement=document.createElement("div"),j.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",j.bind(i.__input,"keydown",(function(t){13===t.keyCode&&onBlur.call(this)})),j.bind(i.__input,"blur",onBlur),j.bind(i.__selector,"mousedown",(function(){j.addClass(this,"drag").bind(window,"mouseup",(function(){j.removeClass(o.__selector,"drag")}))})),j.bind(i.__selector,"touchstart",(function(){j.addClass(this,"drag").bind(window,"touchend",(function(){j.removeClass(o.__selector,"drag")}))}));var a=document.createElement("div");function fieldDown(t){setSV(t),j.bind(window,"mousemove",setSV),j.bind(window,"touchmove",setSV),j.bind(window,"mouseup",fieldUpSV),j.bind(window,"touchend",fieldUpSV)}function fieldDownH(t){setH(t),j.bind(window,"mousemove",setH),j.bind(window,"touchmove",setH),j.bind(window,"mouseup",fieldUpH),j.bind(window,"touchend",fieldUpH)}function fieldUpSV(){j.unbind(window,"mousemove",setSV),j.unbind(window,"touchmove",setSV),j.unbind(window,"mouseup",fieldUpSV),j.unbind(window,"touchend",fieldUpSV),onFinish()}function fieldUpH(){j.unbind(window,"mousemove",setH),j.unbind(window,"touchmove",setH),j.unbind(window,"mouseup",fieldUpH),j.unbind(window,"touchend",fieldUpH),onFinish()}function onBlur(){var t=S(this.value);!1!==t?(o.__color.__state=t,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function onFinish(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function setSV(t){-1===t.type.indexOf("touch")&&t.preventDefault();var n=o.__saturation_field.getBoundingClientRect(),i=t.touches&&t.touches[0]||t,a=i.clientX,s=i.clientY,m=(a-n.left)/(n.right-n.left),g=1-(s-n.top)/(n.bottom-n.top);return g>1?g=1:g<0&&(g=0),m>1?m=1:m<0&&(m=0),o.__color.v=g,o.__color.s=m,o.setValue(o.__color.toOriginal()),!1}function setH(t){-1===t.type.indexOf("touch")&&t.preventDefault();var n=o.__hue_field.getBoundingClientRect(),i=1-((t.touches&&t.touches[0]||t).clientY-n.top)/(n.bottom-n.top);return i>1?i=1:i<0&&(i=0),o.__color.h=360*i,o.setValue(o.__color.toOriginal()),!1}return s.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),s.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),s.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),s.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),s.extend(a.style,{width:"100%",height:"100%",background:"none"}),linearGradient(a,"top","rgba(0,0,0,0)","#000"),s.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),function hueGradient(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}(i.__hue_field),s.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),j.bind(i.__saturation_field,"mousedown",fieldDown),j.bind(i.__saturation_field,"touchstart",fieldDown),j.bind(i.__field_knob,"mousedown",fieldDown),j.bind(i.__field_knob,"touchstart",fieldDown),j.bind(i.__hue_field,"mousedown",fieldDownH),j.bind(i.__hue_field,"touchstart",fieldDownH),i.__saturation_field.appendChild(a),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return inherits(ColorController,t),A(ColorController,[{key:"updateDisplay",value:function updateDisplay(){var t=S(this.getValue());if(!1!==t){var n=!1;s.each(L.COMPONENTS,(function(i){if(!s.isUndefined(t[i])&&!s.isUndefined(this.__color.__state[i])&&t[i]!==this.__color.__state[i])return n=!0,{}}),this),n&&s.extend(this.__color.__state,t)}s.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,o=255-i;s.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,linearGradient(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),s.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),ColorController}(R),Q=["-moz-","-o-","-webkit-","-ms-",""];function linearGradient(t,n,i,o){t.style.background="",s.each(Q,(function(a){t.style.cssText+="background: "+a+"linear-gradient("+n+", "+i+" 0%, "+o+" 100%); "}))}var Y='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',J=function ControllerFactory(t,n){var i=t[n];return s.isArray(arguments[2])||s.isObject(arguments[2])?new U(t,n,arguments[2]):s.isNumber(i)?s.isNumber(arguments[2])&&s.isNumber(arguments[3])?s.isNumber(arguments[4])?new q(t,n,arguments[2],arguments[3],arguments[4]):new q(t,n,arguments[2],arguments[3]):s.isNumber(arguments[4])?new H(t,n,{min:arguments[2],max:arguments[3],step:arguments[4]}):new H(t,n,{min:arguments[2],max:arguments[3]}):s.isString(i)?new G(t,n):s.isFunction(i)?new Z(t,n,""):s.isBoolean(i)?new V(t,n):null},K=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function requestAnimationFrame(t){setTimeout(t,1e3/60)},$=function(){function CenteredDiv(){classCallCheck(this,CenteredDiv),this.backgroundElement=document.createElement("div"),s.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),j.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),s.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;j.bind(this.backgroundElement,"click",(function(){t.hide()}))}return A(CenteredDiv,[{key:"show",value:function show(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),s.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function hide(){var t=this,hide=function hide(){t.domElement.style.display="none",t.backgroundElement.style.display="none",j.unbind(t.domElement,"webkitTransitionEnd",hide),j.unbind(t.domElement,"transitionend",hide),j.unbind(t.domElement,"oTransitionEnd",hide)};j.bind(this.domElement,"webkitTransitionEnd",hide),j.bind(this.domElement,"transitionend",hide),j.bind(this.domElement,"oTransitionEnd",hide),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function layout(){this.domElement.style.left=window.innerWidth/2-j.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-j.getHeight(this.domElement)/2+"px"}}]),CenteredDiv}();!function inject(t,n){var i=n||document,o=document.createElement("style");o.type="text/css",o.innerHTML=t;var a=i.getElementsByTagName("head")[0];try{a.appendChild(o)}catch(t){}}(function ___$insertStyle(t){if(t&&"undefined"!=typeof window){var n=document.createElement("style");return n.setAttribute("type","text/css"),n.innerHTML=t,document.head.appendChild(n),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var ee=function(){try{return!!window.localStorage}catch(t){return!1}}(),te=void 0,ne=!0,re=void 0,ie=!1,oe=[],ae=function GUI(t){var n=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),j.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=s.defaults(i,{closeOnTop:!1,autoPlace:!0,width:GUI.DEFAULT_WIDTH}),i=s.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),s.isUndefined(i.load)?i.load={preset:"Default"}:i.preset&&(i.load.preset=i.preset),s.isUndefined(i.parent)&&i.hideable&&oe.push(this),i.resizable=s.isUndefined(i.parent)&&i.resizable,i.autoPlace&&s.isUndefined(i.scrollable)&&(i.scrollable=!0);var o=ee&&"true"===localStorage.getItem(getLocalStorageHash(this,"isLocal")),a=void 0,m=void 0;if(Object.defineProperties(this,{parent:{get:function get$$1(){return i.parent}},scrollable:{get:function get$$1(){return i.scrollable}},autoPlace:{get:function get$$1(){return i.autoPlace}},closeOnTop:{get:function get$$1(){return i.closeOnTop}},preset:{get:function get$$1(){return n.parent?n.getRoot().preset:i.load.preset},set:function set$$1(t){n.parent?n.getRoot().preset=t:i.load.preset=t,function setPresetSelectIndex(t){for(var n=0;n<t.__preset_select.length;n++)t.__preset_select[n].value===t.preset&&(t.__preset_select.selectedIndex=n)}(this),n.revert()}},width:{get:function get$$1(){return i.width},set:function set$$1(t){i.width=t,setWidth(n,t)}},name:{get:function get$$1(){return i.name},set:function set$$1(t){i.name=t,m&&(m.innerHTML=i.name)}},closed:{get:function get$$1(){return i.closed},set:function set$$1(t){i.closed=t,i.closed?j.addClass(n.__ul,GUI.CLASS_CLOSED):j.removeClass(n.__ul,GUI.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?GUI.TEXT_OPEN:GUI.TEXT_CLOSED)}},load:{get:function get$$1(){return i.load}},useLocalStorage:{get:function get$$1(){return o},set:function set$$1(t){ee&&(o=t,t?j.bind(window,"unload",a):j.unbind(window,"unload",a),localStorage.setItem(getLocalStorageHash(n,"isLocal"),t))}}}),s.isUndefined(i.parent)){if(this.closed=i.closed||!1,j.addClass(this.domElement,GUI.CLASS_MAIN),j.makeSelectable(this.domElement,!1),ee&&o){n.useLocalStorage=!0;var g=localStorage.getItem(getLocalStorageHash(this,"gui"));g&&(i.load=JSON.parse(g))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=GUI.TEXT_CLOSED,j.addClass(this.__closeButton,GUI.CLASS_CLOSE_BUTTON),i.closeOnTop?(j.addClass(this.__closeButton,GUI.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(j.addClass(this.__closeButton,GUI.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),j.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===i.closed&&(i.closed=!0);var _=document.createTextNode(i.name);j.addClass(_,"controller-name"),m=addRow(n,_),j.addClass(this.__ul,GUI.CLASS_CLOSED),j.addClass(m,"title"),j.bind(m,"click",(function onClickTitle(t){return t.preventDefault(),n.closed=!n.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(s.isUndefined(i.parent)&&(ne&&(re=document.createElement("div"),j.addClass(re,"dg"),j.addClass(re,GUI.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(re),ne=!1),re.appendChild(this.domElement),j.addClass(this.domElement,GUI.CLASS_AUTO_PLACE)),this.parent||setWidth(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},j.bind(window,"resize",this.__resizeHandler),j.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),j.bind(this.__ul,"transitionend",this.__resizeHandler),j.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&addResizeHandle(this),a=function saveToLocalStorage(){ee&&"true"===localStorage.getItem(getLocalStorageHash(n,"isLocal"))&&localStorage.setItem(getLocalStorageHash(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=a,i.parent||function resetWidth(){var t=n.getRoot();t.width+=1,s.defer((function(){t.width-=1}))}()};function addRow(t,n,i){var o=document.createElement("li");return n&&o.appendChild(n),i?t.__ul.insertBefore(o,i):t.__ul.appendChild(o),t.onResize(),o}function removeListeners(t){j.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&j.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function markPresetModified(t,n){var i=t.__preset_select[t.__preset_select.selectedIndex];i.innerHTML=n?i.value+"*":i.value}function recallSavedValue(t,n){var i=t.getRoot(),o=i.__rememberedObjects.indexOf(n.object);if(-1!==o){var a=i.__rememberedObjectIndecesToControllers[o];if(void 0===a&&(a={},i.__rememberedObjectIndecesToControllers[o]=a),a[n.property]=n,i.load&&i.load.remembered){var s=i.load.remembered,m=void 0;if(s[t.preset])m=s[t.preset];else{if(!s.Default)return;m=s.Default}if(m[o]&&void 0!==m[o][n.property]){var g=m[o][n.property];n.initialValue=g,n.setValue(g)}}}}function _add(t,n,i,o){if(void 0===n[i])throw new Error('Object "'+n+'" has no property "'+i+'"');var a=void 0;if(o.color)a=new X(n,i);else{var m=[n,i].concat(o.factoryArgs);a=J.apply(t,m)}o.before instanceof R&&(o.before=o.before.__li),recallSavedValue(t,a),j.addClass(a.domElement,"c");var g=document.createElement("span");j.addClass(g,"property-name"),g.innerHTML=a.property;var _=document.createElement("div");_.appendChild(g),_.appendChild(a.domElement);var S=addRow(t,_,o.before);return j.addClass(S,ae.CLASS_CONTROLLER_ROW),a instanceof X?j.addClass(S,"color"):j.addClass(S,O(a.getValue())),function augmentController(t,n,i){if(i.__li=n,i.__gui=t,s.extend(i,{options:function options(n){if(arguments.length>1){var o=i.__li.nextElementSibling;return i.remove(),_add(t,i.object,i.property,{before:o,factoryArgs:[s.toArray(arguments)]})}if(s.isArray(n)||s.isObject(n)){var a=i.__li.nextElementSibling;return i.remove(),_add(t,i.object,i.property,{before:a,factoryArgs:[n]})}},name:function name(t){return i.__li.firstElementChild.firstElementChild.innerHTML=t,i},listen:function listen(){return i.__gui.listen(i),i},remove:function remove(){return i.__gui.remove(i),i}}),i instanceof q){var o=new H(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});s.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var n=i[t],a=o[t];i[t]=o[t]=function(){var t=Array.prototype.slice.call(arguments);return a.apply(o,t),n.apply(i,t)}})),j.addClass(n,"has-slider"),i.domElement.insertBefore(o.domElement,i.domElement.firstElementChild)}else if(i instanceof H){var a=function r(n){if(s.isNumber(i.__min)&&s.isNumber(i.__max)){var o=i.__li.firstElementChild.firstElementChild.innerHTML,a=i.__gui.__listening.indexOf(i)>-1;i.remove();var m=_add(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return m.name(o),a&&m.listen(),m}return n};i.min=s.compose(a,i.min),i.max=s.compose(a,i.max)}else i instanceof V?(j.bind(n,"click",(function(){j.fakeEvent(i.__checkbox,"click")})),j.bind(i.__checkbox,"click",(function(t){t.stopPropagation()}))):i instanceof Z?(j.bind(n,"click",(function(){j.fakeEvent(i.__button,"click")})),j.bind(n,"mouseover",(function(){j.addClass(i.__button,"hover")})),j.bind(n,"mouseout",(function(){j.removeClass(i.__button,"hover")}))):i instanceof X&&(j.addClass(n,"color"),i.updateDisplay=s.compose((function(t){return n.style.borderLeftColor=i.__color.toString(),t}),i.updateDisplay),i.updateDisplay());i.setValue=s.compose((function(n){return t.getRoot().__preset_select&&i.isModified()&&markPresetModified(t.getRoot(),!0),n}),i.setValue)}(t,S,a),t.__controllers.push(a),a}function getLocalStorageHash(t,n){return document.location.href+"."+n}function addPresetOption(t,n,i){var o=document.createElement("option");o.innerHTML=n,o.value=n,t.__preset_select.appendChild(o),i&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function showHideExplain(t,n){n.style.display=t.useLocalStorage?"block":"none"}function addSaveMenu(t){var n=t.__save_row=document.createElement("li");j.addClass(t.domElement,"has-save"),t.__ul.insertBefore(n,t.__ul.firstChild),j.addClass(n,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",j.addClass(i,"button gears");var o=document.createElement("span");o.innerHTML="Save",j.addClass(o,"button"),j.addClass(o,"save");var a=document.createElement("span");a.innerHTML="New",j.addClass(a,"button"),j.addClass(a,"save-as");var m=document.createElement("span");m.innerHTML="Revert",j.addClass(m,"button"),j.addClass(m,"revert");var g=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?s.each(t.load.remembered,(function(n,i){addPresetOption(t,i,i===t.preset)})):addPresetOption(t,"Default",!1),j.bind(g,"change",(function(){for(var n=0;n<t.__preset_select.length;n++)t.__preset_select[n].innerHTML=t.__preset_select[n].value;t.preset=this.value})),n.appendChild(g),n.appendChild(i),n.appendChild(o),n.appendChild(a),n.appendChild(m),ee){var _=document.getElementById("dg-local-explain"),S=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(getLocalStorageHash(0,"isLocal"))&&S.setAttribute("checked","checked"),showHideExplain(t,_),j.bind(S,"change",(function(){t.useLocalStorage=!t.useLocalStorage,showHideExplain(t,_)}))}var M=document.getElementById("dg-new-constructor");j.bind(M,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||te.hide()})),j.bind(i,"click",(function(){M.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),te.show(),M.focus(),M.select()})),j.bind(o,"click",(function(){t.save()})),j.bind(a,"click",(function(){var n=prompt("Enter a new preset name.");n&&t.saveAs(n)})),j.bind(m,"click",(function(){t.revert()}))}function addResizeHandle(t){var n=void 0;function drag(i){return i.preventDefault(),t.width+=n-i.clientX,t.onResize(),n=i.clientX,!1}function dragStop(){j.removeClass(t.__closeButton,ae.CLASS_DRAG),j.unbind(window,"mousemove",drag),j.unbind(window,"mouseup",dragStop)}function dragStart(i){return i.preventDefault(),n=i.clientX,j.addClass(t.__closeButton,ae.CLASS_DRAG),j.bind(window,"mousemove",drag),j.bind(window,"mouseup",dragStop),!1}t.__resize_handle=document.createElement("div"),s.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),j.bind(t.__resize_handle,"mousedown",dragStart),j.bind(t.__closeButton,"mousedown",dragStart),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function setWidth(t,n){t.domElement.style.width=n+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=n+"px"),t.__closeButton&&(t.__closeButton.style.width=n+"px")}function getCurrentPreset(t,n){var i={};return s.each(t.__rememberedObjects,(function(o,a){var m={},g=t.__rememberedObjectIndecesToControllers[a];s.each(g,(function(t,i){m[i]=n?t.initialValue:t.getValue()})),i[a]=m})),i}ae.toggleHide=function(){ie=!ie,s.each(oe,(function(t){t.domElement.style.display=ie?"none":""}))},ae.CLASS_AUTO_PLACE="a",ae.CLASS_AUTO_PLACE_CONTAINER="ac",ae.CLASS_MAIN="main",ae.CLASS_CONTROLLER_ROW="cr",ae.CLASS_TOO_TALL="taller-than-window",ae.CLASS_CLOSED="closed",ae.CLASS_CLOSE_BUTTON="close-button",ae.CLASS_CLOSE_TOP="close-top",ae.CLASS_CLOSE_BOTTOM="close-bottom",ae.CLASS_DRAG="drag",ae.DEFAULT_WIDTH=245,ae.TEXT_CLOSED="Close Controls",ae.TEXT_OPEN="Open Controls",ae._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||ae.toggleHide()},j.bind(window,"keydown",ae._keydownHandler,!1),s.extend(ae.prototype,{add:function add(t,n){return _add(this,t,n,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function addColor(t,n){return _add(this,t,n,{color:!0})},remove:function remove(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var n=this;s.defer((function(){n.onResize()}))},destroy:function destroy(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&re.removeChild(this.domElement);var t=this;s.each(this.__folders,(function(n){t.removeFolder(n)})),j.unbind(window,"keydown",ae._keydownHandler,!1),removeListeners(this)},addFolder:function addFolder(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var n={name:t,parent:this};n.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(n.closed=this.load.folders[t].closed,n.load=this.load.folders[t]);var i=new ae(n);this.__folders[t]=i;var o=addRow(this,i.domElement);return j.addClass(o,"folder"),i},removeFolder:function removeFolder(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],removeListeners(t);var n=this;s.each(t.__folders,(function(n){t.removeFolder(n)})),s.defer((function(){n.onResize()}))},open:function open(){this.closed=!1},close:function close(){this.closed=!0},hide:function hide(){this.domElement.style.display="none"},show:function show(){this.domElement.style.display=""},onResize:function onResize(){var t=this.getRoot();if(t.scrollable){var n=j.getOffset(t.__ul).top,i=0;s.each(t.__ul.childNodes,(function(n){t.autoPlace&&n===t.__save_row||(i+=j.getHeight(n))})),window.innerHeight-n-20<i?(j.addClass(t.domElement,ae.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-n-20+"px"):(j.removeClass(t.domElement,ae.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&s.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:s.debounce((function(){this.onResize()}),50),remember:function remember(){if(s.isUndefined(te)&&((te=new $).domElement.innerHTML=Y),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;s.each(Array.prototype.slice.call(arguments),(function(n){0===t.__rememberedObjects.length&&addSaveMenu(t),-1===t.__rememberedObjects.indexOf(n)&&t.__rememberedObjects.push(n)})),this.autoPlace&&setWidth(this,this.width)},getRoot:function getRoot(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function getSaveObject(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=getCurrentPreset(this)),t.folders={},s.each(this.__folders,(function(n,i){t.folders[i]=n.getSaveObject()})),t},save:function save(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=getCurrentPreset(this),markPresetModified(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function saveAs(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=getCurrentPreset(this,!0)),this.load.remembered[t]=getCurrentPreset(this),this.preset=t,addPresetOption(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function revert(t){s.each(this.__controllers,(function(n){this.getRoot().load.remembered?recallSavedValue(t||this.getRoot(),n):n.setValue(n.initialValue),n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),this),s.each(this.__folders,(function(t){t.revert(t)})),t||markPresetModified(this.getRoot(),!1)},listen:function listen(t){var n=0===this.__listening.length;this.__listening.push(t),n&&function updateDisplays(t){0!==t.length&&K.call(window,(function(){updateDisplays(t)})),s.each(t,(function(t){t.updateDisplay()}))}(this.__listening)},updateDisplay:function updateDisplay(){s.each(this.__controllers,(function(t){t.updateDisplay()})),s.each(this.__folders,(function(t){t.updateDisplay()}))}});var se={Color:L,math:T,interpret:S},ce={Controller:R,BooleanController:V,OptionController:U,StringController:G,NumberController:z,NumberControllerBox:H,NumberControllerSlider:q,FunctionController:Z,ColorController:X},ue={dom:j},le={GUI:ae},he=ae,de={color:se,controllers:ce,dom:ue,gui:le,GUI:he};n.default=de},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},m=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!((a=(a=m.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.AppManager=n.AppManagerOptions=void 0;var g=i(71),_=i(100),S=i(34),M=i(73),T=i(193),O=i(32),A=i(144),P=i(95),L=i(270),R=i(278),N=i(282),I=i(130),j=i(285),V=i(288),U=i(99);n.AppManagerOptions=function AppManagerOptions(){this.debug=!1,this.boundsmode=!1,this.vr=!1,this.editor=!1};var G=function(t){function AppManager(){var n=t.call(this,null,null)||this;return n.eventManager=new S.EventManager(n),n.editorEventManager=(new S.EditorEventManager).subject,n.renderEventManager=new I.Subject,n.debugMode=!1,n.boundsMode=!1,n.cameraControlsRegistry=new R.CameraControlsRegistryImpl,n.elementsRegistry=new N.ElementsRegistryImpl,n.appManager=n,n.animationManager=new j.AnimationManagerInstance(n),n.historyManager=new V.HistoryManager(n),n.analytics=new U.GoogleAnalytics(n),n}return a(AppManager,t),AppManager.prototype.init=function(n){return s(this,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return[4,t.prototype.init.call(this)];case 1:return o.sent(),T.IsXRSupported()||P.DeviceUtils.IsOculusBrowser()||!n.vr?[3,3]:[4,Promise.resolve().then((function(){return i(581)}))];case 2:o.sent(),o.label=3;case 3:return n.debug&&this.setDebugMode(),n.boundsmode&&(this.boundsMode=!0),this.options=n,n.containerSelector?this.container=document.querySelector(n.containerSelector):(this.container=document.createElement("div"),this.container.id="ByondViewerContainer",document.body.appendChild(this.container)),[2]}}))}))},AppManager.prototype.animateTween=function(){!function _animateTween(t){requestAnimationFrame(_animateTween),g.update(t)}()},AppManager.prototype.Load=function(){return s(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return this.fetchCustomAttributeFromUrl(),this.currentExperience=this.options.experienceManager,[4,this.currentExperience.init()];case 1:return t.sent(),this.injectDependencies(),[2]}}))}))},AppManager.prototype.injectDependencies=function(){var t=this.currentExperience.getMetadata().configuration;if(t&&t&&t.dependencies){var n=t.dependencies.scripts;n&&n.forEach((function(t){M.JsUtils.injectJsFile(t)}));var i=t.dependencies.css;i&&i.forEach((function(t){M.JsUtils.injectCssFile(t)}))}},AppManager.prototype.fetchCustomAttributeFromUrl=function(){var t=this,n=M.JsUtils.GetQuerysFromUrl();n&&(this.metadata=this.metadata||new z,Array.from(n.keys()).forEach((function(i){if(!t.getCustomAttribute(i)){var o=new O.Metadata.CustomAttributesMetadata;o.key=i,o.value=n.get(i),t.metadata.custom_attributes.push(o)}})))},AppManager.prototype.setDebugMode=function(){A.Notify.setDebugMode(!0),this.debugMode=!0,new L.Debug.UIStats(this.appManager)},AppManager.prototype.destroy=function(){t.prototype.destroy.call(this),this.currentExperience.destroy()},AppManager}(_.ByondBaseElement);n.AppManager=G;var z=function(t){function AppMetadata(){var n=null!==t&&t.apply(this,arguments)||this;return n.ElementName="AppMetadata",n.custom_attributes=new Array,n}return a(AppMetadata,t),AppMetadata}(O.Metadata.BaseElementMetadata)},function(t,n){t.exports=o},function(t,n,i){"use strict";i.r(n),i.d(n,"Node",(function(){return o.a})),i.d(n,"TempNode",(function(){return a.a})),i.d(n,"InputNode",(function(){return s.a})),i.d(n,"ConstNode",(function(){return m.a})),i.d(n,"VarNode",(function(){return VarNode})),i.d(n,"StructNode",(function(){return g.a})),i.d(n,"AttributeNode",(function(){return AttributeNode})),i.d(n,"FunctionNode",(function(){return _.a})),i.d(n,"ExpressionNode",(function(){return S.a})),i.d(n,"FunctionCallNode",(function(){return M.a})),i.d(n,"NodeLib",(function(){return T.a})),i.d(n,"NodeUtils",(function(){return O.a})),i.d(n,"NodeFrame",(function(){return NodeFrame})),i.d(n,"NodeUniform",(function(){return A.a})),i.d(n,"NodeBuilder",(function(){return P.a})),i.d(n,"BoolNode",(function(){return BoolNode})),i.d(n,"IntNode",(function(){return IntNode})),i.d(n,"FloatNode",(function(){return L.a})),i.d(n,"Vector2Node",(function(){return R.a})),i.d(n,"Vector3Node",(function(){return N.a})),i.d(n,"Vector4Node",(function(){return I.a})),i.d(n,"ColorNode",(function(){return j.a})),i.d(n,"Matrix3Node",(function(){return Matrix3Node})),i.d(n,"Matrix4Node",(function(){return Matrix4Node})),i.d(n,"TextureNode",(function(){return U.a})),i.d(n,"CubeTextureNode",(function(){return G.a})),i.d(n,"ScreenNode",(function(){return z.a})),i.d(n,"ReflectorNode",(function(){return ReflectorNode})),i.d(n,"PropertyNode",(function(){return PropertyNode})),i.d(n,"RTTNode",(function(){return RTTNode})),i.d(n,"UVNode",(function(){return X.a})),i.d(n,"ColorsNode",(function(){return ColorsNode})),i.d(n,"PositionNode",(function(){return H.a})),i.d(n,"NormalNode",(function(){return J.a})),i.d(n,"CameraNode",(function(){return CameraNode})),i.d(n,"LightNode",(function(){return LightNode})),i.d(n,"ReflectNode",(function(){return K.a})),i.d(n,"ScreenUVNode",(function(){return ScreenUVNode})),i.d(n,"ResolutionNode",(function(){return ResolutionNode})),i.d(n,"MathNode",(function(){return $.a})),i.d(n,"OperatorNode",(function(){return q.a})),i.d(n,"CondNode",(function(){return CondNode})),i.d(n,"NoiseNode",(function(){return NoiseNode})),i.d(n,"CheckerNode",(function(){return CheckerNode})),i.d(n,"TextureCubeUVNode",(function(){return te.a})),i.d(n,"TextureCubeNode",(function(){return ne.a})),i.d(n,"NormalMapNode",(function(){return NormalMapNode})),i.d(n,"BumpMapNode",(function(){return BumpMapNode})),i.d(n,"BypassNode",(function(){return BypassNode})),i.d(n,"JoinNode",(function(){return JoinNode})),i.d(n,"SwitchNode",(function(){return SwitchNode})),i.d(n,"TimerNode",(function(){return TimerNode})),i.d(n,"VelocityNode",(function(){return VelocityNode})),i.d(n,"UVTransformNode",(function(){return UVTransformNode})),i.d(n,"MaxMIPLevelNode",(function(){return MaxMIPLevelNode})),i.d(n,"SpecularMIPLevelNode",(function(){return SpecularMIPLevelNode})),i.d(n,"ColorSpaceNode",(function(){return oe.a})),i.d(n,"SubSlotNode",(function(){return SubSlotNode})),i.d(n,"BlurNode",(function(){return BlurNode})),i.d(n,"ColorAdjustmentNode",(function(){return ColorAdjustmentNode})),i.d(n,"LuminanceNode",(function(){return LuminanceNode})),i.d(n,"RawNode",(function(){return ae.a})),i.d(n,"BasicNode",(function(){return BasicNode})),i.d(n,"SpriteNode",(function(){return SpriteNode})),i.d(n,"PhongNode",(function(){return PhongNode})),i.d(n,"StandardNode",(function(){return StandardNode})),i.d(n,"MeshStandardNode",(function(){return MeshStandardNode})),i.d(n,"NodeMaterial",(function(){return Z.a})),i.d(n,"BasicNodeMaterial",(function(){return BasicNodeMaterial})),i.d(n,"SpriteNodeMaterial",(function(){return SpriteNodeMaterial})),i.d(n,"PhongNodeMaterial",(function(){return PhongNodeMaterial})),i.d(n,"StandardNodeMaterial",(function(){return StandardNodeMaterial})),i.d(n,"MeshStandardNodeMaterial",(function(){return MeshStandardNodeMaterial})),i.d(n,"NodePostProcessing",(function(){return NodePostProcessing}));var o=i(8),a=i(2),s=i(6),m=i(16);function VarNode(t,n){o.a.call(this,t),this.value=n}VarNode.prototype=Object.create(o.a.prototype),VarNode.prototype.constructor=VarNode,VarNode.prototype.nodeType="Var",VarNode.prototype.getType=function(t){return t.getTypeByFormat(this.type)},VarNode.prototype.generate=function(t,n){var i=t.getVar(this.uuid,this.type);return this.value&&t.isShader("vertex")&&t.addNodeCode(i.name+" = "+this.value.build(t,this.getType(t))+";"),t.format(i.name,this.getType(t),n)},VarNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.type=t.type,this.value=t.value,this},VarNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).type=this.type,this.value&&(n.value=this.value.toJSON(t).uuid)),n};var g=i(111);function AttributeNode(t,n){o.a.call(this,n),this.name=t}AttributeNode.prototype=Object.create(o.a.prototype),AttributeNode.prototype.constructor=AttributeNode,AttributeNode.prototype.nodeType="Attribute",AttributeNode.prototype.getAttributeType=function(t){return"number"==typeof this.type?t.getConstructorFromLength(this.type):this.type},AttributeNode.prototype.getType=function(t){var n=this.getAttributeType(t);return t.getTypeByFormat(n)},AttributeNode.prototype.generate=function(t,n){var i=this.getAttributeType(t),o=t.getAttribute(this.name,i),a=t.isShader("vertex")?this.name:o.varying.name;return t.format(a,this.getType(t),n)},AttributeNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.type=t.type,this},AttributeNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).type=this.type),n};var _=i(7),S=i(15),M=i(133),T=i(24),O=i(20);function NodeFrame(t){this.time=void 0!==t?t:0,this.id=0}NodeFrame.prototype={constructor:NodeFrame,update:function(t){return++this.id,this.time+=t,this.delta=t,this},setRenderer:function(t){return this.renderer=t,this},setRenderTexture:function(t){return this.renderTexture=t,this},updateNode:function(t){return t.frameId===this.id||(t.updateFrame(this),t.frameId=this.id),this}};var A=i(166),P=i(112);function BoolNode(t){s.a.call(this,"b"),this.value=Boolean(t)}function IntNode(t){s.a.call(this,"i"),this.value=Math.floor(t||0)}BoolNode.prototype=Object.create(s.a.prototype),BoolNode.prototype.constructor=BoolNode,BoolNode.prototype.nodeType="Bool",BoolNode.prototype.generateReadonly=function(t,n,i,o){return t.format(this.value,o,n)},BoolNode.prototype.copy=function(t){return s.a.prototype.copy.call(this,t),this.value=t.value,this},BoolNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value,!0===this.readonly&&(n.readonly=!0)),n},IntNode.prototype=Object.create(s.a.prototype),IntNode.prototype.constructor=IntNode,IntNode.prototype.nodeType="Int",IntNode.prototype.generateReadonly=function(t,n,i,o){return t.format(this.value,o,n)},IntNode.prototype.copy=function(t){return s.a.prototype.copy.call(this,t),this.value=t.value,this},IntNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value,!0===this.readonly&&(n.readonly=!0)),n};var L=i(14),R=i(53),N=i(81),I=i(167),j=i(47),V=i(0);function Matrix3Node(t){s.a.call(this,"m3"),this.value=t||new V.Matrix3}function Matrix4Node(t){s.a.call(this,"m4"),this.value=t||new V.Matrix4}Matrix3Node.prototype=Object.create(s.a.prototype),Matrix3Node.prototype.constructor=Matrix3Node,Matrix3Node.prototype.nodeType="Matrix3",Object.defineProperties(Matrix3Node.prototype,{elements:{set:function(t){this.value.elements=t},get:function(){return this.value.elements}}}),Matrix3Node.prototype.generateReadonly=function(t,n,i,o){return t.format("mat3( "+this.value.elements.join(", ")+" )",o,n)},Matrix3Node.prototype.copy=function(t){return s.a.prototype.copy.call(this,t),this.value.fromArray(t.elements),this},Matrix3Node.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).elements=this.value.elements.concat()),n},Matrix4Node.prototype=Object.create(s.a.prototype),Matrix4Node.prototype.constructor=Matrix4Node,Matrix4Node.prototype.nodeType="Matrix4",Object.defineProperties(Matrix4Node.prototype,{elements:{set:function(t){this.value.elements=t},get:function(){return this.value.elements}}}),Matrix4Node.prototype.generateReadonly=function(t,n,i,o){return t.format("mat4( "+this.value.elements.join(", ")+" )",o,n)},Matrix4Node.prototype.copy=function(t){return s.a.prototype.copy.call(this,t),this.scope.value.fromArray(t.elements),this},Matrix4Node.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).elements=this.value.elements.concat()),n};var U=i(38),G=i(168),z=i(113),H=i(29),q=i(35);function ReflectorNode(t){a.a.call(this,"v4"),t&&this.setMirror(t)}function PropertyNode(t,n,i){s.a.call(this,i),this.object=t,this.property=n}ReflectorNode.prototype=Object.create(a.a.prototype),ReflectorNode.prototype.constructor=ReflectorNode,ReflectorNode.prototype.nodeType="Reflector",ReflectorNode.prototype.setMirror=function(t){this.mirror=t,this.textureMatrix=new Matrix4Node(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new H.a(H.a.LOCAL),this.uv=new q.a(this.textureMatrix,this.localPosition,q.a.MUL),this.uvResult=new q.a(null,this.uv,q.a.ADD),this.texture=new U.a(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)},ReflectorNode.prototype.generate=function(t,n){return t.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===n?this.texture.build(t,n):t.format(this.texture.build(t,this.type),this.type,n)):(console.warn("THREE.ReflectorNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.type,n))},ReflectorNode.prototype.copy=function(t){return s.a.prototype.copy.call(this,t),this.scope.mirror=t.mirror,this},ReflectorNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).mirror=this.mirror.uuid,this.offset&&(n.offset=this.offset.toJSON(t).uuid)),n},PropertyNode.prototype=Object.create(s.a.prototype),PropertyNode.prototype.constructor=PropertyNode,PropertyNode.prototype.nodeType="Property",Object.defineProperties(PropertyNode.prototype,{value:{get:function(){return this.object[this.property]},set:function(t){this.object[this.property]=t}}}),PropertyNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value,n.property=this.property),n};var Z=i(21);function RTTNode(t,n,i,o){o=o||{},this.input=i,this.clear=void 0===o.clear||o.clear,this.renderTarget=new V.WebGLRenderTarget(t,n,o),this.material=new Z.a,this.camera=new V.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new V.Scene,this.quad=new V.Mesh(new V.PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0,U.a.call(this,this.renderTarget.texture)}RTTNode.prototype=Object.create(U.a.prototype),RTTNode.prototype.constructor=RTTNode,RTTNode.prototype.nodeType="RTT",RTTNode.prototype.build=function(t,n,i){var o=new P.a;return o.nodes=t.nodes,o.updaters=t.updaters,this.material.fragment.value=this.input,this.material.build({builder:o}),U.a.prototype.build.call(this,t,n,i)},RTTNode.prototype.updateFramesaveTo=function(t){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();var n=new Z.a;n.fragment.value=this,n.build();var i=new V.Scene,o=new V.Mesh(new V.PlaneBufferGeometry(2,2),n);o.frustumCulled=!1,i.add(o),this.saveToScene=i,this.saveToMaterial=n}this.saveToCurrent=this.saveTo,t.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&t.renderer.clear(),t.renderer.render(this.saveToScene,this.camera)},RTTNode.prototype.updateFrame=function(t){t.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(t),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=t.renderTexture),t.renderer.setRenderTarget(this.renderTarget),this.clear&&t.renderer.clear(),t.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(t)):console.warn("RTTNode need a renderer in NodeFrame")},RTTNode.prototype.copy=function(t){return U.a.prototype.copy.call(this,t),this.saveTo=t.saveTo,this},RTTNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||(n=U.a.prototype.toJSON.call(this,t),this.saveTo&&(n.saveTo=this.saveTo.toJSON(t).uuid)),n};var X=i(41),Q=["color","color2"],Y=["vColor","vColor2"];function ColorsNode(t){a.a.call(this,"v4",{shared:!1}),this.index=t||0}ColorsNode.prototype=Object.create(a.a.prototype),ColorsNode.prototype.constructor=ColorsNode,ColorsNode.prototype.nodeType="Colors",ColorsNode.prototype.generate=function(t,n){t.requires.color[this.index]=!0;var i=t.isShader("vertex")?Q[this.index]:Y[this.index];return t.format(i,this.getType(t),n)},ColorsNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.index=t.index,this},ColorsNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).index=this.index),n};var J=i(54);function CameraNode(t,n){a.a.call(this,"v3"),this.setScope(t||CameraNode.POSITION),this.setCamera(n)}function LightNode(t){a.a.call(this,"v3",{shared:!1}),this.scope=t||LightNode.TOTAL}CameraNode.Nodes={depthColor:new _.a(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"))},CameraNode.POSITION="position",CameraNode.DEPTH="depth",CameraNode.TO_VERTEX="toVertex",CameraNode.prototype=Object.create(a.a.prototype),CameraNode.prototype.constructor=CameraNode,CameraNode.prototype.nodeType="Camera",CameraNode.prototype.setCamera=function(t){this.camera=t,this.updateFrame=void 0!==t?this.onUpdateFrame:void 0},CameraNode.prototype.setScope=function(t){switch(this.scope){case CameraNode.DEPTH:delete this.near,delete this.far}switch(this.scope=t,t){case CameraNode.DEPTH:var n=this.camera;this.near=new L.a(n?n.near:1),this.far=new L.a(n?n.far:1200)}},CameraNode.prototype.getType=function(){switch(this.scope){case CameraNode.DEPTH:return"f"}return this.type},CameraNode.prototype.getUnique=function(){switch(this.scope){case CameraNode.DEPTH:case CameraNode.TO_VERTEX:return!0}return!1},CameraNode.prototype.getShared=function(){switch(this.scope){case CameraNode.POSITION:return!1}return!0},CameraNode.prototype.generate=function(t,n){var i;switch(this.scope){case CameraNode.POSITION:i="cameraPosition";break;case CameraNode.DEPTH:i=t.include(CameraNode.Nodes.depthColor)+"( "+this.near.build(t,"f")+", "+this.far.build(t,"f")+" )";break;case CameraNode.TO_VERTEX:i="normalize( "+new H.a(H.a.WORLD).build(t,"v3")+" - cameraPosition )"}return t.format(i,this.getType(t),n)},CameraNode.prototype.onUpdateFrame=function(){switch(this.scope){case CameraNode.DEPTH:var t=this.camera;this.near.value=t.near,this.far.value=t.far}},CameraNode.prototype.copy=function(t){switch(a.a.prototype.copy.call(this,t),this.setScope(t.scope),t.camera&&this.setCamera(t.camera),t.scope){case CameraNode.DEPTH:this.near.number=t.near,this.far.number=t.far}return this},CameraNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);if(!n)switch((n=this.createJSONNode(t)).scope=this.scope,this.camera&&(n.camera=this.camera.uuid),this.scope){case CameraNode.DEPTH:n.near=this.near.value,n.far=this.far.value}return n},LightNode.TOTAL="total",LightNode.prototype=Object.create(a.a.prototype),LightNode.prototype.constructor=LightNode,LightNode.prototype.nodeType="Light",LightNode.prototype.generate=function(t,n){return t.isCache("light")?t.format("reflectedLight.directDiffuse",this.type,n):(console.warn('THREE.LightNode is only compatible in "light" channel.'),t.format("vec3( 0.0 )",this.type,n))},LightNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.scope=t.scope,this},LightNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).scope=this.scope),n};var K=i(87);function ResolutionNode(){R.a.call(this),this.size=new V.Vector2}function ScreenUVNode(t){a.a.call(this,"v2"),this.resolution=t||new ResolutionNode}ResolutionNode.prototype=Object.create(R.a.prototype),ResolutionNode.prototype.constructor=ResolutionNode,ResolutionNode.prototype.nodeType="Resolution",ResolutionNode.prototype.updateFrame=function(t){if(t.renderer){t.renderer.getSize(this.size);var n=t.renderer.getPixelRatio();this.x=this.size.width*n,this.y=this.size.height*n}else console.warn("ResolutionNode need a renderer in NodeFrame")},ResolutionNode.prototype.copy=function(t){return R.a.prototype.copy.call(this,t),this.renderer=t.renderer,this},ResolutionNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).renderer=this.renderer.uuid),n},ScreenUVNode.prototype=Object.create(a.a.prototype),ScreenUVNode.prototype.constructor=ScreenUVNode,ScreenUVNode.prototype.nodeType="ScreenUV",ScreenUVNode.prototype.generate=function(t,n){var i;return t.isShader("fragment")?i="( gl_FragCoord.xy / "+this.resolution.build(t,"v2")+")":(console.warn("THREE.ScreenUVNode is not compatible with "+t.shader+" shader."),i="vec2( 0.0 )"),t.format(i,this.getType(t),n)},ScreenUVNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.resolution=t.resolution,this},ScreenUVNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).resolution=this.resolution.toJSON(t).uuid),n};var $=i(61);function CondNode(t,n,i,o,s){a.a.call(this),this.a=t,this.b=n,this.op=i,this.ifNode=o,this.elseNode=s}function NoiseNode(t){a.a.call(this,"f"),this.uv=t||new X.a}function CheckerNode(t){a.a.call(this,"f"),this.uv=t||new X.a}CondNode.EQUAL="==",CondNode.NOT_EQUAL="!=",CondNode.GREATER=">",CondNode.GREATER_EQUAL=">=",CondNode.LESS="<",CondNode.LESS_EQUAL="<=",CondNode.AND="&&",CondNode.OR="||",CondNode.prototype=Object.create(a.a.prototype),CondNode.prototype.constructor=CondNode,CondNode.prototype.nodeType="Cond",CondNode.prototype.getType=function(t){if(this.ifNode){var n=this.ifNode.getType(t),i=this.elseNode.getType(t);return t.getTypeLength(i)>t.getTypeLength(n)?i:n}return"b"},CondNode.prototype.getCondType=function(t){return t.getTypeLength(this.b.getType(t))>t.getTypeLength(this.a.getType(t))?this.b.getType(t):this.a.getType(t)},CondNode.prototype.generate=function(t,n){var i,o=this.getType(t),a=this.getCondType(t),s=this.a.build(t,a),m=this.b.build(t,a);if(this.ifNode){var g=this.ifNode.build(t,o),_=this.elseNode.build(t,o);i="( "+[s,this.op,m,"?",g,":",_].join(" ")+" )"}else i="( "+s+" "+this.op+" "+m+" )";return t.format(i,this.getType(t),n)},CondNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.a=t.a,this.b=t.b,this.op=t.op,this.ifNode=t.ifNode,this.elseNode=t.elseNode,this},CondNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,n.b=this.b.toJSON(t).uuid,n.op=this.op,n.ifNode&&(n.ifNode=this.ifNode.toJSON(t).uuid),n.elseNode&&(n.elseNode=this.elseNode.toJSON(t).uuid)),n},NoiseNode.prototype=Object.create(a.a.prototype),NoiseNode.prototype.constructor=NoiseNode,NoiseNode.prototype.nodeType="Noise",NoiseNode.Nodes={snoise:new _.a(["float snoise(vec2 co) {","\treturn fract( sin( dot( co.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}"].join("\n"))},NoiseNode.prototype.generate=function(t,n){var i=t.include(NoiseNode.Nodes.snoise);return t.format(i+"( "+this.uv.build(t,"v2")+" )",this.getType(t),n)},NoiseNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.uv=t.uv,this},NoiseNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid),n},CheckerNode.prototype=Object.create(a.a.prototype),CheckerNode.prototype.constructor=CheckerNode,CheckerNode.prototype.nodeType="Noise",CheckerNode.Nodes={checker:new _.a(["float checker( vec2 uv ) {","\tfloat cx = floor( uv.x );","\tfloat cy = floor( uv.y ); ","\tfloat result = mod( cx + cy, 2.0 );","\treturn sign( result );","}"].join("\n"))},CheckerNode.prototype.generate=function(t,n){var i=t.include(CheckerNode.Nodes.checker);return t.format(i+"( "+this.uv.build(t,"v2")+" )",this.getType(t),n)},CheckerNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.uv=t.uv,this},CheckerNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid),n};var ee,te=i(134),ne=i(169);function NormalMapNode(t,n){a.a.call(this,"v3"),this.value=t,this.scale=n||new R.a(1,1)}function BumpMapNode(t,n){a.a.call(this,"v3"),this.value=t,this.scale=n||new L.a(1),this.toNormalMap=!1}function BypassNode(t,n){o.a.call(this),this.code=t,this.value=n}NormalMapNode.Nodes={perturbNormal2Arb:new _.a("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 vUv, vec2 normalScale ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = map * 2.0 - 1.0;\n\n\t\tmapN.xy *= normalScale;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t// Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331\n\n\t\t\tif ( dot( cross( S, T ), N ) < 0.0 ) mapN.xy *= - 1.0;\n\n\t\t#else\n\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}",null,{derivatives:!0})},NormalMapNode.prototype=Object.create(a.a.prototype),NormalMapNode.prototype.constructor=NormalMapNode,NormalMapNode.prototype.nodeType="NormalMap",NormalMapNode.prototype.generate=function(t,n){if(t.isShader("fragment")){var i=t.include(NormalMapNode.Nodes.perturbNormal2Arb);this.normal=this.normal||new J.a,this.position=this.position||new H.a(H.a.VIEW),this.uv=this.uv||new X.a;var o=this.scale.build(t,"v2");return t.material.side===V.BackSide&&(o="-"+o),t.format(i+"( -"+this.position.build(t,"v3")+", "+this.normal.build(t,"v3")+", "+this.value.build(t,"v3")+", "+this.uv.build(t,"v2")+", "+o+" )",this.getType(t),n)}return console.warn("THREE.NormalMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),n)},NormalMapNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.value=t.value,this.scale=t.scale,this},NormalMapNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,n.scale=this.scale.toJSON(t).uuid),n},BumpMapNode.Nodes={dHdxy_fwd:ee=new _.a(["vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {","\tvec2 dSTdx = dFdx( vUv );","\tvec2 dSTdy = dFdy( vUv );","\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;","\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","\treturn vec2( dBx, dBy );","}"].join("\n"),null,{derivatives:!0}),perturbNormalArb:new _.a(["vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );","\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );","\tvec3 vN = surf_norm;","\tvec3 R1 = cross( vSigmaY, vN );","\tvec3 R2 = cross( vN, vSigmaX );","\tfloat fDet = dot( vSigmaX, R1 );","\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );","\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","\treturn normalize( abs( fDet ) * surf_norm - vGrad );","}"].join("\n"),[ee],{derivatives:!0}),bumpToNormal:new _.a(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );","}"].join("\n"),null,{derivatives:!0})},BumpMapNode.prototype=Object.create(a.a.prototype),BumpMapNode.prototype.constructor=BumpMapNode,BumpMapNode.prototype.nodeType="BumpMap",BumpMapNode.prototype.hashProperties=["toNormalMap"],BumpMapNode.prototype.generate=function(t,n){if(t.isShader("fragment")){if(this.toNormalMap){var i=t.include(BumpMapNode.Nodes.bumpToNormal);return t.format(i+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )",this.getType(t),n)}var o=t.include(BumpMapNode.Nodes.dHdxy_fwd),a=t.include(BumpMapNode.Nodes.perturbNormalArb);this.normal=this.normal||new J.a,this.position=this.position||new H.a(H.a.VIEW);var s=o+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )";return t.format(a+"( -"+this.position.build(t,"v3")+", "+this.normal.build(t,"v3")+", "+s+" )",this.getType(t),n)}return console.warn("THREE.BumpMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),n)},BumpMapNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.value=t.value,this.scale=t.scale,this},BumpMapNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,n.scale=this.scale.toJSON(t).uuid),n},BypassNode.prototype=Object.create(o.a.prototype),BypassNode.prototype.constructor=BypassNode,BypassNode.prototype.nodeType="Bypass",BypassNode.prototype.getType=function(t){return this.value?this.value.getType(t):t.isShader("fragment")?"f":"void"},BypassNode.prototype.generate=function(t,n){var i=this.code.build(t,n)+";";return t.addNodeCode(i),t.isShader("vertex")?this.value?this.value.build(t,n):void 0:this.value?this.value.build(t,n):t.format("0.0","f",n)},BypassNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.code=t.code,this.value=t.value,this},BypassNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).code=this.code.toJSON(t).uuid,this.value&&(n.value=this.value.toJSON(t).uuid)),n};var re=O.a.elements;function JoinNode(t,n,i,o){a.a.call(this,"f"),this.x=t,this.y=n,this.z=i,this.w=o}function SwitchNode(t,n){o.a.call(this),this.node=t,this.components=n||"x"}function TimerNode(t,n,i){L.a.call(this),this.scale=void 0!==t?t:1,this.scope=n||TimerNode.GLOBAL,this.timeScale=void 0!==i?i:void 0!==t}function VelocityNode(t,n){N.a.call(this),this.params={},this.velocity=new V.Vector3,this.setTarget(t),this.setParams(n)}function UVTransformNode(t,n){S.a.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=t||new X.a,this.position=n||new Matrix3Node}function MaxMIPLevelNode(t){L.a.call(this),this.texture=t,this.maxMIPLevel=0}function SpecularMIPLevelNode(t,n){a.a.call(this,"f"),this.roughness=t,this.texture=n,this.maxMIPLevel=void 0}JoinNode.prototype=Object.create(a.a.prototype),JoinNode.prototype.constructor=JoinNode,JoinNode.prototype.nodeType="Join",JoinNode.prototype.getNumElements=function(){for(var t=re.length;t--;)if(void 0!==this[re[t]]){++t;break}return Math.max(t,2)},JoinNode.prototype.getType=function(t){return t.getTypeFromLength(this.getNumElements())},JoinNode.prototype.generate=function(t,n){for(var i=this.getType(t),o=this.getNumElements(),a=[],s=0;s<o;s++){var m=this[re[s]];a.push(m?m.build(t,"f"):"0.0")}var g=(o>1?t.getConstructorFromLength(o):"")+"( "+a.join(", ")+" )";return t.format(g,i,n)},JoinNode.prototype.copy=function(t){for(var n in a.a.prototype.copy.call(this,t),t.inputs)this[n]=t.inputs[n];return this},JoinNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);if(!n){(n=this.createJSONNode(t)).inputs={};for(var i=this.getNumElements(),o=0;o<i;o++){var a=this[re[o]];a&&(n.inputs[re[o]]=a.toJSON(t).uuid)}}return n},SwitchNode.prototype=Object.create(o.a.prototype),SwitchNode.prototype.constructor=SwitchNode,SwitchNode.prototype.nodeType="Switch",SwitchNode.prototype.getType=function(t){return t.getTypeFromLength(this.components.length)},SwitchNode.prototype.generate=function(t,n){var i=this.node.getType(t),o=this.node.build(t,i),a=t.getTypeLength(i)-1;if(a>0){var s,m=0,g=t.colorToVectorProperties(this.components),_=g.length;for(s=0;s<_;s++)m=Math.max(m,t.getIndexByElement(g.charAt(s)));for(m>a&&(m=a),o+=".",s=0;s<_;s++){var S=t.getIndexByElement(g.charAt(s));S>m&&(S=m),o+=t.getElementByIndex(S)}return t.format(o,this.getType(t),n)}return t.format(o,i,n)},SwitchNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.node=t.node,this.components=t.components,this},SwitchNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).node=this.node.toJSON(t).uuid,n.components=this.components),n},TimerNode.GLOBAL="global",TimerNode.LOCAL="local",TimerNode.DELTA="delta",TimerNode.prototype=Object.create(L.a.prototype),TimerNode.prototype.constructor=TimerNode,TimerNode.prototype.nodeType="Timer",TimerNode.prototype.getReadonly=function(){return!1},TimerNode.prototype.getUnique=function(){return this.timeScale&&(this.scope===TimerNode.GLOBAL||this.scope===TimerNode.DELTA)},TimerNode.prototype.updateFrame=function(t){var n=this.timeScale?this.scale:1;switch(this.scope){case TimerNode.LOCAL:this.value+=t.delta*n;break;case TimerNode.DELTA:this.value=t.delta*n;break;default:this.value=t.time*n}},TimerNode.prototype.copy=function(t){return L.a.prototype.copy.call(this,t),this.scope=t.scope,this.scale=t.scale,this.timeScale=t.timeScale,this},TimerNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).scope=this.scope,n.scale=this.scale,n.timeScale=this.timeScale),n},T.a.addKeyword("time",(function(){return new TimerNode})),VelocityNode.prototype=Object.create(N.a.prototype),VelocityNode.prototype.constructor=VelocityNode,VelocityNode.prototype.nodeType="Velocity",VelocityNode.prototype.getReadonly=function(){return!1},VelocityNode.prototype.setParams=function(t){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=t||{},this.params.type){case"elastic":this.moment=new V.Vector3,this.speed=new V.Vector3,this.springVelocity=new V.Vector3,this.lastVelocity=new V.Vector3}},VelocityNode.prototype.setTarget=function(t){this.target&&(delete this.position,delete this.oldPosition),this.target=t,t&&(this.position=t.getWorldPosition(this.position||new V.Vector3),this.oldPosition=this.position.clone())},VelocityNode.prototype.updateFrameVelocity=function(){this.target&&(this.position=this.target.getWorldPosition(this.position||new V.Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},VelocityNode.prototype.updateFrame=function(t){switch(this.updateFrameVelocity(t),this.params.type){case"elastic":var n=t.delta*(this.params.fps||60),i=Math.pow(this.params.spring,n),o=Math.pow(this.params.damping,n);this.velocity.multiplyScalar(Math.exp(-this.params.damping*n)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(o).multiplyScalar(1-i)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(i),this.moment.add(this.springVelocity),this.moment.multiplyScalar(o),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},VelocityNode.prototype.copy=function(t){return N.a.prototype.copy.call(this,t),t.target&&this.setTarget(t.target),this.setParams(t.params),this},VelocityNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||(n=this.createJSONNode(t),this.target&&(n.target=this.target.uuid),n.params=JSON.parse(JSON.stringify(this.params))),n},UVTransformNode.prototype=Object.create(S.a.prototype),UVTransformNode.prototype.constructor=UVTransformNode,UVTransformNode.prototype.nodeType="UVTransform",UVTransformNode.prototype.generate=function(t,n){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,S.a.prototype.generate.call(this,t,n)},UVTransformNode.prototype.setUvTransform=function(t,n,i,o,a,s,m){s=void 0!==s?s:.5,m=void 0!==m?m:.5,this.position.value.setUvTransform(t,n,i,o,a,s,m)},UVTransformNode.prototype.copy=function(t){return S.a.prototype.copy.call(this,t),this.uv=t.uv,this.position=t.position,this},UVTransformNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid,n.position=this.position.toJSON(t).uuid),n},MaxMIPLevelNode.prototype=Object.create(L.a.prototype),MaxMIPLevelNode.prototype.constructor=MaxMIPLevelNode,MaxMIPLevelNode.prototype.nodeType="MaxMIPLevel",Object.defineProperties(MaxMIPLevelNode.prototype,{value:{get:function(){if(0===this.maxMIPLevel){var t=this.texture.value.image;Array.isArray(t)&&(t=t[0]),this.maxMIPLevel=void 0!==t?Math.log(Math.max(t.width,t.height))*Math.LOG2E:0}return this.maxMIPLevel},set:function(){}}}),MaxMIPLevelNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).texture=this.texture.uuid),n},SpecularMIPLevelNode.Nodes={getSpecularMIPLevel:new _.a(["float getSpecularMIPLevel( const in float roughness, const in float maxMIPLevelScalar ) {","\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );","\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n"))},SpecularMIPLevelNode.prototype=Object.create(a.a.prototype),SpecularMIPLevelNode.prototype.constructor=SpecularMIPLevelNode,SpecularMIPLevelNode.prototype.nodeType="SpecularMIPLevel",SpecularMIPLevelNode.prototype.setTexture=function(t){return this.texture=t,this},SpecularMIPLevelNode.prototype.generate=function(t,n){if(t.isShader("fragment")){this.maxMIPLevel=this.maxMIPLevel||new MaxMIPLevelNode,this.maxMIPLevel.texture=this.texture;var i=t.include(SpecularMIPLevelNode.Nodes.getSpecularMIPLevel);return t.format(i+"( "+this.roughness.build(t,"f")+", "+this.maxMIPLevel.build(t,"f")+" )",this.type,n)}return console.warn("THREE.SpecularMIPLevelNode is not compatible with "+t.shader+" shader."),t.format("0.0",this.type,n)},SpecularMIPLevelNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.texture=t.texture,this.roughness=t.roughness,this},SpecularMIPLevelNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).texture=this.texture,n.roughness=this.roughness),n};var ie,oe=i(60);function SubSlotNode(t){a.a.call(this),this.slots=t||{}}function BlurNode(t,n,i,o){a.a.call(this,"v4"),this.value=t,this.uv=n||new X.a,this.radius=i||new R.a(1,1),this.size=o,this.blurX=!0,this.blurY=!0,this.horizontal=new L.a(1/64),this.vertical=new L.a(1/64)}function LuminanceNode(t){a.a.call(this,"f"),this.rgb=t}function ColorAdjustmentNode(t,n,i){a.a.call(this,"v3"),this.rgb=t,this.adjustment=n,this.method=i||ColorAdjustmentNode.SATURATION}SubSlotNode.prototype=Object.create(a.a.prototype),SubSlotNode.prototype.constructor=SubSlotNode,SubSlotNode.prototype.nodeType="SubSlot",SubSlotNode.prototype.getType=function(t,n){return n},SubSlotNode.prototype.generate=function(t,n){return this.slots[t.slot]?this.slots[t.slot].build(t,n):t.format("0.0","f",n)},SubSlotNode.prototype.copy=function(t){for(var n in a.a.prototype.copy.call(this,t),t.slots)this.slots[n]=t.slots[n];return this},SubSlotNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);if(!n)for(var i in(n=this.createJSONNode(t)).slots={},this.slots){var o=this.slots[i];o&&(n.slots[i]=o.toJSON(t).uuid)}return n},BlurNode.Nodes={blurX:new _.a(["vec4 blurX( sampler2D tex, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tex, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( tex, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( tex, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum * .667;","}"].join("\n")),blurY:new _.a(["vec4 blurY( sampler2D tex, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tex, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum * .667;","}"].join("\n"))},BlurNode.prototype=Object.create(a.a.prototype),BlurNode.prototype.constructor=BlurNode,BlurNode.prototype.nodeType="Blur",BlurNode.prototype.hashProperties=["blurX","blurY"],BlurNode.prototype.updateFrame=function(){if(this.size)this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var t=this.value.value.image;this.horizontal.value=this.radius.x/t.width,this.vertical.value=this.radius.y/t.height}},BlurNode.prototype.generate=function(t,n){if(t.isShader("fragment")){var i,o=[],a=t.include(BlurNode.Nodes.blurX),s=t.include(BlurNode.Nodes.blurY);return this.blurX&&o.push(a+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.horizontal.build(t,"f")+" )"),this.blurY&&o.push(s+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.vertical.build(t,"f")+" )"),i=2==o.length?"( "+o.join(" + ")+" / 2.0 )":o.length?"( "+o[0]+" )":"vec4( 0.0 )",t.format(i,this.getType(t),n)}return console.warn("THREE.BlurNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),n)},BlurNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.value=t.value,this.uv=t.uv,this.radius=t.radius,void 0!==t.size&&(this.size=new V.Vector2(t.size.x,t.size.y)),this.blurX=t.blurX,this.blurY=t.blurY,this},BlurNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,n.uv=this.uv.toJSON(t).uuid,n.radius=this.radius.toJSON(t).uuid,this.size&&(n.size={x:this.size.x,y:this.size.y}),n.blurX=this.blurX,n.blurY=this.blurY),n},LuminanceNode.Nodes={LUMA:ie=new m.a("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )"),luminance:new _.a(["float luminance( vec3 rgb ) {","\treturn dot( rgb, LUMA );","}"].join("\n"),[ie])},LuminanceNode.prototype=Object.create(a.a.prototype),LuminanceNode.prototype.constructor=LuminanceNode,LuminanceNode.prototype.nodeType="Luminance",LuminanceNode.prototype.generate=function(t,n){var i=t.include(LuminanceNode.Nodes.luminance);return t.format(i+"( "+this.rgb.build(t,"v3")+" )",this.getType(t),n)},LuminanceNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.rgb=t.rgb,this},LuminanceNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid),n},ColorAdjustmentNode.Nodes={hue:new _.a(["vec3 hue(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n")),saturation:new _.a(["vec3 saturation(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3( luminance( rgb ) );","\treturn mix( intensity, rgb, adjustment );","}"].join("\n"),[LuminanceNode.Nodes.luminance]),vibrance:new _.a(["vec3 vibrance(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))},ColorAdjustmentNode.SATURATION="saturation",ColorAdjustmentNode.HUE="hue",ColorAdjustmentNode.VIBRANCE="vibrance",ColorAdjustmentNode.BRIGHTNESS="brightness",ColorAdjustmentNode.CONTRAST="contrast",ColorAdjustmentNode.prototype=Object.create(a.a.prototype),ColorAdjustmentNode.prototype.constructor=ColorAdjustmentNode,ColorAdjustmentNode.prototype.nodeType="ColorAdjustment",ColorAdjustmentNode.prototype.hashProperties=["method"],ColorAdjustmentNode.prototype.generate=function(t,n){var i=this.rgb.build(t,"v3"),o=this.adjustment.build(t,"f");switch(this.method){case ColorAdjustmentNode.BRIGHTNESS:return t.format("( "+i+" + "+o+" )",this.getType(t),n);case ColorAdjustmentNode.CONTRAST:return t.format("( "+i+" * "+o+" )",this.getType(t),n)}var a=t.include(ColorAdjustmentNode.Nodes[this.method]);return t.format(a+"( "+i+", "+o+" )",this.getType(t),n)},ColorAdjustmentNode.prototype.copy=function(t){return a.a.prototype.copy.call(this,t),this.rgb=t.rgb,this.adjustment=t.adjustment,this.method=t.method,this},ColorAdjustmentNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid,n.adjustment=this.adjustment.toJSON(t).uuid,n.method=this.method),n};var ae=i(135);function BasicNode(){o.a.call(this),this.color=new j.a(16777215)}function SpriteNode(){o.a.call(this),this.color=new j.a(15658734),this.spherical=!0}function PhongNode(){o.a.call(this),this.color=new j.a(15658734),this.specular=new j.a(1118481),this.shininess=new L.a(30)}function StandardNode(){o.a.call(this),this.color=new j.a(16777215),this.roughness=new L.a(1),this.metalness=new L.a(0)}function MeshStandardNode(){StandardNode.call(this),this.properties={color:new V.Color(16777215),roughness:.5,metalness:.5,normalScale:new V.Vector2(1,1)},this.inputs={color:new PropertyNode(this.properties,"color","c"),roughness:new PropertyNode(this.properties,"roughness","f"),metalness:new PropertyNode(this.properties,"metalness","f"),normalScale:new PropertyNode(this.properties,"normalScale","v2")}}function BasicNodeMaterial(){var t=new BasicNode;Z.a.call(this,t,t),this.type="BasicNodeMaterial"}function SpriteNodeMaterial(){var t=new SpriteNode;Z.a.call(this,t,t),this.type="SpriteNodeMaterial"}function PhongNodeMaterial(){var t=new PhongNode;Z.a.call(this,t,t),this.type="PhongNodeMaterial"}function StandardNodeMaterial(){var t=new StandardNode;Z.a.call(this,t,t),this.type="StandardNodeMaterial"}function MeshStandardNodeMaterial(){var t=new MeshStandardNode;Z.a.call(this,t,t),this.type="MeshStandardNodeMaterial"}function NodePostProcessing(t,n){if(void 0===n){var i={minFilter:V.LinearFilter,magFilter:V.LinearFilter,format:V.RGBAFormat},o=t.getDrawingBufferSize(new V.Vector2);n=new V.WebGLRenderTarget(o.width,o.height,i)}this.renderer=t,this.renderTarget=n,this.output=new z.a,this.material=new Z.a,this.camera=new V.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new V.Scene,this.quad=new V.Mesh(new V.PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.needsUpdate=!0}BasicNode.prototype=Object.create(o.a.prototype),BasicNode.prototype.constructor=BasicNode,BasicNode.prototype.nodeType="Basic",BasicNode.prototype.generate=function(t){var n;if(t.isShader("vertex")){var i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED"," varying vec3 vNormal;","#endif"].join("\n"));var o=["#include <beginnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED"," vNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];i&&o.push(i.code,i.result?"transformed = "+i.result+";":""),o.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n=o.join("\n")}else{this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.mask&&this.mask.analyze(t);var a=this.color.flow(t,"c",{slot:"color"}),s=this.alpha?this.alpha.flow(t,"f"):void 0,m=this.mask?this.mask.flow(t,"b"):void 0;t.requires.transparent=void 0!==s,t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED"," varying vec3 vNormal;","#endif"].join("\n")),o=["#include <normal_fragment_begin>",a.code],m&&o.push(m.code,"if ( ! "+m.result+" ) discard;"),s&&o.push(s.code,"#ifdef ALPHATEST"," if ( "+s.result+" <= ALPHATEST ) discard;","#endif"),s?o.push("gl_FragColor = vec4("+a.result+", "+s.result+" );"):o.push("gl_FragColor = vec4("+a.result+", 1.0 );"),n=o.join("\n")}return n},BasicNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),this.color=t.color,t.position&&(this.position=t.position),t.alpha&&(this.alpha=t.alpha),t.mask&&(this.mask=t.mask),this},BasicNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||((n=this.createJSONNode(t)).color=this.color.toJSON(t).uuid,this.position&&(n.position=this.position.toJSON(t).uuid),this.alpha&&(n.alpha=this.alpha.toJSON(t).uuid),this.mask&&(n.mask=this.mask.toJSON(t).uuid)),n},SpriteNode.prototype=Object.create(o.a.prototype),SpriteNode.prototype.constructor=SpriteNode,SpriteNode.prototype.nodeType="Sprite",SpriteNode.prototype.build=function(t){if(t.define("SPRITE"),t.requires.lights=!1,t.requires.transparent=void 0!==this.alpha,t.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(V.UniformsUtils.merge([V.UniformsLib.fog])),t.addParsCode(["#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),s=["#include <clipping_planes_fragment>","#include <begin_vertex>"],n&&s.push(n.code,n.result?"transformed = "+n.result+";":""),s.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||s.push("modelMtx[1][1] = 1.0;"),s.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&s.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),s.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{t.addParsCode(["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>"].join("\n")),t.addCode(["#include <clipping_planes_fragment>","#include <logdepthbuf_fragment>"].join("\n")),this.mask&&this.mask.analyze(t),this.alpha&&this.alpha.analyze(t),this.color.analyze(t,{slot:"color"});var i=this.mask?this.mask.flow(t,"b"):void 0,o=this.alpha?this.alpha.flow(t,"f"):void 0,a=this.color.flow(t,"c",{slot:"color"}),s=[];i&&s.push(i.code,"if ( ! "+i.result+" ) discard;"),o?s.push(o.code,"#ifdef ALPHATEST","if ( "+o.result+" <= ALPHATEST ) discard;","#endif",a.code,"gl_FragColor = vec4( "+a.result+", "+o.result+" );"):s.push(a.code,"gl_FragColor = vec4( "+a.result+", 1.0 );"),s.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return s.join("\n")},SpriteNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),t.position&&(this.position=t.position),this.color=t.color,void 0!==t.spherical&&(this.spherical=t.spherical),t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),this},SpriteNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||(n=this.createJSONNode(t),this.position&&(n.position=this.position.toJSON(t).uuid),n.color=this.color.toJSON(t).uuid,!1===this.spherical&&(n.spherical=!1),this.mask&&(n.mask=this.mask.toJSON(t).uuid),this.alpha&&(n.alpha=this.alpha.toJSON(t).uuid)),n},PhongNode.prototype=Object.create(o.a.prototype),PhongNode.prototype.constructor=PhongNode,PhongNode.prototype.nodeType="Phong",PhongNode.prototype.build=function(t){var n;if(t.define("PHONG"),t.requires.lights=!0,t.isShader("vertex")){var i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(V.UniformsUtils.merge([V.UniformsLib.fog,V.UniformsLib.lights])),t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var o=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];i&&o.push(i.code,i.result?"transformed = "+i.result+";":""),o.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n=o.join("\n")}else{this.mask&&this.mask.analyze(t),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.alpha&&this.alpha.analyze(t),this.normal&&this.normal.analyze(t),this.light&&this.light.analyze(t,{cache:"light"}),this.ao&&this.ao.analyze(t),this.ambient&&this.ambient.analyze(t),this.shadow&&this.shadow.analyze(t),this.emissive&&this.emissive.analyze(t,{slot:"emissive"}),this.environment&&this.environment.analyze(t,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(t);var a=this.mask?this.mask.flow(t,"b"):void 0,s=this.color.flow(t,"c",{slot:"color"}),m=this.specular.flow(t,"c"),g=this.shininess.flow(t,"f"),_=this.alpha?this.alpha.flow(t,"f"):void 0,S=this.normal?this.normal.flow(t,"v3"):void 0,M=this.light?this.light.flow(t,"v3",{cache:"light"}):void 0,T=this.ao?this.ao.flow(t,"f"):void 0,O=this.ambient?this.ambient.flow(t,"c"):void 0,A=this.shadow?this.shadow.flow(t,"c"):void 0,P=this.emissive?this.emissive.flow(t,"c",{slot:"emissive"}):void 0,L=this.environment?this.environment.flow(t,"c",{slot:"environment"}):void 0,R=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(t,"f"):void 0;t.requires.transparent=void 0!==_,t.addParsCode(["#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n")),o=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"],a&&o.push(a.code,"if ( ! "+a.result+" ) discard;"),o.push(s.code,"\tvec3 diffuseColor = "+s.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",m.code,"\tvec3 specular = "+m.result+";",g.code,"\tfloat shininess = max( 0.0001, "+g.result+" );","\tfloat specularStrength = 1.0;"),_&&o.push(_.code,"#ifdef ALPHATEST","if ( "+_.result+" <= ALPHATEST ) discard;","#endif"),S&&o.push(S.code,"normal = "+S.result+";"),o.push("material.diffuseColor = "+(M?"vec3( 1.0 )":"diffuseColor")+";"),o.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),M&&(o.push(M.code,"reflectedLight.directDiffuse = "+M.result+";"),o.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),T&&o.push(T.code,"reflectedLight.indirectDiffuse *= "+T.result+";"),O&&o.push(O.code,"reflectedLight.indirectDiffuse += "+O.result+";"),A&&o.push(A.code,"reflectedLight.directDiffuse *= "+A.result+";","reflectedLight.directSpecular *= "+A.result+";"),P&&o.push(P.code,"reflectedLight.directDiffuse += "+P.result+";"),o.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),L&&(o.push(L.code),R?o.push(R.code,"outgoingLight = mix( outgoingLight, "+L.result+", "+R.result+" );"):o.push("outgoingLight = "+L.result+";")),_?o.push("gl_FragColor = vec4( outgoingLight, "+_.result+" );"):o.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),o.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>"),n=o.join("\n")}return n},PhongNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),t.position&&(this.position=t.position),this.color=t.color,this.specular=t.specular,this.shininess=t.shininess,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.environmentAlpha&&(this.environmentAlpha=t.environmentAlpha),this},PhongNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||(n=this.createJSONNode(t),this.position&&(n.position=this.position.toJSON(t).uuid),n.color=this.color.toJSON(t).uuid,n.specular=this.specular.toJSON(t).uuid,n.shininess=this.shininess.toJSON(t).uuid,this.mask&&(n.mask=this.mask.toJSON(t).uuid),this.alpha&&(n.alpha=this.alpha.toJSON(t).uuid),this.normal&&(n.normal=this.normal.toJSON(t).uuid),this.light&&(n.light=this.light.toJSON(t).uuid),this.ao&&(n.ao=this.ao.toJSON(t).uuid),this.ambient&&(n.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(n.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(n.emissive=this.emissive.toJSON(t).uuid),this.environment&&(n.environment=this.environment.toJSON(t).uuid),this.environmentAlpha&&(n.environmentAlpha=this.environmentAlpha.toJSON(t).uuid)),n},StandardNode.prototype=Object.create(o.a.prototype),StandardNode.prototype.constructor=StandardNode,StandardNode.prototype.nodeType="Standard",StandardNode.prototype.build=function(t){var n;t.define("STANDARD");var i=this.clearcoat||this.clearcoatRoughness||this.clearCoatNormal;if(i&&t.define("CLEARCOAT"),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){var o=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(V.UniformsUtils.merge([V.UniformsLib.fog,V.UniformsLib.lights])),V.UniformsLib.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var a=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];o&&a.push(o.code,o.result?"transformed = "+o.result+";":""),a.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n=a.join("\n")}else{var s=new S.a("material.specularRoughness","f"),m=new S.a("material.clearcoatRoughness","f"),g={roughness:s,bias:new SpecularMIPLevelNode(s),viewNormal:new S.a("normal","v3"),worldNormal:new S.a("inverseTransformDirection( geometry.normal, viewMatrix )","v3"),gamma:!0},_={gamma:!0},M={roughness:m,bias:new SpecularMIPLevelNode(m),viewNormal:new S.a("clearcoatNormal","v3"),worldNormal:new S.a("inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )","v3"),gamma:!0};this.mask&&this.mask.analyze(t),this.color.analyze(t,{slot:"color",context:_}),this.roughness.analyze(t),this.metalness.analyze(t),this.alpha&&this.alpha.analyze(t),this.normal&&this.normal.analyze(t),this.clearcoat&&this.clearcoat.analyze(t),this.clearcoatRoughness&&this.clearcoatRoughness.analyze(t),this.clearcoatNormal&&this.clearcoatNormal.analyze(t),this.reflectivity&&this.reflectivity.analyze(t),this.light&&this.light.analyze(t,{cache:"light"}),this.ao&&this.ao.analyze(t),this.ambient&&this.ambient.analyze(t),this.shadow&&this.shadow.analyze(t),this.emissive&&this.emissive.analyze(t,{slot:"emissive"}),this.environment&&(this.environment.analyze(t,{cache:"radiance",context:g,slot:"radiance"}),t.requires.irradiance&&this.environment.analyze(t,{cache:"irradiance",context:g,slot:"irradiance"})),this.sheen&&this.sheen.analyze(t);var T,O=this.mask?this.mask.flow(t,"b"):void 0,A=this.color.flow(t,"c",{slot:"color",context:_}),P=this.roughness.flow(t,"f"),L=this.metalness.flow(t,"f"),R=this.alpha?this.alpha.flow(t,"f"):void 0,N=this.normal?this.normal.flow(t,"v3"):void 0,I=this.clearcoat?this.clearcoat.flow(t,"f"):void 0,j=(m=this.clearcoatRoughness?this.clearcoatRoughness.flow(t,"f"):void 0,this.clearcoatNormal?this.clearcoatNormal.flow(t,"v3"):void 0),U=this.reflectivity?this.reflectivity.flow(t,"f"):void 0,G=this.light?this.light.flow(t,"v3",{cache:"light"}):void 0,z=this.ao?this.ao.flow(t,"f"):void 0,H=this.ambient?this.ambient.flow(t,"c"):void 0,q=this.shadow?this.shadow.flow(t,"c"):void 0,Z=this.emissive?this.emissive.flow(t,"c",{slot:"emissive"}):void 0;this.environment&&(T={radiance:this.environment.flow(t,"c",{cache:"radiance",context:g,slot:"radiance"})},t.requires.irradiance&&(T.irradiance=this.environment.flow(t,"c",{cache:"irradiance",context:g,slot:"irradiance"})));var X=i&&T?this.environment.flow(t,"c",{cache:"clearcoat",context:M,slot:"environment"}):void 0,Q=this.sheen?this.sheen.flow(t,"c"):void 0;t.requires.transparent=void 0!==R,t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n")),a=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\t#include <clearcoat_normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"],O&&a.push(O.code,"if ( ! "+O.result+" ) discard;"),a.push(A.code,"\tvec3 diffuseColor = "+A.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",P.code,"\tfloat roughnessFactor = "+P.result+";",L.code,"\tfloat metalnessFactor = "+L.result+";"),R&&a.push(R.code,"#ifdef ALPHATEST","\tif ( "+R.result+" <= ALPHATEST ) discard;","#endif"),N&&a.push(N.code,"normal = "+N.result+";"),j&&a.push(j.code,"clearcoatNormal = "+j.result+";"),a.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),a.push("material.diffuseColor = "+(G?"vec3( 1.0 )":"diffuseColor * ( 1.0 - metalnessFactor )")+";","material.specularRoughness = max( roughnessFactor, 0.0525 );","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );"),I?a.push(I.code,"material.clearcoat = saturate( "+I.result+" );"):i&&a.push("material.clearcoat = 0.0;"),m?a.push(m.code,"material.clearcoatRoughness = max( "+m.result+", 0.0525 );","material.clearcoatRoughness += geometryRoughness;","material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );"):i&&a.push("material.clearcoatRoughness = 0.0;"),Q&&a.push("material.sheenColor = "+Q.result+";"),U?a.push(U.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+U.result+" ) ), diffuseColor, metalnessFactor );"):a.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),a.push("#include <lights_fragment_begin>"),G&&(a.push(G.code,"reflectedLight.directDiffuse = "+G.result+";"),a.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),z&&a.push(z.code,"reflectedLight.indirectDiffuse *= "+z.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+z.result+", material.specularRoughness );"),H&&a.push(H.code,"reflectedLight.indirectDiffuse += "+H.result+";"),q&&a.push(q.code,"reflectedLight.directDiffuse *= "+q.result+";","reflectedLight.directSpecular *= "+q.result+";"),Z&&a.push(Z.code,"reflectedLight.directDiffuse += "+Z.result+";"),T&&(a.push(T.radiance.code),t.requires.irradiance&&a.push(T.irradiance.code),X&&a.push(X.code,"clearcoatRadiance += "+X.result+";"),a.push("radiance += "+T.radiance.result+";"),t.requires.irradiance&&a.push("iblIrradiance += PI * "+T.irradiance.result+";")),a.push("#include <lights_fragment_end>"),a.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),R?a.push("gl_FragColor = vec4( outgoingLight, "+R.result+" );"):a.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),a.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>"),n=a.join("\n")}return n},StandardNode.prototype.copy=function(t){return o.a.prototype.copy.call(this,t),t.position&&(this.position=t.position),this.color=t.color,this.roughness=t.roughness,this.metalness=t.metalness,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.clearcoat&&(this.clearcoat=t.clearcoat),t.clearcoatRoughness&&(this.clearcoatRoughness=t.clearcoatRoughness),t.clearcoatNormal&&(this.clearcoatNormal=t.clearcoatNormal),t.reflectivity&&(this.reflectivity=t.reflectivity),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.sheen&&(this.sheen=t.sheen),this},StandardNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||(n=this.createJSONNode(t),this.position&&(n.position=this.position.toJSON(t).uuid),n.color=this.color.toJSON(t).uuid,n.roughness=this.roughness.toJSON(t).uuid,n.metalness=this.metalness.toJSON(t).uuid,this.mask&&(n.mask=this.mask.toJSON(t).uuid),this.alpha&&(n.alpha=this.alpha.toJSON(t).uuid),this.normal&&(n.normal=this.normal.toJSON(t).uuid),this.clearcoat&&(n.clearcoat=this.clearcoat.toJSON(t).uuid),this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness.toJSON(t).uuid),this.clearcoatNormal&&(n.clearcoatNormal=this.clearcoatNormal.toJSON(t).uuid),this.reflectivity&&(n.reflectivity=this.reflectivity.toJSON(t).uuid),this.light&&(n.light=this.light.toJSON(t).uuid),this.shadow&&(n.shadow=this.shadow.toJSON(t).uuid),this.ao&&(n.ao=this.ao.toJSON(t).uuid),this.emissive&&(n.emissive=this.emissive.toJSON(t).uuid),this.ambient&&(n.ambient=this.ambient.toJSON(t).uuid),this.environment&&(n.environment=this.environment.toJSON(t).uuid),this.sheen&&(n.sheen=this.sheen.toJSON(t).uuid)),n},MeshStandardNode.prototype=Object.create(StandardNode.prototype),MeshStandardNode.prototype.constructor=MeshStandardNode,MeshStandardNode.prototype.nodeType="MeshStandard",MeshStandardNode.prototype.build=function(t){var n=this.properties,i=this.inputs;if(t.isShader("fragment")){var o=t.findNode(n.color,i.color),a=t.resolve(n.map);this.color=a?new q.a(o,a,q.a.MUL):o;var s=t.findNode(n.roughness,i.roughness),m=t.resolve(n.roughnessMap);this.roughness=m?new q.a(s,new SwitchNode(m,"g"),q.a.MUL):s;var g=t.findNode(n.metalness,i.metalness),_=t.resolve(n.metalnessMap);this.metalness=_?new q.a(g,new SwitchNode(_,"b"),q.a.MUL):g,n.normalMap?(this.normal=new NormalMapNode(t.resolve(n.normalMap)),this.normal.scale=t.findNode(n.normalScale,i.normalScale)):this.normal=void 0,this.environment=t.resolve(n.envMap)}return StandardNode.prototype.build.call(this,t)},MeshStandardNode.prototype.toJSON=function(t){var n=this.getJSONNode(t);return n||(n=this.createJSONNode(t),console.warn(".toJSON not implemented in",this)),n},BasicNodeMaterial.prototype=Object.create(Z.a.prototype),BasicNodeMaterial.prototype.constructor=BasicNodeMaterial,O.a.addShortcuts(BasicNodeMaterial.prototype,"fragment",["color","alpha","mask","position"]),SpriteNodeMaterial.prototype=Object.create(Z.a.prototype),SpriteNodeMaterial.prototype.constructor=SpriteNodeMaterial,O.a.addShortcuts(SpriteNodeMaterial.prototype,"fragment",["color","alpha","mask","position","spherical"]),PhongNodeMaterial.prototype=Object.create(Z.a.prototype),PhongNodeMaterial.prototype.constructor=PhongNodeMaterial,O.a.addShortcuts(PhongNodeMaterial.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]),StandardNodeMaterial.prototype=Object.create(Z.a.prototype),StandardNodeMaterial.prototype.constructor=StandardNodeMaterial,O.a.addShortcuts(StandardNodeMaterial.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearcoat","clearcoatRoughness","clearcoatNormal","normal","emissive","ambient","light","shadow","ao","environment","mask","position","sheen"]),MeshStandardNodeMaterial.prototype=Object.create(Z.a.prototype),MeshStandardNodeMaterial.prototype.constructor=MeshStandardNodeMaterial,O.a.addShortcuts(MeshStandardNodeMaterial.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]),NodePostProcessing.prototype={constructor:NodePostProcessing,render:function(t,n,i){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.output,this.material.build(),this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=this.renderTarget.texture),this.needsUpdate=!1),i.setRenderer(this.renderer).setRenderTexture(this.renderTarget.texture),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(t,n),i.updateNode(this.material),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},setPixelRatio:function(t){this.renderer.setPixelRatio(t);var n=this.renderer.getSize(new V.Vector2);this.setSize(n.width,n.height)},setSize:function(t,n){var i=this.renderer.getPixelRatio();this.renderTarget.setSize(t*i,n*i),this.renderer.setSize(t,n)},copy:function(t){return this.output=t.output,this},toJSON:function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.post&&(t.post={}),!t.post[this.uuid]){var n={};n.uuid=this.uuid,n.type="NodePostProcessing",t.post[this.uuid]=n,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.output=this.output.toJSON(t).uuid}return t.post=this.uuid,t}}},function(t,n,i){"use strict";i.r(n),i.d(n,"FBXLoader",(function(){return re}));var o=i(0),a={},s=a;function inflate_module_min_r(t,n){var i,o=t.split("."),a=s;!(o[0]in a)&&a.execScript&&a.execScript("var "+o[0]);for(;o.length&&(i=o.shift());)o.length||void 0===n?a=a[i]?a[i]:a[i]={}:a[i]=n}var m="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function inflate_module_min_v(t){var n,i,o,a,s,g,_,S,M,T,O=t.length,A=0,P=Number.POSITIVE_INFINITY;for(S=0;S<O;++S)t[S]>A&&(A=t[S]),t[S]<P&&(P=t[S]);for(n=1<<A,i=new(m?Uint32Array:Array)(n),o=1,a=0,s=2;o<=A;){for(S=0;S<O;++S)if(t[S]===o){for(g=0,_=a,M=0;M<o;++M)g=g<<1|1&_,_>>=1;for(T=o<<16|S,M=g;M<n;M+=s)i[M]=T;++a}++o,a<<=1,s<<=1}return[i,A,P]}function inflate_module_min_w(t,n){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=m?new Uint8Array(t):t,this.m=!1,this.i=_,this.r=!1,!n&&(n={})||(n.index&&(this.a=n.index),n.bufferSize&&(this.h=n.bufferSize),n.bufferType&&(this.i=n.bufferType),n.resize&&(this.r=n.resize)),this.i){case g:this.b=32768,this.c=new(m?Uint8Array:Array)(32768+this.h+258);break;case _:this.b=0,this.c=new(m?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var g=0,_=1,S={t:g,s:_};inflate_module_min_w.prototype.k=function(){for(;!this.m;){var t=inflate_module_min_C(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var n=this.input,i=this.a,o=this.c,a=this.b,s=n.length,S=void 0,M=o.length,T=void 0;if(this.d=this.f=0,i+1>=s)throw Error("invalid uncompressed block header: LEN");if(S=n[i++]|n[i++]<<8,i+1>=s)throw Error("invalid uncompressed block header: NLEN");if(S===~(n[i++]|n[i++]<<8))throw Error("invalid uncompressed block header: length verify");if(i+S>n.length)throw Error("input buffer is broken");switch(this.i){case g:for(;a+S>o.length;){if(S-=T=M-a,m)o.set(n.subarray(i,i+T),a),a+=T,i+=T;else for(;T--;)o[a++]=n[i++];this.b=a,o=this.e(),a=this.b}break;case _:for(;a+S>o.length;)o=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(m)o.set(n.subarray(i,i+S),a),a+=S,i+=S;else for(;S--;)o[a++]=n[i++];this.a=i,this.b=a,this.c=o;break;case 1:this.j(q,X);break;case 2:var O,P,L,R,N=inflate_module_min_C(this,5)+257,I=inflate_module_min_C(this,5)+1,j=inflate_module_min_C(this,4)+4,V=new(m?Uint8Array:Array)(A.length),U=void 0,G=void 0,z=void 0,H=void 0,Z=void 0;for(Z=0;Z<j;++Z)V[A[Z]]=inflate_module_min_C(this,3);if(!m)for(Z=j,j=V.length;Z<j;++Z)V[A[Z]]=0;for(O=inflate_module_min_v(V),U=new(m?Uint8Array:Array)(N+I),Z=0,R=N+I;Z<R;)switch(G=E(this,O),G){case 16:for(H=3+inflate_module_min_C(this,2);H--;)U[Z++]=z;break;case 17:for(H=3+inflate_module_min_C(this,3);H--;)U[Z++]=0;z=0;break;case 18:for(H=11+inflate_module_min_C(this,7);H--;)U[Z++]=0;z=0;break;default:z=U[Z++]=G}P=inflate_module_min_v(m?U.subarray(0,N):U.slice(0,N)),L=inflate_module_min_v(m?U.subarray(N):U.slice(N)),this.j(P,L);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var M,T,O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=m?new Uint16Array(O):O,P=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],L=m?new Uint16Array(P):P,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],N=m?new Uint8Array(R):R,I=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],j=m?new Uint16Array(I):I,V=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],U=m?new Uint8Array(V):V,G=new(m?Uint8Array:Array)(288);for(M=0,T=G.length;M<T;++M)G[M]=143>=M?8:255>=M?9:279>=M?7:8;var z,H,q=inflate_module_min_v(G),Z=new(m?Uint8Array:Array)(30);for(z=0,H=Z.length;z<H;++z)Z[z]=5;var X=inflate_module_min_v(Z);function inflate_module_min_C(t,n){for(var i,o=t.f,a=t.d,s=t.input,m=t.a,g=s.length;a<n;){if(m>=g)throw Error("input buffer is broken");o|=s[m++]<<a,a+=8}return i=o&(1<<n)-1,t.f=o>>>n,t.d=a-n,t.a=m,i}function E(t,n){for(var i,o,a=t.f,s=t.d,m=t.input,g=t.a,_=m.length,S=n[0],M=n[1];s<M&&!(g>=_);)a|=m[g++]<<s,s+=8;if((o=(i=S[a&(1<<M)-1])>>>16)>s)throw Error("invalid code length: "+o);return t.f=a>>o,t.d=s-o,t.a=g,65535&i}function W(t,n){var i,o;switch(this.input=t,this.a=0,!n&&(n={})||(n.index&&(this.a=n.index),n.verify&&(this.A=n.verify)),i=t[this.a++],o=t[this.a++],15&i){case Q:this.method=Q;break;default:throw Error("unsupported compression method")}if(0!=((i<<8)+o)%31)throw Error("invalid fcheck flag:"+((i<<8)+o)%31);if(32&o)throw Error("fdict flag is not supported");this.q=new inflate_module_min_w(t,{index:this.a,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}inflate_module_min_w.prototype.j=function(t,n){var i=this.c,o=this.b;this.o=t;for(var a,s,m,g,_=i.length-258;256!==(a=E(this,t));)if(256>a)o>=_&&(this.b=o,i=this.e(),o=this.b),i[o++]=a;else for(g=L[s=a-257],0<N[s]&&(g+=inflate_module_min_C(this,N[s])),a=E(this,n),m=j[a],0<U[a]&&(m+=inflate_module_min_C(this,U[a])),o>=_&&(this.b=o,i=this.e(),o=this.b);g--;)i[o]=i[o++-m];for(;8<=this.d;)this.d-=8,this.a--;this.b=o},inflate_module_min_w.prototype.w=function(t,n){var i=this.c,o=this.b;this.o=t;for(var a,s,m,g,_=i.length;256!==(a=E(this,t));)if(256>a)o>=_&&(_=(i=this.e()).length),i[o++]=a;else for(g=L[s=a-257],0<N[s]&&(g+=inflate_module_min_C(this,N[s])),a=E(this,n),m=j[a],0<U[a]&&(m+=inflate_module_min_C(this,U[a])),o+g>_&&(_=(i=this.e()).length);g--;)i[o]=i[o++-m];for(;8<=this.d;)this.d-=8,this.a--;this.b=o},inflate_module_min_w.prototype.e=function(){var t,n,i=new(m?Uint8Array:Array)(this.b-32768),o=this.b-32768,a=this.c;if(m)i.set(a.subarray(32768,i.length));else for(t=0,n=i.length;t<n;++t)i[t]=a[t+32768];if(this.g.push(i),this.l+=i.length,m)a.set(a.subarray(o,o+32768));else for(t=0;32768>t;++t)a[t]=a[o+t];return this.b=32768,a},inflate_module_min_w.prototype.z=function(t){var n,i,o,a=this.input.length/this.a+1|0,s=this.input,g=this.c;return t&&("number"==typeof t.p&&(a=t.p),"number"==typeof t.u&&(a+=t.u)),i=2>a?(o=(s.length-this.a)/this.o[2]/2*258|0)<g.length?g.length+o:g.length<<1:g.length*a,m?(n=new Uint8Array(i)).set(g):n=g,this.c=n},inflate_module_min_w.prototype.n=function(){var t,n,i,o,a,s=0,g=this.c,_=this.g,S=new(m?Uint8Array:Array)(this.l+(this.b-32768));if(0===_.length)return m?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(n=0,i=_.length;n<i;++n)for(o=0,a=(t=_[n]).length;o<a;++o)S[s++]=t[o];for(n=32768,i=this.b;n<i;++n)S[s++]=g[n];return this.g=[],this.buffer=S},inflate_module_min_w.prototype.v=function(){var t,n=this.b;return m?this.r?(t=new Uint8Array(n)).set(this.c.subarray(0,n)):t=this.c.subarray(0,n):(this.c.length>n&&(this.c.length=n),t=this.c),this.buffer=t},W.prototype.k=function(){var t,n,i=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){n=(i[this.a++]<<24|i[this.a++]<<16|i[this.a++]<<8|i[this.a++])>>>0;var o=t;if("string"==typeof o){var a,s,m=o.split("");for(a=0,s=m.length;a<s;a++)m[a]=(255&m[a].charCodeAt(0))>>>0;o=m}for(var g,_=1,S=0,M=o.length,T=0;0<M;){M-=g=1024<M?1024:M;do{S+=_+=o[T++]}while(--g);_%=65521,S%=65521}if(n!==(S<<16|_)>>>0)throw Error("invalid adler-32 checksum")}return t};var Q=8;inflate_module_min_r("Zlib.Inflate",W),inflate_module_min_r("Zlib.Inflate.prototype.decompress",W.prototype.k);var Y,J,K,$,ee={ADAPTIVE:S.s,BLOCK:S.t};if(Object.keys)Y=Object.keys(ee);else for(J in Y=[],K=0,ee)Y[K++]=J;for(K=0,$=Y.length;K<$;++K)inflate_module_min_r("Zlib.Inflate.BufferType."+(J=Y[K]),ee[J]);var te=a.Zlib.Inflate,ne={findSpan:function(t,n,i){var o=i.length-t-1;if(n>=i[o])return o-1;if(n<=i[t])return t;for(var a=t,s=o,m=Math.floor((a+s)/2);n<i[m]||n>=i[m+1];)n<i[m]?s=m:a=m,m=Math.floor((a+s)/2);return m},calcBasisFunctions:function(t,n,i,o){var a=[],s=[],m=[];a[0]=1;for(var g=1;g<=i;++g){s[g]=n-o[t+1-g],m[g]=o[t+g]-n;for(var _=0,S=0;S<g;++S){var M=m[S+1],T=s[g-S],O=a[S]/(M+T);a[S]=_+M*O,_=T*O}a[g]=_}return a},calcBSplinePoint:function(t,n,i,a){for(var s=this.findSpan(t,a,n),m=this.calcBasisFunctions(s,a,t,n),g=new o.Vector4(0,0,0,0),_=0;_<=t;++_){var S=i[s-t+_],M=m[_],T=S.w*M;g.x+=S.x*T,g.y+=S.y*T,g.z+=S.z*T,g.w+=S.w*M}return g},calcBasisFunctionDerivatives:function(t,n,i,o,a){for(var s=[],m=0;m<=i;++m)s[m]=0;var g=[];for(m=0;m<=o;++m)g[m]=s.slice(0);var _=[];for(m=0;m<=i;++m)_[m]=s.slice(0);_[0][0]=1;for(var S=s.slice(0),M=s.slice(0),T=1;T<=i;++T){S[T]=n-a[t+1-T],M[T]=a[t+T]-n;for(var O=0,A=0;A<T;++A){var P=M[A+1],L=S[T-A];_[T][A]=P+L;var R=_[A][T-1]/_[T][A];_[A][T]=O+P*R,O=L*R}_[T][T]=O}for(T=0;T<=i;++T)g[0][T]=_[T][i];for(A=0;A<=i;++A){var N=0,I=1,j=[];for(m=0;m<=i;++m)j[m]=s.slice(0);j[0][0]=1;for(var V=1;V<=o;++V){var U=0,G=A-V,z=i-V;A>=V&&(j[I][0]=j[N][0]/_[z+1][G],U=j[I][0]*_[G][z]);var H=A-1<=z?V-1:i-A;for(T=G>=-1?1:-G;T<=H;++T)j[I][T]=(j[N][T]-j[N][T-1])/_[z+1][G+T],U+=j[I][T]*_[G+T][z];A<=z&&(j[I][V]=-j[N][V-1]/_[z+1][A],U+=j[I][V]*_[A][z]),g[V][A]=U,T=N,N=I,I=T}}for(A=i,V=1;V<=o;++V){for(T=0;T<=i;++T)g[V][T]*=A;A*=i-V}return g},calcBSplineDerivatives:function(t,n,i,a,s){for(var m=s<t?s:t,g=[],_=this.findSpan(t,a,n),S=this.calcBasisFunctionDerivatives(_,a,t,m,n),M=[],T=0;T<i.length;++T){var O=(P=i[T].clone()).w;P.x*=O,P.y*=O,P.z*=O,M[T]=P}for(var A=0;A<=m;++A){for(var P=M[_-t].clone().multiplyScalar(S[A][0]),L=1;L<=t;++L)P.add(M[_-t+L].clone().multiplyScalar(S[A][L]));g[A]=P}for(A=m+1;A<=s+1;++A)g[A]=new o.Vector4(0,0,0);return g},calcKoverI:function(t,n){for(var i=1,o=2;o<=t;++o)i*=o;var a=1;for(o=2;o<=n;++o)a*=o;for(o=2;o<=t-n;++o)a*=o;return i/a},calcRationalCurveDerivatives:function(t){for(var n=t.length,i=[],a=[],s=0;s<n;++s){var m=t[s];i[s]=new o.Vector3(m.x,m.y,m.z),a[s]=m.w}for(var g=[],_=0;_<n;++_){var S=i[_].clone();for(s=1;s<=_;++s)S.sub(g[_-s].clone().multiplyScalar(this.calcKoverI(_,s)*a[s]));g[_]=S.divideScalar(a[0])}return g},calcNURBSDerivatives:function(t,n,i,o,a){var s=this.calcBSplineDerivatives(t,n,i,o,a);return this.calcRationalCurveDerivatives(s)},calcSurfacePoint:function(t,n,i,a,s,m,g,_){for(var S=this.findSpan(t,m,i),M=this.findSpan(n,g,a),T=this.calcBasisFunctions(S,m,t,i),O=this.calcBasisFunctions(M,g,n,a),A=[],P=0;P<=n;++P){A[P]=new o.Vector4(0,0,0,0);for(var L=0;L<=t;++L){var R=s[S-t+L][M-n+P].clone(),N=R.w;R.x*=N,R.y*=N,R.z*=N,A[P].add(R.multiplyScalar(T[L]))}}var I=new o.Vector4(0,0,0,0);for(P=0;P<=n;++P)I.add(A[P].multiplyScalar(O[P]));I.divideScalar(I.w),_.set(I.x,I.y,I.z)}},NURBSCurve=function(t,n,i,a,s){o.Curve.call(this),this.degree=t,this.knots=n,this.controlPoints=[],this.startKnot=a||0,this.endKnot=s||this.knots.length-1;for(var m=0;m<i.length;++m){var g=i[m];this.controlPoints[m]=new o.Vector4(g.x,g.y,g.z,g.w)}};(NURBSCurve.prototype=Object.create(o.Curve.prototype)).constructor=NURBSCurve,NURBSCurve.prototype.getPoint=function(t,n){var i=n||new o.Vector3,a=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=ne.calcBSplinePoint(this.degree,this.knots,this.controlPoints,a);return 1!=s.w&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)},NURBSCurve.prototype.getTangent=function(t,n){var i=n||new o.Vector3,a=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),s=ne.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,a,1);return i.copy(s[1]).normalize(),i};var re=function(){var t,n,i;function FBXLoader(t){o.Loader.call(this,t)}function FBXTreeParser(t,n){this.textureLoader=t,this.manager=n}function GeometryParser(){}function AnimationParser(){}function TextParser(){}function BinaryParser(){}function BinaryReader(t,n){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===n||n}function FBXTree(){}function getFbxVersion(t){var n=t.match(/FBXVersion: (\d+)/);if(n)return parseInt(n[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(t){return t/46186158e3}FBXLoader.prototype=Object.assign(Object.create(o.Loader.prototype),{constructor:FBXLoader,load:function(t,n,i,a){var s=this,m=""===s.path?o.LoaderUtils.extractUrlBase(t):s.path,g=new o.FileLoader(this.manager);g.setPath(s.path),g.setResponseType("arraybuffer"),g.setRequestHeader(s.requestHeader),g.setWithCredentials(s.withCredentials),g.load(t,(function(i){try{n(s.parse(i,m))}catch(n){a?a(n):console.error(n),s.manager.itemError(t)}}),i,a)},parse:function(n,i){if(function isFbxFormatBinary(t){var n="Kaydara FBX Binary  \0";return t.byteLength>=n.length&&n===convertArrayBufferToString(t,0,n.length)}(n))t=(new BinaryParser).parse(n);else{var a=convertArrayBufferToString(n);if(!function isFbxFormatASCII(t){for(var n,i=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],o=0,a=0;a<i.length;++a)if(void 0,n=t[1-1],t=t.slice(o+1),o++,n===i[a])return!1;return!0}(a))throw new Error("THREE.FBXLoader: Unknown format.");if(getFbxVersion(a)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(a));t=(new TextParser).parse(a)}return new FBXTreeParser(new o.TextureLoader(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin),this.manager).parse(t)}}),FBXTreeParser.prototype={constructor:FBXTreeParser,parse:function(){n=this.parseConnections();var t=this.parseImages(),o=this.parseTextures(t),a=this.parseMaterials(o),s=this.parseDeformers(),m=(new GeometryParser).parse(s);return this.parseScene(s,m,a),i},parseConnections:function(){var n=new Map;return"Connections"in t&&t.Connections.connections.forEach((function(t){var i=t[0],o=t[1],a=t[2];n.has(i)||n.set(i,{parents:[],children:[]});var s={ID:o,relationship:a};n.get(i).parents.push(s),n.has(o)||n.set(o,{parents:[],children:[]});var m={ID:i,relationship:a};n.get(o).children.push(m)})),n},parseImages:function(){var n={},i={};if("Video"in t.Objects){var o=t.Objects.Video;for(var a in o){var s=o[a];if(n[S=parseInt(a)]=s.RelativeFilename||s.Filename,"Content"in s){var m=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,g="string"==typeof s.Content&&""!==s.Content;if(m||g){var _=this.parseImage(o[a]);i[s.RelativeFilename||s.Filename]=_}}}}for(var S in n){var M=n[S];void 0!==i[M]?n[S]=i[M]:n[S]=n[S].split("\\").pop()}return n},parseImage:function(t){var n,i=t.Content,o=t.RelativeFilename||t.Filename,a=o.slice(o.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":n="image/bmp";break;case"jpg":case"jpeg":n="image/jpeg";break;case"png":n="image/png";break;case"tif":n="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",o),n="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if("string"==typeof i)return"data:"+n+";base64,"+i;var s=new Uint8Array(i);return window.URL.createObjectURL(new Blob([s],{type:n}))},parseTextures:function(n){var i=new Map;if("Texture"in t.Objects){var o=t.Objects.Texture;for(var a in o){var s=this.parseTexture(o[a],n);i.set(parseInt(a),s)}}return i},parseTexture:function(t,n){var i=this.loadTexture(t,n);i.ID=t.id,i.name=t.attrName;var a=t.WrapModeU,s=t.WrapModeV,m=void 0!==a?a.value:0,g=void 0!==s?s.value:0;if(i.wrapS=0===m?o.RepeatWrapping:o.ClampToEdgeWrapping,i.wrapT=0===g?o.RepeatWrapping:o.ClampToEdgeWrapping,"Scaling"in t){var _=t.Scaling.value;i.repeat.x=_[0],i.repeat.y=_[1]}return i},loadTexture:function(t,i){var a,s,m=this.textureLoader.path,g=n.get(t.id).children;void 0!==g&&g.length>0&&void 0!==i[g[0].ID]&&(0!==(a=i[g[0].ID]).indexOf("blob:")&&0!==a.indexOf("data:")||this.textureLoader.setPath(void 0));var _=t.FileName.slice(-3).toLowerCase();if("tga"===_){var S=this.manager.getHandler(".tga");null===S?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),s=new o.Texture):s=S.load(a)}else"psd"===_?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),s=new o.Texture):s=this.textureLoader.load(a);return this.textureLoader.setPath(m),s},parseMaterials:function(n){var i=new Map;if("Material"in t.Objects){var o=t.Objects.Material;for(var a in o){var s=this.parseMaterial(o[a],n);null!==s&&i.set(parseInt(a),s)}}return i},parseMaterial:function(t,i){var a=t.id,s=t.attrName,m=t.ShadingModel;if("object"==typeof m&&(m=m.value),!n.has(a))return null;var g,_=this.parseParameters(t,i,a);switch(m.toLowerCase()){case"phong":g=new o.MeshPhongMaterial;break;case"lambert":g=new o.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',m),g=new o.MeshPhongMaterial}return g.setValues(_),g.name=s,g},parseParameters:function(t,i,a){var s={};t.BumpFactor&&(s.bumpScale=t.BumpFactor.value),t.Diffuse?s.color=(new o.Color).fromArray(t.Diffuse.value):!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(s.color=(new o.Color).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(s.displacementScale=t.DisplacementFactor.value),t.Emissive?s.emissive=(new o.Color).fromArray(t.Emissive.value):!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(s.emissive=(new o.Color).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(s.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(s.opacity=parseFloat(t.Opacity.value)),s.opacity<1&&(s.transparent=!0),t.ReflectionFactor&&(s.reflectivity=t.ReflectionFactor.value),t.Shininess&&(s.shininess=t.Shininess.value),t.Specular?s.specular=(new o.Color).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(s.specular=(new o.Color).fromArray(t.SpecularColor.value));var m=this;return n.get(a).children.forEach((function(t){var n=t.relationship;switch(n){case"Bump":s.bumpMap=m.getTexture(i,t.ID);break;case"Maya|TEX_ao_map":s.aoMap=m.getTexture(i,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=m.getTexture(i,t.ID),s.map.encoding=o.sRGBEncoding;break;case"DisplacementColor":s.displacementMap=m.getTexture(i,t.ID);break;case"EmissiveColor":s.emissiveMap=m.getTexture(i,t.ID),s.emissiveMap.encoding=o.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=m.getTexture(i,t.ID);break;case"ReflectionColor":s.envMap=m.getTexture(i,t.ID),s.envMap.mapping=o.EquirectangularReflectionMapping,s.envMap.encoding=o.sRGBEncoding;break;case"SpecularColor":s.specularMap=m.getTexture(i,t.ID),s.specularMap.encoding=o.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=m.getTexture(i,t.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),s},getTexture:function(i,o){return"LayeredTexture"in t.Objects&&o in t.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),o=n.get(o).children[0].ID),i.get(o)},parseDeformers:function(){var i={},o={};if("Deformer"in t.Objects){var a=t.Objects.Deformer;for(var s in a){var m=a[s],g=n.get(parseInt(s));if("Skin"===m.attrType){var _=this.parseSkeleton(g,a);_.ID=s,g.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),_.geometryID=g.parents[0].ID,i[s]=_}else if("BlendShape"===m.attrType){var S={id:s};S.rawTargets=this.parseMorphTargets(g,a),S.id=s,g.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),o[s]=S}}}return{skeletons:i,morphTargets:o}},parseSkeleton:function(t,n){var i=[];return t.children.forEach((function(t){var a=n[t.ID];if("Cluster"===a.attrType){var s={ID:t.ID,indices:[],weights:[],transformLink:(new o.Matrix4).fromArray(a.TransformLink.a)};"Indexes"in a&&(s.indices=a.Indexes.a,s.weights=a.Weights.a),i.push(s)}})),{rawBones:i,bones:[]}},parseMorphTargets:function(t,i){for(var o=[],a=0;a<t.children.length;a++){var s=t.children[a],m=i[s.ID],g={name:m.attrName,initialWeight:m.DeformPercent,id:m.id,fullWeights:m.FullWeights.a};if("BlendShapeChannel"!==m.attrType)return;g.geoID=n.get(parseInt(s.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,o.push(g)}return o},parseScene:function(a,s,m){i=new o.Group;var g=this.parseModels(a.skeletons,s,m),_=t.Objects.Model,S=this;g.forEach((function(t){var o=_[t.ID];S.setLookAtProperties(t,o),n.get(t.ID).parents.forEach((function(n){var i=g.get(n.ID);void 0!==i&&i.add(t)})),null===t.parent&&i.add(t)})),this.bindSkeleton(a.skeletons,s,g),this.createAmbientLight(),this.setupMorphMaterials(),i.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrixWorld=t.parent.matrix);var n=generateTransform(t.userData.transformData);t.applyMatrix4(n)}}));var M=(new AnimationParser).parse();1===i.children.length&&i.children[0].isGroup&&(i.children[0].animations=M,i=i.children[0]),i.animations=M},parseModels:function(i,a,s){var m=new Map,g=t.Objects.Model;for(var _ in g){var S=parseInt(_),M=g[_],T=n.get(S),O=this.buildSkeleton(T,i,S,M.attrName);if(!O){switch(M.attrType){case"Camera":O=this.createCamera(T);break;case"Light":O=this.createLight(T);break;case"Mesh":O=this.createMesh(T,a,s);break;case"NurbsCurve":O=this.createCurve(T,a);break;case"LimbNode":case"Root":O=new o.Bone;break;case"Null":default:O=new o.Group}O.name=M.attrName?o.PropertyBinding.sanitizeNodeName(M.attrName):"",O.ID=S}this.getTransformData(O,M),m.set(S,O)}return m},buildSkeleton:function(t,n,i,a){var s=null;return t.parents.forEach((function(t){for(var m in n){var g=n[m];g.rawBones.forEach((function(n,m){if(n.ID===t.ID){var _=s;(s=new o.Bone).matrixWorld.copy(n.transformLink),s.name=a?o.PropertyBinding.sanitizeNodeName(a):"",s.ID=i,g.bones[m]=s,null!==_&&s.add(_)}}))}})),s},createCamera:function(n){var i,a;if(n.children.forEach((function(n){var i=t.Objects.NodeAttribute[n.ID];void 0!==i&&(a=i)})),void 0===a)i=new o.Object3D;else{var s=0;void 0!==a.CameraProjectionType&&1===a.CameraProjectionType.value&&(s=1);var m=1;void 0!==a.NearPlane&&(m=a.NearPlane.value/1e3);var g=1e3;void 0!==a.FarPlane&&(g=a.FarPlane.value/1e3);var _=window.innerWidth,S=window.innerHeight;void 0!==a.AspectWidth&&void 0!==a.AspectHeight&&(_=a.AspectWidth.value,S=a.AspectHeight.value);var M=_/S,T=45;void 0!==a.FieldOfView&&(T=a.FieldOfView.value);var O=a.FocalLength?a.FocalLength.value:null;switch(s){case 0:i=new o.PerspectiveCamera(T,M,m,g),null!==O&&i.setFocalLength(O);break;case 1:i=new o.OrthographicCamera(-_/2,_/2,S/2,-S/2,m,g);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),i=new o.Object3D}}return i},createLight:function(n){var i,a;if(n.children.forEach((function(n){var i=t.Objects.NodeAttribute[n.ID];void 0!==i&&(a=i)})),void 0===a)i=new o.Object3D;else{var s;s=void 0===a.LightType?0:a.LightType.value;var m=16777215;void 0!==a.Color&&(m=(new o.Color).fromArray(a.Color.value));var g=void 0===a.Intensity?1:a.Intensity.value/100;void 0!==a.CastLightOnObject&&0===a.CastLightOnObject.value&&(g=0);var _=0;switch(void 0!==a.FarAttenuationEnd&&(_=void 0!==a.EnableFarAttenuation&&0===a.EnableFarAttenuation.value?0:a.FarAttenuationEnd.value),s){case 0:i=new o.PointLight(m,g,_,1);break;case 1:i=new o.DirectionalLight(m,g);break;case 2:var S=Math.PI/3;void 0!==a.InnerAngle&&(S=o.MathUtils.degToRad(a.InnerAngle.value));var M=0;void 0!==a.OuterAngle&&(M=o.MathUtils.degToRad(a.OuterAngle.value),M=Math.max(M,1)),i=new o.SpotLight(m,g,_,S,M,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+a.LightType.value+", defaulting to a PointLight."),i=new o.PointLight(m,g)}void 0!==a.CastShadows&&1===a.CastShadows.value&&(i.castShadow=!0)}return i},createMesh:function(t,n,i){var a,s=null,m=null,g=[];return t.children.forEach((function(t){n.has(t.ID)&&(s=n.get(t.ID)),i.has(t.ID)&&g.push(i.get(t.ID))})),g.length>1?m=g:g.length>0?m=g[0]:(m=new o.MeshPhongMaterial({color:13421772}),g.push(m)),"color"in s.attributes&&g.forEach((function(t){t.vertexColors=!0})),s.FBX_Deformer?(g.forEach((function(t){t.skinning=!0})),(a=new o.SkinnedMesh(s,m)).normalizeSkinWeights()):a=new o.Mesh(s,m),a},createCurve:function(t,n){var i=t.children.reduce((function(t,i){return n.has(i.ID)&&(t=n.get(i.ID)),t}),null),a=new o.LineBasicMaterial({color:3342591,linewidth:1});return new o.Line(i,a)},getTransformData:function(t,n){var i={};"InheritType"in n&&(i.inheritType=parseInt(n.InheritType.value)),i.eulerOrder="RotationOrder"in n?getEulerOrder(n.RotationOrder.value):"ZYX","Lcl_Translation"in n&&(i.translation=n.Lcl_Translation.value),"PreRotation"in n&&(i.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(i.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(i.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(i.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(i.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(i.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(i.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(i.rotationPivot=n.RotationPivot.value),t.userData.transformData=i},setLookAtProperties:function(a,s){"LookAtProperty"in s&&n.get(a.ID).children.forEach((function(n){if("LookAtProperty"===n.relationship){var s=t.Objects.Model[n.ID];if("Lcl_Translation"in s){var m=s.Lcl_Translation.value;void 0!==a.target?(a.target.position.fromArray(m),i.add(a.target)):a.lookAt((new o.Vector3).fromArray(m))}}}))},bindSkeleton:function(t,i,a){var s=this.parsePoseNodes();for(var m in t){var g=t[m];n.get(parseInt(g.ID)).parents.forEach((function(t){if(i.has(t.ID)){var m=t.ID;n.get(m).parents.forEach((function(t){a.has(t.ID)&&a.get(t.ID).bind(new o.Skeleton(g.bones),s[t.ID])}))}}))}},parsePoseNodes:function(){var n={};if("Pose"in t.Objects){var i=t.Objects.Pose;for(var a in i)if("BindPose"===i[a].attrType){var s=i[a].PoseNode;Array.isArray(s)?s.forEach((function(t){n[t.Node]=(new o.Matrix4).fromArray(t.Matrix.a)})):n[s.Node]=(new o.Matrix4).fromArray(s.Matrix.a)}}return n},createAmbientLight:function(){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var n=t.GlobalSettings.AmbientColor.value,a=n[0],s=n[1],m=n[2];if(0!==a||0!==s||0!==m){var g=new o.Color(a,s,m);i.add(new o.AmbientLight(g,1))}}},setupMorphMaterials:function(){var t=this;i.traverse((function(n){n.isMesh&&n.geometry.morphAttributes.position&&n.geometry.morphAttributes.position.length&&(Array.isArray(n.material)?n.material.forEach((function(i,o){t.setupMorphMaterial(n,i,o)})):t.setupMorphMaterial(n,n.material))}))},setupMorphMaterial:function(t,n,o){var a=t.uuid,s=n.uuid,m=!1;if(i.traverse((function(t){t.isMesh&&(Array.isArray(t.material)?t.material.forEach((function(n){n.uuid===s&&t.uuid!==a&&(m=!0)})):t.material.uuid===s&&t.uuid!==a&&(m=!0))})),!0===m){var g=n.clone();g.morphTargets=!0,void 0===o?t.material=g:t.material[o]=g}else n.morphTargets=!0}},GeometryParser.prototype={constructor:GeometryParser,parse:function(i){var o=new Map;if("Geometry"in t.Objects){var a=t.Objects.Geometry;for(var s in a){var m=n.get(parseInt(s)),g=this.parseGeometry(m,a[s],i);o.set(parseInt(s),g)}}return o},parseGeometry:function(t,n,i){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(t,n,i);case"NurbsCurve":return this.parseNurbsGeometry(n)}},parseMeshGeometry:function(n,i,o){var a=o.skeletons,s=[],m=n.parents.map((function(n){return t.Objects.Model[n.ID]}));if(0!==m.length){var g=n.children.reduce((function(t,n){return void 0!==a[n.ID]&&(t=a[n.ID]),t}),null);n.children.forEach((function(t){void 0!==o.morphTargets[t.ID]&&s.push(o.morphTargets[t.ID])}));var _=m[0],S={};"RotationOrder"in _&&(S.eulerOrder=getEulerOrder(_.RotationOrder.value)),"InheritType"in _&&(S.inheritType=parseInt(_.InheritType.value)),"GeometricTranslation"in _&&(S.translation=_.GeometricTranslation.value),"GeometricRotation"in _&&(S.rotation=_.GeometricRotation.value),"GeometricScaling"in _&&(S.scale=_.GeometricScaling.value);var M=generateTransform(S);return this.genGeometry(i,g,s,M)}},genGeometry:function(t,n,i,a){var s=new o.BufferGeometry;t.attrName&&(s.name=t.attrName);var m=this.parseGeoNode(t,n),g=this.genBuffers(m),_=new o.Float32BufferAttribute(g.vertex,3);if(_.applyMatrix4(a),s.setAttribute("position",_),g.colors.length>0&&s.setAttribute("color",new o.Float32BufferAttribute(g.colors,3)),n&&(s.setAttribute("skinIndex",new o.Uint16BufferAttribute(g.weightsIndices,4)),s.setAttribute("skinWeight",new o.Float32BufferAttribute(g.vertexWeights,4)),s.FBX_Deformer=n),g.normal.length>0){var S=(new o.Matrix3).getNormalMatrix(a),M=new o.Float32BufferAttribute(g.normal,3);M.applyNormalMatrix(S),s.setAttribute("normal",M)}if(g.uvs.forEach((function(t,n){var i="uv"+(n+1).toString();0===n&&(i="uv"),s.setAttribute(i,new o.Float32BufferAttribute(g.uvs[n],2))})),m.material&&"AllSame"!==m.material.mappingType){var T=g.materialIndex[0],O=0;if(g.materialIndex.forEach((function(t,n){t!==T&&(s.addGroup(O,n-O,T),T=t,O=n)})),s.groups.length>0){var A=s.groups[s.groups.length-1],P=A.start+A.count;P!==g.materialIndex.length&&s.addGroup(P,g.materialIndex.length-P,T)}0===s.groups.length&&s.addGroup(0,g.materialIndex.length,g.materialIndex[0])}return this.addMorphTargets(s,t,i,a),s},parseGeoNode:function(t,n){var i={};if(i.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],i.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(i.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(i.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(i.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){i.uv=[];for(var o=0;t.LayerElementUV[o];)t.LayerElementUV[o].UV&&i.uv.push(this.parseUVs(t.LayerElementUV[o])),o++}return i.weightTable={},null!==n&&(i.skeleton=n,n.rawBones.forEach((function(t,n){t.indices.forEach((function(o,a){void 0===i.weightTable[o]&&(i.weightTable[o]=[]),i.weightTable[o].push({id:n,weight:t.weights[a]})}))}))),i},genBuffers:function(t){var n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,o=0,a=!1,s=[],m=[],g=[],_=[],S=[],M=[],T=this;return t.vertexIndices.forEach((function(O,A){var P=!1;O<0&&(O^=-1,P=!0);var L=[],R=[];if(s.push(3*O,3*O+1,3*O+2),t.color){var N=getData(A,i,O,t.color);g.push(N[0],N[1],N[2])}if(t.skeleton){if(void 0!==t.weightTable[O]&&t.weightTable[O].forEach((function(t){R.push(t.weight),L.push(t.id)})),R.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);var I=[0,0,0,0],j=[0,0,0,0];R.forEach((function(t,n){var i=t,o=L[n];j.forEach((function(t,n,a){if(i>t){a[n]=i,i=t;var s=I[n];I[n]=o,o=s}}))})),L=I,R=j}for(;R.length<4;)R.push(0),L.push(0);for(var V=0;V<4;++V)S.push(R[V]),M.push(L[V])}if(t.normal&&(N=getData(A,i,O,t.normal),m.push(N[0],N[1],N[2])),t.material&&"AllSame"!==t.material.mappingType)var U=getData(A,i,O,t.material)[0];t.uv&&t.uv.forEach((function(t,n){var o=getData(A,i,O,t);void 0===_[n]&&(_[n]=[]),_[n].push(o[0]),_[n].push(o[1])})),o++,P&&(T.genFace(n,t,s,U,m,g,_,S,M,o),i++,o=0,s=[],m=[],g=[],_=[],S=[],M=[])})),n},genFace:function(t,n,i,o,a,s,m,g,_,S){for(var M=2;M<S;M++)t.vertex.push(n.vertexPositions[i[0]]),t.vertex.push(n.vertexPositions[i[1]]),t.vertex.push(n.vertexPositions[i[2]]),t.vertex.push(n.vertexPositions[i[3*(M-1)]]),t.vertex.push(n.vertexPositions[i[3*(M-1)+1]]),t.vertex.push(n.vertexPositions[i[3*(M-1)+2]]),t.vertex.push(n.vertexPositions[i[3*M]]),t.vertex.push(n.vertexPositions[i[3*M+1]]),t.vertex.push(n.vertexPositions[i[3*M+2]]),n.skeleton&&(t.vertexWeights.push(g[0]),t.vertexWeights.push(g[1]),t.vertexWeights.push(g[2]),t.vertexWeights.push(g[3]),t.vertexWeights.push(g[4*(M-1)]),t.vertexWeights.push(g[4*(M-1)+1]),t.vertexWeights.push(g[4*(M-1)+2]),t.vertexWeights.push(g[4*(M-1)+3]),t.vertexWeights.push(g[4*M]),t.vertexWeights.push(g[4*M+1]),t.vertexWeights.push(g[4*M+2]),t.vertexWeights.push(g[4*M+3]),t.weightsIndices.push(_[0]),t.weightsIndices.push(_[1]),t.weightsIndices.push(_[2]),t.weightsIndices.push(_[3]),t.weightsIndices.push(_[4*(M-1)]),t.weightsIndices.push(_[4*(M-1)+1]),t.weightsIndices.push(_[4*(M-1)+2]),t.weightsIndices.push(_[4*(M-1)+3]),t.weightsIndices.push(_[4*M]),t.weightsIndices.push(_[4*M+1]),t.weightsIndices.push(_[4*M+2]),t.weightsIndices.push(_[4*M+3])),n.color&&(t.colors.push(s[0]),t.colors.push(s[1]),t.colors.push(s[2]),t.colors.push(s[3*(M-1)]),t.colors.push(s[3*(M-1)+1]),t.colors.push(s[3*(M-1)+2]),t.colors.push(s[3*M]),t.colors.push(s[3*M+1]),t.colors.push(s[3*M+2])),n.material&&"AllSame"!==n.material.mappingType&&(t.materialIndex.push(o),t.materialIndex.push(o),t.materialIndex.push(o)),n.normal&&(t.normal.push(a[0]),t.normal.push(a[1]),t.normal.push(a[2]),t.normal.push(a[3*(M-1)]),t.normal.push(a[3*(M-1)+1]),t.normal.push(a[3*(M-1)+2]),t.normal.push(a[3*M]),t.normal.push(a[3*M+1]),t.normal.push(a[3*M+2])),n.uv&&n.uv.forEach((function(n,i){void 0===t.uvs[i]&&(t.uvs[i]=[]),t.uvs[i].push(m[i][0]),t.uvs[i].push(m[i][1]),t.uvs[i].push(m[i][2*(M-1)]),t.uvs[i].push(m[i][2*(M-1)+1]),t.uvs[i].push(m[i][2*M]),t.uvs[i].push(m[i][2*M+1])}))},addMorphTargets:function(n,i,o,a){if(0!==o.length){n.morphTargetsRelative=!0,n.morphAttributes.position=[];var s=this;o.forEach((function(o){o.rawTargets.forEach((function(o){var m=t.Objects.Geometry[o.geoID];void 0!==m&&s.genMorphGeometry(n,i,m,a,o.name)}))}))}},genMorphGeometry:function(t,n,i,a,s){for(var m=void 0!==n.PolygonVertexIndex?n.PolygonVertexIndex.a:[],g=void 0!==i.Vertices?i.Vertices.a:[],_=void 0!==i.Indexes?i.Indexes.a:[],S=3*t.attributes.position.count,M=new Float32Array(S),T=0;T<_.length;T++){var O=3*_[T];M[O]=g[3*T],M[O+1]=g[3*T+1],M[O+2]=g[3*T+2]}var A={vertexIndices:m,vertexPositions:M},P=this.genBuffers(A),L=new o.Float32BufferAttribute(P.vertex,3);L.name=s||i.attrName,L.applyMatrix4(a),t.morphAttributes.position.push(L)},parseNormals:function(t){var n=t.MappingInformationType,i=t.ReferenceInformationType,o=t.Normals.a,a=[];return"IndexToDirect"===i&&("NormalIndex"in t?a=t.NormalIndex.a:"NormalsIndex"in t&&(a=t.NormalsIndex.a)),{dataSize:3,buffer:o,indices:a,mappingType:n,referenceType:i}},parseUVs:function(t){var n=t.MappingInformationType,i=t.ReferenceInformationType,o=t.UV.a,a=[];return"IndexToDirect"===i&&(a=t.UVIndex.a),{dataSize:2,buffer:o,indices:a,mappingType:n,referenceType:i}},parseVertexColors:function(t){var n=t.MappingInformationType,i=t.ReferenceInformationType,o=t.Colors.a,a=[];return"IndexToDirect"===i&&(a=t.ColorIndex.a),{dataSize:4,buffer:o,indices:a,mappingType:n,referenceType:i}},parseMaterialIndices:function(t){var n=t.MappingInformationType,i=t.ReferenceInformationType;if("NoMappingInformation"===n)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var o=t.Materials.a,a=[],s=0;s<o.length;++s)a.push(s);return{dataSize:1,buffer:o,indices:a,mappingType:n,referenceType:i}},parseNurbsGeometry:function(t){if(void 0===NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new o.BufferGeometry;var n=parseInt(t.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new o.BufferGeometry;for(var i,a,s=n-1,m=t.KnotVector.a,g=[],_=t.Points.a,S=0,M=_.length;S<M;S+=4)g.push((new o.Vector4).fromArray(_,S));if("Closed"===t.Form)g.push(g[0]);else if("Periodic"===t.Form)for(i=s,a=m.length-1-i,S=0;S<s;++S)g.push(g[S]);var T=new NURBSCurve(s,m,g,i,a).getPoints(7*g.length),O=new Float32Array(3*T.length);T.forEach((function(t,n){t.toArray(O,3*n)}));var A=new o.BufferGeometry;return A.setAttribute("position",new o.BufferAttribute(O,3)),A}},AnimationParser.prototype={constructor:AnimationParser,parse:function(){var t=[],n=this.parseClips();if(void 0!==n)for(var i in n){var o=n[i],a=this.addClip(o);t.push(a)}return t},parseClips:function(){if(void 0!==t.Objects.AnimationCurve){var n=this.parseAnimationCurveNodes();this.parseAnimationCurves(n);var i=this.parseAnimationLayers(n);return this.parseAnimStacks(i)}},parseAnimationCurveNodes:function(){var n=t.Objects.AnimationCurveNode,i=new Map;for(var o in n){var a=n[o];if(null!==a.attrName.match(/S|R|T|DeformPercent/)){var s={id:a.id,attr:a.attrName,curves:{}};i.set(s.id,s)}}return i},parseAnimationCurves:function(i){var o=t.Objects.AnimationCurve;for(var a in o){var s={id:o[a].id,times:o[a].KeyTime.a.map(convertFBXTimeToSeconds),values:o[a].KeyValueFloat.a},m=n.get(s.id);if(void 0!==m){var g=m.parents[0].ID,_=m.parents[0].relationship;_.match(/X/)?i.get(g).curves.x=s:_.match(/Y/)?i.get(g).curves.y=s:_.match(/Z/)?i.get(g).curves.z=s:_.match(/d|DeformPercent/)&&i.has(g)&&(i.get(g).curves.morph=s)}}},parseAnimationLayers:function(a){var s=t.Objects.AnimationLayer,m=new Map;for(var g in s){var _=[],S=n.get(parseInt(g));void 0!==S&&(S.children.forEach((function(s,m){if(a.has(s.ID)){var g=a.get(s.ID);if(void 0!==g.curves.x||void 0!==g.curves.y||void 0!==g.curves.z){if(void 0===_[m]&&void 0!==(P=n.get(s.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID)){if(void 0===(M=t.Objects.Model[P.toString()]))return void console.warn("THREE.FBXLoader: Encountered a unused curve.",s);var S={modelName:M.attrName?o.PropertyBinding.sanitizeNodeName(M.attrName):"",ID:M.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};i.traverse((function(t){t.ID===M.id&&(S.transform=t.matrix,t.userData.transformData&&(S.eulerOrder=t.userData.transformData.eulerOrder))})),S.transform||(S.transform=new o.Matrix4),"PreRotation"in M&&(S.preRotation=M.PreRotation.value),"PostRotation"in M&&(S.postRotation=M.PostRotation.value),_[m]=S}_[m]&&(_[m][g.attr]=g)}else if(void 0!==g.curves.morph){if(void 0===_[m]){var M,T=n.get(s.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,O=n.get(T).parents[0].ID,A=n.get(O).parents[0].ID,P=n.get(A).parents[0].ID;S={modelName:(M=t.Objects.Model[P]).attrName?o.PropertyBinding.sanitizeNodeName(M.attrName):"",morphName:t.Objects.Deformer[T].attrName},_[m]=S}_[m][g.attr]=g}}})),m.set(parseInt(g),_))}return m},parseAnimStacks:function(i){var o=t.Objects.AnimationStack,a={};for(var s in o){var m=n.get(parseInt(s)).children;m.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var g=i.get(m[0].ID);a[s]={name:o[s].attrName,layer:g}}return a},addClip:function(t){var n=[],i=this;return t.layer.forEach((function(t){n=n.concat(i.generateTracks(t))})),new o.AnimationClip(t.name,-1,n)},generateTracks:function(t){var n=[],i=new o.Vector3,a=new o.Quaternion,s=new o.Vector3;if(t.transform&&t.transform.decompose(i,a,s),i=i.toArray(),a=(new o.Euler).setFromQuaternion(a,t.eulerOrder).toArray(),s=s.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){var m=this.generateVectorTrack(t.modelName,t.T.curves,i,"position");void 0!==m&&n.push(m)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var g=this.generateRotationTrack(t.modelName,t.R.curves,a,t.preRotation,t.postRotation,t.eulerOrder);void 0!==g&&n.push(g)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var _=this.generateVectorTrack(t.modelName,t.S.curves,s,"scale");void 0!==_&&n.push(_)}if(void 0!==t.DeformPercent){var S=this.generateMorphTrack(t);void 0!==S&&n.push(S)}return n},generateVectorTrack:function(t,n,i,a){var s=this.getTimesForAllAxes(n),m=this.getKeyframeTrackValues(s,n,i);return new o.VectorKeyframeTrack(t+"."+a,s,m)},generateRotationTrack:function(t,n,i,a,s,m){void 0!==n.x&&(this.interpolateRotations(n.x),n.x.values=n.x.values.map(o.MathUtils.degToRad)),void 0!==n.y&&(this.interpolateRotations(n.y),n.y.values=n.y.values.map(o.MathUtils.degToRad)),void 0!==n.z&&(this.interpolateRotations(n.z),n.z.values=n.z.values.map(o.MathUtils.degToRad));var g=this.getTimesForAllAxes(n),_=this.getKeyframeTrackValues(g,n,i);void 0!==a&&((a=a.map(o.MathUtils.degToRad)).push(m),a=(new o.Euler).fromArray(a),a=(new o.Quaternion).setFromEuler(a)),void 0!==s&&((s=s.map(o.MathUtils.degToRad)).push(m),s=(new o.Euler).fromArray(s),s=(new o.Quaternion).setFromEuler(s).invert());for(var S=new o.Quaternion,M=new o.Euler,T=[],O=0;O<_.length;O+=3)M.set(_[O],_[O+1],_[O+2],m),S.setFromEuler(M),void 0!==a&&S.premultiply(a),void 0!==s&&S.multiply(s),S.toArray(T,O/3*4);return new o.QuaternionKeyframeTrack(t+".quaternion",g,T)},generateMorphTrack:function(t){var n=t.DeformPercent.curves.morph,a=n.values.map((function(t){return t/100})),s=i.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new o.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+s+"]",n.times,a)},getTimesForAllAxes:function(t){var n=[];if(void 0!==t.x&&(n=n.concat(t.x.times)),void 0!==t.y&&(n=n.concat(t.y.times)),void 0!==t.z&&(n=n.concat(t.z.times)),(n=n.sort((function(t,n){return t-n}))).length>1){for(var i=1,o=n[0],a=1;a<n.length;a++){var s=n[a];s!==o&&(n[i]=s,o=s,i++)}n=n.slice(0,i)}return n},getKeyframeTrackValues:function(t,n,i){var o=i,a=[],s=-1,m=-1,g=-1;return t.forEach((function(t){if(n.x&&(s=n.x.times.indexOf(t)),n.y&&(m=n.y.times.indexOf(t)),n.z&&(g=n.z.times.indexOf(t)),-1!==s){var i=n.x.values[s];a.push(i),o[0]=i}else a.push(o[0]);if(-1!==m){var _=n.y.values[m];a.push(_),o[1]=_}else a.push(o[1]);if(-1!==g){var S=n.z.values[g];a.push(S),o[2]=S}else a.push(o[2])})),a},interpolateRotations:function(t){for(var n=1;n<t.values.length;n++){var i=t.values[n-1],o=t.values[n]-i,a=Math.abs(o);if(a>=180){for(var s=a/180,m=o/s,g=i+m,_=t.times[n-1],S=(t.times[n]-_)/s,M=_+S,T=[],O=[];M<t.times[n];)T.push(M),M+=S,O.push(g),g+=m;t.times=inject(t.times,n,T),t.values=inject(t.values,n,O)}}}},TextParser.prototype={constructor:TextParser,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,n){this.currentProp=t,this.currentPropName=n},parse:function(t){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var n=this,i=t.split(/[\r\n]+/);return i.forEach((function(t,o){var a=t.match(/^[\s\t]*;/),s=t.match(/^[\s\t]*$/);if(!a&&!s){var m=t.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),g=t.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),_=t.match("^\\t{"+(n.currentIndent-1)+"}}");m?n.parseNodeBegin(t,m):g?n.parseNodeProperty(t,g,i[++o]):_?n.popStack():t.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(t)}})),this.allNodes},parseNodeBegin:function(t,n){var i=n[1].trim().replace(/^"/,"").replace(/"$/,""),o=n[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),a={name:i},s=this.parseNodeAttr(o),m=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,a):i in m?("PoseNode"===i?m.PoseNode.push(a):void 0!==m[i].id&&(m[i]={},m[i][m[i].id]=m[i]),""!==s.id&&(m[i][s.id]=a)):"number"==typeof s.id?(m[i]={},m[i][s.id]=a):"Properties70"!==i&&(m[i]="PoseNode"===i?[a]:a),"number"==typeof s.id&&(a.id=s.id),""!==s.name&&(a.attrName=s.name),""!==s.type&&(a.attrType=s.type),this.pushStack(a)},parseNodeAttr:function(t){var n=t[0];""!==t[0]&&(n=parseInt(t[0]),isNaN(n)&&(n=t[0]));var i="",o="";return t.length>1&&(i=t[1].replace(/^(\w+)::/,""),o=t[2]),{id:n,name:i,type:o}},parseNodeProperty:function(t,n,i){var o=n[1].replace(/^"/,"").replace(/"$/,"").trim(),a=n[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===o&&","===a&&(a=i.replace(/"/g,"").replace(/,$/,"").trim());var s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===o){var m=a.split(",").slice(1),g=parseInt(m[0]),_=parseInt(m[1]),S=a.split(",").slice(3);o="connections",function append(t,n){for(var i=0,o=t.length,a=n.length;i<a;i++,o++)t[o]=n[i]}(a=[g,_],S=S.map((function(t){return t.trim().replace(/^"/,"")}))),void 0===s[o]&&(s[o]=[])}"Node"===o&&(s.id=a),o in s&&Array.isArray(s[o])?s[o].push(a):"a"!==o?s[o]=a:s.a=a,this.setCurrentProp(s,o),"a"===o&&","!==a.slice(-1)&&(s.a=parseNumberArray(a))}else this.parseNodeSpecialProperty(t,o,a)},parseNodePropertyContinued:function(t){var n=this.getCurrentNode();n.a+=t,","!==t.slice(-1)&&(n.a=parseNumberArray(n.a))},parseNodeSpecialProperty:function(t,n,i){var o=i.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),a=o[0],s=o[1],m=o[2],g=o[3],_=o[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":_=parseFloat(_);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":_=parseNumberArray(_)}this.getPrevNode()[a]={type:s,type2:m,flag:g,value:_},this.setCurrentProp(this.getPrevNode(),a)}},BinaryParser.prototype={constructor:BinaryParser,parse:function(t){var n=new BinaryReader(t);n.skip(23);var i=n.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);for(var o=new FBXTree;!this.endOfContent(n);){var a=this.parseNode(n,i);null!==a&&o.add(a.name,a)}return o},endOfContent:function(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,n){var i={},o=n>=7500?t.getUint64():t.getUint32(),a=n>=7500?t.getUint64():t.getUint32();n>=7500?t.getUint64():t.getUint32();var s=t.getUint8(),m=t.getString(s);if(0===o)return null;for(var g=[],_=0;_<a;_++)g.push(this.parseProperty(t));var S=g.length>0?g[0]:"",M=g.length>1?g[1]:"",T=g.length>2?g[2]:"";for(i.singleProperty=1===a&&t.getOffset()===o;o>t.getOffset();){var O=this.parseNode(t,n);null!==O&&this.parseSubNode(m,i,O)}return i.propertyList=g,"number"==typeof S&&(i.id=S),""!==M&&(i.attrName=M),""!==T&&(i.attrType=T),""!==m&&(i.name=m),i},parseSubNode:function(t,n,i){if(!0===i.singleProperty){var o=i.propertyList[0];Array.isArray(o)?(n[i.name]=i,i.a=o):n[i.name]=o}else if("Connections"===t&&"C"===i.name){var a=[];i.propertyList.forEach((function(t,n){0!==n&&a.push(t)})),void 0===n.connections&&(n.connections=[]),n.connections.push(a)}else if("Properties70"===i.name)Object.keys(i).forEach((function(t){n[t]=i[t]}));else if("Properties70"===t&&"P"===i.name){var s,m=i.propertyList[0],g=i.propertyList[1],_=i.propertyList[2],S=i.propertyList[3];0===m.indexOf("Lcl ")&&(m=m.replace("Lcl ","Lcl_")),0===g.indexOf("Lcl ")&&(g=g.replace("Lcl ","Lcl_")),s="Color"===g||"ColorRGB"===g||"Vector"===g||"Vector3D"===g||0===g.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],n[m]={type:g,type2:_,flag:S,value:s}}else void 0===n[i.name]?"number"==typeof i.id?(n[i.name]={},n[i.name][i.id]=i):n[i.name]=i:"PoseNode"===i.name?(Array.isArray(n[i.name])||(n[i.name]=[n[i.name]]),n[i.name].push(i)):void 0===n[i.name][i.id]&&(n[i.name][i.id]=i)},parseProperty:function(t){var n=t.getString(1);switch(n){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var i=t.getUint32();return t.getArrayBuffer(i);case"S":return i=t.getUint32(),t.getString(i);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var o=t.getUint32(),a=t.getUint32(),s=t.getUint32();if(0===a)switch(n){case"b":case"c":return t.getBooleanArray(o);case"d":return t.getFloat64Array(o);case"f":return t.getFloat32Array(o);case"i":return t.getInt32Array(o);case"l":return t.getInt64Array(o)}void 0===te&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var m=new BinaryReader(new te(new Uint8Array(t.getArrayBuffer(s))).decompress().buffer);switch(n){case"b":case"c":return m.getBooleanArray(o);case"d":return m.getFloat64Array(o);case"f":return m.getFloat32Array(o);case"i":return m.getInt32Array(o);case"l":return m.getInt64Array(o)}default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}},BinaryReader.prototype={constructor:BinaryReader,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(t){for(var n=[],i=0;i<t;i++)n.push(this.getBoolean());return n},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var n=[],i=0;i<t;i++)n.push(this.getInt32());return n},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getInt64:function(){var t,n;return this.littleEndian?(t=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),t=this.getUint32()),2147483648&n?(n=4294967295&~n,4294967295==(t=4294967295&~t)&&(n=n+1&4294967295),-(4294967296*n+(t=t+1&4294967295))):4294967296*n+t},getInt64Array:function(t){for(var n=[],i=0;i<t;i++)n.push(this.getInt64());return n},getUint64:function(){var t,n;return this.littleEndian?(t=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),t=this.getUint32()),4294967296*n+t},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var n=[],i=0;i<t;i++)n.push(this.getFloat32());return n},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var n=[],i=0;i<t;i++)n.push(this.getFloat64());return n},getArrayBuffer:function(t){var n=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,n},getString:function(t){for(var n=[],i=0;i<t;i++)n[i]=this.getUint8();var a=n.indexOf(0);return a>=0&&(n=n.slice(0,a)),o.LoaderUtils.decodeText(new Uint8Array(n))}},FBXTree.prototype={constructor:FBXTree,add:function(t,n){this[t]=n}};var a=[];function getData(t,n,i,o){var s;switch(o.mappingType){case"ByPolygonVertex":s=t;break;case"ByPolygon":s=n;break;case"ByVertice":s=i;break;case"AllSame":s=o.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+o.mappingType)}"IndexToDirect"===o.referenceType&&(s=o.indices[s]);var m=s*o.dataSize,g=m+o.dataSize;return function slice(t,n,i,o){for(var a=i,s=0;a<o;a++,s++)t[s]=n[a];return t}(a,o.buffer,m,g)}var s=new o.Euler,m=new o.Vector3;function generateTransform(t){var n,i=new o.Matrix4,a=new o.Matrix4,g=new o.Matrix4,_=new o.Matrix4,S=new o.Matrix4,M=new o.Matrix4,T=new o.Matrix4,O=new o.Matrix4,A=new o.Matrix4,P=new o.Matrix4,L=new o.Matrix4,R=t.inheritType?t.inheritType:0;t.translation&&i.setPosition(m.fromArray(t.translation)),t.preRotation&&((n=t.preRotation.map(o.MathUtils.degToRad)).push(t.eulerOrder),a.makeRotationFromEuler(s.fromArray(n))),t.rotation&&((n=t.rotation.map(o.MathUtils.degToRad)).push(t.eulerOrder),g.makeRotationFromEuler(s.fromArray(n))),t.postRotation&&((n=t.postRotation.map(o.MathUtils.degToRad)).push(t.eulerOrder),_.makeRotationFromEuler(s.fromArray(n))),t.scale&&S.scale(m.fromArray(t.scale)),t.scalingOffset&&T.setPosition(m.fromArray(t.scalingOffset)),t.scalingPivot&&M.setPosition(m.fromArray(t.scalingPivot)),t.rotationOffset&&O.setPosition(m.fromArray(t.rotationOffset)),t.rotationPivot&&A.setPosition(m.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(P=t.parentMatrixWorld);var N=a.multiply(g).multiply(_),I=new o.Matrix4;P.extractRotation(I),(new o.Matrix4).copyPosition(P);var j=new o.Matrix4;j.copy(I).invert().multiply(P);var V=new o.Matrix4;if(0===R)V.copy(I).multiply(N).multiply(j).multiply(S);else if(1===R)V.copy(I).multiply(j).multiply(N).multiply(S);else{var U=new o.Matrix4;U.copy(S).invert();var G=(new o.Matrix4).multiply(j).multiply(U);V.copy(I).multiply(N).multiply(G).multiply(S)}var z=new o.Matrix4;z.copy(A).invert();var H=new o.Matrix4;H.copy(M).invert();var q=new o.Matrix4;q.copy(i).multiply(O).multiply(A).multiply(a).multiply(g).multiply(_).multiply(z).multiply(T).multiply(M).multiply(S).multiply(H);var Z=(new o.Matrix4).copyPosition(q),X=(new o.Matrix4).copy(P).multiply(Z);return L.copyPosition(X),(new o.Matrix4).multiply(L).multiply(V)}function getEulerOrder(t){var n=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),n[0]):n[t]}function parseNumberArray(t){return t.split(",").map((function(t){return parseFloat(t)}))}function convertArrayBufferToString(t,n,i){return void 0===n&&(n=0),void 0===i&&(i=t.byteLength),o.LoaderUtils.decodeText(new Uint8Array(t,n,i))}function inject(t,n,i){return t.slice(0,n).concat(i).concat(t.slice(n))}return FBXLoader}()},function(t,n,i){"use strict";i.r(n),i.d(n,"ColladaLoader",(function(){return ColladaLoader}));var o=i(0),TGALoader=function(t){o.Loader.call(this,t)};TGALoader.prototype=Object.assign(Object.create(o.Loader.prototype),{constructor:TGALoader,load:function(t,n,i,a){var s=this,m=new o.Texture,g=new o.FileLoader(this.manager);return g.setResponseType("arraybuffer"),g.setPath(this.path),g.setWithCredentials(this.withCredentials),g.load(t,(function(t){m.image=s.parse(t),m.needsUpdate=!0,void 0!==n&&n(m)}),i,a),m},parse:function(t){t.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var n=new Uint8Array(t),i=0,o={id_length:n[i++],colormap_type:n[i++],image_type:n[i++],colormap_index:n[i++]|n[i++]<<8,colormap_length:n[i++]|n[i++]<<8,colormap_size:n[i++],origin:[n[i++]|n[i++]<<8,n[i++]|n[i++]<<8],width:n[i++]|n[i++]<<8,height:n[i++]|n[i++]<<8,pixel_size:n[i++],flags:n[i++]};!function tgaCheckHeader(t){switch(t.image_type){case 1:case 9:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:t.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',t.image_type)}(t.width<=0||t.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',t.pixel_size)}(o),o.id_length+i>t.length&&console.error("THREE.TGALoader: No data."),i+=o.id_length;var a=!1,s=!1,m=!1;switch(o.image_type){case 9:a=!0,s=!0;break;case 1:s=!0;break;case 10:a=!0;break;case 2:break;case 11:a=!0,m=!0;break;case 3:m=!0}var g="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(o.width,o.height):document.createElement("canvas");g.width=o.width,g.height=o.height;var _=g.getContext("2d"),S=_.createImageData(o.width,o.height),M=function tgaParse(t,n,i,o,a){var s,m,g,_;if(m=i.pixel_size>>3,g=i.width*i.height*m,n&&(_=a.subarray(o,o+=i.colormap_length*(i.colormap_size>>3))),t){var S,M,T;s=new Uint8Array(g);for(var O=0,A=new Uint8Array(m);O<g;)if(M=1+(127&(S=a[o++])),128&S){for(T=0;T<m;++T)A[T]=a[o++];for(T=0;T<M;++T)s.set(A,O+T*m);O+=m*M}else{for(M*=m,T=0;T<M;++T)s[O+T]=a[o++];O+=M}}else s=a.subarray(o,o+=n?i.width*i.height:g);return{pixel_data:s,palettes:_}}(a,s,o,i,n);return function getTgaRGBA(t,n,i,a,s){var g,_,S,M,T,O;switch((48&o.flags)>>4){default:case 2:g=0,S=1,T=n,_=0,M=1,O=i;break;case 0:g=0,S=1,T=n,_=i-1,M=-1,O=-1;break;case 3:g=n-1,S=-1,T=-1,_=0,M=1,O=i;break;case 1:g=n-1,S=-1,T=-1,_=i-1,M=-1,O=-1}if(m)switch(o.pixel_size){case 8:!function tgaGetImageDataGrey8bits(t,n,i,a,s,m,g,_){var S,M,T,O=0,A=o.width;for(T=n;T!==a;T+=i)for(M=s;M!==g;M+=m,O++)S=_[O],t[4*(M+A*T)+0]=S,t[4*(M+A*T)+1]=S,t[4*(M+A*T)+2]=S,t[4*(M+A*T)+3]=255}(t,_,M,O,g,S,T,a);break;case 16:!function tgaGetImageDataGrey16bits(t,n,i,a,s,m,g,_){var S,M,T=0,O=o.width;for(M=n;M!==a;M+=i)for(S=s;S!==g;S+=m,T+=2)t[4*(S+O*M)+0]=_[T+0],t[4*(S+O*M)+1]=_[T+0],t[4*(S+O*M)+2]=_[T+0],t[4*(S+O*M)+3]=_[T+1]}(t,_,M,O,g,S,T,a);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(o.pixel_size){case 8:!function tgaGetImageData8bits(t,n,i,a,s,m,g,_,S){var M,T,O,A=S,P=0,L=o.width;for(O=n;O!==a;O+=i)for(T=s;T!==g;T+=m,P++)M=_[P],t[4*(T+L*O)+3]=255,t[4*(T+L*O)+2]=A[3*M+0],t[4*(T+L*O)+1]=A[3*M+1],t[4*(T+L*O)+0]=A[3*M+2]}(t,_,M,O,g,S,T,a,s);break;case 16:!function tgaGetImageData16bits(t,n,i,a,s,m,g,_){var S,M,T,O=0,A=o.width;for(T=n;T!==a;T+=i)for(M=s;M!==g;M+=m,O+=2)S=_[O+0]+(_[O+1]<<8),t[4*(M+A*T)+0]=(31744&S)>>7,t[4*(M+A*T)+1]=(992&S)>>2,t[4*(M+A*T)+2]=(31&S)>>3,t[4*(M+A*T)+3]=32768&S?0:255}(t,_,M,O,g,S,T,a);break;case 24:!function tgaGetImageData24bits(t,n,i,a,s,m,g,_){var S,M,T=0,O=o.width;for(M=n;M!==a;M+=i)for(S=s;S!==g;S+=m,T+=3)t[4*(S+O*M)+3]=255,t[4*(S+O*M)+2]=_[T+0],t[4*(S+O*M)+1]=_[T+1],t[4*(S+O*M)+0]=_[T+2]}(t,_,M,O,g,S,T,a);break;case 32:!function tgaGetImageData32bits(t,n,i,a,s,m,g,_){var S,M,T=0,O=o.width;for(M=n;M!==a;M+=i)for(S=s;S!==g;S+=m,T+=4)t[4*(S+O*M)+2]=_[T+0],t[4*(S+O*M)+1]=_[T+1],t[4*(S+O*M)+0]=_[T+2],t[4*(S+O*M)+3]=_[T+3]}(t,_,M,O,g,S,T,a);break;default:console.error("THREE.TGALoader: Format not supported.")}}(S.data,o.width,o.height,M.pixel_data,M.palettes),_.putImageData(S,0,0),g}});var ColladaLoader=function(t){o.Loader.call(this,t)};ColladaLoader.prototype=Object.assign(Object.create(o.Loader.prototype),{constructor:ColladaLoader,load:function(t,n,i,a){var s=this,m=""===s.path?o.LoaderUtils.extractUrlBase(t):s.path,g=new o.FileLoader(s.manager);g.setPath(s.path),g.setRequestHeader(s.requestHeader),g.setWithCredentials(s.withCredentials),g.load(t,(function(i){try{n(s.parse(i,m))}catch(n){a?a(n):console.error(n),s.manager.itemError(t)}}),i,a)},options:{set convertUpAxis(t){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(t,n){function getElementsByTagName(t,n){for(var i=[],o=t.childNodes,a=0,s=o.length;a<s;a++){var m=o[a];m.nodeName===n&&i.push(m)}return i}function parseStrings(t){if(0===t.length)return[];for(var n=t.trim().split(/\s+/),i=new Array(n.length),o=0,a=n.length;o<a;o++)i[o]=n[o];return i}function parseFloats(t){if(0===t.length)return[];for(var n=t.trim().split(/\s+/),i=new Array(n.length),o=0,a=n.length;o<a;o++)i[o]=parseFloat(n[o]);return i}function parseInts(t){if(0===t.length)return[];for(var n=t.trim().split(/\s+/),i=new Array(n.length),o=0,a=n.length;o<a;o++)i[o]=parseInt(n[o]);return i}function parseId(t){return t.substring(1)}function isEmpty(t){return 0===Object.keys(t).length}function parseAssetUnit(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}function parseAssetUpAxis(t){return void 0!==t?t.textContent:"Y_UP"}function parseLibrary(t,n,i,o){var a=getElementsByTagName(t,n)[0];if(void 0!==a)for(var s=getElementsByTagName(a,i),m=0;m<s.length;m++)o(s[m])}function buildLibrary(t,n){for(var i in t)t[i].build=n(t[i])}function getBuild(t,n){return void 0!==t.build||(t.build=n(t)),t.build}function parseAnimationSampler(t){for(var n={inputs:{}},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"input":var s=parseId(a.getAttribute("source")),m=a.getAttribute("semantic");n.inputs[m]=s}}return n}function parseAnimationChannel(t){var n={},i=t.getAttribute("target").split("/"),o=i.shift(),a=i.shift(),s=-1!==a.indexOf("("),m=-1!==a.indexOf(".");if(m)i=a.split("."),a=i.shift(),n.member=i.shift();else if(s){var g=a.split("(");a=g.shift();for(var _=0;_<g.length;_++)g[_]=parseInt(g[_].replace(/\)/,""));n.indices=g}return n.id=o,n.sid=a,n.arraySyntax=s,n.memberSyntax=m,n.sampler=parseId(t.getAttribute("source")),n}function buildAnimation(t){var n=[],i=t.channels,o=t.samplers,a=t.sources;for(var s in i)if(i.hasOwnProperty(s)){var m=i[s],g=o[m.sampler],_=g.inputs.INPUT,S=g.inputs.OUTPUT;createKeyframeTracks(buildAnimationChannel(m,a[_],a[S]),n)}return n}function getAnimation(t){return getBuild(U.animations[t],buildAnimation)}function buildAnimationChannel(t,n,i){var o,a,s,m,g,_,S=U.nodes[t.id],M=getNode(S.id),T=S.transforms[t.sid],O=S.matrix.clone().transpose(),A={};switch(T){case"matrix":for(s=0,m=n.array.length;s<m;s++)if(o=n.array[s],a=s*i.stride,void 0===A[o]&&(A[o]={}),!0===t.arraySyntax){var P=i.array[a],L=t.indices[0]+4*t.indices[1];A[o][L]=P}else for(g=0,_=i.stride;g<_;g++)A[o][g]=i.array[a+g];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',T)}var R=function prepareAnimationData(t,n){var i=[];for(var o in t)i.push({time:parseFloat(o),value:t[o]});i.sort((function ascending(t,n){return t.time-n.time}));for(var a=0;a<16;a++)transformAnimationData(i,a,n.elements[a]);return i}(A,O);return{name:M.uuid,keyframes:R}}var i=new o.Vector3,a=new o.Vector3,s=new o.Quaternion;function createKeyframeTracks(t,n){for(var g=t.keyframes,_=t.name,S=[],M=[],T=[],O=[],A=0,P=g.length;A<P;A++){var L=g[A],R=L.time,N=L.value;m.fromArray(N).transpose(),m.decompose(i,s,a),S.push(R),M.push(i.x,i.y,i.z),T.push(s.x,s.y,s.z,s.w),O.push(a.x,a.y,a.z)}return M.length>0&&n.push(new o.VectorKeyframeTrack(_+".position",S,M)),T.length>0&&n.push(new o.QuaternionKeyframeTrack(_+".quaternion",S,T)),O.length>0&&n.push(new o.VectorKeyframeTrack(_+".scale",S,O)),n}function transformAnimationData(t,n,i){var o,a,s,m=!0;for(a=0,s=t.length;a<s;a++)void 0===(o=t[a]).value[n]?o.value[n]=null:m=!1;if(!0===m)for(a=0,s=t.length;a<s;a++)(o=t[a]).value[n]=i;else!function createMissingKeyframes(t,n){for(var i,o,a=0,s=t.length;a<s;a++){var m=t[a];if(null===m.value[n]){if(i=getPrev(t,a,n),o=getNext(t,a,n),null===i){m.value[n]=o.value[n];continue}if(null===o){m.value[n]=i.value[n];continue}interpolate(m,i,o,n)}}}(t,n)}function getPrev(t,n,i){for(;n>=0;){var o=t[n];if(null!==o.value[i])return o;n--}return null}function getNext(t,n,i){for(;n<t.length;){var o=t[n];if(null!==o.value[i])return o;n++}return null}function interpolate(t,n,i,o){i.time-n.time!=0?t.value[o]=(t.time-n.time)*(i.value[o]-n.value[o])/(i.time-n.time)+n.value[o]:t.value[o]=n.value[o]}function buildAnimationClip(t){for(var n=[],i=t.name,a=t.end-t.start||-1,s=t.animations,m=0,g=s.length;m<g;m++)for(var _=getAnimation(s[m]),S=0,M=_.length;S<M;S++)n.push(_[S]);return new o.AnimationClip(i,a,n)}function getAnimationClip(t){return getBuild(U.clips[t],buildAnimationClip)}function parseSkin(t){for(var n={sources:{}},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":n.bindShapeMatrix=parseFloats(a.textContent);break;case"source":var s=a.getAttribute("id");n.sources[s]=parseSource(a);break;case"joints":n.joints=parseJoints(a);break;case"vertex_weights":n.vertexWeights=parseVertexWeights(a)}}return n}function parseJoints(t){for(var n={inputs:{}},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"input":var s=a.getAttribute("semantic"),m=parseId(a.getAttribute("source"));n.inputs[s]=m}}return n}function parseVertexWeights(t){for(var n={inputs:{}},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"input":var s=a.getAttribute("semantic"),m=parseId(a.getAttribute("source")),g=parseInt(a.getAttribute("offset"));n.inputs[s]={id:m,offset:g};break;case"vcount":n.vcount=parseInts(a.textContent);break;case"v":n.v=parseInts(a.textContent)}}return n}function buildController(t){var n={id:t.id},i=U.geometries[n.id];return void 0!==t.skin&&(n.skin=function buildSkin(t){var n,i,a,s={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},m=t.sources,g=t.vertexWeights,_=g.vcount,S=g.v,M=g.inputs.JOINT.offset,T=g.inputs.WEIGHT.offset,O=t.sources[t.joints.inputs.JOINT],A=t.sources[t.joints.inputs.INV_BIND_MATRIX],P=m[g.inputs.WEIGHT.id].array,L=0;for(n=0,a=_.length;n<a;n++){var R=_[n],N=[];for(i=0;i<R;i++){var I=S[L+M],j=P[S[L+T]];N.push({index:I,weight:j}),L+=2}for(N.sort(descending),i=0;i<4;i++){var V=N[i];void 0!==V?(s.indices.array.push(V.index),s.weights.array.push(V.weight)):(s.indices.array.push(0),s.weights.array.push(0))}}for(t.bindShapeMatrix?s.bindMatrix=(new o.Matrix4).fromArray(t.bindShapeMatrix).transpose():s.bindMatrix=(new o.Matrix4).identity(),n=0,a=O.array.length;n<a;n++){var U=O.array[n],G=(new o.Matrix4).fromArray(A.array,n*A.stride).transpose();s.joints.push({name:U,boneInverse:G})}return s;function descending(t,n){return n.weight-t.weight}}(t.skin),i.sources.skinIndices=n.skin.indices,i.sources.skinWeights=n.skin.weights),n}function buildImage(t){return void 0!==t.build?t.build:t.init_from}function getImage(t){var n=U.images[t];return void 0!==n?getBuild(n,buildImage):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function parseEffectProfileCOMMON(t){for(var n={surfaces:{},samplers:{}},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"newparam":parseEffectNewparam(a,n);break;case"technique":n.technique=parseEffectTechnique(a);break;case"extra":n.extra=parseEffectExtra(a)}}return n}function parseEffectNewparam(t,n){for(var i=t.getAttribute("sid"),o=0,a=t.childNodes.length;o<a;o++){var s=t.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"surface":n.surfaces[i]=parseEffectSurface(s);break;case"sampler2D":n.samplers[i]=parseEffectSampler(s)}}}function parseEffectSurface(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"init_from":n.init_from=a.textContent}}return n}function parseEffectSampler(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"source":n.source=a.textContent}}return n}function parseEffectTechnique(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"constant":case"lambert":case"blinn":case"phong":n.type=a.nodeName,n.parameters=parseEffectParameters(a)}}return n}function parseEffectParameters(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":n[a.nodeName]=parseEffectParameter(a);break;case"transparent":n[a.nodeName]={opaque:a.getAttribute("opaque"),data:parseEffectParameter(a)}}}return n}function parseEffectParameter(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"color":n[a.nodeName]=parseFloats(a.textContent);break;case"float":n[a.nodeName]=parseFloat(a.textContent);break;case"texture":n[a.nodeName]={id:a.getAttribute("texture"),extra:parseEffectParameterTexture(a)}}}return n}function parseEffectParameterTexture(t){for(var n={technique:{}},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"extra":parseEffectParameterTextureExtra(a,n)}}return n}function parseEffectParameterTextureExtra(t,n){for(var i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"technique":parseEffectParameterTextureExtraTechnique(a,n)}}}function parseEffectParameterTextureExtraTechnique(t,n){for(var i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":n.technique[a.nodeName]=parseFloat(a.textContent);break;case"wrapU":case"wrapV":"TRUE"===a.textContent.toUpperCase()?n.technique[a.nodeName]=1:"FALSE"===a.textContent.toUpperCase()?n.technique[a.nodeName]=0:n.technique[a.nodeName]=parseInt(a.textContent)}}}function parseEffectExtra(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"technique":n.technique=parseEffectExtraTechnique(a)}}return n}function parseEffectExtraTechnique(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"double_sided":n[a.nodeName]=parseInt(a.textContent)}}return n}function buildEffect(t){return t}function buildMaterial(t){var n,i=function getEffect(t){return getBuild(U.effects[t],buildEffect)}(t.url),a=i.profile.technique,s=i.profile.extra;switch(a.type){case"phong":case"blinn":n=new o.MeshPhongMaterial;break;case"lambert":n=new o.MeshLambertMaterial;break;default:n=new o.MeshBasicMaterial}function getTexture(t){var n=i.profile.samplers[t.id],a=null;if(void 0!==n?a=getImage(i.profile.surfaces[n.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),a=getImage(t.id)),null!==a){var s=function getTextureLoader(t){var n,i=t.slice(2+(t.lastIndexOf(".")-1>>>0));switch(i=i.toLowerCase()){case"tga":n=L;break;default:n=N}return n}(a);if(void 0!==s){var m=s.load(a),g=t.extra;if(void 0!==g&&void 0!==g.technique&&!1===isEmpty(g.technique)){var _=g.technique;m.wrapS=_.wrapU?o.RepeatWrapping:o.ClampToEdgeWrapping,m.wrapT=_.wrapV?o.RepeatWrapping:o.ClampToEdgeWrapping,m.offset.set(_.offsetU||0,_.offsetV||0),m.repeat.set(_.repeatU||1,_.repeatV||1)}else m.wrapS=o.RepeatWrapping,m.wrapT=o.RepeatWrapping;return m}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",a),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}n.name=t.name||"";var m=a.parameters;for(var g in m){var _=m[g];switch(g){case"diffuse":_.color&&n.color.fromArray(_.color),_.texture&&(n.map=getTexture(_.texture));break;case"specular":_.color&&n.specular&&n.specular.fromArray(_.color),_.texture&&(n.specularMap=getTexture(_.texture));break;case"bump":_.texture&&(n.normalMap=getTexture(_.texture));break;case"ambient":_.texture&&(n.lightMap=getTexture(_.texture));break;case"shininess":_.float&&n.shininess&&(n.shininess=_.float);break;case"emission":_.color&&n.emissive&&n.emissive.fromArray(_.color),_.texture&&(n.emissiveMap=getTexture(_.texture))}}var S=m.transparent,M=m.transparency;if(void 0===M&&S&&(M={float:1}),void 0===S&&M&&(S={opaque:"A_ONE",data:{color:[1,1,1,1]}}),S&&M)if(S.data.texture)n.transparent=!0;else{var T=S.data.color;switch(S.opaque){case"A_ONE":n.opacity=T[3]*M.float;break;case"RGB_ZERO":n.opacity=1-T[0]*M.float;break;case"A_ZERO":n.opacity=1-T[3]*M.float;break;case"RGB_ONE":n.opacity=T[0]*M.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',S.opaque)}n.opacity<1&&(n.transparent=!0)}return void 0!==s&&void 0!==s.technique&&1===s.technique.double_sided&&(n.side=o.DoubleSide),n}function getMaterial(t){return getBuild(U.materials[t],buildMaterial)}function parseCameraOptics(t){for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];switch(i.nodeName){case"technique_common":return parseCameraTechnique(i)}}return{}}function parseCameraTechnique(t){for(var n={},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];switch(o.nodeName){case"perspective":case"orthographic":n.technique=o.nodeName,n.parameters=parseCameraParameters(o)}}return n}function parseCameraParameters(t){for(var n={},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];switch(o.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":n[o.nodeName]=parseFloat(o.textContent)}}return n}function buildCamera(t){var n;switch(t.optics.technique){case"perspective":n=new o.PerspectiveCamera(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var i=t.optics.parameters.ymag,a=t.optics.parameters.xmag,s=t.optics.parameters.aspect_ratio;a=void 0===a?i*s:a,i=void 0===i?a/s:i,a*=.5,i*=.5,n=new o.OrthographicCamera(-a,a,i,-i,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:n=new o.PerspectiveCamera}return n.name=t.name||"",n}function getCamera(t){var n=U.cameras[t];return void 0!==n?getBuild(n,buildCamera):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function parseLightTechnique(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"directional":case"point":case"spot":case"ambient":n.technique=a.nodeName,n.parameters=parseLightParameters(a)}}return n}function parseLightParameters(t){for(var n={},i=0,a=t.childNodes.length;i<a;i++){var s=t.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"color":var m=parseFloats(s.textContent);n.color=(new o.Color).fromArray(m);break;case"falloff_angle":n.falloffAngle=parseFloat(s.textContent);break;case"quadratic_attenuation":var g=parseFloat(s.textContent);n.distance=g?Math.sqrt(1/g):0}}return n}function buildLight(t){var n;switch(t.technique){case"directional":n=new o.DirectionalLight;break;case"point":n=new o.PointLight;break;case"spot":n=new o.SpotLight;break;case"ambient":n=new o.AmbientLight}return t.parameters.color&&n.color.copy(t.parameters.color),t.parameters.distance&&(n.distance=t.parameters.distance),n}function getLight(t){var n=U.lights[t];return void 0!==n?getBuild(n,buildLight):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function parseSource(t){for(var n={array:[],stride:3},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"float_array":n.array=parseFloats(o.textContent);break;case"Name_array":n.array=parseStrings(o.textContent);break;case"technique_common":var a=getElementsByTagName(o,"accessor")[0];void 0!==a&&(n.stride=parseInt(a.getAttribute("stride")))}}return n}function parseGeometryVertices(t){for(var n={},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];1===o.nodeType&&(n[o.getAttribute("semantic")]=parseId(o.getAttribute("source")))}return n}function parseGeometryPrimitive(t){for(var n={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"input":var s=parseId(a.getAttribute("source")),m=a.getAttribute("semantic"),g=parseInt(a.getAttribute("offset")),_=parseInt(a.getAttribute("set")),S=_>0?m+_:m;n.inputs[S]={id:s,offset:g},n.stride=Math.max(n.stride,g+1),"TEXCOORD"===m&&(n.hasUV=!0);break;case"vcount":n.vcount=parseInts(a.textContent);break;case"p":n.p=parseInts(a.textContent)}}return n}function checkUVCoordinates(t){for(var n=0,i=0,o=t.length;i<o;i++)!0===t[i].hasUV&&n++;n>0&&n<t.length&&(t.uvsNeedsFix=!0)}function buildGeometry(t){var n={},i=t.sources,o=t.vertices,a=t.primitives;if(0===a.length)return{};var s=function groupPrimitives(t){for(var n={},i=0;i<t.length;i++){var o=t[i];void 0===n[o.type]&&(n[o.type]=[]),n[o.type].push(o)}return n}(a);for(var m in s){var g=s[m];checkUVCoordinates(g),n[m]=buildGeometryType(g,i,o)}return n}function buildGeometryType(t,n,i){for(var a={},s={array:[],stride:0},m={array:[],stride:0},g={array:[],stride:0},_={array:[],stride:0},S={array:[],stride:0},M=[],T=[],O=new o.BufferGeometry,A=[],P=0,L=0;L<t.length;L++){var R=t[L],N=R.inputs,I=0;switch(R.type){case"lines":case"linestrips":I=2*R.count;break;case"triangles":I=3*R.count;break;case"polylist":for(var j=0;j<R.count;j++){var V=R.vcount[j];switch(V){case 3:I+=3;break;case 4:I+=6;break;default:I+=3*(V-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",R.type)}for(var U in O.addGroup(P,I,L),P+=I,R.material&&A.push(R.material),N){var G=N[U];switch(U){case"VERTEX":for(var z in i){var H=i[z];switch(z){case"POSITION":var q=s.array.length;if(buildGeometryData(R,n[H],G.offset,s.array),s.stride=n[H].stride,n.skinWeights&&n.skinIndices&&(buildGeometryData(R,n.skinIndices,G.offset,M),buildGeometryData(R,n.skinWeights,G.offset,T)),!1===R.hasUV&&!0===t.uvsNeedsFix){I=(s.array.length-q)/s.stride;for(var Z=0;Z<I;Z++)g.array.push(0,0)}break;case"NORMAL":buildGeometryData(R,n[H],G.offset,m.array),m.stride=n[H].stride;break;case"COLOR":buildGeometryData(R,n[H],G.offset,S.array),S.stride=n[H].stride;break;case"TEXCOORD":buildGeometryData(R,n[H],G.offset,g.array),g.stride=n[H].stride;break;case"TEXCOORD1":buildGeometryData(R,n[H],G.offset,_.array),g.stride=n[H].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',z)}}break;case"NORMAL":buildGeometryData(R,n[G.id],G.offset,m.array),m.stride=n[G.id].stride;break;case"COLOR":buildGeometryData(R,n[G.id],G.offset,S.array),S.stride=n[G.id].stride;break;case"TEXCOORD":buildGeometryData(R,n[G.id],G.offset,g.array),g.stride=n[G.id].stride;break;case"TEXCOORD1":buildGeometryData(R,n[G.id],G.offset,_.array),_.stride=n[G.id].stride}}}return s.array.length>0&&O.setAttribute("position",new o.Float32BufferAttribute(s.array,s.stride)),m.array.length>0&&O.setAttribute("normal",new o.Float32BufferAttribute(m.array,m.stride)),S.array.length>0&&O.setAttribute("color",new o.Float32BufferAttribute(S.array,S.stride)),g.array.length>0&&O.setAttribute("uv",new o.Float32BufferAttribute(g.array,g.stride)),_.array.length>0&&O.setAttribute("uv2",new o.Float32BufferAttribute(_.array,_.stride)),M.length>0&&O.setAttribute("skinIndex",new o.Float32BufferAttribute(M,4)),T.length>0&&O.setAttribute("skinWeight",new o.Float32BufferAttribute(T,4)),a.data=O,a.type=t[0].type,a.materialKeys=A,a}function buildGeometryData(t,n,i,o){var a=t.p,s=t.stride,m=t.vcount;function pushVector(t){for(var n=a[t+i]*_,s=n+_;n<s;n++)o.push(g[n])}var g=n.array,_=n.stride;if(void 0!==t.vcount)for(var S=0,M=0,T=m.length;M<T;M++){var O=m[M];if(4===O){var A=S+1*s,P=S+2*s,L=S+3*s;pushVector(S+0*s),pushVector(A),pushVector(L),pushVector(A),pushVector(P),pushVector(L)}else if(3===O)A=S+1*s,P=S+2*s,pushVector(S+0*s),pushVector(A),pushVector(P);else if(O>4)for(var R=1,N=O-2;R<=N;R++)A=S+s*R,P=S+s*(R+1),pushVector(S+0*s),pushVector(A),pushVector(P);S+=s*O}else for(M=0,T=a.length;M<T;M+=s)pushVector(M)}function getGeometry(t){return getBuild(U.geometries[t],buildGeometry)}function buildKinematicsModel(t){return void 0!==t.build?t.build:t}function parseKinematicsTechniqueCommon(t,n){for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"joint":n.joints[o.getAttribute("sid")]=parseKinematicsJoint(o);break;case"link":n.links.push(parseKinematicsLink(o))}}}function parseKinematicsJoint(t){for(var n,i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"prismatic":case"revolute":n=parseKinematicsJointParameter(o)}}return n}function parseKinematicsJointParameter(t,n){n={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new o.Vector3,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<t.childNodes.length;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"axis":var s=parseFloats(a.textContent);n.axis.fromArray(s);break;case"limits":var m=a.getElementsByTagName("max")[0],g=a.getElementsByTagName("min")[0];n.limits.max=parseFloat(m.textContent),n.limits.min=parseFloat(g.textContent)}}return n.limits.min>=n.limits.max&&(n.static=!0),n.middlePosition=(n.limits.min+n.limits.max)/2,n}function parseKinematicsLink(t){for(var n={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"attachment_full":n.attachments.push(parseKinematicsAttachment(o));break;case"matrix":case"translate":case"rotate":n.transforms.push(parseKinematicsTransform(o))}}return n}function parseKinematicsAttachment(t){for(var n={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"link":n.links.push(parseKinematicsLink(o));break;case"matrix":case"translate":case"rotate":n.transforms.push(parseKinematicsTransform(o))}}return n}function parseKinematicsTransform(t){var n={type:t.nodeName},i=parseFloats(t.textContent);switch(n.type){case"matrix":n.obj=new o.Matrix4,n.obj.fromArray(i).transpose();break;case"translate":n.obj=new o.Vector3,n.obj.fromArray(i);break;case"rotate":n.obj=new o.Vector3,n.obj.fromArray(i),n.angle=o.MathUtils.degToRad(i[3])}return n}function parsePhysicsRigidBody(t,n){for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"technique_common":parsePhysicsTechniqueCommon(o,n)}}}function parsePhysicsTechniqueCommon(t,n){for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"inertia":n.inertia=parseFloats(o.textContent);break;case"mass":n.mass=parseFloats(o.textContent)[0]}}}function parseKinematicsBindJointAxis(t){for(var n={target:t.getAttribute("target").split("/").pop()},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"axis":var a=o.getElementsByTagName("param")[0];n.axis=a.textContent;var s=n.axis.split("inst_").pop().split("axis")[0];n.jointIndex=s.substr(0,s.length-1)}}return n}function buildKinematicsScene(t){return void 0!==t.build?t.build:t}function buildTransformList(t){for(var n=[],i=M.querySelector('[id="'+t.id+'"]'),a=0;a<i.childNodes.length;a++){var s=i.childNodes[a];if(1===s.nodeType)switch(s.nodeName){case"matrix":var m=parseFloats(s.textContent),g=(new o.Matrix4).fromArray(m).transpose();n.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:g});break;case"translate":case"scale":m=parseFloats(s.textContent);var _=(new o.Vector3).fromArray(m);n.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:_});break;case"rotate":m=parseFloats(s.textContent),_=(new o.Vector3).fromArray(m);var S=o.MathUtils.degToRad(m[3]);n.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:_,angle:S})}}return n}var m=new o.Matrix4,g=new o.Vector3;function parseNode(t){for(var n={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new o.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<t.childNodes.length;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"node":n.nodes.push(a.getAttribute("id")),parseNode(a);break;case"instance_camera":n.instanceCameras.push(parseId(a.getAttribute("url")));break;case"instance_controller":n.instanceControllers.push(parseNodeInstance(a));break;case"instance_light":n.instanceLights.push(parseId(a.getAttribute("url")));break;case"instance_geometry":n.instanceGeometries.push(parseNodeInstance(a));break;case"instance_node":n.instanceNodes.push(parseId(a.getAttribute("url")));break;case"matrix":var s=parseFloats(a.textContent);n.matrix.multiply(m.fromArray(s).transpose()),n.transforms[a.getAttribute("sid")]=a.nodeName;break;case"translate":s=parseFloats(a.textContent),g.fromArray(s),n.matrix.multiply(m.makeTranslation(g.x,g.y,g.z)),n.transforms[a.getAttribute("sid")]=a.nodeName;break;case"rotate":s=parseFloats(a.textContent);var _=o.MathUtils.degToRad(s[3]);n.matrix.multiply(m.makeRotationAxis(g.fromArray(s),_)),n.transforms[a.getAttribute("sid")]=a.nodeName;break;case"scale":s=parseFloats(a.textContent),n.matrix.scale(g.fromArray(s)),n.transforms[a.getAttribute("sid")]=a.nodeName;break;case"extra":break;default:console.log(a)}}return hasNode(n.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",n.id):U.nodes[n.id]=n,n}function parseNodeInstance(t){for(var n={id:parseId(t.getAttribute("url")),materials:{},skeletons:[]},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];switch(o.nodeName){case"bind_material":for(var a=o.getElementsByTagName("instance_material"),s=0;s<a.length;s++){var m=a[s],g=m.getAttribute("symbol"),_=m.getAttribute("target");n.materials[g]=parseId(_)}break;case"skeleton":n.skeletons.push(parseId(o.textContent))}}return n}function buildSkeleton(t,n){var i,a,s,m=[],g=[];for(i=0;i<t.length;i++){var _=t[i];if(hasNode(_))buildBoneHierarchy(getNode(_),n,m);else if(s=_,void 0!==U.visualScenes[s])for(var S=U.visualScenes[_].children,M=0;M<S.length;M++){var T=S[M];"JOINT"===T.type&&buildBoneHierarchy(getNode(T.id),n,m)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",_)}for(i=0;i<n.length;i++)for(M=0;M<m.length;M++)if((a=m[M]).bone.name===n[i].name){g[i]=a,a.processed=!0;break}for(i=0;i<m.length;i++)!1===(a=m[i]).processed&&(g.push(a),a.processed=!0);var O=[],A=[];for(i=0;i<g.length;i++)a=g[i],O.push(a.bone),A.push(a.boneInverse);return new o.Skeleton(O,A)}function buildBoneHierarchy(t,n,i){t.traverse((function(t){if(!0===t.isBone){for(var a,s=0;s<n.length;s++){var m=n[s];if(m.name===t.name){a=m.boneInverse;break}}void 0===a&&(a=new o.Matrix4),i.push({bone:t,boneInverse:a,processed:!1})}}))}function buildNode(t){for(var n,i=[],a=t.matrix,s=t.nodes,m=t.type,g=t.instanceCameras,_=t.instanceControllers,S=t.instanceLights,M=t.instanceGeometries,T=t.instanceNodes,O=0,A=s.length;O<A;O++)i.push(getNode(s[O]));for(O=0,A=g.length;O<A;O++){var P=getCamera(g[O]);null!==P&&i.push(P.clone())}for(O=0,A=_.length;O<A;O++)for(var L=_[O],R=(n=L.id,getBuild(U.controllers[n],buildController)),N=buildObjects(getGeometry(R.id),L.materials),I=buildSkeleton(L.skeletons,R.skin.joints),j=0,V=N.length;j<V;j++){var G;(G=N[j]).isSkinnedMesh&&(G.bind(I,R.skin.bindMatrix),G.normalizeSkinWeights()),i.push(G)}for(O=0,A=S.length;O<A;O++){var z=getLight(S[O]);null!==z&&i.push(z.clone())}for(O=0,A=M.length;O<A;O++)for(j=0,V=(N=buildObjects(getGeometry((L=M[O]).id),L.materials)).length;j<V;j++)i.push(N[j]);for(O=0,A=T.length;O<A;O++)i.push(getNode(T[O]).clone());if(0===s.length&&1===i.length)G=i[0];else for(G="JOINT"===m?new o.Bone:new o.Group,O=0;O<i.length;O++)G.add(i[O]);return G.name="JOINT"===m?t.sid:t.name,G.matrix.copy(a),G.matrix.decompose(G.position,G.quaternion,G.scale),G}var _=new o.MeshBasicMaterial({color:16711935});function resolveMaterialBinding(t,n){for(var i=[],o=0,a=t.length;o<a;o++){var s=n[t[o]];void 0===s?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[o]),i.push(_)):i.push(getMaterial(s))}return i}function buildObjects(t,n){var i=[];for(var a in t){var s=t[a],m=resolveMaterialBinding(s.materialKeys,n);0===m.length&&("lines"===a||"linestrips"===a?m.push(new o.LineBasicMaterial):m.push(new o.MeshPhongMaterial));var g=void 0!==s.data.attributes.skinIndex;if(g)for(var _=0,S=m.length;_<S;_++)m[_].skinning=!0;var M,T=1===m.length?m[0]:m;switch(a){case"lines":M=new o.LineSegments(s.data,T);break;case"linestrips":M=new o.Line(s.data,T);break;case"triangles":case"polylist":M=g?new o.SkinnedMesh(s.data,T):new o.Mesh(s.data,T)}i.push(M)}return i}function hasNode(t){return void 0!==U.nodes[t]}function getNode(t){return getBuild(U.nodes[t],buildNode)}function buildVisualScene(t){var n=new o.Group;n.name=t.name;for(var i=t.children,a=0;a<i.length;a++){var s=i[a];n.add(getNode(s.id))}return n}function getVisualScene(t){return getBuild(U.visualScenes[t],buildVisualScene)}if(0===t.length)return{scene:new o.Scene};var S=(new DOMParser).parseFromString(t,"application/xml"),M=getElementsByTagName(S,"COLLADA")[0],T=S.getElementsByTagName("parsererror")[0];if(void 0!==T){var O,A=getElementsByTagName(T,"div")[0];return O=A?A.textContent:function parserErrorToText(t){for(var n="",i=[t];i.length;){var o=i.shift();o.nodeType===Node.TEXT_NODE?n+=o.textContent:(n+="\n",i.push.apply(i,o.childNodes))}return n.trim()}(T),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",O),null}var P=M.getAttribute("version");console.log("THREE.ColladaLoader: File version",P);var L,R=function parseAsset(t){return{unit:parseAssetUnit(getElementsByTagName(t,"unit")[0]),upAxis:parseAssetUpAxis(getElementsByTagName(t,"up_axis")[0])}}(getElementsByTagName(M,"asset")[0]),N=new o.TextureLoader(this.manager);N.setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin),TGALoader&&(L=new TGALoader(this.manager)).setPath(this.resourcePath||n);var I=[],j={},V=0,U={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};parseLibrary(M,"library_animations","animation",(function parseAnimation(t){for(var n={sources:{},samplers:{},channels:{}},i=!1,a=0,s=t.childNodes.length;a<s;a++){var m,g=t.childNodes[a];if(1===g.nodeType)switch(g.nodeName){case"source":m=g.getAttribute("id"),n.sources[m]=parseSource(g);break;case"sampler":m=g.getAttribute("id"),n.samplers[m]=parseAnimationSampler(g);break;case"channel":m=g.getAttribute("target"),n.channels[m]=parseAnimationChannel(g);break;case"animation":parseAnimation(g),i=!0;break;default:console.log(g)}}!1===i&&(U.animations[t.getAttribute("id")||o.MathUtils.generateUUID()]=n)})),parseLibrary(M,"library_animation_clips","animation_clip",(function parseAnimationClip(t){for(var n={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"instance_animation":n.animations.push(parseId(a.getAttribute("url")))}}U.clips[t.getAttribute("id")]=n})),parseLibrary(M,"library_controllers","controller",(function parseController(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"skin":n.id=parseId(a.getAttribute("source")),n.skin=parseSkin(a);break;case"morph":n.id=parseId(a.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}U.controllers[t.getAttribute("id")]=n})),parseLibrary(M,"library_images","image",(function parseImage(t){var n={init_from:getElementsByTagName(t,"init_from")[0].textContent};U.images[t.getAttribute("id")]=n})),parseLibrary(M,"library_effects","effect",(function parseEffect(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"profile_COMMON":n.profile=parseEffectProfileCOMMON(a)}}U.effects[t.getAttribute("id")]=n})),parseLibrary(M,"library_materials","material",(function parseMaterial(t){for(var n={name:t.getAttribute("name")},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"instance_effect":n.url=parseId(a.getAttribute("url"))}}U.materials[t.getAttribute("id")]=n})),parseLibrary(M,"library_cameras","camera",(function parseCamera(t){for(var n={name:t.getAttribute("name")},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"optics":n.optics=parseCameraOptics(a)}}U.cameras[t.getAttribute("id")]=n})),parseLibrary(M,"library_lights","light",(function parseLight(t){for(var n={},i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"technique_common":n=parseLightTechnique(a)}}U.lights[t.getAttribute("id")]=n})),parseLibrary(M,"library_geometries","geometry",(function parseGeometry(t){var n={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},i=getElementsByTagName(t,"mesh")[0];if(void 0!==i){for(var o=0;o<i.childNodes.length;o++){var a=i.childNodes[o];if(1===a.nodeType){var s=a.getAttribute("id");switch(a.nodeName){case"source":n.sources[s]=parseSource(a);break;case"vertices":n.vertices=parseGeometryVertices(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":n.primitives.push(parseGeometryPrimitive(a));break;default:console.log(a)}}}U.geometries[t.getAttribute("id")]=n}})),parseLibrary(M,"library_nodes","node",parseNode),parseLibrary(M,"library_visual_scenes","visual_scene",(function parseVisualScene(t){var n={name:t.getAttribute("name"),children:[]};!function prepareNodes(t){for(var n=t.getElementsByTagName("node"),i=0;i<n.length;i++){var o=n[i];!1===o.hasAttribute("id")&&o.setAttribute("id","three_default_"+V++)}}(t);for(var i=getElementsByTagName(t,"node"),o=0;o<i.length;o++)n.children.push(parseNode(i[o]));U.visualScenes[t.getAttribute("id")]=n})),parseLibrary(M,"library_kinematics_models","kinematics_model",(function parseKinematicsModel(t){for(var n={name:t.getAttribute("name")||"",joints:{},links:[]},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"technique_common":parseKinematicsTechniqueCommon(o,n)}}U.kinematicsModels[t.getAttribute("id")]=n})),parseLibrary(M,"library_physics_models","physics_model",(function parsePhysicsModel(t){for(var n={name:t.getAttribute("name")||"",rigidBodies:{}},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"rigid_body":n.rigidBodies[o.getAttribute("name")]={},parsePhysicsRigidBody(o,n.rigidBodies[o.getAttribute("name")])}}U.physicsModels[t.getAttribute("id")]=n})),parseLibrary(M,"scene","instance_kinematics_scene",(function parseKinematicsScene(t){for(var n={bindJointAxis:[]},i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"bind_joint_axis":n.bindJointAxis.push(parseKinematicsBindJointAxis(o))}}U.kinematicsScenes[parseId(t.getAttribute("url"))]=n})),buildLibrary(U.animations,buildAnimation),buildLibrary(U.clips,buildAnimationClip),buildLibrary(U.controllers,buildController),buildLibrary(U.images,buildImage),buildLibrary(U.effects,buildEffect),buildLibrary(U.materials,buildMaterial),buildLibrary(U.cameras,buildCamera),buildLibrary(U.lights,buildLight),buildLibrary(U.geometries,buildGeometry),buildLibrary(U.visualScenes,buildVisualScene),function setupAnimations(){var t=U.clips;if(!0===isEmpty(t)){if(!1===isEmpty(U.animations)){var n=[];for(var i in U.animations)for(var a=getAnimation(i),s=0,m=a.length;s<m;s++)n.push(a[s]);I.push(new o.AnimationClip("default",-1,n))}}else for(var i in t)I.push(getAnimationClip(i))}(),function setupKinematics(){var t=Object.keys(U.kinematicsModels)[0],n=Object.keys(U.kinematicsScenes)[0],i=Object.keys(U.visualScenes)[0];if(void 0!==t&&void 0!==n){for(var a=function getKinematicsModel(t){return getBuild(U.kinematicsModels[t],buildKinematicsModel)}(t),s=function getKinematicsScene(t){return getBuild(U.kinematicsScenes[t],buildKinematicsScene)}(n),g=getVisualScene(i),_=s.bindJointAxis,S={},T=0,O=_.length;T<O;T++){var A=_[T],P=M.querySelector('[sid="'+A.target+'"]');if(P){var L=P.parentElement;connect(A.jointIndex,L)}}var R=new o.Matrix4;j={joints:a&&a.joints,getJointValue:function(t){var n=S[t];if(n)return n.position;console.warn("THREE.ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,n){var i=S[t];if(i){var a=i.joint;if(n>a.limits.max||n<a.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+n+" outside of limits (min: "+a.limits.min+", max: "+a.limits.max+").");else if(a.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{var s=i.object,g=a.axis,_=i.transforms;m.identity();for(var M=0;M<_.length;M++){var T=_[M];if(T.sid&&-1!==T.sid.indexOf(t))switch(a.type){case"revolute":m.multiply(R.makeRotationAxis(g,o.MathUtils.degToRad(n)));break;case"prismatic":m.multiply(R.makeTranslation(g.x*n,g.y*n,g.z*n));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+a.type)}else switch(T.type){case"matrix":m.multiply(T.obj);break;case"translate":m.multiply(R.makeTranslation(T.obj.x,T.obj.y,T.obj.z));break;case"scale":m.scale(T.obj);break;case"rotate":m.multiply(R.makeRotationAxis(T.obj,T.angle))}}s.matrix.copy(m),s.matrix.decompose(s.position,s.quaternion,s.scale),S[t].position=n}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}function connect(t,n){var i=n.getAttribute("name"),o=a.joints[t];g.traverse((function(a){a.name===i&&(S[t]={object:a,transforms:buildTransformList(n),joint:o,position:o.zeroPosition})}))}}();var G=function parseScene(t){return getVisualScene(parseId(getElementsByTagName(t,"instance_visual_scene")[0].getAttribute("url")))}(getElementsByTagName(M,"scene")[0]);return G.animations=I,"Z_UP"===R.upAxis&&G.quaternion.setFromEuler(new o.Euler(-Math.PI/2,0,0)),G.scale.multiplyScalar(R.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),I},kinematics:j,library:U,scene:G}}})},function(t,n,i){"use strict";i.r(n),i.d(n,"EffectComposer",(function(){return EffectComposer})),i.d(n,"Pass",(function(){return EffectComposer_Pass}));var o=i(0),a=i(70),s=i(67),m=i(30),MaskPass=function(t,n){m.a.call(this),this.scene=t,this.camera=n,this.clear=!0,this.needsSwap=!1,this.inverse=!1};MaskPass.prototype=Object.assign(Object.create(m.a.prototype),{constructor:MaskPass,render:function(t,n,i){var o,a,s=t.getContext(),m=t.state;m.buffers.color.setMask(!1),m.buffers.depth.setMask(!1),m.buffers.color.setLocked(!0),m.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),m.buffers.stencil.setTest(!0),m.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),m.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),m.buffers.stencil.setClear(a),m.buffers.stencil.setLocked(!0),t.setRenderTarget(i),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),m.buffers.color.setLocked(!1),m.buffers.depth.setLocked(!1),m.buffers.stencil.setLocked(!1),m.buffers.stencil.setFunc(s.EQUAL,1,4294967295),m.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),m.buffers.stencil.setLocked(!0)}});var ClearMaskPass=function(){m.a.call(this),this.needsSwap=!1};ClearMaskPass.prototype=Object.create(m.a.prototype),Object.assign(ClearMaskPass.prototype,{render:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}});var EffectComposer=function(t,n){if(this.renderer=t,void 0===n){var i={minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBAFormat},m=t.getSize(new o.Vector2);this._pixelRatio=t.getPixelRatio(),this._width=m.width,this._height=m.height,(n=new o.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,i)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===a.CopyShader&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===s.ShaderPass&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new s.ShaderPass(a.CopyShader),this.clock=new o.Clock};Object.assign(EffectComposer.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(t,n){this.passes.splice(n,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},removePass:function(t){const n=this.passes.indexOf(t);-1!==n&&this.passes.splice(n,1)},isLastEnabledPass:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].enabled)return!1;return!0},render:function(t){void 0===t&&(t=this.clock.getDelta());var n,i,o=this.renderer.getRenderTarget(),a=!1,s=this.passes.length;for(i=0;i<s;i++)if(!1!==(n=this.passes[i]).enabled){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),n.render(this.renderer,this.writeBuffer,this.readBuffer,t,a),n.needsSwap){if(a){var m=this.renderer.getContext(),g=this.renderer.state.buffers.stencil;g.setFunc(m.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),g.setFunc(m.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==MaskPass&&(n instanceof MaskPass?a=!0:n instanceof ClearMaskPass&&(a=!1))}this.renderer.setRenderTarget(o)},reset:function(t){if(void 0===t){var n=this.renderer.getSize(new o.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=n.width,this._height=n.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,n){this._width=t,this._height=n;var i=this._width*this._pixelRatio,o=this._height*this._pixelRatio;this.renderTarget1.setSize(i,o),this.renderTarget2.setSize(i,o);for(var a=0;a<this.passes.length;a++)this.passes[a].setSize(i,o)},setPixelRatio:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}});var g,_,S,EffectComposer_Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(EffectComposer_Pass.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),EffectComposer_Pass.FullScreenQuad=(g=new o.OrthographicCamera(-1,1,1,-1,0,1),_=new o.PlaneBufferGeometry(2,2),S=function(t){this._mesh=new o.Mesh(_,t)},Object.defineProperty(S.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(S.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,g)}}),S)},function(t,n,i){"use strict";i.r(n),i.d(n,"TAARenderPass",(function(){return TAARenderPass}));var o=i(0),a=i(30),s=i(70),SSAARenderPass=function(t,n,i,m){a.a.call(this),this.scene=t,this.camera=n,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==i?i:0,this.clearAlpha=void 0!==m?m:0,this._oldClearColor=new o.Color,void 0===s.CopyShader&&console.error("THREE.SSAARenderPass relies on CopyShader");var g=s.CopyShader;this.copyUniforms=o.UniformsUtils.clone(g.uniforms),this.copyMaterial=new o.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:o.AdditiveBlending,depthTest:!1,depthWrite:!1}),this.fsQuad=new a.a.FullScreenQuad(this.copyMaterial)};SSAARenderPass.prototype=Object.assign(Object.create(a.a.prototype),{constructor:SSAARenderPass,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(t,n){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(t,n)},render:function(t,n,i){this.sampleRenderTarget||(this.sampleRenderTarget=new o.WebGLRenderTarget(i.width,i.height,{minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBAFormat}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var a=SSAARenderPass.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],s=t.autoClear;t.autoClear=!1,t.getClearColor(this._oldClearColor);var m=t.getClearAlpha(),g=1/a.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var _=i.width,S=i.height,M=0;M<a.length;M++){var T=a[M];this.camera.setViewOffset&&this.camera.setViewOffset(_,S,.0625*T[0],.0625*T[1],_,S);var O=g;this.unbiased&&(O+=1/32*((M+.5)/a.length-.5)),this.copyUniforms.opacity.value=O,t.setClearColor(this.clearColor,this.clearAlpha),t.setRenderTarget(this.sampleRenderTarget),t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(this.renderToScreen?null:n),0===M&&(t.setClearColor(0,0),t.clear()),this.fsQuad.render(t)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),t.autoClear=s,t.setClearColor(this._oldClearColor,m)}}),SSAARenderPass.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var TAARenderPass=function(t,n,i,o){void 0===SSAARenderPass&&console.error("THREE.TAARenderPass relies on SSAARenderPass"),SSAARenderPass.call(this,t,n,i,o),this.sampleLevel=0,this.accumulate=!1};TAARenderPass.JitterVectors=SSAARenderPass.JitterVectors,TAARenderPass.prototype=Object.assign(Object.create(SSAARenderPass.prototype),{constructor:TAARenderPass,render:function(t,n,i,a){if(!this.accumulate)return SSAARenderPass.prototype.render.call(this,t,n,i,a),void(this.accumulateIndex=-1);var s=TAARenderPass.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new o.WebGLRenderTarget(i.width,i.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new o.WebGLRenderTarget(i.width,i.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(SSAARenderPass.prototype.render.call(this,t,this.holdRenderTarget,i,a),this.accumulateIndex=0);var m=t.autoClear;t.autoClear=!1;var g=1/s.length;if(this.accumulateIndex>=0&&this.accumulateIndex<s.length){this.copyUniforms.opacity.value=g,this.copyUniforms.tDiffuse.value=n.texture;for(var _=Math.pow(2,this.sampleLevel),S=0;S<_;S++){var M=s[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(i.width,i.height,.0625*M[0],.0625*M[1],i.width,i.height),t.setRenderTarget(n),t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(this.sampleRenderTarget),0===this.accumulateIndex&&t.clear(),this.fsQuad.render(t),this.accumulateIndex++,this.accumulateIndex>=s.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}var T=this.accumulateIndex*g;T>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,t.setRenderTarget(n),t.clear(),this.fsQuad.render(t)),T<1&&(this.copyUniforms.opacity.value=1-T,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,t.setRenderTarget(n),0===T&&t.clear(),this.fsQuad.render(t)),t.autoClear=m}})}])}))},function(t,n,i){"use strict";function IsValidModel(t){return/((glb)|(gltf))$/i.test(t)}function IsValidImage(t){return/((jpeg)|(jpg)|(gif)|(png)|(svg))$/i.test(t)}function IsValidVideo(t){return/mp4$/i.test(t)}function toHex(t){return t=parseInt(t,10),isNaN(t)?"00":(t=Math.max(0,Math.min(t,255)),"0123456789ABCDEF".charAt((t-t%16)/16)+"0123456789ABCDEF".charAt(t%16))}Object.defineProperty(n,"__esModule",{value:!0}),n.MediaUtils=void 0,n.MediaUtils={GetHdrUrlFromFile:function GetHdrUrlFromFile(t){return/hdr$/.test(null==t?void 0:t.name)?URL.createObjectURL(t)+"#.hdr":URL.createObjectURL(t)},GetVideoPreviewUrl:function GetVideoPreviewUrl(t){var n,i=null===(n=null==t?void 0:t.value)||void 0===n?void 0:n.find((function(t){return"preview_url"===t.type}));return null==i?void 0:i.value},IsValidModelHdriMap:function IsValidModelHdriMap(t){return/(hdr)$/i.test(t)},GetMediaUrl:function GetMediaUrl(t){var n,i=null===(n=null==t?void 0:t.value)||void 0===n?void 0:n.find((function(t){return"url"===t.type}));return null==i?void 0:i.value},IsValidSystemFile:function IsValidSystemFile(t){return IsValidModel(t)||IsValidImage(t)||IsValidVideo(t)},IsValidImage,IsValidModel,IsValidVideo,hexToRgb:function hexToRgb(t){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},RGBAtoRGB:function RGBAtoRGB(t,n,i,o,a,s,m){return void 0===a&&(a=256),void 0===s&&(s=256),void 0===m&&(m=256),{r:Math.round((1-o)*a+o*t),g:Math.round((1-o)*s+o*n),b:Math.round((1-o)*m+o*i)}},RGBToHex:function RGBToHex(t,n,i){return toHex(t)+toHex(n)+toHex(i)},IsValidHexColor:function IsValidHexColor(t){return/^#[0-9A-F]{6}$/i.test(t)},IsValidRGBColor:function IsValidRGBColor(t){var n=t.replace(" ","").toLocaleLowerCase();return/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/i.test(n)}}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getFilterByName=n.formatFilter=void 0,n.formatFilter=function formatFilter(t,n){n||(n=[]);var i=n.find((function(n){return n.name===t.name}));return{name:i?i.alias:t.name,customFieldName:t.customFieldName||t.name,options:t.options,operator:t.operator}},n.getFilterByName=function getFilterByName(t,n){return n.getFilters().find((function(n){return n.name===t}))}},function(t,n){const i=Array.isArray,isObject=t=>!("object"!=typeof t||null===t||i(t)||t instanceof Date);t.exports={isArray:i,isObject,isContainer:t=>i(t)||isObject(t),map:function map(t,n){return i(t)?t.map(n):function mapObject(t,n){const i={};for(let o in t)i[o]=n(t[o],o,t);return i}(t,n)},forEach:function forEach(t,n){return i(t)?t.forEach(n):function forEachObject(t,n){for(let i in t)n(t[i],i,t)}(t,n)}}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}},s=this&&this.__read||function(t,n){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,a,s=i.call(t),m=[];try{for(;(void 0===n||n-- >0)&&!(o=s.next()).done;)m.push(o.value)}catch(t){a={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return m},m=this&&this.__spreadArray||function(t,n){for(var i=0,o=n.length,a=t.length;i<o;i++,a++)t[a]=n[i];return t},g=this&&this.__values||function(t){var n="function"==typeof Symbol&&Symbol.iterator,i=n&&t[n],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},_=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.mobileAndTabletCheck=n.mergeConfigs=n.traverse=n.GetRequest=n.omitDeep=n.hashCode=n.getNormalizedWheelDelta=n.MultiMap=n.GetVideoSizeFromFile=n.GetImageSizeFromFile=n.GetMediaSizeFromFile=n.GetTypeFromFileName=n.MediaTypes=n.extractInitials=n.lerpHexColor=n.Lerp=n.TryParseJson=n.FileToVideo=n.WaitMs=n.FileToImage=n.removeKeyByValue=n.getKeyByValue=n.OpenUsdz=n.isARSupported=n.refreshHTMLElement=n.PreventWheelZoomOnElement=n.GetQueryFromUrl=n.string2HtmlElement=n.sleep=void 0;var S=_(i(51)),M=_(i(234)),T=_(i(113)),O=_(i(18)),A=_(i(242)),P=_(i(243));function GetTypeFromFileName(t){return/(png|jpeg|jpg|gif|svg)$/i.test(t)?n.MediaTypes.IMAGE:/(avi|mp4|webm)$/i.test(t)?n.MediaTypes.VIDEO:n.MediaTypes.UNKNOWN}function GetImageSizeFromFile(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){var o=new FileReader;o.onload=function(){var t=new Image;t.onerror=i,t.onload=function(){n({width:t.width,height:t.height})},t.src=o.result},o.onerror=i,o.readAsDataURL(t)}))]}))}))}function GetVideoSizeFromFile(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){var o=new FileReader;o.onload=function(){var t=document.createElement("video");t.muted=!0,t.loop=!0,t.width=1,t.height=1,t.crossOrigin="anonymous";var a=document.createElement("source");a.src=o.result,a.type="video/mp4",t.appendChild(a),t.onerror=i,t.onloadedmetadata=function(i){n({width:t.videoWidth,height:t.videoHeight}),t.remove()},t.play()},o.onerror=i,o.readAsDataURL(t)}))]}))}))}n.sleep=function(t){return new Promise((function(n){setTimeout((function(){n(void 0)}),t)}))},n.string2HtmlElement=function string2HtmlElement(t){var n=document.createElement("div");return n.innerHTML=t,n.firstChild},n.GetQueryFromUrl=function GetQueryFromUrl(t,n){n||(n=window.location.href),t=t.replace(/[[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(n);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},n.PreventWheelZoomOnElement=function PreventWheelZoomOnElement(t){t.addEventListener("mousewheel",(function(t){(t.ctrlKey||t.metaKey)&&t.preventDefault()}))},n.refreshHTMLElement=function refreshHTMLElement(t){var n=t.style.display;t.style.display="none",window.setTimeout((function(){t.style.display=n}),20)},n.isARSupported=function isARSupported(){return document.createElement("a").relList.supports("ar")},n.OpenUsdz=function OpenUsdz(t,n){var i=document.createElement("a");i.relList.supports("ar"),i.rel="ar",i.href=t;var o=document.createElement("img");o.src=n,o.width=250,o.height=250,i.appendChild(o),i.click()},n.getKeyByValue=function getKeyByValue(t,n){var i=new Map;return Array.from(t.keys()).forEach((function(o){t.get(o)===n&&i.set(o,n)})),i},n.removeKeyByValue=function removeKeyByValue(t,n){var i=new Map;return Array.from(t.keys()).forEach((function(o){t.get(o)===n&&(t.delete(o),i.set(o,n))})),i},n.FileToImage=function FileToImage(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){var o=new FileReader;o.onload=function(){var t=new Image;t.onload=function(){n(t)},t.onerror=i,t.src=o.result},o.readAsDataURL(t)}))]}))}))},n.WaitMs=function WaitMs(t){return void 0===t&&(t=0),o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){window.setTimeout((function(){n()}),t)}))]}))}))},n.FileToVideo=function FileToVideo(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n,i){var o=new FileReader;o.onload=function(){var t=document.createElement("video");t.onloadedmetadata=function(){n(t)},t.onerror=i,t.src=o.result},o.readAsDataURL(t)}))]}))}))},n.TryParseJson=function TryParseJson(t){try{return JSON.parse(t)}catch(n){return t}},n.Lerp=function Lerp(t,n,i){return(1-i)*t+i*n},n.lerpHexColor=function lerpHexColor(t,n,i){var o=+t.replace("#","0x"),a=o>>16,s=o>>8&255,m=255&o,g=+n.replace("#","0x");return"#"+((1<<24)+(a+i*((g>>16)-a)<<16)+(s+i*((g>>8&255)-s)<<8)+(m+i*((255&g)-m))|0).toString(16).slice(1)},n.extractInitials=function extractInitials(t){return t.trim().split(" ").map((function(t){return t[0].toUpperCase()}))},n.MediaTypes={VIDEO:"video",IMAGE:"image",UNKNOWN:"unknown"},n.GetTypeFromFileName=GetTypeFromFileName,n.GetMediaSizeFromFile=function GetMediaSizeFromFile(t){return o(this,void 0,void 0,(function(){return a(this,(function(i){switch(i.label){case 0:switch(GetTypeFromFileName(t.name)){case n.MediaTypes.IMAGE:return[3,1];case n.MediaTypes.VIDEO:return[3,3];case n.MediaTypes.UNKNOWN:return[3,5]}return[3,6];case 1:return[4,GetImageSizeFromFile(t)];case 2:return[2,i.sent()];case 3:return[4,GetVideoSizeFromFile(t)];case 4:return[2,i.sent()];case 5:case 6:return[2,void 0]}}))}))},n.GetImageSizeFromFile=GetImageSizeFromFile,n.GetVideoSizeFromFile=GetVideoSizeFromFile;var L=function(){function MultiMap(){this.map=new Map}return MultiMap.prototype.set=function(t,n){var i=JSON.stringify(t),o=this.map.get(i)||[];return this.map.set(i,m(m([],s(o)),[n])),this},MultiMap.prototype.get=function(t){return this.map.get(JSON.stringify(t))},MultiMap.prototype.clear=function(){this.map.clear()},MultiMap.prototype.delete=function(t){return this.map.delete(JSON.stringify(t))},MultiMap.prototype.has=function(t){return this.map.has(JSON.stringify(t))},Object.defineProperty(MultiMap.prototype,"size",{get:function(){return this.map.size},enumerable:!1,configurable:!0}),MultiMap.prototype.forEach=function(t,n){var i=this;this.map.forEach((function(o,a){t.call(n,o,JSON.parse(a),i)}))},MultiMap}();function traverse(t,n,i){for(var o in void 0===i&&(i=""),t){var a=i+(i?".":"")+o;!1!==n.apply(this,[t,o,t[o],a,i])&&null!==t[o]&&"object"==typeof t[o]&&traverse(t[o],n,a)}}n.MultiMap=L,n.getNormalizedWheelDelta=function getNormalizedWheelDelta(t,n){void 0===n&&(n=1);var i=t.wheelDelta,o=t.detail,a=t.deltaY,s=t.deltaY<0?1:-1;return o?(s=o<0||i>0?1:-1,a=i?i/o/(40*n)*o>0?1:-1:-o/(3*n)):a=i/(120*n),s*Math.abs(a)},n.hashCode=function hashCode(t){return t.split("").reduce((function(t,n){return(t<<5)-t+n.charCodeAt(0)|0}),0)},n.omitDeep=function omitDeep(t,n){function omitDeepOnOwnProps(i){var o,a;if(void 0===t)return t;if(!Array.isArray(i)&&!O.default(i))return i;if(Array.isArray(i))return omitDeep(i,n);var m={};try{for(var _=g(Object.entries(i)),S=_.next();!S.done;S=_.next()){var M=s(S.value,2),T=M[0],L=M[1];m[T]=A.default(L)?L:omitDeep(L,n)}}catch(t){o={error:t}}finally{try{S&&!S.done&&(a=_.return)&&a.call(_)}finally{if(o)throw o.error}}return P.default(m,n)}return arguments.length>2&&(n=Array.prototype.slice.call(arguments).slice(1)),Array.isArray(t)?t.map(omitDeepOnOwnProps):omitDeepOnOwnProps(t)},n.GetRequest=function GetRequest(t){return new Promise((function(n,i){var o=new XMLHttpRequest;o.onload=function(t){return n(t.target.response)},o.onerror=function(t){return i(t)},o.onabort=function(t){return i(t)},o.open("GET",t),o.send()}))},n.traverse=traverse,n.mergeConfigs=function mergeConfigs(t,n){var i=n,o=S.default(t);return traverse(i,(function(t,n,i,a,s){var m,g,_;if("string"==typeof i||"number"==typeof i)Array.isArray(t)?((A=T.default(o,s))||(A=[],M.default(o,s,A)),A.find((function(t){return t===i}))||A.push(i)):M.default(o,a,i);else if(Array.isArray(t)){var S=null!==(m=(null==i?void 0:i.name)&&"name")&&void 0!==m?m:(null==i?void 0:i.application)&&"application",O=null!==(g=null==i?void 0:i.name)&&void 0!==g?g:null==i?void 0:i.application;if(O){var A;(A=T.default(o,s))||(A=[],M.default(o,s,A));var P=null===(_=T.default(o,s))||void 0===_?void 0:_.find((function(t){return t[S]===O}));return P?Object.assign(P,i):A.push(i),!1}}})),o};n.mobileAndTabletCheck=function(){var t,n=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(n=!0),n}},function(t,n,i){var o=i(43);t.exports=function toKey(t){if("string"==typeof t||o(t))return t;var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},function(t,n,i){"use strict";i.d(n,"a",(function(){return print}));var o=i(75),a=i(48);function print(t){return Object(o.b)(t,{leave:s})}var s={Name:function Name(t){return t.value},Variable:function Variable(t){return"$"+t.name},Document:function Document(t){return join(t.definitions,"\n\n")+"\n"},OperationDefinition:function OperationDefinition(t){var n=t.operation,i=t.name,o=wrap("(",join(t.variableDefinitions,", "),")"),a=join(t.directives," "),s=t.selectionSet;return i||a||o||"query"!==n?join([n,join([i,o]),a,s]," "):s},VariableDefinition:function VariableDefinition(t){var n=t.variable,i=t.type,o=t.defaultValue,a=t.directives;return n+": "+i+wrap(" = ",o)+wrap(" ",join(a," "))},SelectionSet:function SelectionSet(t){return block(t.selections)},Field:function Field(t){var n=t.alias,i=t.name,o=t.arguments,a=t.directives,s=t.selectionSet,m=wrap("",n,": ")+i,g=m+wrap("(",join(o,", "),")");return g.length>80&&(g=m+wrap("(\n",indent(join(o,"\n")),"\n)")),join([g,join(a," "),s]," ")},Argument:function Argument(t){return t.name+": "+t.value},FragmentSpread:function FragmentSpread(t){return"..."+t.name+wrap(" ",join(t.directives," "))},InlineFragment:function InlineFragment(t){var n=t.typeCondition,i=t.directives,o=t.selectionSet;return join(["...",wrap("on ",n),join(i," "),o]," ")},FragmentDefinition:function FragmentDefinition(t){var n=t.name,i=t.typeCondition,o=t.variableDefinitions,a=t.directives,s=t.selectionSet;return"fragment ".concat(n).concat(wrap("(",join(o,", "),")")," ")+"on ".concat(i," ").concat(wrap("",join(a," ")," "))+s},IntValue:function IntValue(t){return t.value},FloatValue:function FloatValue(t){return t.value},StringValue:function StringValue(t,n){var i=t.value;return t.block?Object(a.b)(i,"description"===n?"":"  "):JSON.stringify(i)},BooleanValue:function BooleanValue(t){return t.value?"true":"false"},NullValue:function NullValue(){return"null"},EnumValue:function EnumValue(t){return t.value},ListValue:function ListValue(t){return"["+join(t.values,", ")+"]"},ObjectValue:function ObjectValue(t){return"{"+join(t.fields,", ")+"}"},ObjectField:function ObjectField(t){return t.name+": "+t.value},Directive:function Directive(t){return"@"+t.name+wrap("(",join(t.arguments,", "),")")},NamedType:function NamedType(t){return t.name},ListType:function ListType(t){return"["+t.type+"]"},NonNullType:function NonNullType(t){return t.type+"!"},SchemaDefinition:addDescription((function(t){var n=t.directives,i=t.operationTypes;return join(["schema",join(n," "),block(i)]," ")})),OperationTypeDefinition:function OperationTypeDefinition(t){return t.operation+": "+t.type},ScalarTypeDefinition:addDescription((function(t){return join(["scalar",t.name,join(t.directives," ")]," ")})),ObjectTypeDefinition:addDescription((function(t){var n=t.name,i=t.interfaces,o=t.directives,a=t.fields;return join(["type",n,wrap("implements ",join(i," & ")),join(o," "),block(a)]," ")})),FieldDefinition:addDescription((function(t){var n=t.name,i=t.arguments,o=t.type,a=t.directives;return n+(hasMultilineItems(i)?wrap("(\n",indent(join(i,"\n")),"\n)"):wrap("(",join(i,", "),")"))+": "+o+wrap(" ",join(a," "))})),InputValueDefinition:addDescription((function(t){var n=t.name,i=t.type,o=t.defaultValue,a=t.directives;return join([n+": "+i,wrap("= ",o),join(a," ")]," ")})),InterfaceTypeDefinition:addDescription((function(t){var n=t.name,i=t.interfaces,o=t.directives,a=t.fields;return join(["interface",n,wrap("implements ",join(i," & ")),join(o," "),block(a)]," ")})),UnionTypeDefinition:addDescription((function(t){var n=t.name,i=t.directives,o=t.types;return join(["union",n,join(i," "),o&&0!==o.length?"= "+join(o," | "):""]," ")})),EnumTypeDefinition:addDescription((function(t){var n=t.name,i=t.directives,o=t.values;return join(["enum",n,join(i," "),block(o)]," ")})),EnumValueDefinition:addDescription((function(t){return join([t.name,join(t.directives," ")]," ")})),InputObjectTypeDefinition:addDescription((function(t){var n=t.name,i=t.directives,o=t.fields;return join(["input",n,join(i," "),block(o)]," ")})),DirectiveDefinition:addDescription((function(t){var n=t.name,i=t.arguments,o=t.repeatable,a=t.locations;return"directive @"+n+(hasMultilineItems(i)?wrap("(\n",indent(join(i,"\n")),"\n)"):wrap("(",join(i,", "),")"))+(o?" repeatable":"")+" on "+join(a," | ")})),SchemaExtension:function SchemaExtension(t){var n=t.directives,i=t.operationTypes;return join(["extend schema",join(n," "),block(i)]," ")},ScalarTypeExtension:function ScalarTypeExtension(t){return join(["extend scalar",t.name,join(t.directives," ")]," ")},ObjectTypeExtension:function ObjectTypeExtension(t){var n=t.name,i=t.interfaces,o=t.directives,a=t.fields;return join(["extend type",n,wrap("implements ",join(i," & ")),join(o," "),block(a)]," ")},InterfaceTypeExtension:function InterfaceTypeExtension(t){var n=t.name,i=t.interfaces,o=t.directives,a=t.fields;return join(["extend interface",n,wrap("implements ",join(i," & ")),join(o," "),block(a)]," ")},UnionTypeExtension:function UnionTypeExtension(t){var n=t.name,i=t.directives,o=t.types;return join(["extend union",n,join(i," "),o&&0!==o.length?"= "+join(o," | "):""]," ")},EnumTypeExtension:function EnumTypeExtension(t){var n=t.name,i=t.directives,o=t.values;return join(["extend enum",n,join(i," "),block(o)]," ")},InputObjectTypeExtension:function InputObjectTypeExtension(t){var n=t.name,i=t.directives,o=t.fields;return join(["extend input",n,join(i," "),block(o)]," ")}};function addDescription(t){return function(n){return join([n.description,t(n)],"\n")}}function join(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null!==(n=null==t?void 0:t.filter((function(t){return t})).join(i))&&void 0!==n?n:""}function block(t){return wrap("{\n",indent(join(t,"\n")),"\n}")}function wrap(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return null!=n&&""!==n?t+n+i:""}function indent(t){return wrap("  ",t.replace(/\n/g,"\n  "))}function isMultiline(t){return-1!==t.indexOf("\n")}function hasMultilineItems(t){return null!=t&&t.some(isMultiline)}},function(t,n,i){"use strict";i.d(n,"a",(function(){return m})),i.d(n,"b",(function(){return visit}));var o=i(3),a=i(6),s={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},m=Object.freeze({});function visit(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s,g=void 0,_=Array.isArray(t),S=[t],M=-1,T=[],O=void 0,A=void 0,P=void 0,L=[],R=[],N=t;do{var I=++M===S.length,j=I&&0!==T.length;if(I){if(A=0===R.length?void 0:L[L.length-1],O=P,P=R.pop(),j){if(_)O=O.slice();else{for(var V={},U=0,G=Object.keys(O);U<G.length;U++){var z=G[U];V[z]=O[z]}O=V}for(var H=0,q=0;q<T.length;q++){var Z=T[q][0],X=T[q][1];_&&(Z-=H),_&&null===X?(O.splice(Z,1),H++):O[Z]=X}}M=g.index,S=g.keys,T=g.edits,_=g.inArray,g=g.prev}else{if(A=P?_?M:S[M]:void 0,null==(O=P?P[A]:N))continue;P&&L.push(A)}var Q,Y=void 0;if(!Array.isArray(O)){if(!Object(a.c)(O))throw new Error("Invalid AST Node: ".concat(Object(o.a)(O),"."));var J=getVisitFn(n,O.kind,I);if(J){if((Y=J.call(n,O,A,P,L,R))===m)break;if(!1===Y){if(!I){L.pop();continue}}else if(void 0!==Y&&(T.push([A,Y]),!I)){if(!Object(a.c)(Y)){L.pop();continue}O=Y}}}if(void 0===Y&&j&&T.push([A,O]),I)L.pop();else g={inArray:_,index:M,keys:S,edits:T,prev:g},S=(_=Array.isArray(O))?O:null!==(Q=i[O.kind])&&void 0!==Q?Q:[],M=-1,T=[],P&&R.push(P),P=O}while(void 0!==g);return 0!==T.length&&(N=T[T.length-1][1]),N}function getVisitFn(t,n,i){var o=t[n];if(o){if(!i&&"function"==typeof o)return o;var a=i?o.leave:o.enter;if("function"==typeof a)return a}else{var s=i?t.leave:t.enter;if(s){if("function"==typeof s)return s;var m=s[n];if("function"==typeof m)return m}}}},function(t,n,i){"use strict";(function(t){var o=i(16);n.a=Object(o.a)((function(){return globalThis}))||Object(o.a)((function(){return window}))||Object(o.a)((function(){return self}))||Object(o.a)((function(){return t}))||Object(o.a)((function(){return Function("return this")()}))}).call(this,i(53))},,function(t,n,i){var o=i(126),a=i(155),s=i(55),m=i(156),g=i(164),_=i(167),S=i(168),M=i(169),T=i(171),O=i(172),A=i(94),P=i(66),L=i(176),R=i(177),N=i(183),I=i(24),j=i(87),V=i(185),U=i(18),G=i(187),z=i(56),H=i(62),q={};q["[object Arguments]"]=q["[object Array]"]=q["[object ArrayBuffer]"]=q["[object DataView]"]=q["[object Boolean]"]=q["[object Date]"]=q["[object Float32Array]"]=q["[object Float64Array]"]=q["[object Int8Array]"]=q["[object Int16Array]"]=q["[object Int32Array]"]=q["[object Map]"]=q["[object Number]"]=q["[object Object]"]=q["[object RegExp]"]=q["[object Set]"]=q["[object String]"]=q["[object Symbol]"]=q["[object Uint8Array]"]=q["[object Uint8ClampedArray]"]=q["[object Uint16Array]"]=q["[object Uint32Array]"]=!0,q["[object Error]"]=q["[object Function]"]=q["[object WeakMap]"]=!1,t.exports=function baseClone(t,n,i,Z,X,Q){var Y,J=1&n,K=2&n,$=4&n;if(i&&(Y=X?i(t,Z,X,Q):i(t)),void 0!==Y)return Y;if(!U(t))return t;var ee=I(t);if(ee){if(Y=L(t),!J)return S(t,Y)}else{var te=P(t),ne="[object Function]"==te||"[object GeneratorFunction]"==te;if(j(t))return _(t,J);if("[object Object]"==te||"[object Arguments]"==te||ne&&!X){if(Y=K||ne?{}:N(t),!J)return K?T(t,g(Y,t)):M(t,m(Y,t))}else{if(!q[te])return X?t:{};Y=R(t,te,J)}}Q||(Q=new o);var re=Q.get(t);if(re)return re;Q.set(t,Y),G(t)?t.forEach((function(o){Y.add(baseClone(o,n,i,o,t,Q))})):V(t)&&t.forEach((function(o,a){Y.set(a,baseClone(o,n,i,a,t,Q))}));var ie=ee?void 0:($?K?A:O:K?H:z)(t);return a(ie||t,(function(o,a){ie&&(o=t[a=o]),s(Y,a,baseClone(o,n,i,a,t,Q))})),Y}},function(t,n){t.exports=function eq(t,n){return t===n||t!=t&&n!=n}},function(t,n,i){var o=i(26),a=i(18);t.exports=function isFunction(t){if(!a(t))return!1;var n=o(t);return"[object Function]"==n||"[object GeneratorFunction]"==n||"[object AsyncFunction]"==n||"[object Proxy]"==n}},function(t,n,i){(function(n){var i="object"==typeof n&&n&&n.Object===Object&&n;t.exports=i}).call(this,i(53))},function(t,n){var i=Function.prototype.toString;t.exports=function toSource(t){if(null!=t){try{return i.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,n,i){var o=i(84);t.exports=function baseAssignValue(t,n,i){"__proto__"==n&&o?o(t,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[n]=i}},function(t,n,i){var o=i(23),a=function(){try{var t=o(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=a},function(t,n,i){var o=i(157),a=i(86),s=i(24),m=i(87),g=i(88),_=i(160),S=Object.prototype.hasOwnProperty;t.exports=function arrayLikeKeys(t,n){var i=s(t),M=!i&&a(t),T=!i&&!M&&m(t),O=!i&&!M&&!T&&_(t),A=i||M||T||O,P=A?o(t.length,String):[],L=P.length;for(var R in t)!n&&!S.call(t,R)||A&&("length"==R||T&&("offset"==R||"parent"==R)||O&&("buffer"==R||"byteLength"==R||"byteOffset"==R)||g(R,L))||P.push(R);return P}},function(t,n,i){var o=i(158),a=i(19),s=Object.prototype,m=s.hasOwnProperty,g=s.propertyIsEnumerable,_=o(function(){return arguments}())?o:function(t){return a(t)&&m.call(t,"callee")&&!g.call(t,"callee")};t.exports=_},function(t,n,i){(function(t){var o=i(14),a=i(159),s=n&&!n.nodeType&&n,m=s&&"object"==typeof t&&t&&!t.nodeType&&t,g=m&&m.exports===s?o.Buffer:void 0,_=(g?g.isBuffer:void 0)||a;t.exports=_}).call(this,i(57)(t))},function(t,n){var i=/^(?:0|[1-9]\d*)$/;t.exports=function isIndex(t,n){var o=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==o||"symbol"!=o&&i.test(t))&&t>-1&&t%1==0&&t<n}},function(t,n){t.exports=function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},function(t,n){t.exports=function overArg(t,n){return function(i){return t(n(i))}}},function(t,n){t.exports=function stubArray(){return[]}},function(t,n,i){var o=i(64),a=i(65),s=i(63),m=i(91),g=Object.getOwnPropertySymbols?function(t){for(var n=[];t;)o(n,s(t)),t=a(t);return n}:m;t.exports=g},function(t,n,i){var o=i(64),a=i(24);t.exports=function baseGetAllKeys(t,n,i){var s=n(t);return a(t)?s:o(s,i(t))}},function(t,n,i){var o=i(93),a=i(92),s=i(62);t.exports=function getAllKeysIn(t){return o(t,s,a)}},function(t,n,i){var o=i(23)(i(14),"Set");t.exports=o},function(t,n,i){"use strict";var o=this&&this.__makeTemplateObject||function(t,n){return Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,t},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.productWithAllMediaFragment=n.productFragment=n.baseProductFragment=n.colorFragment=n.mediaFragment=void 0;var s,m,g,_,S,M=a(i(15));n.mediaFragment=M.default(s||(s=o(["\n    fragment mediaFragment on media {\n        _id\n        type\n        width\n        height\n        value {\n            _id\n            type\n            value\n        }\n    }\n"],["\n    fragment mediaFragment on media {\n        _id\n        type\n        width\n        height\n        value {\n            _id\n            type\n            value\n        }\n    }\n"]))),n.colorFragment=M.default(m||(m=o(["\n    fragment colorFragment on CatalogColors {\n        type\n        value\n        name\n    }\n"],["\n    fragment colorFragment on CatalogColors {\n        type\n        value\n        name\n    }\n"]))),n.baseProductFragment=M.default(g||(g=o(["\n    fragment baseProductFragment on product {\n        _id\n        title\n        description\n        sizes {\n            type\n            value\n        }\n        colors {\n            ...colorFragment\n        }\n        variety {\n            _id\n        }\n        textures {\n            ...mediaFragment\n        }\n        sku\n        category\n        designer\n        company\n        createdAt\n        updatedAt\n        style {\n            _id\n            name\n        }\n        garment\n        byond_id\n        availabilityDate\n        expirationDate\n        wholesalePrice {\n            type\n            value\n        }\n        consumerPrice {\n            type\n            value\n        }\n        status {\n            archived\n        }\n        productCollection {\n            _id\n            name\n        }\n        tags\n        customFields {\n            name\n            value\n            type\n        }\n    }\n    ","\n    ","\n"],["\n    fragment baseProductFragment on product {\n        _id\n        title\n        description\n        sizes {\n            type\n            value\n        }\n        colors {\n            ...colorFragment\n        }\n        variety {\n            _id\n        }\n        textures {\n            ...mediaFragment\n        }\n        sku\n        category\n        designer\n        company\n        createdAt\n        updatedAt\n        style {\n            _id\n            name\n        }\n        garment\n        byond_id\n        availabilityDate\n        expirationDate\n        wholesalePrice {\n            type\n            value\n        }\n        consumerPrice {\n            type\n            value\n        }\n        status {\n            archived\n        }\n        productCollection {\n            _id\n            name\n        }\n        tags\n        customFields {\n            name\n            value\n            type\n        }\n    }\n    ","\n    ","\n"])),n.mediaFragment,n.colorFragment),n.productFragment=M.default(_||(_=o(['\n    fragment productFragment on product {\n        ...baseProductFragment\n        medias(filter: { type: "frontal_image" }) {\n            _id\n            type\n            value {\n                ...mediaFragment\n            }\n        }\n        customMediaFields {\n            type\n            name\n            value {\n                _id\n                ...mediaFragment\n            }\n        }\n    }\n    ',"\n    ","\n"],['\n    fragment productFragment on product {\n        ...baseProductFragment\n        medias(filter: { type: "frontal_image" }) {\n            _id\n            type\n            value {\n                ...mediaFragment\n            }\n        }\n        customMediaFields {\n            type\n            name\n            value {\n                _id\n                ...mediaFragment\n            }\n        }\n    }\n    ',"\n    ","\n"])),n.baseProductFragment,n.mediaFragment),n.productWithAllMediaFragment=M.default(S||(S=o(["\n    fragment productWithAllMediaFragment on product {\n        ...baseProductFragment\n        medias {\n            _id\n            type\n            value {\n                ...mediaFragment\n            }\n        }\n        customMediaFields {\n            type\n            name\n            value {\n                _id\n                ...mediaFragment\n            }\n        }\n    }\n    ","\n    ","\n"],["\n    fragment productWithAllMediaFragment on product {\n        ...baseProductFragment\n        medias {\n            _id\n            type\n            value {\n                ...mediaFragment\n            }\n        }\n        customMediaFields {\n            type\n            name\n            value {\n                _id\n                ...mediaFragment\n            }\n        }\n    }\n    ","\n    ","\n"])),n.baseProductFragment,n.mediaFragment)},function(t,n,i){var o=i(64),a=i(201);t.exports=function baseFlatten(t,n,i,s,m){var g=-1,_=t.length;for(i||(i=a),m||(m=[]);++g<_;){var S=t[g];n>0&&i(S)?n>1?baseFlatten(S,n-1,i,s,m):o(m,S):s||(m[m.length]=S)}return m}},function(t,n){t.exports=function identity(t){return t}},function(t,n,i){var o=i(203),a=Math.max;t.exports=function overRest(t,n,i){return n=a(void 0===n?t.length-1:n,0),function(){for(var s=arguments,m=-1,g=a(s.length-n,0),_=Array(g);++m<g;)_[m]=s[n+m];m=-1;for(var S=Array(n+1);++m<n;)S[m]=s[m];return S[n]=i(_),o(t,this,S)}}},function(t,n,i){var o=i(204),a=i(206)(o);t.exports=a},function(t,n){t.exports=function setToArray(t){var n=-1,i=Array(t.size);return t.forEach((function(t){i[++n]=t})),i}},function(t,n,i){"use strict";function compact(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=Object.create(null);return t.forEach((function(t){t&&Object.keys(t).forEach((function(n){var o=t[n];void 0!==o&&(i[n]=o)}))})),i}i.d(n,"a",(function(){return compact}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return o})),i.d(n,"b",(function(){return a}));var o="function"==typeof WeakMap&&!("object"==typeof navigator&&"ReactNative"===navigator.product),a="function"==typeof WeakSet},function(t,n,i){"use strict";i.d(n,"a",(function(){return asyncMap}));var o=i(30);function asyncMap(t,n,i){return new o.a((function(o){var a=o.next,s=o.error,m=o.complete,g=0,_=!1,S={then:function(t){return new Promise((function(n){return n(t())}))}};function makeCallback(t,n){return t?function(n){++g;var both=function(){return t(n)};S=S.then(both,both).then((function(t){--g,a&&a.call(o,t),_&&M.complete()}),(function(t){throw--g,t})).catch((function(t){s&&s.call(o,t)}))}:function(t){return n&&n.call(o,t)}}var M={next:makeCallback(n,a),error:makeCallback(i,s),complete:function(){_=!0,g||m&&m.call(o)}},T=t.subscribe(M);return function(){return T.unsubscribe()}}))}},function(t,n,i){"use strict";function graphQLResultHasError(t){return t.errors&&t.errors.length>0||!1}i.d(n,"a",(function(){return graphQLResultHasError}))},function(t,n,i){"use strict";function isNonEmptyArray(t){return Array.isArray(t)&&t.length>0}i.d(n,"a",(function(){return isNonEmptyArray}))},function(t,n,i){"use strict";i.d(n,"a",(function(){return cloneDeep}));var o=Object.prototype.toString;function cloneDeep(t){return function cloneDeepHelper(t,n){switch(o.call(t)){case"[object Array]":if((n=n||new Map).has(t))return n.get(t);var i=t.slice(0);return n.set(t,i),i.forEach((function(t,o){i[o]=cloneDeepHelper(t,n)})),i;case"[object Object]":if((n=n||new Map).has(t))return n.get(t);var a=Object.create(Object.getPrototypeOf(t));return n.set(t,a),Object.keys(t).forEach((function(i){a[i]=cloneDeepHelper(t[i],n)})),a;default:return t}}(t)}},function(t,n,i){"use strict";i.d(n,"a",(function(){return g}));var o=i(0),a=i(30),s=i(28),m=i(44);function isPromiseLike(t){return t&&"function"==typeof t.then}var g=function(t){function Concast(n){var i=t.call(this,(function(t){return i.addObserver(t),function(){return i.removeObserver(t)}}))||this;return i.observers=new Set,i.addCount=0,i.promise=new Promise((function(t,n){i.resolve=t,i.reject=n})),i.handlers={next:function(t){null!==i.sub&&(i.latest=["next",t],Object(s.a)(i.observers,"next",t))},error:function(t){var n=i.sub;null!==n&&(n&&Promise.resolve().then((function(){return n.unsubscribe()})),i.sub=null,i.latest=["error",t],i.reject(t),Object(s.a)(i.observers,"error",t))},complete:function(){if(null!==i.sub){var t=i.sources.shift();t?isPromiseLike(t)?t.then((function(t){return i.sub=t.subscribe(i.handlers)})):i.sub=t.subscribe(i.handlers):(i.sub=null,i.latest&&"next"===i.latest[0]?i.resolve(i.latest[1]):i.resolve(),Object(s.a)(i.observers,"complete"))}}},i.cancel=function(t){i.reject(t),i.sources=[],i.handlers.complete()},i.promise.catch((function(t){})),"function"==typeof n&&(n=[new a.a(n)]),isPromiseLike(n)?n.then((function(t){return i.start(t)}),i.handlers.error):i.start(n),i}return Object(o.c)(Concast,t),Concast.prototype.start=function(t){void 0===this.sub&&(this.sources=Array.from(t),this.handlers.complete())},Concast.prototype.deliverLastMessage=function(t){if(this.latest){var n=this.latest[0],i=t[n];i&&i.call(t,this.latest[1]),null===this.sub&&"next"===n&&t.complete&&t.complete()}},Concast.prototype.addObserver=function(t){this.observers.has(t)||(this.deliverLastMessage(t),this.observers.add(t),++this.addCount)},Concast.prototype.removeObserver=function(t,n){this.observers.delete(t)&&--this.addCount<1&&!n&&this.handlers.error(new Error("Observable cancelled prematurely"))},Concast.prototype.cleanup=function(t){var n=this,i=!1,once=function(){i||(i=!0,n.observers.delete(o),t())},o={next:once,error:once,complete:once},a=this.addCount;this.addObserver(o),this.addCount=a},Concast}(a.a);Object(m.a)(g)},function(t,n,i){"use strict";i.d(n,"a",(function(){return o}));var o=i(9).a.execute},function(t,n,i){"use strict";i.d(n,"a",(function(){return stringifyForDisplay}));var o=i(45);function stringifyForDisplay(t){var n=Object(o.a)("stringifyForDisplay");return JSON.stringify(t,(function(t,i){return void 0===i?n:i})).split(JSON.stringify(n)).join("<undefined>")}},function(t,n,i){"use strict";i.d(n,"a",(function(){return maybeDeepFreeze}));i(29);var o=i(10);function maybeDeepFreeze(t){return __DEV__&&function deepFreeze(t){var n=new Set([t]);return n.forEach((function(t){Object(o.a)(t)&&(Object.isFrozen(t)||Object.freeze(t),Object.getOwnPropertyNames(t).forEach((function(i){Object(o.a)(t[i])&&n.add(t[i])})))})),t}(t),t}},function(t,n){t.exports=function arrayMap(t,n){for(var i=-1,o=null==t?0:t.length,a=Array(o);++i<o;)a[i]=n(t[i],i,t);return a}},function(t,n,i){var o=i(114);t.exports=function get(t,n,i){var a=null==t?void 0:o(t,n);return void 0===a?i:a}},function(t,n,i){var o=i(42),a=i(73);t.exports=function baseGet(t,n){for(var i=0,s=(n=o(n,t)).length;null!=t&&i<s;)t=t[a(n[i++])];return i&&i==s?t:void 0}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.VisualizerUtils=void 0;var s=i(68);!function(t){t.createCubeMapElement=function createCubeMapElement(t,n){return o(this,void 0,void 0,(function(){var i,o,s,m,g,_;return a(this,(function(a){switch(a.label){case 0:return i=t.currentExperience.backgroundManager.currentBackground,o=i.parent,s=i.getMetadata(),[4,t.elementsRegistry.GetElement(s,o)];case 1:return m=a.sent(),[4,(g=m[0]).init()];case 2:for(a.sent(),g.setVisible(!0),g.obj.renderOrder=n,g.obj.scale.set(i.obj.scale.x,i.obj.scale.y,i.obj.scale.z),_=0;_<g.obj.materials.length;_++)g.obj.materials[_].visible=!1;return[2,g]}}))}))},t.TextureAsPromise=function TextureAsPromise(t){var n=this;return function(){return new s.Utils.Image.Image(n.appManager,t).Load()}}}(n.VisualizerUtils||(n.VisualizerUtils={}))},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0}),n.VisualizerElement=n.IVisualizer=n.analyticsEvents=void 0,n.analyticsEvents={visualizerLoaded:{category:"visualizer",eventParamsPaths:["visualizer.experienceId"]},sceneTouched:{category:"visualizer",eventParamsPaths:["scene.sceneId","scene.title","scene.subtitle"]},summaryClicked:{category:"visualizer",eventParamsPaths:["scene.scene.sceneId","scene.scene.title","scene.subtitle"]},fullscreenClicked:{category:"visualizer",eventParamsPaths:[]},closeFullscreenClicked:{category:"visualizer",eventParamsPaths:[]},sceneLoaded:{category:"scenes",eventParamsPaths:["scene.sceneId","scene.title","scene.subtitle"]},sceneLoading:{category:"scenes",eventParamsPaths:["scene.sceneId","scene.title","scene.subtitle"]},scenesPanelOpened:{category:"scenes",eventParamsPaths:[]},scenesPanelClosed:{category:"scenes",eventParamsPaths:[]},applicationSelected:{category:"appplications",eventParamsPaths:["application.application"]},applicationsStripButtonClicked:{category:"appplications",eventParamsPaths:[]},applicationsNavigateButtonClicked:{category:"appplications",eventParamsPaths:[]},applicationPointClicked:{category:"appplications",eventParamsPaths:[]},applicationsStripOpened:{category:"appplications",eventParamsPaths:[]},productChanged:{category:"products",eventParamsPaths:["product.sku","product.title"]},userChangedProduct:{category:"products",eventParamsPaths:["product.sku","product.title"]},orderSample:{category:"conversion",eventParamsPaths:["product.sku","product.title"]},productAddedToCart:{category:"conversion",eventParamsPaths:["product.sku","product.title"]},productAddedToFavorites:{category:"favorites",eventParamsPaths:[]},productRemovedFromFavorites:{category:"favorites",eventParamsPaths:["product.sku","product.title"]},sceneAddedToFavorites:{category:"favorites",eventParamsPaths:["scene.scene.sceneId","scene.scene.title","scene.subtitle"]},sceneRemovedFromFavorites:{category:"favorites",eventParamsPaths:["scene.scene.sceneId","scene.scene.title","scene.subtitle"]},favoritesSceneDisplayed:{category:"favorites",eventParamsPaths:["scene.scene.sceneId","scene.scene.title","scene.subtitle"]},favoritesPanelOpened:{category:"favorites",eventParamsPaths:[]},favoritesPanelClosed:{category:"favorites",eventParamsPaths:[]},favoriteSceneClicked:{category:"favorites",eventParamsPaths:[]}};var s=function s(){};n.IVisualizer=s;var m=function(t){function VisualizerElement(){return null!==t&&t.apply(this,arguments)||this}return a(VisualizerElement,t),VisualizerElement}(Element);n.VisualizerElement=m},function(t,n,i){"use strict";var o=this&&this.__read||function(t,n){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,a,s=i.call(t),m=[];try{for(;(void 0===n||n-- >0)&&!(o=s.next()).done;)m.push(o.value)}catch(t){a={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return m},a=this&&this.__spreadArray||function(t,n){for(var i=0,o=n.length,a=t.length;i<o;i++,a++)t[a]=n[i];return t};Object.defineProperty(n,"__esModule",{value:!0}),n.debug=void 0,n.debug={visible:!1,log:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.debug.visible&&console.log.apply(console,a([],o(t)))}},window.debugv=n.debug},function(t,n,i){"use strict";var o;i.r(n),i.d(n,"v1",(function(){return P})),i.d(n,"v3",(function(){return R})),i.d(n,"v4",(function(){return N})),i.d(n,"v5",(function(){return I})),i.d(n,"NIL",(function(){return j})),i.d(n,"version",(function(){return V})),i.d(n,"validate",(function(){return m})),i.d(n,"stringify",(function(){return T})),i.d(n,"parse",(function(){return L}));var a=new Uint8Array(16);function rng(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(a)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var m=function validate(t){return"string"==typeof t&&s.test(t)},g=[],_=0;_<256;++_)g.push((_+256).toString(16).substr(1));var S,M,T=function stringify(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(g[t[n+0]]+g[t[n+1]]+g[t[n+2]]+g[t[n+3]]+"-"+g[t[n+4]]+g[t[n+5]]+"-"+g[t[n+6]]+g[t[n+7]]+"-"+g[t[n+8]]+g[t[n+9]]+"-"+g[t[n+10]]+g[t[n+11]]+g[t[n+12]]+g[t[n+13]]+g[t[n+14]]+g[t[n+15]]).toLowerCase();if(!m(i))throw TypeError("Stringified UUID is invalid");return i},O=0,A=0;var P=function v1(t,n,i){var o=n&&i||0,a=n||new Array(16),s=(t=t||{}).node||S,m=void 0!==t.clockseq?t.clockseq:M;if(null==s||null==m){var g=t.random||(t.rng||rng)();null==s&&(s=S=[1|g[0],g[1],g[2],g[3],g[4],g[5]]),null==m&&(m=M=16383&(g[6]<<8|g[7]))}var _=void 0!==t.msecs?t.msecs:Date.now(),P=void 0!==t.nsecs?t.nsecs:A+1,L=_-O+(P-A)/1e4;if(L<0&&void 0===t.clockseq&&(m=m+1&16383),(L<0||_>O)&&void 0===t.nsecs&&(P=0),P>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");O=_,A=P,M=m;var R=(1e4*(268435455&(_+=122192928e5))+P)%4294967296;a[o++]=R>>>24&255,a[o++]=R>>>16&255,a[o++]=R>>>8&255,a[o++]=255&R;var N=_/4294967296*1e4&268435455;a[o++]=N>>>8&255,a[o++]=255&N,a[o++]=N>>>24&15|16,a[o++]=N>>>16&255,a[o++]=m>>>8|128,a[o++]=255&m;for(var I=0;I<6;++I)a[o+I]=s[I];return n||T(a)};var L=function parse(t){if(!m(t))throw TypeError("Invalid UUID");var n,i=new Uint8Array(16);return i[0]=(n=parseInt(t.slice(0,8),16))>>>24,i[1]=n>>>16&255,i[2]=n>>>8&255,i[3]=255&n,i[4]=(n=parseInt(t.slice(9,13),16))>>>8,i[5]=255&n,i[6]=(n=parseInt(t.slice(14,18),16))>>>8,i[7]=255&n,i[8]=(n=parseInt(t.slice(19,23),16))>>>8,i[9]=255&n,i[10]=(n=parseInt(t.slice(24,36),16))/1099511627776&255,i[11]=n/4294967296&255,i[12]=n>>>24&255,i[13]=n>>>16&255,i[14]=n>>>8&255,i[15]=255&n,i};var v35=function(t,n,i){function generateUUID(t,o,a,s){if("string"==typeof t&&(t=function stringToBytes(t){t=unescape(encodeURIComponent(t));for(var n=[],i=0;i<t.length;++i)n.push(t.charCodeAt(i));return n}(t)),"string"==typeof o&&(o=L(o)),16!==o.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var m=new Uint8Array(16+t.length);if(m.set(o),m.set(t,o.length),(m=i(m))[6]=15&m[6]|n,m[8]=63&m[8]|128,a){s=s||0;for(var g=0;g<16;++g)a[s+g]=m[g];return a}return T(m)}try{generateUUID.name=t}catch(t){}return generateUUID.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",generateUUID.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",generateUUID};function getOutputLength(t){return 14+(t+64>>>9<<4)+1}function safeAdd(t,n){var i=(65535&t)+(65535&n);return(t>>16)+(n>>16)+(i>>16)<<16|65535&i}function md5cmn(t,n,i,o,a,s){return safeAdd(function bitRotateLeft(t,n){return t<<n|t>>>32-n}(safeAdd(safeAdd(n,t),safeAdd(o,s)),a),i)}function md5ff(t,n,i,o,a,s,m){return md5cmn(n&i|~n&o,t,n,a,s,m)}function md5gg(t,n,i,o,a,s,m){return md5cmn(n&o|i&~o,t,n,a,s,m)}function md5hh(t,n,i,o,a,s,m){return md5cmn(n^i^o,t,n,a,s,m)}function md5ii(t,n,i,o,a,s,m){return md5cmn(i^(n|~o),t,n,a,s,m)}var R=v35("v3",48,(function md5(t){if("string"==typeof t){var n=unescape(encodeURIComponent(t));t=new Uint8Array(n.length);for(var i=0;i<n.length;++i)t[i]=n.charCodeAt(i)}return function md5ToHexEncodedArray(t){for(var n=[],i=32*t.length,o=0;o<i;o+=8){var a=t[o>>5]>>>o%32&255,s=parseInt("0123456789abcdef".charAt(a>>>4&15)+"0123456789abcdef".charAt(15&a),16);n.push(s)}return n}(function wordsToMd5(t,n){t[n>>5]|=128<<n%32,t[getOutputLength(n)-1]=n;for(var i=1732584193,o=-271733879,a=-1732584194,s=271733878,m=0;m<t.length;m+=16){var g=i,_=o,S=a,M=s;i=md5ff(i,o,a,s,t[m],7,-680876936),s=md5ff(s,i,o,a,t[m+1],12,-389564586),a=md5ff(a,s,i,o,t[m+2],17,606105819),o=md5ff(o,a,s,i,t[m+3],22,-1044525330),i=md5ff(i,o,a,s,t[m+4],7,-176418897),s=md5ff(s,i,o,a,t[m+5],12,1200080426),a=md5ff(a,s,i,o,t[m+6],17,-1473231341),o=md5ff(o,a,s,i,t[m+7],22,-45705983),i=md5ff(i,o,a,s,t[m+8],7,1770035416),s=md5ff(s,i,o,a,t[m+9],12,-1958414417),a=md5ff(a,s,i,o,t[m+10],17,-42063),o=md5ff(o,a,s,i,t[m+11],22,-1990404162),i=md5ff(i,o,a,s,t[m+12],7,1804603682),s=md5ff(s,i,o,a,t[m+13],12,-40341101),a=md5ff(a,s,i,o,t[m+14],17,-1502002290),o=md5ff(o,a,s,i,t[m+15],22,1236535329),i=md5gg(i,o,a,s,t[m+1],5,-165796510),s=md5gg(s,i,o,a,t[m+6],9,-1069501632),a=md5gg(a,s,i,o,t[m+11],14,643717713),o=md5gg(o,a,s,i,t[m],20,-373897302),i=md5gg(i,o,a,s,t[m+5],5,-701558691),s=md5gg(s,i,o,a,t[m+10],9,38016083),a=md5gg(a,s,i,o,t[m+15],14,-660478335),o=md5gg(o,a,s,i,t[m+4],20,-405537848),i=md5gg(i,o,a,s,t[m+9],5,568446438),s=md5gg(s,i,o,a,t[m+14],9,-1019803690),a=md5gg(a,s,i,o,t[m+3],14,-187363961),o=md5gg(o,a,s,i,t[m+8],20,1163531501),i=md5gg(i,o,a,s,t[m+13],5,-1444681467),s=md5gg(s,i,o,a,t[m+2],9,-51403784),a=md5gg(a,s,i,o,t[m+7],14,1735328473),o=md5gg(o,a,s,i,t[m+12],20,-1926607734),i=md5hh(i,o,a,s,t[m+5],4,-378558),s=md5hh(s,i,o,a,t[m+8],11,-2022574463),a=md5hh(a,s,i,o,t[m+11],16,1839030562),o=md5hh(o,a,s,i,t[m+14],23,-35309556),i=md5hh(i,o,a,s,t[m+1],4,-1530992060),s=md5hh(s,i,o,a,t[m+4],11,1272893353),a=md5hh(a,s,i,o,t[m+7],16,-155497632),o=md5hh(o,a,s,i,t[m+10],23,-1094730640),i=md5hh(i,o,a,s,t[m+13],4,681279174),s=md5hh(s,i,o,a,t[m],11,-358537222),a=md5hh(a,s,i,o,t[m+3],16,-722521979),o=md5hh(o,a,s,i,t[m+6],23,76029189),i=md5hh(i,o,a,s,t[m+9],4,-640364487),s=md5hh(s,i,o,a,t[m+12],11,-421815835),a=md5hh(a,s,i,o,t[m+15],16,530742520),o=md5hh(o,a,s,i,t[m+2],23,-995338651),i=md5ii(i,o,a,s,t[m],6,-198630844),s=md5ii(s,i,o,a,t[m+7],10,1126891415),a=md5ii(a,s,i,o,t[m+14],15,-1416354905),o=md5ii(o,a,s,i,t[m+5],21,-57434055),i=md5ii(i,o,a,s,t[m+12],6,1700485571),s=md5ii(s,i,o,a,t[m+3],10,-1894986606),a=md5ii(a,s,i,o,t[m+10],15,-1051523),o=md5ii(o,a,s,i,t[m+1],21,-2054922799),i=md5ii(i,o,a,s,t[m+8],6,1873313359),s=md5ii(s,i,o,a,t[m+15],10,-30611744),a=md5ii(a,s,i,o,t[m+6],15,-1560198380),o=md5ii(o,a,s,i,t[m+13],21,1309151649),i=md5ii(i,o,a,s,t[m+4],6,-145523070),s=md5ii(s,i,o,a,t[m+11],10,-1120210379),a=md5ii(a,s,i,o,t[m+2],15,718787259),o=md5ii(o,a,s,i,t[m+9],21,-343485551),i=safeAdd(i,g),o=safeAdd(o,_),a=safeAdd(a,S),s=safeAdd(s,M)}return[i,o,a,s]}(function bytesToWords(t){if(0===t.length)return[];for(var n=8*t.length,i=new Uint32Array(getOutputLength(n)),o=0;o<n;o+=8)i[o>>5]|=(255&t[o/8])<<o%32;return i}(t),8*t.length))}));var N=function v4(t,n,i){var o=(t=t||{}).random||(t.rng||rng)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n){i=i||0;for(var a=0;a<16;++a)n[i+a]=o[a];return n}return T(o)};function f(t,n,i,o){switch(t){case 0:return n&i^~n&o;case 1:return n^i^o;case 2:return n&i^n&o^i&o;case 3:return n^i^o}}function ROTL(t,n){return t<<n|t>>>32-n}var I=v35("v5",80,(function sha1(t){var n=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var o=unescape(encodeURIComponent(t));t=[];for(var a=0;a<o.length;++a)t.push(o.charCodeAt(a))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var s=t.length/4+2,m=Math.ceil(s/16),g=new Array(m),_=0;_<m;++_){for(var S=new Uint32Array(16),M=0;M<16;++M)S[M]=t[64*_+4*M]<<24|t[64*_+4*M+1]<<16|t[64*_+4*M+2]<<8|t[64*_+4*M+3];g[_]=S}g[m-1][14]=8*(t.length-1)/Math.pow(2,32),g[m-1][14]=Math.floor(g[m-1][14]),g[m-1][15]=8*(t.length-1)&4294967295;for(var T=0;T<m;++T){for(var O=new Uint32Array(80),A=0;A<16;++A)O[A]=g[T][A];for(var P=16;P<80;++P)O[P]=ROTL(O[P-3]^O[P-8]^O[P-14]^O[P-16],1);for(var L=i[0],R=i[1],N=i[2],I=i[3],j=i[4],V=0;V<80;++V){var U=Math.floor(V/20),G=ROTL(L,5)+f(U,R,N,I)+j+n[U]+O[V]>>>0;j=I,I=N,N=ROTL(R,30)>>>0,R=L,L=G}i[0]=i[0]+L>>>0,i[1]=i[1]+R>>>0,i[2]=i[2]+N>>>0,i[3]=i[3]+I>>>0,i[4]=i[4]+j>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]})),j="00000000-0000-0000-0000-000000000000";var V=function version_version(t){if(!m(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}},function(t,n,i){"use strict";(function(t,o){function maybe(t){try{return t()}catch(t){}}i.d(n,"a",(function(){return remove}));const a=maybe((function(){return globalThis}))||maybe((function(){return window}))||maybe((function(){return self}))||maybe((function(){return t}))||maybe((function(){return Function("return this")()}));let s=!1;function remove(){s&&(delete a.process,s=!1)}!function install(){!a||maybe((function(){return"production"}))||maybe((function(){return o}))||(Object.defineProperty(a,"process",{value:{env:{NODE_ENV:"production"}},configurable:!0,enumerable:!1,writable:!0}),s=!0)}()}).call(this,i(53),i(222))},,,,,function(t,n,i){"use strict";var o=this&&this.__createBinding||(Object.create?function(t,n,i,o){void 0===o&&(o=i),Object.defineProperty(t,o,{enumerable:!0,get:function(){return n[i]}})}:function(t,n,i,o){void 0===o&&(o=i),t[o]=n[i]}),a=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&o(n,t,i);return a(n,t),n};Object.defineProperty(n,"__esModule",{value:!0}),n.MediaUtils=n.ProductUtils=n.EventTypes=n.Visualizer=void 0;var m=i(125);Object.defineProperty(n,"Visualizer",{enumerable:!0,get:function(){return m.Visualizer}});var g=s(i(116));n.EventTypes=g;var _=s(i(69));n.MediaUtils=_;var S=s(i(40));n.ProductUtils=S,n.module=m.Visualizer},function(t,n,i){"use strict";var o,a=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var n,i=1,o=arguments.length;i<o;i++)for(var a in n=arguments[i])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)},m=this&&this.__createBinding||(Object.create?function(t,n,i,o){void 0===o&&(o=i),Object.defineProperty(t,o,{enumerable:!0,get:function(){return n[i]}})}:function(t,n,i,o){void 0===o&&(o=i),t[o]=n[i]}),g=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),_=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&m(n,t,i);return g(n,t),n},S=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},M=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}},T=this&&this.__read||function(t,n){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,a,s=i.call(t),m=[];try{for(;(void 0===n||n-- >0)&&!(o=s.next()).done;)m.push(o.value)}catch(t){a={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return m},O=this&&this.__spreadArray||function(t,n){for(var i=0,o=n.length,a=t.length;i<o;i++,a++)t[a]=n[i];return t},A=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.Visualizer=void 0;var P=A(i(51)),L=i(118),R=i(189),N=i(68),I=i(195),j=i(252),V=i(256),U=i(72),G=i(116),z=i(257),H=i(33),q=i(70),Z=A(i(258)),X=i(265),Q=_(i(266)),Y=A(i(113)),J=i(267),K=i(117),$=function(t){function Visualizer(n,i){var o=t.call(this)||this;return o.pubs=[],o.divFirstGo=[],o.emitAsyncOperationProgress=function(t){return o.emit("asyncOperationStarted",{processId:o.processId,progress:t})},o.visualizerLoaded=void 0,o.containerSelector=n,o.sceneSelector=i,o.ImageOptimizeService=new J.ImageOptimizeService,o.mainContainerElement=document.querySelector(o.containerSelector),o.mainContainerElement.Visualizer=o,o.emit("containerInjected",{visualizer:o}),o.sceneMetadataManager=new z.SceneMetadataManager(o),o.appManager=new N.AppManager,o.productsManager=new j.ProductsManager(o),o.catalogManager=new I.CatalogManager(o),o.subEventsAnalytics(),o.readAttributes(),o.initAndLoad(),o}return a(Visualizer,t),Visualizer.prototype.readAttributes=function(){var t=this.loadProps(this.containerSelector),n=t.debug,i=t.experienceId,o=t.hashExperienceId,a=t.maxFaceSize,s=t.maxFaceSizeMobile,m=t.defaultProduct,g=t.defaultProducts,_=t.sceneConfigurationLabel,S=t.productsList,M=t.defaultApplication;this.defaultApplication=M,this.debug=n,this.defaultProduct=m,this.defaultProducts=g,this.maxFaceSize=a,this.maxFaceSizeMobile=s,this.catalogManager.setProductsList(S),this.sceneLoading=void 0,this.sceneLoaded=void 0,o&&this.experienceHash&&this.experienceHash!==o&&console.warn("hashExperienceId not supposed to change"),i&&this.experienceId&&this.experienceId!==i&&console.warn("experienceId not supposed to change"),this.experienceHash=o,this.experienceId=i,_&&this.sceneConfigurationLabel!==_&&(this.sceneConfigurationLabel=_,this.sceneMetadataManager.resetSceneConfigurations(),this.emit("sceneConfigurationLabelChanged"))},Visualizer.prototype.initAndLoad=function(){return S(this,void 0,void 0,(function(){var t,n;return M(this,(function(i){switch(i.label){case 0:return t=L.v1(),this.emit("asyncOperationStarted",{processId:t}),[4,U.sleep(200)];case 1:return i.sent(),[4,this.initExperience()];case 2:return i.sent(),[4,this.appManager.Load()];case 3:return i.sent(),n=this.appManager.currentExperience.getMetadata().getCustomAttribute("image_optimizer_endpoint"),this.ImageOptimizeService.setUrl(n),this.imageOptimizerUrl=n,this.sceneMetadataManager.init(this.appManager.currentExperience.getMetadata()),this.emit("asyncOperationEnded",{processId:t}),this.visualizerLoaded={visualizer:this,experienceConfiguration:this.getCurrentSceneConfiguration()},this.emit("visualizerLoaded",this.visualizerLoaded),this.emitPageViewAnalytics(),[2]}}))}))},Visualizer.prototype.resetResize=function(){var t,n,i,o,a;null===(a=null===(o=null===(i=null===(n=null===(t=this.appManager)||void 0===t?void 0:t.currentExperience)||void 0===n?void 0:n.cameraControlsRegistry)||void 0===i?void 0:i.cameraControls)||void 0===o?void 0:o.resizeFunc)||void 0===a||a.call(o)},Visualizer.prototype.setScene=function(t){var n=t.sceneId,i=t.preventDefaultProducts,o=void 0!==i&&i,a=t.preventEvent,s=void 0!==a&&a;return S(this,void 0,void 0,(function(){var t,i,a,m;return M(this,(function(g){switch(g.label){case 0:return n===this.sceneId&&this.defaultApplication&&this.setCurrentApplication(this.defaultApplication,!0),n&&n!==this.sceneId?(this.sceneId=n,t=L.v1(),this.emit("asyncOperationStarted",{processId:t}),[4,U.sleep(200)]):[2];case 1:g.sent(),i=this.sceneId;try{a=this.sceneMetadataManager.getScene(this.sceneMetadataManager.getLocation(n))}catch(n){throw this.emit("asyncOperationEnded",{processId:t}),this.sceneId=i,n}return this.sceneLoading={scene:a,sceneConfiguration:this.getCurrentSceneConfiguration()},this.emit("sceneLoading",this.sceneLoading),this.productsManager.unDisplayAll(),[4,Promise.all([this.initCatalog(),this.navigate()])];case 2:return g.sent(),(m=this.appManager.currentExperience.userInteractionControlsRegistry.userInteractionControls)instanceof N.Controls.UserInteractionControls.MouseControls&&(m.dblClickThresholdTime=1),this.defaultApplication&&this.setCurrentApplication(this.defaultApplication,!0),o?[3,4]:[4,this.initialProductDisplay()];case 3:g.sent(),g.label=4;case 4:return[4,this.savedUserProductsDisplay(this.productsManager.getUserDisplayedProducts())];case 5:return g.sent(),this.sceneLoaded={scene:a,sceneConfiguration:this.getCurrentSceneConfiguration()},s||this.emit("sceneLoaded",{scene:a}),this.emit("asyncOperationEnded",{processId:t}),this.onZoneLoaded(),[2]}}))}))},Visualizer.prototype.setFavoriteScenes=function(t){this.productsManager.setFavoriteSets(t)},Visualizer.prototype.setFavoriteProducts=function(t){this.productsManager.setFavoriteProducts(t)},Visualizer.prototype.onZoneLoaded=function(){return S(this,void 0,void 0,(function(){var t=this;return M(this,(function(n){return this.hotspots=[],this.appManager.currentExperience.currentZone.elementsList.filter((function(n){var i,o=null===(i=n.getCustomAttribute(H.Constants.ProductFilter))||void 0===i?void 0:i.application;o&&"point"===n.getCustomAttribute(H.Constants.HotspotType)&&(n.setVisible(!1),n.setEnabled(!1),t.hotspots.push({elm:n,application:o,title:t.catalogManager.getApplicationConfiguration(o).title}))})),setTimeout((function(){return t.appManager.eventManager.next({origin:t,eventType:N.Core.EventManager.EventTypes.ShouldRenderEvent,message:{}})}),100),[2]}))}))},Visualizer.prototype.initCatalog=function(){return S(this,void 0,void 0,(function(){return M(this,(function(t){switch(t.label){case 0:if(!this.sceneId)throw"sceneId undefined";return[4,this.catalogManager.init(this.sceneId)];case 1:return t.sent(),[2]}}))}))},Visualizer.prototype.initialProductDisplay=function(t){return S(this,void 0,void 0,(function(){var n,i,o,a,s=this;return M(this,(function(m){switch(m.label){case 0:return t?(n=t.defaultProduct,i=t.defaultProducts):(n=this.defaultProduct,i=this.defaultProducts),this.defaultProduct=void 0,this.defaultProducts=void 0,o=this.getApplicationsList(),a=o.map((function(t){var o,a,m=s.catalogManager.getProductListByApplication(t);if(null==m?void 0:m.length){var g=m[0].sku;if(n)(_=null===(o=m.find((function(t){return t.sku===n})))||void 0===o?void 0:o.sku)&&(g=_);else if(i){var _;(_=null===(a=m.find((function(n){return n.sku===(null==i?void 0:i[null==t?void 0:t.application])})))||void 0===a?void 0:a.sku)&&(g=_)}return s.productsManager.displayProduct(g,t.application)}})),[4,Promise.all(a)];case 1:return m.sent(),[2]}}))}))},Visualizer.prototype.savedUserProductsDisplay=function(t){return S(this,void 0,void 0,(function(){var n,i=this;return M(this,(function(o){switch(o.label){case 0:return n=[],Object.entries(t).forEach((function(t){var o=T(t,2),a=o[0],s=o[1],m=i.catalogManager.getApplication(a);if(m){var g=i.catalogManager.getProductListByApplication(m),_=null==g?void 0:g.find((function(t){return t.sku===s}));_&&n.push(i.productsManager.displayProduct(_.sku,a))}})),[4,Promise.all(n)];case 1:return o.sent(),[2]}}))}))},Visualizer.prototype.getCurrentSceneConfiguration=function(){return this.sceneMetadataManager.getSceneConfiguration(this.sceneId)},Visualizer.prototype.subEventsAnalytics=function(){var t=this;Object.entries(G.analyticsEvents).forEach((function(n){var i=T(n,2),o=i[0],a=i[1],s=a.category,m=a.eventParamsPaths;t.on(o,(function(n){return t.emitEventsAnalytics({action:o,category:s,params:m.map((function(t){var i;return(i={})[t]=Y.default(n,t),i}))})}))}))},Visualizer.prototype.emitEventsAnalytics=function(t){var n,i,o,a=t.action,s=t.category,m=t.params,g=null!=s?s:"",_=m?JSON.stringify(m.reduce((function(t,n){return Object.assign(t,n)}),{})):"";K.debug.log("emitEventsAnalytics action: "+a+", category: "+s+", label: "+_),null===(o=null===(i=null===(n=this.getCurrentSceneConfiguration())||void 0===n?void 0:n.analytics)||void 0===i?void 0:i.plugins)||void 0===o||o.forEach((function(t){var n=t.details.trackingId;n&&X.sendCustomGA({action:a,category:g,label:_,trackingId:n})}))},Visualizer.prototype.emitPageViewAnalytics=function(){var t,n,i,o=this;null===(i=null===(n=null===(t=this.getCurrentSceneConfiguration())||void 0===t?void 0:t.analytics)||void 0===n?void 0:n.plugins)||void 0===i||i.forEach((function(t){var n,i,a=t.details.trackingId;a&&(K.debug.log("trackingId",a),X.sendPageViewGA({trackingId:a,idLabel:null!==(n=o.experienceId?"experienceId":o.experienceHash&&"experienceHash")&&void 0!==n?n:"",idValue:null!==(i=o.experienceId||o.experienceHash)&&void 0!==i?i:""}))}))},Visualizer.prototype.getCurrentCatalogFieldsMap=function(){return this.getCurrentSceneConfiguration().catalogFieldsMapping},Visualizer.prototype.getCurrentApplication=function(){var t;if(!this.sceneId)throw"sceneId undefined";return null===(t=this.catalogManager.selectionState.get(this.sceneId))||void 0===t?void 0:t.application},Visualizer.prototype.setCurrentApplication=function(t,n){return void 0===n&&(n=!1),S(this,void 0,void 0,(function(){var i,o,a;return M(this,(function(m){switch(m.label){case 0:if(K.debug.log("setCurrentApplication",n),!this.sceneId)throw"sceneId undefined";return"string"==typeof t?(o=this.getApplicationsList(),i=o.find((function(n){return n.application===t}))):i=t,i?(a=this.catalogManager.selectionState.get(this.sceneId),this.catalogManager.selectionState.set(this.sceneId,s(s({},a),{application:i})),[4,this.rotateCameraToApplication({application:i.application,evenIfInView:n})]):[3,2];case 1:m.sent(),this.emit("applicationSelected",{application:i}),m.label=2;case 2:return[2,i]}}))}))},Visualizer.prototype.getFilters=function(){if(!this.sceneId)throw"sceneId undefined";return this.catalogManager.getFilters(this.sceneId)},Visualizer.prototype.getCurrentFilters=function(){var t,n;if(!this.sceneId)throw"sceneId undefined";var i=this.getCurrentApplication();return(null==i?void 0:i.application)&&(null===(n=null===(t=this.catalogManager.selectionState.get(this.sceneId))||void 0===t?void 0:t.filters)||void 0===n?void 0:n[null==i?void 0:i.application])||[]},Visualizer.prototype.getCurrentSearchText=function(){var t,n,i;if(!this.sceneId)throw"sceneId undefined";var o=this.getCurrentApplication();return null!==(i=(null==o?void 0:o.application)&&(null===(n=null===(t=this.catalogManager.selectionState.get(this.sceneId))||void 0===t?void 0:t.searchFilters)||void 0===n?void 0:n[null==o?void 0:o.application]))&&void 0!==i?i:""},Visualizer.prototype.setSearchFilter=function(t){var n;if(this.sceneId){var i=this.getCurrentApplication();if(i){var o=this.catalogManager.selectionState.get(this.sceneId),a=((n={})[null==i?void 0:i.application]=t,n);this.catalogManager.selectionState.set(this.sceneId,s(s({},o),{searchFilters:s(s({},null==o?void 0:o.searchFilters),a)}))}else console.warn("application is not selected")}else console.warn("sceneId undefined")},Visualizer.prototype.setFilter=function(t){var n,i=this;if(this.sceneId){var o=this.getCurrentApplication();if(o){var a=this.catalogManager.selectionState.get(this.sceneId),m=[];t.forEach((function(t){var n=q.getFilterByName(t.name,i);n&&m.push({name:n.name,options:t.options,customFieldName:n.customFieldName})}));var g=((n={})[null==o?void 0:o.application]=P.default(m),n);return this.catalogManager.selectionState.set(this.sceneId,s(s({},a),{filters:s(s({},null==a?void 0:a.filters),g)})),m}console.warn("application is not selected")}else console.warn("sceneId undefined")},Visualizer.prototype.getDisplayedProduct=function(t){return this.productsManager.getDisplayedProduct(t)},Visualizer.prototype.getDisplayedProducts=function(){return this.productsManager.getDisplayedFormatedProduct()},Visualizer.prototype.getProductList=function(){if(!this.sceneId)throw"sceneId undefined";return this.catalogManager.getProductList(this.sceneId)},Visualizer.prototype.getApplicationsList=function(){return this.catalogManager.getCatalogsApplications()},Visualizer.prototype.addProductToFavorites=function(t,n){var i=this.productsManager.addProductToFavorites(t,n);return this.emit("productAddedToFavorites",{favorites:this.productsManager.favoriteProducts,product:i}),this.productsManager.favoriteProducts},Visualizer.prototype.removeProductFromFavorites=function(t,n){var i=this.productsManager.removeProductFromFavorites(t,n);return this.emit("productRemovedFromFavorites",{favorites:this.productsManager.favoriteProducts,product:i}),this.productsManager.favoriteProducts},Visualizer.prototype.getFavoriteProducts=function(){return this.productsManager.getFavoriteProducts()},Visualizer.prototype.addFavoriteScene=function(){return S(this,void 0,void 0,(function(){var t;return M(this,(function(n){switch(n.label){case 0:if(!this.sceneId)throw"sceneId undefined";return[4,U.sleep(200)];case 1:return n.sent(),[4,this.productsManager.addFavoriteScene(this.sceneId)];case 2:return t=n.sent(),this.emit("sceneAddedToFavorites",{favoriteScenes:this.productsManager.favoriteSets,scene:t}),[2,this.productsManager.favoriteSets]}}))}))},Visualizer.prototype.removeFavoriteScene=function(t){var n=this.productsManager.removeFavoriteScene(t);return this.emit("sceneRemovedFromFavorites",{favoriteScenes:this.productsManager.favoriteSets,scene:n}),this.productsManager.favoriteSets},Visualizer.prototype.getFavoriteScenes=function(){return this.productsManager.getFavoriteSets()},Visualizer.prototype.getSceneList=function(){return this.sceneMetadataManager.getSceneList()},Visualizer.prototype.addProductToCart=function(t){this.emit("productAddedToCart",{product:t})},Visualizer.prototype.orderSample=function(t){this.emit("orderSample",{product:t})},Visualizer.prototype.getCurrentSceneImage=function(){return S(this,void 0,void 0,(function(){var t=this;return M(this,(function(n){return[2,new Promise((function(n,i){t.appManager.currentExperience.renderer.domElement.toBlob((function(t){var i=URL.createObjectURL(t);n(i)}),"image/jpeg")}))]}))}))},Visualizer.prototype.getCurrentScene=function(){return this.sceneMetadataManager.getScene(this.sceneMetadataManager.getLocation(this.sceneId))},Visualizer.prototype.displayProduct=function(t,n,i){return void 0===i&&(i=!0),S(this,void 0,void 0,(function(){var o,a,s,m,g=this;return M(this,(function(_){switch(_.label){case 0:return(o="string"==typeof n?[n]:Array.isArray(n)?n:[n.application]).length<1?(console.warn("visualizer: displayProduct: provided with empty applications "),[2]):(a=L.v1(),this.processId=a,this.emitAsyncOperationProgress({}),s=[],m=function(n){return S(g,void 0,void 0,(function(){var i;return M(this,(function(o){switch(o.label){case 0:return[4,this.productsManager.displayProduct(t,n)];case 1:return o.sent(),this.productsManager.addUserDisplayedProduct(t,n),(i=this.productsManager.getDisplayedProduct(n))&&this.emit("userChangedProduct",{product:i}),[2]}}))}))},o.forEach((function(t){s.push(m(t))})),i&&1===o.length&&s.push(this.rotateCameraToApplication({application:o[0]})),[4,Promise.all(s)]);case 1:return _.sent(),this.emit("asyncOperationEnded",{processId:a}),[2]}}))}))},Visualizer.prototype.displayFavoriteProduct=function(t){var n=t.sku,i=t.applications;return S(this,void 0,void 0,(function(){var t,o;return M(this,(function(a){return t=this.catalogManager.getApplicationsForProduct(n),0===(o=i.filter((function(n){return t.includes(n)}))).length&&(o=t),[2,this.displayProduct(n,o)]}))}))},Visualizer.prototype.displaySceneFromFavorites=function(t){return S(this,void 0,void 0,(function(){var n,i,o,a=this;return M(this,(function(s){switch(s.label){case 0:return(n=this.productsManager.favoriteSets.find((function(n){return n.id===t})))?[4,U.sleep(200)]:[3,7];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,this.setScene({sceneId:n.scene.sceneId,preventDefaultProducts:!0})];case 3:return s.sent(),[3,5];case 4:return i=s.sent(),console.warn(i),[3,5];case 5:return this.emit("asyncOperationStarted",{progress:{percent:0}}),o=n.favorites.map((function(t){return a.productsManager.displayProduct(t.product.sku,t.product.application,!0)})),[4,Promise.all(o)];case 6:s.sent(),this.emit("favoritesSceneDisplayed",{scene:n}),this.emit("asyncOperationEnded"),s.label=7;case 7:return[2]}}))}))},Visualizer.prototype.fetchMetadata=function(){return S(this,void 0,void 0,(function(){return M(this,(function(t){return this.experienceHash?[2,U.GetRequest(V.metadataHashEndpoint+"?hash="+this.experienceHash)]:[2,U.GetRequest(V.metadataEndpoint+"?experience_hash="+this.experienceId)]}))}))},Visualizer.prototype.rotateCameraToApplication=function(t){var n=t.application,i=t.evenIfInView,o=void 0!==i&&i;return S(this,void 0,void 0,(function(){var t,i,a,s,m,g;return M(this,(function(_){switch(_.label){case 0:return n&&(null==(t=this.appManager.currentExperience.currentZone.elementsList.filter((function(t){var i=t.getCustomAttribute(H.Constants.ProductFilter);return(null==i?void 0:i.application)===n})))?void 0:t.length)?(i=this.appManager.currentExperience.cameraControlsRegistry.cameraControls,a=t.some((function(t){var n=N.Utils.Utils.SetBoxFromObj(new N.THREE.Box3,t.obj);return i.isObjectVisible(n)})),!o&&a?[2]:(s=new N.THREE.Vector3(0,0,0),m=t[0].getMetadata().position,g=new N.THREE.Vector3(+m.x,+m.y,+m.z),[4,i.animateCamera(s,g,!1,.5)])):[2];case 1:return _.sent(),[2]}}))}))},Visualizer.prototype.initExperience=function(){return S(this,void 0,void 0,(function(){var t,n;return M(this,(function(i){switch(i.label){case 0:return new N.Factories.ScreenFactory.ScreenFactory(this.appManager).register(),new N.Factories.ScreenGalleryFactory.ScreenGalleryFactory(this.appManager).register(),new N.Factories.BackgroundImageFactory.BackgroundImageFactory(this.appManager).register(),new N.Factories.TransparentBackgroundFactory.TransparentBackgroundFactory(this.appManager).register(),new N.Factories.ZoneLightFactory.ZoneLightFactory(this.appManager).register(),new N.Factories.CSSElementFactory.CSSElementFactory(this.appManager).register(),new N.Factories.CameraControlsFactory.TouchCameraControlsFactory(this.appManager).register(),new N.Factories.CameraControlsFactory.OrbitCameraControlsFactory(this.appManager).register(),new N.Factories.CameraControlsFactory.VROrbitCameraControlsFactory(this.appManager).register(),new N.Factories.CameraControlsFactory.DollyCameraControlsFactory(this.appManager).register(),new N.Factories.CameraControlsFactory.VRDollyCameraControlsFactory(this.appManager).register(),[4,this.fetchMetadata()];case 1:return t=i.sent(),n=new N.Elements.ExperienceManager.ExperienceManager(t,this.appManager),[4,this.appManager.init({containerSelector:this.sceneSelector,scene:window.scene,debug:this.debug,experienceManager:n})];case 2:return i.sent(),this.registerEvents(),[2]}}))}))},Visualizer.prototype.isScreenElementVisible=function(t){var n,i,o,a,s,m,g=t.obj;if(g)return this.isObjectVisible||(this.THREEBox=new N.THREE.Box3,this.isObjectVisible=null===(o=null===(i=null===(n=this.appManager.currentExperience)||void 0===n?void 0:n.cameraControlsRegistry)||void 0===i?void 0:i.cameraControls)||void 0===o?void 0:o.isObjectVisible.bind(null===(s=null===(a=this.appManager.currentExperience)||void 0===a?void 0:a.cameraControlsRegistry)||void 0===s?void 0:s.cameraControls)),null===(m=this.isObjectVisible)||void 0===m?void 0:m.call(this,this.THREEBox.setFromObject(g))},Visualizer.prototype.emitRenderEvent=function(){this.appManager.eventManager.next({origin:this,eventType:N.Core.EventManager.EventTypes.ShouldRenderEvent,message:{}})},Visualizer.prototype.toScreenPosition=function(t){var n,i,o,a=t.obj;if(a){var s=null===(o=null===(i=null===(n=this.appManager.currentExperience)||void 0===n?void 0:n.cameraControlsRegistry)||void 0===i?void 0:i.cameraControls)||void 0===o?void 0:o.camera,m=this.mainContainerElement.getBoundingClientRect().width/2,g=this.mainContainerElement.getBoundingClientRect().height/2;a.updateMatrixWorld();var _=new N.THREE.Vector3;return _.setFromMatrixPosition(a.matrixWorld),_.project(s),_.x=_.x*m+m,_.y=-_.y*g+g,{x:_.x,y:_.y}}},Visualizer.prototype.unRegisterEvents=function(){this.pubs.forEach((function(t){return t.unsubscribe()}))},Visualizer.prototype.registerEvents=function(){var t=this,n=this.appManager.eventManager.pipe(N.Utils.RxUtils.filter((function(t){return t.eventType.name===(new N.Core.EventManager.EventTypes.TouchEvent).name||t.eventType===N.Core.EventManager.EventTypes.TouchEvent}))).subscribe((function(n){t.emit("sceneTouched",{scene:t.getCurrentScene()})}));this.pubs.push(n);var i=this.appManager.eventManager.pipe(N.Utils.RxUtils.filter((function(t){return t.eventType.name===N.Core.EventManager.EventTypes.ShouldRenderEvent.name}))).subscribe((function(n){var i;K.debug.log("render");var o=[],a=[];null===(i=t.hotspots)||void 0===i||i.forEach((function(n){var i=t.toScreenPosition(n.elm);if(i){var s={application:n.application,position:i,title:n.title};a.push(s),t.isScreenElementVisible(n.elm)&&o.push(s)}})),t.emit("rendered",{visibleHotspots:o,hotspots:a})}));this.pubs.push(i);var o=this.appManager.eventManager.pipe(N.Utils.RxUtils.filter((function(t){return t.eventType.name===N.Core.EventManager.EventTypes.FocusEvent.name}))).subscribe((function(n){var i,o=null===(i=n.origin)||void 0===i?void 0:i.getCustomAttribute(H.Constants.ProductFilter),a={application:o.application,title:t.catalogManager.getApplicationConfiguration(o.application).title,isHover:!0};t.emit("hoverHotspot",{hotspot:a})}));this.pubs.push(o);var a=this.appManager.eventManager.pipe(N.Utils.RxUtils.filter((function(t){return t.eventType.name===N.Core.EventManager.EventTypes.UnfocusEvent.name}))).subscribe((function(n){var i,o=null===(i=n.origin)||void 0===i?void 0:i.getCustomAttribute(H.Constants.ProductFilter),a={application:o.application,title:t.catalogManager.getApplicationConfiguration(o.application).title,isHover:!1};t.emit("hoverHotspot",{hotspot:a})}));this.pubs.push(a);var s=this.appManager.eventManager.pipe(N.Utils.RxUtils.filter((function(t){return t.eventType.name===N.Core.EventManager.EventTypes.CameraZoomEvent.name}))).subscribe((function(){t.emit("camera",{eventType:"move"})}));this.pubs.push(s);var m=this.appManager.eventManager.pipe(N.Utils.RxUtils.filter((function(t){return t.eventType.name===N.Core.EventManager.EventTypes.CameraMoveEvent.name}))).subscribe((function(){t.emit("camera",{eventType:"zoom"})}));this.pubs.push(m)},Visualizer.prototype.navigate=function(){return S(this,void 0,void 0,(function(){var t;return M(this,(function(n){switch(n.label){case 0:return this.appManager.currentExperience?(t=this.sceneMetadataManager.getLocation(this.sceneId).index,[4,this.appManager.currentExperience.navigate(""+t)]):[2];case 1:return n.sent(),[2]}}))}))},Visualizer.prototype.loadProps=function(t){var n=document.querySelector(t);if(!n)throw new Error("no visualizer element in page");var i,o,a=n.getAttribute("experienceId")||void 0,s=n.getAttribute("hashExperienceId")||void 0,m=n.getAttribute("maxFaceSizeMobile"),g=m||n.getAttribute("maxFaceSize"),_=!!n.getAttribute("debug"),S=n.getAttribute("defaultProduct")||void 0,M=n.getAttribute("defaultApplication")||void 0,T=n.getAttribute("defaultProducts"),O=n.getAttribute("scene_configuration")||void 0,A=n.getAttribute("productsList")||void 0;try{i=T&&JSON.parse(T)||void 0}catch(t){console.warn("error parsing default products"),i=void 0}return A&&(o=JSON.parse(A)),{hashExperienceId:s,experienceId:a,debug:_,maxFaceSize:g?+g:null,maxFaceSizeMobile:m?+m:null,defaultProduct:S,defaultProducts:i,sceneConfigurationLabel:O,productsList:o,defaultApplication:M}},Visualizer.prototype.emit=function(n){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t.prototype.emit.apply(this,O([n],T(i)));var a=new CustomEvent(n,{detail:i[0]});return this.mainContainerElement.dispatchEvent(a),!0},Visualizer}(R.TypedEmitter);n.Visualizer=$;var ee=Z.default((function(t){var n=L.v1();t.setAttribute("visualizer-root-uniq-id",n);var i=te+'[visualizer-root-uniq-id="'+n+'"]',o=document.createElement("div");o.setAttribute("visualizer-container-uniq-id",n),o.setAttribute("data-role","visualizer-container"),o.style.width="100%",o.style.height="100%",o.style.position="relative",o.style.outline="none",t.appendChild(o);var a=document.createElement("div");a.setAttribute("visualizer-scene-uniqi-id",n),a.setAttribute("data-role","visualizer-scene-container"),a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.outline="none";var s='[visualizer-scene-uniqi-id="'+n+'"]';o.appendChild(a),new $(i,s)})),te='[data-role="visualizer"]',start=function(){var t,n=document.querySelector(te);if(n&&!(null==n?void 0:n.Visualizer)){console.log("Visualizer Logic version",Q.version);try{JSON.parse(null!==(t=localStorage.getItem("visualizer.debug.visible"))&&void 0!==t?t:"")&&(K.debug.visible=!0)}catch(t){}ee(n)}};window.startLogicVisualizer||(window.startLogicVisualizer=start,start())},function(t,n,i){var o=i(36),a=i(132),s=i(133),m=i(134),g=i(135),_=i(136);function Stack(t){var n=this.__data__=new o(t);this.size=n.size}Stack.prototype.clear=a,Stack.prototype.delete=s,Stack.prototype.get=m,Stack.prototype.has=g,Stack.prototype.set=_,t.exports=Stack},function(t,n){t.exports=function listCacheClear(){this.__data__=[],this.size=0}},function(t,n,i){var o=i(37),a=Array.prototype.splice;t.exports=function listCacheDelete(t){var n=this.__data__,i=o(n,t);return!(i<0)&&(i==n.length-1?n.pop():a.call(n,i,1),--this.size,!0)}},function(t,n,i){var o=i(37);t.exports=function listCacheGet(t){var n=this.__data__,i=o(n,t);return i<0?void 0:n[i][1]}},function(t,n,i){var o=i(37);t.exports=function listCacheHas(t){return o(this.__data__,t)>-1}},function(t,n,i){var o=i(37);t.exports=function listCacheSet(t,n){var i=this.__data__,a=o(i,t);return a<0?(++this.size,i.push([t,n])):i[a][1]=n,this}},function(t,n,i){var o=i(36);t.exports=function stackClear(){this.__data__=new o,this.size=0}},function(t,n){t.exports=function stackDelete(t){var n=this.__data__,i=n.delete(t);return this.size=n.size,i}},function(t,n){t.exports=function stackGet(t){return this.__data__.get(t)}},function(t,n){t.exports=function stackHas(t){return this.__data__.has(t)}},function(t,n,i){var o=i(36),a=i(52),s=i(54);t.exports=function stackSet(t,n){var i=this.__data__;if(i instanceof o){var m=i.__data__;if(!a||m.length<199)return m.push([t,n]),this.size=++i.size,this;i=this.__data__=new s(m)}return i.set(t,n),this.size=i.size,this}},function(t,n,i){var o=i(80),a=i(140),s=i(18),m=i(82),g=/^\[object .+?Constructor\]$/,_=Function.prototype,S=Object.prototype,M=_.toString,T=S.hasOwnProperty,O=RegExp("^"+M.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function baseIsNative(t){return!(!s(t)||a(t))&&(o(t)?O:g).test(m(t))}},function(t,n,i){var o=i(31),a=Object.prototype,s=a.hasOwnProperty,m=a.toString,g=o?o.toStringTag:void 0;t.exports=function getRawTag(t){var n=s.call(t,g),i=t[g];try{t[g]=void 0;var o=!0}catch(t){}var a=m.call(t);return o&&(n?t[g]=i:delete t[g]),a}},function(t,n){var i=Object.prototype.toString;t.exports=function objectToString(t){return i.call(t)}},function(t,n,i){var o,a=i(141),s=(o=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"";t.exports=function isMasked(t){return!!s&&s in t}},function(t,n,i){var o=i(14)["__core-js_shared__"];t.exports=o},function(t,n){t.exports=function getValue(t,n){return null==t?void 0:t[n]}},function(t,n,i){var o=i(144),a=i(36),s=i(52);t.exports=function mapCacheClear(){this.size=0,this.__data__={hash:new o,map:new(s||a),string:new o}}},function(t,n,i){var o=i(145),a=i(146),s=i(147),m=i(148),g=i(149);function Hash(t){var n=-1,i=null==t?0:t.length;for(this.clear();++n<i;){var o=t[n];this.set(o[0],o[1])}}Hash.prototype.clear=o,Hash.prototype.delete=a,Hash.prototype.get=s,Hash.prototype.has=m,Hash.prototype.set=g,t.exports=Hash},function(t,n,i){var o=i(38);t.exports=function hashClear(){this.__data__=o?o(null):{},this.size=0}},function(t,n){t.exports=function hashDelete(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n}},function(t,n,i){var o=i(38),a=Object.prototype.hasOwnProperty;t.exports=function hashGet(t){var n=this.__data__;if(o){var i=n[t];return"__lodash_hash_undefined__"===i?void 0:i}return a.call(n,t)?n[t]:void 0}},function(t,n,i){var o=i(38),a=Object.prototype.hasOwnProperty;t.exports=function hashHas(t){var n=this.__data__;return o?void 0!==n[t]:a.call(n,t)}},function(t,n,i){var o=i(38);t.exports=function hashSet(t,n){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=o&&void 0===n?"__lodash_hash_undefined__":n,this}},function(t,n,i){var o=i(39);t.exports=function mapCacheDelete(t){var n=o(this,t).delete(t);return this.size-=n?1:0,n}},function(t,n){t.exports=function isKeyable(t){var n=typeof t;return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t}},function(t,n,i){var o=i(39);t.exports=function mapCacheGet(t){return o(this,t).get(t)}},function(t,n,i){var o=i(39);t.exports=function mapCacheHas(t){return o(this,t).has(t)}},function(t,n,i){var o=i(39);t.exports=function mapCacheSet(t,n){var i=o(this,t),a=i.size;return i.set(t,n),this.size+=i.size==a?0:1,this}},function(t,n){t.exports=function arrayEach(t,n){for(var i=-1,o=null==t?0:t.length;++i<o&&!1!==n(t[i],i,t););return t}},function(t,n,i){var o=i(32),a=i(56);t.exports=function baseAssign(t,n){return t&&o(n,a(n),t)}},function(t,n){t.exports=function baseTimes(t,n){for(var i=-1,o=Array(t);++i<t;)o[i]=n(i);return o}},function(t,n,i){var o=i(26),a=i(19);t.exports=function baseIsArguments(t){return a(t)&&"[object Arguments]"==o(t)}},function(t,n){t.exports=function stubFalse(){return!1}},function(t,n,i){var o=i(161),a=i(58),s=i(59),m=s&&s.isTypedArray,g=m?a(m):o;t.exports=g},function(t,n,i){var o=i(26),a=i(89),s=i(19),m={};m["[object Float32Array]"]=m["[object Float64Array]"]=m["[object Int8Array]"]=m["[object Int16Array]"]=m["[object Int32Array]"]=m["[object Uint8Array]"]=m["[object Uint8ClampedArray]"]=m["[object Uint16Array]"]=m["[object Uint32Array]"]=!0,m["[object Arguments]"]=m["[object Array]"]=m["[object ArrayBuffer]"]=m["[object Boolean]"]=m["[object DataView]"]=m["[object Date]"]=m["[object Error]"]=m["[object Function]"]=m["[object Map]"]=m["[object Number]"]=m["[object Object]"]=m["[object RegExp]"]=m["[object Set]"]=m["[object String]"]=m["[object WeakMap]"]=!1,t.exports=function baseIsTypedArray(t){return s(t)&&a(t.length)&&!!m[o(t)]}},function(t,n,i){var o=i(60),a=i(163),s=Object.prototype.hasOwnProperty;t.exports=function baseKeys(t){if(!o(t))return a(t);var n=[];for(var i in Object(t))s.call(t,i)&&"constructor"!=i&&n.push(i);return n}},function(t,n,i){var o=i(90)(Object.keys,Object);t.exports=o},function(t,n,i){var o=i(32),a=i(62);t.exports=function baseAssignIn(t,n){return t&&o(n,a(n),t)}},function(t,n,i){var o=i(18),a=i(60),s=i(166),m=Object.prototype.hasOwnProperty;t.exports=function baseKeysIn(t){if(!o(t))return s(t);var n=a(t),i=[];for(var g in t)("constructor"!=g||!n&&m.call(t,g))&&i.push(g);return i}},function(t,n){t.exports=function nativeKeysIn(t){var n=[];if(null!=t)for(var i in Object(t))n.push(i);return n}},function(t,n,i){(function(t){var o=i(14),a=n&&!n.nodeType&&n,s=a&&"object"==typeof t&&t&&!t.nodeType&&t,m=s&&s.exports===a?o.Buffer:void 0,g=m?m.allocUnsafe:void 0;t.exports=function cloneBuffer(t,n){if(n)return t.slice();var i=t.length,o=g?g(i):new t.constructor(i);return t.copy(o),o}}).call(this,i(57)(t))},function(t,n){t.exports=function copyArray(t,n){var i=-1,o=t.length;for(n||(n=Array(o));++i<o;)n[i]=t[i];return n}},function(t,n,i){var o=i(32),a=i(63);t.exports=function copySymbols(t,n){return o(t,a(t),n)}},function(t,n){t.exports=function arrayFilter(t,n){for(var i=-1,o=null==t?0:t.length,a=0,s=[];++i<o;){var m=t[i];n(m,i,t)&&(s[a++]=m)}return s}},function(t,n,i){var o=i(32),a=i(92);t.exports=function copySymbolsIn(t,n){return o(t,a(t),n)}},function(t,n,i){var o=i(93),a=i(63),s=i(56);t.exports=function getAllKeys(t){return o(t,s,a)}},function(t,n,i){var o=i(23)(i(14),"DataView");t.exports=o},function(t,n,i){var o=i(23)(i(14),"Promise");t.exports=o},function(t,n,i){var o=i(23)(i(14),"WeakMap");t.exports=o},function(t,n){var i=Object.prototype.hasOwnProperty;t.exports=function initCloneArray(t){var n=t.length,o=new t.constructor(n);return n&&"string"==typeof t[0]&&i.call(t,"index")&&(o.index=t.index,o.input=t.input),o}},function(t,n,i){var o=i(67),a=i(179),s=i(180),m=i(181),g=i(182);t.exports=function initCloneByTag(t,n,i){var _=t.constructor;switch(n){case"[object ArrayBuffer]":return o(t);case"[object Boolean]":case"[object Date]":return new _(+t);case"[object DataView]":return a(t,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return g(t,i);case"[object Map]":return new _;case"[object Number]":case"[object String]":return new _(t);case"[object RegExp]":return s(t);case"[object Set]":return new _;case"[object Symbol]":return m(t)}}},function(t,n,i){var o=i(14).Uint8Array;t.exports=o},function(t,n,i){var o=i(67);t.exports=function cloneDataView(t,n){var i=n?o(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}},function(t,n){var i=/\w*$/;t.exports=function cloneRegExp(t){var n=new t.constructor(t.source,i.exec(t));return n.lastIndex=t.lastIndex,n}},function(t,n,i){var o=i(31),a=o?o.prototype:void 0,s=a?a.valueOf:void 0;t.exports=function cloneSymbol(t){return s?Object(s.call(t)):{}}},function(t,n,i){var o=i(67);t.exports=function cloneTypedArray(t,n){var i=n?o(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}},function(t,n,i){var o=i(184),a=i(65),s=i(60);t.exports=function initCloneObject(t){return"function"!=typeof t.constructor||s(t)?{}:o(a(t))}},function(t,n,i){var o=i(18),a=Object.create,s=function(){function object(){}return function(t){if(!o(t))return{};if(a)return a(t);object.prototype=t;var n=new object;return object.prototype=void 0,n}}();t.exports=s},function(t,n,i){var o=i(186),a=i(58),s=i(59),m=s&&s.isMap,g=m?a(m):o;t.exports=g},function(t,n,i){var o=i(66),a=i(19);t.exports=function baseIsMap(t){return a(t)&&"[object Map]"==o(t)}},function(t,n,i){var o=i(188),a=i(58),s=i(59),m=s&&s.isSet,g=m?a(m):o;t.exports=g},function(t,n,i){var o=i(66),a=i(19);t.exports=function baseIsSet(t){return a(t)&&"[object Set]"==o(t)}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TypedEmitter=i(190).EventEmitter},function(t,n,i){"use strict";var o,a="object"==typeof Reflect?Reflect:null,s=a&&"function"==typeof a.apply?a.apply:function ReflectApply(t,n,i){return Function.prototype.apply.call(t,n,i)};o=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t)};var m=Number.isNaN||function NumberIsNaN(t){return t!=t};function EventEmitter(){EventEmitter.init.call(this)}t.exports=EventEmitter,t.exports.once=function once(t,n){return new Promise((function(i,o){function errorListener(i){t.removeListener(n,resolver),o(i)}function resolver(){"function"==typeof t.removeListener&&t.removeListener("error",errorListener),i([].slice.call(arguments))}eventTargetAgnosticAddListener(t,n,resolver,{once:!0}),"error"!==n&&function addErrorHandlerIfEventEmitter(t,n,i){"function"==typeof t.on&&eventTargetAgnosticAddListener(t,"error",n,i)}(t,errorListener,{once:!0})}))},EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var g=10;function checkListener(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function _getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function _addListener(t,n,i,o){var a,s,m;if(checkListener(i),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",n,i.listener?i.listener:i),s=t._events),m=s[n]),void 0===m)m=s[n]=i,++t._eventsCount;else if("function"==typeof m?m=s[n]=o?[i,m]:[m,i]:o?m.unshift(i):m.push(i),(a=_getMaxListeners(t))>0&&m.length>a&&!m.warned){m.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=t,g.type=n,g.count=m.length,function ProcessEmitWarning(t){console&&console.warn&&console.warn(t)}(g)}return t}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(t,n,i){var o={fired:!1,wrapFn:void 0,target:t,type:n,listener:i},a=onceWrapper.bind(o);return a.listener=i,o.wrapFn=a,a}function _listeners(t,n,i){var o=t._events;if(void 0===o)return[];var a=o[n];return void 0===a?[]:"function"==typeof a?i?[a.listener||a]:[a]:i?function unwrapListeners(t){for(var n=new Array(t.length),i=0;i<n.length;++i)n[i]=t[i].listener||t[i];return n}(a):arrayClone(a,a.length)}function listenerCount(t){var n=this._events;if(void 0!==n){var i=n[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function arrayClone(t,n){for(var i=new Array(n),o=0;o<n;++o)i[o]=t[o];return i}function eventTargetAgnosticAddListener(t,n,i,o){if("function"==typeof t.on)o.once?t.once(n,i):t.on(n,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(n,(function wrapListener(a){o.once&&t.removeEventListener(n,wrapListener),i(a)}))}}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(t){if("number"!=typeof t||t<0||m(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");g=t}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(t){if("number"!=typeof t||t<0||m(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(t){for(var n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);var o="error"===t,a=this._events;if(void 0!==a)o=o&&void 0===a.error;else if(!o)return!1;if(o){var m;if(n.length>0&&(m=n[0]),m instanceof Error)throw m;var g=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw g.context=m,g}var _=a[t];if(void 0===_)return!1;if("function"==typeof _)s(_,this,n);else{var S=_.length,M=arrayClone(_,S);for(i=0;i<S;++i)s(M[i],this,n)}return!0},EventEmitter.prototype.addListener=function addListener(t,n){return _addListener(this,t,n,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(t,n){return _addListener(this,t,n,!0)},EventEmitter.prototype.once=function once(t,n){return checkListener(n),this.on(t,_onceWrap(this,t,n)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(t,n){return checkListener(n),this.prependListener(t,_onceWrap(this,t,n)),this},EventEmitter.prototype.removeListener=function removeListener(t,n){var i,o,a,s,m;if(checkListener(n),void 0===(o=this._events))return this;if(void 0===(i=o[t]))return this;if(i===n||i.listener===n)0==--this._eventsCount?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,i.listener||n));else if("function"!=typeof i){for(a=-1,s=i.length-1;s>=0;s--)if(i[s]===n||i[s].listener===n){m=i[s].listener,a=s;break}if(a<0)return this;0===a?i.shift():function spliceOne(t,n){for(;n+1<t.length;n++)t[n]=t[n+1];t.pop()}(i,a),1===i.length&&(o[t]=i[0]),void 0!==o.removeListener&&this.emit("removeListener",t,m||n)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var n,i,o;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var a,s=Object.keys(i);for(o=0;o<s.length;++o)"removeListener"!==(a=s[o])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=i[t]))this.removeListener(t,n);else if(void 0!==n)for(o=n.length-1;o>=0;o--)this.removeListener(t,n[o]);return this},EventEmitter.prototype.listeners=function listeners(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function rawListeners(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,n){return"function"==typeof t.listenerCount?t.listenerCount(n):listenerCount.call(t,n)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?o(this._events):[]}},function(n,i){n.exports=t},function(t,i){t.exports=n},function(t,n){t.exports=i},function(t,n){t.exports=o},function(t,n,i){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var n,i=1,o=arguments.length;i<o;i++)for(var a in n=arguments[i])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)},a=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},s=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}},m=this&&this.__read||function(t,n){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,a,s=i.call(t),m=[];try{for(;(void 0===n||n-- >0)&&!(o=s.next()).done;)m.push(o.value)}catch(t){a={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return m},g=this&&this.__spreadArray||function(t,n){for(var i=0,o=n.length,a=t.length;i<o;i++,a++)t[a]=n[i];return t},_=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.CatalogManager=void 0;var S=i(196),M=i(197),T=i(198),O=i(40),A=_(i(200)),P=i(33),L=i(70),R=i(221),N=function(){function CatalogManager(t){this.selectionState=new Map,this.initialized=!1,this.visualizer=t}return CatalogManager.prototype.init=function(t){var n,i,_,S,M,T,O;return a(this,void 0,void 0,(function(){var A,P,L,N,I,j,V,U,G,z,H=this;return s(this,(function(q){switch(q.label){case 0:return A=this.visualizer.sceneMetadataManager.getApiEndpoint(),P=this.visualizer.sceneMetadataManager.getApiToken(),this.showroomClient=R.getShowroomClient(A,P),(L=this.visualizer.sceneMetadataManager.getCatalogProps(t))?(this.catalogInfo={organization:L.organization,catalog:L.catalog},[4,Promise.all([this.loadProductPage({page:1,perPage:50}),this.loadAssetsCollectionId(),this.loadCatalogs()])]):[2,void 0];case 1:return N=m.apply(void 0,[q.sent(),3]),I=N[0],j=N[1],V=N[2],this.catalog=V,U=I.pageInfo.pageCount,z=[g([],m(I.items))],[4,Promise.all(Array(U-1).fill(0).map((function(t,n){return a(H,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.loadProductPage({page:n+2,perPage:50,fetchPolicy:"no-cache"})];case 1:return[2,t.sent().items]}}))}))})))];case 2:return G=g.apply(void 0,z.concat([m.apply(void 0,[q.sent().flat()])])),this.assetProducts=G.filter((function(t){var n;return(null===(n=t.productCollection)||void 0===n?void 0:n._id)===j})),this.sceneFilters={},this.products=this.getProductsFromDate(this.getProductsMathchingCustomFields(G,null===(_=null===(i=null===(n=this.visualizer.getCurrentSceneConfiguration())||void 0===n?void 0:n.catalogFilters)||void 0===i?void 0:i.products)||void 0===_?void 0:_.customFields),null===(O=null===(T=null===(M=null===(S=this.visualizer.getCurrentSceneConfiguration())||void 0===S?void 0:S.catalogFilters)||void 0===M?void 0:M.products)||void 0===T?void 0:T.fromDate)||void 0===O?void 0:O.customFieldName).map((function(t){return o(o({},t),{sku:t.sku||t.byond_id})})).sort((function(t,n){var i=t.title.toUpperCase(),o=n.title.toUpperCase();return i<o?-1:i>o?1:0})),this.initialized=!0,[2]}}))}))},CatalogManager.prototype.setProductsList=function(t){this.productsList=t},CatalogManager.prototype.getProducts=function(){var t,n=this,i=this.products;return this.productsList&&(i=null===(t=this.products)||void 0===t?void 0:t.filter((function(t){var i;return null===(i=n.productsList)||void 0===i?void 0:i.includes(t.sku)}))),i},CatalogManager.prototype.getProduct=function(t,n){var i;return null===(i=this.getProducts())||void 0===i?void 0:i.find((function(i){var o,a;return i.sku===t&&((null===(a=null===(o=i.customFields)||void 0===o?void 0:o.find((function(t){return t.name===P.Constants.APPLICATION})))||void 0===a?void 0:a.value)||[]).includes(n)}))},CatalogManager.prototype.getAllFormatedProducts=function(){var t,n=this;return null===(t=this.getProducts())||void 0===t?void 0:t.map((function(t){return O.formatProduct(t,n.visualizer.getCurrentCatalogFieldsMap())}))},CatalogManager.prototype.getProductList=function(t){var n,i,o,a,s=this,m=this.selectionState.get(t),g=this.products;this.productsList&&(g=null===(n=this.products)||void 0===n?void 0:n.filter((function(t){var n;return null===(n=s.productsList)||void 0===n?void 0:n.includes(t.sku)})));var _=(null==m?void 0:m.application)?null==g?void 0:g.filter((function(t){var n,i,o=O.getApplicationsFromCustomFields(t);return!!(null===(n=m.application)||void 0===n?void 0:n.application)&&o.includes(null===(i=m.application)||void 0===i?void 0:i.application)})):this.getProducts(),S=_,M=null===(i=null==m?void 0:m.application)||void 0===i?void 0:i.application;if(M){var T=null===(o=null==m?void 0:m.filters)||void 0===o?void 0:o[M];T&&_&&(S=this.getProductsMathchingCustomFields(_,T));var A=null===(a=null==m?void 0:m.searchFilters)||void 0===a?void 0:a[M];A&&S&&(S=this.getProductsMathchingSearch(S,A))}var P=S&&S.map((function(t){return O.formatProduct(t,s.visualizer.getCurrentCatalogFieldsMap())}));return null==P||P.forEach((function(t){t.applications=s.getApplicationsForProduct(t.sku)})),P},CatalogManager.prototype.getProductListByProductFavorites=function(t){var n=this;if(this.initialized){var i={};t.forEach((function(t){var n,o=null!==(n=i[t.product.application])&&void 0!==n?n:[];o.push(t.product.sku),i[t.product.application]=o}));var o=[];return Object.entries(i).forEach((function(t){var i,a=m(t,2),s=a[0],_=a[1],S=null===(i=n.getProducts())||void 0===i?void 0:i.filter((function(t){var n,i;return((null===(i=null===(n=t.customFields)||void 0===n?void 0:n.find((function(t){return t.name===P.Constants.APPLICATION})))||void 0===i?void 0:i.value)||[]).includes(s)}));o=g(g([],m(o)),m((null!=S?S:[]).filter((function(t){return _.includes(t.sku)}))))})),o.map((function(t){return O.formatProduct(t,n.visualizer.getCurrentCatalogFieldsMap())})).map((function(t){return{product:t}}))}},CatalogManager.prototype.getProductsMathchingCustomFields=function(t,n,i){if(void 0===n&&(n=[]),i&&(i=i.trim().toLowerCase()),!(null==n?void 0:n.flatMap((function(t){return null==t?void 0:t.options})).length))return t;var o=n.filter((function(t){var n;return null===(n=t.options)||void 0===n?void 0:n.length}));return t.filter((function(t){return o[i?"some":"every"]((function(n){var o=n.options||[];if(n.customFieldName){var a=O.getCustomField(t,n.customFieldName);return Array.isArray(a)||(a=[a]),i?"not"===n.operator?a.every((function(t){return!(null==t?void 0:t.toLowerCase().includes(i))})):a.some((function(t){return null==t?void 0:t.toLowerCase().includes(i)})):"not"===n.operator?a.every((function(t){return!o.includes(t)})):a.some((function(t){return o.includes(t)}))}}))}))},CatalogManager.prototype.getProductsMathchingSearch=function(t,n){var i,o=this.visualizer.getFilters();n=n.trim().toLowerCase();var a,s=null===(i=this.visualizer.getCurrentSceneConfiguration().products)||void 0===i?void 0:i.search.fields,m=!0,g=!0,_=!0;return s&&(m=s.title.included,g=s.sku.included,_=s.filters.values.included),_&&(a=this.getProductsMathchingCustomFields(t,o,n)),t.filter((function(t){return m&&t.title.toLowerCase().includes(n)||g&&t.sku.toLowerCase().includes(n)||_&&(null==a?void 0:a.find((function(n){return n._id===t._id})))}))},CatalogManager.prototype.getProductsFromDate=function(t,n){return n?t.filter((function(t){var i=O.getCustomField(t,n);return!i||new Date(i)>new Date})):t},CatalogManager.prototype.getFullProductDetails=function(t){var n,i;return a(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return o=M.PRODUCT_FIND_ONE,[4,null===(n=this.showroomClient)||void 0===n?void 0:n.query({query:o,variables:{filter:{organization:null===(i=this.catalogInfo)||void 0===i?void 0:i.organization,_id:t}}})];case 1:return[2,null==(a=s.sent())?void 0:a.data.productFindOne]}}))}))},CatalogManager.prototype.getApplicationsForProduct=function(t){var n,i=[];return null===(n=this.getProducts())||void 0===n||n.filter((function(n){return n.sku===t})).forEach((function(t){i=g(g([],m(i)),m(O.getApplicationsFromCustomFields(t)))})),i=g([],m(new Set(i)))},CatalogManager.prototype.getOriginalProductListForApplication=function(t){var n;return null===(n=this.getProducts())||void 0===n?void 0:n.filter((function(n){return O.getApplicationsFromCustomFields(n).includes(t)}))},CatalogManager.prototype.getProductListByApplication=function(t){var n=this,i=this.getOriginalProductListForApplication(t.application);return null==i?void 0:i.map((function(t){return O.formatProduct(t,n.visualizer.getCurrentCatalogFieldsMap())}))},CatalogManager.prototype.getCatalogsApplications=function(){var t=this;return O.getApplicationsFromCustomFields(this.catalog).map((function(n){return t.getApplicationConfiguration(n)}))},CatalogManager.prototype.getApplication=function(t){return this.getApplicationConfiguration(t)},CatalogManager.prototype.getApplicationAsset=function(t){var n;return null===(n=this.assetProducts)||void 0===n?void 0:n.find((function(n){var i;return!!(null===(i=n.customFields)||void 0===i?void 0:i.find((function(n){return n.name===P.Constants.APPLICATION&&n.value.includes(t)})))}))},CatalogManager.prototype.getApplicationPreviewImage=function(t){var n=this.getApplicationAsset(t);return n?O.GetFrontMediaUrl(n):P.Constants.APPLICATION_DEFAULT_IMAGE},CatalogManager.prototype.getApplicationConfiguration=function(t){var n,i,o,a=this.getApplicationAsset(t),s=null===(i=null===(n=this.visualizer.getCurrentSceneConfiguration())||void 0===n?void 0:n.applications)||void 0===i?void 0:i.find((function(t){return t.application===(null==a?void 0:a.title)}));return{application:t,title:null!==(o=(null==s?void 0:s.title)||(null==a?void 0:a.title))&&void 0!==o?o:"",image:(null==s?void 0:s.image)||this.getApplicationPreviewImage(t),buttons:null==s?void 0:s.buttons,fields:null==s?void 0:s.fields}},CatalogManager.prototype.getApplicationRenderOrder=function(t){var n,i,o=this.getApplicationAsset(t);return P.Constants.DefaultRenderOrder+(+(null===(i=null===(n=null==o?void 0:o.customFields)||void 0===n?void 0:n.find((function(t){return t.name===P.Constants.RenderOrder})))||void 0===i?void 0:i.value)||0)},CatalogManager.prototype.getFilters=function(t){var n,i,a,s,m=this,g=this.selectionState.get(t),_=null===(n=null==g?void 0:g.application)||void 0===n?void 0:n.application;if(!_)return[];var S=null===(a=null===(i=this.sceneFilters)||void 0===i?void 0:i[t])||void 0===a?void 0:a[_];if(S)return S;var M=null===(s=this.visualizer.getCurrentCatalogFieldsMap())||void 0===s?void 0:s.facets,T=new Map,O=this.getOriginalProductListForApplication(_);if(!O)return[];O.forEach((function(t){var n;null===(n=t.customFields)||void 0===n||n.forEach((function(t){var n,i;if(t.name){var o=null===(i=null===(n=m.catalog)||void 0===n?void 0:n.customFields)||void 0===i?void 0:i.find((function(n){return n.name===t.name}));if(!t.name.startsWith("$$")&&!(null==o?void 0:o.hidden)&&(!M||(null==M?void 0:M.includes(t.name)))){var a=T.get(t.name),s=(null==a?void 0:a.options)||[];t.type===P.Constants.CustomFieldsTagsType&&T.set(t.name,{name:t.name,options:A.default(s,t.value)}),t.type===P.Constants.CustomFieldsTextType&&T.set(t.name,{name:t.name,options:A.default(s,[t.value])})}}}))}));var L=[];M?M.forEach((function(t){var n=T.get(t);n&&L.push(n)})):L=Array.from(T.values());var R=[];return L.forEach((function(t){var n,i=null===(n=t.options)||void 0===n?void 0:n.sort();i&&R.push(o(o({},t),{options:i}))})),this.updateFilters(t,_,R)},CatalogManager.prototype.loadCatalogs=function(){var t,n,i,o;return a(this,void 0,void 0,(function(){var a,m;return s(this,(function(s){switch(s.label){case 0:return a=T.LOAD_CATALOG,[4,null===(t=this.showroomClient)||void 0===t?void 0:t.query({query:a,variables:{filter:{organization:null===(n=this.catalogInfo)||void 0===n?void 0:n.organization,_id:null===(i=this.catalogInfo)||void 0===i?void 0:i.catalog}}})];case 1:return m=s.sent(),[2,null===(o=null==m?void 0:m.data)||void 0===o?void 0:o.catalogFindOne]}}))}))},CatalogManager.prototype.loadProductPage=function(t){var n,i,o,m=t.fetchPolicy,g=void 0===m?"cache-first":m,_=t.page,S=t.perPage;return a(this,void 0,void 0,(function(){var t,a;return s(this,(function(s){switch(s.label){case 0:return t=M.PRODUCT_FIND_MANY_PAGE,[4,null===(n=this.showroomClient)||void 0===n?void 0:n.query({query:t,variables:{filter:{organization:null===(i=this.catalogInfo)||void 0===i?void 0:i.organization,catalog:null===(o=this.catalogInfo)||void 0===o?void 0:o.catalog},page:_,perPage:S},fetchPolicy:g})];case 1:return[2,null==(a=s.sent())?void 0:a.data.productFindManyPage]}}))}))},CatalogManager.prototype.loadAssetsCollectionId=function(){var t,n,i;return a(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:return o=S.LOAD_COLLECTION_LIST_PAGE,[4,null===(t=this.showroomClient)||void 0===t?void 0:t.query({query:o,variables:{filter:{organization:null===(n=this.catalogInfo)||void 0===n?void 0:n.organization,catalog:null===(i=this.catalogInfo)||void 0===i?void 0:i.catalog,name:"assets"},page:1,perPage:1}})];case 1:return[2,null==(a=s.sent())?void 0:a.data.collectionFindManyPage.items[0]._id]}}))}))},CatalogManager.prototype.updateFilters=function(t,n,i){var o=this;if(void 0===i)return[];if(i=i.map((function(t){return L.formatFilter(t,o.visualizer.getCurrentSceneConfiguration().fieldsAliases)})),this.sceneFilters){var a=this.sceneFilters[t];a||(a={}),a[n]=i,this.sceneFilters[t]=a}return i},CatalogManager}();n.CatalogManager=N},function(t,n,i){"use strict";var o=this&&this.__makeTemplateObject||function(t,n){return Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,t},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.LOAD_COLLECTION_LIST_PAGE=void 0;var s,m=a(i(15));n.LOAD_COLLECTION_LIST_PAGE=m.default(s||(s=o(["\n    query collectionList($page: Int, $perPage: Int, $filter: FilterFindManycollectionInput) {\n        collectionFindManyPage(page: $page, perPage: $perPage, filter: $filter) {\n            count\n            items {\n                _id\n                name\n            }\n            pageInfo {\n                currentPage\n                perPage\n                pageCount\n                hasNextPage\n                hasPreviousPage\n            }\n        }\n    }\n"],["\n    query collectionList($page: Int, $perPage: Int, $filter: FilterFindManycollectionInput) {\n        collectionFindManyPage(page: $page, perPage: $perPage, filter: $filter) {\n            count\n            items {\n                _id\n                name\n            }\n            pageInfo {\n                currentPage\n                perPage\n                pageCount\n                hasNextPage\n                hasPreviousPage\n            }\n        }\n    }\n"])))},function(t,n,i){"use strict";var o=this&&this.__makeTemplateObject||function(t,n){return Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,t},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.PRODUCT_FIND_MANY_PAGE=n.PRODUCT_FIND_ONE=void 0;var s,m,g=a(i(15)),_=i(96);n.PRODUCT_FIND_ONE=g.default(s||(s=o(["\n    query productFindOne($filter: FilterFindOneproductInput) {\n        productFindOne(filter: $filter) {\n            ...productWithAllMediaFragment\n        }\n    }\n    ","\n"],["\n    query productFindOne($filter: FilterFindOneproductInput) {\n        productFindOne(filter: $filter) {\n            ...productWithAllMediaFragment\n        }\n    }\n    ","\n"])),_.productWithAllMediaFragment),n.PRODUCT_FIND_MANY_PAGE=g.default(m||(m=o(["\n    query productFindManyPage($page: Int, $perPage: Int, $customFilter: String, $filter: FilterFindManyproductInput) {\n        productFindManyPage(page: $page, perPage: $perPage, customFilter: $customFilter, filter: $filter) {\n            count\n            items {\n                ...productFragment\n            }\n            pageInfo {\n                currentPage\n                perPage\n                pageCount\n                hasNextPage\n                hasPreviousPage\n            }\n        }\n    }\n    ","\n"],["\n    query productFindManyPage($page: Int, $perPage: Int, $customFilter: String, $filter: FilterFindManyproductInput) {\n        productFindManyPage(page: $page, perPage: $perPage, customFilter: $customFilter, filter: $filter) {\n            count\n            items {\n                ...productFragment\n            }\n            pageInfo {\n                currentPage\n                perPage\n                pageCount\n                hasNextPage\n                hasPreviousPage\n            }\n        }\n    }\n    ","\n"])),_.productFragment)},function(t,n,i){"use strict";var o=this&&this.__makeTemplateObject||function(t,n){return Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,t},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.LOAD_CATALOG=n.catalogFragment=void 0;var s,m,g=a(i(15)),_=i(96);n.catalogFragment=g.default(s||(s=o(["\n    fragment catalogFragment on Catalog {\n        _id\n        organization {\n            _id\n        }\n        name\n        subtitle\n        description\n        tags\n        cover {\n            ...mediaFragment\n        }\n        sizes {\n            type\n            value\n        }\n        colors {\n            ...colorFragment\n        }\n        customFields {\n            type\n            name\n            value\n            hidden\n        }\n        customMediaFields {\n            type\n            name\n            value {\n                _id\n                ...mediaFragment\n            }\n        }\n        status {\n            archived\n        }\n        currency\n        createdAt\n        updatedAt\n    }\n    ","\n    ","\n"],["\n    fragment catalogFragment on Catalog {\n        _id\n        organization {\n            _id\n        }\n        name\n        subtitle\n        description\n        tags\n        cover {\n            ...mediaFragment\n        }\n        sizes {\n            type\n            value\n        }\n        colors {\n            ...colorFragment\n        }\n        customFields {\n            type\n            name\n            value\n            hidden\n        }\n        customMediaFields {\n            type\n            name\n            value {\n                _id\n                ...mediaFragment\n            }\n        }\n        status {\n            archived\n        }\n        currency\n        createdAt\n        updatedAt\n    }\n    ","\n    ","\n"])),_.mediaFragment,_.colorFragment),n.LOAD_CATALOG=g.default(m||(m=o(["\n    query loadCatalog($filter: FilterFindOneCatalogInput) {\n        catalogFindOne(filter: $filter) {\n            ...catalogFragment\n        }\n    }\n    ","\n"],["\n    query loadCatalog($filter: FilterFindOneCatalogInput) {\n        catalogFindOne(filter: $filter) {\n            ...catalogFragment\n        }\n    }\n    ","\n"])),n.catalogFragment)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GlobalConfig=void 0;n.GlobalConfig={defaultFieldsMap:{description:"description",title:"title"}}},function(t,n,i){var o=i(97),a=i(202),s=i(207),m=i(220),g=a((function(t){return s(o(t,1,m,!0))}));t.exports=g},function(t,n,i){var o=i(31),a=i(86),s=i(24),m=o?o.isConcatSpreadable:void 0;t.exports=function isFlattenable(t){return s(t)||a(t)||!!(m&&t&&t[m])}},function(t,n,i){var o=i(98),a=i(99),s=i(100);t.exports=function baseRest(t,n){return s(a(t,n,o),t+"")}},function(t,n){t.exports=function apply(t,n,i){switch(i.length){case 0:return t.call(n);case 1:return t.call(n,i[0]);case 2:return t.call(n,i[0],i[1]);case 3:return t.call(n,i[0],i[1],i[2])}return t.apply(n,i)}},function(t,n,i){var o=i(205),a=i(84),s=i(98),m=a?function(t,n){return a(t,"toString",{configurable:!0,enumerable:!1,value:o(n),writable:!0})}:s;t.exports=m},function(t,n){t.exports=function constant(t){return function(){return t}}},function(t,n){var i=Date.now;t.exports=function shortOut(t){var n=0,o=0;return function(){var a=i(),s=16-(a-o);if(o=a,s>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(void 0,arguments)}}},function(t,n,i){var o=i(208),a=i(211),s=i(216),m=i(217),g=i(218),_=i(101);t.exports=function baseUniq(t,n,i){var S=-1,M=a,T=t.length,O=!0,A=[],P=A;if(i)O=!1,M=s;else if(T>=200){var L=n?null:g(t);if(L)return _(L);O=!1,M=m,P=new o}else P=n?[]:A;e:for(;++S<T;){var R=t[S],N=n?n(R):R;if(R=i||0!==R?R:0,O&&N==N){for(var I=P.length;I--;)if(P[I]===N)continue e;n&&P.push(N),A.push(R)}else M(P,N,i)||(P!==A&&P.push(N),A.push(R))}return A}},function(t,n,i){var o=i(54),a=i(209),s=i(210);function SetCache(t){var n=-1,i=null==t?0:t.length;for(this.__data__=new o;++n<i;)this.add(t[n])}SetCache.prototype.add=SetCache.prototype.push=a,SetCache.prototype.has=s,t.exports=SetCache},function(t,n){t.exports=function setCacheAdd(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this}},function(t,n){t.exports=function setCacheHas(t){return this.__data__.has(t)}},function(t,n,i){var o=i(212);t.exports=function arrayIncludes(t,n){return!!(null==t?0:t.length)&&o(t,n,0)>-1}},function(t,n,i){var o=i(213),a=i(214),s=i(215);t.exports=function baseIndexOf(t,n,i){return n==n?s(t,n,i):o(t,a,i)}},function(t,n){t.exports=function baseFindIndex(t,n,i,o){for(var a=t.length,s=i+(o?1:-1);o?s--:++s<a;)if(n(t[s],s,t))return s;return-1}},function(t,n){t.exports=function baseIsNaN(t){return t!=t}},function(t,n){t.exports=function strictIndexOf(t,n,i){for(var o=i-1,a=t.length;++o<a;)if(t[o]===n)return o;return-1}},function(t,n){t.exports=function arrayIncludesWith(t,n,i){for(var o=-1,a=null==t?0:t.length;++o<a;)if(i(n,t[o]))return!0;return!1}},function(t,n){t.exports=function cacheHas(t,n){return t.has(n)}},function(t,n,i){var o=i(95),a=i(219),s=i(101),m=o&&1/s(new o([,-0]))[1]==1/0?function(t){return new o(t)}:a;t.exports=m},function(t,n){t.exports=function noop(){}},function(t,n,i){var o=i(61),a=i(19);t.exports=function isArrayLikeObject(t){return a(t)&&o(t)}},function(t,n,i){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var n,i=1,o=arguments.length;i<o;i++)for(var a in n=arguments[i])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)},a=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},s=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.getShowroomClient=void 0;var m=i(268),g=i(5),_=i(269),S=i(223),M=i(224),T=i(225),O=i(72),A=new m.ApolloLink((function(t,n){return n(t).map((function(t){try{t.data=T.uncrunch(t.data)}catch(t){}return t}))})),P=new m.InMemoryCache({dataIdFromObject:function(t){return t.byond_id||t.elementId||m.defaultDataIdFromObject(t)}}),authLink=function(t){return S.setContext((function(n,i){var m=i.headers;return a(void 0,void 0,void 0,(function(){var n;return s(this,(function(i){try{(n=sessionStorage.getItem("shareToken"))||(n=t)}catch(t){}return[2,{headers:o(o({},m),{Authorization:n})}]}))}))}))},L=new _.RetryLink({attempts:{max:2,retryIf:function(t,n){var i,o="query"===(null===(i=g.getMainDefinition(n.query))||void 0===i?void 0:i.operation);return o&&console.warn("retry due to apollo error",n,t),!!o}}}),R=M.onError((function(t){var n=t.graphQLErrors,i=t.networkError;n&&n.forEach((function(t){var n=t.message,i=t.locations,o=t.path,a=t.extensions;console.log("[GraphQL error]: Message: "+n+", Location: "+i+", Path: "+o+", Extensions: "+JSON.stringify(a))})),i&&console.log("[Network error]: "+i)})),N=new m.ApolloLink((function(t,n){var i=g.getMainDefinition(t.query);return i&&"mutation"===i.operation&&(t.variables=O.omitDeep(t.variables,["__typename"])),n?n(t):null}));n.getShowroomClient=function(t,n){return function(t,n){return new m.ApolloClient({cache:P,link:m.concat(A,m.ApolloLink.from([L,R,authLink(n),N,(i=t,m.createHttpLink({uri:i}))]))});var i}(t,n)}},function(t,n){var i,o,a=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(i===setTimeout)return setTimeout(t,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(n){try{return i.call(null,t,0)}catch(n){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){i=defaultSetTimout}try{o="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){o=defaultClearTimeout}}();var s,m=[],g=!1,_=-1;function cleanUpNextTick(){g&&s&&(g=!1,s.length?m=s.concat(m):_=-1,m.length&&drainQueue())}function drainQueue(){if(!g){var t=runTimeout(cleanUpNextTick);g=!0;for(var n=m.length;n;){for(s=m,m=[];++_<n;)s&&s[_].run();_=-1,n=m.length}s=null,g=!1,function runClearTimeout(t){if(o===clearTimeout)return clearTimeout(t);if((o===defaultClearTimeout||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{return o(t)}catch(n){try{return o.call(null,t)}catch(n){return o.call(this,t)}}}(t)}}function Item(t,n){this.fun=t,this.array=n}function noop(){}a.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)n[i-1]=arguments[i];m.push(new Item(t,n)),1!==m.length||g||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=noop,a.addListener=noop,a.once=noop,a.off=noop,a.removeListener=noop,a.removeAllListeners=noop,a.emit=noop,a.prependListener=noop,a.prependOnceListener=noop,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,n,i){"use strict";i.r(n),i.d(n,"setContext",(function(){return setContext}));var o=i(0),a=i(9),s=i(30);function setContext(t){return new a.a((function(n,i){var a=Object(o.e)(n,[]);return new s.a((function(o){var s,m=!1;return Promise.resolve(a).then((function(i){return t(i,n.getContext())})).then(n.setContext).then((function(){m||(s=i(n).subscribe({next:o.next.bind(o),error:o.error.bind(o),complete:o.complete.bind(o)}))})).catch(o.error.bind(o)),function(){m=!0,s&&s.unsubscribe()}}))}))}},function(t,n,i){"use strict";i.r(n),i.d(n,"onError",(function(){return onError})),i.d(n,"ErrorLink",(function(){return m}));var o=i(0),a=i(9),s=i(30);function onError(t){return new a.a((function(n,i){return new s.a((function(o){var a,s,m;try{a=i(n).subscribe({next:function(a){a.errors&&(m=t({graphQLErrors:a.errors,response:a,operation:n,forward:i}))?s=m.subscribe({next:o.next.bind(o),error:o.error.bind(o),complete:o.complete.bind(o)}):o.next(a)},error:function(a){(m=t({operation:n,networkError:a,graphQLErrors:a&&a.result&&a.result.errors,forward:i}))?s=m.subscribe({next:o.next.bind(o),error:o.error.bind(o),complete:o.complete.bind(o)}):o.error(a)},complete:function(){m||o.complete.bind(o)()}})}catch(a){t({networkError:a,operation:n,forward:i}),o.error(a)}return function(){a&&a.unsubscribe(),s&&a.unsubscribe()}}))}))}var m=function(t){function ErrorLink(n){var i=t.call(this)||this;return i.link=onError(n),i}return Object(o.c)(ErrorLink,t),ErrorLink.prototype.request=function(t,n){return this.link.request(t,n)},ErrorLink}(a.a)},function(t,n,i){const o=[{crunch:i(226),uncrunch:i(231)},{crunch:i(232),uncrunch:i(233)}];t.exports={crunch:(t,n=1)=>1===n||n>o.length?o[0].crunch(t):{version:n,crunched:o[n-1].crunch(t)},uncrunch:t=>null==t.version?o[0].uncrunch(t):o[t.version-1].uncrunch(t.crunched)}},function(t,n,i){const{isContainer:o,map:a,CountedOrderedSet:s}=i(41);t.exports=function crunch(t){const n=s();return function flatten(t,n){const i=o(t)?a(t,t=>flatten(t,n)):t;return n.add(i)}(t,n),n.values}},function(t,n){t.exports={isReference:t=>Number.isInteger(t)&&t%2==0,encode:function encode(t,{reference:n}={reference:!1}){return!1===Number.isInteger(t)?t:!0===n?2*t:2*t+1},decode:function decode(t){return!1===Number.isInteger(t)?t:t%2==0?t/2:(t-1)/2}}},function(t,n,i){const{hash:o}=i(229),{eq:a}=i(230);t.exports={CountedOrderedSet:function CountedOrderedSet(){const t={},n=[],i=[];return{add:s=>{const m=o(s);if(!(m in t))return t[m]=[[s,n.length]],n.push(s),i.push(1),n.length-1;const g=t[m].find(t=>a(t[0],s));if(null!=g){const t=g[1];return i[t]+=1,t}return t[m].push([s,n.length]),n.push(s),i.push(1),n.length-1},values:n,counts:i}}}},function(t,n,i){const{isArray:o,isObject:a}=i(71),s=Math.pow(2,32);function intHash(t){return t^=t<<13,t^=t>>17,(t^=t<<5)+2147483648}t.exports={hash:function hash(t){if(null===t)return 2524388480;if(!0===t)return 1224992787;if(!1===t)return 875810931;if("number"==typeof t)return intHash(t);let n=0;if("string"==typeof t){const i=Math.min(t.length,256);for(let o=0;o<i;o++)n+=intHash(o)^intHash(t.charCodeAt(o))}else if(o(t))for(let i=0;i<t.length;i++)n+=intHash(i)^hash(t[i]);else for(const i in t)n+=hash(i)^hash(t[i]);return n%s}}},function(t,n,i){const{isArray:o,isObject:a}=i(71);function eq(t,n){return o(t)&&o(n)?function arrayEq(t,n){if(t.length!=n.length)return!1;for(let i=0;i<t.length;i++)if(!eq(t[i],n[i]))return!1;return!0}(t,n):a(t)&&a(n)?function objectEq(t,n){for(let i in t)if(!(i in n))return!1;for(let i in n)if(!(i in t))return!1;for(let i in t)if(!eq(t[i],n[i]))return!1;return!0}(t,n):t===n}t.exports={eq}},function(t,n,i){const{isContainer:o,map:a}=i(41);t.exports=function uncrunch(t){const n=[],lookup=t=>n[t];n.length=t.length;for(let i=0;i<t.length;i++){const s=t[i];n[i]=o(s)?a(s,lookup):s}return n[n.length-1]}},function(t,n,i){const{isContainer:o,isReference:a,map:s,forEach:m,encode:g,decode:_,CountedOrderedSet:S}=i(41);t.exports=function crunch(t){if(!o(t))return[g(t)];const n=S();return function flatten(t,n){if(!o(t))return g(t);const i=s(t,t=>flatten(t,n)),a=n.add(i);return g(a,{reference:!0})}(t,n),function compact({values:t,counts:n}){m(t,i=>m(i,(o,s)=>{const m=_(o);!a(o)||n[m]>1||(i[s]=t[m],t[m]=0)}))}(n),n.values}},function(t,n,i){const{isContainer:o,isReference:a,map:s,decode:m}=i(41);function expand(t,n){return a(t)?n[m(t)]:o(t)?s(t,t=>expand(t,n)):m(t)}t.exports=function uncrunch(t){const n=[];n.length=t.length;for(let i=0;i<t.length;i++)n[i]=expand(t[i],n);return n[n.length-1]}},function(t,n,i){var o=i(235);t.exports=function set(t,n,i){return null==t?t:o(t,n,i)}},function(t,n,i){var o=i(55),a=i(42),s=i(88),m=i(18),g=i(73);t.exports=function baseSet(t,n,i,_){if(!m(t))return t;for(var S=-1,M=(n=a(n,t)).length,T=M-1,O=t;null!=O&&++S<M;){var A=g(n[S]),P=i;if("__proto__"===A||"constructor"===A||"prototype"===A)return t;if(S!=T){var L=O[A];void 0===(P=_?_(L,A,O):void 0)&&(P=m(L)?L:s(n[S+1])?[]:{})}o(O,A,P),O=O[A]}return t}},function(t,n,i){var o=i(24),a=i(43),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,m=/^\w*$/;t.exports=function isKey(t,n){if(o(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!a(t))||(m.test(t)||!s.test(t)||null!=n&&t in Object(n))}},function(t,n,i){var o=i(238),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s=/\\(\\)?/g,m=o((function(t){var n=[];return 46===t.charCodeAt(0)&&n.push(""),t.replace(a,(function(t,i,o,a){n.push(o?a.replace(s,"$1"):i||t)})),n}));t.exports=m},function(t,n,i){var o=i(239);t.exports=function memoizeCapped(t){var n=o(t,(function(t){return 500===i.size&&i.clear(),t})),i=n.cache;return n}},function(t,n,i){var o=i(54);function memoize(t,n){if("function"!=typeof t||null!=n&&"function"!=typeof n)throw new TypeError("Expected a function");var memoized=function(){var i=arguments,o=n?n.apply(this,i):i[0],a=memoized.cache;if(a.has(o))return a.get(o);var s=t.apply(this,i);return memoized.cache=a.set(o,s)||a,s};return memoized.cache=new(memoize.Cache||o),memoized}memoize.Cache=o,t.exports=memoize},function(t,n,i){var o=i(241);t.exports=function toString(t){return null==t?"":o(t)}},function(t,n,i){var o=i(31),a=i(112),s=i(24),m=i(43),g=o?o.prototype:void 0,_=g?g.toString:void 0;t.exports=function baseToString(t){if("string"==typeof t)return t;if(s(t))return a(t,baseToString)+"";if(m(t))return _?_.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},function(t,n){t.exports=function isNil(t){return null==t}},function(t,n,i){var o=i(112),a=i(78),s=i(244),m=i(42),g=i(32),_=i(248),S=i(250),M=i(94),T=S((function(t,n){var i={};if(null==t)return i;var S=!1;n=o(n,(function(n){return n=m(n,t),S||(S=n.length>1),n})),g(t,M(t),i),S&&(i=a(i,7,_));for(var T=n.length;T--;)s(i,n[T]);return i}));t.exports=T},function(t,n,i){var o=i(42),a=i(245),s=i(246),m=i(73);t.exports=function baseUnset(t,n){return n=o(n,t),null==(t=s(t,n))||delete t[m(a(n))]}},function(t,n){t.exports=function last(t){var n=null==t?0:t.length;return n?t[n-1]:void 0}},function(t,n,i){var o=i(114),a=i(247);t.exports=function parent(t,n){return n.length<2?t:o(t,a(n,0,-1))}},function(t,n){t.exports=function baseSlice(t,n,i){var o=-1,a=t.length;n<0&&(n=-n>a?0:a+n),(i=i>a?a:i)<0&&(i+=a),a=n>i?0:i-n>>>0,n>>>=0;for(var s=Array(a);++o<a;)s[o]=t[o+n];return s}},function(t,n,i){var o=i(249);t.exports=function customOmitClone(t){return o(t)?void 0:t}},function(t,n,i){var o=i(26),a=i(65),s=i(19),m=Function.prototype,g=Object.prototype,_=m.toString,S=g.hasOwnProperty,M=_.call(Object);t.exports=function isPlainObject(t){if(!s(t)||"[object Object]"!=o(t))return!1;var n=a(t);if(null===n)return!0;var i=S.call(n,"constructor")&&n.constructor;return"function"==typeof i&&i instanceof i&&_.call(i)==M}},function(t,n,i){var o=i(251),a=i(99),s=i(100);t.exports=function flatRest(t){return s(a(t,void 0,o),t+"")}},function(t,n,i){var o=i(97);t.exports=function flatten(t){return(null==t?0:t.length)?o(t,1):[]}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ProductsManager=void 0;var s=i(118),m=i(33),g=i(253),_=i(115),S=i(40),M=i(254),T=function(){function ProductsManager(t){var n=this;this.displayedProductsMap=new Map,this.favoriteProducts=[],this.externalFavoriteProducts=void 0,this.favoriteSets=[],this.userDisplayedProducts={},this.cart=new Array,this.listenOnceForSceneLoaded=function(){if(n.externalFavoriteProducts){var t=n.visualizer.catalogManager.getProductListByProductFavorites(n.externalFavoriteProducts);t&&(n.favoriteProducts=t,n.visualizer.emit("productAddedToFavorites",{favorites:n.favoriteProducts})),n.externalFavoriteProducts=void 0}n.visualizer.removeListener("sceneLoaded",n.listenOnceForSceneLoaded)},this.visualizer=t}return ProductsManager.prototype.setFavoriteSets=function(t){if(Array.isArray(t)&&t.length<1)console.info("Visualizer - In setFavoriteSets: input array is empty");else{var n=M.iFavoriteSceneListSchema.safeParse(t);!1!==n.success?(this.favoriteSets=n.data,this.visualizer.emit("sceneAddedToFavorites",{favoriteScenes:this.favoriteSets})):console.warn("Visualizer - In setFavoriteSets: input value is not valid ; ","errors:",n.error)}},ProductsManager.prototype.setFavoriteProducts=function(t){if(Array.isArray(t)&&t.length<1)console.info("Visualizer - In setFavoriteSets: input array is empty");else{var n=M.iFavoriteProductSkuAndApplicationListSchema.safeParse(t),i=M.iFavoriteProductListSchema.safeParse(t);if(!0===n.success){var o=this.visualizer.catalogManager.getProductListByProductFavorites(n.data);o?this.favoriteProducts=o:(this.externalFavoriteProducts=n.data,this.visualizer.addListener("sceneLoaded",this.listenOnceForSceneLoaded))}else{if(!0!==i.success)return void console.warn("Visualizer - In setFavoriteProducts: input value is not valid ; ","errors of short input:",n.error,"; errors of long input:",i.error);this.favoriteProducts=i.data}this.visualizer.emit("productAddedToFavorites",{favorites:this.favoriteProducts})}},ProductsManager.prototype.getUserDisplayedProducts=function(){return this.userDisplayedProducts},ProductsManager.prototype.addUserDisplayedProduct=function(t,n){return o(this,void 0,void 0,(function(){return a(this,(function(i){return this.userDisplayedProducts[n]=t,[2]}))}))},ProductsManager.prototype.displayProduct=function(t,n,i){var s;return void 0===i&&(i=!1),o(this,void 0,void 0,(function(){var o,m,g;return a(this,(function(a){switch(a.label){case 0:return(o=this.visualizer.catalogManager.getProduct(t,n))?(this.visualizer.emit("productChanging",{product:o,fromFavorites:i}),m=this.visualizer.catalogManager.getApplicationRenderOrder(n),[4,this.getApplicationLayerDisplay(n,m)]):[3,3];case 1:return(g=a.sent())&&(null===(s=g.displayedProduct)||void 0===s?void 0:s.sku)!==t?[4,g.display(o)]:[3,3];case 2:a.sent(),this.visualizer.emit("productChanged",{product:o,fromFavorites:i}),a.label=3;case 3:return[2]}}))}))},ProductsManager.prototype.unDisplayAll=function(){var t=this;this.displayedProductsMap.forEach((function(n,i){t.unDisplayProduct(n.displayedProduct)}))},ProductsManager.prototype.unDisplayProduct=function(t){var n,i=S.getCustomField(t,m.Constants.APPLICATION);this.displayedProductsMap.has(null==i?void 0:i[0])&&(null===(n=this.displayedProductsMap.get(i[0]))||void 0===n||n.cubeMap.destroy(),this.displayedProductsMap.delete(i[0]))},ProductsManager.prototype.addProductToCart=function(t){this.cart.includes(t)||this.cart.push(t)},ProductsManager.prototype.removeProductFromCart=function(t){this.cart=this.cart.filter((function(n){return n!==t}))},ProductsManager.prototype.getFavoriteProducts=function(){return this.favoriteProducts},ProductsManager.prototype.addProductToFavorites=function(t,n){var i=this.visualizer.catalogManager.getAllFormatedProducts(),o=null==i?void 0:i.find((function(i){return i.sku===t&&i.application===n}));return o&&!this.favoriteProducts.find((function(t){return t.product.sku===o.sku&&t.product.application===o.application}))&&(console.log("favoriteProducts product",this.favoriteProducts,o),this.favoriteProducts.push({product:o})),o},ProductsManager.prototype.removeProductFromFavorites=function(t,n){var i=this.favoriteProducts.find((function(i){return i.product.sku===t&&i.product.application===n}));return this.favoriteProducts=this.favoriteProducts.filter((function(t){return t!==i&&!!t})),null==i?void 0:i.product},ProductsManager.prototype.getFavoriteSets=function(){return this.favoriteSets},ProductsManager.prototype.addFavoriteScene=function(t){return o(this,void 0,void 0,(function(){var n,i,o,m=this;return a(this,(function(a){switch(a.label){case 0:return n=this.getDisplayedProducts(),[4,this.visualizer.getCurrentSceneImage()];case 1:return i=a.sent(),o={id:s.v1(),scene:this.visualizer.sceneMetadataManager.getScene(this.visualizer.sceneMetadataManager.getLocation(t)),image:i,favorites:n.map((function(t){return{product:S.formatProduct(t,m.visualizer.getCurrentCatalogFieldsMap())}}))},this.favoriteSets.unshift(o),[2,o]}}))}))},ProductsManager.prototype.removeFavoriteScene=function(t){var n=this.favoriteSets.find((function(n){return n.id===t}));return this.favoriteSets=this.favoriteSets.filter((function(n){return n.id!==t})),n},ProductsManager.prototype.getDisplayedProduct=function(t){var n;return n="string"==typeof t?t:t.application,this.getDisplayedFormatedProduct().find((function(t){return t.application===n}))},ProductsManager.prototype.getDisplayedFormatedProduct=function(){var t=this;return this.getDisplayedProducts().map((function(n){return S.formatProduct(n,t.visualizer.getCurrentCatalogFieldsMap())}))},ProductsManager.prototype.getApplicationLayerDisplay=function(t,n){return o(this,void 0,void 0,(function(){var i,o;return a(this,(function(a){switch(a.label){case 0:return this.displayedProductsMap.has(t)?[2,this.displayedProductsMap.get(t)]:[4,_.VisualizerUtils.createCubeMapElement(this.visualizer.appManager,n)];case 1:return i=a.sent(),o=new g.LayerDisplay(this.visualizer,i),this.displayedProductsMap.set(t,o),[2,o]}}))}))},ProductsManager.prototype.getDisplayedProducts=function(){return Array.from(this.displayedProductsMap.values()).map((function(t){return t.displayedProduct}))},ProductsManager}();n.ProductsManager=T},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.LayerDisplay=void 0;var s=i(68),m=i(115),g=i(40),_=i(69),S=function(){function LayerDisplay(t,n){this.visualizer=t,this.cubeMap=n}return LayerDisplay.prototype.display=function(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return this.displayedProduct=t,n=["$$px","$$nx","$$py","$$ny","$$pz","$$nz"].map((function(n){var i,o=g.getCustomMediaField(t,n);return null!==(i=o&&_.MediaUtils.GetMediaUrl(o))&&void 0!==i?i:void 0})),[4,this.changeCubeFaces(n,this.cubeMap)];case 1:return i.sent(),[2]}}))}))},LayerDisplay.prototype.changeCubeFaces=function(t,n){return o(this,void 0,void 0,(function(){var i,g,_=this;return a(this,(function(S){switch(S.label){case 0:return i=t.length,g=1,[4,Promise.all(t.map((function(t,S){return o(_,void 0,void 0,(function(){var o,_,M,T,O,A;return a(this,(function(a){switch(a.label){case 0:return t?(n.obj.enableFaceResSwitch(S,!1),o=this.visualizer.appManager.currentExperience.renderer.capabilities.getMaxAnisotropy(),_={anisotropy:o,magFilter:s.THREE.LinearFilter,minFilter:s.THREE.LinearFilter,url:this.visualizer.ImageOptimizeService.getImage(t,this.visualizer.sceneMetadataManager.getMaxFaceSize(this.visualizer.sceneId))},[4,n.obj.setMaterial(m.VisualizerUtils.TextureAsPromise(_),S,!0)]):[2];case 1:return M=a.sent(),T=g++/i*100,null===(A=(O=this.visualizer).emitAsyncOperationProgress)||void 0===A||A.call(O,{percent:T}),[2,M]}}))}))})))];case 1:return S.sent(),n.obj.materials.forEach((function(n,i){t[i]&&(n.visible=!0,n.transparent=!0)})),this.visualizer.emitRenderEvent(),[2]}}))}))},LayerDisplay}();n.LayerDisplay=S},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.iFavoriteProductSkuAndApplicationListSchema=n.iFavoriteProductListSchema=n.iFavoriteSceneListSchema=n.iFavoriteSceneSchema=n.iSceneSchema=n.iConfigurationSceneOutputSchema=n.iConfigurationSceneCommonSchema=n.iSceneSubSelectionSchema=n.iFavoriteSchema=n.iProductSchema=n.iFacetSchema=n.iFavoriteProductSkuAndApplicationSchema=n.iProductSkuAndApplicationSchema=n.iConfigurationFilterSchema=void 0;var o=i(255);n.iConfigurationFilterSchema=o.z.object({name:o.z.string(),customFieldName:o.z.string().optional(),operator:o.z.literal("not").optional(),options:o.z.union([o.z.array(o.z.string()),o.z.null()])}),n.iProductSkuAndApplicationSchema=o.z.object({sku:o.z.string(),application:o.z.string()}),n.iFavoriteProductSkuAndApplicationSchema=o.z.object({product:n.iProductSkuAndApplicationSchema}),n.iFacetSchema=o.z.object({name:o.z.string(),options:o.z.union([o.z.array(o.z.string()),o.z.null()])}),n.iProductSchema=o.z.object({sku:o.z.string(),name:o.z.string().optional(),title:o.z.string(),description:o.z.string().optional(),application:o.z.string(),image:o.z.string(),price:o.z.string().optional(),facets:o.z.array(n.iFacetSchema).optional(),_id:o.z.string()}),n.iFavoriteSchema=o.z.object({product:n.iProductSchema}),n.iSceneSubSelectionSchema=o.z.object({name:o.z.string(),title:o.z.string().optional(),previewImage:o.z.string().optional()}),n.iConfigurationSceneCommonSchema=o.z.object({title:o.z.string(),subtitle:o.z.string().optional(),previewImage:o.z.string().optional()}),n.iConfigurationSceneOutputSchema=n.iConfigurationSceneCommonSchema.and(o.z.object({name:o.z.string(),subSelection:n.iSceneSubSelectionSchema.optional()})),n.iSceneSchema=n.iConfigurationSceneOutputSchema.and(o.z.object({experienceId:o.z.string(),sceneId:o.z.string()})),n.iFavoriteSceneSchema=o.z.object({id:o.z.string(),image:o.z.string(),favorites:o.z.array(n.iFavoriteSchema),scene:n.iSceneSchema}),n.iFavoriteSceneListSchema=o.z.array(n.iFavoriteSceneSchema),n.iFavoriteProductListSchema=o.z.array(n.iFavoriteSchema),n.iFavoriteProductSkuAndApplicationListSchema=o.z.array(n.iFavoriteProductSkuAndApplicationSchema)},function(t,n,i){"use strict";i.r(n),i.d(n,"Schema",(function(){return A})),i.d(n,"ZodAny",(function(){return z})),i.d(n,"ZodArray",(function(){return X})),i.d(n,"ZodBigInt",(function(){return I})),i.d(n,"ZodBoolean",(function(){return j})),i.d(n,"ZodDate",(function(){return V})),i.d(n,"ZodDefault",(function(){return de})),i.d(n,"ZodEffects",(function(){return ue})),i.d(n,"ZodEnum",(function(){return ae})),i.d(n,"ZodError",(function(){return g})),i.d(n,"ZodFunction",(function(){return re})),i.d(n,"ZodIntersection",(function(){return K})),i.d(n,"ZodIssueCode",(function(){return m})),i.d(n,"ZodLazy",(function(){return ie})),i.d(n,"ZodLiteral",(function(){return oe})),i.d(n,"ZodMap",(function(){return te})),i.d(n,"ZodNativeEnum",(function(){return se})),i.d(n,"ZodNever",(function(){return q})),i.d(n,"ZodNonEmptyArray",(function(){return Q})),i.d(n,"ZodNull",(function(){return G})),i.d(n,"ZodNullable",(function(){return he})),i.d(n,"ZodNumber",(function(){return N})),i.d(n,"ZodObject",(function(){return Y})),i.d(n,"ZodOptional",(function(){return le})),i.d(n,"ZodParsedType",(function(){return S})),i.d(n,"ZodPromise",(function(){return ce})),i.d(n,"ZodRecord",(function(){return ee})),i.d(n,"ZodSchema",(function(){return A})),i.d(n,"ZodSet",(function(){return ne})),i.d(n,"ZodString",(function(){return R})),i.d(n,"ZodTransformer",(function(){return ue})),i.d(n,"ZodTuple",(function(){return $})),i.d(n,"ZodType",(function(){return A})),i.d(n,"ZodUndefined",(function(){return U})),i.d(n,"ZodUnion",(function(){return J})),i.d(n,"ZodUnknown",(function(){return H})),i.d(n,"ZodVoid",(function(){return Z})),i.d(n,"any",(function(){return we})),i.d(n,"array",(function(){return Ee})),i.d(n,"bigint",(function(){return ge})),i.d(n,"boolean",(function(){return ye})),i.d(n,"custom",(function(){return custom})),i.d(n,"date",(function(){return ve})),i.d(n,"defaultErrorMap",(function(){return defaultErrorMap})),i.d(n,"effect",(function(){return Ve})),i.d(n,"enum",(function(){return Fe})),i.d(n,"function",(function(){return Ie})),i.d(n,"getParsedType",(function(){return getParsedType})),i.d(n,"instanceof",(function(){return instanceOfType})),i.d(n,"intersection",(function(){return Ae})),i.d(n,"issueHelpers",(function(){return issueHelpers})),i.d(n,"late",(function(){return pe})),i.d(n,"lazy",(function(){return ke})),i.d(n,"literal",(function(){return je})),i.d(n,"map",(function(){return Re})),i.d(n,"mergeObjects",(function(){return mergeObjects})),i.d(n,"nativeEnum",(function(){return De})),i.d(n,"never",(function(){return Se})),i.d(n,"null",(function(){return _e})),i.d(n,"nullable",(function(){return Ge})),i.d(n,"number",(function(){return me})),i.d(n,"object",(function(){return Te})),i.d(n,"objectUtil",(function(){return M})),i.d(n,"oboolean",(function(){return oboolean})),i.d(n,"onumber",(function(){return onumber})),i.d(n,"optional",(function(){return Ue})),i.d(n,"ostring",(function(){return ostring})),i.d(n,"overrideErrorMap",(function(){return _})),i.d(n,"promise",(function(){return Be})),i.d(n,"quotelessJson",(function(){return quotelessJson})),i.d(n,"record",(function(){return Le})),i.d(n,"set",(function(){return Ne})),i.d(n,"setErrorMap",(function(){return setErrorMap})),i.d(n,"strictObject",(function(){return Ce})),i.d(n,"string",(function(){return fe})),i.d(n,"transformer",(function(){return Ve})),i.d(n,"tuple",(function(){return Pe})),i.d(n,"undefined",(function(){return be})),i.d(n,"union",(function(){return Oe})),i.d(n,"unknown",(function(){return xe})),i.d(n,"void",(function(){return Me})),i.d(n,"z",(function(){return ze}));var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(t,n)};function __extends(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}var __assign=function(){return(__assign=Object.assign||function __assign(t){for(var n,i=1,o=arguments.length;i<o;i++)for(var a in n=arguments[i])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)};function __awaiter(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))}function __generator(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}}function __values(t){var n="function"==typeof Symbol&&Symbol.iterator,i=n&&t[n],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(t,n){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,a,s=i.call(t),m=[];try{for(;(void 0===n||n-- >0)&&!(o=s.next()).done;)m.push(o.value)}catch(t){a={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return m}function __spreadArray(t,n){for(var i=0,o=n.length,a=t.length;i<o;i++,a++)t[a]=n[i];return t}var o,a=Object.freeze({invalid_data:!0});!function(t){t.assertNever=function assertNever(t){throw new Error},t.arrayToEnum=function(t){var n,i,o={};try{for(var a=__values(t),s=a.next();!s.done;s=a.next()){var m=s.value;o[m]=m}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},t.getValidEnumValues=function(n){var i,o,a=Object.keys(n).filter((function(t){return"number"!=typeof n[n[t]]})),s={};try{for(var m=__values(a),g=m.next();!g.done;g=m.next()){var _=g.value;s[_]=n[_]}}catch(t){i={error:t}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}return t.getValues(s)},t.getValues=function(t){return Object.keys(t).map((function(n){return t[n]}))},t.objectValues=function(t){return Object.keys(t).map((function(n){return t[n]}))},t.find=function(t,n){var i,o;try{for(var a=__values(t),s=a.next();!s.done;s=a.next()){var m=s.value;if(n(m))return m}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}}}(o||(o={}));var s,m=o.arrayToEnum(["invalid_type","custom","invalid_union","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types"]),quotelessJson=function(t){return JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:")},g=function(t){function ZodError(n){var i=this.constructor,o=t.call(this)||this;o.issues=[],o.format=function(){var t={_errors:[]},processError=function(n){var i,o;try{for(var a=__values(n.issues),s=a.next();!s.done;s=a.next()){var m=s.value;if("invalid_union"===m.code)m.unionErrors.map(processError);else if("invalid_return_type"===m.code)processError(m.returnTypeError);else if("invalid_arguments"===m.code)processError(m.argumentsError);else if(0===m.path.length)t._errors.push(m.message);else for(var g=t,_=0;_<m.path.length;){var S=m.path[_];if(_===m.path.length-1)g[S]=g[S]||{_errors:[]},g[S]._errors.push(m.message);else if("string"==typeof S)g[S]=g[S]||{_errors:[]};else if("number"==typeof S){var M=[];M._errors=[],g[S]=g[S]||M}g=g[S],_++}}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}};return processError(o),t},o.addIssue=function(t){o.issues=__spreadArray(__spreadArray([],__read(o.issues)),[t])},o.addIssues=function(t){void 0===t&&(t=[]),o.issues=__spreadArray(__spreadArray([],__read(o.issues)),__read(t))},o.flatten=function(){var t,n,i={},a=[];try{for(var s=__values(o.issues),m=s.next();!m.done;m=s.next()){var g=m.value;g.path.length>0?(i[g.path[0]]=i[g.path[0]]||[],i[g.path[0]].push(g.message)):a.push(g.message)}}catch(n){t={error:n}}finally{try{m&&!m.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return{formErrors:a,fieldErrors:i}};var a=i.prototype;return Object.setPrototypeOf(o,a),o.issues=n,o}return __extends(ZodError,t),Object.defineProperty(ZodError.prototype,"errors",{get:function(){return this.issues},enumerable:!1,configurable:!0}),ZodError.prototype.toString=function(){return"ZodError: "+JSON.stringify(this.issues,null,2)},Object.defineProperty(ZodError.prototype,"message",{get:function(){return JSON.stringify(this.issues,null,2)},enumerable:!1,configurable:!0}),Object.defineProperty(ZodError.prototype,"isEmpty",{get:function(){return 0===this.issues.length},enumerable:!1,configurable:!0}),Object.defineProperty(ZodError.prototype,"formErrors",{get:function(){return this.flatten()},enumerable:!1,configurable:!0}),ZodError.create=function(t){return new ZodError(t)},ZodError}(Error),defaultErrorMap=function(t,n){var i;switch(t.code){case m.invalid_type:i="undefined"===t.received?"Required":"Expected "+t.expected+", received "+t.received;break;case m.unrecognized_keys:i="Unrecognized key(s) in object: "+t.keys.map((function(t){return"'"+t+"'"})).join(", ");break;case m.invalid_union:i="Invalid input";break;case m.invalid_enum_value:i="Invalid enum value. Expected "+t.options.map((function(t){return"string"==typeof t?"'"+t+"'":t})).join(" | ")+", received "+("string"==typeof n.data?"'"+n.data+"'":n.data);break;case m.invalid_arguments:i="Invalid function arguments";break;case m.invalid_return_type:i="Invalid function return type";break;case m.invalid_date:i="Invalid date";break;case m.invalid_string:i="regex"!==t.validation?"Invalid "+t.validation:"Invalid";break;case m.too_small:i="array"===t.type?"Should have "+(t.inclusive?"at least":"more than")+" "+t.minimum+" items":"string"===t.type?"Should be "+(t.inclusive?"at least":"over")+" "+t.minimum+" characters":"number"===t.type?"Value should be greater than "+(t.inclusive?"or equal to ":"")+t.minimum:"Invalid input";break;case m.too_big:i="array"===t.type?"Should have "+(t.inclusive?"at most":"less than")+" "+t.maximum+" items":"string"===t.type?"Should be "+(t.inclusive?"at most":"under")+" "+t.maximum+" characters long":"number"===t.type?"Value should be less than "+(t.inclusive?"or equal to ":"")+t.maximum:"Invalid input";break;case m.custom:i="Invalid input";break;case m.invalid_intersection_types:i="Intersections only support objects";break;default:i=n.defaultError,o.assertNever(t)}return{message:i}},_=defaultErrorMap,setErrorMap=function(t){_=t},S=o.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=function(t){return"string"==typeof t?S.string:"number"==typeof t?Number.isNaN(t)?S.nan:S.number:"boolean"==typeof t?S.boolean:"bigint"==typeof t?S.bigint:"symbol"==typeof t?S.symbol:t instanceof Date?S.date:"function"==typeof t?S.function:void 0===t||void 0===t?S.undefined:"object"==typeof t?Array.isArray(t)?S.array:null===t?S.null:t.then&&"function"==typeof t.then&&t.catch&&"function"==typeof t.catch?S.promise:t instanceof Map?S.map:t instanceof Set?S.set:S.object:S.unknown},issueHelpers=function(t,n){var makeIssue=function(t){var i=__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(n.path)),__read(t.path||[]))}),o=defaultErrorMap(i,{data:n.data,defaultError:"Invalid input"});return __assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(n.path)),__read(t.path||[])),message:t.message||n.errorMap(i,{data:n.data,defaultError:o.message}).message})};return{makeIssue,addIssue:function(n){var i=makeIssue(n);t.addIssue(i)}}};!function(t){t.errToObj=function(t){return"string"==typeof t?{message:t}:t||{}},t.toString=function(t){return"string"==typeof t?t:null==t?void 0:t.message}}(s||(s={}));var M,T=Object.freeze({no_set:!0}),O=function(){function PseudoPromise(t){var n=this;void 0===t&&(t=[]),this.all=function(t){return n.then((function(i,o){var s=t(i,o);return o.async?Promise.all(s.map((function(t){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,t.getValueAsync()];case 1:return[2,n.sent()];case 2:return n.sent(),[2,a];case 3:return[2]}}))}))}))).then((function(t){return t})):s.map((function(t){return t.getValueSync()}))}))},this.then=function(t){return new PseudoPromise(__spreadArray(__spreadArray([],__read(n.items)),[{type:"function",function:t}]))},this.catch=function(t){return new PseudoPromise(__spreadArray(__spreadArray([],__read(n.items)),[{type:"catcher",catcher:t}]))},this.getValueSync=function(){for(var t,i=void 0,_loop_1=function(o){try{var a=n.items[o];"function"===a.type&&(i=a.function(i,{async:!1}))}catch(t){var s=n.items.findIndex((function(t,n){return"catcher"===t.type&&n>o})),m=n.items[s];if(!m||"catcher"!==m.type)throw t;o=s,i=m.catcher(t,{async:!1})}t=o},o=0;o<n.items.length;o++)_loop_1(o),o=t;return i},this.getValueAsync=function(){return __awaiter(n,void 0,void 0,(function(){var t,n,i,o,a;return __generator(this,(function(s){switch(s.label){case 0:t=void 0,n=function(n){var a,s,m,g;return __generator(this,(function(_){switch(_.label){case 0:a=i.items[n],_.label=1;case 1:return _.trys.push([1,4,,8]),"function"!==a.type?[3,3]:[4,a.function(t,{async:!0})];case 2:t=_.sent(),_.label=3;case 3:return[3,8];case 4:if(s=_.sent(),m=i.items.findIndex((function(t,i){return"catcher"===t.type&&i>n})),(g=i.items[m])&&"catcher"===g.type)return[3,5];throw s;case 5:return n=m,[4,g.catcher(s,{async:!0})];case 6:t=_.sent(),_.label=7;case 7:return[3,8];case 8:if(t instanceof PseudoPromise)throw new Error("ASYNC: DO NOT RETURN PSEUDOPROMISE FROM FUNCTIONS");if(t instanceof Promise)throw new Error("ASYNC: DO NOT RETURN PROMISE FROM FUNCTIONS");return o=n,[2]}}))},i=this,a=0,s.label=1;case 1:return a<this.items.length?[5,n(a)]:[3,4];case 2:s.sent(),a=o,s.label=3;case 3:return a++,[3,1];case 4:return[2,t]}}))}))},this.items=t}return PseudoPromise.all=function(t){return(new PseudoPromise).all((function(){return t}))},PseudoPromise.object=function(t){return(new PseudoPromise).then((function(n,i){var o,s,m={},_=new g([]);if(i.async){return __awaiter(void 0,void 0,void 0,(function(){var n,i,o,s,S,M;return __generator(this,(function(O){switch(O.label){case 0:return[4,Promise.all(Object.keys(t).map((function(n){return __awaiter(void 0,void 0,void 0,(function(){var i,o;return __generator(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,t[n].getValueAsync()];case 1:return i=s.sent(),[2,[n,i]];case 2:if((o=s.sent())instanceof g)return _.addIssues(o.issues),[2,[n,a]];throw o;case 3:return[2]}}))}))})))];case 1:if(n=O.sent(),!_.isEmpty)throw _;try{for(i=__values(n),o=i.next();!o.done;o=i.next())(s=o.value)[1]!==T&&(m[s[0]]=s[1])}catch(t){S={error:t}}finally{try{o&&!o.done&&(M=i.return)&&M.call(i)}finally{if(S)throw S.error}}return[2,m]}}))}))}var S=Object.keys(t).map((function(n){try{return[n,t[n].getValueSync()]}catch(t){if(t instanceof g)return _.addIssues(t.issues),[n,a];throw t}}));if(!_.isEmpty)throw _;try{for(var M=__values(S),O=M.next();!O.done;O=M.next()){var A=O.value;A[1]!==T&&(m[A[0]]=A[1])}}catch(t){o={error:t}}finally{try{O&&!O.done&&(s=M.return)&&s.call(M)}finally{if(o)throw o.error}}return m}))},PseudoPromise.resolve=function(t){if(t instanceof PseudoPromise)throw new Error("Do not pass PseudoPromise into PseudoPromise.resolve");return(new PseudoPromise).then((function(){return t}))},PseudoPromise}(),A=function(){function ZodType(t){var n=this;this._parseInternalOptionalParams=function(t){var i,o={data:t.data,path:t.path||[],parentError:t.parentError||new g([]),errorMap:t.errorMap||_,async:null!==(i=t.async)&&void 0!==i&&i};return n._parseInternal(o)},this.parse=function(t,i){var o=n._parseInternalOptionalParams(__assign({data:t},i));if(o instanceof Promise)throw new Error("You can't use .parse() on a schema containing async elements. Use .parseAsync instead.");if(o.success)return o.data;throw o.error},this.safeParse=function(t,i){var o=n._parseInternalOptionalParams(__assign({data:t},i));if(o instanceof Promise)throw new Error("You can't use .safeParse() on a schema containing async elements. Use .parseAsync instead.");return o},this.parseAsync=function(t,i){return __awaiter(n,void 0,void 0,(function(){var n;return __generator(this,(function(o){switch(o.label){case 0:return[4,this._parseInternalOptionalParams(__assign(__assign({data:t},i),{async:!0}))];case 1:if((n=o.sent()).success)return[2,n.data];throw n.error}}))}))},this.safeParseAsync=function(t,i){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this._parseInternalOptionalParams(__assign(__assign({data:t},i),{async:!0}))];case 1:return[2,n.sent()]}}))}))},this.spa=this.safeParseAsync,this._parseWithInvalidFallback=function(t,i){var o=n._parseInternal(__assign(__assign({},i),{data:t}));return o instanceof Promise?o.then((function(t){return t.success?t.data:a})):o.success?o.data:a},this.refine=function(t,i){return"string"==typeof i||void 0===i?n._refinement((function(n,o){var a=t(n),setError=function(){return o.addIssue({code:m.custom,message:i})};return a instanceof Promise?a.then((function(t){t||setError()})):a?void 0:(setError(),a)})):"function"==typeof i?n._refinement((function(n,o){var a=t(n),setError=function(){return o.addIssue(__assign({code:m.custom},i(n)))};return a instanceof Promise?a.then((function(t){t||setError()})):a?void 0:(setError(),a)})):n._refinement((function(n,o){var a=t(n),setError=function(){return o.addIssue(__assign({code:m.custom},i))};return a instanceof Promise?a.then((function(t){t||setError()})):a?void 0:(setError(),a)}))},this.refinement=function(t,i){return n._refinement((function(n,o){t(n)||o.addIssue("function"==typeof i?i(n,o):i)}))},this.superRefine=this._refinement,this.optional=function(){return le.create(n)},this.nullable=function(){return he.create(n)},this.nullish=function(){return n.optional().nullable()},this.array=function(){return X.create(n)},this.isOptional=function(){return n.safeParse(void 0).success},this.isNullable=function(){return n.safeParse(null).success},this._def=t,this.transform=this.transform.bind(this),this.default=this.default.bind(this)}return ZodType.prototype._parseInternal=function(t){var n,i=t.data,o=new g([]),s=issueHelpers(o,__assign({},t)),m=s.makeIssue,_=s.addIssue,S=getParsedType(i);try{var M=this._parse(__assign(__assign({},t),{currentError:o,makeIssue:m,addIssue:_,parsedType:S}));n=M instanceof O?M:O.resolve(M)}catch(t){n=O.resolve(a)}var T=!1===t.async||this instanceof ce;return n=n.then((function(t){if(!o.isEmpty)throw o;return t})).then((function(t){return{success:!0,data:t}})).catch((function(n){if(t.parentError.addIssues(o.issues),n instanceof g)return{success:!1,error:n};throw n})),T?n.getValueSync():n.getValueAsync()},ZodType.prototype._refinement=function(t){return new ue(this instanceof ue?__assign(__assign({},this._def),{effects:__spreadArray(__spreadArray([],__read(this._def.effects||[])),[{type:"refinement",refinement:t}])}):{schema:this,effects:[{type:"refinement",refinement:t}]})},ZodType.prototype.or=function(t){return J.create([this,t])},ZodType.prototype.and=function(t){return K.create(this,t)},ZodType.prototype.transform=function(t){return new ue({schema:this,effects:[{type:"transform",transform:t}]})},ZodType.prototype.default=function(t){return new de({innerType:this,defaultValue:"function"==typeof t?t:function(){return t}})},ZodType}(),P=/^[a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$/i,L=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,R=function(t){function ZodString(){var n=null!==t&&t.apply(this,arguments)||this;return n._regex=function(t,i,o){return n.refinement((function(n){return t.test(n)}),__assign({validation:i,code:m.invalid_string},s.errToObj(o)))},n.email=function(t){return new ZodString(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[__assign({kind:"email"},s.errToObj(t))])}))},n.url=function(t){return new ZodString(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[__assign({kind:"url"},s.errToObj(t))])}))},n.uuid=function(t){return new ZodString(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[__assign({kind:"uuid"},s.errToObj(t))])}))},n.regex=function(t,i){return new ZodString(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[__assign({kind:"regex",regex:t},s.errToObj(i))])}))},n.min=function(t,i){return new ZodString(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[__assign({kind:"min",value:t},s.errToObj(i))])}))},n.max=function(t,i){return new ZodString(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[__assign({kind:"max",value:t},s.errToObj(i))])}))},n.nonempty=function(t){return n.min(1,s.errToObj(t))},n}return __extends(ZodString,t),ZodString.prototype._parse=function(t){var n,i;if(t.parsedType!==S.string)return t.addIssue({code:m.invalid_type,expected:S.string,received:t.parsedType}),a;try{for(var o=__values(this._def.checks),s=o.next();!s.done;s=o.next()){var g=s.value;if("min"===g.kind)t.data.length<g.value&&t.addIssue({code:m.too_small,minimum:g.value,type:"string",inclusive:!0,message:g.message});else if("max"===g.kind)t.data.length>g.value&&t.addIssue({code:m.too_big,maximum:g.value,type:"string",inclusive:!0,message:g.message});else if("email"===g.kind)L.test(t.data)||t.addIssue({validation:"email",code:m.invalid_string,message:g.message});else if("uuid"===g.kind)P.test(t.data)||t.addIssue({validation:"uuid",code:m.invalid_string,message:g.message});else if("url"===g.kind)try{new URL(t.data)}catch(n){t.addIssue({validation:"url",code:m.invalid_string,message:g.message})}else"regex"===g.kind&&(g.regex.test(t.data)||t.addIssue({validation:"regex",code:m.invalid_string,message:g.message}))}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return t.data},ZodString.prototype.length=function(t,n){return this.min(t,n).max(t,n)},Object.defineProperty(ZodString.prototype,"isEmail",{get:function(){return!!this._def.checks.find((function(t){return"email"===t.kind}))},enumerable:!1,configurable:!0}),Object.defineProperty(ZodString.prototype,"isURL",{get:function(){return!!this._def.checks.find((function(t){return"url"===t.kind}))},enumerable:!1,configurable:!0}),Object.defineProperty(ZodString.prototype,"isUUID",{get:function(){return!!this._def.checks.find((function(t){return"uuid"===t.kind}))},enumerable:!1,configurable:!0}),Object.defineProperty(ZodString.prototype,"minLength",{get:function(){var t=-1/0;return this._def.checks.map((function(n){"min"===n.kind&&(null===t||n.value>t)&&(t=n.value)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(ZodString.prototype,"maxLength",{get:function(){var t=null;return this._def.checks.map((function(n){"min"===n.kind&&(null===t||n.value<t)&&(t=n.value)})),t},enumerable:!1,configurable:!0}),ZodString.create=function(){return new ZodString({checks:[]})},ZodString}(A),N=function(t){function ZodNumber(){var n=null!==t&&t.apply(this,arguments)||this;return n.min=function(t,i){return new ZodNumber(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[{kind:"min",value:t,inclusive:!0,message:s.toString(i)}])}))},n.max=function(t,i){return new ZodNumber(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[{kind:"max",value:t,inclusive:!0,message:s.toString(i)}])}))},n.int=function(t){return new ZodNumber(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[{kind:"int",message:s.toString(t)}])}))},n.positive=function(t){return new ZodNumber(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[{kind:"min",value:0,inclusive:!1,message:s.toString(t)}])}))},n.negative=function(t){return new ZodNumber(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[{kind:"max",value:0,inclusive:!1,message:s.toString(t)}])}))},n.nonpositive=function(t){return new ZodNumber(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[{kind:"max",value:0,inclusive:!0,message:s.toString(t)}])}))},n.nonnegative=function(t){return new ZodNumber(__assign(__assign({},n._def),{checks:__spreadArray(__spreadArray([],__read(n._def.checks)),[{kind:"min",value:0,inclusive:!0,message:s.toString(t)}])}))},n}return __extends(ZodNumber,t),ZodNumber.prototype._parse=function(t){var n,i;if(t.parsedType!==S.number)return t.addIssue({code:m.invalid_type,expected:S.number,received:t.parsedType}),a;if(Number.isNaN(t.data))return t.addIssue({code:m.invalid_type,expected:S.number,received:S.nan}),a;try{for(var o=__values(this._def.checks),s=o.next();!s.done;s=o.next()){var g=s.value;if("int"===g.kind)Number.isInteger(t.data)||t.addIssue({code:m.invalid_type,expected:"integer",received:"float",message:g.message});else if("min"===g.kind){(g.inclusive?t.data<g.value:t.data<=g.value)&&t.addIssue({code:m.too_small,minimum:g.value,type:"number",inclusive:g.inclusive,message:g.message})}else if("max"===g.kind){(g.inclusive?t.data>g.value:t.data>=g.value)&&t.addIssue({code:m.too_big,maximum:g.value,type:"number",inclusive:g.inclusive,message:g.message})}}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return t.data},Object.defineProperty(ZodNumber.prototype,"minValue",{get:function(){var t,n,i=null;try{for(var o=__values(this._def.checks),a=o.next();!a.done;a=o.next()){var s=a.value;"min"===s.kind&&(null===i||s.value>i)&&(i=s.value)}}catch(n){t={error:n}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(ZodNumber.prototype,"maxValue",{get:function(){var t,n,i=null;try{for(var o=__values(this._def.checks),a=o.next();!a.done;a=o.next()){var s=a.value;"max"===s.kind&&(null===i||s.value<i)&&(i=s.value)}}catch(n){t={error:n}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(ZodNumber.prototype,"isInt",{get:function(){return!!this._def.checks.find((function(t){return"int"===t.kind}))},enumerable:!1,configurable:!0}),ZodNumber.create=function(){return new ZodNumber({checks:[]})},ZodNumber}(A),I=function(t){function ZodBigInt(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodBigInt,t),ZodBigInt.prototype._parse=function(t){if(t.parsedType===S.bigint)return t.data;t.addIssue({code:m.invalid_type,expected:S.bigint,received:t.parsedType})},ZodBigInt.create=function(){return new ZodBigInt({})},ZodBigInt}(A),j=function(t){function ZodBoolean(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodBoolean,t),ZodBoolean.prototype._parse=function(t){if(t.parsedType===S.boolean)return t.data;t.addIssue({code:m.invalid_type,expected:S.boolean,received:t.parsedType})},ZodBoolean.create=function(){return new ZodBoolean({})},ZodBoolean}(A),V=function(t){function ZodDate(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodDate,t),ZodDate.prototype._parse=function(t){if(t.parsedType===S.date){if(!isNaN(t.data.getTime()))return new Date(t.data.getTime());t.addIssue({code:m.invalid_date})}else t.addIssue({code:m.invalid_type,expected:S.date,received:t.parsedType})},ZodDate.create=function(){return new ZodDate({})},ZodDate}(A),U=function(t){function ZodUndefined(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodUndefined,t),ZodUndefined.prototype._parse=function(t){if(t.parsedType===S.undefined)return t.data;t.addIssue({code:m.invalid_type,expected:S.undefined,received:t.parsedType})},ZodUndefined.create=function(){return new ZodUndefined({})},ZodUndefined}(A),G=function(t){function ZodNull(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodNull,t),ZodNull.prototype._parse=function(t){if(t.parsedType===S.null)return t.data;t.addIssue({code:m.invalid_type,expected:S.null,received:t.parsedType})},ZodNull.create=function(){return new ZodNull({})},ZodNull}(A),z=function(t){function ZodAny(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodAny,t),ZodAny.prototype._parse=function(t){return t.data},ZodAny.create=function(){return new ZodAny({})},ZodAny}(A),H=function(t){function ZodUnknown(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodUnknown,t),ZodUnknown.prototype._parse=function(t){return t.data},ZodUnknown.create=function(){return new ZodUnknown({})},ZodUnknown}(A),q=function(t){function ZodNever(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodNever,t),ZodNever.prototype._parse=function(t){t.addIssue({code:m.invalid_type,expected:S.never,received:t.parsedType})},ZodNever.create=function(){return new ZodNever({})},ZodNever}(A),Z=function(t){function ZodVoid(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodVoid,t),ZodVoid.prototype._parse=function(t){if(t.parsedType===S.undefined||t.parsedType===S.null)return t.data;t.addIssue({code:m.invalid_type,expected:S.void,received:t.parsedType})},ZodVoid.create=function(){return new ZodVoid({})},ZodVoid}(A),parseArray=function(t,n){return t.parsedType!==S.array?(t.addIssue({code:m.invalid_type,expected:S.array,received:t.parsedType}),!1):(null!==n.minLength&&t.data.length<n.minLength.value&&t.addIssue({code:m.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,message:n.minLength.message}),null!==n.maxLength&&t.data.length>n.maxLength.value&&t.addIssue({code:m.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,message:n.maxLength.message}),!0)},X=function(t){function ZodArray(){var n=null!==t&&t.apply(this,arguments)||this;return n.min=function(t,i){return new ZodArray(__assign(__assign({},n._def),{minLength:{value:t,message:s.toString(i)}}))},n.max=function(t,i){return new ZodArray(__assign(__assign({},n._def),{maxLength:{value:t,message:s.toString(i)}}))},n.length=function(t,i){return n.min(t,i).max(t,i)},n.nonempty=function(){return new Q(__assign({},n._def))},n}return __extends(ZodArray,t),ZodArray.prototype._parse=function(t){var n=this;if(parseArray(t,this._def))return O.all(t.data.map((function(i,o){return(new O).then((function(){return n._def.type._parseWithInvalidFallback(i,__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[o]),parentError:t.currentError}))}))})))},Object.defineProperty(ZodArray.prototype,"element",{get:function(){return this._def.type},enumerable:!1,configurable:!0}),ZodArray.create=function(t){return new ZodArray({type:t,minLength:null,maxLength:null})},ZodArray}(A),Q=function(t){function ZodNonEmptyArray(){var n=null!==t&&t.apply(this,arguments)||this;return n.min=function(t,i){return new ZodNonEmptyArray(__assign(__assign({},n._def),{minLength:{value:t,message:s.toString(i)}}))},n.max=function(t,i){return new ZodNonEmptyArray(__assign(__assign({},n._def),{maxLength:{value:t,message:s.toString(i)}}))},n.length=function(t,i){return n.min(t,i).max(t,i)},n}return __extends(ZodNonEmptyArray,t),ZodNonEmptyArray.prototype._parse=function(t){var n=this;if(parseArray(t,this._def))return t.data.length<1&&t.addIssue({code:m.too_small,minimum:1,type:"array",inclusive:!0}),O.all(t.data.map((function(i,o){return(new O).then((function(){return n._def.type._parseWithInvalidFallback(i,__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[o]),parentError:t.currentError}))}))})))},ZodNonEmptyArray.create=function(t){return new ZodNonEmptyArray({type:t,minLength:null,maxLength:null})},ZodNonEmptyArray}(A);!function(t){t.mergeShapes=function(t,n){return __assign(__assign({},t),n)},t.intersectShapes=function(t,n){var i,o,a=Object.keys(t),s=Object.keys(n),m=a.filter((function(t){return-1!==s.indexOf(t)})),g={};try{for(var _=__values(m),S=_.next();!S.done;S=_.next()){var M=S.value;g[M]=K.create(t[M],n[M])}}catch(t){i={error:t}}finally{try{S&&!S.done&&(o=_.return)&&o.call(_)}finally{if(i)throw i.error}}return __assign(__assign(__assign({},t),n),g)}}(M||(M={}));var mergeObjects=function(t){return function(n){var i=M.mergeShapes(t._def.shape(),n._def.shape());return new Y({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:function(){return i}})}},AugmentFactory=function(t){return function(n){return new Y(__assign(__assign({},t),{shape:function(){return __assign(__assign({},t.shape()),n)}}))}},Y=function(t){function ZodObject(){var n=null!==t&&t.apply(this,arguments)||this;return n.strict=function(){return new ZodObject(__assign(__assign({},n._def),{unknownKeys:"strict"}))},n.strip=function(){return new ZodObject(__assign(__assign({},n._def),{unknownKeys:"strip"}))},n.passthrough=function(){return new ZodObject(__assign(__assign({},n._def),{unknownKeys:"passthrough"}))},n.nonstrict=n.passthrough,n.augment=AugmentFactory(n._def),n.extend=AugmentFactory(n._def),n.setKey=function(t,i){var o;return n.augment(((o={})[t]=i,o))},n.merge=function(t){var i=M.mergeShapes(n._def.shape(),t._def.shape());return new ZodObject({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:function(){return i}})},n.catchall=function(t){return new ZodObject(__assign(__assign({},n._def),{catchall:t}))},n.pick=function(t){var i={};return Object.keys(t).map((function(t){i[t]=n.shape[t]})),new ZodObject(__assign(__assign({},n._def),{shape:function(){return i}}))},n.omit=function(t){var i={};return Object.keys(n.shape).map((function(o){-1===Object.keys(t).indexOf(o)&&(i[o]=n.shape[o])})),new ZodObject(__assign(__assign({},n._def),{shape:function(){return i}}))},n.partial=function(){var t={};for(var i in n.shape){var o=n.shape[i];t[i]=o.isOptional()?o:o.optional()}return new ZodObject(__assign(__assign({},n._def),{shape:function(){return t}}))},n.deepPartial=function(){var t={};for(var i in n.shape){var o=n.shape[i];t[i]=o instanceof ZodObject?o.isOptional()?o:o.deepPartial().optional():o.isOptional()?o:o.optional()}return new ZodObject(__assign(__assign({},n._def),{shape:function(){return t}}))},n.required=function(){var t={};for(var i in n.shape){for(var o=n.shape[i];o instanceof le;)o=o._def.innerType;t[i]=o}return new ZodObject(__assign(__assign({},n._def),{shape:function(){return t}}))},n}return __extends(ZodObject,t),ZodObject.prototype._parse=function(t){var n,i,o,a,s,g,_=this;if(t.parsedType===S.object){var M={},A=this._def.shape(),P=Object.keys(A),L=Object.keys(t.data),R=L.filter((function(t){return-1===P.indexOf(t)})),_loop_1=function(n){var i=P.includes(n)?A[n]:N._def.catchall instanceof q?void 0:N._def.catchall;return i?void 0!==t.data[n]||L.includes(n)?void(M[n]=(new O).then((function(){return i._parseWithInvalidFallback(t.data[n],__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[n]),parentError:t.currentError}))})).then((function(t){return t}))):(M[n]=(new O).then((function(){return i._parseWithInvalidFallback(void 0,__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[n]),parentError:t.currentError}))})).then((function(t){return void 0===t?T:t})),"continue"):"continue"},N=this;try{for(var I=__values(P),j=I.next();!j.done;j=I.next()){_loop_1(z=j.value)}}catch(t){n={error:t}}finally{try{j&&!j.done&&(i=I.return)&&i.call(I)}finally{if(n)throw n.error}}if(this._def.catchall instanceof q){var V=this._def.unknownKeys;if("passthrough"===V)try{for(var U=__values(R),G=U.next();!G.done;G=U.next()){var z=G.value;M[z]=O.resolve(t.data[z])}}catch(t){o={error:t}}finally{try{G&&!G.done&&(a=U.return)&&a.call(U)}finally{if(o)throw o.error}}else if("strict"===V)R.length>0&&t.addIssue({code:m.unrecognized_keys,keys:R});else if("strip"!==V)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{var _loop_2=function(n){M[n]=(new O).then((function(){return _._def.catchall._parseWithInvalidFallback(t.data[n],__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[n]),parentError:t.currentError}))}))};try{for(var H=__values(R),Z=H.next();!Z.done;Z=H.next()){_loop_2(z=Z.value)}}catch(t){s={error:t}}finally{try{Z&&!Z.done&&(g=H.return)&&g.call(H)}finally{if(s)throw s.error}}}return O.object(M).then((function(t){return t}))}t.addIssue({code:m.invalid_type,expected:S.object,received:t.parsedType})},Object.defineProperty(ZodObject.prototype,"shape",{get:function(){return this._def.shape()},enumerable:!1,configurable:!0}),ZodObject.create=function(t){return new ZodObject({shape:function(){return t},unknownKeys:"strip",catchall:q.create()})},ZodObject.strictCreate=function(t){return new ZodObject({shape:function(){return t},unknownKeys:"strict",catchall:q.create()})},ZodObject.lazycreate=function(t){return new ZodObject({shape:t,unknownKeys:"strip",catchall:q.create()})},ZodObject}(A),J=function(t){function ZodUnion(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodUnion,t),ZodUnion.prototype._parse=function(t){var n=__spreadArray([],__read(Array(this._def.options.length))).map((function(){return new g([])}));return O.all(this._def.options.map((function(i,o){return(new O).then((function(){return i._parseWithInvalidFallback(t.data,__assign(__assign({},t),{parentError:n[o]}))}))}))).then((function(i){return!!n.find((function(t){return t.isEmpty}))||t.addIssue({code:m.invalid_union,unionErrors:n}),i})).then((function(t){return t[n.indexOf(n.find((function(t){return t.isEmpty})))]}))},Object.defineProperty(ZodUnion.prototype,"options",{get:function(){return this._def.options},enumerable:!1,configurable:!0}),ZodUnion.create=function(t){return new ZodUnion({options:t})},ZodUnion}(A),K=function(t){function ZodIntersection(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodIntersection,t),ZodIntersection.prototype._parse=function(t){var n=this;return O.all([(new O).then((function(){return n._def.left._parseWithInvalidFallback(t.data,__assign(__assign({},t),{parentError:t.currentError}))})),(new O).then((function(){return n._def.right._parseWithInvalidFallback(t.data,__assign(__assign({},t),{parentError:t.currentError}))}))]).then((function(n){var i=__read(n,2),o=i[0],s=i[1];if(o===a||s===a)return a;var g=getParsedType(o),_=getParsedType(s);return o===s?o:g===S.object&&_===S.object?__assign(__assign({},o),s):void t.addIssue({code:m.invalid_intersection_types})}))},ZodIntersection.create=function(t,n){return new ZodIntersection({left:t,right:n})},ZodIntersection}(A),$=function(t){function ZodTuple(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodTuple,t),ZodTuple.prototype._parse=function(t){var n=this;if(t.parsedType===S.array){t.data.length>this._def.items.length?t.addIssue({code:m.too_big,maximum:this._def.items.length,inclusive:!0,type:"array"}):t.data.length<this._def.items.length&&t.addIssue({code:m.too_small,minimum:this._def.items.length,inclusive:!0,type:"array"});var i=t.data;return O.all(i.map((function(i,o){var a=n._def.items[o];return a?(new O).then((function(){return a._parseWithInvalidFallback(i,__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[o]),parentError:t.currentError}))})).then((function(t){return t})):O.resolve(i)})))}t.addIssue({code:m.invalid_type,expected:S.array,received:t.parsedType})},Object.defineProperty(ZodTuple.prototype,"items",{get:function(){return this._def.items},enumerable:!1,configurable:!0}),ZodTuple.create=function(t){return new ZodTuple({items:t})},ZodTuple}(A),ee=function(t){function ZodRecord(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodRecord,t),ZodRecord.prototype._parse=function(t){var n=this;if(t.parsedType===S.object){var i={},_loop_3=function(o){i[o]=(new O).then((function(){return n._def.valueType._parseWithInvalidFallback(t.data[o],__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[o]),parentError:t.currentError}))}))};for(var o in t.data)_loop_3(o);return O.object(i)}t.addIssue({code:m.invalid_type,expected:S.object,received:t.parsedType})},ZodRecord.create=function(t){return new ZodRecord({valueType:t})},ZodRecord}(A),te=function(t){function ZodMap(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodMap,t),ZodMap.prototype._parse=function(t){var n=this;if(t.parsedType===S.map){var i=t.data,o=new Map;return O.all(__spreadArray([],__read(i.entries())).map((function(i,a){var s=__read(i,2),m=s[0],g=s[1];return O.all([(new O).then((function(){return n._def.keyType._parseWithInvalidFallback(m,__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[a,"key"]),parentError:t.currentError}))})),(new O).then((function(){return n._def.valueType._parseWithInvalidFallback(g,__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[a,"value"]),parentError:t.currentError}))}))]).then((function(t){o.set(t[0],t[1])}))}))).then((function(){return o}))}t.addIssue({code:m.invalid_type,expected:S.map,received:t.parsedType})},ZodMap.create=function(t,n){return new ZodMap({valueType:n,keyType:t})},ZodMap}(A),ne=function(t){function ZodSet(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodSet,t),ZodSet.prototype._parse=function(t){var n=this;if(t.parsedType===S.set){var i=t.data,o=new Set;return O.all(__spreadArray([],__read(i.values())).map((function(i,a){return(new O).then((function(){return n._def.valueType._parseWithInvalidFallback(i,__assign(__assign({},t),{path:__spreadArray(__spreadArray([],__read(t.path)),[a]),parentError:t.currentError}))})).then((function(t){o.add(t)}))}))).then((function(){return o}))}t.addIssue({code:m.invalid_type,expected:S.set,received:t.parsedType})},ZodSet.create=function(t){return new ZodSet({valueType:t})},ZodSet}(A),re=function(t){function ZodFunction(){var n=null!==t&&t.apply(this,arguments)||this;return n.args=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return new ZodFunction(__assign(__assign({},n._def),{args:$.create(t)}))},n.returns=function(t){return new ZodFunction(__assign(__assign({},n._def),{returns:t}))},n.implement=function(t){return n.parse(t)},n.strictImplement=function(t){return n.parse(t)},n.validate=n.implement,n}return __extends(ZodFunction,t),ZodFunction.prototype._parse=function(t){var n=this;if(t.parsedType===S.function){var i=this._def.returns instanceof ce;return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var s=new g([]),_=new g([]),S=(new O).then((function(){return n._def.args._parseWithInvalidFallback(o,__assign(__assign({},t),{parentError:s,async:i}))})).then((function(n){if(!s.isEmpty){var i=new g([]),o=t.makeIssue({code:m.invalid_arguments,argumentsError:s});throw i.addIssue(o),i}return n})).then((function(n){return t.data.apply(t,__spreadArray([],__read(n)))})).then((function(o){return n._def.returns._parseWithInvalidFallback(o,__assign(__assign({},t),{parentError:_,async:i}))})).then((function(n){if(!_.isEmpty){var i=new g([]),o=t.makeIssue({code:m.invalid_return_type,returnTypeError:_});throw i.addIssue(o),i}return n}));return i?S.getValueAsync():S.getValueSync()}}t.addIssue({code:m.invalid_type,expected:S.function,received:t.parsedType})},ZodFunction.prototype.parameters=function(){return this._def.args},ZodFunction.prototype.returnType=function(){return this._def.returns},ZodFunction.create=function(t,n){return new ZodFunction({args:t||$.create([]),returns:n||H.create()})},ZodFunction}(A),ie=function(t){function ZodLazy(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodLazy,t),Object.defineProperty(ZodLazy.prototype,"schema",{get:function(){return this._def.getter()},enumerable:!1,configurable:!0}),ZodLazy.prototype._parse=function(t){var n=this._def.getter();return O.resolve(n._parseWithInvalidFallback(t.data,__assign(__assign({},t),{parentError:t.currentError})))},ZodLazy.create=function(t){return new ZodLazy({getter:t})},ZodLazy}(A),oe=function(t){function ZodLiteral(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodLiteral,t),ZodLiteral.prototype._parse=function(t){if(t.data===this._def.value)return t.data;t.addIssue({code:m.invalid_type,expected:this._def.value,received:t.data})},ZodLiteral.create=function(t){return new ZodLiteral({value:t})},ZodLiteral}(A),ae=function(t){function ZodEnum(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodEnum,t),ZodEnum.prototype._parse=function(t){if(-1!==this._def.values.indexOf(t.data))return t.data;t.addIssue({code:m.invalid_enum_value,options:this._def.values})},Object.defineProperty(ZodEnum.prototype,"options",{get:function(){return this._def.values},enumerable:!1,configurable:!0}),Object.defineProperty(ZodEnum.prototype,"enum",{get:function(){var t,n,i={};try{for(var o=__values(this._def.values),a=o.next();!a.done;a=o.next()){var s=a.value;i[s]=s}}catch(n){t={error:n}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(ZodEnum.prototype,"Values",{get:function(){var t,n,i={};try{for(var o=__values(this._def.values),a=o.next();!a.done;a=o.next()){var s=a.value;i[s]=s}}catch(n){t={error:n}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(ZodEnum.prototype,"Enum",{get:function(){var t,n,i={};try{for(var o=__values(this._def.values),a=o.next();!a.done;a=o.next()){var s=a.value;i[s]=s}}catch(n){t={error:n}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},enumerable:!1,configurable:!0}),ZodEnum.create=function(t){return new ZodEnum({values:t})},ZodEnum}(A),se=function(t){function ZodNativeEnum(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodNativeEnum,t),ZodNativeEnum.prototype._parse=function(t){var n=o.getValidEnumValues(this._def.values);if(-1!==n.indexOf(t.data))return t.data;t.addIssue({code:m.invalid_enum_value,options:o.objectValues(n)})},ZodNativeEnum.create=function(t){return new ZodNativeEnum({values:t})},ZodNativeEnum}(A),ce=function(t){function ZodPromise(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodPromise,t),ZodPromise.prototype._parse=function(t){var n=this;if(t.parsedType===S.promise||!1!==t.async){var i=t.parsedType===S.promise?t.data:Promise.resolve(t.data),o=new g([]);return O.resolve(i.then((function(i){return n._def.type._parseWithInvalidFallback(i,__assign(__assign({},t),{parentError:o}))})).then((function(t){if(!o.isEmpty)throw o;return t})))}t.addIssue({code:m.invalid_type,expected:S.promise,received:t.parsedType})},ZodPromise.create=function(t){return new ZodPromise({type:t})},ZodPromise}(A),ue=function(t){function ZodEffects(n){return t.call(this,n)||this}return __extends(ZodEffects,t),ZodEffects.prototype.innerType=function(){return this._def.schema},ZodEffects.prototype._parse=function(t){var n,i,o=this,a=!1===t.async||this instanceof ce,s=this._def.effects||[],m={addIssue:function(n){t.addIssue(n)},path:t.path},THROW_ERROR_IF_PRESENT=function(n){return function(n){if(!t.currentError.isEmpty)throw t.currentError;return n}},g=(new O).then((function(){return o._def.schema._parseWithInvalidFallback(t.data,__assign(__assign({},t),{parentError:t.currentError}))})).then(THROW_ERROR_IF_PRESENT()),_loop_4=function(t){if("refinement"===t.type)g=g.all((function(n){return[O.resolve(n),O.resolve(n).then((function(){var i=t.refinement(n,m);if(a&&i instanceof Promise)throw new Error("You can't use .parse() on a schema containing async refinements. Use .parseAsync instead.");return i}))]})).then((function(t){var n=__read(t,2),i=n[0];return n[1],i}));else{if("transform"!==t.type)throw new Error("Invalid effect type.");g=g.then(THROW_ERROR_IF_PRESENT()).then((function(n){if(!(o instanceof ZodEffects))throw new Error("Only transformers can contain transformation functions.");return t.transform(n)})).then((function(t){if(a&&t instanceof Promise)throw new Error("You can't use .parse() on a schema containing async transformations. Use .parseAsync instead.");return t}))}};try{for(var _=__values(s),S=_.next();!S.done;S=_.next()){_loop_4(S.value)}}catch(t){n={error:t}}finally{try{S&&!S.done&&(i=_.return)&&i.call(_)}finally{if(n)throw n.error}}return g},ZodEffects.create=function(t){return new ZodEffects({schema:t})},ZodEffects}(A),le=function(t){function ZodOptional(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodOptional,t),ZodOptional.prototype._parse=function(t){var n=this,i=t.data;if(t.parsedType!==S.undefined)return(new O).then((function(){return n._def.innerType._parseWithInvalidFallback(i,__assign(__assign({},t),{parentError:t.currentError}))}))},ZodOptional.prototype.unwrap=function(){return this._def.innerType},ZodOptional.create=function(t){return new ZodOptional({innerType:t})},ZodOptional}(A),he=function(t){function ZodNullable(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodNullable,t),ZodNullable.prototype._parse=function(t){var n=this;return t.parsedType===S.null?null:(new O).then((function(){return n._def.innerType._parseWithInvalidFallback(t.data,__assign(__assign({},t),{parentError:t.currentError}))}))},ZodNullable.prototype.unwrap=function(){return this._def.innerType},ZodNullable.create=function(t){return new ZodNullable({innerType:t})},ZodNullable}(A),de=function(t){function ZodDefault(){return null!==t&&t.apply(this,arguments)||this}return __extends(ZodDefault,t),ZodDefault.prototype._parse=function(t){var n=this,i=t.data;return t.parsedType===S.undefined&&(i=this._def.defaultValue()),(new O).then((function(){return n._def.innerType._parseWithInvalidFallback(i,__assign(__assign({},t),{parentError:t.currentError}))}))},ZodDefault.prototype.removeDefault=function(){return this._def.innerType},ZodDefault.create=function(t){return new le({innerType:t})},ZodDefault}(A),custom=function(t,n){return t?z.create().refine(t,n):z.create()},pe={object:Y.lazycreate},instanceOfType=function(t,n){return void 0===n&&(n={message:"Input not instance of "+t.name}),custom((function(n){return n instanceof t}),n)},fe=R.create,me=N.create,ge=I.create,ye=j.create,ve=V.create,be=U.create,_e=G.create,we=z.create,xe=H.create,Se=q.create,Me=Z.create,Ee=X.create,Te=Y.create,Ce=Y.strictCreate,Oe=J.create,Ae=K.create,Pe=$.create,Le=ee.create,Re=te.create,Ne=ne.create,Ie=re.create,ke=ie.create,je=oe.create,Fe=ae.create,De=se.create,Be=ce.create,Ve=ue.create,Ue=le.create,Ge=he.create,ostring=function(){return fe().optional()},onumber=function(){return me().optional()},oboolean=function(){return ye().optional()},ze=Object.freeze({__proto__:null,ZodParsedType:S,getParsedType,issueHelpers,ZodType:A,ZodString:R,ZodNumber:N,ZodBigInt:I,ZodBoolean:j,ZodDate:V,ZodUndefined:U,ZodNull:G,ZodAny:z,ZodUnknown:H,ZodNever:q,ZodVoid:Z,ZodArray:X,ZodNonEmptyArray:Q,get objectUtil(){return M},mergeObjects,ZodObject:Y,ZodUnion:J,ZodIntersection:K,ZodTuple:$,ZodRecord:ee,ZodMap:te,ZodSet:ne,ZodFunction:re,ZodLazy:ie,ZodLiteral:oe,ZodEnum:ae,ZodNativeEnum:se,ZodPromise:ce,ZodEffects:ue,ZodTransformer:ue,ZodOptional:le,ZodNullable:he,ZodDefault:de,custom,Schema:A,ZodSchema:A,late:pe,any:we,array:Ee,bigint:ge,boolean:ye,date:ve,effect:Ve,enum:Fe,function:Ie,instanceof:instanceOfType,intersection:Ae,lazy:ke,literal:je,map:Re,nativeEnum:De,never:Se,null:_e,nullable:Ge,number:me,object:Te,oboolean,onumber,optional:Ue,ostring,promise:Be,record:Le,set:Ne,strictObject:Ce,string:fe,transformer:Ve,tuple:Pe,undefined:be,union:Oe,unknown:xe,void:Me,ZodIssueCode:m,quotelessJson,ZodError:g,defaultErrorMap,get overrideErrorMap(){return _},setErrorMap})},function(t){t.exports=JSON.parse('{"metadataEndpoint":"https://app.byondvr.com/api/get_json_experience","metadataHashEndpoint":"https://api.byondxr.com/experience"}')},function(t,n,i){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var n,i=1,o=arguments.length;i<o;i++)for(var a in n=arguments[i])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.SceneMetadataManager=void 0;var s=a(i(51)),m=i(33),g=i(70),_=i(72),S=i(117),M=function(){function SceneMetadataManager(t){var n=this;this.sceneConfigurations=new Map,this.getMetaData=function(){if(!n.metaData)throw"no metaData";return n.metaData},this.getApiEndpoint=function(){return n.getMetaData().getCustomAttribute("api_endpoint")},this.getApiToken=function(){return n.getMetaData().getCustomAttribute("app_key")},this.getEmail=function(){return n.getMetaData().getCustomAttribute("user_email")},this.getPassword=function(){return n.getMetaData().getCustomAttribute("user_password")},this.getSceneTitle=function(t){var i;return null===(i=n.getSceneConfiguration(t))||void 0===i?void 0:i.scene.title},this.getSceneSubtitle=function(t){var i;return null===(i=n.getSceneConfiguration(t))||void 0===i?void 0:i.scene.subtitle},this.getMaxFaceSize=function(t){var i,o,a,s,m=n.visualizer.maxFaceSize||(null!==(o=null===(i=n.getSceneConfiguration(t))||void 0===i?void 0:i.maxFaceSize)&&void 0!==o?o:2048),g=n.visualizer.maxFaceSizeMobile||(null!==(s=null===(a=n.getSceneConfiguration(t))||void 0===a?void 0:a.maxFaceSizeMobile)&&void 0!==s?s:1024);return _.mobileAndTabletCheck()?g:m},this.visualizer=t}return SceneMetadataManager.prototype.init=function(t){this.metaData=t},SceneMetadataManager.prototype.getLocation=function(t){var n=t?this.getMetaData().locations.find((function(n){return n.byond_id===t})):this.getMetaData().locations[0],i=t?this.getMetaData().locations.findIndex((function(n){return n.byond_id===t})):0;if(!n)throw Error("no scene found "+t);return{index:i,experienceId:this.getMetaData().hash,id:n.byond_id,organization:n.getCustomAttribute("organization"),catalog:n.getCustomAttribute("catalog"),sceneConfigurations:n.getCustomAttribute(m.Constants.SCENE_CONFIGURATION)}},SceneMetadataManager.prototype.getScene=function(t){var n=t.id;return o({sceneId:t.id,experienceId:t.experienceId},this.getSceneConfiguration(n).scene)},SceneMetadataManager.prototype.getCatalogProps=function(t){var n=this.getLocation(t);return{experienceId:this.getMetaData().hash,apiEndoint:this.getApiEndpoint(),apiToken:this.getApiToken(),email:this.getEmail(),password:this.getPassword(),organization:n.organization,catalog:n.catalog}},SceneMetadataManager.prototype.getSceneList=function(){var t=this;return this.getMetaData().locations.map((function(n){var i=n.byond_id;return t.getScene(t.getLocation(i))}))},SceneMetadataManager.prototype.resetSceneConfigurations=function(){this.sceneConfigurations.clear()},SceneMetadataManager.prototype.getSceneConfiguration=function(t){var n,i,o,a,m,M,T,O=this;if(t){var A=this.sceneConfigurations.get(t);if(A)return A}var P=null!==(n=this.visualizer.appManager.currentExperience.getCustomAttribute("experience_configuration"))&&void 0!==n?n:{},L=(P=s.default(P)).defaults,R=P.configurations,N=null==R?void 0:R.find((function(t){return t.label===O.visualizer.sceneConfigurationLabel}));S.debug.log("expDefaults",L),S.debug.log("nonDefaultExpConfig",N);var I,j=_.mergeConfigs(null!=L?L:{},null!=N?N:{});if(S.debug.log("expConfig",j),t){var V=this.getLocation(t),U=null===(i=(V=s.default(V)).sceneConfigurations)||void 0===i?void 0:i.defaults,G=null===(a=null===(o=V.sceneConfigurations)||void 0===o?void 0:o.configurations)||void 0===a?void 0:a.find((function(t){return t.label===O.visualizer.sceneConfigurationLabel}));if((G=_.mergeConfigs(null!=U?U:{},null!=G?G:{}))&&G.scene)if(j&&j.scenes){if(G.scene.name){var z=G;(H=j.scenes.find((function(t){return t.name===z.scene.name})))?G.scene=H:console.warn("not found scene in scenes in experience configuration for name",G.scene.name)}else if(G.scene.names)if(G.scene.names.length<2)console.warn("names array in scene object in scene configuration level must have length > 2, otherwise use name");else{var H,q=G;if(H=j.scenes.find((function(t){var n;return t.name===(null===(n=q.scene.names)||void 0===n?void 0:n[0])}))){var Z=null===(m=H.subSelections)||void 0===m?void 0:m.find((function(t){var n;return t.name===(null===(n=q.scene.names)||void 0===n?void 0:n[1])}));Z?(delete H.subSelections,G.scene=H,G.scene.subSelection=Z):console.warn("not found subSelection in scenes in experience configuration for names[1]",G.scene.names[1])}else console.warn("not found scene in scenes in experience configuration for names[0]",G.scene.names[0])}else console.warn("no name or names in scene object in scene configuration level");delete j.scenes}else(G.scene.name||G.scene.names)&&console.warn("notice - there is no expConfig.scenes, but there is sceneConfig.scene.name or sceneConfig.scene.names");else console.warn("no scene object in scene configuration level");(null===(T=null===(M=null==(I=_.mergeConfigs(j,G))?void 0:I.catalogFilters)||void 0===M?void 0:M.products)||void 0===T?void 0:T.customFields)&&(I.catalogFilters.products.customFields=I.catalogFilters.products.customFields.map((function(t){return g.formatFilter(t,I.fieldsAliases)})))}else I=j;return _.traverse(I,(function(t,n){"visible"===n&&(t.visible="true"===t.visible||!0===t.visible)})),t&&this.sceneConfigurations.set(t,I),I},SceneMetadataManager}();n.SceneMetadataManager=M},function(t,n,i){var o=i(259);t.exports=function once(t){return o(2,t)}},function(t,n,i){var o=i(260);t.exports=function before(t,n){var i;if("function"!=typeof n)throw new TypeError("Expected a function");return t=o(t),function(){return--t>0&&(i=n.apply(this,arguments)),t<=1&&(n=void 0),i}}},function(t,n,i){var o=i(261);t.exports=function toInteger(t){var n=o(t),i=n%1;return n==n?i?n-i:n:0}},function(t,n,i){var o=i(262);t.exports=function toFinite(t){return t?(t=o(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}},function(t,n,i){var o=i(263),a=i(18),s=i(43),m=/^[-+]0x[0-9a-f]+$/i,g=/^0b[01]+$/i,_=/^0o[0-7]+$/i,S=parseInt;t.exports=function toNumber(t){if("number"==typeof t)return t;if(s(t))return NaN;if(a(t)){var n="function"==typeof t.valueOf?t.valueOf():t;t=a(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=o(t);var i=g.test(t);return i||_.test(t)?S(t.slice(2),i?2:8):m.test(t)?NaN:+t}},function(t,n,i){var o=i(264),a=/^\s+/;t.exports=function baseTrim(t){return t?t.slice(0,o(t)+1).replace(a,""):t}},function(t,n){var i=/\s/;t.exports=function trimmedEndIndex(t){for(var n=t.length;n--&&i.test(t.charAt(n)););return n}},function(t,n,i){"use strict";var o=this&&this.__awaiter||function(t,n,i,o){return new(i||(i=Promise))((function(a,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?a(t.value):function adopt(t){return t instanceof i?t:new i((function(n){n(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,n||[])).next())}))},a=this&&this.__generator||function(t,n){var i,o,a,s,m={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(s){return function(g){return function step(s){if(i)throw new TypeError("Generator is already executing.");for(;m;)try{if(i=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return m.label++,{value:s[1],done:!1};case 5:m.label++,o=s[1],s=[0];continue;case 7:s=m.ops.pop(),m.trys.pop();continue;default:if(!(a=m.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){m=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){m.label=s[1];break}if(6===s[0]&&m.label<a[1]){m.label=a[1],a=s;break}if(a&&m.label<a[2]){m.label=a[2],m.ops.push(s);break}a[2]&&m.ops.pop(),m.trys.pop();continue}s=n.call(t,m)}catch(t){s=[6,t],o=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,g])}}};function injectJsFile(t,n){return void 0===n&&(n="text/javascript"),o(this,void 0,void 0,(function(){return a(this,(function(i){return[2,new Promise((function(i,o){var a=document.createElement("script");a.async=!0,a.crossOrigin="anonymous",a.type=n,a.onload=function(){i(a)},a.onerror=function(t){o(t)},a.src=t,document.head.appendChild(a)}))]}))}))}Object.defineProperty(n,"__esModule",{value:!0}),n.sendPageViewGA=n.sendCustomGA=void 0;var s;function injectGA(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:t="https://www.googletagmanager.com/gtag/js",n.label=1;case 1:return n.trys.push([1,3,,4]),[4,injectJsFile(t)];case 2:return n.sent(),window.dataLayer=window.dataLayer||[],(s=function(){window.dataLayer.push(arguments)})("js",new Date),[3,4];case 3:return n.sent(),console.warn("error loading ga script"),[3,4];case 4:return[2]}}))}))}n.sendCustomGA=function sendCustomGA(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return s?[3,2]:[4,injectGA()];case 1:i.sent(),i.label=2;case 2:return s&&(s("config",t.trackingId,{page_path:"/ttttt",send_page_view:!1}),n={event_category:t.category,event_label:t.label,send_to:t.trackingId},s("event",t.action,n)),[2]}}))}))},n.sendPageViewGA=function sendPageViewGA(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return s?[3,2]:[4,injectGA()];case 1:n.sent(),n.label=2;case 2:return s&&s("event","page_view",{page_location:"/"+t.idLabel+"/"+t.idValue,page_title:"/"+t.idLabel+"/"+t.idValue,page_path:"/"+t.idLabel+"/"+t.idValue,send_to:t.trackingId}),[2]}}))}))}},function(t){t.exports=JSON.parse('{"name":"@byondrnd/byondxr-web-visualizer","version":"2.1.20","description":"Web XR Visualizer","main":"dist/index.js","types":"dist/index.d.ts","dependencies":{"@byondrnd/byond-web-lib":"1.0.202","amazon-cognito-identity-js":"^3.2.5","apollo-cache-inmemory":"^1.6.5","@apollo/client":"^3.3.11","graphql-crunch":"^2.1.3","lodash":"^4.17.21","tiny-typed-emitter":"^2.0.3","uuid":"^8.3.1","zod":"^3.2.0"},"devDependencies":{"@babel/core":"^7.12.3","@babel/plugin-proposal-decorators":"^7.12.1","@babel/plugin-transform-runtime":"^7.14.5","@babel/preset-env":"^7.12.1","@babel/preset-typescript":"^7.12.16","@byondrnd/showroom-schemas":"^1.0.310","@types/jest":"^26.0.20","@types/lodash":"^4.14.172","@types/uuid":"^8.3.0","babel-loader":"^8.2.2","babel-preset-env":"^1.7.0","copy-webpack-plugin":"^5.1.1","cross-var":"^1.1.0","del-cli":"^1.1.0","eslint-config-prettier":"^6.15.0","eslint-plugin-prefer-arrow":"^1.2.2","eslint-plugin-prettier":"^3.1.4","fork-ts-checker-webpack-plugin":"^1.6.0","html-loader":"^1.3.2","html-webpack-plugin":"^3.2.0","jest":"^26.6.3","serviceworker-webpack-plugin":"^1.0.1","terser-webpack-plugin":"^1.4.3","ts-jest":"^26.5.1","ts-loader":"^8.0.7","ts-node":"^10.1.0","ts-to-zod":"^1.3.0","tslint":"^5.20.1","tslint-no-circular-imports":"^0.6.2","typedoc":"^0.19.2","typescript":"^4.3.4","webpack":"^4.44.2","webpack-bundle-analyzer":"^3.9.0","webpack-cli":"^3.3.10","webpack-dev-server":"^3.11.0"},"scripts":{"test":"jest","clean":"del-cli dist/","copy-package":"cp package.json src/temp_read_version_package.json","start":"yarn copy-package && yarn clean && webpack-dev-server --open --config webpack.config.js --mode development","start-cdn":"yarn clean && webpack-dev-server --open --config webpack.cdn.config.js --mode development","build":"yarn copy-package && yarn clean && webpack --config webpack.config.js --mode production","build-ci":"yarn build","bump-version":"npm version patch -m \\"Upgrade to %s\\"","pack-visualizer":"yarn build && npm pack","update-lib":"del-cli .npmrc && npm uninstall --save @byondrnd/byond-web-lib && npm install --save @byondrnd/byond-web-lib && git checkout -- .npmrc","typedoc":"typedoc","create-doc":"yarn create-readme && yarn typedoc","extract-validation-types":"ts-node extractValidationTypes.ts","generate-validations":"yarn extract-validation-types && ts-to-zod generated-validationTypes.ts src/app/generated-validations.ts","create-readme":"cp README_TEMPLATE.md README.md && cross-var sed -i \'s/${version}/$npm_package_version/\' README.md"},"author":"Byond LTD.","homepage":"https://www.byondxr.com/","license":"ISC","unpkg":"dist/index.js"}')},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImageOptimizeService=void 0;var o=function(){function ImageOptimizeService(){this.media_optimization_api="https://image-optimiser.byondxr.com/resize"}return ImageOptimizeService.prototype.getImage=function(t,n){if(!function isImage(t){return/(jpeg)|(jpg)|(png)$/i.test(t)}(t))return t||"";var i=encodeURIComponent(t);return(this.media_optimization_api+"?image={{image_url}}&width={{image_width}}").replace("{{image_url}}",i).replace("{{image_width}}",n+"")},ImageOptimizeService.prototype.setUrl=function(t){t&&(this.media_optimization_api=t)},ImageOptimizeService}();n.ImageOptimizeService=o},function(t,n,i){"use strict";i.r(n),i.d(n,"ApolloClient",(function(){return Ue})),i.d(n,"mergeOptions",(function(){return mergeOptions})),i.d(n,"ObservableQuery",(function(){return me})),i.d(n,"applyNextFetchPolicy",(function(){return applyNextFetchPolicy})),i.d(n,"NetworkStatus",(function(){return ue})),i.d(n,"isApolloError",(function(){return isApolloError})),i.d(n,"ApolloError",(function(){return le})),i.d(n,"Cache",(function(){return Ve})),i.d(n,"ApolloCache",(function(){return Ge})),i.d(n,"InMemoryCache",(function(){return ct})),i.d(n,"MissingFieldError",(function(){return ze})),i.d(n,"defaultDataIdFromObject",(function(){return defaultDataIdFromObject})),i.d(n,"makeVar",(function(){return makeVar})),i.d(n,"empty",(function(){return ut.c})),i.d(n,"from",(function(){return ut.e})),i.d(n,"split",(function(){return ut.f})),i.d(n,"concat",(function(){return ut.b})),i.d(n,"execute",(function(){return ut.d})),i.d(n,"ApolloLink",(function(){return ut.a})),i.d(n,"parseAndCheckHttpResponse",(function(){return parseAndCheckHttpResponse})),i.d(n,"serializeFetchParameter",(function(){return serializeFetchParameter})),i.d(n,"fallbackHttpConfig",(function(){return A})),i.d(n,"selectHttpOptionsAndBody",(function(){return selectHttpOptionsAndBody})),i.d(n,"checkFetcher",(function(){return checkFetcher})),i.d(n,"createSignalIfSupported",(function(){return createSignalIfSupported})),i.d(n,"selectURI",(function(){return selectURI})),i.d(n,"createHttpLink",(function(){return createHttpLink})),i.d(n,"HttpLink",(function(){return R})),i.d(n,"rewriteURIForGET",(function(){return rewriteURIForGET})),i.d(n,"fromError",(function(){return fromError})),i.d(n,"toPromise",(function(){return toPromise})),i.d(n,"fromPromise",(function(){return fromPromise})),i.d(n,"throwServerError",(function(){return throwServerError})),i.d(n,"Observable",(function(){return M.a})),i.d(n,"isReference",(function(){return oe.g})),i.d(n,"makeReference",(function(){return oe.h})),i.d(n,"setLogVerbosity",(function(){return s.c})),i.d(n,"gql",(function(){return lt.gql})),i.d(n,"resetCaches",(function(){return lt.resetCaches})),i.d(n,"disableFragmentWarnings",(function(){return lt.disableFragmentWarnings})),i.d(n,"enableExperimentalFragmentVariables",(function(){return lt.enableExperimentalFragmentVariables})),i.d(n,"disableExperimentalFragmentVariables",(function(){return lt.disableExperimentalFragmentVariables}));var o=i(29),a=i(0),s=i(1),m=i(9),g=i(109),_=i(102),S=i(75),M=i(30),serializeFetchParameter=function(t,n){var i;try{i=JSON.stringify(t)}catch(t){var o=__DEV__?new s.a("Network request failed. "+n+" is not serializable: "+t.message):new s.a(26);throw o.parseError=t,o}return i},selectURI=function(t,n){var i=t.getContext().uri;return i||("function"==typeof n?n(t):n||"/graphql")},throwServerError=function(t,n,i){var o=new Error(i);throw o.name="ServerError",o.response=t,o.statusCode=t.status,o.result=n,o},T=Object.prototype.hasOwnProperty;function parseAndCheckHttpResponse(t){return function(n){return n.text().then((function(t){try{return JSON.parse(t)}catch(o){var i=o;throw i.name="ServerParseError",i.response=n,i.statusCode=n.status,i.bodyText=t,i}})).then((function(i){return n.status>=300&&throwServerError(n,i,"Response not successful: Received status code "+n.status),Array.isArray(i)||T.call(i,"data")||T.call(i,"errors")||throwServerError(n,i,"Server response was missing for query '"+(Array.isArray(t)?t.map((function(t){return t.operationName})):t.operationName)+"'."),i}))}}var checkFetcher=function(t){if(!t&&"undefined"==typeof fetch)throw __DEV__?new s.a("\n\"fetch\" has not been found globally and no fetcher has been configured. To fix this, install a fetch package (like https://www.npmjs.com/package/cross-fetch), instantiate the fetcher, and pass it into your HttpLink constructor. For example:\n\nimport fetch from 'cross-fetch';\nimport { ApolloClient, HttpLink } from '@apollo/client';\nconst client = new ApolloClient({\n  link: new HttpLink({ uri: '/graphql', fetch })\n});\n    "):new s.a(25)},O=i(74),A={http:{includeQuery:!0,includeExtensions:!1},headers:{accept:"*/*","content-type":"application/json"},options:{method:"POST"}},selectHttpOptionsAndBody=function(t,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=Object(a.a)(Object(a.a)({},n.options),{headers:n.headers,credentials:n.credentials}),m=n.http||{};i.forEach((function(t){s=Object(a.a)(Object(a.a)(Object(a.a)({},s),t.options),{headers:Object(a.a)(Object(a.a)({},s.headers),headersToLowerCase(t.headers))}),t.credentials&&(s.credentials=t.credentials),m=Object(a.a)(Object(a.a)({},m),t.http)}));var g=t.operationName,_=t.extensions,S=t.variables,M=t.query,T={operationName:g,variables:S};return m.includeExtensions&&(T.extensions=_),m.includeQuery&&(T.query=Object(O.a)(M)),{options:s,body:T}};function headersToLowerCase(t){if(t){var n=Object.create(null);return Object.keys(Object(t)).forEach((function(i){n[i.toLowerCase()]=t[i]})),n}return t}var createSignalIfSupported=function(){if("undefined"==typeof AbortController)return{controller:!1,signal:!1};var t=new AbortController;return{controller:t,signal:t.signal}};function rewriteURIForGET(t,n){var i=[],addQueryParam=function(t,n){i.push(t+"="+encodeURIComponent(n))};if("query"in n&&addQueryParam("query",n.query),n.operationName&&addQueryParam("operationName",n.operationName),n.variables){var o=void 0;try{o=serializeFetchParameter(n.variables,"Variables map")}catch(t){return{parseError:t}}addQueryParam("variables",o)}if(n.extensions){var a=void 0;try{a=serializeFetchParameter(n.extensions,"Extensions map")}catch(t){return{parseError:t}}addQueryParam("extensions",a)}var s="",m=t,g=t.indexOf("#");-1!==g&&(s=t.substr(g),m=t.substr(0,g));var _=-1===m.indexOf("?")?"?":"&";return{newURI:m+_+i.join("&")+s}}function fromError(t){return new M.a((function(n){n.error(t)}))}var P=i(16),L=Object(P.a)((function(){return fetch})),createHttpLink=function(t){void 0===t&&(t={});var n=t.uri,i=void 0===n?"/graphql":n,o=t.fetch,s=t.includeExtensions,g=t.useGETForQueries,_=t.includeUnusedVariables,T=void 0!==_&&_,O=Object(a.e)(t,["uri","fetch","includeExtensions","useGETForQueries","includeUnusedVariables"]);__DEV__&&checkFetcher(o||L);var R={http:{includeExtensions:s},options:O.fetchOptions,credentials:O.credentials,headers:O.headers};return new m.a((function(t){var n=selectURI(t,i),s=t.getContext(),m={};if(s.clientAwareness){var _=s.clientAwareness,O=_.name,N=_.version;O&&(m["apollographql-client-name"]=O),N&&(m["apollographql-client-version"]=N)}var I,j=Object(a.a)(Object(a.a)({},m),s.headers),V={http:s.http,options:s.fetchOptions,credentials:s.credentials,headers:j},U=selectHttpOptionsAndBody(t,A,R,V),G=U.options,z=U.body;if(z.variables&&!T){var H=new Set(Object.keys(z.variables));Object(S.b)(t.query,{Variable:function(t,n,i){i&&"VariableDefinition"!==i.kind&&H.delete(t.name.value)}}),H.size&&(z.variables=Object(a.a)({},z.variables),H.forEach((function(t){delete z.variables[t]})))}if(!G.signal){var q=createSignalIfSupported(),Z=q.controller,X=q.signal;(I=Z)&&(G.signal=X)}if(g&&!t.query.definitions.some((function(t){return"OperationDefinition"===t.kind&&"mutation"===t.operation}))&&(G.method="GET"),"GET"===G.method){var Q=rewriteURIForGET(n,z),Y=Q.newURI,J=Q.parseError;if(J)return fromError(J);n=Y}else try{G.body=serializeFetchParameter(z,"Payload")}catch(J){return fromError(J)}return new M.a((function(i){return(o||Object(P.a)((function(){return fetch}))||L)(n,G).then((function(n){return t.setContext({response:n}),n})).then(parseAndCheckHttpResponse(t)).then((function(t){return i.next(t),i.complete(),t})).catch((function(t){"AbortError"!==t.name&&(t.result&&t.result.errors&&t.result.data&&i.next(t.result),i.error(t))})),function(){I&&I.abort()}}))}))},R=function(t){function HttpLink(n){void 0===n&&(n={});var i=t.call(this,createHttpLink(n).request)||this;return i.options=n,i}return Object(a.c)(HttpLink,t),HttpLink}(m.a),N=Object.prototype,I=N.toString,j=N.hasOwnProperty,V=Function.prototype.toString,U=new Map;function equal(t,n){try{return function check(t,n){if(t===n)return!0;var i=I.call(t),o=I.call(n);if(i!==o)return!1;switch(i){case"[object Array]":if(t.length!==n.length)return!1;case"[object Object]":if(previouslyCompared(t,n))return!0;var a=definedKeys(t),s=definedKeys(n),m=a.length;if(m!==s.length)return!1;for(var g=0;g<m;++g)if(!j.call(n,a[g]))return!1;for(g=0;g<m;++g){var _=a[g];if(!check(t[_],n[_]))return!1}return!0;case"[object Error]":return t.name===n.name&&t.message===n.message;case"[object Number]":if(t!=t)return n!=n;case"[object Boolean]":case"[object Date]":return+t==+n;case"[object RegExp]":case"[object String]":return t==""+n;case"[object Map]":case"[object Set]":if(t.size!==n.size)return!1;if(previouslyCompared(t,n))return!0;for(var S=t.entries(),M="[object Map]"===i;;){var T=S.next();if(T.done)break;var O=T.value,A=O[0],P=O[1];if(!n.has(A))return!1;if(M&&!check(P,n.get(A)))return!1}return!0;case"[object Uint16Array]":case"[object Uint8Array]":case"[object Uint32Array]":case"[object Int32Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object ArrayBuffer]":t=new Uint8Array(t),n=new Uint8Array(n);case"[object DataView]":var L=t.byteLength;if(L===n.byteLength)for(;L--&&t[L]===n[L];);return-1===L;case"[object AsyncFunction]":case"[object GeneratorFunction]":case"[object AsyncGeneratorFunction]":case"[object Function]":var R=V.call(t);return R===V.call(n)&&!function endsWith(t,n){var i=t.length-n.length;return i>=0&&t.indexOf(n,i)===i}(R,G)}return!1}(t,n)}finally{U.clear()}}function definedKeys(t){return Object.keys(t).filter(isDefinedKey,t)}function isDefinedKey(t){return void 0!==this[t]}var G="{ [native code] }";function previouslyCompared(t,n){var i=U.get(t);if(i){if(i.has(n))return!0}else U.set(t,i=new Set);return i.add(n),!1}var defaultMakeData=function(){return Object.create(null)},z=Array.prototype,H=z.forEach,q=z.slice,Z=function(){function Trie(t,n){void 0===t&&(t=!0),void 0===n&&(n=defaultMakeData),this.weakness=t,this.makeData=n}return Trie.prototype.lookup=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this.lookupArray(t)},Trie.prototype.lookupArray=function(t){var n=this;return H.call(t,(function(t){return n=n.getChildTrie(t)})),n.data||(n.data=this.makeData(q.call(t)))},Trie.prototype.getChildTrie=function(t){var n=this.weakness&&function isObjRef(t){switch(typeof t){case"object":if(null===t)break;case"function":return!0}return!1}(t)?this.weak||(this.weak=new WeakMap):this.strong||(this.strong=new Map),i=n.get(t);return i||n.set(t,i=new Trie(this.weakness,this.makeData)),i},Trie}();var X=i(10),Q=i(103);var Y,J,K=function(){function ObjectCanon(){this.known=new(Q.b?WeakSet:Set),this.pool=new Z(Q.a),this.passes=new WeakMap,this.keysByJSON=new Map,this.empty=this.admit({})}return ObjectCanon.prototype.isKnown=function(t){return Object(X.a)(t)&&this.known.has(t)},ObjectCanon.prototype.pass=function(t){if(Object(X.a)(t)){var n=function shallowCopy(t){return Object(X.a)(t)?Array.isArray(t)?t.slice(0):Object(a.a)({__proto__:Object.getPrototypeOf(t)},t):t}(t);return this.passes.set(n,t),n}return t},ObjectCanon.prototype.admit=function(t){var n=this;if(Object(X.a)(t)){var i=this.passes.get(t);if(i)return i;switch(Object.getPrototypeOf(t)){case Array.prototype:if(this.known.has(t))return t;var o=t.map(this.admit,this);return(g=this.pool.lookupArray(o)).array||(this.known.add(g.array=o),__DEV__&&Object.freeze(o)),g.array;case null:case Object.prototype:if(this.known.has(t))return t;var a=Object.getPrototypeOf(t),s=[a],m=this.sortedKeys(t);s.push(m.json);var g,_=s.length;if(m.sorted.forEach((function(i){s.push(n.admit(t[i]))})),!(g=this.pool.lookupArray(s)).object){var S=g.object=Object.create(a);this.known.add(S),m.sorted.forEach((function(t,n){S[t]=s[_+n]})),__DEV__&&Object.freeze(S)}return g.object}}return t},ObjectCanon.prototype.sortedKeys=function(t){var n=Object.keys(t),i=this.pool.lookupArray(n);if(!i.keys){n.sort();var o=JSON.stringify(n);(i.keys=this.keysByJSON.get(o))||this.keysByJSON.set(o,i.keys={sorted:n,json:o})}return i.keys},ObjectCanon}(),$=Object.assign((function(t){if(Object(X.a)(t)){void 0===Y&&resetCanonicalStringify();var n=Y.admit(t),i=J.get(n);return void 0===i&&J.set(n,i=JSON.stringify(n)),i}return JSON.stringify(t)}),{reset:resetCanonicalStringify});function resetCanonicalStringify(){Y=new K,J=new(Q.a?WeakMap:Map)}var ee=i(104),te=i(105),ne=i(8),re=i(20),ie=i(27),oe=i(7),ae=i(45),se=i(108),ce=i(106);function isApolloError(t){return t.hasOwnProperty("graphQLErrors")}__DEV__?Object(s.b)("boolean"==typeof o.a,o.a):Object(s.b)("boolean"==typeof o.a,22);var ue,le=function(t){function ApolloError(n){var i=n.graphQLErrors,o=n.clientErrors,a=n.networkError,s=n.errorMessage,m=n.extraInfo,g=t.call(this,s)||this;return g.graphQLErrors=i||[],g.clientErrors=o||[],g.networkError=a||null,g.message=s||function(t){var n="";(Object(ce.a)(t.graphQLErrors)||Object(ce.a)(t.clientErrors))&&(t.graphQLErrors||[]).concat(t.clientErrors||[]).forEach((function(t){var i=t?t.message:"Error message not found.";n+=i+"\n"}));return t.networkError&&(n+=t.networkError.message+"\n"),n=n.replace(/\n$/,"")}(g),g.extraInfo=m,g.__proto__=ApolloError.prototype,g}return Object(a.c)(ApolloError,t),ApolloError}(Error);function isNetworkRequestInFlight(t){return!!t&&t<7}!function(t){t[t.loading=1]="loading",t[t.setVariables=2]="setVariables",t[t.fetchMore=3]="fetchMore",t[t.refetch=4]="refetch",t[t.poll=6]="poll",t[t.ready=7]="ready",t[t.error=8]="error"}(ue||(ue={}));var he=i(107),de=i(28),pe=i(44),fe=!1,me=function(t){function ObservableQuery(n){var i=n.queryManager,o=n.queryInfo,a=n.options,s=t.call(this,(function(t){try{var n=t._subscription._observer;n&&!n.error&&(n.error=defaultSubscriptionObserverErrorCallback)}catch(t){}var i=!s.observers.size;s.observers.add(t);var o=s.last;return o&&o.error?t.error&&t.error(o.error):o&&o.result&&t.next&&t.next(o.result),i&&s.reobserve().catch((function(){})),function(){s.observers.delete(t)&&!s.observers.size&&s.tearDownQuery()}}))||this;s.observers=new Set,s.subscriptions=new Set,s.isTornDown=!1,s.options=a,s.queryId=o.queryId||i.generateQueryId();var m=Object(ne.f)(a.query);return s.queryName=m&&m.name&&m.name.value,s.initialFetchPolicy=a.fetchPolicy||"cache-first",s.queryManager=i,s.queryInfo=o,s}return Object(a.c)(ObservableQuery,t),Object.defineProperty(ObservableQuery.prototype,"variables",{get:function(){return this.options.variables},enumerable:!1,configurable:!0}),ObservableQuery.prototype.result=function(){var t=this;return new Promise((function(n,i){var o={next:function(i){n(i),t.observers.delete(o),t.observers.size||t.queryManager.removeQuery(t.queryId),setTimeout((function(){a.unsubscribe()}),0)},error:i},a=t.subscribe(o)}))},ObservableQuery.prototype.getCurrentResult=function(t){void 0===t&&(t=!0);var n=this.getLastResult(!0),i=this.queryInfo.networkStatus||n&&n.networkStatus||ue.ready,o=Object(a.a)(Object(a.a)({},n),{loading:isNetworkRequestInFlight(i),networkStatus:i});if(!this.queryManager.transform(this.options.query).hasForcedResolvers){var s=this.queryInfo.getDiff();(s.complete||this.options.returnPartialData)&&(o.data=s.result),equal(o.data,{})&&(o.data=void 0);var m=this.options.fetchPolicy,g=void 0===m?"cache-first":m;s.complete?(o.networkStatus!==ue.loading||"cache-first"!==g&&"cache-only"!==g||(o.networkStatus=ue.ready,o.loading=!1),delete o.partial):"no-cache"!==g&&(o.partial=!0),!__DEV__||s.complete||this.options.partialRefetch||o.loading||o.data||o.error||logMissingFieldErrors(s.missing)}return t&&this.updateLastResult(o),o},ObservableQuery.prototype.isDifferentFromLastResult=function(t){return!this.last||!equal(this.last.result,t)},ObservableQuery.prototype.getLast=function(t,n){var i=this.last;if(i&&i[t]&&(!n||equal(i.variables,this.variables)))return i[t]},ObservableQuery.prototype.getLastResult=function(t){return this.getLast("result",t)},ObservableQuery.prototype.getLastError=function(t){return this.getLast("error",t)},ObservableQuery.prototype.resetLastResults=function(){delete this.last,this.isTornDown=!1},ObservableQuery.prototype.resetQueryStoreErrors=function(){this.queryManager.resetErrors(this.queryId)},ObservableQuery.prototype.refetch=function(t){var n={pollInterval:0},i=this.options.fetchPolicy;return"no-cache"===i?n.fetchPolicy="no-cache":"cache-and-network"!==i&&(n.fetchPolicy="network-only"),t&&!equal(this.options.variables,t)&&(n.variables=this.options.variables=Object(a.a)(Object(a.a)({},this.options.variables),t)),this.queryInfo.resetLastWrite(),this.reobserve(n,ue.refetch)},ObservableQuery.prototype.fetchMore=function(t){var n=this,i=Object(a.a)(Object(a.a)({},t.query?t:Object(a.a)(Object(a.a)(Object(a.a)({},this.options),t),{variables:Object(a.a)(Object(a.a)({},this.options.variables),t.variables)})),{fetchPolicy:"no-cache"}),o=this.queryManager.generateQueryId();return i.notifyOnNetworkStatusChange&&(this.queryInfo.networkStatus=ue.fetchMore,this.observe()),this.queryManager.fetchQuery(o,i,ue.fetchMore).then((function(o){var a=o.data,m=t.updateQuery;return m?(__DEV__&&!fe&&(__DEV__&&s.b.warn("The updateQuery callback for fetchMore is deprecated, and will be removed\nin the next major version of Apollo Client.\n\nPlease convert updateQuery functions to field policies with appropriate\nread and merge functions, or use/adapt a helper function (such as\nconcatPagination, offsetLimitPagination, or relayStylePagination) from\n@apollo/client/utilities.\n\nThe field policy system handles pagination more effectively than a\nhand-written updateQuery function, and you only need to define the policy\nonce, rather than every time you call fetchMore."),fe=!0),n.updateQuery((function(t){return m(t,{fetchMoreResult:a,variables:i.variables})}))):n.queryManager.cache.writeQuery({query:i.query,variables:i.variables,data:a}),o})).finally((function(){n.queryManager.stopQuery(o),n.reobserve()}))},ObservableQuery.prototype.subscribeToMore=function(t){var n=this,i=this.queryManager.startGraphQLSubscription({query:t.document,variables:t.variables,context:t.context}).subscribe({next:function(i){var o=t.updateQuery;o&&n.updateQuery((function(t,n){var a=n.variables;return o(t,{subscriptionData:i,variables:a})}))},error:function(n){t.onError?t.onError(n):__DEV__&&s.b.error("Unhandled GraphQL subscription error",n)}});return this.subscriptions.add(i),function(){n.subscriptions.delete(i)&&i.unsubscribe()}},ObservableQuery.prototype.setOptions=function(t){return this.reobserve(t)},ObservableQuery.prototype.setVariables=function(t){return equal(this.variables,t)?this.observers.size?this.result():Promise.resolve():(this.options.variables=t,this.observers.size?this.reobserve({fetchPolicy:this.initialFetchPolicy,variables:t},ue.setVariables):Promise.resolve())},ObservableQuery.prototype.updateQuery=function(t){var n=this.queryManager,i=t(n.cache.diff({query:this.options.query,variables:this.variables,returnPartialData:!0,optimistic:!1}).result,{variables:this.variables});i&&(n.cache.writeQuery({query:this.options.query,data:i,variables:this.variables}),n.broadcastQueries())},ObservableQuery.prototype.startPolling=function(t){this.options.pollInterval=t,this.updatePolling()},ObservableQuery.prototype.stopPolling=function(){this.options.pollInterval=0,this.updatePolling()},ObservableQuery.prototype.fetch=function(t,n){return this.queryManager.setObservableQuery(this),this.queryManager.fetchQueryObservable(this.queryId,t,n)},ObservableQuery.prototype.updatePolling=function(){var t=this;if(!this.queryManager.ssrMode){var n=this.pollingInfo,i=this.options.pollInterval;if(i){if(!n||n.interval!==i){__DEV__?Object(s.b)(i,"Attempted to start a polling query without a polling interval."):Object(s.b)(i,13),(n||(this.pollingInfo={})).interval=i;var maybeFetch=function(){t.pollingInfo&&(isNetworkRequestInFlight(t.queryInfo.networkStatus)?poll():t.reobserve({fetchPolicy:"network-only"},ue.poll).then(poll,poll))},poll=function(){var n=t.pollingInfo;n&&(clearTimeout(n.timeout),n.timeout=setTimeout(maybeFetch,n.interval))};poll()}}else n&&(clearTimeout(n.timeout),delete this.pollingInfo)}},ObservableQuery.prototype.updateLastResult=function(t,n){return void 0===n&&(n=this.variables),this.last=Object(a.a)(Object(a.a)({},this.last),{result:this.queryManager.assumeImmutableResults?t:Object(he.a)(t),variables:n}),Object(ce.a)(t.errors)||delete this.last.error,this.last},ObservableQuery.prototype.reobserve=function(t,n){var i=this;this.isTornDown=!1;var o=n===ue.refetch||n===ue.fetchMore||n===ue.poll,s=this.options.variables,m=o?Object(_.a)(this.options,t):Object.assign(this.options,Object(_.a)(t));o||(this.updatePolling(),t&&t.variables&&!t.fetchPolicy&&!equal(t.variables,s)&&(m.fetchPolicy=this.initialFetchPolicy,void 0===n&&(n=ue.setVariables)));var g=m.variables&&Object(a.a)({},m.variables),S=this.fetch(m,n),M={next:function(t){i.reportResult(t,g)},error:function(t){i.reportError(t,g)}};return o||(this.concast&&this.observer&&this.concast.removeObserver(this.observer,!0),this.concast=S,this.observer=M),S.addObserver(M),S.promise},ObservableQuery.prototype.observe=function(){this.reportResult(this.getCurrentResult(!1),this.variables)},ObservableQuery.prototype.reportResult=function(t,n){(this.getLastError()||this.isDifferentFromLastResult(t))&&(this.updateLastResult(t,n),Object(de.a)(this.observers,"next",t))},ObservableQuery.prototype.reportError=function(t,n){var i=Object(a.a)(Object(a.a)({},this.getLastResult()),{error:t,errors:t.graphQLErrors,networkStatus:ue.error,loading:!1});this.updateLastResult(i,n),Object(de.a)(this.observers,"error",this.last.error=t)},ObservableQuery.prototype.hasObservers=function(){return this.observers.size>0},ObservableQuery.prototype.tearDownQuery=function(){this.isTornDown||(this.concast&&this.observer&&(this.concast.removeObserver(this.observer),delete this.concast,delete this.observer),this.stopPolling(),this.subscriptions.forEach((function(t){return t.unsubscribe()})),this.subscriptions.clear(),this.queryManager.stopQuery(this.queryId),this.observers.clear(),this.isTornDown=!0)},ObservableQuery}(M.a);function defaultSubscriptionObserverErrorCallback(t){__DEV__&&s.b.error("Unhandled error",t.message,t.stack)}function logMissingFieldErrors(t){__DEV__&&Object(ce.a)(t)&&__DEV__&&s.b.debug("Missing cache result fields: "+t.map((function(t){return t.path.join(".")})).join(", "),t)}function applyNextFetchPolicy(t){var n=t.fetchPolicy,i=void 0===n?"cache-first":n,o=t.nextFetchPolicy;o&&(t.fetchPolicy="function"==typeof o?o.call(t,i):o)}Object(pe.a)(me);var ge=i(34),ye=i(21),ve=null,be={},_e=1,we=Array,xe=we["@wry/context:Slot"]||function(){var t=function(){function Slot(){this.id=["slot",_e++,Date.now(),Math.random().toString(36).slice(2)].join(":")}return Slot.prototype.hasValue=function(){for(var t=ve;t;t=t.parent)if(this.id in t.slots){var n=t.slots[this.id];if(n===be)break;return t!==ve&&(ve.slots[this.id]=n),!0}return ve&&(ve.slots[this.id]=be),!1},Slot.prototype.getValue=function(){if(this.hasValue())return ve.slots[this.id]},Slot.prototype.withValue=function(t,n,i,o){var a,s=((a={__proto__:null})[this.id]=t,a),m=ve;ve={parent:m,slots:s};try{return n.apply(o,i)}finally{ve=m}},Slot.bind=function(t){var n=ve;return function(){var i=ve;try{return ve=n,t.apply(this,arguments)}finally{ve=i}}},Slot.noContext=function(t,n,i){if(!ve)return t.apply(i,n);var o=ve;try{return ve=null,t.apply(i,n)}finally{ve=o}},Slot}();try{Object.defineProperty(we,"@wry/context:Slot",{value:we["@wry/context:Slot"]=t,enumerable:!1,writable:!1,configurable:!1})}finally{return t}}();xe.bind,xe.noContext;function defaultDispose(){}var Se,Me=function(){function Cache(t,n){void 0===t&&(t=1/0),void 0===n&&(n=defaultDispose),this.max=t,this.dispose=n,this.map=new Map,this.newest=null,this.oldest=null}return Cache.prototype.has=function(t){return this.map.has(t)},Cache.prototype.get=function(t){var n=this.getNode(t);return n&&n.value},Cache.prototype.getNode=function(t){var n=this.map.get(t);if(n&&n!==this.newest){var i=n.older,o=n.newer;o&&(o.older=i),i&&(i.newer=o),n.older=this.newest,n.older.newer=n,n.newer=null,this.newest=n,n===this.oldest&&(this.oldest=o)}return n},Cache.prototype.set=function(t,n){var i=this.getNode(t);return i?i.value=n:(i={key:t,value:n,newer:null,older:this.newest},this.newest&&(this.newest.newer=i),this.newest=i,this.oldest=this.oldest||i,this.map.set(t,i),i.value)},Cache.prototype.clean=function(){for(;this.oldest&&this.map.size>this.max;)this.delete(this.oldest.key)},Cache.prototype.delete=function(t){var n=this.map.get(t);return!!n&&(n===this.newest&&(this.newest=n.older),n===this.oldest&&(this.oldest=n.newer),n.newer&&(n.newer.older=n.older),n.older&&(n.older.newer=n.newer),this.map.delete(t),this.dispose(n.value,t),!0)},Cache}(),Ee=new xe,Te=Object.prototype.hasOwnProperty,Ce=void 0===(Se=Array.from)?function(t){var n=[];return t.forEach((function(t){return n.push(t)})),n}:Se;function maybeUnsubscribe(t){var n=t.unsubscribe;"function"==typeof n&&(t.unsubscribe=void 0,n())}var Oe=[];function assert(t,n){if(!t)throw new Error(n||"assertion failure")}function valueGet(t){switch(t.length){case 0:throw new Error("unknown value");case 1:return t[0];case 2:throw t[1]}}var Ae=function(){function Entry(t){this.fn=t,this.parents=new Set,this.childValues=new Map,this.dirtyChildren=null,this.dirty=!0,this.recomputing=!1,this.value=[],this.deps=null,++Entry.count}return Entry.prototype.peek=function(){if(1===this.value.length&&!mightBeDirty(this))return rememberParent(this),this.value[0]},Entry.prototype.recompute=function(t){return assert(!this.recomputing,"already recomputing"),rememberParent(this),mightBeDirty(this)?function reallyRecompute(t,n){forgetChildren(t),Ee.withValue(t,recomputeNewValue,[t,n]),function maybeSubscribe(t,n){if("function"==typeof t.subscribe)try{maybeUnsubscribe(t),t.unsubscribe=t.subscribe.apply(null,n)}catch(n){return t.setDirty(),!1}return!0}(t,n)&&function setClean(t){if(t.dirty=!1,mightBeDirty(t))return;reportClean(t)}(t);return valueGet(t.value)}(this,t):valueGet(this.value)},Entry.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.value.length=0,reportDirty(this),maybeUnsubscribe(this))},Entry.prototype.dispose=function(){var t=this;this.setDirty(),forgetChildren(this),eachParent(this,(function(n,i){n.setDirty(),forgetChild(n,t)}))},Entry.prototype.forget=function(){this.dispose()},Entry.prototype.dependOn=function(t){t.add(this),this.deps||(this.deps=Oe.pop()||new Set),this.deps.add(t)},Entry.prototype.forgetDeps=function(){var t=this;this.deps&&(Ce(this.deps).forEach((function(n){return n.delete(t)})),this.deps.clear(),Oe.push(this.deps),this.deps=null)},Entry.count=0,Entry}();function rememberParent(t){var n=Ee.getValue();if(n)return t.parents.add(n),n.childValues.has(t)||n.childValues.set(t,[]),mightBeDirty(t)?reportDirtyChild(n,t):reportCleanChild(n,t),n}function recomputeNewValue(t,n){t.recomputing=!0,t.value.length=0;try{t.value[0]=t.fn.apply(null,n)}catch(n){t.value[1]=n}t.recomputing=!1}function mightBeDirty(t){return t.dirty||!(!t.dirtyChildren||!t.dirtyChildren.size)}function reportDirty(t){eachParent(t,reportDirtyChild)}function reportClean(t){eachParent(t,reportCleanChild)}function eachParent(t,n){var i=t.parents.size;if(i)for(var o=Ce(t.parents),a=0;a<i;++a)n(o[a],t)}function reportDirtyChild(t,n){assert(t.childValues.has(n)),assert(mightBeDirty(n));var i=!mightBeDirty(t);if(t.dirtyChildren){if(t.dirtyChildren.has(n))return}else t.dirtyChildren=Oe.pop()||new Set;t.dirtyChildren.add(n),i&&reportDirty(t)}function reportCleanChild(t,n){assert(t.childValues.has(n)),assert(!mightBeDirty(n));var i=t.childValues.get(n);0===i.length?t.childValues.set(n,function valueCopy(t){return t.slice(0)}(n.value)):function valueIs(t,n){var i=t.length;return i>0&&i===n.length&&t[i-1]===n[i-1]}(i,n.value)||t.setDirty(),removeDirtyChild(t,n),mightBeDirty(t)||reportClean(t)}function removeDirtyChild(t,n){var i=t.dirtyChildren;i&&(i.delete(n),0===i.size&&(Oe.length<100&&Oe.push(i),t.dirtyChildren=null))}function forgetChildren(t){t.childValues.size>0&&t.childValues.forEach((function(n,i){forgetChild(t,i)})),t.forgetDeps(),assert(null===t.dirtyChildren)}function forgetChild(t,n){n.parents.delete(t),t.childValues.delete(n),removeDirtyChild(t,n)}var Pe={setDirty:!0,dispose:!0,forget:!0};function dep(t){var n=new Map,i=t&&t.subscribe;function depend(t){var o=Ee.getValue();if(o){var a=n.get(t);a||n.set(t,a=new Set),o.dependOn(a),"function"==typeof i&&(maybeUnsubscribe(a),a.unsubscribe=i(t))}}return depend.dirty=function dirty(t,i){var o=n.get(t);if(o){var a=i&&Te.call(Pe,i)?i:"setDirty";Ce(o).forEach((function(t){return t[a]()})),n.delete(t),maybeUnsubscribe(o)}},depend}function makeDefaultMakeCacheKeyFunction(){var t=new Z("function"==typeof WeakMap);return function(){return t.lookupArray(arguments)}}makeDefaultMakeCacheKeyFunction();var Le=new Set;function wrap(t,n){void 0===n&&(n=Object.create(null));var i=new Me(n.max||Math.pow(2,16),(function(t){return t.dispose()})),o=n.keyArgs,a=n.makeCacheKey||makeDefaultMakeCacheKeyFunction(),optimistic=function(){var s=a.apply(null,o?o.apply(null,arguments):arguments);if(void 0===s)return t.apply(null,arguments);var m=i.get(s);m||(i.set(s,m=new Ae(t)),m.subscribe=n.subscribe,m.forget=function(){return i.delete(s)});var g=m.recompute(Array.prototype.slice.call(arguments));return i.set(s,m),Le.add(i),Ee.hasValue()||(Le.forEach((function(t){return t.clean()})),Le.clear()),g};function dirtyKey(t){var n=i.get(t);n&&n.setDirty()}function peekKey(t){var n=i.get(t);if(n)return n.peek()}function forgetKey(t){return i.delete(t)}return Object.defineProperty(optimistic,"size",{get:function(){return i.map.size},configurable:!1,enumerable:!1}),optimistic.dirtyKey=dirtyKey,optimistic.dirty=function dirty(){dirtyKey(a.apply(null,arguments))},optimistic.peekKey=peekKey,optimistic.peek=function peek(){return peekKey(a.apply(null,arguments))},optimistic.forgetKey=forgetKey,optimistic.forget=function forget(){return forgetKey(a.apply(null,arguments))},optimistic.makeCacheKey=a,optimistic.getKey=o?function getKey(){return a.apply(null,o.apply(null,arguments))}:a,Object.freeze(optimistic)}var Re=new xe,Ne=new WeakMap;function getCacheInfo(t){var n=Ne.get(t);return n||Ne.set(t,n={vars:new Set,dep:dep()}),n}function makeVar(t){var n=new Set,i=new Set,rv=function(a){if(arguments.length>0){if(t!==a){t=a,n.forEach((function(t){getCacheInfo(t).dep.dirty(rv),broadcast(t)}));var s=Array.from(i);i.clear(),s.forEach((function(n){return n(t)}))}}else{var m=Re.getValue();m&&(o(m),getCacheInfo(m).dep(rv))}return t};rv.onNextChange=function(t){return i.add(t),function(){i.delete(t)}};var o=rv.attachCache=function(t){return n.add(t),getCacheInfo(t).vars.add(rv),rv};return rv.forgetCache=function(t){return n.delete(t)},rv}function broadcast(t){t.broadcastWatches&&t.broadcastWatches()}var Ie=function(){function LocalState(t){var n=t.cache,i=t.client,o=t.resolvers,a=t.fragmentMatcher;this.cache=n,i&&(this.client=i),o&&this.addResolvers(o),a&&this.setFragmentMatcher(a)}return LocalState.prototype.addResolvers=function(t){var n=this;this.resolvers=this.resolvers||{},Array.isArray(t)?t.forEach((function(t){n.resolvers=Object(ge.b)(n.resolvers,t)})):this.resolvers=Object(ge.b)(this.resolvers,t)},LocalState.prototype.setResolvers=function(t){this.resolvers={},this.addResolvers(t)},LocalState.prototype.getResolvers=function(){return this.resolvers||{}},LocalState.prototype.runResolvers=function(t){var n=t.document,i=t.remoteResult,o=t.context,s=t.variables,m=t.onlyRunForcedResolvers,g=void 0!==m&&m;return Object(a.b)(this,void 0,void 0,(function(){return Object(a.d)(this,(function(t){return n?[2,this.resolveDocument(n,i.data,o,s,this.fragmentMatcher,g).then((function(t){return Object(a.a)(Object(a.a)({},i),{data:t.result})}))]:[2,i]}))}))},LocalState.prototype.setFragmentMatcher=function(t){this.fragmentMatcher=t},LocalState.prototype.getFragmentMatcher=function(){return this.fragmentMatcher},LocalState.prototype.clientQuery=function(t){return Object(ie.d)(["client"],t)&&this.resolvers?t:null},LocalState.prototype.serverQuery=function(t){return Object(re.d)(t)},LocalState.prototype.prepareContext=function(t){var n=this.cache;return Object(a.a)(Object(a.a)({},t),{cache:n,getCacheKey:function(t){return n.identify(t)}})},LocalState.prototype.addExportedVariables=function(t,n,i){return void 0===n&&(n={}),void 0===i&&(i={}),Object(a.b)(this,void 0,void 0,(function(){return Object(a.d)(this,(function(o){return t?[2,this.resolveDocument(t,this.buildRootValueFromCache(t,n)||{},this.prepareContext(i),n).then((function(t){return Object(a.a)(Object(a.a)({},n),t.exportedVariables)}))]:[2,Object(a.a)({},n)]}))}))},LocalState.prototype.shouldForceResolvers=function(t){var n=!1;return Object(S.b)(t,{Directive:{enter:function(t){if("client"===t.name.value&&t.arguments&&(n=t.arguments.some((function(t){return"always"===t.name.value&&"BooleanValue"===t.value.kind&&!0===t.value.value}))))return S.a}}}),n},LocalState.prototype.buildRootValueFromCache=function(t,n){return this.cache.diff({query:Object(re.b)(t),variables:n,returnPartialData:!0,optimistic:!1}).result},LocalState.prototype.resolveDocument=function(t,n,i,o,s,m){return void 0===i&&(i={}),void 0===o&&(o={}),void 0===s&&(s=function(){return!0}),void 0===m&&(m=!1),Object(a.b)(this,void 0,void 0,(function(){var g,_,S,M,T,O,A,P,L;return Object(a.d)(this,(function(R){return g=Object(ne.e)(t),_=Object(ne.d)(t),S=Object(ye.a)(_),M=g.operation,T=M?M.charAt(0).toUpperCase()+M.slice(1):"Query",A=(O=this).cache,P=O.client,L={fragmentMap:S,context:Object(a.a)(Object(a.a)({},i),{cache:A,client:P}),variables:o,fragmentMatcher:s,defaultOperationType:T,exportedVariables:{},onlyRunForcedResolvers:m},[2,this.resolveSelectionSet(g.selectionSet,n,L).then((function(t){return{result:t,exportedVariables:L.exportedVariables}}))]}))}))},LocalState.prototype.resolveSelectionSet=function(t,n,i){return Object(a.b)(this,void 0,void 0,(function(){var o,m,g,_,S,M=this;return Object(a.d)(this,(function(T){return o=i.fragmentMap,m=i.context,g=i.variables,_=[n],S=function(t){return Object(a.b)(M,void 0,void 0,(function(){var S,M;return Object(a.d)(this,(function(a){return Object(ie.e)(t,g)?Object(oe.e)(t)?[2,this.resolveField(t,n,i).then((function(n){var i;void 0!==n&&_.push(((i={})[Object(oe.i)(t)]=n,i))}))]:(Object(oe.f)(t)?S=t:(S=o[t.name.value],__DEV__?Object(s.b)(S,"No fragment named "+t.name.value):Object(s.b)(S,12)),S&&S.typeCondition&&(M=S.typeCondition.name.value,i.fragmentMatcher(n,M,m))?[2,this.resolveSelectionSet(S.selectionSet,n,i).then((function(t){_.push(t)}))]:[2]):[2]}))}))},[2,Promise.all(t.selections.map(S)).then((function(){return Object(ge.c)(_)}))]}))}))},LocalState.prototype.resolveField=function(t,n,i){return Object(a.b)(this,void 0,void 0,(function(){var o,s,m,g,_,S,M,T,O,A=this;return Object(a.d)(this,(function(a){return o=i.variables,s=t.name.value,m=Object(oe.i)(t),g=s!==m,_=n[m]||n[s],S=Promise.resolve(_),i.onlyRunForcedResolvers&&!this.shouldForceResolvers(t)||(M=n.__typename||i.defaultOperationType,(T=this.resolvers&&this.resolvers[M])&&(O=T[g?s:m])&&(S=Promise.resolve(Re.withValue(this.cache,O,[n,Object(oe.a)(t,o),i.context,{field:t,fragmentMap:i.fragmentMap}])))),[2,S.then((function(n){return void 0===n&&(n=_),t.directives&&t.directives.forEach((function(t){"export"===t.name.value&&t.arguments&&t.arguments.forEach((function(t){"as"===t.name.value&&"StringValue"===t.value.kind&&(i.exportedVariables[t.value.value]=n)}))})),t.selectionSet?null==n?n:Array.isArray(n)?A.resolveSubSelectedArray(t,n,i):t.selectionSet?A.resolveSelectionSet(t.selectionSet,n,i):void 0:n}))]}))}))},LocalState.prototype.resolveSubSelectedArray=function(t,n,i){var o=this;return Promise.all(n.map((function(n){return null===n?null:Array.isArray(n)?o.resolveSubSelectedArray(t,n,i):t.selectionSet?o.resolveSelectionSet(t.selectionSet,n,i):void 0})))},LocalState}(),ke=new(Q.a?WeakMap:Map);function wrapDestructiveCacheMethod(t,n){var i=t[n];"function"==typeof i&&(t[n]=function(){return ke.set(t,(ke.get(t)+1)%1e15),i.apply(this,arguments)})}function cancelNotifyTimeout(t){t.notifyTimeout&&(clearTimeout(t.notifyTimeout),t.notifyTimeout=void 0)}var je=function(){function QueryInfo(t,n){void 0===n&&(n=t.generateQueryId()),this.queryId=n,this.listeners=new Set,this.document=null,this.lastRequestId=1,this.subscriptions=new Set,this.stopped=!1,this.dirty=!1,this.observableQuery=null;var i=this.cache=t.cache;ke.has(i)||(ke.set(i,0),wrapDestructiveCacheMethod(i,"evict"),wrapDestructiveCacheMethod(i,"modify"),wrapDestructiveCacheMethod(i,"reset"))}return QueryInfo.prototype.init=function(t){var n=t.networkStatus||ue.loading;return this.variables&&this.networkStatus!==ue.loading&&!equal(this.variables,t.variables)&&(n=ue.setVariables),equal(t.variables,this.variables)||(this.lastDiff=void 0),Object.assign(this,{document:t.document,variables:t.variables,networkError:null,graphQLErrors:this.graphQLErrors||[],networkStatus:n}),t.observableQuery&&this.setObservableQuery(t.observableQuery),t.lastRequestId&&(this.lastRequestId=t.lastRequestId),this},QueryInfo.prototype.reset=function(){cancelNotifyTimeout(this),this.lastDiff=void 0,this.dirty=!1},QueryInfo.prototype.getDiff=function(t){void 0===t&&(t=this.variables);var n=this.getDiffOptions(t);if(this.lastDiff&&equal(n,this.lastDiff.options))return this.lastDiff.diff;this.updateWatch(this.variables=t);var i=this.observableQuery;if(i&&"no-cache"===i.options.fetchPolicy)return{complete:!1};var o=this.cache.diff(n);return this.updateLastDiff(o,n),o},QueryInfo.prototype.updateLastDiff=function(t,n){this.lastDiff=t?{diff:t,options:n||this.getDiffOptions()}:void 0},QueryInfo.prototype.getDiffOptions=function(t){void 0===t&&(t=this.variables);var n=this.observableQuery;return{query:this.document,variables:t,returnPartialData:!0,optimistic:!0,canonizeResults:!n||!1!==n.options.canonizeResults}},QueryInfo.prototype.setDiff=function(t){var n=this,i=this.lastDiff&&this.lastDiff.diff;this.updateLastDiff(t),this.dirty||equal(i&&i.result,t&&t.result)||(this.dirty=!0,this.notifyTimeout||(this.notifyTimeout=setTimeout((function(){return n.notify()}),0)))},QueryInfo.prototype.setObservableQuery=function(t){var n=this;t!==this.observableQuery&&(this.oqListener&&this.listeners.delete(this.oqListener),this.observableQuery=t,t?(t.queryInfo=this,this.listeners.add(this.oqListener=function(){n.getDiff().fromOptimisticTransaction?t.observe():t.reobserve()})):delete this.oqListener)},QueryInfo.prototype.notify=function(){var t=this;cancelNotifyTimeout(this),this.shouldNotify()&&this.listeners.forEach((function(n){return n(t)})),this.dirty=!1},QueryInfo.prototype.shouldNotify=function(){if(!this.dirty||!this.listeners.size)return!1;if(isNetworkRequestInFlight(this.networkStatus)&&this.observableQuery){var t=this.observableQuery.options.fetchPolicy;if("cache-only"!==t&&"cache-and-network"!==t)return!1}return!0},QueryInfo.prototype.stop=function(){if(!this.stopped){this.stopped=!0,this.reset(),this.cancel(),this.cancel=QueryInfo.prototype.cancel,this.subscriptions.forEach((function(t){return t.unsubscribe()}));var t=this.observableQuery;t&&t.stopPolling()}},QueryInfo.prototype.cancel=function(){},QueryInfo.prototype.updateWatch=function(t){var n=this;void 0===t&&(t=this.variables);var i=this.observableQuery;if(!i||"no-cache"!==i.options.fetchPolicy){var o=Object(a.a)(Object(a.a)({},this.getDiffOptions(t)),{watcher:this,callback:function(t){return n.setDiff(t)}});this.lastWatch&&equal(o,this.lastWatch)||(this.cancel(),this.cancel=this.cache.watch(this.lastWatch=o))}},QueryInfo.prototype.resetLastWrite=function(){this.lastWrite=void 0},QueryInfo.prototype.shouldWrite=function(t,n){var i=this.lastWrite;return!(i&&i.dmCount===ke.get(this.cache)&&equal(n,i.variables)&&equal(t.data,i.result.data))},QueryInfo.prototype.markResult=function(t,n,i){var o=this;this.graphQLErrors=Object(ce.a)(t.errors)?t.errors:[],this.reset(),"no-cache"===n.fetchPolicy?this.updateLastDiff({result:t.data,complete:!0},this.getDiffOptions(n.variables)):0!==i&&(shouldWriteResult(t,n.errorPolicy)?this.cache.performTransaction((function(a){if(o.shouldWrite(t,n.variables))a.writeQuery({query:o.document,data:t.data,variables:n.variables,overwrite:1===i}),o.lastWrite={result:t,variables:n.variables,dmCount:ke.get(o.cache)};else if(o.lastDiff&&o.lastDiff.diff.complete)return void(t.data=o.lastDiff.diff.result);var s=o.getDiffOptions(n.variables),m=a.diff(s);o.stopped||o.updateWatch(n.variables),o.updateLastDiff(m,s),m.complete&&(t.data=m.result)})):this.lastWrite=void 0)},QueryInfo.prototype.markReady=function(){return this.networkError=null,this.networkStatus=ue.ready},QueryInfo.prototype.markError=function(t){return this.networkStatus=ue.error,this.lastWrite=void 0,this.reset(),t.graphQLErrors&&(this.graphQLErrors=t.graphQLErrors),t.networkError&&(this.networkError=t.networkError),t},QueryInfo}();function shouldWriteResult(t,n){void 0===n&&(n="none");var i="ignore"===n||"all"===n,o=!Object(te.a)(t);return!o&&i&&t.data&&(o=!0),o}var Fe=Object.prototype.hasOwnProperty,De=function(){function QueryManager(t){var n=t.cache,i=t.link,o=t.queryDeduplication,a=void 0!==o&&o,s=t.onBroadcast,m=t.ssrMode,g=void 0!==m&&m,_=t.clientAwareness,S=void 0===_?{}:_,M=t.localState,T=t.assumeImmutableResults;this.clientAwareness={},this.queries=new Map,this.fetchCancelFns=new Map,this.transformCache=new(Q.a?WeakMap:Map),this.queryIdCounter=1,this.requestIdCounter=1,this.mutationIdCounter=1,this.inFlightLinkObservables=new Map,this.cache=n,this.link=i,this.queryDeduplication=a,this.clientAwareness=S,this.localState=M||new Ie({cache:n}),this.ssrMode=g,this.assumeImmutableResults=!!T,(this.onBroadcast=s)&&(this.mutationStore=Object.create(null))}return QueryManager.prototype.stop=function(){var t=this;this.queries.forEach((function(n,i){t.stopQueryNoBroadcast(i)})),this.cancelPendingFetches(__DEV__?new s.a("QueryManager stopped while query was in flight"):new s.a(14))},QueryManager.prototype.cancelPendingFetches=function(t){this.fetchCancelFns.forEach((function(n){return n(t)})),this.fetchCancelFns.clear()},QueryManager.prototype.mutate=function(t){var n=t.mutation,i=t.variables,o=t.optimisticResponse,m=t.updateQueries,g=t.refetchQueries,_=void 0===g?[]:g,S=t.awaitRefetchQueries,M=void 0!==S&&S,T=t.update,O=t.onQueryUpdated,A=t.errorPolicy,P=void 0===A?"none":A,L=t.fetchPolicy,R=void 0===L?"network-only":L,N=t.keepRootFields,I=t.context;return Object(a.b)(this,void 0,void 0,(function(){var t,g,S;return Object(a.d)(this,(function(A){switch(A.label){case 0:return __DEV__?Object(s.b)(n,"mutation option is required. You must specify your GraphQL document in the mutation option."):Object(s.b)(n,15),__DEV__?Object(s.b)("network-only"===R||"no-cache"===R,"Mutations support only 'network-only' or 'no-cache' fetchPolicy strings. The default `network-only` behavior automatically writes mutation results to the cache. Passing `no-cache` skips the cache write."):Object(s.b)("network-only"===R||"no-cache"===R,16),t=this.generateMutationId(),n=this.transform(n).document,i=this.getVariables(n,i),this.transform(n).hasClientExports?[4,this.localState.addExportedVariables(n,i,I)]:[3,2];case 1:i=A.sent(),A.label=2;case 2:return g=this.mutationStore&&(this.mutationStore[t]={mutation:n,variables:i,loading:!0,error:null}),o&&this.markMutationOptimistic(o,{mutationId:t,document:n,variables:i,fetchPolicy:R,errorPolicy:P,context:I,updateQueries:m,update:T,keepRootFields:N}),this.broadcastQueries(),S=this,[2,new Promise((function(s,A){return Object(ee.a)(S.getObservableFromLink(n,Object(a.a)(Object(a.a)({},I),{optimisticResponse:o}),i,!1),(function(s){if(Object(te.a)(s)&&"none"===P)throw new le({graphQLErrors:s.errors});g&&(g.loading=!1,g.error=null);var A=Object(a.a)({},s);return"function"==typeof _&&(_=_(A)),"ignore"===P&&Object(te.a)(A)&&delete A.errors,S.markMutationResult({mutationId:t,result:A,document:n,variables:i,fetchPolicy:R,errorPolicy:P,context:I,update:T,updateQueries:m,awaitRefetchQueries:M,refetchQueries:_,removeOptimistic:o?t:void 0,onQueryUpdated:O,keepRootFields:N})})).subscribe({next:function(t){S.broadcastQueries(),s(t)},error:function(n){g&&(g.loading=!1,g.error=n),o&&S.cache.removeOptimistic(t),S.broadcastQueries(),A(n instanceof le?n:new le({networkError:n}))}})}))]}}))}))},QueryManager.prototype.markMutationResult=function(t,n){var i=this;void 0===n&&(n=this.cache);var o=t.result,s=[],m="no-cache"===t.fetchPolicy;if(!m&&shouldWriteResult(o,t.errorPolicy)){s.push({result:o.data,dataId:"ROOT_MUTATION",query:t.document,variables:t.variables});var g=t.updateQueries;g&&this.queries.forEach((function(t,a){var m=t.observableQuery,_=m&&m.queryName;if(_&&Fe.call(g,_)){var S=g[_],M=i.queries.get(a),T=M.document,O=M.variables,A=n.diff({query:T,variables:O,returnPartialData:!0,optimistic:!1}),P=A.result;if(A.complete&&P){var L=S(P,{mutationResult:o,queryName:T&&Object(ne.g)(T)||void 0,queryVariables:O});L&&s.push({result:L,dataId:"ROOT_QUERY",query:T,variables:O})}}}))}if(s.length>0||t.refetchQueries||t.update||t.onQueryUpdated||t.removeOptimistic){var _=[];if(this.refetchQueries({updateCache:function(n){m||s.forEach((function(t){return n.write(t)}));var g=t.update;if(g){if(!m){var _=n.diff({id:"ROOT_MUTATION",query:i.transform(t.document).asQuery,variables:t.variables,optimistic:!1,returnPartialData:!0});_.complete&&(o=Object(a.a)(Object(a.a)({},o),{data:_.result}))}g(n,o,{context:t.context,variables:t.variables})}m||t.keepRootFields||n.modify({id:"ROOT_MUTATION",fields:function(t,n){var i=n.fieldName,o=n.DELETE;return"__typename"===i?t:o}})},include:t.refetchQueries,optimistic:!1,removeOptimistic:t.removeOptimistic,onQueryUpdated:t.onQueryUpdated||null}).forEach((function(t){return _.push(t)})),t.awaitRefetchQueries||t.onQueryUpdated)return Promise.all(_).then((function(){return o}))}return Promise.resolve(o)},QueryManager.prototype.markMutationOptimistic=function(t,n){var i=this,o="function"==typeof t?t(n.variables):t;return this.cache.recordOptimisticTransaction((function(t){try{i.markMutationResult(Object(a.a)(Object(a.a)({},n),{result:{data:o}}),t)}catch(t){__DEV__&&s.b.error(t)}}),n.mutationId)},QueryManager.prototype.fetchQuery=function(t,n,i){return this.fetchQueryObservable(t,n,i).promise},QueryManager.prototype.getQueryStore=function(){var t=Object.create(null);return this.queries.forEach((function(n,i){t[i]={variables:n.variables,networkStatus:n.networkStatus,networkError:n.networkError,graphQLErrors:n.graphQLErrors}})),t},QueryManager.prototype.resetErrors=function(t){var n=this.queries.get(t);n&&(n.networkError=void 0,n.graphQLErrors=[])},QueryManager.prototype.transform=function(t){var n=this.transformCache;if(!n.has(t)){var i=this.cache.transformDocument(t),o=Object(re.e)(this.cache.transformForLink(i)),s=this.localState.clientQuery(i),m=o&&this.localState.serverQuery(o),g={document:i,hasClientExports:Object(ie.c)(i),hasForcedResolvers:this.localState.shouldForceResolvers(i),clientQuery:s,serverQuery:m,defaultVars:Object(ne.b)(Object(ne.f)(i)),asQuery:Object(a.a)(Object(a.a)({},i),{definitions:i.definitions.map((function(t){return"OperationDefinition"===t.kind&&"query"!==t.operation?Object(a.a)(Object(a.a)({},t),{operation:"query"}):t}))})},add=function(t){t&&!n.has(t)&&n.set(t,g)};add(t),add(i),add(s),add(m)}return n.get(t)},QueryManager.prototype.getVariables=function(t,n){return Object(a.a)(Object(a.a)({},this.transform(t).defaultVars),n)},QueryManager.prototype.watchQuery=function(t){void 0===(t=Object(a.a)(Object(a.a)({},t),{variables:this.getVariables(t.query,t.variables)})).notifyOnNetworkStatusChange&&(t.notifyOnNetworkStatusChange=!1);var n=new je(this),i=new me({queryManager:this,queryInfo:n,options:t});return this.queries.set(i.queryId,n),n.init({document:t.query,observableQuery:i,variables:t.variables}),i},QueryManager.prototype.query=function(t,n){var i=this;return void 0===n&&(n=this.generateQueryId()),__DEV__?Object(s.b)(t.query,"query option is required. You must specify your GraphQL document in the query option."):Object(s.b)(t.query,17),__DEV__?Object(s.b)("Document"===t.query.kind,'You must wrap the query string in a "gql" tag.'):Object(s.b)("Document"===t.query.kind,18),__DEV__?Object(s.b)(!t.returnPartialData,"returnPartialData option only supported on watchQuery."):Object(s.b)(!t.returnPartialData,19),__DEV__?Object(s.b)(!t.pollInterval,"pollInterval option only supported on watchQuery."):Object(s.b)(!t.pollInterval,20),this.fetchQuery(n,t).finally((function(){return i.stopQuery(n)}))},QueryManager.prototype.generateQueryId=function(){return String(this.queryIdCounter++)},QueryManager.prototype.generateRequestId=function(){return this.requestIdCounter++},QueryManager.prototype.generateMutationId=function(){return String(this.mutationIdCounter++)},QueryManager.prototype.stopQueryInStore=function(t){this.stopQueryInStoreNoBroadcast(t),this.broadcastQueries()},QueryManager.prototype.stopQueryInStoreNoBroadcast=function(t){var n=this.queries.get(t);n&&n.stop()},QueryManager.prototype.clearStore=function(){return this.cancelPendingFetches(__DEV__?new s.a("Store reset while query was in flight (not completed in link chain)"):new s.a(21)),this.queries.forEach((function(t){t.observableQuery?t.networkStatus=ue.loading:t.stop()})),this.mutationStore&&(this.mutationStore=Object.create(null)),this.cache.reset()},QueryManager.prototype.resetStore=function(){var t=this;return this.clearStore().then((function(){return t.reFetchObservableQueries()}))},QueryManager.prototype.getObservableQueries=function(t){var n=this;void 0===t&&(t="active");var i=new Map,o=new Map,m=new Set;return Array.isArray(t)&&t.forEach((function(t){"string"==typeof t?o.set(t,!1):Object(oe.d)(t)?o.set(n.transform(t).document,!1):Object(X.a)(t)&&t.query&&m.add(t)})),this.queries.forEach((function(n,a){var s=n.observableQuery,m=n.document;if(s){if("all"===t)return void i.set(a,s);var g=s.queryName;if("standby"===s.options.fetchPolicy||!s.hasObservers())return;("active"===t||g&&o.has(g)||m&&o.has(m))&&(i.set(a,s),g&&o.set(g,!0),m&&o.set(m,!0))}})),m.size&&m.forEach((function(t){var o=Object(ae.a)("legacyOneTimeQuery"),m=n.getQuery(o).init({document:t.query,variables:t.variables}),g=new me({queryManager:n,queryInfo:m,options:Object(a.a)(Object(a.a)({},t),{fetchPolicy:"network-only"})});Object(s.b)(g.queryId===o),m.setObservableQuery(g),i.set(o,g)})),__DEV__&&o.size&&o.forEach((function(t,n){t||__DEV__&&s.b.warn("Unknown query "+("string"==typeof n?"named ":"")+JSON.stringify(n,null,2)+" requested in refetchQueries options.include array")})),i},QueryManager.prototype.reFetchObservableQueries=function(t){var n=this;void 0===t&&(t=!1);var i=[];return this.getObservableQueries(t?"all":"active").forEach((function(o,a){var s=o.options.fetchPolicy;o.resetLastResults(),(t||"standby"!==s&&"cache-only"!==s)&&i.push(o.refetch()),n.getQuery(a).setDiff(null)})),this.broadcastQueries(),Promise.all(i)},QueryManager.prototype.setObservableQuery=function(t){this.getQuery(t.queryId).setObservableQuery(t)},QueryManager.prototype.startGraphQLSubscription=function(t){var n=this,i=t.query,o=t.fetchPolicy,a=t.errorPolicy,s=t.variables,m=t.context,g=void 0===m?{}:m;i=this.transform(i).document,s=this.getVariables(i,s);var makeObservable=function(t){return n.getObservableFromLink(i,g,t).map((function(s){if("no-cache"!==o&&(shouldWriteResult(s,a)&&n.cache.write({query:i,result:s.data,dataId:"ROOT_SUBSCRIPTION",variables:t}),n.broadcastQueries()),Object(te.a)(s))throw new le({graphQLErrors:s.errors});return s}))};if(this.transform(i).hasClientExports){var _=this.localState.addExportedVariables(i,s,g).then(makeObservable);return new M.a((function(t){var n=null;return _.then((function(i){return n=i.subscribe(t)}),t.error),function(){return n&&n.unsubscribe()}}))}return makeObservable(s)},QueryManager.prototype.stopQuery=function(t){this.stopQueryNoBroadcast(t),this.broadcastQueries()},QueryManager.prototype.stopQueryNoBroadcast=function(t){this.stopQueryInStoreNoBroadcast(t),this.removeQuery(t)},QueryManager.prototype.removeQuery=function(t){this.fetchCancelFns.delete(t),this.getQuery(t).stop(),this.queries.delete(t)},QueryManager.prototype.broadcastQueries=function(){this.onBroadcast&&this.onBroadcast(),this.queries.forEach((function(t){return t.notify()}))},QueryManager.prototype.getLocalState=function(){return this.localState},QueryManager.prototype.getObservableFromLink=function(t,n,i,o){var s,m,_=this;void 0===o&&(o=null!==(s=null==n?void 0:n.queryDeduplication)&&void 0!==s?s:this.queryDeduplication);var S=this.transform(t).serverQuery;if(S){var T=this.inFlightLinkObservables,O=this.link,A={query:S,variables:i,operationName:Object(ne.g)(S)||void 0,context:this.prepareContext(Object(a.a)(Object(a.a)({},n),{forceFetch:!o}))};if(n=A.context,o){var P=T.get(S)||new Map;T.set(S,P);var L=$(i);if(!(m=P.get(L))){var R=new se.a([Object(g.a)(O,A)]);P.set(L,m=R),R.cleanup((function(){P.delete(L)&&P.size<1&&T.delete(S)}))}}else m=new se.a([Object(g.a)(O,A)])}else m=new se.a([M.a.of({data:{}})]),n=this.prepareContext(n);var N=this.transform(t).clientQuery;return N&&(m=Object(ee.a)(m,(function(t){return _.localState.runResolvers({document:N,remoteResult:t,context:n,variables:i})}))),m},QueryManager.prototype.getResultsFromLink=function(t,n,i){var o=t.lastRequestId=this.generateRequestId();return Object(ee.a)(this.getObservableFromLink(t.document,i.context,i.variables),(function(a){var s=Object(ce.a)(a.errors);if(o>=t.lastRequestId){if(s&&"none"===i.errorPolicy)throw t.markError(new le({graphQLErrors:a.errors}));t.markResult(a,i,n),t.markReady()}var m={data:a.data,loading:!1,networkStatus:t.networkStatus||ue.ready};return s&&"ignore"!==i.errorPolicy&&(m.errors=a.errors),m}),(function(n){var i=isApolloError(n)?n:new le({networkError:n});throw o>=t.lastRequestId&&t.markError(i),i}))},QueryManager.prototype.fetchQueryObservable=function(t,n,i){var o=this;void 0===i&&(i=ue.loading);var a=this.transform(n.query).document,s=this.getVariables(a,n.variables),m=this.getQuery(t),g=n.fetchPolicy,_=void 0===g?"cache-first":g,S=n.errorPolicy,M=void 0===S?"none":S,T=n.returnPartialData,O=void 0!==T&&T,A=n.notifyOnNetworkStatusChange,P=void 0!==A&&A,L=n.context,R=void 0===L?{}:L,N=Object.assign({},n,{query:a,variables:s,fetchPolicy:_,errorPolicy:M,returnPartialData:O,notifyOnNetworkStatusChange:P,context:R}),fromVariables=function(t){return N.variables=t,o.fetchQueryByPolicy(m,N,i)};this.fetchCancelFns.set(t,(function(t){Promise.resolve().then((function(){return I.cancel(t)}))}));var I=new se.a(this.transform(N.query).hasClientExports?this.localState.addExportedVariables(N.query,N.variables,N.context).then(fromVariables):fromVariables(N.variables));return I.cleanup((function(){o.fetchCancelFns.delete(t),applyNextFetchPolicy(n)})),I},QueryManager.prototype.refetchQueries=function(t){var n=this,i=t.updateCache,o=t.include,a=t.optimistic,s=void 0!==a&&a,m=t.removeOptimistic,g=void 0===m?s?Object(ae.a)("refetchQueries"):void 0:m,_=t.onQueryUpdated,S=new Map;o&&this.getObservableQueries(o).forEach((function(t,i){S.set(i,{oq:t,lastDiff:n.getQuery(i).getDiff()})}));var M=new Map;return i&&this.cache.batch({update:i,optimistic:s&&g||!1,removeOptimistic:g,onWatchUpdated:function(t,n,i){var o=t.watcher instanceof je&&t.watcher.observableQuery;if(o){if(_){S.delete(o.queryId);var a=_(o,n,i);return!0===a&&(a=o.refetch()),!1!==a&&M.set(o,a),!1}null!==_&&S.set(o.queryId,{oq:o,lastDiff:i,diff:n})}}}),S.size&&S.forEach((function(t,i){var o,a=t.oq,s=t.lastDiff,m=t.diff;if(_){if(!m){var g=a.queryInfo;g.reset(),m=g.getDiff()}o=_(a,m,s)}_&&!0!==o||(o=a.refetch()),!1!==o&&M.set(a,o),i.indexOf("legacyOneTimeQuery")>=0&&n.stopQueryNoBroadcast(i)})),g&&this.cache.removeOptimistic(g),M},QueryManager.prototype.fetchQueryByPolicy=function(t,n,i){var o=this,s=n.query,m=n.variables,g=n.fetchPolicy,_=n.refetchWritePolicy,S=n.errorPolicy,T=n.returnPartialData,O=n.context,A=n.notifyOnNetworkStatusChange,P=t.networkStatus;t.init({document:s,variables:m,networkStatus:i});var readCache=function(){return t.getDiff(m)},resultsFromCache=function(n,i){void 0===i&&(i=t.networkStatus||ue.loading);var g=n.result;!__DEV__||T||equal(g,{})||logMissingFieldErrors(n.missing);var fromData=function(t){return M.a.of(Object(a.a)({data:t,loading:isNetworkRequestInFlight(i),networkStatus:i},n.complete?null:{partial:!0}))};return g&&o.transform(s).hasForcedResolvers?o.localState.runResolvers({document:s,remoteResult:{data:g},context:O,variables:m,onlyRunForcedResolvers:!0}).then((function(t){return fromData(t.data||void 0)})):fromData(g)},L="no-cache"===g?0:i===ue.refetch&&"merge"!==_?1:2,resultsFromLink=function(){return o.getResultsFromLink(t,L,{variables:m,context:O,fetchPolicy:g,errorPolicy:S})},R=A&&"number"==typeof P&&P!==i&&isNetworkRequestInFlight(i);switch(g){default:case"cache-first":return(N=readCache()).complete?[resultsFromCache(N,t.markReady())]:T||R?[resultsFromCache(N),resultsFromLink()]:[resultsFromLink()];case"cache-and-network":var N;return(N=readCache()).complete||T||R?[resultsFromCache(N),resultsFromLink()]:[resultsFromLink()];case"cache-only":return[resultsFromCache(readCache(),t.markReady())];case"network-only":return R?[resultsFromCache(readCache()),resultsFromLink()]:[resultsFromLink()];case"no-cache":return R?[resultsFromCache(t.getDiff()),resultsFromLink()]:[resultsFromLink()];case"standby":return[]}},QueryManager.prototype.getQuery=function(t){return t&&!this.queries.has(t)&&this.queries.set(t,new je(this,t)),this.queries.get(t)},QueryManager.prototype.prepareContext=function(t){void 0===t&&(t={});var n=this.localState.prepareContext(t);return Object(a.a)(Object(a.a)({},n),{clientAwareness:this.clientAwareness})},QueryManager}(),Be=!1;function mergeOptions(t,n){return Object(_.a)(t,n,n.variables&&{variables:Object(a.a)(Object(a.a)({},t.variables),n.variables)})}var Ve,Ue=function(){function ApolloClient(t){var n=this;this.defaultOptions={},this.resetStoreCallbacks=[],this.clearStoreCallbacks=[];var i=t.uri,o=t.credentials,a=t.headers,g=t.cache,_=t.ssrMode,S=void 0!==_&&_,M=t.ssrForceFetchDelay,T=void 0===M?0:M,O=t.connectToDevTools,A=void 0===O?"object"==typeof window&&!window.__APOLLO_CLIENT__&&__DEV__:O,P=t.queryDeduplication,L=void 0===P||P,N=t.defaultOptions,I=t.assumeImmutableResults,j=void 0!==I&&I,V=t.resolvers,U=t.typeDefs,G=t.fragmentMatcher,z=t.name,H=t.version,q=t.link;if(q||(q=i?new R({uri:i,credentials:o,headers:a}):m.a.empty()),!g)throw __DEV__?new s.a("To initialize Apollo Client, you must specify a 'cache' property in the options object. \nFor more information, please visit: https://go.apollo.dev/c/docs"):new s.a(10);if(this.link=q,this.cache=g,this.disableNetworkFetches=S||T>0,this.queryDeduplication=L,this.defaultOptions=N||{},this.typeDefs=U,T&&setTimeout((function(){return n.disableNetworkFetches=!1}),T),this.watchQuery=this.watchQuery.bind(this),this.query=this.query.bind(this),this.mutate=this.mutate.bind(this),this.resetStore=this.resetStore.bind(this),this.reFetchObservableQueries=this.reFetchObservableQueries.bind(this),A&&"object"==typeof window&&(window.__APOLLO_CLIENT__=this),!Be&&__DEV__&&(Be=!0,"undefined"!=typeof window&&window.document&&window.top===window.self&&!window.__APOLLO_DEVTOOLS_GLOBAL_HOOK__)){var Z=window.navigator,X=Z&&Z.userAgent,Q=void 0;"string"==typeof X&&(X.indexOf("Chrome/")>-1?Q="https://chrome.google.com/webstore/detail/apollo-client-developer-t/jdkknkkbebbapilgoeccciglkfbmbnfm":X.indexOf("Firefox/")>-1&&(Q="https://addons.mozilla.org/en-US/firefox/addon/apollo-developer-tools/")),Q&&__DEV__&&s.b.log("Download the Apollo DevTools for a better development experience: "+Q)}this.version="3.4.8",this.localState=new Ie({cache:g,client:this,resolvers:V,fragmentMatcher:G}),this.queryManager=new De({cache:this.cache,link:this.link,queryDeduplication:L,ssrMode:S,clientAwareness:{name:z,version:H},localState:this.localState,assumeImmutableResults:j,onBroadcast:A?function(){n.devToolsHookCb&&n.devToolsHookCb({action:{},state:{queries:n.queryManager.getQueryStore(),mutations:n.queryManager.mutationStore||{}},dataWithOptimisticResults:n.cache.extract(!0)})}:void 0})}return ApolloClient.prototype.stop=function(){this.queryManager.stop()},ApolloClient.prototype.watchQuery=function(t){return this.defaultOptions.watchQuery&&(t=mergeOptions(this.defaultOptions.watchQuery,t)),!this.disableNetworkFetches||"network-only"!==t.fetchPolicy&&"cache-and-network"!==t.fetchPolicy||(t=Object(a.a)(Object(a.a)({},t),{fetchPolicy:"cache-first"})),this.queryManager.watchQuery(t)},ApolloClient.prototype.query=function(t){return this.defaultOptions.query&&(t=mergeOptions(this.defaultOptions.query,t)),__DEV__?Object(s.b)("cache-and-network"!==t.fetchPolicy,"The cache-and-network fetchPolicy does not work with client.query, because client.query can only return a single result. Please use client.watchQuery to receive multiple results from the cache and the network, or consider using a different fetchPolicy, such as cache-first or network-only."):Object(s.b)("cache-and-network"!==t.fetchPolicy,11),this.disableNetworkFetches&&"network-only"===t.fetchPolicy&&(t=Object(a.a)(Object(a.a)({},t),{fetchPolicy:"cache-first"})),this.queryManager.query(t)},ApolloClient.prototype.mutate=function(t){return this.defaultOptions.mutate&&(t=mergeOptions(this.defaultOptions.mutate,t)),this.queryManager.mutate(t)},ApolloClient.prototype.subscribe=function(t){return this.queryManager.startGraphQLSubscription(t)},ApolloClient.prototype.readQuery=function(t,n){return void 0===n&&(n=!1),this.cache.readQuery(t,n)},ApolloClient.prototype.readFragment=function(t,n){return void 0===n&&(n=!1),this.cache.readFragment(t,n)},ApolloClient.prototype.writeQuery=function(t){this.cache.writeQuery(t),this.queryManager.broadcastQueries()},ApolloClient.prototype.writeFragment=function(t){this.cache.writeFragment(t),this.queryManager.broadcastQueries()},ApolloClient.prototype.__actionHookForDevTools=function(t){this.devToolsHookCb=t},ApolloClient.prototype.__requestRaw=function(t){return Object(g.a)(this.link,t)},ApolloClient.prototype.resetStore=function(){var t=this;return Promise.resolve().then((function(){return t.queryManager.clearStore()})).then((function(){return Promise.all(t.resetStoreCallbacks.map((function(t){return t()})))})).then((function(){return t.reFetchObservableQueries()}))},ApolloClient.prototype.clearStore=function(){var t=this;return Promise.resolve().then((function(){return t.queryManager.clearStore()})).then((function(){return Promise.all(t.clearStoreCallbacks.map((function(t){return t()})))}))},ApolloClient.prototype.onResetStore=function(t){var n=this;return this.resetStoreCallbacks.push(t),function(){n.resetStoreCallbacks=n.resetStoreCallbacks.filter((function(n){return n!==t}))}},ApolloClient.prototype.onClearStore=function(t){var n=this;return this.clearStoreCallbacks.push(t),function(){n.clearStoreCallbacks=n.clearStoreCallbacks.filter((function(n){return n!==t}))}},ApolloClient.prototype.reFetchObservableQueries=function(t){return this.queryManager.reFetchObservableQueries(t)},ApolloClient.prototype.refetchQueries=function(t){var n=this.queryManager.refetchQueries(t),i=[],o=[];n.forEach((function(t,n){i.push(n),o.push(t)}));var a=Promise.all(o);return a.queries=i,a.results=o,a.catch((function(t){__DEV__&&s.b.debug("In client.refetchQueries, Promise.all promise rejected with error "+t)})),a},ApolloClient.prototype.getObservableQueries=function(t){return void 0===t&&(t="active"),this.queryManager.getObservableQueries(t)},ApolloClient.prototype.extract=function(t){return this.cache.extract(t)},ApolloClient.prototype.restore=function(t){return this.cache.restore(t)},ApolloClient.prototype.addResolvers=function(t){this.localState.addResolvers(t)},ApolloClient.prototype.setResolvers=function(t){this.localState.setResolvers(t)},ApolloClient.prototype.getResolvers=function(){return this.localState.getResolvers()},ApolloClient.prototype.setLocalStateFragmentMatcher=function(t){this.localState.setFragmentMatcher(t)},ApolloClient.prototype.setLink=function(t){this.link=this.queryManager.link=t},ApolloClient}();Ve||(Ve={});var Ge=function(){function ApolloCache(){this.getFragmentDoc=wrap(ye.c)}return ApolloCache.prototype.batch=function(t){var n="string"==typeof t.optimistic?t.optimistic:!1===t.optimistic?null:void 0;this.performTransaction(t.update,n)},ApolloCache.prototype.recordOptimisticTransaction=function(t,n){this.performTransaction(t,n)},ApolloCache.prototype.transformDocument=function(t){return t},ApolloCache.prototype.identify=function(t){},ApolloCache.prototype.gc=function(){return[]},ApolloCache.prototype.modify=function(t){return!1},ApolloCache.prototype.transformForLink=function(t){return t},ApolloCache.prototype.readQuery=function(t,n){return void 0===n&&(n=!!t.optimistic),this.read(Object(a.a)(Object(a.a)({},t),{rootId:t.id||"ROOT_QUERY",optimistic:n}))},ApolloCache.prototype.readFragment=function(t,n){return void 0===n&&(n=!!t.optimistic),this.read(Object(a.a)(Object(a.a)({},t),{query:this.getFragmentDoc(t.fragment,t.fragmentName),rootId:t.id,optimistic:n}))},ApolloCache.prototype.writeQuery=function(t){var n=t.id,i=t.data,o=Object(a.e)(t,["id","data"]);return this.write(Object.assign(o,{dataId:n||"ROOT_QUERY",result:i}))},ApolloCache.prototype.writeFragment=function(t){var n=t.id,i=t.data,o=t.fragment,s=t.fragmentName,m=Object(a.e)(t,["id","data","fragment","fragmentName"]);return this.write(Object.assign(m,{query:this.getFragmentDoc(o,s),dataId:n,result:i}))},ApolloCache}(),ze=function(t){function MissingFieldError(n,i,o,a){var s=t.call(this,n)||this;return s.message=n,s.path=i,s.query=o,s.variables=a,s.__proto__=MissingFieldError.prototype,s}return Object(a.c)(MissingFieldError,t),MissingFieldError}(Error),He=i(111),We=Object.prototype.hasOwnProperty;var qe=/^[_a-z][_0-9a-z]*/i;function fieldNameFromStoreName(t){var n=t.match(qe);return n?n[0]:t}function selectionSetMatchesResult(t,n,i){return!!Object(X.a)(n)&&(Array.isArray(n)?n.every((function(n){return selectionSetMatchesResult(t,n,i)})):t.selections.every((function(t){if(Object(oe.e)(t)&&Object(ie.e)(t,i)){var o=Object(oe.i)(t);return We.call(n,o)&&(!t.selectionSet||selectionSetMatchesResult(t.selectionSet,n[o],i))}return!0})))}function storeValueIsStoreObject(t){return Object(X.a)(t)&&!Object(oe.g)(t)&&!Array.isArray(t)}var Ze,Xe,Qe=Object.create(null),delModifier=function(){return Qe},Ye=Object.create(null),Je=function(){function EntityStore(t,n){var i=this;this.policies=t,this.group=n,this.data=Object.create(null),this.rootIds=Object.create(null),this.refs=Object.create(null),this.getFieldValue=function(t,n){return Object(He.a)(Object(oe.g)(t)?i.get(t.__ref,n):t&&t[n])},this.canRead=function(t){return Object(oe.g)(t)?i.has(t.__ref):"object"==typeof t},this.toReference=function(t,n){if("string"==typeof t)return Object(oe.h)(t);if(Object(oe.g)(t))return t;var o=i.policies.identify(t)[0];if(o){var a=Object(oe.h)(o);return n&&i.merge(o,t),a}}}return EntityStore.prototype.toObject=function(){return Object(a.a)({},this.data)},EntityStore.prototype.has=function(t){return void 0!==this.lookup(t,!0)},EntityStore.prototype.get=function(t,n){if(this.group.depend(t,n),We.call(this.data,t)){var i=this.data[t];if(i&&We.call(i,n))return i[n]}return"__typename"===n&&We.call(this.policies.rootTypenamesById,t)?this.policies.rootTypenamesById[t]:this instanceof $e?this.parent.get(t,n):void 0},EntityStore.prototype.lookup=function(t,n){return n&&this.group.depend(t,"__exists"),We.call(this.data,t)?this.data[t]:this instanceof $e?this.parent.lookup(t,n):this.policies.rootTypenamesById[t]?Object.create(null):void 0},EntityStore.prototype.merge=function(t,n){var i,o=this;Object(oe.g)(t)&&(t=t.__ref),Object(oe.g)(n)&&(n=n.__ref);var a="string"==typeof t?this.lookup(i=t):t,m="string"==typeof n?this.lookup(i=n):n;if(m){__DEV__?Object(s.b)("string"==typeof i,"store.merge expects a string ID"):Object(s.b)("string"==typeof i,2);var g=new ge.a(storeObjectReconciler).merge(a,m);if(this.data[i]=g,g!==a&&(delete this.refs[i],this.group.caching)){var _=Object.create(null);a||(_.__exists=1),Object.keys(m).forEach((function(t){if(!a||a[t]!==g[t]){_[t]=1;var n=fieldNameFromStoreName(t);n===t||o.policies.hasKeyArgs(g.__typename,n)||(_[n]=1),void 0!==g[t]||o instanceof $e||delete g[t]}})),!_.__typename||a&&a.__typename||this.policies.rootTypenamesById[i]!==g.__typename||delete _.__typename,Object.keys(_).forEach((function(t){return o.group.dirty(i,t)}))}}},EntityStore.prototype.modify=function(t,n){var i=this,o=this.lookup(t);if(o){var s=Object.create(null),m=!1,g=!0,_={DELETE:Qe,INVALIDATE:Ye,isReference:oe.g,toReference:this.toReference,canRead:this.canRead,readField:function(n,o){return i.policies.readField("string"==typeof n?{fieldName:n,from:o||Object(oe.h)(t)}:n,{store:i})}};if(Object.keys(o).forEach((function(S){var M=fieldNameFromStoreName(S),T=o[S];if(void 0!==T){var O="function"==typeof n?n:n[S]||n[M];if(O){var A=O===delModifier?Qe:O(Object(He.a)(T),Object(a.a)(Object(a.a)({},_),{fieldName:M,storeFieldName:S,storage:i.getStorage(t,S)}));A===Ye?i.group.dirty(t,S):(A===Qe&&(A=void 0),A!==T&&(s[S]=A,m=!0,T=A))}void 0!==T&&(g=!1)}})),m)return this.merge(t,s),g&&(this instanceof $e?this.data[t]=void 0:delete this.data[t],this.group.dirty(t,"__exists")),!0}return!1},EntityStore.prototype.delete=function(t,n,i){var o,a=this.lookup(t);if(a){var s=this.getFieldValue(a,"__typename"),m=n&&i?this.policies.getStoreFieldName({typename:s,fieldName:n,args:i}):n;return this.modify(t,m?((o={})[m]=delModifier,o):delModifier)}return!1},EntityStore.prototype.evict=function(t){var n=!1;return t.id&&(We.call(this.data,t.id)&&(n=this.delete(t.id,t.fieldName,t.args)),this instanceof $e&&(n=this.parent.evict(t)||n),(t.fieldName||n)&&this.group.dirty(t.id,t.fieldName||"__exists")),n},EntityStore.prototype.clear=function(){this.replace(null)},EntityStore.prototype.extract=function(){var t=this,n=this.toObject(),i=[];return this.getRootIdSet().forEach((function(n){We.call(t.policies.rootTypenamesById,n)||i.push(n)})),i.length&&(n.__META={extraRootIds:i.sort()}),n},EntityStore.prototype.replace=function(t){var n=this;if(Object.keys(this.data).forEach((function(i){t&&We.call(t,i)||n.delete(i)})),t){var i=t.__META,o=Object(a.e)(t,["__META"]);Object.keys(o).forEach((function(t){n.merge(t,o[t])})),i&&i.extraRootIds.forEach(this.retain,this)}},EntityStore.prototype.retain=function(t){return this.rootIds[t]=(this.rootIds[t]||0)+1},EntityStore.prototype.release=function(t){if(this.rootIds[t]>0){var n=--this.rootIds[t];return n||delete this.rootIds[t],n}return 0},EntityStore.prototype.getRootIdSet=function(t){return void 0===t&&(t=new Set),Object.keys(this.rootIds).forEach(t.add,t),this instanceof $e?this.parent.getRootIdSet(t):Object.keys(this.policies.rootTypenamesById).forEach(t.add,t),t},EntityStore.prototype.gc=function(){var t=this,n=this.getRootIdSet(),i=this.toObject();n.forEach((function(o){We.call(i,o)&&(Object.keys(t.findChildRefIds(o)).forEach(n.add,n),delete i[o])}));var o=Object.keys(i);if(o.length){for(var a=this;a instanceof $e;)a=a.parent;o.forEach((function(t){return a.delete(t)}))}return o},EntityStore.prototype.findChildRefIds=function(t){if(!We.call(this.refs,t)){var n=this.refs[t]=Object.create(null),i=this.data[t];if(!i)return n;var o=new Set([i]);o.forEach((function(t){Object(oe.g)(t)&&(n[t.__ref]=!0),Object(X.a)(t)&&Object.keys(t).forEach((function(n){var i=t[n];Object(X.a)(i)&&o.add(i)}))}))}return this.refs[t]},EntityStore.prototype.makeCacheKey=function(){return this.group.keyMaker.lookupArray(arguments)},EntityStore}(),Ke=function(){function CacheGroup(t,n){void 0===n&&(n=null),this.caching=t,this.parent=n,this.d=null,this.resetCaching()}return CacheGroup.prototype.resetCaching=function(){this.d=this.caching?dep():null,this.keyMaker=new Z(Q.a)},CacheGroup.prototype.depend=function(t,n){if(this.d){this.d(makeDepKey(t,n));var i=fieldNameFromStoreName(n);i!==n&&this.d(makeDepKey(t,i)),this.parent&&this.parent.depend(t,n)}},CacheGroup.prototype.dirty=function(t,n){this.d&&this.d.dirty(makeDepKey(t,n),"__exists"===n?"forget":"setDirty")},CacheGroup}();function makeDepKey(t,n){return n+"#"+t}function maybeDependOnExistenceOfEntity(t,n){supportsResultCaching(t)&&t.group.depend(n,"__exists")}Ze=Je||(Je={}),Xe=function(t){function Root(n){var i=n.policies,o=n.resultCaching,a=void 0===o||o,s=n.seed,m=t.call(this,i,new Ke(a))||this;return m.stump=new et(m),m.storageTrie=new Z(Q.a),s&&m.replace(s),m}return Object(a.c)(Root,t),Root.prototype.addLayer=function(t,n){return this.stump.addLayer(t,n)},Root.prototype.removeLayer=function(){return this},Root.prototype.getStorage=function(){return this.storageTrie.lookupArray(arguments)},Root}(Ze),Ze.Root=Xe;var $e=function(t){function Layer(n,i,o,a){var s=t.call(this,i.policies,a)||this;return s.id=n,s.parent=i,s.replay=o,s.group=a,o(s),s}return Object(a.c)(Layer,t),Layer.prototype.addLayer=function(t,n){return new Layer(t,this,n,this.group)},Layer.prototype.removeLayer=function(t){var n=this,i=this.parent.removeLayer(t);return t===this.id?(this.group.caching&&Object.keys(this.data).forEach((function(t){var o=n.data[t],a=i.lookup(t);a?o?o!==a&&Object.keys(o).forEach((function(i){equal(o[i],a[i])||n.group.dirty(t,i)})):(n.group.dirty(t,"__exists"),Object.keys(a).forEach((function(i){n.group.dirty(t,i)}))):n.delete(t)})),i):i===this.parent?this:i.addLayer(this.id,this.replay)},Layer.prototype.toObject=function(){return Object(a.a)(Object(a.a)({},this.parent.toObject()),this.data)},Layer.prototype.findChildRefIds=function(n){var i=this.parent.findChildRefIds(n);return We.call(this.data,n)?Object(a.a)(Object(a.a)({},i),t.prototype.findChildRefIds.call(this,n)):i},Layer.prototype.getStorage=function(){for(var t=this.parent;t.parent;)t=t.parent;return t.getStorage.apply(t,arguments)},Layer}(Je),et=function(t){function Stump(n){return t.call(this,"EntityStore.Stump",n,(function(){}),new Ke(n.group.caching,n.group))||this}return Object(a.c)(Stump,t),Stump.prototype.removeLayer=function(){return this},Stump.prototype.merge=function(){return this.parent.merge.apply(this.parent,arguments)},Stump}($e);function storeObjectReconciler(t,n,i){var o=t[i],a=n[i];return equal(o,a)?o:a}function supportsResultCaching(t){return!!(t instanceof Je&&t.group.caching)}function missingFromInvariant(t,n){return new ze(t.message,n.path.slice(),n.query,n.variables)}function execSelectionSetKeyArgs(t){return[t.selectionSet,t.objectOrReference,t.context,t.context.canonizeResults]}var tt=function(){function StoreReader(t){var n=this;this.knownResults=new(Q.a?WeakMap:Map),this.config=Object(a.a)(Object(a.a)({},t),{addTypename:!1!==t.addTypename}),this.canon=t.canon||new K,this.executeSelectionSet=wrap((function(t){var i,o=t.context.canonizeResults,s=execSelectionSetKeyArgs(t);s[3]=!o;var m=(i=n.executeSelectionSet).peek.apply(i,s);return m?o?Object(a.a)(Object(a.a)({},m),{result:n.canon.admit(m.result)}):m:(maybeDependOnExistenceOfEntity(t.context.store,t.enclosingRef.__ref),n.execSelectionSetImpl(t))}),{max:this.config.resultCacheMaxSize,keyArgs:execSelectionSetKeyArgs,makeCacheKey:function(t,n,i,o){if(supportsResultCaching(i.store))return i.store.makeCacheKey(t,Object(oe.g)(n)?n.__ref:n,i.varString,o)}}),this.executeSubSelectedArray=wrap((function(t){return maybeDependOnExistenceOfEntity(t.context.store,t.enclosingRef.__ref),n.execSubSelectedArrayImpl(t)}),{max:this.config.resultCacheMaxSize,makeCacheKey:function(t){var n=t.field,i=t.array,o=t.context;if(supportsResultCaching(o.store))return o.store.makeCacheKey(n,i,o.varString)}})}return StoreReader.prototype.resetCanon=function(){this.canon=new K},StoreReader.prototype.diffQueryAgainstStore=function(t){var n=t.store,i=t.query,o=t.rootId,s=void 0===o?"ROOT_QUERY":o,m=t.variables,g=t.returnPartialData,_=void 0===g||g,S=t.canonizeResults,M=void 0===S||S,T=this.config.cache.policies;m=Object(a.a)(Object(a.a)({},Object(ne.b)(Object(ne.h)(i))),m);var O=Object(oe.h)(s),A=this.executeSelectionSet({selectionSet:Object(ne.e)(i).selectionSet,objectOrReference:O,enclosingRef:O,context:{store:n,query:i,policies:T,variables:m,varString:$(m),canonizeResults:M,fragmentMap:Object(ye.a)(Object(ne.d)(i)),path:[]}}),P=A.missing&&A.missing.length>0;if(P&&!_)throw A.missing[0];return{result:A.result,missing:A.missing,complete:!P}},StoreReader.prototype.isFresh=function(t,n,i,o){if(supportsResultCaching(o.store)&&this.knownResults.get(t)===i){var a=this.executeSelectionSet.peek(i,n,o,this.canon.isKnown(t));if(a&&t===a.result)return!0}return!1},StoreReader.prototype.execSelectionSetImpl=function(t){var n=this,i=t.selectionSet,o=t.objectOrReference,a=t.enclosingRef,m=t.context;if(Object(oe.g)(o)&&!m.policies.rootTypenamesById[o.__ref]&&!m.store.has(o.__ref))return{result:this.canon.empty,missing:[missingFromInvariant(__DEV__?new s.a("Dangling reference to missing "+o.__ref+" object"):new s.a(6),m)]};var g=m.variables,_=m.policies,S=m.store,M=[],T={result:null},O=S.getFieldValue(o,"__typename");function getMissing(){return T.missing||(T.missing=[])}function handleMissing(t){var n;return t.missing&&(n=getMissing()).push.apply(n,t.missing),t.result}this.config.addTypename&&"string"==typeof O&&!_.rootIdsByTypename[O]&&M.push({__typename:O});var A=new Set(i.selections);A.forEach((function(t){var i;if(Object(ie.e)(t,g))if(Object(oe.e)(t)){var S=_.readField({fieldName:t.name.value,field:t,variables:m.variables,from:o},m),T=Object(oe.i)(t);m.path.push(T),void 0===S?re.a.added(t)||getMissing().push(missingFromInvariant(__DEV__?new s.a("Can't find field '"+t.name.value+"' on "+(Object(oe.g)(o)?o.__ref+" object":"object "+JSON.stringify(o,null,2))):new s.a(7),m)):Array.isArray(S)?S=handleMissing(n.executeSubSelectedArray({field:t,array:S,enclosingRef:a,context:m})):t.selectionSet?null!=S&&(S=handleMissing(n.executeSelectionSet({selectionSet:t.selectionSet,objectOrReference:S,enclosingRef:Object(oe.g)(S)?S:a,context:m}))):m.canonizeResults&&(S=n.canon.pass(S)),void 0!==S&&M.push(((i={})[T]=S,i)),Object(s.b)(m.path.pop()===T)}else{var P=Object(ye.b)(t,m.fragmentMap);P&&_.fragmentMatches(P,O)&&P.selectionSet.selections.forEach(A.add,A)}}));var P=Object(ge.c)(M);return T.result=m.canonizeResults?this.canon.admit(P):Object(He.a)(P),this.knownResults.set(T.result,i),T},StoreReader.prototype.execSubSelectedArrayImpl=function(t){var n,i=this,o=t.field,a=t.array,m=t.enclosingRef,g=t.context;function handleMissing(t,i){return t.missing&&(n=n||[]).push.apply(n,t.missing),Object(s.b)(g.path.pop()===i),t.result}return o.selectionSet&&(a=a.filter(g.store.canRead)),a=a.map((function(t,n){return null===t?null:(g.path.push(n),Array.isArray(t)?handleMissing(i.executeSubSelectedArray({field:o,array:t,enclosingRef:m,context:g}),n):o.selectionSet?handleMissing(i.executeSelectionSet({selectionSet:o.selectionSet,objectOrReference:t,enclosingRef:Object(oe.g)(t)?t:m,context:g}),n):(__DEV__&&function assertSelectionSetForIdValue(t,n,i){if(!n.selectionSet){var o=new Set([i]);o.forEach((function(i){Object(X.a)(i)&&(__DEV__?Object(s.b)(!Object(oe.g)(i),"Missing selection set for object of type "+function getTypenameFromStoreObject(t,n){return Object(oe.g)(n)?t.get(n.__ref,"__typename"):n&&n.__typename}(t,i)+" returned for query field "+n.name.value):Object(s.b)(!Object(oe.g)(i),8),Object.values(i).forEach(o.add,o))}))}}(g.store,o,t),Object(s.b)(g.path.pop()===n),t))})),{result:g.canonizeResults?this.canon.admit(a):a,missing:n}},StoreReader}();var nt=function(){function StoreWriter(t,n){this.cache=t,this.reader=n}return StoreWriter.prototype.writeToStore=function(t,n){var i=this,o=n.query,m=n.result,g=n.dataId,_=n.variables,S=n.overwrite,M=Object(ne.f)(o),T=function makeProcessedFieldsMerger(){return new ge.a}();_=Object(a.a)(Object(a.a)({},Object(ne.b)(M)),_);var O={store:t,written:Object.create(null),merge:function(t,n){return T.merge(t,n)},variables:_,varString:$(_),fragmentMap:Object(ye.a)(Object(ne.d)(o)),overwrite:!!S,incomingById:new Map,clientOnly:!1},A=this.processSelectionSet({result:m||Object.create(null),dataId:g,selectionSet:M.selectionSet,mergeTree:{map:new Map},context:O});if(!Object(oe.g)(A))throw __DEV__?new s.a("Could not identify object "+JSON.stringify(m)):new s.a(9);return O.incomingById.forEach((function(n,o){var a=n.fields,m=n.mergeTree,g=n.selections,_=Object(oe.h)(o);if(m&&m.map.size){var S=i.applyMerges(m,_,a,O);if(Object(oe.g)(S))return;a=S}if(__DEV__&&!O.overwrite){var M=new Set;g.forEach((function(t){Object(oe.e)(t)&&t.selectionSet&&M.add(t.name.value)}));Object.keys(a).forEach((function(t){(function(t){return M.has(fieldNameFromStoreName(t))})(t)&&!function(t){var n=m&&m.map.get(t);return Boolean(n&&n.info&&n.info.merge)}(t)&&function warnAboutDataLoss(t,n,i,o){var getChild=function(t){var n=o.getFieldValue(t,i);return"object"==typeof n&&n},a=getChild(t);if(!a)return;var m=getChild(n);if(!m)return;if(Object(oe.g)(a))return;if(equal(a,m))return;if(Object.keys(a).every((function(t){return void 0!==o.getFieldValue(m,t)})))return;var g=o.getFieldValue(t,"__typename")||o.getFieldValue(n,"__typename"),_=fieldNameFromStoreName(i),S=g+"."+_;if(it.has(S))return;it.add(S);var M=[];Array.isArray(a)||Array.isArray(m)||[a,m].forEach((function(t){var n=o.getFieldValue(t,"__typename");"string"!=typeof n||M.includes(n)||M.push(n)}));__DEV__&&s.b.warn("Cache data may be lost when replacing the "+_+" field of a "+g+" object.\n\nTo address this problem (which is not a bug in Apollo Client), "+(M.length?"either ensure all objects of type "+M.join(" and ")+" have an ID or a custom merge function, or ":"")+"define a custom merge function for the "+S+" field, so InMemoryCache can safely merge these objects:\n\n  existing: "+JSON.stringify(a).slice(0,1e3)+"\n  incoming: "+JSON.stringify(m).slice(0,1e3)+"\n\nFor more information about these options, please refer to the documentation:\n\n  * Ensuring entity objects have IDs: https://go.apollo.dev/c/generating-unique-identifiers\n  * Defining custom merge functions: https://go.apollo.dev/c/merging-non-normalized-objects\n")}(_,a,t,O.store)}))}t.merge(o,a)})),t.retain(A.__ref),A},StoreWriter.prototype.processSelectionSet=function(t){var n=this,i=t.dataId,o=t.result,m=t.selectionSet,g=t.context,_=t.mergeTree,S=this.cache.policies,M=S.identify(o,m,g.fragmentMap),T=M[0],O=M[1];if("string"==typeof(i=i||T)){var A=g.written[i]||(g.written[i]=[]),P=Object(oe.h)(i);if(A.indexOf(m)>=0)return P;if(A.push(m),this.reader&&this.reader.isFresh(o,P,m,g))return P}var L=Object.create(null);O&&(L=g.merge(L,O));var R=i&&S.rootTypenamesById[i]||Object(oe.c)(o,m,g.fragmentMap)||i&&g.store.get(i,"__typename");"string"==typeof R&&(L.__typename=R);var N=new Set(m.selections);if(N.forEach((function(t){var i;if(Object(ie.e)(t,g.variables))if(Object(oe.e)(t)){var a=Object(oe.i)(t),m=o[a],M=g.clientOnly;if(g.clientOnly=M||!(!t.directives||!t.directives.some((function(t){return"client"===t.name.value}))),void 0!==m){var T=S.getStoreFieldName({typename:R,fieldName:t.name.value,field:t,variables:g.variables}),O=getChildMergeTree(_,T),A=n.processFieldValue(m,t,g,O),P=void 0;if(t.selectionSet&&!(P=g.store.getFieldValue(A,"__typename"))&&Object(oe.g)(A)){var I=g.incomingById.get(A.__ref);P=I&&I.fields.__typename}var j=S.getMergeFunction(R,t.name.value,P);j?O.info={field:t,typename:R,merge:j}:maybeRecycleChildMergeTree(_,T),L=g.merge(L,((i={})[T]=A,i))}else g.clientOnly||re.a.added(t)||__DEV__&&s.b.error(("Missing field '"+Object(oe.i)(t)+"' while writing result "+JSON.stringify(o,null,2)).substring(0,1e3));g.clientOnly=M}else{var V=Object(ye.b)(t,g.fragmentMap);V&&S.fragmentMatches(V,R,o,g.variables)&&V.selectionSet.selections.forEach(N.add,N)}})),"string"==typeof i){var I=g.incomingById.get(i);return I?(I.fields=g.merge(I.fields,L),I.mergeTree=function mergeMergeTrees(t,n){if(t===n||!n||mergeTreeIsEmpty(n))return t;if(!t||mergeTreeIsEmpty(t))return n;var i=t.info&&n.info?Object(a.a)(Object(a.a)({},t.info),n.info):t.info||n.info,o=t.map.size&&n.map.size,s=o?new Map:t.map.size?t.map:n.map,m={info:i,map:s};if(o){var g=new Set(n.map.keys());t.map.forEach((function(t,i){m.map.set(i,mergeMergeTrees(t,n.map.get(i))),g.delete(i)})),g.forEach((function(i){m.map.set(i,mergeMergeTrees(n.map.get(i),t.map.get(i)))}))}return m}(I.mergeTree,_),I.selections.forEach(N.add,N),I.selections=N):g.incomingById.set(i,{fields:L,mergeTree:mergeTreeIsEmpty(_)?void 0:_,selections:N}),Object(oe.h)(i)}return L},StoreWriter.prototype.processFieldValue=function(t,n,i,o){var a=this;return n.selectionSet&&null!==t?Array.isArray(t)?t.map((function(t,s){var m=a.processFieldValue(t,n,i,getChildMergeTree(o,s));return maybeRecycleChildMergeTree(o,s),m})):this.processSelectionSet({result:t,selectionSet:n.selectionSet,context:i,mergeTree:o}):__DEV__?Object(he.a)(t):t},StoreWriter.prototype.applyMerges=function(t,n,i,o,m){var g,_=this;if(t.map.size&&!Object(oe.g)(i)){var S,M=Array.isArray(i)||!Object(oe.g)(n)&&!storeValueIsStoreObject(n)?void 0:n,T=i;M&&!m&&(m=[Object(oe.g)(M)?M.__ref:M]);var getValue_1=function(t,n){return Array.isArray(t)?"number"==typeof n?t[n]:void 0:o.store.getFieldValue(t,String(n))};t.map.forEach((function(t,n){var i=getValue_1(M,n),a=getValue_1(T,n);if(void 0!==a){m&&m.push(n);var g=_.applyMerges(t,i,a,o,m);g!==a&&(S=S||new Map).set(n,g),m&&Object(s.b)(m.pop()===n)}})),S&&(i=Array.isArray(T)?T.slice(0):Object(a.a)({},T),S.forEach((function(t,n){i[n]=t})))}return t.info?this.cache.policies.runMergeFunction(n,i,t.info,o,m&&(g=o.store).getStorage.apply(g,m)):i},StoreWriter}(),rt=[];function getChildMergeTree(t,n){var i=t.map;return i.has(n)||i.set(n,rt.pop()||{map:new Map}),i.get(n)}function mergeTreeIsEmpty(t){return!t||!(t.info||t.map.size)}function maybeRecycleChildMergeTree(t,n){var i=t.map,o=i.get(n);o&&mergeTreeIsEmpty(o)&&(rt.push(o),i.delete(n))}var it=new Set;var ot=i(110);function argsFromFieldSpecifier(t){return void 0!==t.args?t.args:t.field?Object(oe.a)(t.field,t.variables):null}oe.b.setStringify($);var defaultDataIdFromObject=function(t,n){var i=t.__typename,o=t.id,a=t._id;if("string"==typeof i&&(n&&(n.keyObject=void 0!==o?{id:o}:void 0!==a?{_id:a}:void 0),void 0===o&&(o=a),void 0!==o))return i+":"+("number"==typeof o||"string"==typeof o?o:JSON.stringify(o))},nullKeyFieldsFn=function(){},simpleKeyArgsFn=function(t,n){return n.fieldName},mergeTrueFn=function(t,n,i){return(0,i.mergeObjects)(t,n)},mergeFalseFn=function(t,n){return n},at=function(){function Policies(t){this.config=t,this.typePolicies=Object.create(null),this.toBeAdded=Object.create(null),this.supertypeMap=new Map,this.fuzzySubtypes=new Map,this.rootIdsByTypename=Object.create(null),this.rootTypenamesById=Object.create(null),this.usingPossibleTypes=!1,this.config=Object(a.a)({dataIdFromObject:defaultDataIdFromObject},t),this.cache=this.config.cache,this.setRootTypename("Query"),this.setRootTypename("Mutation"),this.setRootTypename("Subscription"),t.possibleTypes&&this.addPossibleTypes(t.possibleTypes),t.typePolicies&&this.addTypePolicies(t.typePolicies)}return Policies.prototype.identify=function(t,n,i){var o=n&&i?Object(oe.c)(t,n,i):t.__typename;if(o===this.rootTypenamesById.ROOT_QUERY)return["ROOT_QUERY"];for(var a,s={typename:o,selectionSet:n,fragmentMap:i},m=o&&this.getTypePolicy(o),g=m&&m.keyFn||this.config.dataIdFromObject;g;){var _=g(t,s);if(!Array.isArray(_)){a=_;break}g=keyFieldsFnFromSpecifier(_)}return a=a?String(a):void 0,s.keyObject?[a,s.keyObject]:[a]},Policies.prototype.addTypePolicies=function(t){var n=this;Object.keys(t).forEach((function(i){var o=t[i],s=o.queryType,m=o.mutationType,g=o.subscriptionType,_=Object(a.e)(o,["queryType","mutationType","subscriptionType"]);s&&n.setRootTypename("Query",i),m&&n.setRootTypename("Mutation",i),g&&n.setRootTypename("Subscription",i),We.call(n.toBeAdded,i)?n.toBeAdded[i].push(_):n.toBeAdded[i]=[_]}))},Policies.prototype.updateTypePolicy=function(t,n){var i=this,o=this.getTypePolicy(t),a=n.keyFields,s=n.fields;function setMerge(t,n){t.merge="function"==typeof n?n:!0===n?mergeTrueFn:!1===n?mergeFalseFn:t.merge}setMerge(o,n.merge),o.keyFn=!1===a?nullKeyFieldsFn:Array.isArray(a)?keyFieldsFnFromSpecifier(a):"function"==typeof a?a:o.keyFn,s&&Object.keys(s).forEach((function(n){var o=i.getFieldPolicy(t,n,!0),a=s[n];if("function"==typeof a)o.read=a;else{var m=a.keyArgs,g=a.read,_=a.merge;o.keyFn=!1===m?simpleKeyArgsFn:Array.isArray(m)?keyArgsFnFromSpecifier(m):"function"==typeof m?m:o.keyFn,"function"==typeof g&&(o.read=g),setMerge(o,_)}o.read&&o.merge&&(o.keyFn=o.keyFn||simpleKeyArgsFn)}))},Policies.prototype.setRootTypename=function(t,n){void 0===n&&(n=t);var i="ROOT_"+t.toUpperCase(),o=this.rootTypenamesById[i];n!==o&&(__DEV__?Object(s.b)(!o||o===t,"Cannot change root "+t+" __typename more than once"):Object(s.b)(!o||o===t,3),o&&delete this.rootIdsByTypename[o],this.rootIdsByTypename[n]=i,this.rootTypenamesById[i]=n)},Policies.prototype.addPossibleTypes=function(t){var n=this;this.usingPossibleTypes=!0,Object.keys(t).forEach((function(i){n.getSupertypeSet(i,!0),t[i].forEach((function(t){n.getSupertypeSet(t,!0).add(i);var o=t.match(qe);o&&o[0]===t||n.fuzzySubtypes.set(t,new RegExp(t))}))}))},Policies.prototype.getTypePolicy=function(t){var n=this;if(!We.call(this.typePolicies,t)){var i=this.typePolicies[t]=Object.create(null);i.fields=Object.create(null);var o=this.supertypeMap.get(t);o&&o.size&&o.forEach((function(t){var o=n.getTypePolicy(t),s=o.fields,m=Object(a.e)(o,["fields"]);Object.assign(i,m),Object.assign(i.fields,s)}))}var s=this.toBeAdded[t];return s&&s.length&&s.splice(0).forEach((function(i){n.updateTypePolicy(t,i)})),this.typePolicies[t]},Policies.prototype.getFieldPolicy=function(t,n,i){if(t){var o=this.getTypePolicy(t).fields;return o[n]||i&&(o[n]=Object.create(null))}},Policies.prototype.getSupertypeSet=function(t,n){var i=this.supertypeMap.get(t);return!i&&n&&this.supertypeMap.set(t,i=new Set),i},Policies.prototype.fragmentMatches=function(t,n,i,o){var a=this;if(!t.typeCondition)return!0;if(!n)return!1;var m=t.typeCondition.name.value;if(n===m)return!0;if(this.usingPossibleTypes&&this.supertypeMap.has(m))for(var g=this.getSupertypeSet(n,!0),_=[g],maybeEnqueue_1=function(t){var n=a.getSupertypeSet(t,!1);n&&n.size&&_.indexOf(n)<0&&_.push(n)},S=!(!i||!this.fuzzySubtypes.size),M=!1,T=0;T<_.length;++T){var O=_[T];if(O.has(m))return g.has(m)||(M&&__DEV__&&s.b.warn("Inferring subtype "+n+" of supertype "+m),g.add(m)),!0;O.forEach(maybeEnqueue_1),S&&T===_.length-1&&selectionSetMatchesResult(t.selectionSet,i,o)&&(S=!1,M=!0,this.fuzzySubtypes.forEach((function(t,i){var o=n.match(t);o&&o[0]===n&&maybeEnqueue_1(i)})))}return!1},Policies.prototype.hasKeyArgs=function(t,n){var i=this.getFieldPolicy(t,n,!1);return!(!i||!i.keyFn)},Policies.prototype.getStoreFieldName=function(t){var n,i=t.typename,o=t.fieldName,a=this.getFieldPolicy(i,o,!1),s=a&&a.keyFn;if(s&&i)for(var m={typename:i,fieldName:o,field:t.field||null,variables:t.variables},g=argsFromFieldSpecifier(t);s;){var _=s(g,m);if(!Array.isArray(_)){n=_||o;break}s=keyArgsFnFromSpecifier(_)}return void 0===n&&(n=t.field?Object(oe.j)(t.field,t.variables):Object(oe.b)(o,argsFromFieldSpecifier(t))),!1===n?o:o===fieldNameFromStoreName(n)?n:o+":"+n},Policies.prototype.readField=function(t,n){var i=t.from;if(i&&(t.field||t.fieldName)){if(void 0===t.typename){var o=n.store.getFieldValue(i,"__typename");o&&(t.typename=o)}var a=this.getStoreFieldName(t),s=fieldNameFromStoreName(a),m=n.store.getFieldValue(i,a),g=this.getFieldPolicy(t.typename,s,!1),_=g&&g.read;if(_){var S=makeFieldFunctionOptions(this,i,t,n,n.store.getStorage(Object(oe.g)(i)?i.__ref:i,a));return Re.withValue(this.cache,_,[m,S])}return m}},Policies.prototype.getMergeFunction=function(t,n,i){var o=this.getFieldPolicy(t,n,!1),a=o&&o.merge;return!a&&i&&(a=(o=this.getTypePolicy(i))&&o.merge),a},Policies.prototype.runMergeFunction=function(t,n,i,o,a){var s=i.field,m=i.typename,g=i.merge;return g===mergeTrueFn?makeMergeObjectsFunction(o.store)(t,n):g===mergeFalseFn?n:(o.overwrite&&(t=void 0),g(t,n,makeFieldFunctionOptions(this,void 0,{typename:m,fieldName:s.name.value,field:s,variables:o.variables},o,a||Object.create(null))))},Policies}();function makeFieldFunctionOptions(t,n,i,o,m){var g=t.getStoreFieldName(i),_=fieldNameFromStoreName(g),S=i.variables||o.variables,M=o.store,T=M.toReference,O=M.canRead;return{args:argsFromFieldSpecifier(i),field:i.field||null,fieldName:_,storeFieldName:g,variables:S,isReference:oe.g,toReference:T,storage:m,cache:t.cache,canRead:O,readField:function(i,m){var g;if("string"==typeof i)g={fieldName:i,from:arguments.length>1?m:n};else{if(!Object(X.a)(i))return void(__DEV__&&s.b.warn("Unexpected readField arguments: "+Object(ot.a)(Array.from(arguments))));g=Object(a.a)({},i),We.call(i,"from")||(g.from=n)}return __DEV__&&void 0===g.from&&__DEV__&&s.b.warn("Undefined 'from' passed to readField with arguments "+Object(ot.a)(Array.from(arguments))),void 0===g.variables&&(g.variables=S),t.readField(g,o)},mergeObjects:makeMergeObjectsFunction(o.store)}}function makeMergeObjectsFunction(t){return function mergeObjects(n,i){if(Array.isArray(n)||Array.isArray(i))throw __DEV__?new s.a("Cannot automatically merge arrays"):new s.a(4);if(Object(X.a)(n)&&Object(X.a)(i)){var o=t.getFieldValue(n,"__typename"),m=t.getFieldValue(i,"__typename");if(o&&m&&o!==m)return i;if(Object(oe.g)(n)&&storeValueIsStoreObject(i))return t.merge(n.__ref,i),n;if(storeValueIsStoreObject(n)&&Object(oe.g)(i))return t.merge(n,i.__ref),i;if(storeValueIsStoreObject(n)&&storeValueIsStoreObject(i))return Object(a.a)(Object(a.a)({},n),i)}return i}}function keyArgsFnFromSpecifier(t){return function(n,i){return n?i.fieldName+":"+JSON.stringify(computeKeyObject(n,t,!1)):i.fieldName}}function keyFieldsFnFromSpecifier(t){var n=new Z(Q.a);return function(i,o){var a;if(o.selectionSet&&o.fragmentMap){var s=n.lookupArray([o.selectionSet,o.fragmentMap]);a=s.aliasMap||(s.aliasMap=function makeAliasMap(t,n){var i=Object.create(null),o=new Set([t]);return o.forEach((function(t){t.selections.forEach((function(t){if(Object(oe.e)(t)){if(t.alias){var a=t.alias.value,s=t.name.value;if(s!==a)(i.aliases||(i.aliases=Object.create(null)))[s]=a}if(t.selectionSet)(i.subsets||(i.subsets=Object.create(null)))[t.name.value]=makeAliasMap(t.selectionSet,n)}else{var m=Object(ye.b)(t,n);m&&o.add(m.selectionSet)}}))})),i}(o.selectionSet,o.fragmentMap))}var m=o.keyObject=computeKeyObject(i,t,!0,a);return o.typename+":"+JSON.stringify(m)}}function computeKeyObject(t,n,i,o){var a,m,g=Object.create(null);return n.forEach((function(n){if(Array.isArray(n)){if("string"==typeof m&&"string"==typeof a){var _=o&&o.subsets,S=_&&_[m];g[m]=computeKeyObject(t[a],n,i,S)}}else{var M=o&&o.aliases,T=M&&M[n]||n;We.call(t,T)?g[m=n]=t[a=T]:(__DEV__?Object(s.b)(!i,"Missing field '"+T+"' while computing key fields"):Object(s.b)(!i,5),a=m=void 0)}})),g}var st={dataIdFromObject:defaultDataIdFromObject,addTypename:!0,resultCaching:!0,typePolicies:{}},ct=function(t){function InMemoryCache(n){void 0===n&&(n={});var i=t.call(this)||this;return i.watches=new Set,i.typenameDocumentCache=new Map,i.makeVar=makeVar,i.txCount=0,i.config=Object(a.a)(Object(a.a)({},st),n),i.addTypename=!!i.config.addTypename,i.policies=new at({cache:i,dataIdFromObject:i.config.dataIdFromObject,possibleTypes:i.config.possibleTypes,typePolicies:i.config.typePolicies}),i.init(),i}return Object(a.c)(InMemoryCache,t),InMemoryCache.prototype.init=function(){var t=this.data=new Je.Root({policies:this.policies,resultCaching:this.config.resultCaching});this.optimisticData=t.stump,this.resetResultCache()},InMemoryCache.prototype.resetResultCache=function(t){var n=this,i=this.storeReader;this.storeWriter=new nt(this,this.storeReader=new tt({cache:this,addTypename:this.addTypename,resultCacheMaxSize:this.config.resultCacheMaxSize,canon:t?void 0:i&&i.canon})),this.maybeBroadcastWatch=wrap((function(t,i){return n.broadcastWatch(t,i)}),{max:this.config.resultCacheMaxSize,makeCacheKey:function(t){var i=t.optimistic?n.optimisticData:n.data;if(supportsResultCaching(i)){var o=t.optimistic,a=t.rootId,s=t.variables;return i.makeCacheKey(t.query,t.callback,$({optimistic:o,rootId:a,variables:s}))}}}),new Set([this.data.group,this.optimisticData.group]).forEach((function(t){return t.resetCaching()}))},InMemoryCache.prototype.restore=function(t){return this.init(),t&&this.data.replace(t),this},InMemoryCache.prototype.extract=function(t){return void 0===t&&(t=!1),(t?this.optimisticData:this.data).extract()},InMemoryCache.prototype.read=function(t){var n=t.returnPartialData,i=void 0!==n&&n;try{return this.storeReader.diffQueryAgainstStore(Object(a.a)(Object(a.a)({},t),{store:t.optimistic?this.optimisticData:this.data,config:this.config,returnPartialData:i})).result||null}catch(t){if(t instanceof ze)return null;throw t}},InMemoryCache.prototype.write=function(t){try{return++this.txCount,this.storeWriter.writeToStore(this.data,t)}finally{--this.txCount||!1===t.broadcast||this.broadcastWatches()}},InMemoryCache.prototype.modify=function(t){if(We.call(t,"id")&&!t.id)return!1;var n=t.optimistic?this.optimisticData:this.data;try{return++this.txCount,n.modify(t.id||"ROOT_QUERY",t.fields)}finally{--this.txCount||!1===t.broadcast||this.broadcastWatches()}},InMemoryCache.prototype.diff=function(t){return this.storeReader.diffQueryAgainstStore(Object(a.a)(Object(a.a)({},t),{store:t.optimistic?this.optimisticData:this.data,rootId:t.id||"ROOT_QUERY",config:this.config}))},InMemoryCache.prototype.watch=function(t){var n=this;return this.watches.size||function recallCache(t){getCacheInfo(t).vars.forEach((function(n){return n.attachCache(t)}))}(this),this.watches.add(t),t.immediate&&this.maybeBroadcastWatch(t),function(){n.watches.delete(t)&&!n.watches.size&&function forgetCache(t){getCacheInfo(t).vars.forEach((function(n){return n.forgetCache(t)}))}(n),n.maybeBroadcastWatch.forget(t)}},InMemoryCache.prototype.gc=function(t){$.reset();var n=this.optimisticData.gc();return t&&!this.txCount&&(t.resetResultCache?this.resetResultCache(t.resetResultIdentities):t.resetResultIdentities&&this.storeReader.resetCanon()),n},InMemoryCache.prototype.retain=function(t,n){return(n?this.optimisticData:this.data).retain(t)},InMemoryCache.prototype.release=function(t,n){return(n?this.optimisticData:this.data).release(t)},InMemoryCache.prototype.identify=function(t){return Object(oe.g)(t)?t.__ref:this.policies.identify(t)[0]},InMemoryCache.prototype.evict=function(t){if(!t.id){if(We.call(t,"id"))return!1;t=Object(a.a)(Object(a.a)({},t),{id:"ROOT_QUERY"})}try{return++this.txCount,this.optimisticData.evict(t)}finally{--this.txCount||!1===t.broadcast||this.broadcastWatches()}},InMemoryCache.prototype.reset=function(){return this.init(),this.broadcastWatches(),$.reset(),Promise.resolve()},InMemoryCache.prototype.removeOptimistic=function(t){var n=this.optimisticData.removeLayer(t);n!==this.optimisticData&&(this.optimisticData=n,this.broadcastWatches())},InMemoryCache.prototype.batch=function(t){var n=this,i=t.update,o=t.optimistic,s=void 0===o||o,m=t.removeOptimistic,g=t.onWatchUpdated,perform=function(t){var o=n,a=o.data,s=o.optimisticData;++n.txCount,t&&(n.data=n.optimisticData=t);try{i(n)}finally{--n.txCount,n.data=a,n.optimisticData=s}},_=new Set;g&&!this.txCount&&this.broadcastWatches(Object(a.a)(Object(a.a)({},t),{onWatchUpdated:function(t){return _.add(t),!1}})),"string"==typeof s?this.optimisticData=this.optimisticData.addLayer(s,perform):!1===s?perform(this.data):perform(),"string"==typeof m&&(this.optimisticData=this.optimisticData.removeLayer(m)),g&&_.size?(this.broadcastWatches(Object(a.a)(Object(a.a)({},t),{onWatchUpdated:function(t,n){var i=g.call(this,t,n);return!1!==i&&_.delete(t),i}})),_.size&&_.forEach((function(t){return n.maybeBroadcastWatch.dirty(t)}))):this.broadcastWatches(t)},InMemoryCache.prototype.performTransaction=function(t,n){return this.batch({update:t,optimistic:n||null!==n})},InMemoryCache.prototype.transformDocument=function(t){if(this.addTypename){var n=this.typenameDocumentCache.get(t);return n||(n=Object(re.a)(t),this.typenameDocumentCache.set(t,n),this.typenameDocumentCache.set(n,n)),n}return t},InMemoryCache.prototype.broadcastWatches=function(t){var n=this;this.txCount||this.watches.forEach((function(i){return n.maybeBroadcastWatch(i,t)}))},InMemoryCache.prototype.broadcastWatch=function(t,n){var i=t.lastDiff,o=this.diff({query:t.query,variables:t.variables,optimistic:t.optimistic});n&&(t.optimistic&&"string"==typeof n.optimistic&&(o.fromOptimisticTransaction=!0),n.onWatchUpdated&&!1===n.onWatchUpdated.call(this,t,o,i))||i&&equal(i.result,o.result)||t.callback(t.lastDiff=o,i)},InMemoryCache}(Ge),ut=i(17);function toPromise(t){var n=!1;return new Promise((function(i,o){t.subscribe({next:function(t){n?__DEV__&&s.b.warn("Promise Wrapper does not support multiple results from Observable"):(n=!0,i(t))},error:o})}))}function fromPromise(t){return new M.a((function(n){t.then((function(t){n.next(t),n.complete()})).catch(n.error.bind(n))}))}var lt=i(15);Object(s.c)(o.a?"log":"silent")},function(t,n,i){"use strict";i.r(n),i.d(n,"RetryLink",(function(){return g}));var o=i(0),a=i(9),s=i(30);var m=function(){function RetryableOperation(t,n,i,a){var s=this;this.operation=t,this.nextLink=n,this.delayFor=i,this.retryIf=a,this.retryCount=0,this.values=[],this.complete=!1,this.canceled=!1,this.observers=[],this.currentSubscription=null,this.onNext=function(t){s.values.push(t);for(var n=0,i=s.observers;n<i.length;n++){var o=i[n];o&&o.next(t)}},this.onComplete=function(){s.complete=!0;for(var t=0,n=s.observers;t<n.length;t++){var i=n[t];i&&i.complete()}},this.onError=function(t){return Object(o.b)(s,void 0,void 0,(function(){var n,i,a;return Object(o.d)(this,(function(o){switch(o.label){case 0:return this.retryCount+=1,[4,this.retryIf(this.retryCount,this.operation,t)];case 1:if(o.sent())return this.scheduleRetry(this.delayFor(this.retryCount,this.operation,t)),[2];for(this.error=t,n=0,i=this.observers;n<i.length;n++)(a=i[n])&&a.error(t);return[2]}}))}))}}return RetryableOperation.prototype.subscribe=function(t){if(this.canceled)throw new Error("Subscribing to a retryable link that was canceled is not supported");this.observers.push(t);for(var n=0,i=this.values;n<i.length;n++){var o=i[n];t.next(o)}this.complete?t.complete():this.error&&t.error(this.error)},RetryableOperation.prototype.unsubscribe=function(t){var n=this.observers.indexOf(t);if(n<0)throw new Error("RetryLink BUG! Attempting to unsubscribe unknown observer!");this.observers[n]=null,this.observers.every((function(t){return null===t}))&&this.cancel()},RetryableOperation.prototype.start=function(){this.currentSubscription||this.try()},RetryableOperation.prototype.cancel=function(){this.currentSubscription&&this.currentSubscription.unsubscribe(),clearTimeout(this.timerId),this.timerId=void 0,this.currentSubscription=null,this.canceled=!0},RetryableOperation.prototype.try=function(){this.currentSubscription=this.nextLink(this.operation).subscribe({next:this.onNext,error:this.onError,complete:this.onComplete})},RetryableOperation.prototype.scheduleRetry=function(t){var n=this;if(this.timerId)throw new Error("RetryLink BUG! Encountered overlapping retries");this.timerId=setTimeout((function(){n.timerId=void 0,n.try()}),t)},RetryableOperation}(),g=function(t){function RetryLink(n){var i=t.call(this)||this,o=n||{},a=o.attempts,s=o.delay;return i.delayFor="function"==typeof s?s:function buildDelayFunction(t){var n=t||{},i=n.initial,o=void 0===i?300:i,a=n.jitter,s=void 0===a||a,m=n.max,g=void 0===m?1/0:m,_=s?o:o/2;return function delayFunction(t){var n=Math.min(g,_*Math.pow(2,t));return s&&(n=Math.random()*n),n}}(s),i.retryIf="function"==typeof a?a:function buildRetryFunction(t){var n=t||{},i=n.retryIf,o=n.max,a=void 0===o?5:o;return function retryFunction(t,n,o){return!(t>=a)&&(i?i(o,n):!!o)}}(a),i}return Object(o.c)(RetryLink,t),RetryLink.prototype.request=function(t,n){var i=new m(t,n,this.delayFor,this.retryIf);return i.start(),new s.a((function(t){return i.subscribe(t),function(){i.unsubscribe(t)}}))},RetryLink}(a.a)}])}));